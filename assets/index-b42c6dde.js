var zbe=Object.defineProperty;var Nbe=(lo,Ge,sr)=>Ge in lo?zbe(lo,Ge,{enumerable:!0,configurable:!0,writable:!0,value:sr}):lo[Ge]=sr;var Fbe=(lo,Ge)=>()=>(Ge||lo((Ge={exports:{}}).exports,Ge),Ge.exports);var y=(lo,Ge,sr)=>(Nbe(lo,typeof Ge!="symbol"?Ge+"":Ge,sr),sr);var $be=Fbe((nve,hz)=>{(async()=>{var _k,kk,Ck,Ek,Pk,Ik,Mk,Ak,Tk,jk,Rk,Dk,Ok,Lk,zk,Nk,Fk,$k,Bk,Uk;function lo(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();var Ge=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Qk={exports:{}},dp={},eC={exports:{}},Pe={},cd=Symbol.for("react.element"),pz=Symbol.for("react.portal"),fz=Symbol.for("react.fragment"),gz=Symbol.for("react.strict_mode"),mz=Symbol.for("react.profiler"),yz=Symbol.for("react.provider"),wz=Symbol.for("react.context"),bz=Symbol.for("react.forward_ref"),vz=Symbol.for("react.suspense"),Sz=Symbol.for("react.memo"),xz=Symbol.for("react.lazy"),tC=Symbol.iterator;function _z(n){return n===null||typeof n!="object"?null:(n=tC&&n[tC]||n["@@iterator"],typeof n=="function"?n:null)}var nC={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rC=Object.assign,iC={};function ol(n,e,t){this.props=n,this.context=e,this.refs=iC,this.updater=t||nC}ol.prototype.isReactComponent={},ol.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")},ol.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function oC(){}oC.prototype=ol.prototype;function C0(n,e,t){this.props=n,this.context=e,this.refs=iC,this.updater=t||nC}var E0=C0.prototype=new oC;E0.constructor=C0,rC(E0,ol.prototype),E0.isPureReactComponent=!0;var sC=Array.isArray,aC=Object.prototype.hasOwnProperty,P0={current:null},lC={key:!0,ref:!0,__self:!0,__source:!0};function cC(n,e,t){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)aC.call(e,r)&&!lC.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:cd,type:n,key:o,ref:s,props:i,_owner:P0.current}}function kz(n,e){return{$$typeof:cd,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function I0(n){return typeof n=="object"&&n!==null&&n.$$typeof===cd}function Cz(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var dC=/\/+/g;function M0(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Cz(""+n.key):e.toString(36)}function up(n,e,t,r,i){var o=typeof n;(o==="undefined"||o==="boolean")&&(n=null);var s=!1;if(n===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(n.$$typeof){case cd:case pz:s=!0}}if(s)return s=n,i=i(s),n=r===""?"."+M0(s,0):r,sC(i)?(t="",n!=null&&(t=n.replace(dC,"$&/")+"/"),up(i,e,t,"",function(c){return c})):i!=null&&(I0(i)&&(i=kz(i,t+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(dC,"$&/")+"/")+n)),e.push(i)),1;if(s=0,r=r===""?".":r+":",sC(n))for(var a=0;a<n.length;a++){o=n[a];var l=r+M0(o,a);s+=up(o,e,t,l,i)}else if(l=_z(n),typeof l=="function")for(n=l.call(n),a=0;!(o=n.next()).done;)o=o.value,l=r+M0(o,a++),s+=up(o,e,t,l,i);else if(o==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function hp(n,e,t){if(n==null)return n;var r=[],i=0;return up(n,r,"","",function(o){return e.call(t,o,i++)}),r}function Ez(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Tn={current:null},pp={transition:null},Pz={ReactCurrentDispatcher:Tn,ReactCurrentBatchConfig:pp,ReactCurrentOwner:P0};Pe.Children={map:hp,forEach:function(n,e,t){hp(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return hp(n,function(){e++}),e},toArray:function(n){return hp(n,function(e){return e})||[]},only:function(n){if(!I0(n))throw Error("React.Children.only expected to receive a single React element child.");return n}},Pe.Component=ol,Pe.Fragment=fz,Pe.Profiler=mz,Pe.PureComponent=C0,Pe.StrictMode=gz,Pe.Suspense=vz,Pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pz,Pe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=rC({},n.props),i=n.key,o=n.ref,s=n._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=P0.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)aC.call(e,l)&&!lC.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:cd,type:n.type,key:i,ref:o,props:r,_owner:s}},Pe.createContext=function(n){return n={$$typeof:wz,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:yz,_context:n},n.Consumer=n},Pe.createElement=cC,Pe.createFactory=function(n){var e=cC.bind(null,n);return e.type=n,e},Pe.createRef=function(){return{current:null}},Pe.forwardRef=function(n){return{$$typeof:bz,render:n}},Pe.isValidElement=I0,Pe.lazy=function(n){return{$$typeof:xz,_payload:{_status:-1,_result:n},_init:Ez}},Pe.memo=function(n,e){return{$$typeof:Sz,type:n,compare:e===void 0?null:e}},Pe.startTransition=function(n){var e=pp.transition;pp.transition={};try{n()}finally{pp.transition=e}},Pe.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},Pe.useCallback=function(n,e){return Tn.current.useCallback(n,e)},Pe.useContext=function(n){return Tn.current.useContext(n)},Pe.useDebugValue=function(){},Pe.useDeferredValue=function(n){return Tn.current.useDeferredValue(n)},Pe.useEffect=function(n,e){return Tn.current.useEffect(n,e)},Pe.useId=function(){return Tn.current.useId()},Pe.useImperativeHandle=function(n,e,t){return Tn.current.useImperativeHandle(n,e,t)},Pe.useInsertionEffect=function(n,e){return Tn.current.useInsertionEffect(n,e)},Pe.useLayoutEffect=function(n,e){return Tn.current.useLayoutEffect(n,e)},Pe.useMemo=function(n,e){return Tn.current.useMemo(n,e)},Pe.useReducer=function(n,e,t){return Tn.current.useReducer(n,e,t)},Pe.useRef=function(n){return Tn.current.useRef(n)},Pe.useState=function(n){return Tn.current.useState(n)},Pe.useSyncExternalStore=function(n,e,t){return Tn.current.useSyncExternalStore(n,e,t)},Pe.useTransition=function(){return Tn.current.useTransition()},Pe.version="18.2.0",eC.exports=Pe;var S=eC.exports;const re=sr(S),Iz=lo({__proto__:null,default:re},[S]);var Mz=S,Az=Symbol.for("react.element"),Tz=Symbol.for("react.fragment"),jz=Object.prototype.hasOwnProperty,Rz=Mz.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Dz={key:!0,ref:!0,__self:!0,__source:!0};function uC(n,e,t){var r,i={},o=null,s=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)jz.call(e,r)&&!Dz.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Az,type:n,key:o,ref:s,props:i,_owner:Rz.current}}dp.Fragment=Tz,dp.jsx=uC,dp.jsxs=uC,Qk.exports=dp;var m=Qk.exports,A0={},hC={exports:{}},ar={},pC={exports:{}},fC={};(function(n){function e(W,N){var Y=W.length;W.push(N);e:for(;0<Y;){var ee=Y-1>>>1,pe=W[ee];if(0<i(pe,N))W[ee]=N,W[Y]=pe,Y=ee;else break e}}function t(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var N=W[0],Y=W.pop();if(Y!==N){W[0]=Y;e:for(var ee=0,pe=W.length,ve=pe>>>1;ee<ve;){var be=2*(ee+1)-1,fe=W[be],Ee=be+1,zt=W[Ee];if(0>i(fe,Y))Ee<pe&&0>i(zt,fe)?(W[ee]=zt,W[Ee]=Y,ee=Ee):(W[ee]=fe,W[be]=Y,ee=be);else if(Ee<pe&&0>i(zt,Y))W[ee]=zt,W[Ee]=Y,ee=Ee;else break e}}return N}function i(W,N){var Y=W.sortIndex-N.sortIndex;return Y!==0?Y:W.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();n.unstable_now=function(){return s.now()-a}}var l=[],c=[],d=1,u=null,h=3,p=!1,g=!1,f=!1,w=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(W){for(var N=t(c);N!==null;){if(N.callback===null)r(c);else if(N.startTime<=W)r(c),N.sortIndex=N.expirationTime,e(l,N);else break;N=t(c)}}function x(W){if(f=!1,_(W),!g)if(t(l)!==null)g=!0,B(E);else{var N=t(c);N!==null&&te(x,N.startTime-W)}}function E(W,N){g=!1,f&&(f=!1,v(I),I=-1),p=!0;var Y=h;try{for(_(N),u=t(l);u!==null&&(!(u.expirationTime>N)||W&&!O());){var ee=u.callback;if(typeof ee=="function"){u.callback=null,h=u.priorityLevel;var pe=ee(u.expirationTime<=N);N=n.unstable_now(),typeof pe=="function"?u.callback=pe:u===t(l)&&r(l),_(N)}else r(l);u=t(l)}if(u!==null)var ve=!0;else{var be=t(c);be!==null&&te(x,be.startTime-N),ve=!1}return ve}finally{u=null,h=Y,p=!1}}var k=!1,P=null,I=-1,A=5,T=-1;function O(){return!(n.unstable_now()-T<A)}function F(){if(P!==null){var W=n.unstable_now();T=W;var N=!0;try{N=P(!0,W)}finally{N?H():(k=!1,P=null)}}else k=!1}var H;if(typeof b=="function")H=function(){b(F)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,K=D.port2;D.port1.onmessage=F,H=function(){K.postMessage(null)}}else H=function(){w(F,0)};function B(W){P=W,k||(k=!0,H())}function te(W,N){I=w(function(){W(n.unstable_now())},N)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(W){W.callback=null},n.unstable_continueExecution=function(){g||p||(g=!0,B(E))},n.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<W?Math.floor(1e3/W):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(W){switch(h){case 1:case 2:case 3:var N=3;break;default:N=h}var Y=h;h=N;try{return W()}finally{h=Y}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(W,N){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Y=h;h=W;try{return N()}finally{h=Y}},n.unstable_scheduleCallback=function(W,N,Y){var ee=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?ee+Y:ee):Y=ee,W){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=Y+pe,W={id:d++,callback:N,priorityLevel:W,startTime:Y,expirationTime:pe,sortIndex:-1},Y>ee?(W.sortIndex=Y,e(c,W),t(l)===null&&W===t(c)&&(f?(v(I),I=-1):f=!0,te(x,Y-ee))):(W.sortIndex=pe,e(l,W),g||p||(g=!0,B(E))),W},n.unstable_shouldYield=O,n.unstable_wrapCallback=function(W){var N=h;return function(){var Y=h;h=N;try{return W.apply(this,arguments)}finally{h=Y}}}})(fC),pC.exports=fC;var Oz=pC.exports,gC=S,lr=Oz;function Z(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var mC=new Set,dd={};function ra(n,e){sl(n,e),sl(n+"Capture",e)}function sl(n,e){for(dd[n]=e,n=0;n<e.length;n++)mC.add(e[n])}var co=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),T0=Object.prototype.hasOwnProperty,Lz=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,yC={},wC={};function zz(n){return T0.call(wC,n)?!0:T0.call(yC,n)?!1:Lz.test(n)?wC[n]=!0:(yC[n]=!0,!1)}function Nz(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Fz(n,e,t,r){if(e===null||typeof e>"u"||Nz(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function jn(n,e,t,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var Qt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Qt[n]=new jn(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Qt[e]=new jn(e,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){Qt[n]=new jn(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Qt[n]=new jn(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Qt[n]=new jn(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){Qt[n]=new jn(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){Qt[n]=new jn(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){Qt[n]=new jn(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){Qt[n]=new jn(n,5,!1,n.toLowerCase(),null,!1,!1)});var j0=/[\-:]([a-z])/g;function R0(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(j0,R0);Qt[e]=new jn(e,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(j0,R0);Qt[e]=new jn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(j0,R0);Qt[e]=new jn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){Qt[n]=new jn(n,1,!1,n.toLowerCase(),null,!1,!1)}),Qt.xlinkHref=new jn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){Qt[n]=new jn(n,1,!1,n.toLowerCase(),null,!0,!0)});function D0(n,e,t,r){var i=Qt.hasOwnProperty(e)?Qt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Fz(e,t,i,r)&&(t=null),r||i===null?zz(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var uo=gC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,fp=Symbol.for("react.element"),al=Symbol.for("react.portal"),ll=Symbol.for("react.fragment"),O0=Symbol.for("react.strict_mode"),L0=Symbol.for("react.profiler"),bC=Symbol.for("react.provider"),vC=Symbol.for("react.context"),z0=Symbol.for("react.forward_ref"),N0=Symbol.for("react.suspense"),F0=Symbol.for("react.suspense_list"),$0=Symbol.for("react.memo"),Qo=Symbol.for("react.lazy"),SC=Symbol.for("react.offscreen"),xC=Symbol.iterator;function ud(n){return n===null||typeof n!="object"?null:(n=xC&&n[xC]||n["@@iterator"],typeof n=="function"?n:null)}var wt=Object.assign,B0;function hd(n){if(B0===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);B0=e&&e[1]||""}return`
`+B0+n}var U0=!1;function V0(n,e){if(!n||U0)return"";U0=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var l=`
`+i[s].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=s&&0<=a);break}}}finally{U0=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?hd(n):""}function $z(n){switch(n.tag){case 5:return hd(n.type);case 16:return hd("Lazy");case 13:return hd("Suspense");case 19:return hd("SuspenseList");case 0:case 2:case 15:return n=V0(n.type,!1),n;case 11:return n=V0(n.type.render,!1),n;case 1:return n=V0(n.type,!0),n;default:return""}}function H0(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case ll:return"Fragment";case al:return"Portal";case L0:return"Profiler";case O0:return"StrictMode";case N0:return"Suspense";case F0:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case vC:return(n.displayName||"Context")+".Consumer";case bC:return(n._context.displayName||"Context")+".Provider";case z0:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case $0:return e=n.displayName||null,e!==null?e:H0(n.type)||"Memo";case Qo:e=n._payload,n=n._init;try{return H0(n(e))}catch{}}return null}function Bz(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H0(e);case 8:return e===O0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function es(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function _C(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Uz(n){var e=_C(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,o=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function gp(n){n._valueTracker||(n._valueTracker=Uz(n))}function kC(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=_C(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function mp(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function W0(n,e){var t=e.checked;return wt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function CC(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=es(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function EC(n,e){e=e.checked,e!=null&&D0(n,"checked",e,!1)}function K0(n,e){EC(n,e);var t=es(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?G0(n,e.type,t):e.hasOwnProperty("defaultValue")&&G0(n,e.type,es(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function PC(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function G0(n,e,t){(e!=="number"||mp(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var pd=Array.isArray;function cl(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+es(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Y0(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Z(91));return wt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function IC(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Z(92));if(pd(t)){if(1<t.length)throw Error(Z(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:es(t)}}function MC(n,e){var t=es(e.value),r=es(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function AC(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function TC(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function X0(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?TC(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var yp,jC=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(yp=yp||document.createElement("div"),yp.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=yp.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function fd(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var gd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vz=["Webkit","ms","Moz","O"];Object.keys(gd).forEach(function(n){Vz.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),gd[e]=gd[n]})});function RC(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||gd.hasOwnProperty(n)&&gd[n]?(""+e).trim():e+"px"}function DC(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=RC(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var Hz=wt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function q0(n,e){if(e){if(Hz[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Z(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Z(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Z(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Z(62))}}function J0(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Z0=null;function Q0(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ew=null,dl=null,ul=null;function OC(n){if(n=zd(n)){if(typeof ew!="function")throw Error(Z(280));var e=n.stateNode;e&&(e=$p(e),ew(n.stateNode,n.type,e))}}function LC(n){dl?ul?ul.push(n):ul=[n]:dl=n}function zC(){if(dl){var n=dl,e=ul;if(ul=dl=null,OC(n),e)for(n=0;n<e.length;n++)OC(e[n])}}function NC(n,e){return n(e)}function FC(){}var tw=!1;function $C(n,e,t){if(tw)return n(e,t);tw=!0;try{return NC(n,e,t)}finally{tw=!1,(dl!==null||ul!==null)&&(FC(),zC())}}function md(n,e){var t=n.stateNode;if(t===null)return null;var r=$p(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Z(231,e,typeof t));return t}var nw=!1;if(co)try{var yd={};Object.defineProperty(yd,"passive",{get:function(){nw=!0}}),window.addEventListener("test",yd,yd),window.removeEventListener("test",yd,yd)}catch{nw=!1}function Wz(n,e,t,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(d){this.onError(d)}}var wd=!1,wp=null,bp=!1,rw=null,Kz={onError:function(n){wd=!0,wp=n}};function Gz(n,e,t,r,i,o,s,a,l){wd=!1,wp=null,Wz.apply(Kz,arguments)}function Yz(n,e,t,r,i,o,s,a,l){if(Gz.apply(this,arguments),wd){if(wd){var c=wp;wd=!1,wp=null}else throw Error(Z(198));bp||(bp=!0,rw=c)}}function ia(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function BC(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function UC(n){if(ia(n)!==n)throw Error(Z(188))}function Xz(n){var e=n.alternate;if(!e){if(e=ia(n),e===null)throw Error(Z(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return UC(i),n;if(o===r)return UC(i),e;o=o.sibling}throw Error(Z(188))}if(t.return!==r.return)t=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===t){s=!0,t=i,r=o;break}if(a===r){s=!0,r=i,t=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===t){s=!0,t=o,r=i;break}if(a===r){s=!0,r=o,t=i;break}a=a.sibling}if(!s)throw Error(Z(189))}}if(t.alternate!==r)throw Error(Z(190))}if(t.tag!==3)throw Error(Z(188));return t.stateNode.current===t?n:e}function VC(n){return n=Xz(n),n!==null?HC(n):null}function HC(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=HC(n);if(e!==null)return e;n=n.sibling}return null}var WC=lr.unstable_scheduleCallback,KC=lr.unstable_cancelCallback,qz=lr.unstable_shouldYield,Jz=lr.unstable_requestPaint,Rt=lr.unstable_now,Zz=lr.unstable_getCurrentPriorityLevel,iw=lr.unstable_ImmediatePriority,GC=lr.unstable_UserBlockingPriority,vp=lr.unstable_NormalPriority,Qz=lr.unstable_LowPriority,YC=lr.unstable_IdlePriority,Sp=null,Ei=null;function e8(n){if(Ei&&typeof Ei.onCommitFiberRoot=="function")try{Ei.onCommitFiberRoot(Sp,n,void 0,(n.current.flags&128)===128)}catch{}}var Jr=Math.clz32?Math.clz32:r8,t8=Math.log,n8=Math.LN2;function r8(n){return n>>>=0,n===0?32:31-(t8(n)/n8|0)|0}var xp=64,_p=4194304;function bd(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function kp(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,o=n.pingedLanes,s=t&268435455;if(s!==0){var a=s&~i;a!==0?r=bd(a):(o&=s,o!==0&&(r=bd(o)))}else s=t&~i,s!==0?r=bd(s):o!==0&&(r=bd(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Jr(e),i=1<<t,r|=n[t],e&=~i;return r}function i8(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function o8(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,o=n.pendingLanes;0<o;){var s=31-Jr(o),a=1<<s,l=i[s];l===-1?(!(a&t)||a&r)&&(i[s]=i8(a,e)):l<=e&&(n.expiredLanes|=a),o&=~a}}function ow(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function XC(){var n=xp;return xp<<=1,!(xp&4194240)&&(xp=64),n}function sw(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function vd(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Jr(e),n[e]=t}function s8(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Jr(t),o=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~o}}function aw(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Jr(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var Ye=0;function qC(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var JC,lw,ZC,QC,eE,cw=!1,Cp=[],ts=null,ns=null,rs=null,Sd=new Map,xd=new Map,is=[],a8="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function tE(n,e){switch(n){case"focusin":case"focusout":ts=null;break;case"dragenter":case"dragleave":ns=null;break;case"mouseover":case"mouseout":rs=null;break;case"pointerover":case"pointerout":Sd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":xd.delete(e.pointerId)}}function _d(n,e,t,r,i,o){return n===null||n.nativeEvent!==o?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=zd(e),e!==null&&lw(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function l8(n,e,t,r,i){switch(e){case"focusin":return ts=_d(ts,n,e,t,r,i),!0;case"dragenter":return ns=_d(ns,n,e,t,r,i),!0;case"mouseover":return rs=_d(rs,n,e,t,r,i),!0;case"pointerover":var o=i.pointerId;return Sd.set(o,_d(Sd.get(o)||null,n,e,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,xd.set(o,_d(xd.get(o)||null,n,e,t,r,i)),!0}return!1}function nE(n){var e=oa(n.target);if(e!==null){var t=ia(e);if(t!==null){if(e=t.tag,e===13){if(e=BC(t),e!==null){n.blockedOn=e,eE(n.priority,function(){ZC(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ep(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=uw(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Z0=r,t.target.dispatchEvent(r),Z0=null}else return e=zd(t),e!==null&&lw(e),n.blockedOn=t,!1;e.shift()}return!0}function rE(n,e,t){Ep(n)&&t.delete(e)}function c8(){cw=!1,ts!==null&&Ep(ts)&&(ts=null),ns!==null&&Ep(ns)&&(ns=null),rs!==null&&Ep(rs)&&(rs=null),Sd.forEach(rE),xd.forEach(rE)}function kd(n,e){n.blockedOn===e&&(n.blockedOn=null,cw||(cw=!0,lr.unstable_scheduleCallback(lr.unstable_NormalPriority,c8)))}function Cd(n){function e(i){return kd(i,n)}if(0<Cp.length){kd(Cp[0],n);for(var t=1;t<Cp.length;t++){var r=Cp[t];r.blockedOn===n&&(r.blockedOn=null)}}for(ts!==null&&kd(ts,n),ns!==null&&kd(ns,n),rs!==null&&kd(rs,n),Sd.forEach(e),xd.forEach(e),t=0;t<is.length;t++)r=is[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<is.length&&(t=is[0],t.blockedOn===null);)nE(t),t.blockedOn===null&&is.shift()}var hl=uo.ReactCurrentBatchConfig,Pp=!0;function d8(n,e,t,r){var i=Ye,o=hl.transition;hl.transition=null;try{Ye=1,dw(n,e,t,r)}finally{Ye=i,hl.transition=o}}function u8(n,e,t,r){var i=Ye,o=hl.transition;hl.transition=null;try{Ye=4,dw(n,e,t,r)}finally{Ye=i,hl.transition=o}}function dw(n,e,t,r){if(Pp){var i=uw(n,e,t,r);if(i===null)Iw(n,e,r,Ip,t),tE(n,r);else if(l8(i,n,e,t,r))r.stopPropagation();else if(tE(n,r),e&4&&-1<a8.indexOf(n)){for(;i!==null;){var o=zd(i);if(o!==null&&JC(o),o=uw(n,e,t,r),o===null&&Iw(n,e,r,Ip,t),o===i)break;i=o}i!==null&&r.stopPropagation()}else Iw(n,e,r,null,t)}}var Ip=null;function uw(n,e,t,r){if(Ip=null,n=Q0(r),n=oa(n),n!==null)if(e=ia(n),e===null)n=null;else if(t=e.tag,t===13){if(n=BC(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Ip=n,null}function iE(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Zz()){case iw:return 1;case GC:return 4;case vp:case Qz:return 16;case YC:return 536870912;default:return 16}default:return 16}}var os=null,hw=null,Mp=null;function oE(){if(Mp)return Mp;var n,e=hw,t=e.length,r,i="value"in os?os.value:os.textContent,o=i.length;for(n=0;n<t&&e[n]===i[n];n++);var s=t-n;for(r=1;r<=s&&e[t-r]===i[o-r];r++);return Mp=i.slice(n,1<r?1-r:void 0)}function Ap(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Tp(){return!0}function sE(){return!1}function cr(n){function e(t,r,i,o,s){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Tp:sE,this.isPropagationStopped=sE,this}return wt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Tp)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Tp)},persist:function(){},isPersistent:Tp}),e}var pl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pw=cr(pl),Ed=wt({},pl,{view:0,detail:0}),h8=cr(Ed),fw,gw,Pd,jp=wt({},Ed,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yw,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Pd&&(Pd&&n.type==="mousemove"?(fw=n.screenX-Pd.screenX,gw=n.screenY-Pd.screenY):gw=fw=0,Pd=n),fw)},movementY:function(n){return"movementY"in n?n.movementY:gw}}),aE=cr(jp),p8=wt({},jp,{dataTransfer:0}),f8=cr(p8),g8=wt({},Ed,{relatedTarget:0}),mw=cr(g8),m8=wt({},pl,{animationName:0,elapsedTime:0,pseudoElement:0}),y8=cr(m8),w8=wt({},pl,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),b8=cr(w8),v8=wt({},pl,{data:0}),lE=cr(v8),S8={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},x8={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_8={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function k8(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=_8[n])?!!e[n]:!1}function yw(){return k8}var C8=wt({},Ed,{key:function(n){if(n.key){var e=S8[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Ap(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?x8[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yw,charCode:function(n){return n.type==="keypress"?Ap(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Ap(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),E8=cr(C8),P8=wt({},jp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cE=cr(P8),I8=wt({},Ed,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yw}),M8=cr(I8),A8=wt({},pl,{propertyName:0,elapsedTime:0,pseudoElement:0}),T8=cr(A8),j8=wt({},jp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),R8=cr(j8),D8=[9,13,27,32],ww=co&&"CompositionEvent"in window,Id=null;co&&"documentMode"in document&&(Id=document.documentMode);var O8=co&&"TextEvent"in window&&!Id,dE=co&&(!ww||Id&&8<Id&&11>=Id),uE=String.fromCharCode(32),hE=!1;function pE(n,e){switch(n){case"keyup":return D8.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fE(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var fl=!1;function L8(n,e){switch(n){case"compositionend":return fE(e);case"keypress":return e.which!==32?null:(hE=!0,uE);case"textInput":return n=e.data,n===uE&&hE?null:n;default:return null}}function z8(n,e){if(fl)return n==="compositionend"||!ww&&pE(n,e)?(n=oE(),Mp=hw=os=null,fl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return dE&&e.locale!=="ko"?null:e.data;default:return null}}var N8={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gE(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!N8[n.type]:e==="textarea"}function mE(n,e,t,r){LC(r),e=zp(e,"onChange"),0<e.length&&(t=new pw("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Md=null,Ad=null;function F8(n){DE(n,0)}function Rp(n){var e=bl(n);if(kC(e))return n}function $8(n,e){if(n==="change")return e}var yE=!1;if(co){var bw;if(co){var vw="oninput"in document;if(!vw){var wE=document.createElement("div");wE.setAttribute("oninput","return;"),vw=typeof wE.oninput=="function"}bw=vw}else bw=!1;yE=bw&&(!document.documentMode||9<document.documentMode)}function bE(){Md&&(Md.detachEvent("onpropertychange",vE),Ad=Md=null)}function vE(n){if(n.propertyName==="value"&&Rp(Ad)){var e=[];mE(e,Ad,n,Q0(n)),$C(F8,e)}}function B8(n,e,t){n==="focusin"?(bE(),Md=e,Ad=t,Md.attachEvent("onpropertychange",vE)):n==="focusout"&&bE()}function U8(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Rp(Ad)}function V8(n,e){if(n==="click")return Rp(e)}function H8(n,e){if(n==="input"||n==="change")return Rp(e)}function W8(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Zr=typeof Object.is=="function"?Object.is:W8;function Td(n,e){if(Zr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!T0.call(e,i)||!Zr(n[i],e[i]))return!1}return!0}function SE(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function xE(n,e){var t=SE(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=SE(t)}}function _E(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?_E(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function kE(){for(var n=window,e=mp();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=mp(n.document)}return e}function Sw(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function K8(n){var e=kE(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&_E(t.ownerDocument.documentElement,t)){if(r!==null&&Sw(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=xE(t,o);var s=xE(t,r);i&&s&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var G8=co&&"documentMode"in document&&11>=document.documentMode,gl=null,xw=null,jd=null,_w=!1;function CE(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;_w||gl==null||gl!==mp(r)||(r=gl,"selectionStart"in r&&Sw(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),jd&&Td(jd,r)||(jd=r,r=zp(xw,"onSelect"),0<r.length&&(e=new pw("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=gl)))}function Dp(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ml={animationend:Dp("Animation","AnimationEnd"),animationiteration:Dp("Animation","AnimationIteration"),animationstart:Dp("Animation","AnimationStart"),transitionend:Dp("Transition","TransitionEnd")},kw={},EE={};co&&(EE=document.createElement("div").style,"AnimationEvent"in window||(delete ml.animationend.animation,delete ml.animationiteration.animation,delete ml.animationstart.animation),"TransitionEvent"in window||delete ml.transitionend.transition);function Op(n){if(kw[n])return kw[n];if(!ml[n])return n;var e=ml[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in EE)return kw[n]=e[t];return n}var PE=Op("animationend"),IE=Op("animationiteration"),ME=Op("animationstart"),AE=Op("transitionend"),TE=new Map,jE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ss(n,e){TE.set(n,e),ra(e,[n])}for(var Cw=0;Cw<jE.length;Cw++){var Ew=jE[Cw],Y8=Ew.toLowerCase(),X8=Ew[0].toUpperCase()+Ew.slice(1);ss(Y8,"on"+X8)}ss(PE,"onAnimationEnd"),ss(IE,"onAnimationIteration"),ss(ME,"onAnimationStart"),ss("dblclick","onDoubleClick"),ss("focusin","onFocus"),ss("focusout","onBlur"),ss(AE,"onTransitionEnd"),sl("onMouseEnter",["mouseout","mouseover"]),sl("onMouseLeave",["mouseout","mouseover"]),sl("onPointerEnter",["pointerout","pointerover"]),sl("onPointerLeave",["pointerout","pointerover"]),ra("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ra("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ra("onBeforeInput",["compositionend","keypress","textInput","paste"]),ra("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ra("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ra("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),q8=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rd));function RE(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,Yz(r,e,void 0,n),n.currentTarget=null}function DE(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;RE(i,a,c),o=l}else for(s=0;s<r.length;s++){if(a=r[s],l=a.instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;RE(i,a,c),o=l}}}if(bp)throw n=rw,bp=!1,rw=null,n}function ut(n,e){var t=e[Dw];t===void 0&&(t=e[Dw]=new Set);var r=n+"__bubble";t.has(r)||(OE(e,n,2,!1),t.add(r))}function Pw(n,e,t){var r=0;e&&(r|=4),OE(t,n,r,e)}var Lp="_reactListening"+Math.random().toString(36).slice(2);function Dd(n){if(!n[Lp]){n[Lp]=!0,mC.forEach(function(t){t!=="selectionchange"&&(q8.has(t)||Pw(t,!1,n),Pw(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Lp]||(e[Lp]=!0,Pw("selectionchange",!1,e))}}function OE(n,e,t,r){switch(iE(e)){case 1:var i=d8;break;case 4:i=u8;break;default:i=dw}t=i.bind(null,e,t,n),i=void 0,!nw||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Iw(n,e,t,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;s=s.return}for(;a!==null;){if(s=oa(a),s===null)return;if(l=s.tag,l===5||l===6){r=o=s;continue e}a=a.parentNode}}r=r.return}$C(function(){var c=o,d=Q0(t),u=[];e:{var h=TE.get(n);if(h!==void 0){var p=pw,g=n;switch(n){case"keypress":if(Ap(t)===0)break e;case"keydown":case"keyup":p=E8;break;case"focusin":g="focus",p=mw;break;case"focusout":g="blur",p=mw;break;case"beforeblur":case"afterblur":p=mw;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=aE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=f8;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=M8;break;case PE:case IE:case ME:p=y8;break;case AE:p=T8;break;case"scroll":p=h8;break;case"wheel":p=R8;break;case"copy":case"cut":case"paste":p=b8;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=cE}var f=(e&4)!==0,w=!f&&n==="scroll",v=f?h!==null?h+"Capture":null:h;f=[];for(var b=c,_;b!==null;){_=b;var x=_.stateNode;if(_.tag===5&&x!==null&&(_=x,v!==null&&(x=md(b,v),x!=null&&f.push(Od(b,x,_)))),w)break;b=b.return}0<f.length&&(h=new p(h,g,null,t,d),u.push({event:h,listeners:f}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",h&&t!==Z0&&(g=t.relatedTarget||t.fromElement)&&(oa(g)||g[ho]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(g=t.relatedTarget||t.toElement,p=c,g=g?oa(g):null,g!==null&&(w=ia(g),g!==w||g.tag!==5&&g.tag!==6)&&(g=null)):(p=null,g=c),p!==g)){if(f=aE,x="onMouseLeave",v="onMouseEnter",b="mouse",(n==="pointerout"||n==="pointerover")&&(f=cE,x="onPointerLeave",v="onPointerEnter",b="pointer"),w=p==null?h:bl(p),_=g==null?h:bl(g),h=new f(x,b+"leave",p,t,d),h.target=w,h.relatedTarget=_,x=null,oa(d)===c&&(f=new f(v,b+"enter",g,t,d),f.target=_,f.relatedTarget=w,x=f),w=x,p&&g)t:{for(f=p,v=g,b=0,_=f;_;_=yl(_))b++;for(_=0,x=v;x;x=yl(x))_++;for(;0<b-_;)f=yl(f),b--;for(;0<_-b;)v=yl(v),_--;for(;b--;){if(f===v||v!==null&&f===v.alternate)break t;f=yl(f),v=yl(v)}f=null}else f=null;p!==null&&LE(u,h,p,f,!1),g!==null&&w!==null&&LE(u,w,g,f,!0)}}e:{if(h=c?bl(c):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var E=$8;else if(gE(h))if(yE)E=H8;else{E=U8;var k=B8}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(E=V8);if(E&&(E=E(n,c))){mE(u,E,t,d);break e}k&&k(n,h,c),n==="focusout"&&(k=h._wrapperState)&&k.controlled&&h.type==="number"&&G0(h,"number",h.value)}switch(k=c?bl(c):window,n){case"focusin":(gE(k)||k.contentEditable==="true")&&(gl=k,xw=c,jd=null);break;case"focusout":jd=xw=gl=null;break;case"mousedown":_w=!0;break;case"contextmenu":case"mouseup":case"dragend":_w=!1,CE(u,t,d);break;case"selectionchange":if(G8)break;case"keydown":case"keyup":CE(u,t,d)}var P;if(ww)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else fl?pE(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(dE&&t.locale!=="ko"&&(fl||I!=="onCompositionStart"?I==="onCompositionEnd"&&fl&&(P=oE()):(os=d,hw="value"in os?os.value:os.textContent,fl=!0)),k=zp(c,I),0<k.length&&(I=new lE(I,n,null,t,d),u.push({event:I,listeners:k}),P?I.data=P:(P=fE(t),P!==null&&(I.data=P)))),(P=O8?L8(n,t):z8(n,t))&&(c=zp(c,"onBeforeInput"),0<c.length&&(d=new lE("onBeforeInput","beforeinput",null,t,d),u.push({event:d,listeners:c}),d.data=P))}DE(u,e)})}function Od(n,e,t){return{instance:n,listener:e,currentTarget:t}}function zp(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=md(n,t),o!=null&&r.unshift(Od(n,o,i)),o=md(n,e),o!=null&&r.push(Od(n,o,i))),n=n.return}return r}function yl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function LE(n,e,t,r,i){for(var o=e._reactName,s=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=md(t,o),l!=null&&s.unshift(Od(t,l,a))):i||(l=md(t,o),l!=null&&s.push(Od(t,l,a)))),t=t.return}s.length!==0&&n.push({event:e,listeners:s})}var J8=/\r\n?/g,Z8=/\u0000|\uFFFD/g;function zE(n){return(typeof n=="string"?n:""+n).replace(J8,`
`).replace(Z8,"")}function Np(n,e,t){if(e=zE(e),zE(n)!==e&&t)throw Error(Z(425))}function Fp(){}var Mw=null,Aw=null;function Tw(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var jw=typeof setTimeout=="function"?setTimeout:void 0,Q8=typeof clearTimeout=="function"?clearTimeout:void 0,NE=typeof Promise=="function"?Promise:void 0,eN=typeof queueMicrotask=="function"?queueMicrotask:typeof NE<"u"?function(n){return NE.resolve(null).then(n).catch(tN)}:jw;function tN(n){setTimeout(function(){throw n})}function Rw(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Cd(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Cd(e)}function as(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function FE(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var wl=Math.random().toString(36).slice(2),Pi="__reactFiber$"+wl,Ld="__reactProps$"+wl,ho="__reactContainer$"+wl,Dw="__reactEvents$"+wl,nN="__reactListeners$"+wl,rN="__reactHandles$"+wl;function oa(n){var e=n[Pi];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ho]||t[Pi]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=FE(n);n!==null;){if(t=n[Pi])return t;n=FE(n)}return e}n=t,t=n.parentNode}return null}function zd(n){return n=n[Pi]||n[ho],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function bl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Z(33))}function $p(n){return n[Ld]||null}var Ow=[],vl=-1;function ls(n){return{current:n}}function ht(n){0>vl||(n.current=Ow[vl],Ow[vl]=null,vl--)}function it(n,e){vl++,Ow[vl]=n.current,n.current=e}var cs={},fn=ls(cs),Hn=ls(!1),sa=cs;function Sl(n,e){var t=n.type.contextTypes;if(!t)return cs;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in t)i[o]=e[o];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function Wn(n){return n=n.childContextTypes,n!=null}function Bp(){ht(Hn),ht(fn)}function $E(n,e,t){if(fn.current!==cs)throw Error(Z(168));it(fn,e),it(Hn,t)}function BE(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Z(108,Bz(n)||"Unknown",i));return wt({},t,r)}function Up(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||cs,sa=fn.current,it(fn,n),it(Hn,Hn.current),!0}function UE(n,e,t){var r=n.stateNode;if(!r)throw Error(Z(169));t?(n=BE(n,e,sa),r.__reactInternalMemoizedMergedChildContext=n,ht(Hn),ht(fn),it(fn,n)):ht(Hn),it(Hn,t)}var po=null,Vp=!1,Lw=!1;function VE(n){po===null?po=[n]:po.push(n)}function iN(n){Vp=!0,VE(n)}function ds(){if(!Lw&&po!==null){Lw=!0;var n=0,e=Ye;try{var t=po;for(Ye=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}po=null,Vp=!1}catch(i){throw po!==null&&(po=po.slice(n+1)),WC(iw,ds),i}finally{Ye=e,Lw=!1}}return null}var xl=[],_l=0,Hp=null,Wp=0,Tr=[],jr=0,aa=null,fo=1,go="";function la(n,e){xl[_l++]=Wp,xl[_l++]=Hp,Hp=n,Wp=e}function HE(n,e,t){Tr[jr++]=fo,Tr[jr++]=go,Tr[jr++]=aa,aa=n;var r=fo;n=go;var i=32-Jr(r)-1;r&=~(1<<i),t+=1;var o=32-Jr(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,fo=1<<32-Jr(e)+i|t<<i|r,go=o+n}else fo=1<<o|t<<i|r,go=n}function zw(n){n.return!==null&&(la(n,1),HE(n,1,0))}function Nw(n){for(;n===Hp;)Hp=xl[--_l],xl[_l]=null,Wp=xl[--_l],xl[_l]=null;for(;n===aa;)aa=Tr[--jr],Tr[jr]=null,go=Tr[--jr],Tr[jr]=null,fo=Tr[--jr],Tr[jr]=null}var dr=null,ur=null,gt=!1,Qr=null;function WE(n,e){var t=Lr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function KE(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,dr=n,ur=as(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,dr=n,ur=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=aa!==null?{id:fo,overflow:go}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Lr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,dr=n,ur=null,!0):!1;default:return!1}}function Fw(n){return(n.mode&1)!==0&&(n.flags&128)===0}function $w(n){if(gt){var e=ur;if(e){var t=e;if(!KE(n,e)){if(Fw(n))throw Error(Z(418));e=as(t.nextSibling);var r=dr;e&&KE(n,e)?WE(r,t):(n.flags=n.flags&-4097|2,gt=!1,dr=n)}}else{if(Fw(n))throw Error(Z(418));n.flags=n.flags&-4097|2,gt=!1,dr=n}}}function GE(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;dr=n}function Kp(n){if(n!==dr)return!1;if(!gt)return GE(n),gt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Tw(n.type,n.memoizedProps)),e&&(e=ur)){if(Fw(n))throw YE(),Error(Z(418));for(;e;)WE(n,e),e=as(e.nextSibling)}if(GE(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Z(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ur=as(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ur=null}}else ur=dr?as(n.stateNode.nextSibling):null;return!0}function YE(){for(var n=ur;n;)n=as(n.nextSibling)}function kl(){ur=dr=null,gt=!1}function Bw(n){Qr===null?Qr=[n]:Qr.push(n)}var oN=uo.ReactCurrentBatchConfig;function ei(n,e){if(n&&n.defaultProps){e=wt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var Gp=ls(null),Yp=null,Cl=null,Uw=null;function Vw(){Uw=Cl=Yp=null}function Hw(n){var e=Gp.current;ht(Gp),n._currentValue=e}function Ww(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function El(n,e){Yp=n,Uw=Cl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Kn=!0),n.firstContext=null)}function Rr(n){var e=n._currentValue;if(Uw!==n)if(n={context:n,memoizedValue:e,next:null},Cl===null){if(Yp===null)throw Error(Z(308));Cl=n,Yp.dependencies={lanes:0,firstContext:n}}else Cl=Cl.next=n;return e}var ca=null;function Kw(n){ca===null?ca=[n]:ca.push(n)}function XE(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,Kw(e)):(t.next=i.next,i.next=t),e.interleaved=t,mo(n,r)}function mo(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var us=!1;function Gw(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function qE(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function yo(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function hs(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,De&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,mo(n,t)}return i=r.interleaved,i===null?(e.next=e,Kw(r)):(e.next=i.next,i.next=e),r.interleaved=e,mo(n,t)}function Xp(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,aw(n,t)}}function JE(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var s={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?i=o=s:o=o.next=s,t=t.next}while(t!==null);o===null?i=o=e:o=o.next=e}else i=o=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function qp(n,e,t,r){var i=n.updateQueue;us=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,s===null?o=c:s.next=c,s=l;var d=n.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==s&&(a===null?d.firstBaseUpdate=c:a.next=c,d.lastBaseUpdate=l))}if(o!==null){var u=i.baseState;s=0,d=c=l=null,a=o;do{var h=a.lane,p=a.eventTime;if((r&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=n,f=a;switch(h=e,p=t,f.tag){case 1:if(g=f.payload,typeof g=="function"){u=g.call(p,u,h);break e}u=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=f.payload,h=typeof g=="function"?g.call(p,u,h):g,h==null)break e;u=wt({},u,h);break e;case 2:us=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(c=d=p,l=u):d=d.next=p,s|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(1);if(d===null&&(l=u),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=d,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);ha|=s,n.lanes=s,n.memoizedState=u}}function ZE(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Z(191,i));i.call(r)}}}var QE=new gC.Component().refs;function Yw(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:wt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Jp={isMounted:function(n){return(n=n._reactInternals)?ia(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Dn(),i=ms(n),o=yo(r,i);o.payload=e,t!=null&&(o.callback=t),e=hs(n,o,i),e!==null&&(ri(e,n,i,r),Xp(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Dn(),i=ms(n),o=yo(r,i);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=hs(n,o,i),e!==null&&(ri(e,n,i,r),Xp(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Dn(),r=ms(n),i=yo(t,r);i.tag=2,e!=null&&(i.callback=e),e=hs(n,i,r),e!==null&&(ri(e,n,r,t),Xp(e,n,r))}};function e2(n,e,t,r,i,o,s){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!Td(t,r)||!Td(i,o):!0}function t2(n,e,t){var r=!1,i=cs,o=e.contextType;return typeof o=="object"&&o!==null?o=Rr(o):(i=Wn(e)?sa:fn.current,r=e.contextTypes,o=(r=r!=null)?Sl(n,i):cs),e=new e(t,o),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Jp,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=o),e}function n2(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Jp.enqueueReplaceState(e,e.state,null)}function Xw(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs=QE,Gw(n);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Rr(o):(o=Wn(e)?sa:fn.current,i.context=Sl(n,o)),i.state=n.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Yw(n,e,o,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Jp.enqueueReplaceState(i,i.state,null),qp(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Nd(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Z(309));var r=t.stateNode}if(!r)throw Error(Z(147,n));var i=r,o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=i.refs;a===QE&&(a=i.refs={}),s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof n!="string")throw Error(Z(284));if(!t._owner)throw Error(Z(290,n))}return n}function Zp(n,e){throw n=Object.prototype.toString.call(e),Error(Z(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function r2(n){var e=n._init;return e(n._payload)}function i2(n){function e(v,b){if(n){var _=v.deletions;_===null?(v.deletions=[b],v.flags|=16):_.push(b)}}function t(v,b){if(!n)return null;for(;b!==null;)e(v,b),b=b.sibling;return null}function r(v,b){for(v=new Map;b!==null;)b.key!==null?v.set(b.key,b):v.set(b.index,b),b=b.sibling;return v}function i(v,b){return v=ws(v,b),v.index=0,v.sibling=null,v}function o(v,b,_){return v.index=_,n?(_=v.alternate,_!==null?(_=_.index,_<b?(v.flags|=2,b):_):(v.flags|=2,b)):(v.flags|=1048576,b)}function s(v){return n&&v.alternate===null&&(v.flags|=2),v}function a(v,b,_,x){return b===null||b.tag!==6?(b=Tb(_,v.mode,x),b.return=v,b):(b=i(b,_),b.return=v,b)}function l(v,b,_,x){var E=_.type;return E===ll?d(v,b,_.props.children,x,_.key):b!==null&&(b.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Qo&&r2(E)===b.type)?(x=i(b,_.props),x.ref=Nd(v,b,_),x.return=v,x):(x=wf(_.type,_.key,_.props,null,v.mode,x),x.ref=Nd(v,b,_),x.return=v,x)}function c(v,b,_,x){return b===null||b.tag!==4||b.stateNode.containerInfo!==_.containerInfo||b.stateNode.implementation!==_.implementation?(b=jb(_,v.mode,x),b.return=v,b):(b=i(b,_.children||[]),b.return=v,b)}function d(v,b,_,x,E){return b===null||b.tag!==7?(b=ma(_,v.mode,x,E),b.return=v,b):(b=i(b,_),b.return=v,b)}function u(v,b,_){if(typeof b=="string"&&b!==""||typeof b=="number")return b=Tb(""+b,v.mode,_),b.return=v,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case fp:return _=wf(b.type,b.key,b.props,null,v.mode,_),_.ref=Nd(v,null,b),_.return=v,_;case al:return b=jb(b,v.mode,_),b.return=v,b;case Qo:var x=b._init;return u(v,x(b._payload),_)}if(pd(b)||ud(b))return b=ma(b,v.mode,_,null),b.return=v,b;Zp(v,b)}return null}function h(v,b,_,x){var E=b!==null?b.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return E!==null?null:a(v,b,""+_,x);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case fp:return _.key===E?l(v,b,_,x):null;case al:return _.key===E?c(v,b,_,x):null;case Qo:return E=_._init,h(v,b,E(_._payload),x)}if(pd(_)||ud(_))return E!==null?null:d(v,b,_,x,null);Zp(v,_)}return null}function p(v,b,_,x,E){if(typeof x=="string"&&x!==""||typeof x=="number")return v=v.get(_)||null,a(b,v,""+x,E);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case fp:return v=v.get(x.key===null?_:x.key)||null,l(b,v,x,E);case al:return v=v.get(x.key===null?_:x.key)||null,c(b,v,x,E);case Qo:var k=x._init;return p(v,b,_,k(x._payload),E)}if(pd(x)||ud(x))return v=v.get(_)||null,d(b,v,x,E,null);Zp(b,x)}return null}function g(v,b,_,x){for(var E=null,k=null,P=b,I=b=0,A=null;P!==null&&I<_.length;I++){P.index>I?(A=P,P=null):A=P.sibling;var T=h(v,P,_[I],x);if(T===null){P===null&&(P=A);break}n&&P&&T.alternate===null&&e(v,P),b=o(T,b,I),k===null?E=T:k.sibling=T,k=T,P=A}if(I===_.length)return t(v,P),gt&&la(v,I),E;if(P===null){for(;I<_.length;I++)P=u(v,_[I],x),P!==null&&(b=o(P,b,I),k===null?E=P:k.sibling=P,k=P);return gt&&la(v,I),E}for(P=r(v,P);I<_.length;I++)A=p(P,v,I,_[I],x),A!==null&&(n&&A.alternate!==null&&P.delete(A.key===null?I:A.key),b=o(A,b,I),k===null?E=A:k.sibling=A,k=A);return n&&P.forEach(function(O){return e(v,O)}),gt&&la(v,I),E}function f(v,b,_,x){var E=ud(_);if(typeof E!="function")throw Error(Z(150));if(_=E.call(_),_==null)throw Error(Z(151));for(var k=E=null,P=b,I=b=0,A=null,T=_.next();P!==null&&!T.done;I++,T=_.next()){P.index>I?(A=P,P=null):A=P.sibling;var O=h(v,P,T.value,x);if(O===null){P===null&&(P=A);break}n&&P&&O.alternate===null&&e(v,P),b=o(O,b,I),k===null?E=O:k.sibling=O,k=O,P=A}if(T.done)return t(v,P),gt&&la(v,I),E;if(P===null){for(;!T.done;I++,T=_.next())T=u(v,T.value,x),T!==null&&(b=o(T,b,I),k===null?E=T:k.sibling=T,k=T);return gt&&la(v,I),E}for(P=r(v,P);!T.done;I++,T=_.next())T=p(P,v,I,T.value,x),T!==null&&(n&&T.alternate!==null&&P.delete(T.key===null?I:T.key),b=o(T,b,I),k===null?E=T:k.sibling=T,k=T);return n&&P.forEach(function(F){return e(v,F)}),gt&&la(v,I),E}function w(v,b,_,x){if(typeof _=="object"&&_!==null&&_.type===ll&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case fp:e:{for(var E=_.key,k=b;k!==null;){if(k.key===E){if(E=_.type,E===ll){if(k.tag===7){t(v,k.sibling),b=i(k,_.props.children),b.return=v,v=b;break e}}else if(k.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Qo&&r2(E)===k.type){t(v,k.sibling),b=i(k,_.props),b.ref=Nd(v,k,_),b.return=v,v=b;break e}t(v,k);break}else e(v,k);k=k.sibling}_.type===ll?(b=ma(_.props.children,v.mode,x,_.key),b.return=v,v=b):(x=wf(_.type,_.key,_.props,null,v.mode,x),x.ref=Nd(v,b,_),x.return=v,v=x)}return s(v);case al:e:{for(k=_.key;b!==null;){if(b.key===k)if(b.tag===4&&b.stateNode.containerInfo===_.containerInfo&&b.stateNode.implementation===_.implementation){t(v,b.sibling),b=i(b,_.children||[]),b.return=v,v=b;break e}else{t(v,b);break}else e(v,b);b=b.sibling}b=jb(_,v.mode,x),b.return=v,v=b}return s(v);case Qo:return k=_._init,w(v,b,k(_._payload),x)}if(pd(_))return g(v,b,_,x);if(ud(_))return f(v,b,_,x);Zp(v,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,b!==null&&b.tag===6?(t(v,b.sibling),b=i(b,_),b.return=v,v=b):(t(v,b),b=Tb(_,v.mode,x),b.return=v,v=b),s(v)):t(v,b)}return w}var Pl=i2(!0),o2=i2(!1),Fd={},Ii=ls(Fd),$d=ls(Fd),Bd=ls(Fd);function da(n){if(n===Fd)throw Error(Z(174));return n}function qw(n,e){switch(it(Bd,e),it($d,n),it(Ii,Fd),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:X0(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=X0(e,n)}ht(Ii),it(Ii,e)}function Il(){ht(Ii),ht($d),ht(Bd)}function s2(n){da(Bd.current);var e=da(Ii.current),t=X0(e,n.type);e!==t&&(it($d,n),it(Ii,t))}function Jw(n){$d.current===n&&(ht(Ii),ht($d))}var bt=ls(0);function Qp(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Zw=[];function Qw(){for(var n=0;n<Zw.length;n++)Zw[n]._workInProgressVersionPrimary=null;Zw.length=0}var ef=uo.ReactCurrentDispatcher,eb=uo.ReactCurrentBatchConfig,ua=0,vt=null,Ft=null,Vt=null,tf=!1,Ud=!1,Vd=0,sN=0;function gn(){throw Error(Z(321))}function tb(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Zr(n[t],e[t]))return!1;return!0}function nb(n,e,t,r,i,o){if(ua=o,vt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ef.current=n===null||n.memoizedState===null?dN:uN,n=t(r,i),Ud){o=0;do{if(Ud=!1,Vd=0,25<=o)throw Error(Z(301));o+=1,Vt=Ft=null,e.updateQueue=null,ef.current=hN,n=t(r,i)}while(Ud)}if(ef.current=of,e=Ft!==null&&Ft.next!==null,ua=0,Vt=Ft=vt=null,tf=!1,e)throw Error(Z(300));return n}function rb(){var n=Vd!==0;return Vd=0,n}function Mi(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vt===null?vt.memoizedState=Vt=n:Vt=Vt.next=n,Vt}function Dr(){if(Ft===null){var n=vt.alternate;n=n!==null?n.memoizedState:null}else n=Ft.next;var e=Vt===null?vt.memoizedState:Vt.next;if(e!==null)Vt=e,Ft=n;else{if(n===null)throw Error(Z(310));Ft=n,n={memoizedState:Ft.memoizedState,baseState:Ft.baseState,baseQueue:Ft.baseQueue,queue:Ft.queue,next:null},Vt===null?vt.memoizedState=Vt=n:Vt=Vt.next=n}return Vt}function Hd(n,e){return typeof e=="function"?e(n):e}function ib(n){var e=Dr(),t=e.queue;if(t===null)throw Error(Z(311));t.lastRenderedReducer=n;var r=Ft,i=r.baseQueue,o=t.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,t.pending=null}if(i!==null){o=i.next,r=r.baseState;var a=s=null,l=null,c=o;do{var d=c.lane;if((ua&d)===d)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var u={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=u,s=r):l=l.next=u,vt.lanes|=d,ha|=d}c=c.next}while(c!==null&&c!==o);l===null?s=r:l.next=a,Zr(r,e.memoizedState)||(Kn=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do o=i.lane,vt.lanes|=o,ha|=o,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function ob(n){var e=Dr(),t=e.queue;if(t===null)throw Error(Z(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,o=e.memoizedState;if(i!==null){t.pending=null;var s=i=i.next;do o=n(o,s.action),s=s.next;while(s!==i);Zr(o,e.memoizedState)||(Kn=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,r]}function a2(){}function l2(n,e){var t=vt,r=Dr(),i=e(),o=!Zr(r.memoizedState,i);if(o&&(r.memoizedState=i,Kn=!0),r=r.queue,sb(u2.bind(null,t,r,n),[n]),r.getSnapshot!==e||o||Vt!==null&&Vt.memoizedState.tag&1){if(t.flags|=2048,Wd(9,d2.bind(null,t,r,i,e),void 0,null),Ht===null)throw Error(Z(349));ua&30||c2(t,e,i)}return i}function c2(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=vt.updateQueue,e===null?(e={lastEffect:null,stores:null},vt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function d2(n,e,t,r){e.value=t,e.getSnapshot=r,h2(e)&&p2(n)}function u2(n,e,t){return t(function(){h2(e)&&p2(n)})}function h2(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Zr(n,t)}catch{return!0}}function p2(n){var e=mo(n,1);e!==null&&ri(e,n,1,-1)}function f2(n){var e=Mi();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hd,lastRenderedState:n},e.queue=n,n=n.dispatch=cN.bind(null,vt,n),[e.memoizedState,n]}function Wd(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=vt.updateQueue,e===null?(e={lastEffect:null,stores:null},vt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function g2(){return Dr().memoizedState}function nf(n,e,t,r){var i=Mi();vt.flags|=n,i.memoizedState=Wd(1|e,t,void 0,r===void 0?null:r)}function rf(n,e,t,r){var i=Dr();r=r===void 0?null:r;var o=void 0;if(Ft!==null){var s=Ft.memoizedState;if(o=s.destroy,r!==null&&tb(r,s.deps)){i.memoizedState=Wd(e,t,o,r);return}}vt.flags|=n,i.memoizedState=Wd(1|e,t,o,r)}function m2(n,e){return nf(8390656,8,n,e)}function sb(n,e){return rf(2048,8,n,e)}function y2(n,e){return rf(4,2,n,e)}function w2(n,e){return rf(4,4,n,e)}function b2(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function v2(n,e,t){return t=t!=null?t.concat([n]):null,rf(4,4,b2.bind(null,e,n),t)}function ab(){}function S2(n,e){var t=Dr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&tb(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function x2(n,e){var t=Dr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&tb(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function _2(n,e,t){return ua&21?(Zr(t,e)||(t=XC(),vt.lanes|=t,ha|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Kn=!0),n.memoizedState=t)}function aN(n,e){var t=Ye;Ye=t!==0&&4>t?t:4,n(!0);var r=eb.transition;eb.transition={};try{n(!1),e()}finally{Ye=t,eb.transition=r}}function k2(){return Dr().memoizedState}function lN(n,e,t){var r=ms(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},C2(n))E2(e,t);else if(t=XE(n,e,t,r),t!==null){var i=Dn();ri(t,n,r,i),P2(t,e,r)}}function cN(n,e,t){var r=ms(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(C2(n))E2(e,i);else{var o=n.alternate;if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,t);if(i.hasEagerState=!0,i.eagerState=a,Zr(a,s)){var l=e.interleaved;l===null?(i.next=i,Kw(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=XE(n,e,i,r),t!==null&&(i=Dn(),ri(t,n,r,i),P2(t,e,r))}}function C2(n){var e=n.alternate;return n===vt||e!==null&&e===vt}function E2(n,e){Ud=tf=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function P2(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,aw(n,t)}}var of={readContext:Rr,useCallback:gn,useContext:gn,useEffect:gn,useImperativeHandle:gn,useInsertionEffect:gn,useLayoutEffect:gn,useMemo:gn,useReducer:gn,useRef:gn,useState:gn,useDebugValue:gn,useDeferredValue:gn,useTransition:gn,useMutableSource:gn,useSyncExternalStore:gn,useId:gn,unstable_isNewReconciler:!1},dN={readContext:Rr,useCallback:function(n,e){return Mi().memoizedState=[n,e===void 0?null:e],n},useContext:Rr,useEffect:m2,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,nf(4194308,4,b2.bind(null,e,n),t)},useLayoutEffect:function(n,e){return nf(4194308,4,n,e)},useInsertionEffect:function(n,e){return nf(4,2,n,e)},useMemo:function(n,e){var t=Mi();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Mi();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=lN.bind(null,vt,n),[r.memoizedState,n]},useRef:function(n){var e=Mi();return n={current:n},e.memoizedState=n},useState:f2,useDebugValue:ab,useDeferredValue:function(n){return Mi().memoizedState=n},useTransition:function(){var n=f2(!1),e=n[0];return n=aN.bind(null,n[1]),Mi().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=vt,i=Mi();if(gt){if(t===void 0)throw Error(Z(407));t=t()}else{if(t=e(),Ht===null)throw Error(Z(349));ua&30||c2(r,e,t)}i.memoizedState=t;var o={value:t,getSnapshot:e};return i.queue=o,m2(u2.bind(null,r,o,n),[n]),r.flags|=2048,Wd(9,d2.bind(null,r,o,t,e),void 0,null),t},useId:function(){var n=Mi(),e=Ht.identifierPrefix;if(gt){var t=go,r=fo;t=(r&~(1<<32-Jr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Vd++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=sN++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},uN={readContext:Rr,useCallback:S2,useContext:Rr,useEffect:sb,useImperativeHandle:v2,useInsertionEffect:y2,useLayoutEffect:w2,useMemo:x2,useReducer:ib,useRef:g2,useState:function(){return ib(Hd)},useDebugValue:ab,useDeferredValue:function(n){var e=Dr();return _2(e,Ft.memoizedState,n)},useTransition:function(){var n=ib(Hd)[0],e=Dr().memoizedState;return[n,e]},useMutableSource:a2,useSyncExternalStore:l2,useId:k2,unstable_isNewReconciler:!1},hN={readContext:Rr,useCallback:S2,useContext:Rr,useEffect:sb,useImperativeHandle:v2,useInsertionEffect:y2,useLayoutEffect:w2,useMemo:x2,useReducer:ob,useRef:g2,useState:function(){return ob(Hd)},useDebugValue:ab,useDeferredValue:function(n){var e=Dr();return Ft===null?e.memoizedState=n:_2(e,Ft.memoizedState,n)},useTransition:function(){var n=ob(Hd)[0],e=Dr().memoizedState;return[n,e]},useMutableSource:a2,useSyncExternalStore:l2,useId:k2,unstable_isNewReconciler:!1};function Ml(n,e){try{var t="",r=e;do t+=$z(r),r=r.return;while(r);var i=t}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:n,source:e,stack:i,digest:null}}function lb(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function cb(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var pN=typeof WeakMap=="function"?WeakMap:Map;function I2(n,e,t){t=yo(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){hf||(hf=!0,_b=r),cb(n,e)},t}function M2(n,e,t){t=yo(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){cb(n,e)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){cb(n,e),typeof r!="function"&&(fs===null?fs=new Set([this]):fs.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),t}function A2(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new pN;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=PN.bind(null,n,e,t),e.then(n,n))}function T2(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function j2(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=yo(-1,1),e.tag=2,hs(t,e,1))),t.lanes|=1),n)}var fN=uo.ReactCurrentOwner,Kn=!1;function Rn(n,e,t,r){e.child=n===null?o2(e,null,t,r):Pl(e,n.child,t,r)}function R2(n,e,t,r,i){t=t.render;var o=e.ref;return El(e,i),r=nb(n,e,t,r,o,i),t=rb(),n!==null&&!Kn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,wo(n,e,i)):(gt&&t&&zw(e),e.flags|=1,Rn(n,e,r,i),e.child)}function D2(n,e,t,r,i){if(n===null){var o=t.type;return typeof o=="function"&&!Ab(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,O2(n,e,o,r,i)):(n=wf(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(o=n.child,!(n.lanes&i)){var s=o.memoizedProps;if(t=t.compare,t=t!==null?t:Td,t(s,r)&&n.ref===e.ref)return wo(n,e,i)}return e.flags|=1,n=ws(o,r),n.ref=e.ref,n.return=e,e.child=n}function O2(n,e,t,r,i){if(n!==null){var o=n.memoizedProps;if(Td(o,r)&&n.ref===e.ref)if(Kn=!1,e.pendingProps=r=o,(n.lanes&i)!==0)n.flags&131072&&(Kn=!0);else return e.lanes=n.lanes,wo(n,e,i)}return db(n,e,t,r,i)}function L2(n,e,t){var r=e.pendingProps,i=r.children,o=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},it(Tl,hr),hr|=t;else{if(!(t&1073741824))return n=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,it(Tl,hr),hr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:t,it(Tl,hr),hr|=r}else o!==null?(r=o.baseLanes|t,e.memoizedState=null):r=t,it(Tl,hr),hr|=r;return Rn(n,e,i,t),e.child}function z2(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function db(n,e,t,r,i){var o=Wn(t)?sa:fn.current;return o=Sl(e,o),El(e,i),t=nb(n,e,t,r,o,i),r=rb(),n!==null&&!Kn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,wo(n,e,i)):(gt&&r&&zw(e),e.flags|=1,Rn(n,e,t,i),e.child)}function N2(n,e,t,r,i){if(Wn(t)){var o=!0;Up(e)}else o=!1;if(El(e,i),e.stateNode===null)af(n,e),t2(e,t,r),Xw(e,t,r,i),r=!0;else if(n===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var l=s.context,c=t.contextType;typeof c=="object"&&c!==null?c=Rr(c):(c=Wn(t)?sa:fn.current,c=Sl(e,c));var d=t.getDerivedStateFromProps,u=typeof d=="function"||typeof s.getSnapshotBeforeUpdate=="function";u||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||l!==c)&&n2(e,s,r,c),us=!1;var h=e.memoizedState;s.state=h,qp(e,r,s,i),l=e.memoizedState,a!==r||h!==l||Hn.current||us?(typeof d=="function"&&(Yw(e,t,d,r),l=e.memoizedState),(a=us||e2(e,t,a,r,h,l,c))?(u||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,qE(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:ei(e.type,a),s.props=c,u=e.pendingProps,h=s.context,l=t.contextType,typeof l=="object"&&l!==null?l=Rr(l):(l=Wn(t)?sa:fn.current,l=Sl(e,l));var p=t.getDerivedStateFromProps;(d=typeof p=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==u||h!==l)&&n2(e,s,r,l),us=!1,h=e.memoizedState,s.state=h,qp(e,r,s,i);var g=e.memoizedState;a!==u||h!==g||Hn.current||us?(typeof p=="function"&&(Yw(e,t,p,r),g=e.memoizedState),(c=us||e2(e,t,c,r,h,g,l)||!1)?(d||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,g,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,g,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),s.props=r,s.state=g,s.context=l,r=c):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),r=!1)}return ub(n,e,t,r,o,i)}function ub(n,e,t,r,i,o){z2(n,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&UE(e,t,!1),wo(n,e,o);r=e.stateNode,fN.current=e;var a=s&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&s?(e.child=Pl(e,n.child,null,o),e.child=Pl(e,null,a,o)):Rn(n,e,a,o),e.memoizedState=r.state,i&&UE(e,t,!0),e.child}function F2(n){var e=n.stateNode;e.pendingContext?$E(n,e.pendingContext,e.pendingContext!==e.context):e.context&&$E(n,e.context,!1),qw(n,e.containerInfo)}function $2(n,e,t,r,i){return kl(),Bw(i),e.flags|=256,Rn(n,e,t,r),e.child}var hb={dehydrated:null,treeContext:null,retryLane:0};function pb(n){return{baseLanes:n,cachePool:null,transitions:null}}function B2(n,e,t){var r=e.pendingProps,i=bt.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(o=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),it(bt,i&1),n===null)return $w(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,n=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=bf(s,r,0,null),n=ma(n,r,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,e.child.memoizedState=pb(t),e.memoizedState=hb,n):fb(e,s));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return gN(n,e,s,r,a,i,t);if(o){o=r.fallback,s=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=ws(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=ws(a,o):(o=ma(o,s,t,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=n.child.memoizedState,s=s===null?pb(t):{baseLanes:s.baseLanes|t,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=n.childLanes&~t,e.memoizedState=hb,r}return o=n.child,n=o.sibling,r=ws(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function fb(n,e){return e=bf({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function sf(n,e,t,r){return r!==null&&Bw(r),Pl(e,n.child,null,t),n=fb(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function gN(n,e,t,r,i,o,s){if(t)return e.flags&256?(e.flags&=-257,r=lb(Error(Z(422))),sf(n,e,s,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=bf({mode:"visible",children:r.children},i,0,null),o=ma(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&Pl(e,n.child,null,s),e.child.memoizedState=pb(s),e.memoizedState=hb,o);if(!(e.mode&1))return sf(n,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(Z(419)),r=lb(o,r,void 0),sf(n,e,s,r)}if(a=(s&n.childLanes)!==0,Kn||a){if(r=Ht,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,mo(n,i),ri(r,n,i,-1))}return Mb(),r=lb(Error(Z(421))),sf(n,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=IN.bind(null,n),i._reactRetry=e,null):(n=o.treeContext,ur=as(i.nextSibling),dr=e,gt=!0,Qr=null,n!==null&&(Tr[jr++]=fo,Tr[jr++]=go,Tr[jr++]=aa,fo=n.id,go=n.overflow,aa=e),e=fb(e,r.children),e.flags|=4096,e)}function U2(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Ww(n.return,e,t)}function gb(n,e,t,r,i){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function V2(n,e,t){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Rn(n,e,r.children,t),r=bt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&U2(n,t,e);else if(n.tag===19)U2(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(it(bt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Qp(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),gb(e,!1,i,t,o);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Qp(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}gb(e,!0,t,null,o);break;case"together":gb(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function af(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function wo(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ha|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Z(153));if(e.child!==null){for(n=e.child,t=ws(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=ws(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function mN(n,e,t){switch(e.tag){case 3:F2(e),kl();break;case 5:s2(e);break;case 1:Wn(e.type)&&Up(e);break;case 4:qw(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;it(Gp,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(it(bt,bt.current&1),e.flags|=128,null):t&e.child.childLanes?B2(n,e,t):(it(bt,bt.current&1),n=wo(n,e,t),n!==null?n.sibling:null);it(bt,bt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return V2(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),it(bt,bt.current),r)break;return null;case 22:case 23:return e.lanes=0,L2(n,e,t)}return wo(n,e,t)}var H2,mb,W2,K2;H2=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},mb=function(){},W2=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,da(Ii.current);var o=null;switch(t){case"input":i=W0(n,i),r=W0(n,r),o=[];break;case"select":i=wt({},i,{value:void 0}),r=wt({},r,{value:void 0}),o=[];break;case"textarea":i=Y0(n,i),r=Y0(n,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Fp)}q0(t,r);var s;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(s in a)a.hasOwnProperty(s)&&(t||(t={}),t[s]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(dd.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var l=r[c];if(a=i==null?void 0:i[c],r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(s in a)!a.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(t||(t={}),t[s]="");for(s in l)l.hasOwnProperty(s)&&a[s]!==l[s]&&(t||(t={}),t[s]=l[s])}else t||(o||(o=[]),o.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(dd.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ut("scroll",n),o||a===l||(o=[])):(o=o||[]).push(c,l))}t&&(o=o||[]).push("style",t);var c=o;(e.updateQueue=c)&&(e.flags|=4)}},K2=function(n,e,t,r){t!==r&&(e.flags|=4)};function Kd(n,e){if(!gt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function mn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function yN(n,e,t){var r=e.pendingProps;switch(Nw(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mn(e),null;case 1:return Wn(e.type)&&Bp(),mn(e),null;case 3:return r=e.stateNode,Il(),ht(Hn),ht(fn),Qw(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Kp(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Qr!==null&&(Eb(Qr),Qr=null))),mb(n,e),mn(e),null;case 5:Jw(e);var i=da(Bd.current);if(t=e.type,n!==null&&e.stateNode!=null)W2(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Z(166));return mn(e),null}if(n=da(Ii.current),Kp(e)){r=e.stateNode,t=e.type;var o=e.memoizedProps;switch(r[Pi]=e,r[Ld]=o,n=(e.mode&1)!==0,t){case"dialog":ut("cancel",r),ut("close",r);break;case"iframe":case"object":case"embed":ut("load",r);break;case"video":case"audio":for(i=0;i<Rd.length;i++)ut(Rd[i],r);break;case"source":ut("error",r);break;case"img":case"image":case"link":ut("error",r),ut("load",r);break;case"details":ut("toggle",r);break;case"input":CC(r,o),ut("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},ut("invalid",r);break;case"textarea":IC(r,o),ut("invalid",r)}q0(t,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&Np(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&Np(r.textContent,a,n),i=["children",""+a]):dd.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&ut("scroll",r)}switch(t){case"input":gp(r),PC(r,o,!0);break;case"textarea":gp(r),AC(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Fp)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=TC(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=s.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=s.createElement(t,{is:r.is}):(n=s.createElement(t),t==="select"&&(s=n,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):n=s.createElementNS(n,t),n[Pi]=e,n[Ld]=r,H2(n,e,!1,!1),e.stateNode=n;e:{switch(s=J0(t,r),t){case"dialog":ut("cancel",n),ut("close",n),i=r;break;case"iframe":case"object":case"embed":ut("load",n),i=r;break;case"video":case"audio":for(i=0;i<Rd.length;i++)ut(Rd[i],n);i=r;break;case"source":ut("error",n),i=r;break;case"img":case"image":case"link":ut("error",n),ut("load",n),i=r;break;case"details":ut("toggle",n),i=r;break;case"input":CC(n,r),i=W0(n,r),ut("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=wt({},r,{value:void 0}),ut("invalid",n);break;case"textarea":IC(n,r),i=Y0(n,r),ut("invalid",n);break;default:i=r}q0(t,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?DC(n,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&jC(n,l)):o==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&fd(n,l):typeof l=="number"&&fd(n,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(dd.hasOwnProperty(o)?l!=null&&o==="onScroll"&&ut("scroll",n):l!=null&&D0(n,o,l,s))}switch(t){case"input":gp(n),PC(n,r,!1);break;case"textarea":gp(n),AC(n);break;case"option":r.value!=null&&n.setAttribute("value",""+es(r.value));break;case"select":n.multiple=!!r.multiple,o=r.value,o!=null?cl(n,!!r.multiple,o,!1):r.defaultValue!=null&&cl(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Fp)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return mn(e),null;case 6:if(n&&e.stateNode!=null)K2(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Z(166));if(t=da(Bd.current),da(Ii.current),Kp(e)){if(r=e.stateNode,t=e.memoizedProps,r[Pi]=e,(o=r.nodeValue!==t)&&(n=dr,n!==null))switch(n.tag){case 3:Np(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Np(r.nodeValue,t,(n.mode&1)!==0)}o&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Pi]=e,e.stateNode=r}return mn(e),null;case 13:if(ht(bt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(gt&&ur!==null&&e.mode&1&&!(e.flags&128))YE(),kl(),e.flags|=98560,o=!1;else if(o=Kp(e),r!==null&&r.dehydrated!==null){if(n===null){if(!o)throw Error(Z(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Z(317));o[Pi]=e}else kl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;mn(e),o=!1}else Qr!==null&&(Eb(Qr),Qr=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||bt.current&1?$t===0&&($t=3):Mb())),e.updateQueue!==null&&(e.flags|=4),mn(e),null);case 4:return Il(),mb(n,e),n===null&&Dd(e.stateNode.containerInfo),mn(e),null;case 10:return Hw(e.type._context),mn(e),null;case 17:return Wn(e.type)&&Bp(),mn(e),null;case 19:if(ht(bt),o=e.memoizedState,o===null)return mn(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)Kd(o,!1);else{if($t!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(s=Qp(n),s!==null){for(e.flags|=128,Kd(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)o=t,n=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=n,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,n=s.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return it(bt,bt.current&1|2),e.child}n=n.sibling}o.tail!==null&&Rt()>jl&&(e.flags|=128,r=!0,Kd(o,!1),e.lanes=4194304)}else{if(!r)if(n=Qp(s),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Kd(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!gt)return mn(e),null}else 2*Rt()-o.renderingStartTime>jl&&t!==1073741824&&(e.flags|=128,r=!0,Kd(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(t=o.last,t!==null?t.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Rt(),e.sibling=null,t=bt.current,it(bt,r?t&1|2:t&1),e):(mn(e),null);case 22:case 23:return Ib(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?hr&1073741824&&(mn(e),e.subtreeFlags&6&&(e.flags|=8192)):mn(e),null;case 24:return null;case 25:return null}throw Error(Z(156,e.tag))}function wN(n,e){switch(Nw(e),e.tag){case 1:return Wn(e.type)&&Bp(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Il(),ht(Hn),ht(fn),Qw(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Jw(e),null;case 13:if(ht(bt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Z(340));kl()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return ht(bt),null;case 4:return Il(),null;case 10:return Hw(e.type._context),null;case 22:case 23:return Ib(),null;case 24:return null;default:return null}}var lf=!1,yn=!1,bN=typeof WeakSet=="function"?WeakSet:Set,ie=null;function Al(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Et(n,e,r)}else t.current=null}function G2(n,e,t){try{t()}catch(r){Et(n,e,r)}}var Y2=!1;function vN(n,e){if(Mw=Pp,n=kE(),Sw(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var s=0,a=-1,l=-1,c=0,d=0,u=n,h=null;t:for(;;){for(var p;u!==t||i!==0&&u.nodeType!==3||(a=s+i),u!==o||r!==0&&u.nodeType!==3||(l=s+r),u.nodeType===3&&(s+=u.nodeValue.length),(p=u.firstChild)!==null;)h=u,u=p;for(;;){if(u===n)break t;if(h===t&&++c===i&&(a=s),h===o&&++d===r&&(l=s),(p=u.nextSibling)!==null)break;u=h,h=u.parentNode}u=p}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Aw={focusedElem:n,selectionRange:t},Pp=!1,ie=e;ie!==null;)if(e=ie,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ie=n;else for(;ie!==null;){e=ie;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var f=g.memoizedProps,w=g.memoizedState,v=e.stateNode,b=v.getSnapshotBeforeUpdate(e.elementType===e.type?f:ei(e.type,f),w);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Z(163))}}catch(x){Et(e,e.return,x)}if(n=e.sibling,n!==null){n.return=e.return,ie=n;break}ie=e.return}return g=Y2,Y2=!1,g}function Gd(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var o=i.destroy;i.destroy=void 0,o!==void 0&&G2(e,t,o)}i=i.next}while(i!==r)}}function cf(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function yb(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function X2(n){var e=n.alternate;e!==null&&(n.alternate=null,X2(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Pi],delete e[Ld],delete e[Dw],delete e[nN],delete e[rN])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function q2(n){return n.tag===5||n.tag===3||n.tag===4}function J2(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||q2(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function wb(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Fp));else if(r!==4&&(n=n.child,n!==null))for(wb(n,e,t),n=n.sibling;n!==null;)wb(n,e,t),n=n.sibling}function bb(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(bb(n,e,t),n=n.sibling;n!==null;)bb(n,e,t),n=n.sibling}var en=null,ti=!1;function ps(n,e,t){for(t=t.child;t!==null;)Z2(n,e,t),t=t.sibling}function Z2(n,e,t){if(Ei&&typeof Ei.onCommitFiberUnmount=="function")try{Ei.onCommitFiberUnmount(Sp,t)}catch{}switch(t.tag){case 5:yn||Al(t,e);case 6:var r=en,i=ti;en=null,ps(n,e,t),en=r,ti=i,en!==null&&(ti?(n=en,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):en.removeChild(t.stateNode));break;case 18:en!==null&&(ti?(n=en,t=t.stateNode,n.nodeType===8?Rw(n.parentNode,t):n.nodeType===1&&Rw(n,t),Cd(n)):Rw(en,t.stateNode));break;case 4:r=en,i=ti,en=t.stateNode.containerInfo,ti=!0,ps(n,e,t),en=r,ti=i;break;case 0:case 11:case 14:case 15:if(!yn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&G2(t,e,s),i=i.next}while(i!==r)}ps(n,e,t);break;case 1:if(!yn&&(Al(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Et(t,e,a)}ps(n,e,t);break;case 21:ps(n,e,t);break;case 22:t.mode&1?(yn=(r=yn)||t.memoizedState!==null,ps(n,e,t),yn=r):ps(n,e,t);break;default:ps(n,e,t)}}function Q2(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new bN),e.forEach(function(r){var i=MN.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function ni(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var o=n,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:en=a.stateNode,ti=!1;break e;case 3:en=a.stateNode.containerInfo,ti=!0;break e;case 4:en=a.stateNode.containerInfo,ti=!0;break e}a=a.return}if(en===null)throw Error(Z(160));Z2(o,s,i),en=null,ti=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){Et(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)eP(e,n),e=e.sibling}function eP(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ni(e,n),Ai(n),r&4){try{Gd(3,n,n.return),cf(3,n)}catch(f){Et(n,n.return,f)}try{Gd(5,n,n.return)}catch(f){Et(n,n.return,f)}}break;case 1:ni(e,n),Ai(n),r&512&&t!==null&&Al(t,t.return);break;case 5:if(ni(e,n),Ai(n),r&512&&t!==null&&Al(t,t.return),n.flags&32){var i=n.stateNode;try{fd(i,"")}catch(f){Et(n,n.return,f)}}if(r&4&&(i=n.stateNode,i!=null)){var o=n.memoizedProps,s=t!==null?t.memoizedProps:o,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&EC(i,o),J0(a,s);var c=J0(a,o);for(s=0;s<l.length;s+=2){var d=l[s],u=l[s+1];d==="style"?DC(i,u):d==="dangerouslySetInnerHTML"?jC(i,u):d==="children"?fd(i,u):D0(i,d,u,c)}switch(a){case"input":K0(i,o);break;case"textarea":MC(i,o);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?cl(i,!!o.multiple,p,!1):h!==!!o.multiple&&(o.defaultValue!=null?cl(i,!!o.multiple,o.defaultValue,!0):cl(i,!!o.multiple,o.multiple?[]:"",!1))}i[Ld]=o}catch(f){Et(n,n.return,f)}}break;case 6:if(ni(e,n),Ai(n),r&4){if(n.stateNode===null)throw Error(Z(162));i=n.stateNode,o=n.memoizedProps;try{i.nodeValue=o}catch(f){Et(n,n.return,f)}}break;case 3:if(ni(e,n),Ai(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Cd(e.containerInfo)}catch(f){Et(n,n.return,f)}break;case 4:ni(e,n),Ai(n);break;case 13:ni(e,n),Ai(n),i=n.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(xb=Rt())),r&4&&Q2(n);break;case 22:if(d=t!==null&&t.memoizedState!==null,n.mode&1?(yn=(c=yn)||d,ni(e,n),yn=c):ni(e,n),Ai(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!d&&n.mode&1)for(ie=n,d=n.child;d!==null;){for(u=ie=d;ie!==null;){switch(h=ie,p=h.child,h.tag){case 0:case 11:case 14:case 15:Gd(4,h,h.return);break;case 1:Al(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){r=h,t=h.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(f){Et(r,t,f)}}break;case 5:Al(h,h.return);break;case 22:if(h.memoizedState!==null){rP(u);continue}}p!==null?(p.return=h,ie=p):rP(u)}d=d.sibling}e:for(d=null,u=n;;){if(u.tag===5){if(d===null){d=u;try{i=u.stateNode,c?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=u.stateNode,l=u.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=RC("display",s))}catch(f){Et(n,n.return,f)}}}else if(u.tag===6){if(d===null)try{u.stateNode.nodeValue=c?"":u.memoizedProps}catch(f){Et(n,n.return,f)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===n)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===n)break e;for(;u.sibling===null;){if(u.return===null||u.return===n)break e;d===u&&(d=null),u=u.return}d===u&&(d=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:ni(e,n),Ai(n),r&4&&Q2(n);break;case 21:break;default:ni(e,n),Ai(n)}}function Ai(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(q2(t)){var r=t;break e}t=t.return}throw Error(Z(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(fd(i,""),r.flags&=-33);var o=J2(n);bb(n,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,a=J2(n);wb(n,a,s);break;default:throw Error(Z(161))}}catch(l){Et(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function SN(n,e,t){ie=n,tP(n)}function tP(n,e,t){for(var r=(n.mode&1)!==0;ie!==null;){var i=ie,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||lf;if(!s){var a=i.alternate,l=a!==null&&a.memoizedState!==null||yn;a=lf;var c=yn;if(lf=s,(yn=l)&&!c)for(ie=i;ie!==null;)s=ie,l=s.child,s.tag===22&&s.memoizedState!==null?iP(i):l!==null?(l.return=s,ie=l):iP(i);for(;o!==null;)ie=o,tP(o),o=o.sibling;ie=i,lf=a,yn=c}nP(n)}else i.subtreeFlags&8772&&o!==null?(o.return=i,ie=o):nP(n)}}function nP(n){for(;ie!==null;){var e=ie;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:yn||cf(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!yn)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:ei(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&ZE(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}ZE(e,s,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var d=c.memoizedState;if(d!==null){var u=d.dehydrated;u!==null&&Cd(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Z(163))}yn||e.flags&512&&yb(e)}catch(h){Et(e,e.return,h)}}if(e===n){ie=null;break}if(t=e.sibling,t!==null){t.return=e.return,ie=t;break}ie=e.return}}function rP(n){for(;ie!==null;){var e=ie;if(e===n){ie=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ie=t;break}ie=e.return}}function iP(n){for(;ie!==null;){var e=ie;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{cf(4,e)}catch(l){Et(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){Et(e,i,l)}}var o=e.return;try{yb(e)}catch(l){Et(e,o,l)}break;case 5:var s=e.return;try{yb(e)}catch(l){Et(e,s,l)}}}catch(l){Et(e,e.return,l)}if(e===n){ie=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ie=a;break}ie=e.return}}var xN=Math.ceil,df=uo.ReactCurrentDispatcher,vb=uo.ReactCurrentOwner,Or=uo.ReactCurrentBatchConfig,De=0,Ht=null,Ot=null,tn=0,hr=0,Tl=ls(0),$t=0,Yd=null,ha=0,uf=0,Sb=0,Xd=null,Gn=null,xb=0,jl=1/0,bo=null,hf=!1,_b=null,fs=null,pf=!1,gs=null,ff=0,qd=0,kb=null,gf=-1,mf=0;function Dn(){return De&6?Rt():gf!==-1?gf:gf=Rt()}function ms(n){return n.mode&1?De&2&&tn!==0?tn&-tn:oN.transition!==null?(mf===0&&(mf=XC()),mf):(n=Ye,n!==0||(n=window.event,n=n===void 0?16:iE(n.type)),n):1}function ri(n,e,t,r){if(50<qd)throw qd=0,kb=null,Error(Z(185));vd(n,t,r),(!(De&2)||n!==Ht)&&(n===Ht&&(!(De&2)&&(uf|=t),$t===4&&ys(n,tn)),Yn(n,r),t===1&&De===0&&!(e.mode&1)&&(jl=Rt()+500,Vp&&ds()))}function Yn(n,e){var t=n.callbackNode;o8(n,e);var r=kp(n,n===Ht?tn:0);if(r===0)t!==null&&KC(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&KC(t),e===1)n.tag===0?iN(sP.bind(null,n)):VE(sP.bind(null,n)),eN(function(){!(De&6)&&ds()}),t=null;else{switch(qC(r)){case 1:t=iw;break;case 4:t=GC;break;case 16:t=vp;break;case 536870912:t=YC;break;default:t=vp}t=fP(t,oP.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function oP(n,e){if(gf=-1,mf=0,De&6)throw Error(Z(327));var t=n.callbackNode;if(Rl()&&n.callbackNode!==t)return null;var r=kp(n,n===Ht?tn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=yf(n,r);else{e=r;var i=De;De|=2;var o=lP();(Ht!==n||tn!==e)&&(bo=null,jl=Rt()+500,fa(n,e));do try{CN();break}catch(a){aP(n,a)}while(1);Vw(),df.current=o,De=i,Ot!==null?e=0:(Ht=null,tn=0,e=$t)}if(e!==0){if(e===2&&(i=ow(n),i!==0&&(r=i,e=Cb(n,i))),e===1)throw t=Yd,fa(n,0),ys(n,r),Yn(n,Rt()),t;if(e===6)ys(n,r);else{if(i=n.current.alternate,!(r&30)&&!_N(i)&&(e=yf(n,r),e===2&&(o=ow(n),o!==0&&(r=o,e=Cb(n,o))),e===1))throw t=Yd,fa(n,0),ys(n,r),Yn(n,Rt()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(Z(345));case 2:ga(n,Gn,bo);break;case 3:if(ys(n,r),(r&130023424)===r&&(e=xb+500-Rt(),10<e)){if(kp(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Dn(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=jw(ga.bind(null,n,Gn,bo),e);break}ga(n,Gn,bo);break;case 4:if(ys(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var s=31-Jr(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=Rt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*xN(r/1960))-r,10<r){n.timeoutHandle=jw(ga.bind(null,n,Gn,bo),r);break}ga(n,Gn,bo);break;case 5:ga(n,Gn,bo);break;default:throw Error(Z(329))}}}return Yn(n,Rt()),n.callbackNode===t?oP.bind(null,n):null}function Cb(n,e){var t=Xd;return n.current.memoizedState.isDehydrated&&(fa(n,e).flags|=256),n=yf(n,e),n!==2&&(e=Gn,Gn=t,e!==null&&Eb(e)),n}function Eb(n){Gn===null?Gn=n:Gn.push.apply(Gn,n)}function _N(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!Zr(o(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ys(n,e){for(e&=~Sb,e&=~uf,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Jr(e),r=1<<t;n[t]=-1,e&=~r}}function sP(n){if(De&6)throw Error(Z(327));Rl();var e=kp(n,0);if(!(e&1))return Yn(n,Rt()),null;var t=yf(n,e);if(n.tag!==0&&t===2){var r=ow(n);r!==0&&(e=r,t=Cb(n,r))}if(t===1)throw t=Yd,fa(n,0),ys(n,e),Yn(n,Rt()),t;if(t===6)throw Error(Z(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ga(n,Gn,bo),Yn(n,Rt()),null}function Pb(n,e){var t=De;De|=1;try{return n(e)}finally{De=t,De===0&&(jl=Rt()+500,Vp&&ds())}}function pa(n){gs!==null&&gs.tag===0&&!(De&6)&&Rl();var e=De;De|=1;var t=Or.transition,r=Ye;try{if(Or.transition=null,Ye=1,n)return n()}finally{Ye=r,Or.transition=t,De=e,!(De&6)&&ds()}}function Ib(){hr=Tl.current,ht(Tl)}function fa(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,Q8(t)),Ot!==null)for(t=Ot.return;t!==null;){var r=t;switch(Nw(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Bp();break;case 3:Il(),ht(Hn),ht(fn),Qw();break;case 5:Jw(r);break;case 4:Il();break;case 13:ht(bt);break;case 19:ht(bt);break;case 10:Hw(r.type._context);break;case 22:case 23:Ib()}t=t.return}if(Ht=n,Ot=n=ws(n.current,null),tn=hr=e,$t=0,Yd=null,Sb=uf=ha=0,Gn=Xd=null,ca!==null){for(e=0;e<ca.length;e++)if(t=ca[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,o=t.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}t.pending=r}ca=null}return n}function aP(n,e){do{var t=Ot;try{if(Vw(),ef.current=of,tf){for(var r=vt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}tf=!1}if(ua=0,Vt=Ft=vt=null,Ud=!1,Vd=0,vb.current=null,t===null||t.return===null){$t=1,Yd=e,Ot=null;break}e:{var o=n,s=t.return,a=t,l=e;if(e=tn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,d=a,u=d.tag;if(!(d.mode&1)&&(u===0||u===11||u===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=T2(s);if(p!==null){p.flags&=-257,j2(p,s,a,o,e),p.mode&1&&A2(o,c,e),e=p,l=c;var g=e.updateQueue;if(g===null){var f=new Set;f.add(l),e.updateQueue=f}else g.add(l);break e}else{if(!(e&1)){A2(o,c,e),Mb();break e}l=Error(Z(426))}}else if(gt&&a.mode&1){var w=T2(s);if(w!==null){!(w.flags&65536)&&(w.flags|=256),j2(w,s,a,o,e),Bw(Ml(l,a));break e}}o=l=Ml(l,a),$t!==4&&($t=2),Xd===null?Xd=[o]:Xd.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var v=I2(o,l,e);JE(o,v);break e;case 1:a=l;var b=o.type,_=o.stateNode;if(!(o.flags&128)&&(typeof b.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(fs===null||!fs.has(_)))){o.flags|=65536,e&=-e,o.lanes|=e;var x=M2(o,a,e);JE(o,x);break e}}o=o.return}while(o!==null)}dP(t)}catch(E){e=E,Ot===t&&t!==null&&(Ot=t=t.return);continue}break}while(1)}function lP(){var n=df.current;return df.current=of,n===null?of:n}function Mb(){($t===0||$t===3||$t===2)&&($t=4),Ht===null||!(ha&268435455)&&!(uf&268435455)||ys(Ht,tn)}function yf(n,e){var t=De;De|=2;var r=lP();(Ht!==n||tn!==e)&&(bo=null,fa(n,e));do try{kN();break}catch(i){aP(n,i)}while(1);if(Vw(),De=t,df.current=r,Ot!==null)throw Error(Z(261));return Ht=null,tn=0,$t}function kN(){for(;Ot!==null;)cP(Ot)}function CN(){for(;Ot!==null&&!qz();)cP(Ot)}function cP(n){var e=pP(n.alternate,n,hr);n.memoizedProps=n.pendingProps,e===null?dP(n):Ot=e,vb.current=null}function dP(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=wN(t,e),t!==null){t.flags&=32767,Ot=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{$t=6,Ot=null;return}}else if(t=yN(t,e,hr),t!==null){Ot=t;return}if(e=e.sibling,e!==null){Ot=e;return}Ot=e=n}while(e!==null);$t===0&&($t=5)}function ga(n,e,t){var r=Ye,i=Or.transition;try{Or.transition=null,Ye=1,EN(n,e,t,r)}finally{Or.transition=i,Ye=r}return null}function EN(n,e,t,r){do Rl();while(gs!==null);if(De&6)throw Error(Z(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Z(177));n.callbackNode=null,n.callbackPriority=0;var o=t.lanes|t.childLanes;if(s8(n,o),n===Ht&&(Ot=Ht=null,tn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||pf||(pf=!0,fP(vp,function(){return Rl(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=Or.transition,Or.transition=null;var s=Ye;Ye=1;var a=De;De|=4,vb.current=null,vN(n,t),eP(t,n),K8(Aw),Pp=!!Mw,Aw=Mw=null,n.current=t,SN(t),Jz(),De=a,Ye=s,Or.transition=o}else n.current=t;if(pf&&(pf=!1,gs=n,ff=i),o=n.pendingLanes,o===0&&(fs=null),e8(t.stateNode),Yn(n,Rt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(hf)throw hf=!1,n=_b,_b=null,n;return ff&1&&n.tag!==0&&Rl(),o=n.pendingLanes,o&1?n===kb?qd++:(qd=0,kb=n):qd=0,ds(),null}function Rl(){if(gs!==null){var n=qC(ff),e=Or.transition,t=Ye;try{if(Or.transition=null,Ye=16>n?16:n,gs===null)var r=!1;else{if(n=gs,gs=null,ff=0,De&6)throw Error(Z(331));var i=De;for(De|=4,ie=n.current;ie!==null;){var o=ie,s=o.child;if(ie.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(ie=c;ie!==null;){var d=ie;switch(d.tag){case 0:case 11:case 15:Gd(8,d,o)}var u=d.child;if(u!==null)u.return=d,ie=u;else for(;ie!==null;){d=ie;var h=d.sibling,p=d.return;if(X2(d),d===c){ie=null;break}if(h!==null){h.return=p,ie=h;break}ie=p}}}var g=o.alternate;if(g!==null){var f=g.child;if(f!==null){g.child=null;do{var w=f.sibling;f.sibling=null,f=w}while(f!==null)}}ie=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,ie=s;else e:for(;ie!==null;){if(o=ie,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Gd(9,o,o.return)}var v=o.sibling;if(v!==null){v.return=o.return,ie=v;break e}ie=o.return}}var b=n.current;for(ie=b;ie!==null;){s=ie;var _=s.child;if(s.subtreeFlags&2064&&_!==null)_.return=s,ie=_;else e:for(s=b;ie!==null;){if(a=ie,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:cf(9,a)}}catch(E){Et(a,a.return,E)}if(a===s){ie=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,ie=x;break e}ie=a.return}}if(De=i,ds(),Ei&&typeof Ei.onPostCommitFiberRoot=="function")try{Ei.onPostCommitFiberRoot(Sp,n)}catch{}r=!0}return r}finally{Ye=t,Or.transition=e}}return!1}function uP(n,e,t){e=Ml(t,e),e=I2(n,e,1),n=hs(n,e,1),e=Dn(),n!==null&&(vd(n,1,e),Yn(n,e))}function Et(n,e,t){if(n.tag===3)uP(n,n,t);else for(;e!==null;){if(e.tag===3){uP(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(fs===null||!fs.has(r))){n=Ml(t,n),n=M2(e,n,1),e=hs(e,n,1),n=Dn(),e!==null&&(vd(e,1,n),Yn(e,n));break}}e=e.return}}function PN(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Dn(),n.pingedLanes|=n.suspendedLanes&t,Ht===n&&(tn&t)===t&&($t===4||$t===3&&(tn&130023424)===tn&&500>Rt()-xb?fa(n,0):Sb|=t),Yn(n,e)}function hP(n,e){e===0&&(n.mode&1?(e=_p,_p<<=1,!(_p&130023424)&&(_p=4194304)):e=1);var t=Dn();n=mo(n,e),n!==null&&(vd(n,e,t),Yn(n,t))}function IN(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),hP(n,t)}function MN(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Z(314))}r!==null&&r.delete(e),hP(n,t)}var pP;pP=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Hn.current)Kn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Kn=!1,mN(n,e,t);Kn=!!(n.flags&131072)}else Kn=!1,gt&&e.flags&1048576&&HE(e,Wp,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;af(n,e),n=e.pendingProps;var i=Sl(e,fn.current);El(e,t),i=nb(null,e,r,n,i,t);var o=rb();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Wn(r)?(o=!0,Up(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Gw(e),i.updater=Jp,e.stateNode=i,i._reactInternals=e,Xw(e,r,n,t),e=ub(null,e,r,!0,o,t)):(e.tag=0,gt&&o&&zw(e),Rn(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(af(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=TN(r),n=ei(r,n),i){case 0:e=db(null,e,r,n,t);break e;case 1:e=N2(null,e,r,n,t);break e;case 11:e=R2(null,e,r,n,t);break e;case 14:e=D2(null,e,r,ei(r.type,n),t);break e}throw Error(Z(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ei(r,i),db(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ei(r,i),N2(n,e,r,i,t);case 3:e:{if(F2(e),n===null)throw Error(Z(387));r=e.pendingProps,o=e.memoizedState,i=o.element,qE(n,e),qp(e,r,null,t);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=Ml(Error(Z(423)),e),e=$2(n,e,r,t,i);break e}else if(r!==i){i=Ml(Error(Z(424)),e),e=$2(n,e,r,t,i);break e}else for(ur=as(e.stateNode.containerInfo.firstChild),dr=e,gt=!0,Qr=null,t=o2(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(kl(),r===i){e=wo(n,e,t);break e}Rn(n,e,r,t)}e=e.child}return e;case 5:return s2(e),n===null&&$w(e),r=e.type,i=e.pendingProps,o=n!==null?n.memoizedProps:null,s=i.children,Tw(r,i)?s=null:o!==null&&Tw(r,o)&&(e.flags|=32),z2(n,e),Rn(n,e,s,t),e.child;case 6:return n===null&&$w(e),null;case 13:return B2(n,e,t);case 4:return qw(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Pl(e,null,r,t):Rn(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ei(r,i),R2(n,e,r,i,t);case 7:return Rn(n,e,e.pendingProps,t),e.child;case 8:return Rn(n,e,e.pendingProps.children,t),e.child;case 12:return Rn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,it(Gp,r._currentValue),r._currentValue=s,o!==null)if(Zr(o.value,s)){if(o.children===i.children&&!Hn.current){e=wo(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(o.tag===1){l=yo(-1,t&-t),l.tag=2;var c=o.updateQueue;if(c!==null){c=c.shared;var d=c.pending;d===null?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),Ww(o.return,t,e),a.lanes|=t;break}l=l.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Z(341));s.lanes|=t,a=s.alternate,a!==null&&(a.lanes|=t),Ww(s,t,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}Rn(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,El(e,t),i=Rr(i),r=r(i),e.flags|=1,Rn(n,e,r,t),e.child;case 14:return r=e.type,i=ei(r,e.pendingProps),i=ei(r.type,i),D2(n,e,r,i,t);case 15:return O2(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ei(r,i),af(n,e),e.tag=1,Wn(r)?(n=!0,Up(e)):n=!1,El(e,t),t2(e,r,i),Xw(e,r,i,t),ub(null,e,r,!0,n,t);case 19:return V2(n,e,t);case 22:return L2(n,e,t)}throw Error(Z(156,e.tag))};function fP(n,e){return WC(n,e)}function AN(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lr(n,e,t,r){return new AN(n,e,t,r)}function Ab(n){return n=n.prototype,!(!n||!n.isReactComponent)}function TN(n){if(typeof n=="function")return Ab(n)?1:0;if(n!=null){if(n=n.$$typeof,n===z0)return 11;if(n===$0)return 14}return 2}function ws(n,e){var t=n.alternate;return t===null?(t=Lr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function wf(n,e,t,r,i,o){var s=2;if(r=n,typeof n=="function")Ab(n)&&(s=1);else if(typeof n=="string")s=5;else e:switch(n){case ll:return ma(t.children,i,o,e);case O0:s=8,i|=8;break;case L0:return n=Lr(12,t,e,i|2),n.elementType=L0,n.lanes=o,n;case N0:return n=Lr(13,t,e,i),n.elementType=N0,n.lanes=o,n;case F0:return n=Lr(19,t,e,i),n.elementType=F0,n.lanes=o,n;case SC:return bf(t,i,o,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case bC:s=10;break e;case vC:s=9;break e;case z0:s=11;break e;case $0:s=14;break e;case Qo:s=16,r=null;break e}throw Error(Z(130,n==null?n:typeof n,""))}return e=Lr(s,t,e,i),e.elementType=n,e.type=r,e.lanes=o,e}function ma(n,e,t,r){return n=Lr(7,n,r,e),n.lanes=t,n}function bf(n,e,t,r){return n=Lr(22,n,r,e),n.elementType=SC,n.lanes=t,n.stateNode={isHidden:!1},n}function Tb(n,e,t){return n=Lr(6,n,null,e),n.lanes=t,n}function jb(n,e,t){return e=Lr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function jN(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sw(0),this.expirationTimes=sw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sw(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Rb(n,e,t,r,i,o,s,a,l){return n=new jN(n,e,t,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Lr(3,null,null,e),n.current=o,o.stateNode=n,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Gw(o),n}function RN(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:al,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function gP(n){if(!n)return cs;n=n._reactInternals;e:{if(ia(n)!==n||n.tag!==1)throw Error(Z(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Wn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Z(171))}if(n.tag===1){var t=n.type;if(Wn(t))return BE(n,t,e)}return e}function mP(n,e,t,r,i,o,s,a,l){return n=Rb(t,r,!0,n,i,o,s,a,l),n.context=gP(null),t=n.current,r=Dn(),i=ms(t),o=yo(r,i),o.callback=e??null,hs(t,o,i),n.current.lanes=i,vd(n,i,r),Yn(n,r),n}function vf(n,e,t,r){var i=e.current,o=Dn(),s=ms(i);return t=gP(t),e.context===null?e.context=t:e.pendingContext=t,e=yo(o,s),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=hs(i,e,s),n!==null&&(ri(n,i,s,o),Xp(n,i,s)),s}function Sf(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function yP(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Db(n,e){yP(n,e),(n=n.alternate)&&yP(n,e)}function DN(){return null}var wP=typeof reportError=="function"?reportError:function(n){console.error(n)};function Ob(n){this._internalRoot=n}xf.prototype.render=Ob.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Z(409));vf(n,e,null,null)},xf.prototype.unmount=Ob.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;pa(function(){vf(null,n,null,null)}),e[ho]=null}};function xf(n){this._internalRoot=n}xf.prototype.unstable_scheduleHydration=function(n){if(n){var e=QC();n={blockedOn:null,target:n,priority:e};for(var t=0;t<is.length&&e!==0&&e<is[t].priority;t++);is.splice(t,0,n),t===0&&nE(n)}};function Lb(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function _f(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function bP(){}function ON(n,e,t,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var c=Sf(s);o.call(c)}}var s=mP(e,r,n,0,null,!1,!1,"",bP);return n._reactRootContainer=s,n[ho]=s.current,Dd(n.nodeType===8?n.parentNode:n),pa(),s}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=Sf(l);a.call(c)}}var l=Rb(n,0,!1,null,null,!1,!1,"",bP);return n._reactRootContainer=l,n[ho]=l.current,Dd(n.nodeType===8?n.parentNode:n),pa(function(){vf(e,l,t,r)}),l}function kf(n,e,t,r,i){var o=t._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var l=Sf(s);a.call(l)}}vf(e,s,n,i)}else s=ON(t,e,n,i,r);return Sf(s)}JC=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=bd(e.pendingLanes);t!==0&&(aw(e,t|1),Yn(e,Rt()),!(De&6)&&(jl=Rt()+500,ds()))}break;case 13:pa(function(){var r=mo(n,1);if(r!==null){var i=Dn();ri(r,n,1,i)}}),Db(n,1)}},lw=function(n){if(n.tag===13){var e=mo(n,134217728);if(e!==null){var t=Dn();ri(e,n,134217728,t)}Db(n,134217728)}},ZC=function(n){if(n.tag===13){var e=ms(n),t=mo(n,e);if(t!==null){var r=Dn();ri(t,n,e,r)}Db(n,e)}},QC=function(){return Ye},eE=function(n,e){var t=Ye;try{return Ye=n,e()}finally{Ye=t}},ew=function(n,e,t){switch(e){case"input":if(K0(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=$p(r);if(!i)throw Error(Z(90));kC(r),K0(r,i)}}}break;case"textarea":MC(n,t);break;case"select":e=t.value,e!=null&&cl(n,!!t.multiple,e,!1)}},NC=Pb,FC=pa;var LN={usingClientEntryPoint:!1,Events:[zd,bl,$p,LC,zC,Pb]},Jd={findFiberByHostInstance:oa,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},zN={bundleType:Jd.bundleType,version:Jd.version,rendererPackageName:Jd.rendererPackageName,rendererConfig:Jd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:uo.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=VC(n),n===null?null:n.stateNode},findFiberByHostInstance:Jd.findFiberByHostInstance||DN,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cf.isDisabled&&Cf.supportsFiber)try{Sp=Cf.inject(zN),Ei=Cf}catch{}}ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LN,ar.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Lb(e))throw Error(Z(200));return RN(n,e,null,t)},ar.createRoot=function(n,e){if(!Lb(n))throw Error(Z(299));var t=!1,r="",i=wP;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Rb(n,1,!1,null,null,t,!1,r,i),n[ho]=e.current,Dd(n.nodeType===8?n.parentNode:n),new Ob(e)},ar.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Z(188)):(n=Object.keys(n).join(","),Error(Z(268,n)));return n=VC(e),n=n===null?null:n.stateNode,n},ar.flushSync=function(n){return pa(n)},ar.hydrate=function(n,e,t){if(!_f(e))throw Error(Z(200));return kf(null,n,e,!0,t)},ar.hydrateRoot=function(n,e,t){if(!Lb(n))throw Error(Z(405));var r=t!=null&&t.hydratedSources||null,i=!1,o="",s=wP;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),e=mP(e,null,n,1,t??null,i,!1,o,s),n[ho]=e.current,Dd(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new xf(e)},ar.render=function(n,e,t){if(!_f(e))throw Error(Z(200));return kf(null,n,e,!1,t)},ar.unmountComponentAtNode=function(n){if(!_f(n))throw Error(Z(40));return n._reactRootContainer?(pa(function(){kf(null,null,n,!1,function(){n._reactRootContainer=null,n[ho]=null})}),!0):!1},ar.unstable_batchedUpdates=Pb,ar.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!_f(t))throw Error(Z(200));if(n==null||n._reactInternals===void 0)throw Error(Z(38));return kf(n,e,t,!1,r)},ar.version="18.2.0-next-9e3b772b8-20220608";function vP(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(vP)}catch(n){console.error(n)}}vP(),hC.exports=ar;var Dl=hC.exports;const Ef=sr(Dl);var SP=Dl;A0.createRoot=SP.createRoot,A0.hydrateRoot=SP.hydrateRoot;function xP(n){return n&&typeof n=="object"&&"parents"in n}function _P(n){for(let e=0,t=n.parents.length;e<t;e++)if(n.parents[e].__unsafe__getWithoutCapture(),n.parents[e].lastChangedEpoch!==n.parentEpochs[e])return!0;return!1}const Pf=(n,e)=>{if(n.children.remove(e)&&n.children.isEmpty&&xP(n))for(let t=0,r=n.parents.length;t<r;t++)Pf(n.parents[t],n)},zb=(n,e)=>{if(n.children.add(e)&&xP(n))for(let t=0,r=n.parents.length;t<r;t++)zb(n.parents[t],n)};function kP(n,e){return n===e||Object.is(n,e)||!!(n&&e&&typeof n.equals=="function"&&n.equals(e))}function bs(n,e){const t=Symbol.for(`com.tldraw.state/${n}`),r=globalThis;return r[t]??(r[t]=e()),r[t]}const vo=bs("empty_array",()=>Object.freeze([])),CP=8;class EP{constructor(){y(this,"arraySize",0);y(this,"array",Array(CP));y(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<CP?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const r=this.array[t];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}}const pr=Symbol.for("com.tldraw.state/RESET_VALUE");class PP{constructor(e){y(this,"index",0);y(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,r){if(r!==void 0){if(r===pr){this.clear();return}this.buffer[this.index]=[e,t,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:r,buffer:i}=this;for(let o=0;o<r;o++){const s=(t-1+r-o)%r,a=i[s];if(!a)return pr;const[l,c]=a;if(o===0&&e>=c)return[];if(l<=e&&e<c){const d=o+1,u=new Array(d);for(let h=0;h<d;h++)u[h]=i[(s+h)%r][2];return u}}return pr}}class NN{constructor(e,t){y(this,"offset",0);y(this,"numNewParents",0);y(this,"maybeRemoved");this.below=e,this.child=t}}const pt=bs("capture",()=>({stack:null}));function IP(n){pt.stack=new NN(pt.stack,n)}function MP(){var e;const n=pt.stack;if(pt.stack=n.below,n.numNewParents>0||n.offset!==n.child.parents.length){for(let t=n.offset;t<n.child.parents.length;t++){const r=n.child.parents[t];n.child.parents.indexOf(r)>=n.offset&&Pf(r,n.child)}if(n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset,(e=pt.stack)==null?void 0:e.maybeRemoved)for(let t=0;t<pt.stack.maybeRemoved.length;t++){const r=pt.stack.maybeRemoved[t];n.child.parents.indexOf(r)===-1&&Pf(r,n.child)}}}function Nb(n){if(pt.stack){const e=pt.stack.child.parents.indexOf(n);if(e<0&&(pt.stack.numNewParents++,pt.stack.child.isActivelyListening&&zb(n,pt.stack.child)),e<0||e>=pt.stack.offset){if(e!==pt.stack.offset&&e>0){const t=pt.stack.child.parents[pt.stack.offset];pt.stack.maybeRemoved?pt.stack.maybeRemoved.indexOf(t)===-1&&pt.stack.maybeRemoved.push(t):pt.stack.maybeRemoved=[t]}pt.stack.child.parents[pt.stack.offset]=n,pt.stack.child.parentEpochs[pt.stack.offset]=n.lastChangedEpoch,pt.stack.offset++}}}const ya=-1;class FN{constructor(e,t,r){y(this,"_isActivelyListening",!1);y(this,"lastTraversedEpoch",ya);y(this,"lastReactedEpoch",ya);y(this,"_scheduleCount",0);y(this,"parentEpochs",[]);y(this,"parents",[]);y(this,"_scheduleEffect");y(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=t,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==fr()){if(this.parents.length&&!_P(this)){this.lastReactedEpoch=fr();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)zb(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)Pf(this.parents[e],this)}execute(){try{IP(this);const e=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=fr(),e}finally{MP()}}}const Ol=bs("EffectScheduler",()=>FN);function Ll(n,e,t){const r=new Ol(n,e,t);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function $N(n,e,t){const r=new Ol(n,e,t);return{scheduler:r,start:i=>{const o=(i==null?void 0:i.force)??!1;r.attach(),o?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}let BN=class{constructor(n){y(this,"initialAtomValues",new Map);this.parent=n}get isRoot(){return this.parent===null}commit(){if(this.isRoot){const n=this.initialAtomValues;this.initialAtomValues=new Map,AP(n.keys())}else this.initialAtomValues.forEach((n,e)=>{this.parent.initialAtomValues.has(e)||this.parent.initialAtomValues.set(e,n)})}abort(){wn.globalEpoch++,this.initialAtomValues.forEach((n,e)=>{var t;e.set(n),(t=e.historyBuffer)==null||t.clear()}),this.commit()}};const wn=bs("transactions",()=>({globalEpoch:ya+1,globalIsReacting:!1,currentTransaction:null}));function fr(){return wn.globalEpoch}function AP(n){if(wn.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{wn.globalIsReacting=!0;const e=new Set,t=r=>{r.lastTraversedEpoch!==wn.globalEpoch&&(r.lastTraversedEpoch=wn.globalEpoch,r instanceof Ol?e.add(r):r.children.visit(t))};for(const r of n)r.children.visit(t);for(const r of e)r.maybeScheduleEffect()}finally{wn.globalIsReacting=!1}}function UN(n,e){wn.currentTransaction?wn.currentTransaction.initialAtomValues.has(n)||wn.currentTransaction.initialAtomValues.set(n,e):AP([n])}function VN(){wn.globalEpoch++}function HN(n){const e=new BN(wn.currentTransaction);wn.currentTransaction=e;try{let t=!1;const r=n(()=>t=!0);return t?e.abort():e.commit(),r}catch(t){throw e.abort(),t}finally{wn.currentTransaction=wn.currentTransaction.parent}}function zr(n){return wn.currentTransaction?n():HN(n)}class WN{constructor(e,t,r){y(this,"isEqual");y(this,"computeDiff");y(this,"lastChangedEpoch",fr());y(this,"children",new EP);y(this,"historyBuffer");this.name=e,this.current=t,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new PP(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(){return this.current}get(){return Nb(this),this.current}set(e,t){var i,o;if(((i=this.isEqual)==null?void 0:i.call(this,this.current,e))??kP(this.current,e))return this.current;VN(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,fr(),t??((o=this.computeDiff)==null?void 0:o.call(this,this.current,e,this.lastChangedEpoch,fr()))??pr),this.lastChangedEpoch=fr();const r=this.current;return this.current=e,UN(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return Nb(this),e>=this.lastChangedEpoch?vo:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??pr}}const KN=bs("Atom",()=>WN);function On(n,e,t){return new KN(n,e,t)}let TP=!1;function GN(){TP||(TP=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const Fb=Symbol.for("com.tldraw.state/UNINITIALIZED"),zl=n=>n===Fb,$b=bs("WithDiff",()=>class{constructor(n,e){this.value=n,this.diff=e}});function Zd(n,e){return new $b(n,e)}class YN{constructor(e,t,r){y(this,"lastChangedEpoch",ya);y(this,"lastTraversedEpoch",ya);y(this,"lastCheckedEpoch",ya);y(this,"parents",[]);y(this,"parentEpochs",[]);y(this,"children",new EP);y(this,"historyBuffer");y(this,"state",Fb);y(this,"computeDiff");y(this,"isEqual");this.name=e,this.derive=t,r!=null&&r.historyLength&&(this.historyBuffer=new PP(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??kP}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(){var t;const e=this.lastChangedEpoch===ya;if(!e&&(this.lastCheckedEpoch===fr()||!_P(this)))return this.lastCheckedEpoch=fr(),this.state;try{IP(this);const r=this.derive(this.state,this.lastCheckedEpoch),i=r instanceof $b?r.value:r;if(this.state===Fb||!this.isEqual(i,this.state)){if(this.historyBuffer&&!e){const o=r instanceof $b?r.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,fr(),o??((t=this.computeDiff)==null?void 0:t.call(this,this.state,i,this.lastCheckedEpoch,fr()))??pr)}this.lastChangedEpoch=fr(),this.state=i}return this.lastCheckedEpoch=fr(),this.state}finally{MP()}}get(){const e=this.__unsafe__getWithoutCapture();return Nb(this),e}getDiffSince(e){var t;return this.get(),e>=this.lastChangedEpoch?vo:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??pr}}const Bb=bs("Computed",()=>YN);function XN(n={},e,t,r){const i=r.value,o=Symbol.for("__@tldraw/state__computed__"+t);return r.value=function(){let s=this[o];return s||(s=new Bb(t,i.bind(this),n),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r.value[JN]=!0,r}function jP(n={},e,t,r){return r.get?(GN(),qN(n,e,t,r)):XN(n,e,t,r)}function qN(n={},e,t,r){const i=r.get,o=Symbol.for("__@tldraw/state__computed__"+t);return r.get=function(){let s=this[o];return s||(s=new Bb(t,i.bind(this),n),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r}const JN="@@__isComputedMethod__@@";function Q(){if(arguments.length===1){const n=arguments[0];return(e,t,r)=>jP(n,e,t,r)}else return typeof arguments[0]=="string"?new Bb(arguments[0],arguments[1],arguments[2]):jP(void 0,arguments[0],arguments[1],arguments[2])}const RP=1;if(bs("apiVersion",()=>RP)!==RP)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");function If(n,e){const t=re.useRef(e);t.current=e;const[r,i,o]=re.useMemo(()=>{let s=null;const a=c=>(s=c,()=>{s=null}),l=new Ol(`useStateTracking(${n})`,()=>{var c;return(c=t.current)==null?void 0:c.call(t)},{scheduleEffect(){s==null||s()}});return[l,a,()=>l.scheduleCount]},[n]);return re.useSyncExternalStore(i,o,o),re.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const DP={apply(n,e,t){return If(n.displayName??n.name??"tracked(???)",()=>n.apply(e,t))}},ZN=Symbol.for("react.memo"),QN=Symbol.for("react.forward_ref");function $e(n){let e=null;const t=n.$$typeof;return t===ZN&&(n=n.type,e=n.compare),t===QN?S.memo(S.forwardRef(new Proxy(n.render,DP))):S.memo(new Proxy(n,DP),e)}function OP(){const n=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return S.useMemo(()=>Q(`useComputed(${n})`,e,t),r)}function wa(n,e,t=vo){S.useEffect(()=>{const r=new Ol(n,e);return r.attach(),r.execute(),()=>{r.detach()}},t)}function q(){const n=arguments,e=n.length===3?n[2]:[n[0]],t=n.length===3?n[0]:`useValue(${n[0].name})`,r=S.useRef(!0);r.current=!0;const i=S.useMemo(()=>n.length===1?n[0]:Q(t,()=>{if(r.current)return n[1]();try{return n[1]()}catch{return{}}}),e);try{const{subscribe:o,getSnapshot:s}=S.useMemo(()=>({subscribe:a=>Ll(`useValue(${t})`,()=>{i.get(),a()}),getSnapshot:()=>i.get()}),[i]);return S.useSyncExternalStore(o,s,s)}finally{r.current=!1}}class Mf{constructor(e){y(this,"nextValue");y(this,"diff");this.previousValue=e}get(){var r,i,o,s;const e=((i=(r=this.diff)==null?void 0:r.removed)==null?void 0:i.size)??0,t=((s=(o=this.diff)==null?void 0:o.added)==null?void 0:s.size)??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?(r=this.diff.removed)==null||r.delete(e):((i=this.diff).added??(i.added=new Set),this.diff.added.add(e))}add(e){var r,i,o;const t=this.previousValue.has(e);if(t)return(i=(r=this.diff)==null?void 0:r.removed)!=null&&i.has(e)?this._add(e,t):void 0;(o=this.nextValue)!=null&&o.has(e)||this._add(e,t)}_remove(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(i=this.diff.added)==null||i.delete(e)}remove(e){var r,i,o,s;const t=this.previousValue.has(e);if(!t)return(i=(r=this.diff)==null?void 0:r.added)!=null&&i.has(e)?this._remove(e,t):void 0;(s=(o=this.diff)==null?void 0:o.removed)!=null&&s.has(e)||this._remove(e,t)}}function Af(n,e){const t=[];e:for(const r of n){for(const i of t)if(e?e(r,i):r===i)continue e;t.push(r)}return t}function me(n){return n.filter(e=>e!=null)}function Xn(n){return n[n.length-1]}function e6(n,e){let t,r=1/0;for(const i of n){const o=e(i);o<r&&(t=i,r=o)}return t}function t6(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Object.is(n[t],e[t]))return!1;return!0}function LP(n){const e=(...t)=>{try{return n(...t)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}function Nl(n,e){const t=e&&n&&typeof n=="object"&&e in n?n[e]:n;throw new Error(`Unknown switch case ${t}`)}const ba=LP((n,e)=>{if(!n)throw new Error(e||"Assertion Error")}),n6=LP((n,e)=>{if(n==null)throw new Error(e??"value must be defined");return n});function zP(n,e){let t;const r=(...i)=>(t||(t={},t.promise=new Promise((o,s)=>{t.resolve=o,t.reject=s})),clearTimeout(t.timeout),t.latestArgs=i,t.timeout=setTimeout(()=>{const o=t;t=void 0;try{o.resolve(n(...o.latestArgs))}catch(s){o.reject(s)}},e),t.promise);return r.cancel=()=>{t&&clearTimeout(t.timeout)},r}const NP=new WeakMap;function Ub(n,e){if(typeof n!="object"||n===null)return;let t=NP.get(n);t||(t={tags:{},extras:{}},NP.set(n,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}class r6{static async base64ToFile(e){return fetch(e).then(function(t){return t.arrayBuffer()})}static async fileToBase64(e){return await new Promise((t,r)=>{if(e){const i=new FileReader;i.readAsDataURL(e),i.onload=()=>t(i.result),i.onerror=o=>r(o),i.onabort=o=>r(o)}})}}function Tf(n){let e=0;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e+""}let Vb=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(Vb=new Int32Array(Vb));const i6=(n,e)=>{let t=e===0?0:~~e^-1;for(let r=0;r<n.length;r++)t=Vb[(t^n[r])&255]^t>>>8;return t^-1},FP=4,$P=4;class Ti{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const r={};if(!Ti.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const i=t,o=e.getInt32(t);t+=4;const s=Ti.getChunkType(e,t);if(s==="IDAT"&&r[s]){t+=o+FP+$P;continue}if(s==="IEND")break;r[s]={start:i,dataOffset:t+4,size:o},t+=o+FP+$P}return r}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return Ti.readChunks(e)[t]}static setPhysChunk(e,t=1,r){let i=46,o=0;const s=Ti.findChunk(e,"pHYs");s&&(i=s.start,o=s.size);const a=Ti.findChunk(e,"IDAT");a&&(i=a.start,o=0);const l=new ArrayBuffer(21),c=new DataView(l);c.setUint32(0,9),c.setUint8(4,"p".charCodeAt(0)),c.setUint8(5,"H".charCodeAt(0)),c.setUint8(6,"Y".charCodeAt(0)),c.setUint8(7,"s".charCodeAt(0));const d=2835.5;c.setInt32(8,d*t),c.setInt32(12,d*t),c.setInt8(16,1);const u=new Uint8Array(l.slice(4,17));c.setInt32(17,i6(u));const h=e.buffer.slice(0,i),p=e.buffer.slice(i+o);return new Blob([h,l,p],r)}}class BP{static async getVideoSizeFromSrc(e){return await new Promise((t,r)=>{const i=document.createElement("video");i.onloadeddata=()=>t({w:i.videoWidth,h:i.videoHeight}),i.onerror=o=>{console.error(o),r(new Error("Could not get video size"))},i.crossOrigin="anonymous",i.src=e})}static async getImageSizeFromSrc(e){return await new Promise((t,r)=>{const i=new Image;i.onload=async()=>{try{const o=await r6.base64ToFile(e),s=new DataView(o);if(Ti.isPng(s,0)){const a=Ti.findChunk(s,"pHYs");if(a){const l=Ti.parsePhys(s,a.dataOffset);if(l.unit===0&&l.ppux===l.ppuy){const c=Math.max(l.ppux/2834.5,1);t({w:Math.round(i.width/c),h:Math.round(i.height/c)});return}}}t({w:i.width,h:i.height})}catch(o){console.error(o),t({w:i.width,h:i.height})}},i.onerror=o=>{console.error(o),r(new Error("Could not get image size"))},i.crossOrigin="anonymous",i.src=e})}}function vs(n=""){let e=0,t=0,r=0,i=0;function o(){const s=e^e<<11;return e=t,t=r,r=i,i^=(i>>>19^s^s>>>8)>>>0,i/4294967296*2}for(let s=0;s<n.length+64;s++)e^=n.charCodeAt(s)|0,o();return o}function jf(n,e,t,r=!1){const[i,o]=e,[s,a]=t,l=s+(n-i)/(o-i)*(a-s);return r?s<a?Math.max(Math.min(l,a),s):Math.max(Math.min(l,s),a):l}function Rf(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function va(n,e){if(Rf(n,e))return n[e]}function bn(n){if(!n)return n;if(Array.isArray(n)){const e=[],t=n.length;for(let r=0;r<t;r++)e.push(bn(n[r]));return e}else if(typeof n=="object"){const e=Object.keys(n),t=e.length,r={};for(let i=0;i<t;i++){const o=e[i];r[o]=bn(n[o])}return r}return n}function UP(n){return Object.keys(n)}function Pt(n){return Object.values(n)}function So(n){return Object.entries(n)}function VP(n){return Object.fromEntries(n)}function Hb(n,e){const t={};let r=!1;for(const[i,o]of So(n))e(i,o)?t[i]=o:r=!0;return r?t:n}function HP(n,e){const t={};for(const[r,i]of So(n)){const o=e(r,i);t[r]=o}return t}function WP(n,e){if(n===e)return!0;const t=new Set(Object.keys(n)),r=new Set(Object.keys(e));if(t.size!==r.size)return!1;for(const i of t)if(!r.has(i)||!Object.is(n[i],e[i]))return!1;return!0}const o6=()=>typeof process<"u"&&!1,Df=[],s6=()=>{const n=Df.splice(0,Df.length);for(const e of n)e()};let Wb;function a6(){Wb||(Wb=requestAnimationFrame(()=>{Wb=void 0,s6()}))}function l6(n){if(o6())return n();Df.includes(n)||(Df.push(n),a6())}function c6(n,e){return n.id>e.id?1:-1}function d6(n){return n!==null}const Ss=typeof window<"u"&&window.structuredClone?window.structuredClone:n=>n&&JSON.parse(JSON.stringify(n));let Of=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");class Kb{constructor(e,t){y(this,"createDefaultProperties");y(this,"migrations");y(this,"validator");y(this,"scope");y(this,"isInstance",e=>(e==null?void 0:e.typeName)===this.typeName);this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.migrations=t.migrations,this.validator=t.validator??{validate:r=>r},this.scope=t.scope??"document"}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[r,i]of Object.entries(e))i!==void 0&&(t[r]=i);return t.typeName=this.typeName,t}clone(e){return{...Ss(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??Of())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new Kb(this.typeName,{createDefaultProperties:e,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(e){return this.validator.validate(e)}}function xo(n,e){return new Kb(n,{createDefaultProperties:()=>({}),migrations:e.migrations??{currentVersion:0,firstVersion:0,migrators:{}},validator:e.validator,scope:e.scope})}class KP{constructor(){y(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}var Lf={exports:{}};Lf.exports,function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,o=2,s=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",d="[object Boolean]",u="[object Date]",h="[object Error]",p="[object Function]",g="[object GeneratorFunction]",f="[object Map]",w="[object Number]",v="[object Null]",b="[object Object]",_="[object Promise]",x="[object Proxy]",E="[object RegExp]",k="[object Set]",P="[object String]",I="[object Symbol]",A="[object Undefined]",T="[object WeakMap]",O="[object ArrayBuffer]",F="[object DataView]",H="[object Float32Array]",D="[object Float64Array]",K="[object Int8Array]",B="[object Int16Array]",te="[object Int32Array]",W="[object Uint8Array]",N="[object Uint8ClampedArray]",Y="[object Uint16Array]",ee="[object Uint32Array]",pe=/[\\^$.*+?()[\]{}|]/g,ve=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,fe={};fe[H]=fe[D]=fe[K]=fe[B]=fe[te]=fe[W]=fe[N]=fe[Y]=fe[ee]=!0,fe[a]=fe[l]=fe[O]=fe[d]=fe[F]=fe[u]=fe[h]=fe[p]=fe[f]=fe[w]=fe[b]=fe[E]=fe[k]=fe[P]=fe[T]=!1;var Ee=typeof Ge=="object"&&Ge&&Ge.Object===Object&&Ge,zt=typeof self=="object"&&self&&self.Object===Object&&self,We=Ee||zt||Function("return this")(),Fe=e&&!e.nodeType&&e,Ke=Fe&&!0&&n&&!n.nodeType&&n,ki=Ke&&Ke.exports===Fe,or=ki&&Ee.process,Mr=function(){try{return or&&or.binding&&or.binding("util")}catch{}}(),Nt=Mr&&Mr.isTypedArray;function Tt(j,z){for(var X=-1,se=j==null?0:j.length,ft=0,ke=[];++X<se;){var jt=j[X];z(jt,X,j)&&(ke[ft++]=jt)}return ke}function qo(j,z){for(var X=-1,se=z.length,ft=j.length;++X<se;)j[ft+X]=z[X];return j}function op(j,z){for(var X=-1,se=j==null?0:j.length;++X<se;)if(z(j[X],X,j))return!0;return!1}function Vk(j,z){for(var X=-1,se=Array(j);++X<j;)se[X]=z(X);return se}function Hk(j){return function(z){return j(z)}}function Wk(j,z){return j.has(z)}function ad(j,z){return j==null?void 0:j[z]}function Dwe(j){var z=-1,X=Array(j.size);return j.forEach(function(se,ft){X[++z]=[ft,se]}),X}function Owe(j,z){return function(X){return j(z(X))}}function Lwe(j){var z=-1,X=Array(j.size);return j.forEach(function(se){X[++z]=se}),X}var zwe=Array.prototype,Nwe=Function.prototype,y0=Object.prototype,Kk=We["__core-js_shared__"],YL=Nwe.toString,ao=y0.hasOwnProperty,XL=function(){var j=/[^.]+$/.exec(Kk&&Kk.keys&&Kk.keys.IE_PROTO||"");return j?"Symbol(src)_1."+j:""}(),qL=y0.toString,Fwe=RegExp("^"+YL.call(ao).replace(pe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),JL=ki?We.Buffer:void 0,w0=We.Symbol,ZL=We.Uint8Array,QL=y0.propertyIsEnumerable,$we=zwe.splice,el=w0?w0.toStringTag:void 0,ez=Object.getOwnPropertySymbols,Bwe=JL?JL.isBuffer:void 0,Uwe=Owe(Object.keys,Object),Gk=ld(We,"DataView"),sp=ld(We,"Map"),Yk=ld(We,"Promise"),Xk=ld(We,"Set"),qk=ld(We,"WeakMap"),ap=ld(Object,"create"),Vwe=rl(Gk),Hwe=rl(sp),Wwe=rl(Yk),Kwe=rl(Xk),Gwe=rl(qk),tz=w0?w0.prototype:void 0,Jk=tz?tz.valueOf:void 0;function tl(j){var z=-1,X=j==null?0:j.length;for(this.clear();++z<X;){var se=j[z];this.set(se[0],se[1])}}function Ywe(){this.__data__=ap?ap(null):{},this.size=0}function Xwe(j){var z=this.has(j)&&delete this.__data__[j];return this.size-=z?1:0,z}function qwe(j){var z=this.__data__;if(ap){var X=z[j];return X===r?void 0:X}return ao.call(z,j)?z[j]:void 0}function Jwe(j){var z=this.__data__;return ap?z[j]!==void 0:ao.call(z,j)}function Zwe(j,z){var X=this.__data__;return this.size+=this.has(j)?0:1,X[j]=ap&&z===void 0?r:z,this}tl.prototype.clear=Ywe,tl.prototype.delete=Xwe,tl.prototype.get=qwe,tl.prototype.has=Jwe,tl.prototype.set=Zwe;function Jo(j){var z=-1,X=j==null?0:j.length;for(this.clear();++z<X;){var se=j[z];this.set(se[0],se[1])}}function Qwe(){this.__data__=[],this.size=0}function ebe(j){var z=this.__data__,X=v0(z,j);if(X<0)return!1;var se=z.length-1;return X==se?z.pop():$we.call(z,X,1),--this.size,!0}function tbe(j){var z=this.__data__,X=v0(z,j);return X<0?void 0:z[X][1]}function nbe(j){return v0(this.__data__,j)>-1}function rbe(j,z){var X=this.__data__,se=v0(X,j);return se<0?(++this.size,X.push([j,z])):X[se][1]=z,this}Jo.prototype.clear=Qwe,Jo.prototype.delete=ebe,Jo.prototype.get=tbe,Jo.prototype.has=nbe,Jo.prototype.set=rbe;function nl(j){var z=-1,X=j==null?0:j.length;for(this.clear();++z<X;){var se=j[z];this.set(se[0],se[1])}}function ibe(){this.size=0,this.__data__={hash:new tl,map:new(sp||Jo),string:new tl}}function obe(j){var z=S0(this,j).delete(j);return this.size-=z?1:0,z}function sbe(j){return S0(this,j).get(j)}function abe(j){return S0(this,j).has(j)}function lbe(j,z){var X=S0(this,j),se=X.size;return X.set(j,z),this.size+=X.size==se?0:1,this}nl.prototype.clear=ibe,nl.prototype.delete=obe,nl.prototype.get=sbe,nl.prototype.has=abe,nl.prototype.set=lbe;function b0(j){var z=-1,X=j==null?0:j.length;for(this.__data__=new nl;++z<X;)this.add(j[z])}function cbe(j){return this.__data__.set(j,r),this}function dbe(j){return this.__data__.has(j)}b0.prototype.add=b0.prototype.push=cbe,b0.prototype.has=dbe;function ea(j){var z=this.__data__=new Jo(j);this.size=z.size}function ube(){this.__data__=new Jo,this.size=0}function hbe(j){var z=this.__data__,X=z.delete(j);return this.size=z.size,X}function pbe(j){return this.__data__.get(j)}function fbe(j){return this.__data__.has(j)}function gbe(j,z){var X=this.__data__;if(X instanceof Jo){var se=X.__data__;if(!sp||se.length<t-1)return se.push([j,z]),this.size=++X.size,this;X=this.__data__=new nl(se)}return X.set(j,z),this.size=X.size,this}ea.prototype.clear=ube,ea.prototype.delete=hbe,ea.prototype.get=pbe,ea.prototype.has=fbe,ea.prototype.set=gbe;function mbe(j,z){var X=x0(j),se=!X&&Tbe(j),ft=!X&&!se&&Zk(j),ke=!X&&!se&&!ft&&dz(j),jt=X||se||ft||ke,Zt=jt?Vk(j.length,String):[],pn=Zt.length;for(var Ct in j)(z||ao.call(j,Ct))&&!(jt&&(Ct=="length"||ft&&(Ct=="offset"||Ct=="parent")||ke&&(Ct=="buffer"||Ct=="byteLength"||Ct=="byteOffset")||Ebe(Ct,pn)))&&Zt.push(Ct);return Zt}function v0(j,z){for(var X=j.length;X--;)if(sz(j[X][0],z))return X;return-1}function ybe(j,z,X){var se=z(j);return x0(j)?se:qo(se,X(j))}function lp(j){return j==null?j===void 0?A:v:el&&el in Object(j)?kbe(j):Abe(j)}function nz(j){return cp(j)&&lp(j)==a}function rz(j,z,X,se,ft){return j===z?!0:j==null||z==null||!cp(j)&&!cp(z)?j!==j&&z!==z:wbe(j,z,X,se,rz,ft)}function wbe(j,z,X,se,ft,ke){var jt=x0(j),Zt=x0(z),pn=jt?l:ta(j),Ct=Zt?l:ta(z);pn=pn==a?b:pn,Ct=Ct==a?b:Ct;var Ar=pn==b,Ci=Ct==b,An=pn==Ct;if(An&&Zk(j)){if(!Zk(z))return!1;jt=!0,Ar=!1}if(An&&!Ar)return ke||(ke=new ea),jt||dz(j)?iz(j,z,X,se,ft,ke):xbe(j,z,pn,X,se,ft,ke);if(!(X&i)){var Xr=Ar&&ao.call(j,"__wrapped__"),qr=Ci&&ao.call(z,"__wrapped__");if(Xr||qr){var na=Xr?j.value():j,Zo=qr?z.value():z;return ke||(ke=new ea),ft(na,Zo,X,se,ke)}}return An?(ke||(ke=new ea),_be(j,z,X,se,ft,ke)):!1}function bbe(j){if(!cz(j)||Ibe(j))return!1;var z=az(j)?Fwe:ve;return z.test(rl(j))}function vbe(j){return cp(j)&&lz(j.length)&&!!fe[lp(j)]}function Sbe(j){if(!Mbe(j))return Uwe(j);var z=[];for(var X in Object(j))ao.call(j,X)&&X!="constructor"&&z.push(X);return z}function iz(j,z,X,se,ft,ke){var jt=X&i,Zt=j.length,pn=z.length;if(Zt!=pn&&!(jt&&pn>Zt))return!1;var Ct=ke.get(j);if(Ct&&ke.get(z))return Ct==z;var Ar=-1,Ci=!0,An=X&o?new b0:void 0;for(ke.set(j,z),ke.set(z,j);++Ar<Zt;){var Xr=j[Ar],qr=z[Ar];if(se)var na=jt?se(qr,Xr,Ar,z,j,ke):se(Xr,qr,Ar,j,z,ke);if(na!==void 0){if(na)continue;Ci=!1;break}if(An){if(!op(z,function(Zo,il){if(!Wk(An,il)&&(Xr===Zo||ft(Xr,Zo,X,se,ke)))return An.push(il)})){Ci=!1;break}}else if(!(Xr===qr||ft(Xr,qr,X,se,ke))){Ci=!1;break}}return ke.delete(j),ke.delete(z),Ci}function xbe(j,z,X,se,ft,ke,jt){switch(X){case F:if(j.byteLength!=z.byteLength||j.byteOffset!=z.byteOffset)return!1;j=j.buffer,z=z.buffer;case O:return!(j.byteLength!=z.byteLength||!ke(new ZL(j),new ZL(z)));case d:case u:case w:return sz(+j,+z);case h:return j.name==z.name&&j.message==z.message;case E:case P:return j==z+"";case f:var Zt=Dwe;case k:var pn=se&i;if(Zt||(Zt=Lwe),j.size!=z.size&&!pn)return!1;var Ct=jt.get(j);if(Ct)return Ct==z;se|=o,jt.set(j,z);var Ar=iz(Zt(j),Zt(z),se,ft,ke,jt);return jt.delete(j),Ar;case I:if(Jk)return Jk.call(j)==Jk.call(z)}return!1}function _be(j,z,X,se,ft,ke){var jt=X&i,Zt=oz(j),pn=Zt.length,Ct=oz(z),Ar=Ct.length;if(pn!=Ar&&!jt)return!1;for(var Ci=pn;Ci--;){var An=Zt[Ci];if(!(jt?An in z:ao.call(z,An)))return!1}var Xr=ke.get(j);if(Xr&&ke.get(z))return Xr==z;var qr=!0;ke.set(j,z),ke.set(z,j);for(var na=jt;++Ci<pn;){An=Zt[Ci];var Zo=j[An],il=z[An];if(se)var uz=jt?se(il,Zo,An,z,j,ke):se(Zo,il,An,j,z,ke);if(!(uz===void 0?Zo===il||ft(Zo,il,X,se,ke):uz)){qr=!1;break}na||(na=An=="constructor")}if(qr&&!na){var _0=j.constructor,k0=z.constructor;_0!=k0&&"constructor"in j&&"constructor"in z&&!(typeof _0=="function"&&_0 instanceof _0&&typeof k0=="function"&&k0 instanceof k0)&&(qr=!1)}return ke.delete(j),ke.delete(z),qr}function oz(j){return ybe(j,Dbe,Cbe)}function S0(j,z){var X=j.__data__;return Pbe(z)?X[typeof z=="string"?"string":"hash"]:X.map}function ld(j,z){var X=ad(j,z);return bbe(X)?X:void 0}function kbe(j){var z=ao.call(j,el),X=j[el];try{j[el]=void 0;var se=!0}catch{}var ft=qL.call(j);return se&&(z?j[el]=X:delete j[el]),ft}var Cbe=ez?function(j){return j==null?[]:(j=Object(j),Tt(ez(j),function(z){return QL.call(j,z)}))}:Obe,ta=lp;(Gk&&ta(new Gk(new ArrayBuffer(1)))!=F||sp&&ta(new sp)!=f||Yk&&ta(Yk.resolve())!=_||Xk&&ta(new Xk)!=k||qk&&ta(new qk)!=T)&&(ta=function(j){var z=lp(j),X=z==b?j.constructor:void 0,se=X?rl(X):"";if(se)switch(se){case Vwe:return F;case Hwe:return f;case Wwe:return _;case Kwe:return k;case Gwe:return T}return z});function Ebe(j,z){return z=z??s,!!z&&(typeof j=="number"||be.test(j))&&j>-1&&j%1==0&&j<z}function Pbe(j){var z=typeof j;return z=="string"||z=="number"||z=="symbol"||z=="boolean"?j!=="__proto__":j===null}function Ibe(j){return!!XL&&XL in j}function Mbe(j){var z=j&&j.constructor,X=typeof z=="function"&&z.prototype||y0;return j===X}function Abe(j){return qL.call(j)}function rl(j){if(j!=null){try{return YL.call(j)}catch{}try{return j+""}catch{}}return""}function sz(j,z){return j===z||j!==j&&z!==z}var Tbe=nz(function(){return arguments}())?nz:function(j){return cp(j)&&ao.call(j,"callee")&&!QL.call(j,"callee")},x0=Array.isArray;function jbe(j){return j!=null&&lz(j.length)&&!az(j)}var Zk=Bwe||Lbe;function Rbe(j,z){return rz(j,z)}function az(j){if(!cz(j))return!1;var z=lp(j);return z==p||z==g||z==c||z==x}function lz(j){return typeof j=="number"&&j>-1&&j%1==0&&j<=s}function cz(j){var z=typeof j;return j!=null&&(z=="object"||z=="function")}function cp(j){return j!=null&&typeof j=="object"}var dz=Nt?Hk(Nt):vbe;function Dbe(j){return jbe(j)?mbe(j):Sbe(j)}function Obe(){return[]}function Lbe(){return!1}n.exports=Rbe}(Lf,Lf.exports);var u6=Lf.exports;const h6=sr(u6);function p6(n){if(n.length===0)return new Set;const e=n[0],t=n.slice(1),r=new Set;for(const i of e)t.every(o=>o.has(i))&&r.add(i);return r}function f6(n,e){const t={};for(const r of e)n.has(r)||(t.added??(t.added=new Set),t.added.add(r));for(const r of n)e.has(r)||(t.removed??(t.removed=new Set),t.removed.add(r));return t.added||t.removed?t:void 0}function GP(n,e){for(const[t,r]of Object.entries(n)){const i=r,o=e[t];if("eq"in i&&o!==i.eq||"neq"in i&&o===i.neq||"gt"in i&&(typeof o!="number"||o<=i.gt))return!1}return!0}function YP(n,e,t){const r=Object.fromEntries(Object.keys(t).map(i=>[i,new Set]));for(const[i,o]of Object.entries(t))if("eq"in o){const s=n.index(e,i).get().get(o.eq);if(s)for(const a of s)r[i].add(a)}else if("neq"in o){const s=n.index(e,i);for(const[a,l]of s.get())if(a!==o.neq)for(const c of l)r[i].add(c)}else if("gt"in o){const s=n.index(e,i);for(const[a,l]of s.get())if(a>o.gt)for(const c of l)r[i].add(c)}return p6(Object.values(r))}class g6{constructor(e,t){y(this,"indexCache",new Map);y(this,"historyCache",new Map);this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=Q("filterHistory:"+e,(r,i)=>{if(zl(r))return this.history.get();const o=this.history.getDiffSince(i);if(o===pr)return this.history.get();const s={added:{},removed:{},updated:{}};let a=0,l=0,c=0;for(const d of o){for(const u of Pt(d.added))if(u.typeName===e)if(s.removed[u.id]){const h=s.removed[u.id];delete s.removed[u.id],l--,h!==u&&(s.updated[u.id]=[h,u],c++)}else s.added[u.id]=u,a++;for(const[u,h]of Pt(d.updated))h.typeName===e&&(s.added[h.id]?s.added[h.id]=h:s.updated[h.id]?s.updated[h.id]=[s.updated[h.id][0],h]:(s.updated[h.id]=[u,h],c++));for(const u of Pt(d.removed))u.typeName===e&&(s.added[u.id]?(delete s.added[u.id],a--):s.updated[u.id]?(s.removed[u.id]=s.updated[u.id][0],delete s.updated[u.id],c--,l++):(s.removed[u.id]=u,l++))}return a||l||c?Zd(this.history.get(),s):r},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const r=e+":"+t;if(this.indexCache.has(r))return this.indexCache.get(r);const i=this.__uncached_createIndex(e,t);return this.indexCache.set(r,i),i}__uncached_createIndex(e,t){const r=this.filterHistory(e),i=()=>{r.get();const o=new Map;for(const s of Pt(this.atoms.get())){const a=s.get();if(a.typeName===e){const l=a[t];o.has(l)||o.set(l,new Set),o.get(l).add(a.id)}}return o};return Q("index:"+e+":"+t,(o,s)=>{if(zl(o))return i();const a=r.getDiffSince(s);if(a===pr)return i();const l=new Map,c=(p,g)=>{let f=l.get(p);f||(f=new Mf(o.get(p)??new Set)),f.add(g),l.set(p,f)},d=(p,g)=>{let f=l.get(p);f||(f=new Mf(o.get(p)??new Set)),f.remove(g),l.set(p,f)};for(const p of a){for(const g of Pt(p.added))if(g.typeName===e){const f=g[t];c(f,g.id)}for(const[g,f]of Pt(p.updated))if(f.typeName===e){const w=g[t],v=f[t];w!==v&&(d(w,f.id),c(v,f.id))}for(const g of Pt(p.removed))if(g.typeName===e){const f=g[t];d(f,g.id)}}let u,h;for(const[p,g]of l){const f=g.get();f&&(u||(u=new Map(o)),h||(h=new Map),f.value.size===0?u.delete(p):u.set(p,f.value),h.set(p,f.diff))}return u&&h?Zd(u,h):o},{historyLength:100})}record(e,t=()=>({}),r="record:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,r);return Q(r,()=>{var o;for(const s of i.get())return(o=this.atoms.get()[s])==null?void 0:o.get()})}records(e,t=()=>({}),r="records:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,"ids:"+r);return Q(r,()=>[...i.get()].map(o=>{const s=this.atoms.get()[o];if(!s)throw new Error("no atom found for record id: "+o);return s.get()}))}ids(e,t=()=>({}),r="ids:"+e+(t?":"+t.toString():"")){const i=this.filterHistory(e),o=()=>{i.get();const l=t();return Object.keys(l).length===0?new Set(Pt(this.atoms.get()).flatMap(c=>{const d=c.get();return d.typeName===e?d.id:[]})):YP(this,e,l)},s=l=>{const c=o(),d=f6(l,c);return d?Zd(c,d):l},a=Q("ids_query:"+r,t,{isEqual:h6});return Q("query:"+r,(l,c)=>{const d=a.get();if(zl(l))return o();if(c<a.lastChangedEpoch)return s(l);const u=i.getDiffSince(c);if(u===pr)return s(l);const h=new Mf(l);for(const g of u){for(const f of Pt(g.added))f.typeName===e&&GP(d,f)&&h.add(f.id);for(const[f,w]of Pt(g.updated))w.typeName===e&&(GP(d,w)?h.add(w.id):h.remove(w.id));for(const f of Pt(g.removed))f.typeName===e&&h.remove(f.id)}const p=h.get();return p?Zd(p.value,p.diff):l},{historyLength:50})}exec(e,t){const r=YP(this,e,t);if(r.size===0)return vo;const i=this.atoms.get();return[...r].map(o=>i[o].get())}}class XP{constructor(e){y(this,"id",Of());y(this,"atoms",On("store_atoms",{}));y(this,"history",On("history",0,{historyLength:1e3}));y(this,"query",new g6(this.atoms,this.history));y(this,"listeners",new Set);y(this,"historyAccumulator",new y6);y(this,"historyReactor");y(this,"schema");y(this,"props");y(this,"scopedTypes");y(this,"onBeforeCreate");y(this,"onAfterCreate");y(this,"onBeforeChange");y(this,"onAfterChange");y(this,"onBeforeDelete");y(this,"onAfterDelete");y(this,"_runCallbacks",!0);y(this,"put",(e,t)=>{zr(()=>{const r={},i={},o=this.atoms.__unsafe__getWithoutCapture();let s=null,a,l=!1;const c=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,d=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,u=this.isMergingRemoteChanges?"remote":"user";for(let h=0,p=e.length;h<p;h++){a=e[h];const g=(s??o)[a.id];if(g){const f=g.__unsafe__getWithoutCapture();d&&(a=d(f,a,u)),a=this.schema.validateRecord(this,a,t??"updateRecord",f),g.set(a);const w=g.__unsafe__getWithoutCapture();f!==w&&(l=!0,r[a.id]=[f,w])}else c&&(a=c(a,u)),l=!0,a=this.schema.validateRecord(this,a,t??"createRecord",null),i[a.id]=a,s||(s={...o}),s[a.id]=On("atom:"+a.id,a)}if(s&&this.atoms.set(s),!!l&&(this.updateHistory({added:i,updated:r,removed:{}}),this._runCallbacks)){const{onAfterCreate:h,onAfterChange:p}=this;h&&Object.values(i).forEach(g=>{h(g,u)}),p&&Object.values(r).forEach(([g,f])=>{p(g,f,u)})}})});y(this,"remove",e=>{zr(()=>{const t=[],r=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(const o of e){const s=this.atoms.__unsafe__getWithoutCapture()[o];s&&this.onBeforeDelete(s.get(),r)===!1&&t.push(o)}let i;if(this.atoms.update(o=>{let s;for(const a of e)t.includes(a)||a in o&&(s||(s={...o}),i||(i={}),delete s[a],i[a]=o[a].get());return s??o}),!!i&&(this.updateHistory({added:{},updated:{},removed:i}),this.onAfterDelete&&this._runCallbacks)){let o;for(let s=0,a=e.length;s<a;s++)o=i[e[s]],o&&this.onAfterDelete(o,r)}})});y(this,"get",e=>{var t;return(t=this.atoms.get()[e])==null?void 0:t.get()});y(this,"unsafeGetWithoutCapture",e=>{var t;return(t=this.atoms.get()[e])==null?void 0:t.__unsafe__getWithoutCapture()});y(this,"serialize",(e="document")=>{const t={};for(const[r,i]of So(this.atoms.get())){const o=i.get();(e==="all"||this.scopedTypes[e].has(o.typeName))&&(t[r]=o)}return t});y(this,"allRecords",()=>Pt(this.atoms.get()).map(e=>e.get()));y(this,"clear",()=>{this.remove(UP(this.atoms.get()))});y(this,"update",(e,t)=>{const r=this.atoms.get()[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(r.__unsafe__getWithoutCapture())])});y(this,"has",e=>!!this.atoms.get()[e]);y(this,"listen",(e,t)=>{this._flushHistory();const r={onHistory:e,filters:{source:(t==null?void 0:t.source)??"all",scope:(t==null?void 0:t.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}});y(this,"isMergingRemoteChanges",!1);y(this,"mergeRemoteChanges",e=>{if(this.isMergingRemoteChanges)return e();try{this.isMergingRemoteChanges=!0,zr(e)}finally{this.isMergingRemoteChanges=!1}});y(this,"createComputedCache",(e,t,r)=>{const i=new KP;return{get:o=>{const s=this.atoms.get()[o];if(s)return i.get(s,()=>{const a=r?Q(s.name+":equals",()=>s.get(),{isEqual:r}):s;return Q(e+":"+o,()=>t(a.get()))}).get()}}});y(this,"createSelectedComputedCache",(e,t,r)=>{const i=new KP;return{get:o=>{const s=this.atoms.get()[o];if(!s)return;const a=Q(e+":"+o+":selector",()=>t(s.get()));return i.get(s,()=>Q(e+":"+o,()=>r(a.get()))).get()}}});y(this,"getRecordType",e=>{const t=this.schema.types[e.typeName];if(!t)throw new Error(`Record type ${e.typeName} not found`);return t});y(this,"_integrityChecker");y(this,"_isPossiblyCorrupted",!1);const{initialData:t,schema:r}=e;this.schema=r,this.props=e.props,t&&this.atoms.set(VP(So(t).map(([i,o])=>[i,On("atom:"+i,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=$N("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:i=>l6(i)}),this.scopedTypes={document:new Set(Pt(this.schema.types).filter(i=>i.scope==="document").map(i=>i.typeName)),session:new Set(Pt(this.schema.types).filter(i=>i.scope==="session").map(i=>i.typeName)),presence:new Set(Pt(this.schema.types).filter(i=>i.scope==="presence").map(i=>i.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:r}of e){let i=null,o=null,s=null;for(const{onHistory:a,filters:l}of this.listeners)if(!(l.source!=="all"&&l.source!==r))if(l.scope!=="all")if(l.scope==="document"){if(o??(o=this.filterChangesByScope(t,"document")),!o)continue;a({changes:o,source:r})}else if(l.scope==="session"){if(i??(i=this.filterChangesByScope(t,"session")),!i)continue;a({changes:i,source:r})}else{if(s??(s=this.filterChangesByScope(t,"presence")),!s)continue;a({changes:s,source:r})}else a({changes:t,source:r})}}}filterChangesByScope(e,t){const r={added:Hb(e.added,(i,o)=>this.scopedTypes[t].has(o.typeName)),updated:Hb(e.updated,(i,o)=>this.scopedTypes[t].has(o[1].typeName)),removed:Hb(e.removed,(i,o)=>this.scopedTypes[t].has(o.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}getSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);zr(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}extractingChanges(e){const t=[],r=this.historyAccumulator.intercepting(i=>t.push(i.changes));try{return zr(e),zf(t)}finally{r()}}applyDiff(e,t=!0){const r=this._runCallbacks;try{this._runCallbacks=t,zr(()=>{const i=Pt(e.added).concat(Pt(e.updated).map(([s,a])=>a)),o=UP(e.removed);i.length&&this.put(i),o.length&&this.remove(o)})}finally{this._runCallbacks=r}}ensureStoreIsUsable(){var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}}function zf(n){const e={added:{},removed:{},updated:{}};for(const t of n){for(const[r,i]of So(t.added))if(e.removed[r]){const o=e.removed[r];delete e.removed[r],o!==i&&(e.updated[r]=[o,i])}else e.added[r]=i;for(const[r,[i,o]]of So(t.updated)){if(e.added[r]){e.added[r]=o,delete e.updated[r],delete e.removed[r];continue}if(e.updated[r]){e.updated[r]=[e.updated[r][0],o],delete e.removed[r];continue}e.updated[r]=t.updated[r],delete e.removed[r]}for(const[r,i]of So(t.removed))e.added[r]?delete e.added[r]:e.updated[r]?(e.removed[r]=e.updated[r][0],delete e.updated[r]):e.removed[r]=i}return e}function m6(n){const e=[];let t=n[0],r;for(let i=1,o=n.length;i<o;i++)r=n[i],t.source!==r.source?(e.push(t),t=r):t={source:t.source,changes:zf([t.changes,r.changes])};return e.push(t),e}class y6{constructor(){y(this,"_history",[]);y(this,"_interceptors",new Set)}intercepting(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=m6(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function w6(n){return typeof n=="object"&&n!==null&&"id"in n&&"typeName"in n}function Be(n){const{currentVersion:e,firstVersion:t,migrators:r={},subTypeKey:i,subTypeMigrations:o}=n;if(typeof e=="number"&&typeof t=="number"){if(e===t)throw Error("Current version is equal to initial version.");if(e<t)throw Error("Current version is lower than initial version.")}return{firstVersion:t??0,currentVersion:e??0,migrators:r,subTypeKey:i,subTypeMigrations:o}}var Qd=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(Qd||{});function qP({record:n,migrations:e,fromVersion:t,toVersion:r}){let i=t;if(!w6(n))throw new Error("[migrateRecord] object is not a record");const{typeName:o,id:s,...a}=n;let l=a;for(;i<r;){const c=i+1,d=e.migrators[c];if(!d)return{type:"error",reason:"target-version-too-new"};l=d.up(l),i=c}for(;i>r;){const c=i-1,d=e.migrators[i];if(!d)return{type:"error",reason:"target-version-too-old"};l=d.down(l),i=c}return{type:"success",value:{...l,id:s,typeName:o}}}function Gb({value:n,migrations:e,fromVersion:t,toVersion:r}){let i=t;for(;i<r;){const o=i+1,s=e.migrators[o];if(!s)return{type:"error",reason:"target-version-too-new"};n=s.up(n),i=o}for(;i>r;){const o=i-1,s=e.migrators[i];if(!s)return{type:"error",reason:"target-version-too-old"};n=s.down(n),i=o}return{type:"success",value:n}}class Yb{constructor(e,t){this.types=e,this.options=t}static create(e,t){return new Yb(e,t??{})}get currentStoreVersion(){var e;return((e=this.options.snapshotMigrations)==null?void 0:e.currentVersion)??0}validateRecord(e,t,r,i){try{const o=va(this.types,t.typeName);if(!o)throw new Error(`Missing definition for record type ${t.typeName}`);return o.validate(t)}catch(o){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:r,recordBefore:i,error:o});throw o}}migratePersistedRecord(e,t,r="up"){var u;const i=va(this.types,e.typeName),o=t.recordVersions[e.typeName];if(!o||!i)return{type:"error",reason:Qd.UnknownType};const s=i.migrations.currentVersion,a=o.version;if(s!==a){const h=qP(r==="up"?{record:e,migrations:i.migrations,fromVersion:a,toVersion:s}:{record:e,migrations:i.migrations,fromVersion:s,toVersion:a});if(h.type==="error")return h;e=h.value}if(!i.migrations.subTypeKey)return{type:"success",value:e};const l=(u=i.migrations.subTypeMigrations)==null?void 0:u[e[i.migrations.subTypeKey]],c="subTypeVersions"in o?o.subTypeVersions[e[i.migrations.subTypeKey]]:void 0;if(l===void 0)return{type:"error",reason:Qd.UnrecognizedSubtype};if(c===void 0)return{type:"error",reason:Qd.IncompatibleSubtype};const d=qP(r==="up"?{record:e,migrations:l,fromVersion:c,toVersion:l.currentVersion}:{record:e,migrations:l,fromVersion:l.currentVersion,toVersion:c});return d.type==="error"?d:{type:"success",value:d.value}}migrateStoreSnapshot(e){let{store:t}=e;const r=this.options.snapshotMigrations;if(!r)return{type:"success",value:t};const i=r.currentVersion,o=e.schema.storeVersion??0;if(i<o)return{type:"error",reason:Qd.TargetVersionTooOld};if(i>o){const a=Gb({value:t,migrations:r,fromVersion:o,toVersion:i});if(a.type==="error")return a;t=a.value}const s=[];for(const a of Pt(t)){const l=this.migratePersistedRecord(a,e.schema);if(l.type==="error")return l;l.value&&l.value!==a&&s.push(l.value)}if(s.length){t={...t};for(const a of s)t[a.id]=a}return{type:"success",value:t}}createIntegrityChecker(e){var t,r;return((r=(t=this.options).createIntegrityChecker)==null?void 0:r.call(t,e))??void 0}serialize(){var e;return{schemaVersion:1,storeVersion:((e=this.options.snapshotMigrations)==null?void 0:e.currentVersion)??0,recordVersions:Object.fromEntries(Pt(this.types).map(t=>[t.typeName,t.migrations.subTypeKey&&t.migrations.subTypeMigrations?{version:t.migrations.currentVersion,subTypeKey:t.migrations.subTypeKey,subTypeVersions:t.migrations.subTypeMigrations?Object.fromEntries(Object.entries(t.migrations.subTypeMigrations).map(([r,i])=>[r,i.currentVersion])):void 0}:{version:t.migrations.currentVersion}]))}}serializeEarliestVersion(){var e;return{schemaVersion:1,storeVersion:((e=this.options.snapshotMigrations)==null?void 0:e.firstVersion)??0,recordVersions:Object.fromEntries(Pt(this.types).map(t=>[t.typeName,t.migrations.subTypeKey&&t.migrations.subTypeMigrations?{version:t.migrations.firstVersion,subTypeKey:t.migrations.subTypeKey,subTypeVersions:t.migrations.subTypeMigrations?Object.fromEntries(Object.entries(t.migrations.subTypeMigrations).map(([r,i])=>[r,i.firstVersion])):void 0}:{version:t.migrations.firstVersion}]))}}}const b6=(n,e)=>{if(n.schemaVersion>e.schemaVersion)return 1;if(n.schemaVersion<e.schemaVersion)return-1;if(n.storeVersion>e.storeVersion)return 1;if(n.storeVersion<e.storeVersion)return-1;for(const t of Object.keys(n.recordVersions)){const r=n.recordVersions[t],i=e.recordVersions[t];if(r.version>i.version)return 1;if(r.version<i.version)return-1;if("subTypeVersions"in r&&!("subTypeVersions"in i))return 1;if(!("subTypeVersions"in r)&&"subTypeVersions"in i)return-1;if(!(!("subTypeVersions"in r)||!("subTypeVersions"in i)))for(const o of Object.keys(r.subTypeVersions)){const s=r.subTypeVersions[o],a=i.subTypeVersions[o];if(s>a)return 1;if(s<a)return-1}}return 0};function v6(n){if(!n.length)return null;let e="";for(const t of n)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e.startsWith(".")?e.slice(1):e}class nt extends Error{constructor(t,r=[]){const i=v6(r),o=t.split(`
`).map((s,a)=>a===0?s:`  ${s}`).join(`
`);super(r?`At ${i}: ${o}`:o);y(this,"name","ValidationError");this.rawMessage=t,this.path=r}}function Fl(n,e){try{return e()}catch(t){throw t instanceof nt?new nt(t.rawMessage,[n,...t.path]):new nt(t.toString(),[n])}}function $l(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const e=typeof n;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:Nl(e)}}class Ln{constructor(e){this.validationFn=e}validate(e){return this.validationFn(e)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return E6(this)}optional(){return ZP(this)}refine(e){return new Ln(t=>e(this.validate(t)))}check(e,t){return typeof e=="string"?this.refine(r=>(Fl(`(check ${e})`,()=>t(r)),r)):this.refine(r=>(e(r),r))}}class S6 extends Ln{constructor(e){super(t=>{const r=C6.validate(t);for(let i=0;i<r.length;i++)Fl(i,()=>e.validate(r[i]));return r}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new nt("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new nt("Expected an array with length greater than 1")})}}class Nf extends Ln{constructor(e,t=!1){super(r=>{if(typeof r!="object"||r===null)throw new nt(`Expected object, got ${$l(r)}`);for(const[i,o]of Object.entries(e))Fl(i,()=>{o.validate(va(r,i))});if(!t){for(const i of Object.keys(r))if(!Rf(e,i))throw new nt("Unexpected property",[i])}return r}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new Nf(this.config,!0)}extend(e){return new Nf({...this.config,...e})}}class Xb extends Ln{constructor(e,t,r){super(i=>{if(typeof i!="object"||i===null)throw new nt(`Expected an object, got ${$l(i)}`,[]);const o=va(i,e);if(typeof o!="string")throw new nt(`Expected a string for key "${e}", got ${$l(o)}`);const s=Rf(t,o)?t[o]:void 0;return s===void 0?this.unknownValueValidation(i,o):Fl(`(${e} = ${o})`,()=>s.validate(i))}),this.key=e,this.config=t,this.unknownValueValidation=r}validateUnknownVariants(e){return new Xb(this.key,this.config,e)}}class x6 extends Ln{constructor(e,t){super(r=>{if(typeof r!="object"||r===null)throw new nt(`Expected object, got ${$l(r)}`);for(const[i,o]of Object.entries(r))Fl(i,()=>{e.validate(i),t.validate(o)});return r}),this.keyValidator=e,this.valueValidator=t}}function qb(n){return new Ln(e=>{if(typeof e!==n)throw new nt(`Expected ${n}, got ${$l(e)}`);return e})}const _6=new Ln(n=>n),Se=qb("string"),we=qb("number").check(n=>{if(Number.isNaN(n))throw new nt("Expected a number, got NaN");if(!Number.isFinite(n))throw new nt(`Expected a finite number, got ${n}`)}),Jb=we.check(n=>{if(n<0)throw new nt(`Expected a positive number, got ${n}`)}),qn=we.check(n=>{if(n<=0)throw new nt(`Expected a non-zero positive number, got ${n}`)}),JP=we.check(n=>{if(!Number.isInteger(n))throw new nt(`Expected an integer, got ${n}`)}),Ff=JP.check(n=>{if(n<0)throw new nt(`Expected a positive integer, got ${n}`)}),k6=JP.check(n=>{if(n<=0)throw new nt(`Expected a non-zero positive integer, got ${n}`)}),Ie=qb("boolean");function Jn(n){return new Ln(e=>{if(e!==n)throw new nt(`Expected ${n}, got ${JSON.stringify(e)}`);return n})}const C6=new Ln(n=>{if(!Array.isArray(n))throw new nt(`Expected an array, got ${$l(n)}`);return n});function zn(n){return new S6(n)}function je(n){return new Nf(n)}function Zb(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(Zb):typeof n=="object"?Object.values(n).every(Zb):!1}const ji=new Ln(n=>{if(Zb(n))return n;throw new nt(`Expected json serializable value, got ${typeof n}`)});function Qb(n,e){return new x6(n,e)}function ev(n,e){return new Xb(n,e,(t,r)=>{throw new nt(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[n])})}function _o(n,e){return new Ln(t=>{const r=t&&typeof t=="object"&&"id"in t&&typeof t.id=="string"?`${n}(id = ${t.id})`:n;return Fl(r,()=>e.validate(t))})}function eu(n){return new Ln(e=>{if(!n.has(e)){const t=Array.from(n,r=>JSON.stringify(r)).join(" or ");throw new nt(`Expected ${t}, got ${e}`)}return e})}function ZP(n){return new Ln(e=>{if(e!==void 0)return n.validate(e)})}function E6(n){return new Ln(e=>e===null?null:n.validate(e))}function QP(...n){return eu(new Set(n))}function eI(n){try{return new URL(n)}catch{throw new nt(`Expected a valid url, got ${JSON.stringify(n)}`)}}const P6=new Set(["http:","https:","mailto:"]),gr=Se.check(n=>{if(n==="")return;const e=eI(n);if(!P6.has(e.protocol.toLowerCase()))throw new nt(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),I6=new Set(["http:","https:","data:"]),Bl=Se.check(n=>{if(n==="")return;const e=eI(n);if(!I6.has(e.protocol.toLowerCase()))throw new nt(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});function ii(n){return Se.refine(e=>{if(!e.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return e})}const $f=ii("asset");function tv(n,e){return je({id:$f,typeName:Jn("asset"),type:Jn(n),props:e,meta:ji})}const M6=_o("camera",je({typeName:Jn("camera"),id:ii("camera"),x:we,y:we,z:we,meta:ji})),tI={AddMeta:1},A6=Be({currentVersion:tI.AddMeta,migrators:{[tI.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),nn=xo("camera",{validator:M6,migrations:A6,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),tu=je({x:we,y:we,z:we.optional()}),nu=je({x:we,y:we,w:we,h:we}),T6=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),nI=eu(T6),j6=je({type:nI,rotation:we}),rI=we.check(n=>{if(n<0||n>1)throw new nt("Opacity must be between 0 and 1")}),R6=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),D6=eu(R6),O6=new Set(["starting","paused","active","stopping"]),iI=je({id:Se,points:zn(tu),size:Jb,color:D6,opacity:we,state:eu(O6),delay:we,shrink:we,taper:Ie}),ru=ii("page"),L6=_o("page",je({typeName:Jn("page"),id:ru,name:Se,index:Se,meta:ji})),oI={AddMeta:1},z6=Be({currentVersion:oI.AddMeta,migrators:{[oI.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),ko=xo("page",{validator:L6,migrations:z6,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Zn(n){return ko.isId(n)}ii("instance");function N6(n){const e={};for(const[r,i]of n)e[r]=ZP(i);const t=_o("instance",je({typeName:Jn("instance"),id:ii("instance"),currentPageId:ru,followingUserId:Se.nullable(),brush:nu.nullable(),opacityForNextShape:rI,stylesForNextShape:je(e),cursor:j6,scribbles:zn(iI),isFocusMode:Ie,isDebugMode:Ie,isToolLocked:Ie,exportBackground:Ie,screenBounds:nu,zoomBrush:nu.nullable(),isPenMode:Ie,isGridMode:Ie,chatMessage:Se,isChatting:Ie,highlightedUserIds:zn(Se),canMoveCamera:Ie,isFocused:Ie,devicePixelRatio:we,isCoarsePointer:Ie,isHoveringCanvas:Ie.nullable(),openMenus:zn(Se),isChangingStyle:Ie,isReadonly:Ie,meta:ji}));return xo("instance",{migrations:F6,validator:t,scope:"session"}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{}}))}const St={AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22},F6=Be({currentVersion:St.AddScribbles,migrators:{[St.AddTransparentExportBgs]:{up:n=>({...n,exportBackground:!0}),down:({exportBackground:n,...e})=>e},[St.RemoveDialog]:{up:({dialog:n,...e})=>e,down:n=>({...n,dialog:null})},[St.AddToolLockMode]:{up:n=>({...n,isToolLocked:!1}),down:({isToolLocked:n,...e})=>e},[St.RemoveExtraPropsForNextShape]:{up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))}),down:n=>n},[St.AddLabelColor]:{up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:{...n,labelColor:"black"}}),down:n=>{const{labelColor:e,...t}=n.propsForNextShape;return{...n,propsForNextShape:{...t}}}},[St.AddFollowingUserId]:{up:n=>({...n,followingUserId:null}),down:({followingUserId:n,...e})=>e},[St.RemoveAlignJustify]:{up:n=>{let e=n.propsForNextShape.align;return e==="justify"&&(e="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:e}}},down:n=>({...n})},[St.AddZoom]:{up:n=>({...n,zoomBrush:null}),down:({zoomBrush:n,...e})=>e},[St.AddVerticalAlign]:{up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}}),down:n=>{const{verticalAlign:e,...t}=n.propsForNextShape;return{...n,propsForNextShape:t}}},[St.AddScribbleDelay]:{up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n},down:n=>{if(n.scribble!==null){const{delay:e,...t}=n.scribble;return{...n,scribble:t}}return{...n}}},[St.RemoveUserId]:{up:({userId:n,...e})=>e,down:n=>({...n,userId:"user:none"})},[St.AddIsPenModeAndIsGridMode]:{up:n=>({...n,isPenMode:!1,isGridMode:!1}),down:({isPenMode:n,isGridMode:e,...t})=>t},[St.HoistOpacity]:{up:({propsForNextShape:{opacity:n,...e},...t})=>({...t,opacityForNextShape:Number(n??"1"),propsForNextShape:e}),down:({opacityForNextShape:n,...e})=>({...e,propsForNextShape:{...e.propsForNextShape,opacity:n<.175?"0.1":n<.375?"0.25":n<.625?"0.5":n<.875?"0.75":"1"}})},[St.AddChat]:{up:n=>({...n,chatMessage:"",isChatting:!1}),down:({chatMessage:n,isChatting:e,...t})=>t},[St.AddHighlightedUserIds]:{up:n=>({...n,highlightedUserIds:[]}),down:({highlightedUserIds:n,...e})=>e},[St.ReplacePropsForNextShapeWithStylesForNextShape]:{up:({propsForNextShape:n,...e})=>({...e,stylesForNextShape:{}}),down:({stylesForNextShape:n,...e})=>({...e,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}})},[St.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})},[St.RemoveCursorColor]:{up:n=>{const{color:e,...t}=n.cursor;return{...n,cursor:t}},down:n=>({...n,cursor:{...n.cursor,color:"black"}})},[St.AddLonelyProperties]:{up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:({canMoveCamera:n,isFocused:e,devicePixelRatio:t,isCoarsePointer:r,openMenus:i,isChangingStyle:o,isReadOnly:s,...a})=>({...a})},[St.ReadOnlyReadonly]:{up:({isReadOnly:n,...e})=>({...e,isReadonly:n}),down:({isReadonly:n,...e})=>({...e,isReadOnly:n})},[St.AddHoveringCanvas]:{up:n=>({...n,isHoveringCanvas:null}),down:({isHoveringCanvas:n,...e})=>({...e})},[St.AddScribbles]:{up:({scribble:n,...e})=>({...e,scribbles:[]}),down:({scribbles:n,...e})=>({...e,scribble:null})}}}),vn="instance:instance",$6=Se.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),oi=ii("shape");function B6(n,e,t){return je({id:oi,typeName:Jn("shape"),x:we,y:we,rotation:we,index:Se,parentId:$6,type:Jn(n),isLocked:Ie,opacity:rI,props:e?je(e):ji,meta:t?je(t):ji})}const U6=_o("instance_page_state",je({typeName:Jn("instance_page_state"),id:ii("instance_page_state"),pageId:ru,selectedShapeIds:zn(oi),hintingShapeIds:zn(oi),erasingShapeIds:zn(oi),hoveredShapeId:oi.nullable(),editingShapeId:oi.nullable(),croppingShapeId:oi.nullable(),focusedGroupId:oi.nullable(),meta:ji})),Ul={AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5},V6=Be({currentVersion:Ul.RenamePropertiesAgain,migrators:{[Ul.AddCroppingId]:{up(n){return{...n,croppingShapeId:null}},down({croppingShapeId:n,...e}){return e}},[Ul.RemoveInstanceIdAndCameraId]:{up({instanceId:n,cameraId:e,...t}){return t},down(n){return{...n,instanceId:vn,cameraId:nn.createId("void")}}},[Ul.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})},[Ul.RenameProperties]:{up:n=>{const{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=n;return{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}},down:n=>{const{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=n;return{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}}},[Ul.RenamePropertiesAgain]:{up:n=>{const{selectedIds:e,hintingIds:t,erasingIds:r,hoveredId:i,editingId:o,croppingShapeId:s,croppingId:a,focusLayerId:l,...c}=n;return{...c,selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s??a??null,focusedGroupId:l}},down:n=>{const{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=n;return{...l,selectedIds:e,hintingIds:t,erasingIds:r,hoveredId:i,editingId:o,croppingId:s,focusLayerId:a}}}}}),rn=xo("instance_page_state",{migrations:V6,validator:U6,scope:"session"}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),H6=_o("pointer",je({typeName:Jn("pointer"),id:ii("pointer"),x:we,y:we,lastActivityTimestamp:we,meta:ji})),sI={AddMeta:1},W6=Be({currentVersion:sI.AddMeta,migrators:{[sI.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),nv=xo("pointer",{validator:H6,migrations:W6,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),iu=nv.createId("pointer"),K6=_o("instance_presence",je({typeName:Jn("instance_presence"),id:ii("instance_presence"),userId:Se,userName:Se,lastActivityTimestamp:we,followingUserId:Se.nullable(),cursor:je({x:we,y:we,type:nI,rotation:we}),color:Se,camera:je({x:we,y:we,z:we}),screenBounds:nu,selectedShapeIds:zn(ii("shape")),currentPageId:ii("page"),brush:nu.nullable(),scribbles:zn(iI),chatMessage:Se,meta:ji})),Vl={AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5},G6=Be({currentVersion:Vl.RenameSelectedShapeIds,migrators:{[Vl.AddScribbleDelay]:{up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n},down:n=>{if(n.scribble!==null){const{delay:e,...t}=n.scribble;return{...n,scribble:t}}return{...n}}},[Vl.RemoveInstanceId]:{up:({instanceId:n,...e})=>e,down:n=>({...n,instanceId:vn})},[Vl.AddChatMessage]:{up:n=>({...n,chatMessage:""}),down:({chatMessage:n,...e})=>e},[Vl.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})},[Vl.RenameSelectedShapeIds]:{up:n=>{const{selectedShapeIds:e,...t}=n;return{selectedShapeIds:e,...t}},down:n=>{const{selectedShapeIds:e,...t}=n;return{selectedShapeIds:e,...t}}}}}),ou=xo("instance_presence",{migrations:G6,validator:K6,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),Y6=(n,e)=>t=>Q("instancePresence",()=>{const r=t.get(vn),i=t.get(rn.createId(r==null?void 0:r.currentPageId)),o=t.get(nn.createId(r==null?void 0:r.currentPageId)),s=t.get(iu),a=n.get();return!i||!r||!o||!s||!a?null:ou.create({id:e??ou.createId(t.id),selectedShapeIds:i.selectedShapeIds,brush:r.brush,scribbles:r.scribbles,userId:a.id,userName:a.name,followingUserId:r.followingUserId,camera:{x:o.x,y:o.y,z:o.z},color:a.color,currentPageId:r.currentPageId,cursor:{x:s.x,y:s.y,rotation:r.cursor.rotation,type:r.cursor.type},lastActivityTimestamp:s.lastActivityTimestamp,screenBounds:r.screenBounds,chatMessage:r.chatMessage,meta:{}})}),X6=_o("document",je({typeName:Jn("document"),id:Jn("document:document"),gridSize:we,name:Se,meta:ji})),rv={AddName:1,AddMeta:2},q6=Be({currentVersion:rv.AddMeta,migrators:{[rv.AddName]:{up:n=>({...n,name:""}),down:({name:n,...e})=>e},[rv.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),iv=xo("document",{migrations:q6,validator:X6,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),ov=iv.createId("document");function J6(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function aI(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}const Z6=({error:n,phase:e,record:t,recordBefore:r})=>{throw Ub(n,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?aI(Ss(r)):void 0,recordAfter:aI(Ss(t))}}),n};function Q6(){return[ko.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function eF(n){const e=n.query.ids("page"),t=()=>{if(!n.has(ov))return n.put([iv.create({id:ov,name:n.props.defaultName})]),t();if(!n.has(iu))return n.put([nv.create({id:iu})]),t();const r=e.get();if(r.size===0)return n.put(Q6()),t();const i=()=>[...r].map(l=>n.get(l)).sort(J6)[0].id,o=n.get(vn);if(o){if(!r.has(o.currentPageId))return n.put([{...o,currentPageId:i()}]),t()}else return n.put([n.schema.types.instance.create({id:vn,currentPageId:i(),exportBackground:!0})]),t();const s=new Set,a=new Set;for(const l of r){const c=rn.createId(l);n.has(c)||s.add(c);const d=nn.createId(l);n.has(d)||a.add(d)}s.size>0&&n.put([...s].map(l=>rn.create({id:l,pageId:rn.parseId(l)}))),a.size>0&&n.put([...a].map(l=>nn.create({id:l})))};return t}const tF=tv("bookmark",je({title:Se,description:Se,image:Se,src:Bl.nullable()})),lI={MakeUrlsValid:1},nF=Be({currentVersion:lI.MakeUrlsValid,migrators:{[lI.MakeUrlsValid]:{up:n=>{const e=n.props.src;return e&&!Bl.isValid(e)?{...n,props:{...n.props,src:""}}:n},down:n=>n}}}),rF=tv("image",je({w:we,h:we,name:Se,isAnimated:Ie,mimeType:Se.nullable(),src:Bl.nullable()})),Bf={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},iF=Be({currentVersion:Bf.MakeUrlsValid,migrators:{[Bf.AddIsAnimated]:{up:n=>({...n,props:{...n.props,isAnimated:!1}}),down:n=>{const{isAnimated:e,...t}=n.props;return{...n,props:t}}},[Bf.RenameWidthHeight]:{up:n=>{const{width:e,height:t,...r}=n.props;return{...n,props:{w:e,h:t,...r}}},down:n=>{const{w:e,h:t,...r}=n.props;return{...n,props:{width:e,height:t,...r}}}},[Bf.MakeUrlsValid]:{up:n=>{const e=n.props.src;return e&&!Bl.isValid(e)?{...n,props:{...n.props,src:""}}:n},down:n=>n}}}),oF=tv("video",je({w:we,h:we,name:Se,isAnimated:Ie,mimeType:Se.nullable(),src:Bl.nullable()})),Uf={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},sF=Be({currentVersion:Uf.MakeUrlsValid,migrators:{[Uf.AddIsAnimated]:{up:n=>({...n,props:{...n.props,isAnimated:!1}}),down:n=>{const{isAnimated:e,...t}=n.props;return{...n,props:t}}},[Uf.RenameWidthHeight]:{up:n=>{const{width:e,height:t,...r}=n.props;return{...n,props:{w:e,h:t,...r}}},down:n=>{const{w:e,h:t,...r}=n.props;return{...n,props:{width:e,height:t,...r}}}},[Uf.MakeUrlsValid]:{up:n=>{const e=n.props.src;return e&&!Bl.isValid(e)?{...n,props:{...n.props,src:""}}:n},down:n=>n}}}),aF=_o("asset",ev("type",{image:rF,video:oF,bookmark:tF})),cI={AddMeta:1},lF=Be({subTypeKey:"type",subTypeMigrations:{image:iF,video:sF,bookmark:nF},currentVersion:cI.AddMeta,migrators:{[cI.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),Sa=xo("asset",{migrations:lF,validator:aF,scope:"document"}).withDefaultProperties(()=>({meta:{}}));class Sn{constructor(e,t,r){this.id=e,this.defaultValue=t,this.type=r}static define(e,t){const{defaultValue:r,type:i=_6}=t;return new Sn(e,r,i)}static defineEnum(e,t){const{defaultValue:r,values:i}=t;return new cF(e,r,i)}validate(e){return this.type.validate(e)}}class cF extends Sn{constructor(e,t,r){super(e,t,QP(...r)),this.values=r}}const Vf={AddIsLocked:1,HoistOpacity:2,AddMeta:3},sv=Be({currentVersion:Vf.AddMeta,migrators:{[Vf.AddIsLocked]:{up:n=>({...n,isLocked:!1}),down:n=>{const{isLocked:e,...t}=n;return{...t}}},[Vf.HoistOpacity]:{up:({props:{opacity:n,...e},...t})=>({...t,opacity:Number(n??"1"),props:e}),down:({opacity:n,...e})=>({...e,props:{...e.props,opacity:n<.175?"0.1":n<.375?"0.25":n<.625?"0.5":n<.875?"0.75":"1"}})},[Vf.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}});function xa(n){return n?n.typeName==="shape":!1}function Nr(n){return n?n.startsWith("shape:"):!1}function ot(n){return`shape:${n??Of()}`}function dI(n){const e=new Map;for(const[t,r]of Object.entries(n))if(r instanceof Sn){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,t)}return e}function dF(n){return xo("shape",{migrations:Be({currentVersion:sv.currentVersion,firstVersion:sv.firstVersion,migrators:sv.migrators,subTypeKey:"type",subTypeMigrations:HP(n,(e,t)=>t.migrations??Be({}))}),scope:"document",validator:_o("shape",ev("type",HP(n,(e,{props:t,meta:r})=>B6(e,t,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}const su={RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4},uF=Be({currentVersion:su.RemoveUserDocument,migrators:{[su.RemoveCodeAndIconShapeTypes]:{up:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>t.typeName!=="shape"||t.type!=="icon"&&t.type!=="code")),down:n=>n},[su.AddInstancePresenceType]:{up:n=>n,down:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>t.typeName!=="instance_presence"))},[su.RemoveTLUserAndPresenceAndAddPointer]:{up:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>!t.typeName.match(/^(user|user_presence)$/))),down:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>t.typeName!=="pointer"))},[su.RemoveUserDocument]:{up:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>!t.typeName.match("user_document"))),down:n=>n}}});function hF({shapes:n}){const e=new Map;for(const i of Pt(n))for(const o of dI(i.props??{}).keys()){if(e.has(o.id)&&e.get(o.id)!==o)throw new Error(`Multiple StyleProp instances with the same id: ${o.id}`);e.set(o.id,o)}const t=dF(n),r=N6(e);return Yb.create({asset:Sa,camera:nn,document:iv,instance:r,instance_page_state:rn,page:ko,shape:t,instance_presence:ou,pointer:nv},{snapshotMigrations:uF,onValidationFailure:Z6,createIntegrityChecker:eF})}const uI=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],Hf={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"#f8f9fa",background:"#212529",solid:"#28292e",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4156be",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#3b7b5e",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#93989f",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#588fc9",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#599f57",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#c67877",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#b583c9",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#bf612e",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#aa3c37",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#873fa3",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#cba371",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function Qn(n){return n.isDarkMode?Hf.darkMode:Hf.lightMode}const Fr=Sn.defineEnum("tldraw:color",{defaultValue:"black",values:uI}),hI=Sn.defineEnum("tldraw:labelColor",{defaultValue:"black",values:uI}),_a=Sn.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Hl=Sn.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),Ri=Sn.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),au={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Di=Sn.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),pI=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],Wf=Sn.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:pI}),Kf=Sn.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:pI}),fI=ev("type",{binding:je({type:Jn("binding"),boundShapeId:oi,normalizedAnchor:tu,isExact:Ie,isPrecise:Ie}),point:je({type:Jn("point"),x:we,y:we})}),pF={labelColor:hI,color:Fr,fill:Hl,dash:_a,size:Di,arrowheadStart:Wf,arrowheadEnd:Kf,font:Ri,start:fI,end:fI,bend:we,text:Se},av={AddLabelColor:1,AddIsPrecise:2},fF=Be({currentVersion:av.AddIsPrecise,migrators:{[av.AddLabelColor]:{up:n=>({...n,props:{...n.props,labelColor:"black"}}),down:n=>{const{labelColor:e,...t}=n.props;return{...n,props:t}}},[av.AddIsPrecise]:{up:n=>{const{start:e,end:t}=n.props;return{...n,props:{...n.props,start:e.type==="binding"?{...e,isPrecise:!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5)}:e,end:t.type==="binding"?{...t,isPrecise:!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5)}:t}}},down:n=>{const{start:e,end:t}=n.props,r={...e},i={...t};return r.type==="binding"&&(r.isPrecise||(r.normalizedAnchor={x:.5,y:.5}),delete r.isPrecise),i.type==="binding"&&(i.isPrecise||(i.normalizedAnchor={x:.5,y:.5}),delete i.isPrecise),{...n,props:{...n.props,start:r,end:i}}}}}}),gF={w:qn,h:qn,assetId:$f.nullable(),url:gr},lv={NullAssetId:1,MakeUrlsValid:2},mF=Be({currentVersion:lv.MakeUrlsValid,migrators:{[lv.NullAssetId]:{up:n=>n.props.assetId===void 0?{...n,props:{...n.props,assetId:null}}:n,down:n=>{if(n.props.assetId===null){const{assetId:e,...t}=n.props;return{...n,props:t}}return n}},[lv.MakeUrlsValid]:{up:n=>n.props.url!==""&&!gr.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),gI=je({type:QP("free","straight"),points:zn(tu)}),yF={color:Fr,fill:Hl,dash:_a,size:Di,segments:zn(gI),isComplete:Ie,isClosed:Ie,isPen:Ie},mI={AddInPen:1},wF=Be({currentVersion:mI.AddInPen,migrators:{[mI.AddInPen]:{up:n=>{const{points:e}=n.props.segments[0];if(e.length===0)return{...n,props:{...n.props,isPen:!1}};let t=!(e[0].z===0||e[0].z===.5);return e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),{...n,props:{...n.props,isPen:t}}},down:n=>{const{isPen:e,...t}=n.props;return{...n,props:{...t}}}}}}),yI=/(^\/r\/[^/]+\/?$)/,Qe=n=>{try{return new URL(n)}catch{return}},Wl=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(yI))return n},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(yI))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{if(n.includes("/maps/")){const e=n.match(/@(.*),(.*),(.*)z/);let t;if(e){const[,r,i,o]=e;t=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${{}.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${o}`}else t="";return t}},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const t=e.searchParams.get("zoom"),[r,i]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${r},${i},${t}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Qe(n),t=e&&e.pathname.match(/\/v\/([^/]+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Qe(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Qe(n),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Qe(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=n.match(e);if(t){const[r,i,o]=t;return`https://codepen.io/${i}/embed/${o}`}},fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i,o]=t;return`https://codepen.io/${i}/pen/${o}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:n=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Qe(n);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.hostname.replace(/^www./,"")==="youtube.com"){const t=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(t)return`https://www.youtube.com/watch?v=${t[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:n=>{const e=Qe(n),t=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:n=>{const e=Qe(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Qe(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}},fromEmbedUrl:n=>{const e=Qe(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Qe(n);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Qe(n);if(e&&e.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:n=>{const e=Qe(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}}],bF={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},vF={w:qn,h:qn,url:Se},lu={GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4},SF=Be({currentVersion:lu.RemovePermissionOverrides,migrators:{[lu.GenOriginalUrlInEmbed]:{up:n=>{const e=n.props.url,t=new URL(e).host.replace("www.","");let r;for(const i of Wl)if(i.hostnames.includes(t))try{r=i.fromEmbedUrl(e)}catch(o){console.warn(o)}return{...n,props:{...n.props,tmpOldUrl:n.props.url,url:r??""}}},down:n=>{let e=n.props.tmpOldUrl;if(!e||e===""){const i=n.props.url,o=new URL(i).host.replace("www.","");for(const s of Wl)if(s.hostnames.includes(o))try{e=s.toEmbedUrl(i)}catch(a){console.warn(a)}}const{tmpOldUrl:t,...r}=n.props;return{...n,props:{...r,url:e??""}}}},[lu.RemoveDoesResize]:{up:n=>{const{doesResize:e,...t}=n.props;return{...n,props:{...t}}},down:n=>({...n,props:{...n.props,doesResize:!0}})},[lu.RemoveTmpOldUrl]:{up:n=>{const{tmpOldUrl:e,...t}=n.props;return{...n,props:{...t}}},down:n=>({...n,props:{...n.props}})},[lu.RemovePermissionOverrides]:{up:n=>{const{overridePermissions:e,...t}=n.props;return{...n,props:{...t}}},down:n=>({...n,props:{...n.props}})}}}),xF={w:qn,h:qn,name:Se},_F=Be({}),cu=Sn.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),Gf=Sn.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Oi=Sn.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),kF={geo:Oi,labelColor:hI,color:Fr,fill:Hl,dash:_a,size:Di,font:Ri,align:cu,verticalAlign:Gf,url:gr,w:qn,h:qn,growY:Jb,text:Se},Co={AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8},CF=Be({currentVersion:Co.MakeUrlsValid,migrators:{[Co.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[Co.AddLabelColor]:{up:n=>({...n,props:{...n.props,labelColor:"black"}}),down:n=>{const{labelColor:e,...t}=n.props;return{...n,props:t}}},[Co.RemoveJustify]:{up:n=>{let e=n.props.align;return e==="justify"&&(e="start"),{...n,props:{...n.props,align:e}}},down:n=>({...n})},[Co.AddCheckBox]:{up:n=>({...n}),down:n=>({...n,props:{...n.props,geo:n.props.geo==="check-box"?"rectangle":n.props.geo}})},[Co.AddVerticalAlign]:{up:n=>({...n,props:{...n.props,verticalAlign:"middle"}}),down:n=>{const{verticalAlign:e,...t}=n.props;return{...n,props:t}}},[Co.MigrateLegacyAlign]:{up:n=>{let e;switch(n.props.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}return{...n,props:{...n.props,align:e}}},down:n=>{let e;switch(n.props.align){case"start-legacy":e="start";break;case"end-legacy":e="end";break;case"middle-legacy":e="middle";break;default:e=n.props.align}return{...n,props:{...n.props,align:e}}}},[Co.AddCloud]:{up:n=>n,down:n=>{if(n.props.geo==="cloud")return{...n,props:{...n.props,geo:"rectangle"}}}},[Co.MakeUrlsValid]:{up:n=>n.props.url!==""&&!gr.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),EF={},PF=Be({}),IF={color:Fr,size:Di,segments:zn(gI),isComplete:Ie,isPen:Ie},MF=Be({}),AF=je({topLeft:tu,bottomRight:tu}),TF={w:qn,h:qn,playing:Ie,url:gr,assetId:$f.nullable(),crop:AF.nullable()},Yf={AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3},jF=Be({currentVersion:Yf.MakeUrlsValid,migrators:{[Yf.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[Yf.AddCropProp]:{up:n=>({...n,props:{...n.props,crop:null}}),down:n=>{const{crop:e,...t}=n.props;return{...n,props:t}}},[Yf.MakeUrlsValid]:{up:n=>n.props.url!==""&&!gr.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),RF=new Set(["vertex","virtual","create"]),DF=je({id:Se,type:eu(RF),canBind:Ie.optional(),canSnap:Ie.optional(),index:Se,x:we,y:we}),Xf=Sn.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),OF={color:Fr,dash:_a,size:Di,spline:Xf,handles:Qb(Se,DF)},wI={AddSnapHandles:1},LF=Be({currentVersion:wI.AddSnapHandles,migrators:{[wI.AddSnapHandles]:{up:n=>{const e=bn(n.props.handles);for(const t in e)e[t].canSnap=!0;return{...n,props:{...n.props,handles:e}}},down:n=>{const e=bn(n.props.handles);for(const t in e)delete e[t].canSnap;return{...n,props:{...n.props,handles:e}}}}}}),zF={color:Fr,size:Di,font:Ri,align:cu,verticalAlign:Gf,growY:Jb,url:gr,text:Se},Kl={AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5},NF=Be({currentVersion:Kl.MakeUrlsValid,migrators:{[Kl.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[Kl.RemoveJustify]:{up:n=>{let e=n.props.align;return e==="justify"&&(e="start"),{...n,props:{...n.props,align:e}}},down:n=>({...n})},[Kl.MigrateLegacyAlign]:{up:n=>{let e;switch(n.props.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}return{...n,props:{...n.props,align:e}}},down:n=>{let e;switch(n.props.align){case"start-legacy":e="start";break;case"end-legacy":e="end";break;case"middle-legacy":e="middle";break;default:e=n.props.align}return{...n,props:{...n.props,align:e}}}},[Kl.AddVerticalAlign]:{up:n=>({...n,props:{...n.props,verticalAlign:"middle"}}),down:n=>{const{verticalAlign:e,...t}=n.props;return{...n,props:t}}},[Kl.MakeUrlsValid]:{up:n=>n.props.url!==""&&!gr.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),FF={color:Fr,size:Di,font:Ri,align:cu,w:qn,text:Se,scale:qn,autoSize:Ie},bI={RemoveJustify:1},$F=Be({currentVersion:bI.RemoveJustify,migrators:{[bI.RemoveJustify]:{up:n=>{let e=n.props.align;return e==="justify"&&(e="start"),{...n,props:{...n.props,align:e}}},down:n=>({...n})}}}),BF={w:qn,h:qn,time:we,playing:Ie,url:gr,assetId:$f.nullable()},cv={AddUrlProp:1,MakeUrlsValid:2},UF=Be({currentVersion:cv.MakeUrlsValid,migrators:{[cv.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[cv.MakeUrlsValid]:{up:n=>n.props.url!==""&&!gr.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),du=[{locale:"ar",label:"\u0639\u0631\u0628\u064A"},{locale:"ca",label:"Catal\xE0"},{locale:"cs",label:"\u010Ce\u0161tina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xF1ol"},{locale:"fa",label:"\u0641\u0627\u0631\u0633\u06CC"},{locale:"fi",label:"Suomi"},{locale:"fr",label:"Fran\xE7ais"},{locale:"gl",label:"Galego"},{locale:"he",label:"\u05E2\u05D1\u05E8\u05D9\u05EA"},{locale:"it",label:"Italiano"},{locale:"ja",label:"\u65E5\u672C\u8A9E"},{locale:"ko-kr",label:"\uD55C\uAD6D\uC5B4"},{locale:"ku",label:"\u06A9\u0648\u0631\u062F\u06CC"},{locale:"hi-in",label:"\u0939\u093F\u0928\u094D\u0926\u0940"},{locale:"hu",label:"Magyar"},{locale:"my",label:"\u1019\u103C\u1014\u103A\u1019\u102C\u1005\u102C"},{locale:"ne",label:"\u0928\u0947\u092A\u093E\u0932\u0940"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xEAs - Brasil"},{locale:"pt-pt",label:"Portugu\xEAs - Europeu"},{locale:"ro",label:"Rom\xE2n\u0103"},{locale:"ru",label:"Russian"},{locale:"sv",label:"Svenska"},{locale:"te",label:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41"},{locale:"th",label:"\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22"},{locale:"tr",label:"T\xFCrk\xE7e"},{locale:"uk",label:"Ukrainian"},{locale:"vi",label:"Ti\u1EBFng Vi\u1EC7t"},{locale:"zh-cn",label:"Chinese - Simplified"},{locale:"zh-tw",label:"\u7E41\u9AD4\u4E2D\u6587 (\u53F0\u7063)"}];function VF(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return HF(n)}function HF(n){for(const e of n){const t=WF(e);if(t)return t}return"en"}const vI={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function WF(n){const e=du.find(i=>i.locale===n.toLowerCase());if(e)return e.locale;const[t,r]=n.split(/[-_]/).map(i=>i.toLowerCase());if(r){const i=du.find(o=>o.locale===t);if(i)return i.locale}return t in vI?vI[t]:null}var SI={exports:{}};(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var r=[],i=0;i<arguments.length;i++){var o=arguments[i];if(o){var s=typeof o;if(s==="string"||s==="number")r.push(o);else if(Array.isArray(o)){if(o.length){var a=t.apply(null,o);a&&r.push(a)}}else if(s==="object"){if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]")){r.push(o.toString());continue}for(var l in o)e.call(o,l)&&o[l]&&r.push(l)}}}return r.join(" ")}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(SI);var KF=SI.exports;const ye=sr(KF),GF={},st={preventDefaultLogging:mr("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureLogging:mr("pointerCaptureLogging",{defaults:{all:!1}}),pointerCaptureTracking:mr("pointerCaptureTracking",{defaults:{all:!1}}),pointerCaptureTrackingObject:mr("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),elementRemovalLogging:mr("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:mr("debugSvg",{defaults:{all:!1}}),throwToBlob:mr("throwToBlob",{defaults:{all:!1}}),logMessages:mr("uiLog",{defaults:{all:[]}}),resetConnectionEveryPing:mr("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:mr("debugCursors",{defaults:{all:!1}}),forceSrgb:mr("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:mr("debugGeometry",{defaults:{all:!1}}),hideShapes:mr("hideShapes",{defaults:{all:!1}})};if(typeof window<"u"&&(window.tldrawLog=n=>{st.logMessages.set(st.logMessages.get().concat(n))}),typeof Element<"u"){const n=Element.prototype.removeChild;Ll("element removal logging",()=>{st.elementRemovalLogging.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),n.call(this,e)}:Element.prototype.removeChild=n})}function mr(n,{defaults:e,shouldStoreForSession:t=!0}){return YF({name:n,defaults:e,shouldStoreForSession:t})}function YF(n){const e=qF(n),t=n.shouldStoreForSession?XF(n.name):null,r=On(`debug:${n.name}`,t??e);return typeof window<"u"&&(n.shouldStoreForSession&&Ll(`debug:${n.name}`,()=>{const i=r.get();try{i===e?window.sessionStorage.removeItem(`tldraw_debug:${n.name}`):window.sessionStorage.setItem(`tldraw_debug:${n.name}`,JSON.stringify(i))}catch{}}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return r.get()},set(i){r.set(i)},configurable:!0})),Object.assign(r,n)}function XF(n){try{return JSON.parse((window==null?void 0:window.sessionStorage.getItem(`tldraw_debug:${n}`))??"null")}catch{return null}}function dv(n){try{return n()}catch{return null}}function qF(n){switch(dv(()=>({}).TLDRAW_ENV)??dv(()=>({}).VERCEL_PUBLIC_TLDRAW_ENV)??dv(()=>({}).NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}function qf(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return qf(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function ze(n){n.preventDefault(),st.preventDefaultLogging.get()&&console.warn("preventDefault called on event:",n)}function uu(n,e){if(n.setPointerCapture(e.pointerId),st.pointerCaptureTracking.get()){const t=st.pointerCaptureTrackingObject.get();t.set(n,(t.get(n)??0)+1)}st.pointerCaptureLogging.get()&&console.warn("setPointerCapture called on element:",n,e)}function hu(n,e){if(n.hasPointerCapture(e.pointerId)){if(n.releasePointerCapture(e.pointerId),st.pointerCaptureTracking.get()){const t=st.pointerCaptureTrackingObject.get();t.get(n)===1?t.delete(n):t.has(n)?t.set(n,t.get(n)-1):console.warn("Release without capture")}st.pointerCaptureLogging.get()&&console.warn("releasePointerCapture called on element:",n,e)}}const Wt=n=>n.stopPropagation();function er(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}const uv=re.createContext({});function G(){return re.useContext(uv)}function JF(){const n=G();return S.useMemo(function(){let e,t;function r(p){if(!p.isKilled){if(p.button===2){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...er(p)});return}p.button!==0&&p.button!==1&&p.button!==5||(uu(p.currentTarget,p),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...er(p)}),n.getOpenMenus().length>0&&(n.updateInstanceState({openMenus:[]}),document.body.click(),n.getContainer().focus()))}}function i(p){p.isKilled||p.clientX===e&&p.clientY===t||(e=p.clientX,t=p.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...er(p)}))}function o(p){p.isKilled||p.button!==0&&p.button!==1&&p.button!==2&&p.button!==5||(e=p.clientX,t=p.clientY,hu(p.currentTarget,p),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...er(p)}))}function s(p){if(p.isKilled||n.getInstanceState().isPenMode&&p.pointerType!=="pen")return;const g=p.pointerType==="mouse"||p.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:g?!0:null})}function a(p){if(p.isKilled||n.getInstanceState().isPenMode&&p.pointerType!=="pen")return;const g=p.pointerType==="mouse"||p.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:g?!1:null})}function l(p){p.isKilled=!0,document.body.click(),ze(p)}function c(p){p.isKilled=!0,p.target.tagName!=="A"&&p.target.tagName!=="TEXTAREA"&&ze(p)}function d(p){ze(p)}async function u(p){var f,w;if(ze(p),!((w=(f=p.dataTransfer)==null?void 0:f.files)!=null&&w.length))return;const g=Array.from(p.dataTransfer.files);await n.putExternalContent({type:"files",files:g,point:n.screenToPage({x:p.clientX,y:p.clientY}),ignoreParent:!1})}function h(p){Wt(p)}return{onPointerDown:r,onPointerMove:i,onPointerUp:o,onPointerEnter:s,onPointerLeave:a,onDragOver:d,onDrop:u,onTouchStart:l,onTouchEnd:c,onClick:h}},[n])}function ZF(){const n=G();S.useEffect(()=>{if(n.environment.isFirefox&&!n.environment.isAndroid&&!n.environment.isIos){n.updateInstanceState({isCoarsePointer:!1});return}if(window.matchMedia){const e=window.matchMedia("(pointer: coarse)"),t=()=>{n.updateInstanceState({isCoarsePointer:!!e.matches})};if(t(),e)return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}},[n])}const xI=S.createContext(null);function QF({container:n,children:e}){return m.jsx(xI.Provider,{value:n,children:e})}function xn(){return n6(S.useContext(xI),"useContainer used outside of <Tldraw />")}function e9(){const n=G(),e=xn(),t=q("isFocused",()=>n.getInstanceState().isFocused,[n]);S.useEffect(()=>{if(typeof matchMedia===void 0)return;let r=null;const i=()=>{r==null||r();const o=`(resolution: ${window.devicePixelRatio}dppx)`,s=matchMedia(o),a=l=>{l.type==="change"&&i()};s.addEventListener?s.addEventListener("change",i):s.addListener&&s.addListener(a),r=()=>{s.removeEventListener?s.removeEventListener("change",i):s.removeListener&&s.removeListener(a)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return i(),()=>{r==null||r()}},[n]),S.useEffect(()=>{if(!t)return;const r=a=>{if(a.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!pu()&&ze(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){ze(a);return}break}case"Tab":{if(pu()||n.getIsMenuOpen())return;break}case",":{if(!pu()&&(ze(a),!n.inputs.keys.has("Comma"))){const{x:c,y:d,z:u}=n.inputs.currentScreenPoint;n.inputs.keys.add("Comma");const h={type:"pointer",name:"pointer_down",point:{x:c,y:d,z:u},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(h);return}break}case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&a.preventDefault(),n.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),e.focus());return}default:if(pu()||n.getIsMenuOpen())return}const l={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};n.dispatch(l)},i=a=>{var c;if(a.isKilled||(a.isKilled=!0,pu()||n.getIsMenuOpen()))return;if(a.key===","&&((c=document.activeElement)!=null&&c.ELEMENT_NODE&&ze(a),n.inputs.keys.has(a.code))){const{x:d,y:u,z:h}=n.inputs.currentScreenPoint;n.inputs.keys.delete(a.code);const p={type:"pointer",name:"pointer_up",point:{x:d,y:u,z:h},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(p);return}const l={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};n.dispatch(l)};function o(a){var l,c;if(e.contains(a.target)){const d=a.touches[0].pageX,u=a.touches[0].radiusX||0;(d-u<10||d+u>n.getViewportScreenBounds().width-10)&&(((l=a.target)==null?void 0:l.tagName)==="BUTTON"&&((c=a.target)==null||c.click()),ze(a))}}const s=a=>{e.contains(a.target)&&(a.ctrlKey||a.metaKey)&&ze(a)};return e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("wheel",s,{passive:!1}),document.addEventListener("gesturestart",ze),document.addEventListener("gesturechange",ze),document.addEventListener("gestureend",ze),e.addEventListener("keydown",r),e.addEventListener("keyup",i),()=>{e.removeEventListener("touchstart",o),e.removeEventListener("wheel",s),document.removeEventListener("gesturestart",ze),document.removeEventListener("gesturechange",ze),document.removeEventListener("gestureend",ze),e.removeEventListener("keydown",r),e.removeEventListener("keyup",i)}},[n,e,t])}const t9=["input","select","button","textarea"];function pu(){const{activeElement:n}=document;return!!(n&&(n.getAttribute("contenteditable")||t9.indexOf(n.tagName.toLowerCase())>-1))}const n9={error:null};class _I extends S.Component{constructor(){super(...arguments);y(this,"state",n9)}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t){var r,i;(i=(r=this.props).onError)==null||i.call(r,t)}render(){const{error:t}=this.state;if(t!==null){const{fallback:r}=this.props;return m.jsx(r,{error:t})}return this.props.children}}function fu({children:n,fallback:e,...t}){return e===null?m.jsx(m.Fragment,{children:n}):m.jsx(_I,{fallback:e,...t,children:n})}class r9{constructor(e){this.shape=e}equals(e){var t,r,i,o,s,a;return((t=this.shape)==null?void 0:t.isLocked)===((r=e==null?void 0:e.shape)==null?void 0:r.isLocked)&&((i=this.shape)==null?void 0:i.props)===((o=e==null?void 0:e.shape)==null?void 0:o.props)&&((s=this.shape)==null?void 0:s.meta)===((a=e==null?void 0:e.shape)==null?void 0:a.meta)}}const i9=({shape:n,util:e})=>If("Indicator:"+n.type,()=>e.indicator(n)),o9=({editor:n,id:e})=>{const t=q("shape",()=>new r9(n.store.get(e)),[n,e]),{ShapeIndicatorErrorFallback:r}=Kt();return!t.shape||t.shape.isLocked?null:m.jsx(fu,{fallback:r,onError:i=>n.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:m.jsx(i9,{shape:t.shape,util:n.getShapeUtil(t.shape)},t.shape.id)})},s9=({id:n,className:e,color:t,opacity:r})=>{const i=G(),o=q("transform",()=>{const s=i.getShapePageTransform(n);return s?s.toCssString():""},[i,n]);return m.jsx("svg",{className:ye("tl-overlays__item",e),children:m.jsx("g",{className:"tl-shape-indicator",transform:o,stroke:t??"var(--color-selected)",opacity:r,children:m.jsx(o9,{editor:i,id:n})})})},gu=S.memo(s9);function a9(){return m.jsx("div",{className:"tl-background"})}function Gl(n,e,t,r,i,o){S.useLayoutEffect(()=>{const s=n.current;if(!s||e===void 0)return;let a=`translate(${e}px, ${t}px)`;r!==void 0&&(a+=` scale(${r})`),i!==void 0&&(a+=` rotate(${i}rad)`),o&&(a+=` translate(${o.x}px, ${o.y}px)`),s.style.transform=a})}const _n={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class C{constructor(e=0,t=0,r=1){this.x=e,this.y=t,this.z=r}get pressure(){return this.z}set(e=this.x,t=this.y,r=this.z){return this.x=e,this.y=t,this.z=r,this}setTo({x:e=0,y:t=0,z:r=1}){return this.x=e,this.y=t,this.z=r,this}rot(e){if(e===0)return this;const{x:t,y:r}=this,i=Math.sin(e),o=Math.cos(e);return this.x=t*o-r*i,this.y=t*i+r*o,this}rotWith(e,t){if(t===0)return this;const r=this.x-e.x,i=this.y-e.y,o=Math.sin(t),s=Math.cos(t);return this.x=e.x+(r*s-i*o),this.y=e.y+(r*o+i*s),this}clone(){const{x:e,y:t,z:r}=this;return new C(e,t,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const r=C.Tan(e,this);return this.add(r.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return C.Dpr(this,e)}cpr(e){return C.Cpr(this,e)}len2(){return C.Len2(this)}len(){return C.Len(this)}pry(e){return C.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return C.Uni(this)}tan(e){return C.Tan(this,e)}dist(e){return C.Dist(this,e)}distanceToLineSegment(e,t){return C.DistanceToLineSegment(e,t,this)}slope(e){return C.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return C.Angle(this,e)}toAngle(){return C.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return C.Equals(this,e)}equalsXY(e,t){return C.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return C.ToFixed(this)}toString(){return C.ToString(C.ToFixed(this))}toJson(){return C.ToJson(this)}toArray(){return C.ToArray(this)}static Add(e,t){return new C(e.x+t.x,e.y+t.y)}static AddXY(e,t,r){return new C(e.x+t,e.y+r)}static Sub(e,t){return new C(e.x-t.x,e.y-t.y)}static SubXY(e,t,r){return new C(e.x-t,e.y-r)}static AddScalar(e,t){return new C(e.x+t,e.y+t)}static SubScalar(e,t){return new C(e.x-t,e.y-t)}static Div(e,t){return new C(e.x/t,e.y/t)}static Mul(e,t){return new C(e.x*t,e.y*t)}static DivV(e,t){return new C(e.x/t.x,e.y/t.y)}static MulV(e,t){return new C(e.x*t.x,e.y*t.y)}static Neg(e){return new C(-e.x,-e.y)}static Per(e){return new C(e.y,-e.x)}static Dist2(e,t){return C.Sub(e,t).len2()}static Abs(e){return new C(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return Math.hypot(e.y-t.y,e.x-t.x)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new C(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return Math.hypot(e.x,e.y)}static Pry(e,t){return C.Dpr(e,t)/C.Len(t)}static Uni(e){return C.Div(e,C.Len(e))}static Tan(e,t){return C.Uni(C.Sub(e,t))}static Min(e,t){return new C(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new C(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:r=1}){return new C(e,t,r)}static FromArray(e){return new C(e[0],e[1])}static Rot(e,t=0){const r=Math.sin(t),i=Math.cos(t);return new C(e.x*i-e.y*r,e.x*r+e.y*i)}static RotWith(e,t,r){const i=e.x-t.x,o=e.y-t.y,s=Math.sin(r),a=Math.cos(r);return new C(t.x+(i*a-o*s),t.y+(i*s+o*a))}static NearestPointOnLineThroughPoint(e,t,r){return C.Mul(t,C.Sub(r,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,r,i=!0){const o=C.Tan(t,e),s=C.Add(e,C.Mul(o,C.Sub(r,e).pry(o)));if(i){if(s.x<Math.min(e.x,t.x))return C.Cast(e.x<t.x?e:t);if(s.x>Math.max(e.x,t.x))return C.Cast(e.x>t.x?e:t);if(s.y<Math.min(e.y,t.y))return C.Cast(e.y<t.y?e:t);if(s.y>Math.max(e.y,t.y))return C.Cast(e.y>t.y?e:t)}return s}static DistanceToLineThroughPoint(e,t,r){return C.Dist(r,C.NearestPointOnLineThroughPoint(e,t,r))}static DistanceToLineSegment(e,t,r,i=!0){return C.Dist(r,C.NearestPointOnLineSegment(e,t,r,i))}static Snap(e,t=1){return new C(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof C?e:C.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,r){return C.Sub(t,e).mul(r).add(e)}static Med(e,t){return new C((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,r){return e.x===t&&e.y===r}static Clockwise(e,t,r){return(r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y)<0}static Rescale(e,t){const r=C.Len(e);return new C(t*e.x/r,t*e.y/r)}static ScaleWithOrigin(e,t,r){return C.Sub(e,r).mul(t).add(r)}static ToFixed(e,t=2){return new C(+e.x.toFixed(t),+e.y.toFixed(t),+e.z.toFixed(t))}static Nudge(e,t,r){return C.Add(e,C.Tan(t,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new C(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:r,z:i}=e;return{x:t,y:r,z:i}}static Average(e){const t=e.length,r=new C(0,0);for(let i=0;i<t;i++)r.add(e[i]);return r.div(t)}static Clamp(e,t,r){return r===void 0?new C(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new C(Math.min(Math.max(e.x,t),r),Math.min(Math.max(e.y,t),r))}static PointsBetween(e,t,r=6){const i=[];for(let o=0;o<r;o++){const s=_n.easeInQuad(o/(r-1)),a=C.Lrp(e,t,s);a.z=Math.min(1,.5+Math.abs(.5-l9(s))*.65),i.push(a)}return i}static SnapToGrid(e,t=8){return new C(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const l9=n=>n<.5?2*n*n:-1+(4-2*n)*n;function on(n){return`${R(n.x)},${R(n.y)} `}function tr(n,e){return`${R((n.x+e.x)/2)},${R((n.y+e.y)/2)} `}const Ue=Math.PI,at=Ue/2,Xe=Ue*2,c9=Math.sin;function Li(n,e,t){return Math.max(e,typeof t<"u"?Math.min(n,t):n)}function Jf(n,e=1e10){return n?Math.round(n*e)/e:0}function mu(n,e,t=1e-6){return Math.abs(n-e)<=t}function yu(n,e){const t=Math.pow(n-e,2)/Math.pow(n+e,2);return Ue*(n+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function si(n){return n=n%Xe,n<0?n=n+Xe:n===0&&(n=0),n}function Zf(n,e){return n=si(n),e=si(e),n>e&&(e+=Xe),e-n}function d9(n,e){return Xe-Zf(n,e)}function wu(n,e){const t=(e-n)%Xe;return 2*t%Xe-t}function hv(n){return(Xe+n)%Xe}function Qf(n,e){const t=Xe/e;let r=Math.floor((hv(n)+t/2)/t)*t%Xe;return r<Ue&&(r+=Xe),r>Ue&&(r-=Xe),r}function kI(n,e){return n===e||mu(n%(Math.PI/2)-e%(Math.PI/2),0)}function u9(n){return n*Ue/180}function h9(n){return n*180/Ue}function CI(n,e,t,r){return new C(n+t*Math.cos(r),e+t*Math.sin(r))}function pv(n,e,t){const r=n/2,i=e/2,o=[];let s=1/0,a=-1/0,l=1/0,c=-1/0;for(let g=0;g<t;g++){const f=Xe/t,w=-at+g*f,v=r+r*Math.cos(w),b=i+i*Math.sin(w);v<s&&(s=v),b<l&&(l=b),v>a&&(a=v),b>c&&(c=b),o.push(new C(v,b))}const d=a-s,u=c-l,h=n-d,p=e-u;if(h!==0||p!==0)for(let g=0;g<o.length;g++){const f=o[g];f.x=(f.x-s)/d*n,f.y=(f.y-l)/u*e}return o}function bu(n,e,t,r){return n<r&&t<e}function ai(n,e,t,r){const i=Math.max(n,t),o=Math.min(e,r);return i<=o?[i,o]:null}function EI(n,e,t){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}function zi(n,e){let t=0,r,i;for(let o=0;o<e.length;o++){if(r=e[o],r.x===n.x&&r.y===n.y||(i=e[(o+1)%e.length],C.Dist(n,r)+C.Dist(n,i)===C.Dist(r,i)))return!0;r.y<=n.y?i.y>n.y&&EI(r,i,n)>0&&(t+=1):i.y<=n.y&&EI(r,i,n)<0&&(t-=1)}return t!==0}function R(n){return+n.toFixed(4)}function eg(n){return+n.toFixed(2)}const PI=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER,tg=({brush:n,color:e,opacity:t,className:r})=>{const i=S.useRef(null);Gl(i,n.x,n.y);const o=R(Math.max(1,n.w)),s=R(Math.max(1,n.h));return m.jsx("svg",{className:"tl-overlays__item",ref:i,children:e?m.jsxs("g",{className:"tl-brush",opacity:t,children:[m.jsx("rect",{width:o,height:s,fill:e,opacity:.75}),m.jsx("rect",{width:o,height:s,fill:"none",stroke:e,opacity:.1})]}):m.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:o,height:s})})},p9=({className:n,zoom:e,point:t,color:r,viewport:i,opacity:o=1})=>{const s=S.useRef(null);return Gl(s,Li(t.x,i.minX+5/e,i.maxX-5/e),Li(t.y,i.minY+5/e,i.maxY-5/e),1/e,C.Angle(i.center,t)),m.jsxs("svg",{ref:s,className:ye("tl-overlays__item",n),children:[m.jsx("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),m.jsx("use",{href:"#cursor_hint",color:r,opacity:o})]})},f9=({className:n,zoom:e,point:t,color:r,name:i,chatMessage:o})=>{const s=S.useRef(null);return Gl(s,t==null?void 0:t.x,t==null?void 0:t.y,1/e),t?m.jsxs("div",{ref:s,className:ye("tl-overlays__item",n),children:[m.jsx("svg",{className:"tl-cursor",children:m.jsx("use",{href:"#cursor",color:r})}),o?m.jsxs(m.Fragment,{children:[i&&m.jsx("div",{className:"tl-nametag-title",style:{color:r},children:i}),m.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:o})]}):i&&m.jsx("div",{className:"tl-nametag",style:{backgroundColor:r},children:i})]}):null},II=S.memo(f9),fv={openWindow:(n,e)=>window.open(n,e,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var n;return await((n=window.__tldraw__hardReset)==null?void 0:n.call(window))}};function MI(){fv.hardReset()}function g9(){fv.refreshPage()}const m9="https://github.com/tldraw/tldraw/issues/new";function y9(){}const AI=({error:n,editor:e})=>{const t=S.useRef(null),[r,i]=S.useState(!1),[o,s]=S.useState(!1),[a,l]=S.useState(!1),c=n instanceof Error?n.message:String(n),d=n instanceof Error?n.stack:null,u=q("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[h,p]=S.useState(null);S.useLayoutEffect(()=>{var x;u!==null&&p(u);let b=(x=t.current)==null?void 0:x.parentElement,_=!1;for(;b;){if(b.classList.contains("tl-theme__dark")||b.classList.contains("tl-theme__light")){_=!0;break}b=b.parentElement}if(_){p(null);return}p(window.matchMedia("(prefers-color-scheme: dark)").matches)},[u]),S.useEffect(()=>{if(o){const b=setTimeout(()=>{s(!1)},2e3);return()=>clearTimeout(b)}},[o]);const g=()=>{const b=document.createElement("textarea");b.value=d??c,document.body.appendChild(b),b.select(),document.execCommand("copy"),b.remove(),s(!0)},f=()=>{g9()},w=async()=>{MI()},v=new URL(m9);return v.searchParams.set("title",c),v.searchParams.set("labels","bug"),v.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${d??c}
\`\`\`

My browser: ${navigator.userAgent}`),m.jsxs("div",{ref:t,className:ye("tl-container tl-error-boundary",h===null?"":h?"tl-theme__dark":"tl-theme__light"),children:[m.jsx("div",{className:"tl-error-boundary__overlay"}),e&&m.jsx(_I,{onError:y9,fallback:()=>null,children:m.jsx(uv.Provider,{value:e,children:m.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:m.jsx(Pv,{})})})}),m.jsx("div",{className:ye("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?m.jsxs(m.Fragment,{children:[m.jsx("h2",{children:"Are you sure?"}),m.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),m.jsxs("div",{className:"tl-error-boundary__content__actions",children:[m.jsx("button",{onClick:()=>l(!1),children:"Cancel"}),m.jsx("button",{className:"tl-error-boundary__reset",onClick:w,children:"Reset data"})]})]}):m.jsxs(m.Fragment,{children:[m.jsx("h2",{children:"Something's gone wrong."}),m.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",m.jsx("a",{href:v.toString(),children:"create a GitHub issue"})," or"," ",m.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&m.jsxs("div",{className:"tl-error-boundary__content__error",children:[m.jsx("pre",{children:m.jsx("code",{children:d??c})}),m.jsx("button",{onClick:g,children:o?"Copied!":"Copy"})]}),m.jsxs("div",{className:"tl-error-boundary__content__actions",children:[m.jsx("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),m.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[m.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),m.jsx("button",{className:"tl-error-boundary__refresh",onClick:f,children:"Refresh Page"})]})]})]})})]})},Eo=2e3,ng=40,Po=320,Yl=[.1,.25,.5,1,2,4,8],vu=.1,xs=8,w9=.5,b9=.1,v9=.2,S9=.005,x9=.05,_9=450,k9=200,gv=6,Su=4,C9=32,rg={};for(let n=1;n<=Math.ceil(xs);n++)rg[n+"_dark"]=`hash_pattern_zoom_${n}_dark`,rg[n+"_light"]=`hash_pattern_zoom_${n}_light`;const E9={duration:0,easing:_n.easeInOutCubic},ig=.09,TI=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],P9=6e4,jI=3e3,I9=1200,RI={CAMERA_MOVE:-10},M9=64,A9=620,li=8,T9=20,Xl=32,j9=({x:n,y:e,z:t,size:r})=>m.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("defs",{children:TI.map(({min:i,mid:o,step:s},a)=>{const l=s*r*t,c=.5+n*t,d=.5+e*t,u=c>0?c%l:l+c%l,h=d>0?d%l:l+d%l,p=t<o?jf(t,[i,o],[0,1]):1;return m.jsx("pattern",{id:`grid-${s}`,width:l,height:l,patternUnits:"userSpaceOnUse",children:m.jsx("circle",{className:"tl-grid-dot",cx:u,cy:h,r:1,opacity:p})},`grid-pattern-${a}`)})}),TI.map(({step:i},o)=>m.jsx("rect",{width:"100%",height:"100%",fill:`url(#grid-${i})`},`grid-rect-${o}`))]}),R9=({handle:n,isCoarse:e,className:t,zoom:r})=>{const i=(e?20:12)/r,o=(n.type==="create"&&e?3:4)/r;return m.jsxs("g",{className:ye("tl-handle",{"tl-handle__virtual":n.type==="virtual","tl-handle__create":n.type==="create"},t),children:[m.jsx("circle",{className:"tl-handle__bg",r:i}),m.jsx("circle",{className:"tl-handle__fg",r:o})]})},D9=({children:n})=>m.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),O9=({shapeId:n})=>m.jsx(gu,{className:"tl-user-indicator__hovered",id:n});function xu(n,e=!0){const t=n.length;if(t<2)return"";let r=n[0],i=n[1];if(t===2)return`M${on(r)}L${on(i)}`;let o="";for(let s=2,a=t-1;s<a;s++)r=n[s],i=n[s+1],o+=tr(r,i);return e?`M${tr(n[0],n[1])}Q${on(n[1])}${tr(n[1],n[2])}T${o}${tr(n[t-1],n[0])}${tr(n[0],n[1])}Z`:`M${on(n[0])}Q${on(n[1])}${tr(n[1],n[2])}${n.length>3?"T":""}${o}L${on(n[t-1])}`}const DI=({scribble:n,zoom:e,color:t,opacity:r,className:i})=>n.points.length?m.jsx("svg",{className:i&&ye("tl-overlays__item",i),children:m.jsx("path",{className:"tl-scribble",d:xu(n.points,!1),stroke:t??`var(--color-${n.color})`,fill:"none",strokeWidth:8/e,opacity:r??n.opacity})}):null,OI=({bounds:n,rotation:e})=>{const t=S.useRef(null);return Gl(t,n.x,n.y,1,e),S.useLayoutEffect(()=>{const r=t.current;r&&(r.style.width=R(Math.max(1,n.width))+"px",r.style.height=R(Math.max(1,n.height))+"px")},[n.width,n.height]),m.jsx("div",{ref:t,className:"tl-selection__bg",draggable:!1})},L9=({bounds:n,rotation:e})=>{const t=G(),r=S.useRef(null),i=q("only selected shape",()=>t.getOnlySelectedShape(),[t]),o=i?t.getShapeUtil(i).expandSelectionOutlinePx(i):0;return Gl(r,n==null?void 0:n.x,n==null?void 0:n.y,1,e,{x:-o,y:-o}),n=n.clone().expandBy(o).zeroFix(),m.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:m.jsx("rect",{className:ye("tl-selection__fg__outline"),width:R(n.width),height:R(n.height)})})},z9=()=>m.jsx("div",{className:"tl-shape-error-boundary"}),N9=()=>m.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function F9({points:n,zoom:e}){const t=2.5/e,r=n.reduce((h,p)=>Math.min(h,p.x),1/0),i=n.reduce((h,p)=>Math.max(h,p.x),-1/0),o=n.reduce((h,p)=>Math.min(h,p.y),1/0),s=n.reduce((h,p)=>Math.max(h,p.y),-1/0),a=n.some(h=>h.x===r&&h.y===o);let l,c,d,u;return a?(l=r,c=o,d=i,u=s):(l=r,c=s,d=i,u=o),m.jsxs("g",{className:"tl-snap-line",children:[m.jsx("line",{x1:l,y1:c,x2:d,y2:u}),n.map((h,p)=>m.jsx("g",{transform:`translate(${h.x},${h.y})`,children:m.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},p))]})}function $9({gaps:n,direction:e,zoom:t}){const r=3.5/t;let i=[-1/0,1/0],o=null;const s=e==="horizontal";for(const l of n){if(o=ai(i[0],i[1],s?l.startEdge[0].y:l.startEdge[0].x,s?l.startEdge[1].y:l.startEdge[1].x),o)i=o;else continue;if(o=ai(i[0],i[1],s?l.endEdge[0].y:l.endEdge[0].x,s?l.endEdge[1].y:l.endEdge[1].x),o)i=o;else continue}if(i===null)return null;const a=(i[0]+i[1])/2;return m.jsx("g",{className:"tl-snap-line",children:n.map(({startEdge:l,endEdge:c},d)=>m.jsx(S.Fragment,{children:s?m.jsxs(m.Fragment,{children:[m.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),m.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),m.jsx("line",{x1:l[0].x,y1:a,x2:c[0].x,y2:a}),m.jsx("line",{x1:(l[0].x+c[0].x)/2,y1:a-r,x2:(l[0].x+c[0].x)/2,y2:a+r})]}):m.jsxs(m.Fragment,{children:[m.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),m.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),m.jsx("line",{x1:a,y1:l[0].y,x2:a,y2:c[0].y}),m.jsx("line",{x1:a-r,y1:(l[0].y+c[0].y)/2,x2:a+r,y2:(l[0].y+c[0].y)/2})]})},d))})}const B9=({className:n,line:e,zoom:t})=>m.jsx("svg",{className:ye("tl-overlays__item",n),children:e.type==="points"?m.jsx(F9,{...e,zoom:t}):e.type==="gaps"?m.jsx($9,{...e,zoom:t}):null}),U9=()=>m.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:m.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[m.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),m.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:m.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}),V9=()=>null,LI=S.createContext({});function H9({overrides:n,children:e}){return m.jsx(LI.Provider,{value:S.useMemo(()=>({Background:a9,SvgDefs:V9,Brush:tg,ZoomBrush:tg,ScreenshotBrush:tg,CollaboratorBrush:tg,Cursor:II,CollaboratorCursor:II,CollaboratorHint:p9,CollaboratorShapeIndicator:gu,Grid:j9,Scribble:DI,SnapLine:B9,Handles:D9,Handle:R9,CollaboratorScribble:DI,ErrorFallback:AI,ShapeErrorFallback:z9,ShapeIndicatorErrorFallback:N9,Spinner:U9,SelectionBackground:OI,SelectionForeground:L9,HoveredShapeIndicator:O9,OnTheCanvas:null,InFrontOfTheCanvas:null,...n}),[n]),children:e})}function Kt(){return S.useContext(LI)}const W9=["textarea","input"];function K9(n){const e=G();S.useEffect(()=>{const t=n.current;if(!t)return;const r=i=>{var o;if(i instanceof PointerEvent&&i.pointerType==="pen"){i.isKilled=!0;const{target:s}=i;if(W9.includes((o=s.tagName)==null?void 0:o.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;ze(i)}};return t.addEventListener("touchstart",r),t.addEventListener("touchend",r),()=>{t.removeEventListener("touchstart",r),t.removeEventListener("touchend",r)}},[e,n])}function G9(n,e,t){return Math.max(e,Math.min(n,t))}const sn={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function zI(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function NI(n,e,t,r=.15){return r===0?G9(n,e,t):n<e?-zI(e-n,t-e,r)+e:n>t?+zI(n-t,t-e,r)+t:n}function Y9(n,[e,t],[r,i]){const[[o,s],[a,l]]=n;return[NI(e,o,s,r),NI(t,a,l,i)]}function X9(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function q9(n){var e=X9(n,"string");return typeof e=="symbol"?e:String(e)}function kn(n,e,t){return e=q9(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function FI(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function xt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?FI(Object(t),!0).forEach(function(r){kn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):FI(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const $I={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function BI(n){return n?n[0].toUpperCase()+n.slice(1):""}const J9=["enter","leave"];function Z9(n=!1,e){return n&&!J9.includes(e)}function Q9(n,e="",t=!1){const r=$I[n],i=r&&r[e]||e;return"on"+BI(n)+BI(i)+(Z9(t,i)?"Capture":"")}const e7=["gotpointercapture","lostpointercapture"];function t7(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const r=e7.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:t}}function n7(n,e=""){const t=$I[n],r=t&&t[e]||e;return n+r}function UI(n){return"touches"in n}function r7(n){return UI(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function i7(n){return Array.from(n.touches).filter(e=>{var t,r;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(r=t.contains)===null||r===void 0?void 0:r.call(t,e.target))})}function mv(n,e){try{const t=e.clientX-n.clientX,r=e.clientY-n.clientY,i=(e.clientX+n.clientX)/2,o=(e.clientY+n.clientY)/2,s=Math.hypot(t,r);return{angle:-(Math.atan2(t,r)*180)/Math.PI,distance:s,origin:[i,o]}}catch{}return null}function o7(n){return i7(n).map(e=>e.identifier)}function VI(n,e){const[t,r]=Array.from(n.touches).filter(i=>e.includes(i.identifier));return mv(t,r)}const HI=40,WI=800;function KI(n){let{deltaX:e,deltaY:t,deltaMode:r}=n;return r===1?(e*=HI,t*=HI):r===2&&(e*=WI,t*=WI),[e,t]}function s7(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:r,metaKey:i,ctrlKey:o}=n;Object.assign(e,{shiftKey:t,altKey:r,metaKey:i,ctrlKey:o})}return e}function og(n,...e){return typeof n=="function"?n(...e):n}function a7(){}function l7(...n){return n.length===0?a7:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function GI(n,e){return Object.assign({},e,n||{})}const c7=32;class YI{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?og(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:i}=this;t.args=this.args;let o=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,s7(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,o=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const k=t._delta.map(Math.abs);sn.addTo(t._distance,k)}this.axisIntent&&this.axisIntent(e);const[s,a]=t._movement,[l,c]=r.threshold,{_step:d,values:u}=t;if(r.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(s)>=l&&u[0]),d[1]===!1&&(d[1]=Math.abs(a)>=c&&u[1])):(d[0]===!1&&(d[0]=Math.abs(s)>=l&&Math.sign(s)*l),d[1]===!1&&(d[1]=Math.abs(a)>=c&&Math.sign(a)*c)),t.intentional=d[0]!==!1||d[1]!==!1,!t.intentional)return;const h=[0,0];if(r.hasCustomTransform){const[k,P]=u;h[0]=d[0]!==!1?k-d[0]:0,h[1]=d[1]!==!1?P-d[1]:0}else h[0]=d[0]!==!1?s-d[0]:0,h[1]=d[1]!==!1?a-d[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);const p=t.offset,g=t._active&&!t._blocked||t.active;g&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=og(r.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));const[f,w]=t.offset,[[v,b],[_,x]]=t._bounds;t.overflow=[f<v?-1:f>b?1:0,w<_?-1:w>x?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const E=t._active?r.rubberband||[0,0]:[0,0];if(t.offset=Y9(t._bounds,t.offset,E),t.delta=sn.sub(t.offset,p),this.computeMovement(),g&&(!t.last||o>c7)){t.delta=sn.sub(t.offset,p);const k=t.delta.map(Math.abs);sn.addTo(t.distance,k),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&o>0&&(t.velocity=[k[0]/o,k[1]/o],t.timeDelta=o)}}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(xt(xt(xt({},t),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function d7([n,e],t){const r=Math.abs(n),i=Math.abs(e);if(r>i&&r>t)return"x";if(i>r&&i>t)return"y"}class u7 extends YI{constructor(...e){super(...e),kn(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=sn.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=sn.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,r=this.config;if(!t.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[r7(e)]:r.axisThreshold;t.axis=d7(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const h7=n=>n,XI=.15,qI={enabled(n=!0){return n},eventOptions(n,e,t){return xt(xt({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[XI,XI];case!1:return[0,0];default:return sn.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return sn.toVector(n)},transform(n,e,t){const r=n||t.shared.transform;return this.hasCustomTransform=!!r,r||h7},threshold(n){return sn.toVector(n,0)}},p7=0,_u=xt(xt({},qI),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=p7){return n},bounds(n={}){if(typeof n=="function")return o=>_u.bounds(n(o));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:r=-1/0,bottom:i=1/0}=n;return[[e,t],[r,i]]}}),ku=typeof window<"u"&&window.document&&window.document.createElement;function f7(){return ku&&"ontouchstart"in window}function JI(){return f7()||ku&&window.navigator.maxTouchPoints>1}function g7(){return ku&&"onpointerdown"in window}function m7(){return ku&&"exitPointerLock"in window.document}function y7(){try{return"constructor"in GestureEvent}catch{return!1}}const $r={isBrowser:ku,gesture:y7(),touch:JI(),touchscreen:JI(),pointer:g7(),pointerLock:m7()},w7=250,b7=180,v7=.5,S7=50,x7=250,_7=10,ZI={mouse:0,touch:0,pen:8};xt(xt({},_u),{},{device(n,e,{pointer:{touch:t=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&$r.pointerLock,$r.touch&&t?"touch":this.pointerLock?"mouse":$r.pointer&&!i?"pointer":$r.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?w7:void 0,!(!$r.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:r=3,axis:i=void 0}){const o=sn.toVector(n,t?r:i?1:0);return this.filterTaps=t,this.tapsThreshold=r,o},swipe({velocity:n=v7,distance:e=S7,duration:t=x7}={}){return{velocity:this.transform(sn.toVector(n)),distance:this.transform(sn.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return b7;case!1:return 0;default:return n}},axisThreshold(n){return n?xt(xt({},ZI),n):ZI},keyboardDisplacement(n=_7){return n}});function QI(n){const[e,t]=n.overflow,[r,i]=n._delta,[o,s]=n._direction;(e<0&&r>0&&o<0||e>0&&r<0&&o>0)&&(n._movement[0]=n._movementBound[0]),(t<0&&i>0&&s<0||t>0&&i<0&&s>0)&&(n._movement[1]=n._movementBound[1])}const k7=30,C7=100;class E7 extends YI{constructor(...e){super(...e),kn(this,"ingKey","pinching"),kn(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:r}=this.state;e==="wheel"?this.state.offset=sn.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,r]=e._movement;if(!e.axis){const i=Math.abs(t)*k7-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(o=>r.has(o))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);const i=VI(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,r=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(s=>i.has(s))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const o=mv(...Array.from(r.values()));o&&this.pinchStart(e,o)}pinchStart(e,t){const r=this.state;r.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=VI(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const r=mv(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){const r=this.state,i=r._values[1],o=t.angle-i;let s=0;Math.abs(o)>270&&(s+=Math.sign(o)),this.computeValues([t.distance,t.angle-360*s]),r.origin=t.origin,r.turns=s,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=sn.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&!e[t]||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const t=this.state;t._delta=[-KI(e)[1]/C7*t.offset[0],0],sn.addTo(t._movement,t._delta),QI(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const P7=xt(xt({},qI),{},{device(n,e,{shared:t,pointer:{touch:r=!1}={}}){if(t.target&&!$r.touch&&$r.gesture)return"gesture";if($r.touch&&r)return"touch";if($r.touchscreen){if($r.pointer)return"pointer";if($r.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:r={}}){const i=s=>{const a=GI(og(t,s),{min:-1/0,max:1/0});return[a.min,a.max]},o=s=>{const a=GI(og(r,s),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof r!="function"?[i(),o()]:s=>[i(s),o(s)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",sn.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});xt(xt({},_u),{},{mouseOnly:(n=!0)=>n});class I7 extends u7{constructor(...e){super(...e),kn(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=KI(e),sn.addTo(t._movement,t._delta),QI(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const M7=_u;xt(xt({},_u),{},{mouseOnly:(n=!0)=>n});const yv=new Map,wv=new Map;function A7(n){yv.set(n.key,n.engine),wv.set(n.key,n.resolver)}const T7={key:"pinch",engine:E7,resolver:P7},j7={key:"wheel",engine:I7,resolver:M7};function R7(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function D7(n,e){if(n==null)return{};var t=R7(n,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}const O7={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=$r.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},L7=["target","eventOptions","window","enabled","transform"];function sg(n={},e){const t={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":t[r]=i.call(t,n[r],r,n);break;case"object":t[r]=sg(n[r],i);break;case"boolean":i&&(t[r]=n[r]);break}return t}function z7(n,e,t={}){const r=n,{target:i,eventOptions:o,window:s,enabled:a,transform:l}=r,c=D7(r,L7);if(t.shared=sg({target:i,eventOptions:o,window:s,enabled:a,transform:l},O7),e){const d=wv.get(e);t[e]=sg(xt({shared:t.shared},c),d)}else for(const d in c){const u=wv.get(d);u&&(t[d]=sg(xt({shared:t.shared},c[d]),u))}return t}class eM{constructor(e,t){kn(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,o){const s=this._listeners,a=n7(t,r),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=xt(xt({},l),o);e.addEventListener(a,i,c);const d=()=>{e.removeEventListener(a,i,c),s.delete(d)};return s.add(d),d}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class N7{constructor(){kn(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class F7{constructor(e){kn(this,"gestures",new Set),kn(this,"_targetEventStore",new eM(this)),kn(this,"gestureEventStores",{}),kn(this,"gestureTimeoutStores",{}),kn(this,"handlers",{}),kn(this,"config",{}),kn(this,"pointerIds",new Set),kn(this,"touchIds",new Set),kn(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),$7(this,e)}setEventIds(e){if(UI(e))return this.touchIds=new Set(o7(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=z7(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r={};let i;if(!(t.target&&(i=t.target(),!i))){if(t.enabled){for(const s of this.gestures){const a=this.config[s],l=tM(r,a.eventOptions,!!i);if(a.enabled){const c=yv.get(s);new c(this,e,s).bind(l)}}const o=tM(r,t.eventOptions,!!i);for(const s in this.nativeHandlers)o(s,"",a=>this.nativeHandlers[s](xt(xt({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const o in r)r[o]=l7(...r[o]);if(!i)return r;for(const o in r){const{device:s,capture:a,passive:l}=t7(o);this._targetEventStore.add(i,s,"",r[o],{capture:a,passive:l})}}}}function ql(n,e){n.gestures.add(e),n.gestureEventStores[e]=new eM(n,e),n.gestureTimeoutStores[e]=new N7}function $7(n,e){e.drag&&ql(n,"drag"),e.wheel&&ql(n,"wheel"),e.scroll&&ql(n,"scroll"),e.move&&ql(n,"move"),e.pinch&&ql(n,"pinch"),e.hover&&ql(n,"hover")}const tM=(n,e,t)=>(r,i,o,s={},a=!1)=>{var l,c;const d=(l=s.capture)!==null&&l!==void 0?l:e.capture,u=(c=s.passive)!==null&&c!==void 0?c:e.passive;let h=a?r:Q9(r,i,d);t&&u&&(h+="Passive"),n[h]=n[h]||[],n[h].push(o)},B7=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function U7(n){const e={},t={},r=new Set;for(let i in n)B7.test(i)?(r.add(RegExp.lastMatch),t[i]=n[i]):e[i]=n[i];return[t,e,r]}function Jl(n,e,t,r,i,o){if(!n.has(t)||!yv.has(r))return;const s=t+"Start",a=t+"End",l=c=>{let d;return c.first&&s in e&&e[s](c),t in e&&(d=e[t](c)),c.last&&a in e&&e[a](c),d};i[r]=l,o[r]=o[r]||{}}function V7(n,e){const[t,r,i]=U7(n),o={};return Jl(i,t,"onDrag","drag",o,e),Jl(i,t,"onWheel","wheel",o,e),Jl(i,t,"onScroll","scroll",o,e),Jl(i,t,"onPinch","pinch",o,e),Jl(i,t,"onMove","move",o,e),Jl(i,t,"onHover","hover",o,e),{handlers:o,config:e,nativeHandlers:r}}function H7(n,e={},t,r){const i=re.useMemo(()=>new F7(n),[]);if(i.applyHandlers(n,r),i.applyConfig(e,t),re.useEffect(i.effect.bind(i)),re.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function W7(n){return n.forEach(A7),function(e,t){const{handlers:r,nativeHandlers:i,config:o}=V7(e,t||{});return H7(r,o,void 0,i)}}const nM=10,K7=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function rM(n){let{deltaY:e,deltaX:t}=n,r=0;if(n.ctrlKey||n.altKey||n.metaKey){const i=Math.sign(n.deltaY),o=Math.abs(n.deltaY);let s=e;o>nM&&(s=nM*i),r=s/100}else n.shiftKey&&!K7&&(t=e,e=0);return{x:-t,y:-e,z:-r}}const G7=W7([j7,T7]);let Zl;const Y7=n=>Zl===void 0?(Zl=n,!1):n-Zl>120&&n-Zl<160?(Zl=n,!0):(Zl=n,!1);function X7(n){const e=G(),t=S.useMemo(()=>{let r="not sure";const i=({event:p})=>{var b;if(!e.getInstanceState().isFocused||(r="not sure",Y7(Date.now())))return;const g=e.getEditingShapeId();if(g){const _=e.getShape(g);if(_&&e.getShapeUtil(_).canScroll(_)&&((b=e.getShapePageBounds(g))!=null&&b.containsPoint(e.inputs.currentPagePoint)))return}ze(p);const f=rM(p);if(f.x===0&&f.y===0)return;const w=e.getContainer().getBoundingClientRect(),v={type:"wheel",name:"wheel",delta:f,point:new C(p.clientX,p.clientY).sub({x:w.left,y:w.top}),shiftKey:p.shiftKey,altKey:p.altKey,ctrlKey:p.metaKey||p.ctrlKey};e.dispatch(v)};let o=1,s=1,a=1,l=0;const c=new C,d=new C,u=p=>{const g=n.current;r="not sure";const{event:f,origin:w,da:v}=p;f instanceof WheelEvent||(f.target===g||g!=null&&g.contains(f.target))&&(d.x=w[0],d.y=w[1],c.x=w[0],c.y=w[1],o=v[0],s=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:w[0],y:w[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey}))},h=p=>{if(p&&(r="zooming"),r==="zooming")return;const g=Math.abs(l-o),f=C.Dist(c,d);switch(r){case"not sure":{g>24?r="zooming":f>16&&(r="panning");break}case"panning":{g>64&&(r="zooming");break}}};return{onWheel:i,onPinchStart:u,onPinchEnd:p=>{const g=n.current,{event:f,origin:w,offset:v}=p;if(f instanceof WheelEvent||!(f.target===g||g!=null&&g.contains(f.target)))return;const b=v[0];r="not sure",requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:w[0],y:w[1],z:b},delta:{x:w[0],y:w[1]},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey})})},onPinch:p=>{const g=n.current,{event:f,origin:w,offset:v,da:b}=p;if(f instanceof WheelEvent||!(f.target===g||g!=null&&g.contains(f.target)))return;const _=p.type==="gesturechange"||p.type==="gestureend";l=b[0];const x=w[0]-d.x,E=w[1]-d.y;switch(d.x=w[0],d.y=w[1],h(_),r){case"zooming":{a=v[0],e.dispatch({type:"pinch",name:"pinch",point:{x:w[0],y:w[1],z:a},delta:{x,y:E},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:w[0],y:w[1],z:s},delta:{x,y:E},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey});break}}}}},[e,n]);G7(t,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>({from:e.getZoomLevel(),max:8,min:.05})}})}function bv(n,e,t){const r=n.getShape(e),i=n.getShapeHandles(r);return{shape:r,handle:i.find(o=>o.id===t)}}function q7(n,e){const t=G();return S.useMemo(()=>{const r=s=>{if(s.isKilled)return;const a=qf(s.currentTarget);uu(a,s);const{shape:l,handle:c}=bv(t,n,e);c&&t.dispatch({type:"pointer",target:"handle",handle:c,shape:l,name:"pointer_down",...er(s)})};let i,o;return{onPointerDown:r,onPointerMove:s=>{if(s.isKilled||s.clientX===i&&s.clientY===o)return;i=s.clientX,o=s.clientY;const{shape:a,handle:l}=bv(t,n,e);l&&t.dispatch({type:"pointer",target:"handle",handle:l,shape:a,name:"pointer_move",...er(s)})},onPointerUp:s=>{if(s.isKilled)return;const a=qf(s.currentTarget);hu(a,s);const{shape:l,handle:c}=bv(t,n,e);c&&t.dispatch({type:"pointer",target:"handle",handle:c,shape:l,name:"pointer_up",...er(s)})}}},[t,n,e])}var iM="Expected a function",oM=0/0,J7="[object Symbol]",Z7=/^\s+|\s+$/g,Q7=/^[-+]0x[0-9a-f]+$/i,e$=/^0b[01]+$/i,t$=/^0o[0-7]+$/i,n$=parseInt,r$=typeof Ge=="object"&&Ge&&Ge.Object===Object&&Ge,i$=typeof self=="object"&&self&&self.Object===Object&&self,o$=r$||i$||Function("return this")(),s$=Object.prototype,a$=s$.toString,l$=Math.max,c$=Math.min,vv=function(){return o$.Date.now()};function d$(n,e,t){var r,i,o,s,a,l,c=0,d=!1,u=!1,h=!0;if(typeof n!="function")throw new TypeError(iM);e=sM(e)||0,ag(t)&&(d=!!t.leading,u="maxWait"in t,o=u?l$(sM(t.maxWait)||0,e):o,h="trailing"in t?!!t.trailing:h);function p(k){var P=r,I=i;return r=i=void 0,c=k,s=n.apply(I,P),s}function g(k){return c=k,a=setTimeout(v,e),d?p(k):s}function f(k){var P=k-l,I=k-c,A=e-P;return u?c$(A,o-I):A}function w(k){var P=k-l,I=k-c;return l===void 0||P>=e||P<0||u&&I>=o}function v(){var k=vv();if(w(k))return b(k);a=setTimeout(v,f(k))}function b(k){return a=void 0,h&&r?p(k):(r=i=void 0,s)}function _(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function x(){return a===void 0?s:b(vv())}function E(){var k=vv(),P=w(k);if(r=arguments,i=this,l=k,P){if(a===void 0)return g(l);if(u)return a=setTimeout(v,e),p(l)}return a===void 0&&(a=setTimeout(v,e)),s}return E.cancel=_,E.flush=x,E}function u$(n,e,t){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(iM);return ag(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),d$(n,e,{leading:r,maxWait:e,trailing:i})}function ag(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function h$(n){return!!n&&typeof n=="object"}function p$(n){return typeof n=="symbol"||h$(n)&&a$.call(n)==J7}function sM(n){if(typeof n=="number")return n;if(p$(n))return oM;if(ag(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=ag(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(Z7,"");var t=e$.test(n);return t||t$.test(n)?n$(n.slice(2),t?2:8):Q7.test(n)?oM:+n}var f$=u$;const g$=sr(f$);function m$(){const n=G();S.useLayoutEffect(()=>{const e=g$(()=>{n.updateViewportScreenBounds()},200,{trailing:!0});n.updateViewportScreenBounds();const t=setInterval(e,1e3);return window.addEventListener("resize",e),window.addEventListener("scroll",e),()=>{clearInterval(t),window.removeEventListener("resize",e),window.removeEventListener("scroll",e)}},[n])}const yt=class yt{constructor(e=0,t=0,r=0,i=0){y(this,"x",0);y(this,"y",0);y(this,"w",0);y(this,"h",0);this.x=e,this.y=t,this.w=r,this.h=i}get point(){return new C(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new C(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new C(this.minX,this.minY),new C(this.maxX,this.minY),new C(this.maxX,this.maxY),new C(this.minX,this.maxY)]}get snapPoints(){return[new C(this.minX,this.minY),new C(this.maxX,this.minY),new C(this.maxX,this.maxY),new C(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new C(this.w,this.h)}toFixed(){return this.x=Jf(this.x),this.y=Jf(this.y),this.w=Jf(this.w),this.h=Jf(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,r=0,i=0){return this.x=e,this.y=t,this.w=r,this.h=i,this}expand(e){const t=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),i=Math.max(this.maxX,e.maxX),o=Math.max(this.maxY,e.maxY);return this.x=t,this.y=r,this.w=i-t,this.h=o-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:r,h:i}=this;return new yt(e,t,r,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,i=Math.round(this.maxX/e)*e,o=Math.round(this.maxY/e)*e;this.minX=t,this.minY=r,this.width=Math.max(1,i-t),this.height=Math.max(1,o-r)}collides(e){return yt.Collides(this,e)}contains(e){return yt.Contains(this,e)}includes(e){return yt.Includes(this,e)}containsPoint(e,t=0){return yt.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new C(this.minX,this.minY);case"top_right":return new C(this.maxX,this.minY);case"bottom_left":return new C(this.minX,this.maxY);case"bottom_right":return new C(this.maxX,this.maxY);case"top":return new C(this.midX,this.minY);case"right":return new C(this.maxX,this.midY);case"bottom":return new C(this.midX,this.maxY);case"left":return new C(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,r){const{minX:i,minY:o,maxX:s,maxY:a}=this;let{minX:l,minY:c,maxX:d,maxY:u}=this;switch(e){case"left":case"top_left":case"bottom_left":{l+=t;break}case"right":case"top_right":case"bottom_right":{d+=t;break}}switch(e){case"top":case"top_left":case"top_right":{c+=r;break}case"bottom":case"bottom_left":case"bottom_right":{u+=r;break}}const h=(d-l)/(s-i),p=(u-c)/(a-o),g=h<0,f=p<0;if(g){const w=d;d=l,l=w}if(f){const w=u;u=c,c=w}this.minX=l,this.minY=c,this.width=Math.abs(d-l),this.height=Math.abs(u-c)}union(e){const t=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),i=Math.max(this.maxX,e.w+e.x),o=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=r,this.width=i-t,this.height=o-r,this}static From(e){return new yt(e.x,e.y,e.w,e.h)}static FromPoints(e){if(e.length===0)return new yt;let t=1/0,r=1/0,i=-1/0,o=-1/0,s;for(let a=0,l=e.length;a<l;a++)s=e[a],t=Math.min(s.x,t),r=Math.min(s.y,r),i=Math.max(s.x,i),o=Math.max(s.y,o);return new yt(t,r,i-t,o-r)}static Expand(e,t){const r=Math.min(t.minX,e.minX),i=Math.min(t.minY,e.minY),o=Math.max(t.maxX,e.maxX),s=Math.max(t.maxY,e.maxY);return new yt(r,i,o-r,s-i)}static ExpandBy(e,t){return new yt(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Resize(e,t,r,i,o=!1){const{minX:s,minY:a,maxX:l,maxY:c}=e;let{minX:d,minY:u,maxX:h,maxY:p}=e;switch(t){case"left":case"top_left":case"bottom_left":{d+=r;break}case"right":case"top_right":case"bottom_right":{h+=r;break}}switch(t){case"top":case"top_left":case"top_right":{u+=i;break}case"bottom":case"bottom_left":case"bottom_right":{p+=i;break}}const g=(h-d)/(l-s),f=(p-u)/(c-a),w=g<0,v=f<0;if(o){const _=(l-s)/(c-a),x=Math.abs(h-d),E=Math.abs(p-u),k=x*(f<0?1:-1)*(1/_),P=E*(g<0?1:-1)*_,I=_<x/E;switch(t){case"top_left":{I?u=p+k:d=h+P;break}case"top_right":{I?u=p+k:h=d-P;break}case"bottom_right":{I?p=u-k:h=d-P;break}case"bottom_left":{I?p=u-k:d=h+P;break}case"bottom":case"top":{const A=(d+h)/2,T=E*_;d=A-T/2,h=A+T/2;break}case"left":case"right":{const A=(u+p)/2,T=x/_;u=A-T/2,p=A+T/2;break}}}if(w){const _=h;h=d,d=_}if(v){const _=p;p=u,u=_}const b=new yt(d,u,Math.abs(h-d),Math.abs(p-u));return{box:b,scaleX:+(b.width/e.width*(g>0?1:-1)).toFixed(5),scaleY:+(b.height/e.height*(f>0?1:-1)).toFixed(5)}}equals(e){return yt.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new yt(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}};y(yt,"Collides",(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)),y(yt,"Contains",(e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX),y(yt,"Includes",(e,t)=>yt.Collides(e,t)||yt.Contains(e,t)),y(yt,"ContainsPoint",(e,t,r=0)=>!(t.x<e.minX-r||t.y<e.minY-r||t.x>e.maxX+r||t.y>e.maxY+r)),y(yt,"Common",e=>{let t=1/0,r=1/0,i=-1/0,o=-1/0;for(let s=0;s<e.length;s++){const a=e[s];t=Math.min(t,a.minX),r=Math.min(r,a.minY),i=Math.max(i,a.maxX),o=Math.max(o,a.maxY)}return new yt(t,r,i-t,o-r)}),y(yt,"Sides",(e,t=0)=>{const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]});let de=yt;function y$(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function w$(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function b$(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}const He=class He{constructor(e,t,r,i,o,s){y(this,"a",1);y(this,"b",0);y(this,"c",0);y(this,"d",1);y(this,"e",0);y(this,"f",0);this.a=e,this.b=t,this.c=r,this.d=i,this.e=o,this.f=s}equals(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:r,b:i,c:o,d:s,e:a,f:l}=this;return this.a=r*t.a+o*t.b,this.c=r*t.c+o*t.d,this.e=r*t.e+o*t.f+a,this.b=i*t.a+s*t.b,this.d=i*t.c+s*t.d,this.f=i*t.e+s*t.f+l,this}rotate(e,t,r){return e===0?this:t===void 0?this.multiply(He.Rotate(e)):this.translate(t,r).multiply(He.Rotate(e)).translate(-t,-r)}translate(e,t){return this.multiply(He.Translate(e,t))}scale(e,t){return this.multiply(He.Scale(e,t))}invert(){const{a:e,b:t,c:r,d:i,e:o,f:s}=this,a=e*i-t*r;return this.a=i/a,this.b=t/-a,this.c=r/-a,this.d=e/a,this.e=(i*o-r*s)/-a,this.f=(t*o-e*s)/a,this}applyToPoint(e){return He.applyToPoint(this,e)}applyToPoints(e){return He.applyToPoints(this,e)}rotation(){return He.Rotation(this)}point(){return He.Point(this)}decomposed(){return He.Decompose(this)}toCssString(){return He.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return He.Decompose(this)}clone(){return new He(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new He(1,0,0,1,0,0)}static Translate(e,t){return new He(1,0,0,1,e,t)}static Rotate(e,t,r){if(e===0)return He.Identity();const i=Math.cos(e),o=Math.sin(e),s=new He(i,o,-o,i,0,0);return t===void 0?s:He.Compose(He.Translate(t,r),s,He.Translate(-t,-r))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=He.Identity();for(let r=0,i=e.length;r<i;r++)t.multiply(e[r]);return t}static Point(e){return new C(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const r=Math.hypot(e.a,e.c);t=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=Math.hypot(e.b,e.d);t=at+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0;return hv(t)}static Decompose(e){let t,r,i;if(e.a!==0||e.c!==0){const o=Math.hypot(e.a,e.c);t=o,r=(e.a*e.d-e.b*e.c)/o,i=Math.acos(e.a/o)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const o=Math.hypot(e.b,e.d);t=(e.a*e.d-e.b*e.c)/o,r=o,i=at+Math.acos(e.b/o)*(e.d>0?-1:1)}else t=0,r=0,i=0;return{x:e.e,y:e.f,scaleX:t,scaleY:r,rotation:hv(i)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${R(e.a)}, ${R(e.b)}, ${R(e.c)}, ${R(e.d)}, ${R(e.e)}, ${R(e.f)})`}static applyToPoint(e,t){return new C(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,r){return[e.a*t+e.c*r+e.e,e.b*t+e.d*r+e.f]}static applyToPoints(e,t){return t.map(r=>new C(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,t){return new de(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new He(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof He?e:He.From(e)}};y(He,"Scale",(e,t,r,i)=>{const o=new He(e,0,0,t,0,0);return r===void 0?o:He.Compose(He.Translate(r,i),o,He.Translate(-r,-i))});let oe=He;function v$(n=!0){const[e,t]=S.useState(0),r=G();S.useEffect(()=>{if(!n)return;const i=()=>t(o=>o+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,n])}const S$=$e(function({showStroke:n=!0,showVertices:e=!0,showClosestPointOnOutline:t=!0}){const r=G();v$(t);const i=r.getZoomLevel(),o=r.getRenderingShapes(),{inputs:{currentPagePoint:s}}=r;return m.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(a=>{const l=r.getShape(a.id);if(l.type==="group")return null;const c=r.getShapeGeometry(l),d=r.getShapePageTransform(l),u=r.getPointInShapeSpace(l,s),h=c.nearestPoint(u),p=c.distanceToPoint(u,!0),g=Math.abs(p)*i,f=p<0,{vertices:w}=c;return m.jsxs("g",{transform:d.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[n&&m.jsx("path",{stroke:"red",strokeWidth:"2",fill:"none",opacity:"1",d:c.toSimpleSvgPath()}),e&&w.map((v,b)=>m.jsx("circle",{cx:v.x,cy:v.y,r:"2",fill:`hsl(${jf(b,[0,w.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:"1"},`v${b}`)),t&&g<150&&m.jsx("line",{x1:h.x,y1:h.y,x2:u.x,y2:u.y,opacity:1-g/150,stroke:f?"goldenrod":"dodgerblue",strokeWidth:"2"})]},a.id+"_outline")})})});var x$=200,Sv="__lodash_hash_undefined__",_$=1/0,k$="[object Function]",C$="[object GeneratorFunction]",E$=/[\\^$.*+?()[\]{}|]/g,P$=/^\[object .+?Constructor\]$/,I$=typeof Ge=="object"&&Ge&&Ge.Object===Object&&Ge,M$=typeof self=="object"&&self&&self.Object===Object&&self,xv=I$||M$||Function("return this")();function A$(n,e){var t=n?n.length:0;return!!t&&R$(n,e,0)>-1}function T$(n,e,t){for(var r=-1,i=n?n.length:0;++r<i;)if(t(e,n[r]))return!0;return!1}function j$(n,e,t,r){for(var i=n.length,o=t+(r?1:-1);r?o--:++o<i;)if(e(n[o],o,n))return o;return-1}function R$(n,e,t){if(e!==e)return j$(n,D$,t);for(var r=t-1,i=n.length;++r<i;)if(n[r]===e)return r;return-1}function D$(n){return n!==n}function O$(n,e){return n.has(e)}function L$(n,e){return n==null?void 0:n[e]}function z$(n){var e=!1;if(n!=null&&typeof n.toString!="function")try{e=!!(n+"")}catch{}return e}function aM(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var N$=Array.prototype,F$=Function.prototype,lM=Object.prototype,_v=xv["__core-js_shared__"],cM=function(){var n=/[^.]+$/.exec(_v&&_v.keys&&_v.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),dM=F$.toString,kv=lM.hasOwnProperty,$$=lM.toString,B$=RegExp("^"+dM.call(kv).replace(E$,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),U$=N$.splice,V$=Ev(xv,"Map"),Cv=Ev(xv,"Set"),Cu=Ev(Object,"create");function ka(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function H$(){this.__data__=Cu?Cu(null):{}}function W$(n){return this.has(n)&&delete this.__data__[n]}function K$(n){var e=this.__data__;if(Cu){var t=e[n];return t===Sv?void 0:t}return kv.call(e,n)?e[n]:void 0}function G$(n){var e=this.__data__;return Cu?e[n]!==void 0:kv.call(e,n)}function Y$(n,e){var t=this.__data__;return t[n]=Cu&&e===void 0?Sv:e,this}ka.prototype.clear=H$,ka.prototype.delete=W$,ka.prototype.get=K$,ka.prototype.has=G$,ka.prototype.set=Y$;function Ql(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function X$(){this.__data__=[]}function q$(n){var e=this.__data__,t=cg(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():U$.call(e,t,1),!0}function J$(n){var e=this.__data__,t=cg(e,n);return t<0?void 0:e[t][1]}function Z$(n){return cg(this.__data__,n)>-1}function Q$(n,e){var t=this.__data__,r=cg(t,n);return r<0?t.push([n,e]):t[r][1]=e,this}Ql.prototype.clear=X$,Ql.prototype.delete=q$,Ql.prototype.get=J$,Ql.prototype.has=Z$,Ql.prototype.set=Q$;function ec(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function eB(){this.__data__={hash:new ka,map:new(V$||Ql),string:new ka}}function tB(n){return dg(this,n).delete(n)}function nB(n){return dg(this,n).get(n)}function rB(n){return dg(this,n).has(n)}function iB(n,e){return dg(this,n).set(n,e),this}ec.prototype.clear=eB,ec.prototype.delete=tB,ec.prototype.get=nB,ec.prototype.has=rB,ec.prototype.set=iB;function lg(n){var e=-1,t=n?n.length:0;for(this.__data__=new ec;++e<t;)this.add(n[e])}function oB(n){return this.__data__.set(n,Sv),this}function sB(n){return this.__data__.has(n)}lg.prototype.add=lg.prototype.push=oB,lg.prototype.has=sB;function cg(n,e){for(var t=n.length;t--;)if(fB(n[t][0],e))return t;return-1}function aB(n){if(!uM(n)||uB(n))return!1;var e=gB(n)||z$(n)?B$:P$;return e.test(hB(n))}function lB(n,e,t){var r=-1,i=A$,o=n.length,s=!0,a=[],l=a;if(t)s=!1,i=T$;else if(o>=x$){var c=e?null:cB(n);if(c)return aM(c);s=!1,i=O$,l=new lg}else l=e?[]:a;e:for(;++r<o;){var d=n[r],u=e?e(d):d;if(d=t||d!==0?d:0,s&&u===u){for(var h=l.length;h--;)if(l[h]===u)continue e;e&&l.push(u),a.push(d)}else i(l,u,t)||(l!==a&&l.push(u),a.push(d))}return a}var cB=Cv&&1/aM(new Cv([,-0]))[1]==_$?function(n){return new Cv(n)}:mB;function dg(n,e){var t=n.__data__;return dB(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Ev(n,e){var t=L$(n,e);return aB(t)?t:void 0}function dB(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function uB(n){return!!cM&&cM in n}function hB(n){if(n!=null){try{return dM.call(n)}catch{}try{return n+""}catch{}}return""}function pB(n){return n&&n.length?lB(n):[]}function fB(n,e){return n===e||n!==n&&e!==e}function gB(n){var e=uM(n)?$$.call(n):"";return e==k$||e==C$}function uM(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function mB(){}var yB=pB;const wB=sr(yB);function hM(n){return wB(n)}function bB(){const n=G(),e=S.useMemo(()=>n.store.query.records("instance_presence",()=>({userId:{neq:n.user.getId()}})),[n]),t=OP("userIds",()=>hM(e.get().map(r=>r.userId)).sort(),{isEqual:(r,i)=>{var o;return r.join(",")===((o=i.join)==null?void 0:o.call(i,","))}},[e]);return q(t)}function pM(n){const e=G(),t=S.useMemo(()=>e.store.query.records("instance_presence",()=>({userId:{eq:n}})),[e,n]);return q(`latestPresence:${n}`,()=>t.get().slice().sort((r,i)=>i.lastActivityTimestamp-r.lastActivityTimestamp)[0],[])??null}const vB=$e(function(){const n=bB();return m.jsx(m.Fragment,{children:n.map(e=>m.jsx(SB,{collaboratorId:e},e))})}),SB=$e(function({collaboratorId:n}){const e=G(),t=pM(n),r=_B(t);if(!(t&&t.currentPageId===e.getCurrentPageId()))return null;switch(r){case"inactive":{const{followingUserId:i,highlightedUserIds:o}=e.getInstanceState();if(!(i===t.userId||o.includes(t.userId)))return null;break}case"idle":{const{highlightedUserIds:i}=e.getInstanceState();if(t.followingUserId===e.user.getId()&&!(t.chatMessage||i.includes(t.userId)))return null;break}}return m.jsx(xB,{latestPresence:t})}),xB=$e(function({latestPresence:n}){const e=G(),{CollaboratorBrush:t,CollaboratorScribble:r,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:s}=Kt(),a=e.getZoomLevel(),l=e.getViewportPageBounds(),{userId:c,chatMessage:d,brush:u,scribbles:h,selectedShapeIds:p,userName:g,cursor:f,color:w}=n,v=!(f.x<l.minX-12/a||f.y<l.minY-16/a||f.x>l.maxX-12/a||f.y>l.maxY-16/a);return m.jsxs(m.Fragment,{children:[u&&t?m.jsx(t,{className:"tl-collaborator__brush",brush:u,color:w,opacity:.1},c+"_brush"):null,v&&i?m.jsx(i,{className:"tl-collaborator__cursor",point:f,color:w,zoom:a,name:g!=="New User"?g:null,chatMessage:d},c+"_cursor"):o?m.jsx(o,{className:"tl-collaborator__cursor-hint",point:f,color:w,zoom:a,viewport:l},c+"_cursor_hint"):null,r&&h.length?m.jsx(m.Fragment,{children:h.map(b=>m.jsx(r,{className:"tl-collaborator__scribble",scribble:b,color:w,zoom:a,opacity:b.color==="laser"?.5:.1},c+"_scribble_"+b.id))}):null,s&&p.map(b=>m.jsx(s,{className:"tl-collaborator__shape-indicator",id:b,color:w,opacity:.5},c+"_"+b))]})});function fM(n){return n>P9?"inactive":n>jI?"idle":"active"}function _B(n){const e=S.useRef((n==null?void 0:n.lastActivityTimestamp)??-1),[t,r]=S.useState(()=>fM(Date.now()-e.current));return S.useEffect(()=>{const i=setInterval(()=>{r(fM(Date.now()-e.current))},I9);return()=>clearInterval(i)},[]),n&&(e.current=n.lastActivityTimestamp),t}function gM(n,e){return e===0?n:gM(e,n%e)}function mM(n){const e=n.toString().split(".")[1];if(!e)return 1;const t=Math.pow(10,e.length),r=parseInt(e,10);return t/gM(r,t)}function kB(){const n=G(),e=xn();S.useEffect(()=>Ll("useDPRMultiple",()=>{const t=n.getInstanceState().devicePixelRatio;e.style.setProperty("--tl-dpr-multiple",mM(t).toString())}),[n,e])}const yM=$e(function({id:n,shape:e,util:t,index:r,backgroundIndex:i,opacity:o,isCulled:s}){const a=G(),{ShapeErrorFallback:l}=Kt(),c=S.useRef(null),d=S.useRef(null),u=S.useCallback((p,g)=>{var f,w;(f=c.current)==null||f.style.setProperty(p,g),(w=d.current)==null||w.style.setProperty(p,g)},[]);wa("set shape container transform position",()=>{if(!a.getShape(n))return;const p=a.getShapePageTransform(n),g=oe.toCssString(p);u("transform",g)},[a,u]),wa("set shape container clip path",()=>{if(!a.getShape(n))return null;const p=a.getShapeClipPath(n);u("clip-path",p??"none")},[a,u]),wa("set shape height and width",()=>{const p=a.getShape(n);if(!p)return null;const g=a.getShapeGeometry(p).bounds,f=Math.floor(a.getInstanceState().devicePixelRatio*100)/100,w=mM(f),v=g.w%w,b=v===0?g.w:g.w+(w-v),_=g.h%w,x=_===0?g.h:g.h+(w-_);u("width",Math.max(b,w)+"px"),u("height",Math.max(x,w)+"px")},[a]),S.useLayoutEffect(()=>{var p,g;u("opacity",o+""),(p=c.current)==null||p.style.setProperty("z-index",r+""),(g=d.current)==null||g.style.setProperty("z-index",i+"")},[o,r,i,u]);const h=S.useCallback(p=>{a.annotateError(p,{origin:"react.shape",willCrashApp:!1})},[a]);return e?m.jsxs(m.Fragment,{children:[t.backgroundComponent&&m.jsx("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":e.type,draggable:!1,children:!s&&m.jsx(fu,{fallback:l,onError:h,children:m.jsx(EB,{shape:e,util:t})})}),m.jsx("div",{ref:c,className:"tl-shape","data-shape-type":e.type,draggable:!1,children:s?m.jsx(PB,{shape:e}):m.jsx(fu,{fallback:l,onError:h,children:m.jsx(CB,{shape:e,util:t})})})]}):null}),CB=S.memo(function({shape:n,util:e}){return If("InnerShape:"+n.type,()=>e.component(n))},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta&&n.util===e.util),EB=S.memo(function({shape:n,util:e}){return If("InnerShape:"+n.type,()=>{var t;return(t=e.backgroundComponent)==null?void 0:t.call(e,n)})},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta),PB=S.memo(function({shape:n}){const e=G().getShapeGeometry(n).bounds;return m.jsx("div",{className:"tl-shape__culled",style:{transform:`translate(${R(e.minX)}px, ${R(e.minY)}px)`,width:Math.max(1,R(e.width)),height:Math.max(1,R(e.height))}})},()=>!0);function Pv({className:n}){const e=G(),{Background:t,SvgDefs:r}=Kt(),i=re.useRef(null),o=re.useRef(null),s=re.useRef(null);m$(),e9(),ZF(),X7(i),K9(i),wa("position layers",()=>{const h=o.current;if(!h)return;const p=s.current;if(!p)return;const{x:g,y:f,z:w}=e.getCamera(),v=w>=1?jf(w,[1,8],[.125,.5],!0):jf(w,[.1,1],[-2,.125],!0),b=`scale(${R(w)}) translate(${R(g+v)}px,${R(f+v)}px)`;h.style.setProperty("transform",b),p.style.setProperty("transform",b)},[e]);const a=JF(),l=q("shapeSvgDefs",()=>{const h=new Map;for(const p of Pt(e.shapeUtils)){if(!p)return;const g=p.getCanvasSvgDefs();for(const{key:f,component:w}of g)h.has(f)||h.set(f,m.jsx(w,{},f))}return[...h.values()]},[e]),c=q("debug_shapes",()=>st.hideShapes.get(),[st]),d=q("debug_svg",()=>st.debugSvg.get(),[st]),u=q("debug_geometry",()=>st.debugGeometry.get(),[st]);return m.jsxs("div",{ref:i,draggable:!1,className:ye("tl-canvas",n),"data-testid":"canvas",...a,children:[t&&m.jsx(t,{}),m.jsx(IB,{}),m.jsx(WB,{}),m.jsx("svg",{className:"tl-svg-context",children:m.jsxs("defs",{children:[l,wM&&m.jsx(wM,{}),m.jsx(BB,{}),m.jsx(UB,{}),m.jsx(VB,{}),r&&m.jsx(r,{})]})}),m.jsxs("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[m.jsx(YB,{}),m.jsx(GB,{}),c?null:d?m.jsx(LB,{}):m.jsx(zB,{})]}),m.jsxs("div",{className:"tl-fixed-layer tl-overlays",children:[m.jsxs("div",{ref:s,className:"tl-html-layer",children:[u?m.jsx(S$,{}):null,m.jsx(DB,{}),m.jsx(AB,{}),m.jsx(MB,{}),m.jsx(TB,{}),m.jsx(NB,{}),m.jsx(FB,{}),m.jsx($B,{}),m.jsx(jB,{}),m.jsx(KB,{}),m.jsx(vB,{})]}),m.jsx(XB,{})]})]})}function IB(){const n=G(),e=q("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:t,y:r,z:i}=q("camera",()=>n.getCamera(),[n]),o=q("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:s}=Kt();return s&&o?m.jsx(s,{x:t,y:r,z:i,size:e}):null}function MB(){const n=G(),e=q("scribbles",()=>n.getInstanceState().scribbles,[n]),t=q("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:r}=Kt();return r&&e.length?m.jsx(m.Fragment,{children:e.map(i=>m.jsx(r,{className:"tl-user-scribble",scribble:i,zoom:t},i.id))}):null}function AB(){const n=G(),e=q("brush",()=>n.getInstanceState().brush,[n]),{Brush:t}=Kt();return t&&e?m.jsx(t,{className:"tl-user-brush",brush:e}):null}function TB(){const n=G(),e=q("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:t}=Kt();return t&&e?m.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function jB(){const n=G(),e=q("snapLines",()=>n.snaps.getLines(),[n]),t=q("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapLine:r}=Kt();return r&&e.length>0?m.jsx(m.Fragment,{children:e.map(i=>m.jsx(r,{className:"tl-user-snapline",line:i,zoom:t},i.id))}):null}const RB=48;function DB(){const n=G(),{Handles:e}=Kt(),t=q("zoomLevel",()=>n.getZoomLevel(),[n]),r=q("coarse pointer",()=>n.getInstanceState().isCoarsePointer,[n]),i=q("onlySelectedShape",()=>n.getOnlySelectedShape(),[n]),o=q("isChangingStyle",()=>n.getInstanceState().isChangingStyle,[n]),s=q("isChangingStyle",()=>n.getInstanceState().isReadonly,[n]),a=q("handles",()=>{const d=n.getOnlySelectedShape();if(d)return n.getShapeHandles(d)},[n]),l=q("transform",()=>{const d=n.getOnlySelectedShape();if(d)return n.getShapePageTransform(d)},[n]);if(!e||!i||o||s||!a||!l)return null;const c=[];for(let d=0,u=a[d];d<a.length;d++,u=a[d]){if(u.type!=="vertex"){const h=a[d-1],p=a[d+1];if(h&&p&&Math.hypot(h.y-p.y,h.x-p.x)<RB/t)continue}c.push(u)}return c.sort(d=>d.type==="vertex"?1:-1),m.jsx(e,{children:m.jsx("g",{transform:oe.toCssString(l),children:c.map(d=>m.jsx(OB,{shapeId:i.id,handle:d,zoom:t,isCoarse:r},d.id))})})}function OB({shapeId:n,handle:e,zoom:t,isCoarse:r}){const i=q7(n,e.id),{Handle:o}=Kt();return o?m.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:m.jsx(o,{shapeId:n,handle:e,zoom:t,isCoarse:r})}):null}function LB(){const n=G(),e=q("rendering shapes",()=>n.getRenderingShapes(),[n]);return m.jsx(m.Fragment,{children:e.map(t=>m.jsxs(re.Fragment,{children:[m.jsx(yM,{...t}),m.jsx(HB,{id:t.id})]},t.id+"_fragment"))})}function zB(){const n=G(),e=q("rendering shapes",()=>n.getRenderingShapes(),[n]);return m.jsx(m.Fragment,{children:e.map(t=>m.jsx(yM,{...t},t.id+"_shape"))})}function NB(){const n=G(),e=q("selectedShapeIds",()=>n.getCurrentPageState().selectedShapeIds,[n]);return q("should display selected ids",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!n.getInstanceState().isChangingStyle,[n])?m.jsx(m.Fragment,{children:e.map(t=>m.jsx(gu,{className:"tl-user-indicator__selected",id:t},t+"_indicator"))}):null}const FB=function(){const n=G(),{HoveredShapeIndicator:e}=Kt(),t=q("coarse pointer",()=>n.getInstanceState().isCoarsePointer,[n]),r=q("hovering canvas",()=>n.getInstanceState().isHoveringCanvas,[n]),i=q("hovered id",()=>n.getCurrentPageState().hoveredShapeId,[n]);return t||!r||!i||!e?null:m.jsx(e,{shapeId:i})},$B=$e(function(){const n=G(),e=Af(n.getHintingShapeIds());return e.length?m.jsx(m.Fragment,{children:e.map(t=>m.jsx(gu,{className:"tl-user-indicator__hint",id:t},t+"_hinting"))}):null});function wM(){return m.jsxs("g",{id:"cursor",children:[m.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[m.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),m.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),m.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[m.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),m.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),m.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[m.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),m.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function BB(){return m.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function UB(){return m.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:m.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function VB(){return m.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[m.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),m.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const HB=$e(function({id:n}){const e=G(),t=e.getShape(n),[r,i]=re.useState(""),o=(t==null?void 0:t.parentId)===e.getCurrentPageId();return re.useEffect(()=>{if(!o)return;let s=null;const a=Ll("shape to svg",async()=>{const l=Math.random();s=l;const c=e.getShapePageBounds(n),d=await e.getSvg([n],{padding:0});d&&c&&s===l&&(d.style.setProperty("overflow","visible"),d.setAttribute("preserveAspectRatio","xMidYMin slice"),d.style.setProperty("transform",`translate(${c.x}px, ${c.y+c.h+12}px)`),d.style.setProperty("border","1px solid black"),i(d==null?void 0:d.outerHTML))});return()=>{s=null,a()}},[e,n,o]),o?m.jsx("div",{style:{paddingTop:12,position:"absolute"},children:m.jsx("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:r}})}):null});function WB(){const n=q("debugging ui log",()=>st.logMessages.get(),[st]);return n.length?m.jsx("div",{className:"debug__ui-logger",children:n.map((e,t)=>{const r=typeof e=="string"?e:JSON.stringify(e);return m.jsx("div",{className:"debug__ui-logger__line",children:r},t)})}):null}function KB(){const n=G(),e=q("selection rotation",()=>n.getSelectionRotation(),[n]),t=q("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:r}=Kt();return!t||!r?null:m.jsx(r,{bounds:t,rotation:e})}function GB(){const n=G(),e=q("selection rotation",()=>n.getSelectionRotation(),[n]),t=q("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:r}=Kt();return!t||!r?null:m.jsx(r,{bounds:t,rotation:e})}function YB(){const{OnTheCanvas:n}=Kt();return n?m.jsx(n,{}):null}function XB(){const{InFrontOfTheCanvas:n}=Kt();return n?m.jsx(n,{}):null}const qB=()=>m.jsx(uA,{children:"Connecting..."});function et(){return Of()}const bM="TLDRAW_USER_DATA_v3",vM=je({id:Se,name:Se.nullable().optional(),locale:Se.nullable().optional(),color:Se.nullable().optional(),isDarkMode:Ie.nullable().optional(),animationSpeed:we.nullable().optional(),edgeScrollSpeed:we.nullable().optional(),isSnapMode:Ie.nullable().optional()}),Eu={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4},ug=Be({currentVersion:Eu.AddEdgeScrollSpeed,migrators:{[Eu.AddAnimationSpeed]:{up:n=>({...n,animationSpeed:1}),down:({animationSpeed:n,...e})=>e},[Eu.AddIsSnapMode]:{up:n=>({...n,isSnapMode:!1}),down:({isSnapMode:n,...e})=>e},[Eu.MakeFieldsNullable]:{up:n=>n,down:n=>({id:n.id,name:n.name??nr.name,locale:n.locale??nr.locale,color:n.color??nr.color,isDarkMode:n.isDarkMode??nr.isDarkMode,animationSpeed:n.animationSpeed??nr.animationSpeed,isSnapMode:n.isSnapMode??nr.isSnapMode})},[Eu.AddEdgeScrollSpeed]:{up:n=>({...n,edgeScrollSpeed:1}),down:({edgeScrollSpeed:n,...e})=>e}}}),SM=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function JB(){return SM[Math.floor(Math.random()*SM.length)]}function ZB(){var n,e;return typeof window>"u"?!1:((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-color-scheme: dark)"))==null?void 0:e.matches)??!1}function QB(){var n,e;return typeof window>"u"?!1:((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1}const nr=Object.freeze({name:"New User",locale:VF(),color:JB(),isDarkMode:!1,edgeScrollSpeed:1,animationSpeed:QB()?0:1,isSnapMode:!1});function Iv(){return{id:et()}}function xM(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return Iv();const e=Gb({value:n.user,fromVersion:n.version,toVersion:ug.currentVersion??0,migrations:ug});if(e.type==="error")return Iv();try{vM.validate(e.value)}catch{return Iv()}return e.value}function eU(){var e;const n=typeof window>"u"?null:JSON.parse(((e=window==null?void 0:window.localStorage)==null?void 0:e.getItem(bM))||"null")??null;return xM(n)}const Pu=On("globalUserData",eU());function tU(){typeof window<"u"&&window.localStorage&&window.localStorage.setItem(bM,JSON.stringify({version:ug.currentVersion,user:Pu.get()}))}function nU(n){vM.validate(n),Pu.set(n),tU(),iU()}const rU=typeof process<"u"&&!1,tc=typeof BroadcastChannel<"u"&&!rU?new BroadcastChannel("tldraw-user-sync"):null;tc==null||tc.addEventListener("message",n=>{const e=n.data;(e==null?void 0:e.type)===kM&&(e==null?void 0:e.origin)!==_M&&Pu.set(xM(e.data))});const _M=et(),kM="tldraw-user-preferences-change";function iU(){tc==null||tc.postMessage({type:kM,origin:_M,data:{user:Pu.get(),version:ug.currentVersion}})}function CM(){return Pu.get()}function EM(n={}){return{derivePresenceState:n.derivePresenceState??(()=>Q("presence",()=>null)),userPreferences:n.userPreferences??Q("userPreferences",()=>CM()),setUserPreferences:n.setUserPreferences??nU}}var PM={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,c,d){this.fn=l,this.context=c,this.once=d||!1}function o(l,c,d,u,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new i(d,u||l,h),g=t?t+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],p]:l._events[g].push(p):(l._events[g]=p,l._eventsCount++),l}function s(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=t?t+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,h=d.length,p=new Array(h);u<h;u++)p[u]=d[u].fn;return p},a.prototype.listenerCount=function(l){var c=t?t+l:l,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,c,d,u,h,p){var g=t?t+l:l;if(!this._events[g])return!1;var f=this._events[g],w=arguments.length,v,b;if(f.fn){switch(f.once&&this.removeListener(l,f.fn,void 0,!0),w){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,c),!0;case 3:return f.fn.call(f.context,c,d),!0;case 4:return f.fn.call(f.context,c,d,u),!0;case 5:return f.fn.call(f.context,c,d,u,h),!0;case 6:return f.fn.call(f.context,c,d,u,h,p),!0}for(b=1,v=new Array(w-1);b<w;b++)v[b-1]=arguments[b];f.fn.apply(f.context,v)}else{var _=f.length,x;for(b=0;b<_;b++)switch(f[b].once&&this.removeListener(l,f[b].fn,void 0,!0),w){case 1:f[b].fn.call(f[b].context);break;case 2:f[b].fn.call(f[b].context,c);break;case 3:f[b].fn.call(f[b].context,c,d);break;case 4:f[b].fn.call(f[b].context,c,d,u);break;default:if(!v)for(x=1,v=new Array(w-1);x<w;x++)v[x-1]=arguments[x];f[b].fn.apply(f[b].context,v)}}return!0},a.prototype.on=function(l,c,d){return o(this,l,c,d,!1)},a.prototype.once=function(l,c,d){return o(this,l,c,d,!0)},a.prototype.removeListener=function(l,c,d,u){var h=t?t+l:l;if(!this._events[h])return this;if(!c)return s(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!u||p.once)&&(!d||p.context===d)&&s(this,h);else{for(var g=0,f=[],w=p.length;g<w;g++)(p[g].fn!==c||u&&!p[g].once||d&&p[g].context!==d)&&f.push(p[g]);f.length?this._events[h]=f.length===1?f[0]:f:s(this,h)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=t?t+l:l,this._events[c]&&s(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(PM);var oU=PM.exports;function yr({children:n,className:e="",...t}){return m.jsx("svg",{...t,className:`tl-svg-container ${e}`,children:n})}class Ca{constructor(e){y(this,"isFilled",!1);y(this,"isClosed",!0);y(this,"isLabel",!1);y(this,"isSnappable",!0);y(this,"_vertices");y(this,"_bounds");y(this,"_snapPoints");y(this,"_area");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isSnappable=e.isSnappable??!1,this.isLabel=e.isLabel??!1}hitTestPoint(e,t=0,r=!1){return this.distanceToPoint(e,r)<=t}distanceToPoint(e,t=!1){const r=e.dist(this.nearestPoint(e));return this.isClosed&&(this.isFilled||t)&&zi(e,this.vertices)?-r:r}distanceToLineSegment(e,t){const r=this.nearestPointOnLineSegment(e,t),i=C.DistanceToLineSegment(e,t,r);return this.isClosed&&this.isFilled&&zi(r,this.vertices)?-i:i}hitTestLineSegment(e,t,r=0){return this.distanceToLineSegment(e,t)<=r}nearestPointOnLineSegment(e,t){let r=1/0,i;for(let o=0;o<this.vertices.length;o++){const s=this.vertices[o],a=C.DistanceToLineSegment(e,t,s);a<r&&(r=a,i=s)}if(!i)throw Error("nearest point not found");return i}isPointInBounds(e,t=0){const{bounds:r}=this;return!(e.x<r.minX-t||e.y<r.minY-t||e.x>r.maxX+t||e.y>r.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return de.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get snapPoints(){return this._snapPoints||(this._snapPoints=this.bounds.snapPoints),this._snapPoints}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let r=0,i=e.length;r<i;r++){const o=e[r],s=e[(r+1)%i];t+=o.x*s.y-s.x*o.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,r=t.length;if(r===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let i=1;i<r;i++)e+=`L${t[i].x},${t[i].y}`;return this.isClosed&&(e+="Z"),e}}class _s extends Ca{constructor(t){super({...t,isClosed:!0,isFilled:!1});y(this,"children");const{children:r}=t;if(r.length===0)throw Error("Group2d must have at least one child");this.children=r}getVertices(){return this.children.filter(t=>!t.isLabel).flatMap(t=>t.vertices)}nearestPoint(t){let r=1/0,i;const{children:o}=this;if(o.length===0)throw Error("no children");for(const s of o){const a=s.nearestPoint(t),l=a.dist(t);l<r&&(r=l,i=a)}if(!i)throw Error("nearest point not found");return i}distanceToPoint(t,r=!1){return Math.min(...this.children.map((i,o)=>i.distanceToPoint(t,r||o>0)))}hitTestPoint(t,r,i){return!!this.children.filter(o=>!o.isLabel).find(o=>o.hitTestPoint(t,r,i))}hitTestLineSegment(t,r,i){return!!this.children.filter(o=>!o.isLabel).find(o=>o.hitTestLineSegment(t,r,i))}getArea(){return this.children[0].area}toSimpleSvgPath(){let t="";for(const i of this.children)t+=i.toSimpleSvgPath();const r=de.FromPoints(this.vertices).corners;for(let i=0,o=r.length;i<o;i++){const s=r[i],a=r[(i-1+o)%o],l=s.dist(a),c=r[(i+1)%o],d=s.dist(c),u=s.clone().lrp(a,4/l),h=s,p=s.clone().lrp(c,4/d);t+=`M${u.x},${u.y} L${h.x},${h.y} L${p.x},${p.y} `}return t}}function Mv(n,e,t,r){const i=n.x-t.x,o=n.y-t.y,s=r.x-t.x,a=r.y-t.y,l=e.x-n.x,c=e.y-n.y,d=s*o-a*i,u=l*o-c*i,h=a*l-s*c;if(d===0||u===0||h===0)return null;if(h!==0){const p=d/h,g=u/h;if(0<=p&&p<=1&&0<=g&&g<=1)return C.AddXY(n,p*l,p*c)}return null}function hg(n,e,t,r){const i=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),o=2*((e.x-n.x)*(n.x-t.x)+(e.y-n.y)*(n.y-t.y)),s=t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-r*r,a=o*o-4*i*s;if(a<0||a===0)return null;const l=Math.sqrt(a),c=(-o+l)/(2*i),d=(-o-l)/(2*i);if((c<0||c>1)&&(d<0||d>1))return null;const u=[];return 0<=c&&c<=1&&u.push(C.Lrp(n,e,c)),0<=d&&d<=1&&u.push(C.Lrp(n,e,d)),u.length===0?null:u}function IM(n,e,t){const r=[];let i;for(let o=0,s=t.length-1;o<s;o++)i=Mv(n,e,t[o],t[o+1]),i&&r.push(i);return r.length===0?null:r}function sU(n,e,t){const r=[];let i;for(let o=1,s=t.length;o<s+1;o++)i=Mv(n,e,t[o-1],t[o%t.length]),i&&r.push(i);return r.length===0?null:r}function aU(n,e,t,r){let i=t.x-n.x,o=t.y-n.y;const s=Math.sqrt(i*i+o*o),a=(s*s-r*r+e*e)/(2*s),l=Math.sqrt(e*e-a*a);return i/=s,o/=s,[new C(n.x+i*a-o*l,n.y+o*a+i*l),new C(n.x+i*a+o*l,n.y+o*a-i*l)]}function MM(n,e,t){const r=[];let i,o,s;for(let a=0,l=t.length;a<l;a++)i=t[a],o=t[(a+1)%t.length],s=hg(i,o,n,e),s&&r.push(...s);return r.length===0?null:r}function AM(n,e,t){const r=[];let i,o,s;for(let a=1,l=t.length;a<l;a++)i=t[a-1],o=t[a],s=hg(i,o,n,e),s&&r.push(...s);return r.length===0?null:r}function pg(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function TM(n,e,t,r){return pg(n,t,r)!==pg(e,t,r)&&pg(n,e,t)!==pg(n,e,r)}function Av(n,e){const t=new Map;let r,i,o,s;for(let a=0,l=n.length;a<l;a++)if(r=n[a],zi(r,e)){const c=Tv(r);t.has(c)||t.set(c,r)}for(let a=0,l=e.length;a<l;a++)if(r=e[a],zi(r,n)){const c=Tv(r);t.has(c)||t.set(c,r)}for(let a=0,l=n.length;a<l;a++){r=n[a],i=n[(a+1)%n.length];for(let c=0,d=e.length;c<d;c++){o=e[c],s=e[(c+1)%e.length];const u=Mv(r,i,o,s);if(u!==null){const h=Tv(u);t.has(h)||t.set(h,u)}}}return t.size===0?null:lU([...t.values()])}function Tv(n){return`${n.x},${n.y}`}function lU(n){const e=C.Average(n);return n.sort((t,r)=>C.Angle(e,t)-C.Angle(e,r))}function cU(n,e){let t,r,i,o;for(let s=0,a=n.length;s<a;s++){t=n[s],r=n[(s+1)%a];for(let l=0,c=e.length;l<c;l++)if(i=e[l],o=e[(l+1)%c],TM(t,r,i,o))return!0}return!1}class fg extends Ca{constructor(t){super({...t,isClosed:!1,isFilled:!1});y(this,"start");y(this,"end");y(this,"d");y(this,"u");y(this,"ul");y(this,"_length");const{start:r,end:i}=t;this.start=r,this.end=i,this.d=r.clone().sub(i),this.u=this.d.clone().uni(),this.ul=this.u.len()}get length(){return this._length?this._length:this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(t){const{start:r,end:i,u:o,ul:s}=this;if(s===0)return r;const a=C.Sub(t,r).dpr(o)/s,l=r.x+o.x*a;if(l<Math.min(r.x,i.x))return r.x<i.x?r:i;if(l>Math.max(r.x,i.x))return r.x>i.x?r:i;const c=r.y+o.y*a;return c<Math.min(r.y,i.y)?r.y<i.y?r:i:c>Math.max(r.y,i.y)?r.y>i.y?r:i:new C(l,c)}hitTestLineSegment(t,r,i){return TM(t,r,this.start,this.end)}}class Ea extends Ca{constructor(t){super({isClosed:!1,isFilled:!1,...t});y(this,"points");y(this,"_segments");y(this,"_length");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:t}=this;for(let r=0,i=t.length-1;r<i;r++){const o=t[r],s=t[r+1];this._segments.push(new fg({start:o,end:s}))}this.isClosed&&this._segments.push(new fg({start:t[t.length-1],end:t[0]}))}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((t,r)=>t+r.length,0)),this._length}getVertices(){return this.points}nearestPoint(t){const{segments:r}=this;let i=this.points[0],o=1/0,s,a;for(let l=0;l<r.length;l++)s=r[l].nearestPoint(t),a=s.dist(t),a<o&&(i=s,o=a);return i}hitTestLineSegment(t,r,i){return this.segments.some(o=>o.hitTestLineSegment(t,r,i))}}class Gt extends Ea{constructor(e){super({...e}),this.isClosed=!0}}class ks extends Gt{constructor(t){const{x:r=0,y:i=0,width:o,height:s}=t;super({...t,points:[new C(r,i),new C(r+o,i),new C(r+o,i+s),new C(r,i+s)]});y(this,"x");y(this,"y");y(this,"w");y(this,"h");this.x=r,this.y=i,this.w=o,this.h=s}getBounds(){return new de(this.x,this.y,this.w,this.h)}}class ci{constructor(e){y(this,"canSnap",()=>!0);y(this,"canScroll",()=>!1);y(this,"canUnmount",()=>!0);y(this,"canBind",(e,t)=>!0);y(this,"canEdit",()=>!1);y(this,"canResize",()=>!0);y(this,"canEditInReadOnly",()=>!1);y(this,"canCrop",()=>!1);y(this,"hideResizeHandles",()=>!1);y(this,"hideRotateHandle",()=>!1);y(this,"hideSelectionBoundsBg",()=>!1);y(this,"hideSelectionBoundsFg",()=>!1);y(this,"isAspectRatioLocked",()=>!1);y(this,"onBeforeCreate");y(this,"onBeforeUpdate");y(this,"onDragShapesOver");y(this,"onDragShapesOut");y(this,"onDropShapesOver");y(this,"onResizeStart");y(this,"onResize");y(this,"onResizeEnd");y(this,"onTranslateStart");y(this,"onTranslate");y(this,"onTranslateEnd");y(this,"onRotateStart");y(this,"onRotate");y(this,"onRotateEnd");y(this,"onHandleChange");y(this,"onBindingChange");y(this,"onChildrenChange");y(this,"onDoubleClickHandle");y(this,"onDoubleClickEdge");y(this,"onDoubleClick");y(this,"onClick");y(this,"onEditEnd");this.editor=e}providesBackgroundForChildren(e){return!1}getOutlineSegments(e){return[this.editor.getShapeGeometry(e).vertices]}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}}y(ci,"props"),y(ci,"migrations"),y(ci,"type");function dU(n,e,t={}){const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=t;let c=0,d=0,u=1,h=0,p=0;switch(l){case"dashed":{u=1,c=Math.min(e*a,n/4);break}case"dotted":{u=100,c=e/u;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(n+=c/2,p+=c/2):o==="skip"&&(n-=c,p-=c),s==="outset"?n+=c/2:s==="skip"&&(n-=c)),d=Math.floor(n/c/(2*u)),d-=d%i,d<3&&l==="dashed"?n/e<5?(c=n,d=1,h=0):(c=n*.333,h=n*.333):(d=Math.max(d,3),c=n/d/(2*u),r?(p=c/2,h=(n-d*c)/d):h=(n-d*c)/Math.max(1,d-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}function jM({bounds:n,className:e}){const t=G(),r=q("zoom level",()=>t.getZoomLevel(),[t]);return m.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((i,o)=>{const{strokeDasharray:s,strokeDashoffset:a}=dU(i[0].dist(i[1]),1/r,{style:"dashed",lengthRatio:4});return m.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:s,strokeDashoffset:a},o)})})}class gg extends ci{constructor(){super(...arguments);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"canBind",()=>!1);y(this,"onChildrenChange",t=>{const r=this.editor.getSortedChildIdsForParent(t.id);if(r.length===0){this.editor.getCurrentPageState().focusedGroupId===t.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([t.id]);return}else if(r.length===1){this.editor.getCurrentPageState().focusedGroupId===t.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(r,t.parentId),this.editor.deleteShapes([t.id]);return}})}getDefaultProps(){return{}}getGeometry(t){const r=this.editor.getSortedChildIdsForParent(t.id);return r.length===0?new ks({width:1,height:1,isFilled:!1}):new _s({children:r.map(i=>{const o=this.editor.getShape(i),s=this.editor.getShapeGeometry(i),a=this.editor.getShapeLocalTransform(o).applyToPoints(s.vertices);return s.isClosed?new Gt({points:a,isFilled:!0}):new Ea({points:a})})})}component(t){const r=this.editor.getErasingShapeIds().includes(t.id),{hintingShapeIds:i}=this.editor.getCurrentPageState(),o=i.length>0&&i.some(l=>l!==t.id&&this.editor.isShapeOfType(this.editor.getShape(l),"group")),s=this.editor.getCurrentPageState().focusedGroupId!==t.id;if(!r&&(s||o))return null;const a=this.editor.getShapeGeometry(t).bounds;return m.jsx(yr,{id:t.id,children:m.jsx(jM,{className:"tl-group",bounds:a})})}indicator(t){const r=this.editor.getShapeGeometry(t).bounds;return m.jsx(jM,{className:"",bounds:r})}}y(gg,"type","group"),y(gg,"props",EF),y(gg,"migrations",PF);const RM=[gg],uU=new Set(RM.map(n=>n.type));function DM(n){const e=[...RM],t=new Set;for(const r of n){if(uU.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(t.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}function OM(n,e){if(!e)return!1;switch(n.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&n.value===e.value;default:throw Nl(n)}}class hU{constructor(e){y(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[r,i]of this){if(!OM(i,e.get(r)))return!1;t.add(r)}for(const[r,i]of e)if(!t.has(r)&&!OM(i,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class jv extends hU{set(e,t){this.map.set(e,t)}applyValue(e,t){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:t});return}switch(r.type){case"mixed":return;case"shared":r.value!==t&&this.set(e,{type:"mixed"});return;default:Nl(r,"type")}}}class Rv{constructor(){y(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}access(e){return this.items.get(e)}set(e,t){this.items.set(e,t)}has(e){return this.items.has(e)}invalidate(e){this.items.delete(e)}bust(){this.items=new WeakMap}}function pU(n,e,t){return fetch(n).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:t})})}function fU(n,e){var i;let t=n;const r=new Set(e);for(;r.has(t);)t=(i=/^.*(\d+)$/.exec(t))!=null&&i[1]?t.replace(/(\d+)(?=\D?)$/,o=>(+o+1).toString()):`${t} 1`;return t}const wr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",gU="a0",LM="A00000000000000000000000000";function zM(n){if(n>="a"&&n<="z")return n.charCodeAt(0)-"a".charCodeAt(0)+2;if(n>="A"&&n<="Z")return"Z".charCodeAt(0)-n.charCodeAt(0)+2;throw new Error("Invalid index key head: "+n)}function NM(n){if(n.length!==zM(n.charAt(0)))throw new Error("invalid integer part of index key: "+n)}function FM(n){if(n===void 0)throw Error("n is undefined")}function $M(n){NM(n);const[e,...t]=n.split("");let r=!0;for(let i=t.length-1;r&&i>=0;i--){const o=wr.indexOf(t[i])+1;o===wr.length?t[i]="0":(t[i]=wr.charAt(o),r=!1)}if(r){if(e==="Z")return"a0";if(e==="z")return;const i=String.fromCharCode(e.charCodeAt(0)+1);return i>"a"?t.push("0"):t.pop(),i+t.join("")}else return e+t.join("")}function mU(n){NM(n);const[e,...t]=n.split("");let r=!0;for(let i=t.length-1;r&&i>=0;i--){const o=wr.indexOf(t[i])-1;o===-1?t[i]=wr.slice(-1):(t[i]=wr.charAt(o),r=!1)}if(r){if(e==="a")return"Z"+wr.slice(-1);if(e==="A")return;const i=String.fromCharCode(e.charCodeAt(0)-1);return i<"Z"?t.push(wr.slice(-1)):t.pop(),i+t.join("")}else return e+t.join("")}function nc(n,e){if(e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n.slice(-1)==="0"||e&&e.slice(-1)==="0")throw new Error("trailing zero");if(e){let i=0;for(;(n.charAt(i)||"0")===e.charAt(i);)i++;if(i>0)return e.slice(0,i)+nc(n.slice(i),e.slice(i))}const t=n?wr.indexOf(n.charAt(0)):0,r=e!==void 0?wr.indexOf(e.charAt(0)):wr.length;if(r-t>1){const i=Math.round(.5*(t+r));return wr.charAt(i)}else return e&&e.length>1?e.slice(0,1):wr.charAt(t)+nc(n.slice(1),void 0)}function Iu(n){const e=zM(n.charAt(0));if(e>n.length)throw new Error("invalid index: "+n);return n.slice(0,e)}function BM(n){if(n===LM)throw new Error("invalid index: "+n);const e=Iu(n);if(n.slice(e.length).slice(-1)==="0")throw new Error("invalid index: "+n)}function rc(n,e){if(n!==void 0&&BM(n),e!==void 0&&BM(e),n!==void 0&&e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n===void 0&&e===void 0)return gU;if(n===void 0){if(e===void 0)throw Error("b is undefined");const a=Iu(e),l=e.slice(a.length);if(a===LM)return a+nc("",l);if(a<e)return a;const c=mU(a);return FM(c),c}if(e===void 0){const a=Iu(n),l=n.slice(a.length),c=$M(a);return c===void 0?a+nc(l,void 0):c}const t=Iu(n),r=n.slice(t.length),i=Iu(e),o=e.slice(i.length);if(t===i)return t+nc(r,o);const s=$M(t);return FM(s),s<e?s:t+nc(r,void 0)}function Cs(n,e,t){if(t===0)return[];if(t===1)return[rc(n,e)];if(e===void 0){let o=rc(n,e);const s=[o];for(let a=0;a<t-1;a++)o=rc(o,e),s.push(o);return s}if(n===void 0){let o=rc(n,e);const s=[o];for(let a=0;a<t-1;a++)o=rc(n,o),s.push(o);return s.reverse(),s}const r=Math.floor(t/2),i=rc(n,e);return[...Cs(n,i,r),i,...Cs(i,e,t-r-1)]}function ic(n,e,t){return Cs(n,e,t)}function Dv(n,e){return Cs(n,void 0,e)}function Mu(n,e){return Cs(n,e,1)[0]}function Io(n){return Cs(n,void 0,1)[0]}function yU(n){return Cs(void 0,n,1)[0]}function UM(n,e="a1"){return[e,...Cs(e,void 0,n)]}function Cn(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function mg(n,e,t){if(t.length===0)return[];const r=new Map;for(const o of me(t.map(s=>n.getShape(s)))){const{parentId:s}=o;r.has(s)||r.set(s,{children:me(n.getSortedChildIdsForParent(s).map(a=>n.getShape(a))),moving:new Set}),r.get(s).moving.add(o)}const i=[];switch(e){case"toBack":{r.forEach(({moving:o,children:s})=>wU(o,s,i));break}case"toFront":{r.forEach(({moving:o,children:s})=>bU(o,s,i));break}case"forward":{r.forEach(({moving:o,children:s})=>vU(o,s,i));break}case"backward":{r.forEach(({moving:o,children:s})=>SU(o,s,i));break}}return i}function wU(n,e,t){const r=e.length;if(n.size===r)return;let i,o;for(let s=0;s<r;s++){const a=e[s];if(n.has(a))i=a.index,n.delete(a);else{o=a.index;break}}if(n.size!==0){const s=ic(i,o,n.size);t.push(...Array.from(n.values()).sort(Cn).map((a,l)=>({...a,index:s[l]})))}}function bU(n,e,t){const r=e.length;if(n.size===r)return;let i,o;for(let s=r-1;s>-1;s--){const a=e[s];if(n.has(a))o=a.index,n.delete(a);else{i=a.index;break}}if(n.size!==0){const s=ic(i,o,n.size);t.push(...Array.from(n.values()).sort(Cn).map((a,l)=>({...a,index:s[l]})))}}function vU(n,e,t){var o;const r=e.length;if(n.size===r)return;let i={name:"skipping"};for(let s=0;s<r;s++){const a=n.has(e[s]);switch(i.name){case"skipping":{if(!a)continue;i={name:"selecting",selectIndex:s};break}case"selecting":{if(a)continue;const{selectIndex:l}=i;ic(e[s].index,(o=e[s+1])==null?void 0:o.index,s-l).forEach((c,d)=>t.push({...e[l+d],index:c})),i={name:"skipping"};break}}}}function SU(n,e,t){var o;const r=e.length;if(n.size===r)return;let i={name:"skipping"};for(let s=r-1;s>-1;s--){const a=n.has(e[s]);switch(i.name){case"skipping":{if(!a)continue;i={name:"selecting",selectIndex:s};break}case"selecting":{if(a)continue;ic((o=e[s-1])==null?void 0:o.index,e[s].index,i.selectIndex-s).forEach((l,c)=>{t.push({...e[s+c+1],index:l})}),i={name:"skipping"};break}}}}function VM({editor:n}){const e=n.getSelectedShapes(),t=n.getSelectionRotation(),r=n.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:i}}=n;if(!r)return null;const o=r.center.clone().rotWith(r.point,t);return{selectionPageCenter:o,initialCursorAngle:o.angle(i),initialSelectionRotation:t,shapeSnapshots:e.map(s=>({shape:Ss(s),initialPagePoint:n.getShapePageTransform(s.id).point()}))}}function yg({delta:n,editor:e,snapshot:t,stage:r}){const{selectionPageCenter:i,shapeSnapshots:o}=t;e.updateShapes(o.map(({shape:a,initialPagePoint:l})=>{const c=Nr(a.parentId)?e.getShapePageTransform(a.parentId):oe.Identity(),d=C.RotWith(l,i,n),u=oe.applyToPoint(oe.Inverse(c),d),h=si(a.rotation+n);return{id:a.id,type:a.type,x:u.x,y:u.y,rotation:h}}));const s=[];o.forEach(({shape:a})=>{var u,h,p;const l=e.getShape(a.id);if(!l)return;const c=e.getShapeUtil(a);if(r==="start"||r==="one-off"){const g=(u=c.onRotateStart)==null?void 0:u.call(c,a);g&&s.push(g)}const d=(h=c.onRotate)==null?void 0:h.call(c,a,l);if(d&&s.push(d),r==="end"||r==="one-off"){const g=(p=c.onRotateEnd)==null?void 0:p.call(c,a,l);g&&s.push(g)}}),s.length>0&&e.updateShapes(s)}const xU=n=>{const{store:e}=n,t=e.query.filterHistory("shape"),r=e.query.records("shape",()=>({type:{eq:"arrow"}}));function i(){const o=r.get(),s={};for(const a of o){const{start:l,end:c}=a.props;if(l.type==="binding"){const d=s[l.boundShapeId];d?d.push({arrowId:a.id,handleId:"start"}):s[l.boundShapeId]=[{arrowId:a.id,handleId:"start"}]}if(c.type==="binding"){const d=s[c.boundShapeId];d?d.push({arrowId:a.id,handleId:"end"}):s[c.boundShapeId]=[{arrowId:a.id,handleId:"end"}]}}return s}return Q("arrowBindingsIndex",(o,s)=>{if(zl(o))return i();const a=o,l=t.getDiffSince(s);if(l===pr)return i();let c;function d(p){c||(c={...a}),c[p]?c[p]===a[p]&&(c[p]=[...c[p]]):c[p]=[]}function u(p,g,f){d(p),c[p]=c[p].filter(w=>w.arrowId!==g||w.handleId!==f),c[p].length===0&&delete c[p]}function h(p,g,f){d(p),c[p].push({arrowId:g,handleId:f})}for(const p of l){for(const g of Object.values(p.added))if(n.isShapeOfType(g,"arrow")){const{start:f,end:w}=g.props;f.type==="binding"&&h(f.boundShapeId,g.id,"start"),w.type==="binding"&&h(w.boundShapeId,g.id,"end")}for(const[g,f]of Object.values(p.updated))if(!(!n.isShapeOfType(g,"arrow")||!n.isShapeOfType(f,"arrow")))for(const w of["start","end"]){const v=g.props[w],b=f.props[w];v.type==="binding"&&b.type==="point"?u(v.boundShapeId,g.id,w):v.type==="point"&&b.type==="binding"?h(b.boundShapeId,f.id,w):v.type==="binding"&&b.type==="binding"&&v.boundShapeId!==b.boundShapeId&&(u(v.boundShapeId,g.id,w),h(b.boundShapeId,f.id,w))}for(const g of Object.values(p.removed))if(n.isShapeOfType(g,"arrow")){const{start:f,end:w}=g.props;f.type==="binding"&&u(f.boundShapeId,g.id,"start"),w.type==="binding"&&u(w.boundShapeId,g.id,"end")}}return c??a})},_U=n=>{const e=n.query.ids("shape");function t(){const r={},i=e.get(),o=Array(i.size);return i.forEach(s=>o.push(n.get(s))),o.sort(Cn),o.forEach(s=>{r[s.parentId]||(r[s.parentId]=[]),r[s.parentId].push(s.id)}),r}return Q("parentsToChildrenWithIndexes",(r,i)=>{if(zl(r))return t();const o=n.history.getDiffSince(i);if(o===pr)return t();if(o.length===0)return r;let s=null;const a=d=>{s||(s={...r}),s[d]?s[d]===r[d]&&(s[d]=[...s[d]]):s[d]=[]},l=new Set;let c;for(let d=0,u=o.length;d<u;d++){c=o[d];for(const h of Object.values(c.added))xa(h)&&(a(h.parentId),s[h.parentId].push(h.id),l.add(s[h.parentId]));for(const[h,p]of Object.values(c.updated))if(xa(p)&&xa(h)){if(h.parentId!==p.parentId)a(h.parentId),a(p.parentId),s[h.parentId].splice(s[h.parentId].indexOf(p.id),1),s[p.parentId].push(p.id),l.add(s[p.parentId]);else if(h.index!==p.index){a(p.parentId);const g=s[p.parentId].indexOf(p.id);s[p.parentId][g]=p.id,l.add(s[p.parentId])}}for(const h of Object.values(c.removed))xa(h)&&(a(h.parentId),s[h.parentId].splice(s[h.parentId].indexOf(h.id),1))}for(const d of l){const u=me(d.map(h=>n.get(h)));u.sort(Cn),d.splice(0,d.length,...u.map(h=>h.id))}return s??r})},Ov=(n,e,t)=>{for(;!Zn(t.parentId);){const r=n.get(t.parentId);if(!r)return!1;t=r}return t.parentId===e},kU=(n,e)=>{const t=n.query.ids("shape");let r=null;function i(){const o=e();return r=o,new Set([...t.get()].filter(s=>Ov(n,o,n.get(s))))}return Q("_shapeIdsInCurrentPage",(o,s)=>{if(zl(o))return i();const a=e();if(a!==r)return i();const l=n.history.getDiffSince(s);if(l===pr)return i();const c=new Mf(o);for(const u of l){for(const h of Object.values(u.added))xa(h)&&Ov(n,a,h)&&c.add(h.id);for(const[h,p]of Object.values(u.updated))xa(p)&&(Ov(n,a,p)?c.add(p.id):c.remove(p.id));for(const h of Object.keys(u.removed))Nr(h)&&c.remove(h)}const d=c.get();return d?Zd(d.value,d.diff):o})},CU=40;class EU{constructor(e){y(this,"_clickId","");y(this,"_clickTimeout");y(this,"_clickScreenPoint");y(this,"_previousScreenPoint");y(this,"_getClickTimeout",(e,t=et())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?_9:k9)});y(this,"_clickState","idle");y(this,"lastPointerInfo",{});y(this,"transformPointerDownEvent",e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=C.From(e.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>CU&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),e;default:return this._clickTimeout=this._getClickTimeout(this._clickState),e}});y(this,"transformPointerUpEvent",e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=C.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return e}});y(this,"cancelDoubleClickTimeout",()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"});y(this,"handleMove",()=>{this._clickState!=="idle"&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?gv:Su)&&this.cancelDoubleClickTimeout()});this.editor=e}get clickState(){return this._clickState}}class PU{constructor(e){y(this,"isSafari");y(this,"isIos");y(this,"isChromeForIos");y(this,"isFirefox");y(this,"isAndroid");this.editor=e,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}function Pa(n){if(n){let e=HM;for(;n.length;)e=e.push(n.pop());return e}return HM}class IU{constructor(){y(this,"length",0);y(this,"head",null);y(this,"tail",this)}push(e){return new Lv(e,this)}toArray(){return vo}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const HM=new IU;class Lv{constructor(e,t){y(this,"length");this.head=e,this.tail=t,this.length=t.length+1}push(e){return new Lv(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}class MU{constructor(e,t){y(this,"_undos",On("HistoryManager.undos",Pa()));y(this,"_redos",On("HistoryManager.redos",Pa()));y(this,"_batchDepth",0);y(this,"onBatchComplete",()=>{});y(this,"_commands",{});y(this,"createCommand",(e,t,r)=>{if(this._commands[e])throw new Error(`Duplicate command: ${e}`);this._commands[e]=r;const i=(...o)=>{if(!this._batchDepth)return this.batch(()=>i(...o)),this.ctx;const s=t(...o);if(!s)return this.ctx;const{data:a,ephemeral:l,squashing:c,preservesRedoStack:d}=s;if(this.ignoringUpdates((u,h)=>(r.do(a),{undos:u,redos:h})),!l){const u=this._undos.get().head;c&&u&&u.type==="command"&&u.name===e&&u.preservesRedoStack===d?this._undos.update(h=>h.tail.push({...u,id:et(),data:r.squash(u.data,a)})):this._undos.update(h=>h.push({type:"command",name:e,data:a,id:et(),preservesRedoStack:d})),s.preservesRedoStack||this._redos.set(Pa()),this.ctx.emit("change-history",{reason:"push"})}return this.ctx};return i});y(this,"batch",e=>{try{this._batchDepth++,this._batchDepth===1?zr(()=>{var r,i;const t=(r=this._undos.get().head)==null?void 0:r.id;e(),t!==((i=this._undos.get().head)==null?void 0:i.id)&&this.onBatchComplete()}):e()}catch(t){throw this.annotateError(t),t}finally{this._batchDepth--}return this});y(this,"ignoringUpdates",e=>{let t=this._undos.get(),r=this._redos.get();this._undos.set(Pa()),this._redos.set(Pa());try{({undos:t,redos:r}=zr(()=>e(t,r)))}finally{this._undos.set(t),this._redos.set(r)}});y(this,"_undo",({pushToRedoStack:e,toMark:t=void 0})=>(this.ignoringUpdates((r,i)=>{var o;if(r.length===0)return{undos:r,redos:i};for(;((o=r.head)==null?void 0:o.type)==="STOP";){const s=r.head;if(r=r.tail,e&&(i=i.push(s)),s.id===t)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i}}if(r.length===0)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i};for(;r.head;){const s=r.head;if(r=r.tail,e&&(i=i.push(s)),s.type==="STOP"){if(s.onUndo&&(!t||s.id===t))return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i}}else this._commands[s.name].undo(s.data)}return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i}}),this));y(this,"undo",()=>(this._undo({pushToRedoStack:!0}),this));y(this,"redo",()=>(this.ignoringUpdates((e,t)=>{var r;if(t.length===0)return{undos:e,redos:t};for(;((r=t.head)==null?void 0:r.type)==="STOP";)e=e.push(t.head),t=t.tail;if(t.length===0)return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t};for(;t.head;){const i=t.head;if(e=e.push(t.head),t=t.tail,i.type==="STOP"){if(i.onRedo)break}else{const o=this._commands[i.name];o.redo?o.redo(i.data):o.do(i.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t}}),this));y(this,"bail",()=>(this._undo({pushToRedoStack:!1}),this));y(this,"bailToMark",e=>(this._undo({pushToRedoStack:!1,toMark:e}),this));y(this,"mark",(e=et(),t=!0,r=!0)=>{const i=this._undos.get().head;return i&&i.type==="STOP"&&i.id===e&&i.onUndo===t&&i.onRedo===r?i.id:(this._undos.update(o=>o.push({type:"STOP",id:e,onUndo:t,onRedo:r})),this.ctx.emit("mark-history",{id:e}),e)});this.ctx=e,this.annotateError=t}getNumUndos(){return this._undos.get().length}getNumRedos(){return this._redos.get().length}clear(){this._undos.set(Pa()),this._redos.set(Pa())}}class AU{constructor(e){y(this,"scribbleItems",new Map);y(this,"state","paused");y(this,"addScribble",(e,t=et())=>{const r={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,r),this.state==="paused"&&this.resume(),r});y(this,"stop",e=>{const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t});y(this,"addPoint",(e,t,r)=>{const i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);const{prev:o}=i,s={x:t,y:r,z:.5};return(!o||C.Dist(o,s)>=1)&&(i.next=s),i});y(this,"tick",e=>{this.editor.batch(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:l,prev:c}=t;l&&l!==c&&(t.prev=l,t.scribble.points.push(l)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:r,timeoutMs:i,prev:o,next:s,scribble:a}=t;switch(a.state){case"active":{s&&s!==o?(t.prev=s,a.points.push(s),r===0&&a.points.length>8&&a.points.shift()):i===0&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break}case"stopping":{if(t.delayRemaining===0&&i===0){if(a.points.length===1){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)}),this.scribbleItems.size===0&&this.pause()})});this.editor=e}resume(){this.state="running",this.editor.addListener("tick",this.tick)}pause(){this.editor.removeListener("tick",this.tick),this.state="paused"}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear(),this.pause()}}class TU{constructor(e){y(this,"_beforeCreateHandlers",{});y(this,"_afterCreateHandlers",{});y(this,"_beforeChangeHandlers",{});y(this,"_afterChangeHandlers",{});y(this,"_beforeDeleteHandlers",{});y(this,"_afterDeleteHandlers",{});y(this,"_batchCompleteHandlers",[]);this.editor=e,e.store.onBeforeCreate=(r,i)=>{const o=this._beforeCreateHandlers[r.typeName];if(o){let s=r;for(const a of o)s=a(s,i);return s}return r},e.store.onAfterCreate=(r,i)=>{const o=this._afterCreateHandlers[r.typeName];if(o)for(const s of o)s(r,i)},e.store.onBeforeChange=(r,i,o)=>{const s=this._beforeChangeHandlers[i.typeName];if(s){let a=i;for(const l of s)a=l(r,a,o);return a}return i};let t=0;e.store.onAfterChange=(r,i,o)=>{if(t++,t>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{const s=this._afterChangeHandlers[i.typeName];if(s)for(const a of s)a(r,i,o)}t--},e.store.onBeforeDelete=(r,i)=>{const o=this._beforeDeleteHandlers[r.typeName];if(o){for(const s of o)if(s(r,i)===!1)return!1}},e.store.onAfterDelete=(r,i)=>{const o=this._afterDeleteHandlers[r.typeName];if(o)for(const s of o)s(r,i)},e.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach(r=>r())}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>Ia(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>Ia(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>Ia(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>Ia(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>Ia(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>Ia(this._afterDeleteHandlers[e],t)}registerBatchCompleteHandler(e){return this._batchCompleteHandlers.push(e),()=>Ia(this._batchCompleteHandlers,e)}}function Ia(n,e){const t=n.indexOf(e);t>=0&&n.splice(t,1)}var jU=Object.defineProperty,RU=Object.getOwnPropertyDescriptor,Ma=(n,e,t,r)=>{for(var i=r>1?void 0:r?RU(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&jU(e,t,i),i};const ge=n=>Math.round(n*10**8)/10**8;function Mo(n,e,t,r,i){const o=n.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&ge(a.length)===ge(t)&&ai(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));if(o.length===0)return[];const s=new Set;return o.forEach(a=>{const l=r==="forward"?a.endNode.id:a.startNode.id;if(!s.has(l)){s.add(l);const c=Mo(n,l,t,r,ai(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));o.push(...c)}}),o}function DU(n){n.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=n.length-1;e>0;e--){const t=n[e];for(let r=e-1;r>=0;r--){const i=n[r];if(i.direction===t.direction&&t.gaps.every(o=>i.gaps.some(s=>ge(o.startEdge[0].x)===ge(s.startEdge[0].x)&&ge(o.startEdge[0].y)===ge(s.startEdge[0].y)&&ge(o.startEdge[1].x)===ge(s.startEdge[1].x)&&ge(o.startEdge[1].y)===ge(s.startEdge[1].y))&&i.gaps.some(s=>ge(o.endEdge[0].x)===ge(s.endEdge[0].x)&&ge(o.endEdge[0].y)===ge(s.endEdge[0].y)&&ge(o.endEdge[1].x)===ge(s.endEdge[1].x)&&ge(o.endEdge[1].y)===ge(s.endEdge[1].y)))){n.splice(e,1);break}}}}class Es{constructor(e){y(this,"_snapLines",On("snapLines",void 0));this.editor=e}getLines(){return this._snapLines.get()??vo}clear(){this.getLines().length&&this._snapLines.set(void 0)}setLines(e){this._snapLines.set(e)}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const r=e.getShapePageTransform(t.id);return r?this.editor.getShapeGeometry(t).snapPoints.map((i,o)=>{const{x:s,y:a}=oe.applyToPoint(r,i);return{x:s,y:a,id:`${t.id}:${o}`}}):void 0})}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getRenderingBounds(),r=e.getSelectedShapeIds(),i=[],o=s=>{const a=e.getSortedChildIdsForParent(s);for(const l of a){if(r.includes(l))continue;const c=e.getShape(l);if(!c||!e.getShapeUtil(c).canSnap(c))continue;const d=e.getShapePageBounds(l);if(d&&t.includes(d)){if(e.isShapeOfType(c,"group")){o(l);continue}i.push({id:l,pageBounds:d,isClosed:e.getShapeGeometry(c).isClosed})}}};return o(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.getSnappableShapes(),r=[];return t.forEach(i=>{const o=e.get(i.id);o&&r.push(...o)}),r}getVisibleGaps(){const e=[],t=[];let r,i;const o=this.getSnappableShapes().sort((a,l)=>a.pageBounds.minX-l.pageBounds.minX);for(let a=0;a<o.length;a++){r=o[a];for(let l=a+1;l<o.length;l++)i=o[l],r.pageBounds.maxX<i.pageBounds.minX&&bu(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:r,endNode:i,startEdge:[new C(r.pageBounds.maxX,r.pageBounds.minY),new C(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new C(i.pageBounds.minX,i.pageBounds.minY),new C(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:ai(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const s=o.sort((a,l)=>a.pageBounds.minY-l.pageBounds.minY);for(let a=0;a<s.length;a++){r=s[a];for(let l=a+1;l<s.length;l++)i=s[l],r.pageBounds.maxY<i.pageBounds.minY&&bu(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&t.push({startNode:r,endNode:i,startEdge:[new C(r.pageBounds.minX,r.pageBounds.maxY),new C(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new C(i.pageBounds.minX,i.pageBounds.minY),new C(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:ai(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslate({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:r,dragDelta:i}){var w,v;const o=this.getSnapThreshold(),s=this.getSnappablePoints(),a=t.clone().translate(i),l=r.map(({x:b,y:_},x)=>({id:"selection:"+x,x:b+i.x,y:_+i.y})),c=s,d=[],u=[],h=new C(o,o);this.collectPointSnaps({minOffset:h,nearestSnapsX:d,nearestSnapsY:u,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u,minOffset:h});const p=new C(e==="x"?0:((w=d[0])==null?void 0:w.nudge)??0,e==="y"?0:((v=u[0])==null?void 0:v.nudge)??0);h.x=0,h.y=0,d.length=0,u.length=0,l.forEach(b=>{b.x+=p.x,b.y+=p.y}),a.translate(p),this.collectPointSnaps({minOffset:h,nearestSnapsX:d,nearestSnapsY:u,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u,minOffset:h});const g=this.getPointSnapLines({nearestSnapsX:d,nearestSnapsY:u}),f=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u});return this._snapLines.set([...f,...g]),{nudge:p}}getOutlinesInPageSpace(){return this.getSnappableShapes().map(({id:e,isClosed:t})=>{const r=bn(this.editor.getShapeGeometry(e).vertices);t&&r.push(r[0]);const i=this.editor.getShapePageTransform(e);if(!i)throw Error("No page transform");return oe.applyToPoints(i,r)})}getSnappingHandleDelta({handlePoint:e,additionalSegments:t}){const r=this.getSnapThreshold(),i=this.getOutlinesInPageSpace();let o=r,s=null,a,l,c,d;const u=[...i,...t];for(const h of u)for(let p=0;p<h.length-1;p++)a=h[p],l=h[p+1],c=C.NearestPointOnLineSegment(a,l,e),d=C.Dist(e,c),!isNaN(d)&&d<o&&(o=d,s=c);return s?(this._snapLines.set([{id:et(),type:"points",points:[s]}]),C.Sub(s,e)):null}snapResize({initialSelectionPageBounds:e,dragDelta:t,handle:r,isAspectRatioLocked:i,isResizingFromCenter:o}){var P,I;const s=this.getSnapThreshold(),{box:a,scaleX:l,scaleY:c}=de.Resize(e,r,o?t.x*2:t.x,o?t.y*2:t.y,i);let d=r;l<0&&(d=w$(d)),c<0&&(d=y$(d)),o&&(a.center=e.center);const u=d==="top"||d==="bottom",h=d==="left"||d==="right",p=WM(d,a),g=this.getSnappablePoints(),f=[],w=[],v=new C(s,s);this.collectPointSnaps({minOffset:v,nearestSnapsX:f,nearestSnapsY:w,otherNodeSnapPoints:g,selectionSnapPoints:p});const b=new C(u?0:((P=f[0])==null?void 0:P.nudge)??0,h?0:((I=w[0])==null?void 0:I.nudge)??0);if(i&&b$(d)&&b.len()!==0){const A=f.length&&w.length?Math.abs(b.x)<Math.abs(b.y)?"x":"y":f.length?"x":"y",T=e.aspectRatio;A==="x"?(w.length=0,b.y=b.x/T,(d==="bottom_left"||d==="top_right")&&(b.y=-b.y)):(f.length=0,b.x=b.y*T,(d==="bottom_left"||d==="top_right")&&(b.x=-b.x))}const _=C.Add(t,b),{box:x}=de.Resize(e,r,o?_.x*2:_.x,o?_.y*2:_.y,i);o&&(x.center=e.center);const E=WM("any",x);f.length=0,w.length=0,v.x=0,v.y=0,this.collectPointSnaps({minOffset:v,nearestSnapsX:f,nearestSnapsY:w,otherNodeSnapPoints:g,selectionSnapPoints:E});const k=this.getPointSnapLines({nearestSnapsX:f,nearestSnapsY:w});return this._snapLines.set([...k]),{nudge:b}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:r,nearestSnapsX:i,nearestSnapsY:o}){for(const s of e)for(const a of t){const l=C.Sub(s,a),c=Math.abs(l.x),d=Math.abs(l.y);ge(c)<=ge(r.x)&&(ge(c)<ge(r.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.x-s.x}),r.x=c),ge(d)<=ge(r.y)&&(ge(d)<ge(r.y)&&(o.length=0),o.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.y-s.y}),r.y=d)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:r,nearestSnapsY:i}){const{horizontal:o,vertical:s}=this.getVisibleGaps();for(const a of o){if(!bu(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const l=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&ge(Math.abs(l))<=ge(t.x)){ge(Math.abs(l))<ge(t.x)&&(r.length=0),t.x=Math.abs(l);const f={type:"gap_center",gap:a,nudge:l},w=r.find(({type:b})=>b==="gap_center"),v=w&&ai(a.breadthIntersection[0],a.breadthIntersection[1],w.gap.breadthIntersection[0],w.gap.breadthIntersection[1]);w&&w.gap.length>a.length&&v?r[r.indexOf(w)]=f:(!w||!v)&&r.push(f)}const c=a.startNode.pageBounds.minX-a.length,d=e.maxX,u=c-d;ge(Math.abs(u))<=ge(t.x)&&(ge(Math.abs(u))<ge(t.x)&&(r.length=0),t.x=Math.abs(u),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:u}));const h=a.endNode.pageBounds.maxX+a.length,p=e.minX,g=h-p;ge(Math.abs(g))<=ge(t.x)&&(ge(Math.abs(g))<ge(t.x)&&(r.length=0),t.x=Math.abs(g),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:g}))}for(const a of s){if(!bu(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const l=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&ge(Math.abs(l))<=ge(t.y)){ge(Math.abs(l))<ge(t.y)&&(i.length=0),t.y=Math.abs(l);const f={type:"gap_center",gap:a,nudge:l},w=i.find(({type:b})=>b==="gap_center"),v=w&&bu(w.gap.breadthIntersection[0],w.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);w&&w.gap.length>a.length&&v?i[i.indexOf(w)]=f:(!w||!v)&&i.push(f);continue}const c=a.startNode.pageBounds.minY-a.length,d=e.maxY,u=c-d;ge(Math.abs(u))<=ge(t.y)&&(ge(Math.abs(u))<ge(t.y)&&(i.length=0),t.y=Math.abs(u),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:u}));const h=a.endNode.pageBounds.maxY+a.length,p=e.minY,g=h-p;ge(Math.abs(g))<=ge(t.y)&&(ge(Math.abs(g))<ge(t.y)&&(i.length=0),t.y=Math.abs(g),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:g}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const r={},i={};if(e.length>0){for(const o of e)if(o.type==="points"){const s=ge(o.points.otherPoint.x);r[s]||(r[s]=[]),r[s].push(o.points)}}if(t.length>0){for(const o of t)if(o.type==="points"){const s=ge(o.points.otherPoint.y);i[s]||(i[s]=[]),i[s].push(o.points)}}return Object.values(r).concat(Object.values(i)).map(o=>({id:et(),type:"points",points:Af(o.map(s=>C.From(s.otherPoint)).concat(o.map(s=>C.From(s.thisPoint))),(s,a)=>s.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:r}){const{vertical:i,horizontal:o}=this.getVisibleGaps(),s={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(const l of t){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:d,startNode:u,endNode:h,length:p,endEdge:g}}=l;switch(l.type){case"gap_center":{const f=(p-e.width)/2,w=ai(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:et(),gaps:[...Mo(o,u.id,f,"backward",w),{startEdge:d,endEdge:s.left},{startEdge:s.right,endEdge:g},...Mo(o,h.id,f,"forward",w)]});break}case"gap_duplicate":{const f=ai(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:et(),gaps:l.protrusionDirection==="left"?[{startEdge:s.right,endEdge:d.map(w=>w.clone().addXY(-u.pageBounds.width,0))},{startEdge:d,endEdge:g},...Mo(o,h.id,p,"forward",f)]:[...Mo(o,u.id,p,"backward",f),{startEdge:d,endEdge:g},{startEdge:g.map(w=>w.clone().addXY(l.gap.endNode.pageBounds.width,0)),endEdge:s.left}]});break}}}if(r.length>0)for(const l of r){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:d,startNode:u,endNode:h,length:p,endEdge:g}}=l;switch(l.type){case"gap_center":{const f=(p-e.height)/2,w=ai(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:et(),gaps:[...Mo(i,u.id,f,"backward",w),{startEdge:d,endEdge:s.top},{startEdge:s.bottom,endEdge:g},...Mo(i,l.gap.endNode.id,f,"forward",w)]});break}case"gap_duplicate":{const f=ai(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:et(),gaps:l.protrusionDirection==="top"?[{startEdge:s.bottom,endEdge:d.map(w=>w.clone().addXY(0,-u.pageBounds.height))},{startEdge:d,endEdge:g},...Mo(i,h.id,p,"forward",f)]:[...Mo(i,u.id,p,"backward",f),{startEdge:d,endEdge:g},{startEdge:g.map(w=>w.clone().addXY(0,h.pageBounds.height)),endEdge:s.top}]})}break}}return DU(a),a}}Ma([Q],Es.prototype,"getSnapPointsCache",1),Ma([Q],Es.prototype,"getSnapThreshold",1),Ma([Q],Es.prototype,"getSnappableShapes",1),Ma([Q],Es.prototype,"getCurrentCommonAncestor",1),Ma([Q],Es.prototype,"getSnappablePoints",1),Ma([Q],Es.prototype,"getVisibleGaps",1),Ma([Q],Es.prototype,"getOutlinesInPageSpace",1);function WM(n,e){const{minX:t,maxX:r,minY:i,maxY:o}=e,s=[];switch(n){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:t,y:i})}switch(n){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(n){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(n){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:t,y:o})}return s}const OU=/\r?\n|\r/g;function KM(n){return n.replace(OU,`
`).split(`
`).map(e=>e||" ").join(`
`)}const LU={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},zU=/\s/;class NU{constructor(e){y(this,"measureText",(e,t)=>{const r=this.getTextElement();r.setAttribute("dir","ltr"),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-style",t.fontStyle),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("font-size",t.fontSize+"px"),r.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),r.style.setProperty("max-width",t.maxWidth===null?null:t.maxWidth+"px"),r.style.setProperty("min-width",t.minWidth??null),r.style.setProperty("padding",t.padding),r.textContent=KM(e);const i=r.getBoundingClientRect();return{x:0,y:0,w:i.width,h:i.height}});this.editor=e}getTextElement(){var t;(t=document.querySelector(".tl-text-measure"))==null||t.remove();const e=document.createElement("div");return this.editor.getContainer().appendChild(e),e.id=`__textMeasure_${et()}`,e.classList.add("tl-text"),e.classList.add("tl-text-measure"),e.tabIndex=-1,e}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const r=[],i=e.getBoundingClientRect(),o=-i.left,s=-i.top,a=new Range,l=e.childNodes[0];let c=0,d=null,u=null,h=0,p=!1;for(const g of e.childNodes)if(g.nodeType===Node.TEXT_NODE)for(const f of g.textContent??""){a.setStart(l,c),a.setEnd(l,c+f.length);const w=a.getClientRects(),v=w[w.length-1],b=v.top+s,_=v.left+o,x=v.right+o,E=zU.test(f);if(E!==u||b!==h||!d){if(d){if(t&&b!==h){p=!0;break}r.push(d)}d={box:{x:_,y:b,w:v.width,h:v.height},text:f}}else d.box.w=x-d.box.x,d.text+=f;u=E,h=b,c+=f.length}return d&&r.push(d),{spans:r,didTruncate:p}}measureTextSpans(e,t){if(e==="")return[];const r=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip",i=this.getTextElement(),o=Math.ceil(t.width-t.padding*2);i.style.setProperty("width",`${o}px`),i.style.setProperty("height","min-content"),i.style.setProperty("dir","ltr"),i.style.setProperty("font-size",`${t.fontSize}px`),i.style.setProperty("font-family",t.fontFamily),i.style.setProperty("font-weight",t.fontWeight),i.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),i.style.setProperty("text-align",LU[t.textAlign]),r&&(i.style.setProperty("overflow-wrap","anywhere"),i.style.setProperty("word-break","break-all")),e=KM(e),i.textContent=e;const{spans:s,didTruncate:a}=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:r});if(t.overflow==="truncate-ellipsis"&&a){i.textContent="\u2026";const l=Math.ceil(this.measureElementTextNodeSpans(i).spans[0].box.w);i.style.setProperty("width",`${o-l}px`),i.textContent=e;const c=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:!0}).spans,d=c[c.length-1];return c.push({text:"\u2026",box:{x:Math.min(d.box.x+d.box.w,t.width-t.padding-l),y:d.box.y,w:l,h:d.box.h}}),c}return i.remove(),s}}class FU{constructor(e){y(this,"raf");y(this,"isPaused",!0);y(this,"last",0);y(this,"t",0);y(this,"start",()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()});y(this,"tick",()=>{if(this.isPaused)return;const e=Date.now(),t=e-this.last;if(this.last=e,this.t+=t,this.editor.emit("frame",t),this.t<16){this.raf=requestAnimationFrame(this.tick);return}this.t-=16,this.updatePointerVelocity(t),this.editor.emit("tick",t),this.raf=requestAnimationFrame(this.tick)});y(this,"dispose",()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)});y(this,"prevPoint",new C);y(this,"updatePointerVelocity",e=>{const{prevPoint:t,editor:{inputs:{currentScreenPoint:r,pointerVelocity:i}}}=this;if(e===0)return;const o=C.Sub(r,t);this.prevPoint=r.clone();const s=o.len(),a=s?o.div(s):new C(0,0),l=i.clone().lrp(a.mul(s/e),.5);Math.abs(l.x)<.01&&(l.x=0),Math.abs(l.y)<.01&&(l.y=0),i.equals(l)||(this.editor.inputs.pointerVelocity=l)});this.editor=e,this.editor.disposables.add(this.dispose),this.start()}}var $U=Object.defineProperty,BU=Object.getOwnPropertyDescriptor,Ao=(n,e,t,r)=>{for(var i=r>1?void 0:r?BU(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&$U(e,t,i),i};class Ni{constructor(e,t){y(this,"updateUserPreferences",e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})});this.user=e,this.inferDarkMode=t}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),isDarkMode:this.getIsDarkMode(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode()}}getIsDarkMode(){return this.user.userPreferences.get().isDarkMode??(this.inferDarkMode?ZB():!1)}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??nr.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??nr.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??nr.name}getLocale(){return this.user.userPreferences.get().locale??nr.locale}getColor(){return this.user.userPreferences.get().color??nr.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??nr.isSnapMode}}Ao([Q],Ni.prototype,"getUserPreferences",1),Ao([Q],Ni.prototype,"getIsDarkMode",1),Ao([Q],Ni.prototype,"getEdgeScrollSpeed",1),Ao([Q],Ni.prototype,"getAnimationSpeed",1),Ao([Q],Ni.prototype,"getId",1),Ao([Q],Ni.prototype,"getName",1),Ao([Q],Ni.prototype,"getLocale",1),Ao([Q],Ni.prototype,"getColor",1),Ao([Q],Ni.prototype,"getIsSnapMode",1);function Au(n){return Math.abs(n.props.bend)<8}function wg(n,e){if(e.type==="point")return;const t=n.getShape(e.boundShapeId),r=n.getShapePageTransform(t),i=n.getShapeGeometry(t),o=i instanceof _s?i.children[0].vertices:i.vertices;return{shape:t,transform:r,isClosed:i.isClosed,isExact:e.isExact,didIntersect:!1,outline:o}}function GM(n,e,t,r){if(t.type==="point")return C.From(t);const i=n.getShape(t.boundShapeId);if(i){const{point:o,size:s}=n.getShapeGeometry(i).bounds,a=C.Add(o,C.MulV(t.isPrecise||r?t.normalizedAnchor:{x:.5,y:.5},s)),l=oe.applyToPoint(n.getShapePageTransform(i),a);return oe.applyToPoint(oe.Inverse(e),l)}else return new C(0,0)}function di(n,e){const t=n.getShapePageTransform(e);let r,i;e.props.start.type==="binding"&&e.props.end.type==="binding"&&(r=e.props.start.boundShapeId,i=e.props.end.boundShapeId);const o=zv(n,r,i),s=GM(n,t,e.props.start,o==="double-bound"||o==="start-contains-end"),a=GM(n,t,e.props.end,o==="double-bound"||o==="end-contains-start");return{start:s,end:a}}const oc=10,bg=10,UU=10,Ps={s:2,m:3.5,l:5,xl:10};function zv(n,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const r=n.getShapePageBounds(e),i=n.getShapePageBounds(t);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}function Tu(n,e){const{start:t,end:r,arrowheadStart:i,arrowheadEnd:o}=e.props,s=di(n,e),a=s.start.clone(),l=s.end.clone(),c=C.Med(a,l);if(C.Equals(a,l))return{isStraight:!0,start:{handle:a,point:a,arrowhead:e.props.arrowheadStart},end:{handle:l,point:l,arrowhead:e.props.arrowheadEnd},middle:c,isValid:!1,length:0};const d=C.Sub(l,a).uni(),u=wg(n,t),h=wg(n,r),p=n.getShapePageTransform(e);YM(l,s.start,p,h),YM(a,s.end,p,u);let g=0,f=0,w=0,v=0,b=oc;const _=u&&h&&u.shape===h.shape,x=u&&h?zv(n,u.shape.id,h.shape.id):"safe";x==="safe"&&u&&h&&!_&&!u.isExact&&!h.isExact&&(h.didIntersect&&!u.didIntersect?u.isClosed&&a.setTo(l.clone().add(d.clone().mul(oc))):h.didIntersect||h.isClosed&&l.setTo(a.clone().sub(d.clone().mul(oc))));const E=C.Sub(l,a).uni(),k=!C.Equals(E,d);_||(x!=="start-contains-end"&&u&&i!=="none"&&!u.isExact&&(w=Ps[e.props.size]/2+("size"in u.shape.props?Ps[u.shape.props.size]/2:0),g=bg+w,b+=w),x!=="end-contains-start"&&h&&o!=="none"&&!h.isExact&&(v=Ps[e.props.size]/2+("size"in h.shape.props?Ps[h.shape.props.size]/2:0),f=bg+v,b+=v));const P=a.clone().add(E.clone().mul(g*(k?-1:1))),I=l.clone().sub(E.clone().mul(f*(k?-1:1)));C.Dist(P,I)<b&&(g!==0&&f!==0?(g*=-1.5,f*=-1.5):g!==0?g*=-1:f!==0&&(f*=-1)),a.add(E.clone().mul(g*(k?-1:1))),l.sub(E.clone().mul(f*(k?-1:1))),k?(u&&h&&l.setTo(C.Add(a,E.clone().mul(-oc))),c.setTo(C.Med(s.start,s.end))):c.setTo(C.Med(a,l));const A=C.Dist(a,l);return{isStraight:!0,start:{handle:s.start,point:a,arrowhead:e.props.arrowheadStart},end:{handle:s.end,point:l,arrowhead:e.props.arrowheadEnd},middle:c,isValid:A>0,length:A}}function YM(n,e,t,r){if(r===void 0||r.isExact)return;const i=oe.applyToPoint(t,e),o=oe.applyToPoint(t,n),s=oe.applyToPoint(oe.Inverse(r.transform),i),a=oe.applyToPoint(oe.Inverse(r.transform),o),l=r.isClosed,c=(l?sU:IM)(s,a,r.outline);let d;if(c!==null&&(d=c.sort((p,g)=>C.Dist(p,s)-C.Dist(g,s))[0]??(l?void 0:a)),d===void 0)return;const u=oe.applyToPoint(r.transform,d),h=oe.applyToPoint(oe.Inverse(t),u);n.setTo(h),r.didIntersect=!0}function Nv(n,e,t=0){const{arrowheadEnd:r,arrowheadStart:i}=e.props,o=e.props.bend+t;if(Math.abs(o)>Math.abs(e.props.bend*UU))return Tu(n,e);const s=di(n,e),a=C.Med(s.start,s.end),l=C.Sub(s.end,s.start).uni(),c=C.Add(a,l.per().mul(-o)),d=wg(n,e.props.start),u=wg(n,e.props.end),h=s.start.clone(),p=s.end.clone(),g=c.clone();if(C.Equals(h,p))return{isStraight:!0,start:{handle:h,point:h,arrowhead:e.props.arrowheadStart},end:{handle:p,point:p,arrowhead:e.props.arrowheadEnd},middle:g,isValid:!1,length:0};const f=e.props.bend<0,w=f?Zf:d9,v=XM(h,p,g),b=C.Angle(v.center,h),_=C.Angle(v.center,p),x=w(b,_);if(v.length===0||v.size===0||!PI(v.length)||!PI(v.size))return Tu(n,e);const E=h.clone(),k=p.clone(),P=g.clone(),I=n.getShapePageTransform(e);let A=0,T=0,O=oc;if(d&&!d.isExact){const N=oe.applyToPoint(I,E),Y=oe.applyToPoint(I,v.center),ee=oe.applyToPoint(I,k),pe=oe.Inverse(d.transform),ve=oe.applyToPoint(pe,N),be=oe.applyToPoint(pe,Y),fe=oe.applyToPoint(pe,ee),{isClosed:Ee}=d,zt=Ee?MM:AM;let We,Fe=zt(be,v.radius,d.outline);if(Fe){const Ke=be.angle(ve),ki=be.angle(fe),or=w(Ke,ki);Fe=Fe.filter(Nt=>w(Ke,be.angle(Nt))<=or);const Mr=or*.25;Fe.sort(Ee?(Nt,Tt)=>Math.abs(w(Ke,be.angle(Nt))-Mr)<Math.abs(w(Ke,be.angle(Tt))-Mr)?-1:1:(Nt,Tt)=>w(Ke,be.angle(Nt))<w(Ke,be.angle(Tt))?-1:1),We=Fe[0]??(Ee?void 0:ve)}else We=Ee?void 0:ve;if(We&&(E.setTo(n.getPointInShapeSpace(e,oe.applyToPoint(d.transform,We))),d.didIntersect=!0,i!=="none")){const Ke=Ps[e.props.size]/2+("size"in d.shape.props?Ps[d.shape.props.size]/2:0);A=bg+Ke,O+=Ke}}if(u&&!u.isExact){const N=oe.applyToPoint(I,E),Y=oe.applyToPoint(I,k),ee=oe.applyToPoint(I,v.center),pe=oe.Inverse(u.transform),ve=oe.applyToPoint(pe,N),be=oe.applyToPoint(pe,ee),fe=oe.applyToPoint(pe,Y),Ee=u.isClosed,zt=Ee?MM:AM;let We,Fe=zt(be,v.radius,u.outline);if(Fe){const Ke=be.angle(ve),ki=be.angle(fe),or=w(Ke,ki),Mr=or*.75;Fe=Fe.filter(Nt=>w(Ke,be.angle(Nt))<=or),Fe.sort(Ee?(Nt,Tt)=>Math.abs(w(Ke,be.angle(Nt))-Mr)<Math.abs(w(Ke,be.angle(Tt))-Mr)?-1:1:(Nt,Tt)=>w(Ke,be.angle(Nt))<w(Ke,be.angle(Tt))?-1:1),Fe[0]?We=Fe[0]:We=Ee?void 0:fe}else We=Ee?void 0:fe;if(We&&(k.setTo(n.getPointInShapeSpace(e,oe.applyToPoint(u.transform,We))),u.didIntersect=!0,r!=="none")){const Ke=Ps[e.props.size]/2+("size"in u.shape.props?Ps[u.shape.props.size]/2:0);T=bg+Ke,O+=Ke}}let F=C.Angle(v.center,E),H=C.Angle(v.center,k),D=w(F,H),K=D*v.radius;const B=E.clone(),te=k.clone();if(A!==0){const N=A/K*(f?1:-1),Y=C.FromAngle(F+D*N);B.setTo(v.center).add(Y.mul(v.radius))}if(T!==0){const N=T/K*(f?-1:1),Y=C.FromAngle(H+D*N);te.setTo(v.center).add(Y.mul(v.radius))}if(C.Dist(B,te)<O&&(A!==0&&T!==0?(A*=-1.5,T*=-1.5):A!==0?A*=-2:T!==0&&(T*=-2)),A!==0){const N=A/K*(f?1:-1),Y=C.FromAngle(F+D*N);E.setTo(v.center).add(Y.mul(v.radius))}if(T!==0){const N=T/K*(f?-1:1),Y=C.FromAngle(H+D*N);k.setTo(v.center).add(Y.mul(v.radius))}if(d&&u&&!d.isExact&&!u.isExact){F=C.Angle(v.center,E),H=C.Angle(v.center,k),D=w(F,H),K=D*v.radius;const N=zv(n,d.shape.id,u.shape.id);if(N==="double-bound"&&K<30)E.setTo(h),k.setTo(p),P.setTo(g);else if(N==="safe"&&(d&&!d.didIntersect&&E.setTo(h),u&&!u.didIntersect||w(b,F)>w(b,H))){const Y=Math.min(.9,oc/K)*(f?1:-1),ee=C.FromAngle(F+D*Y);k.setTo(v.center).add(ee.mul(v.radius))}}VU(v.center,v.radius,E,k,P,x,f),E.equals(k)&&(E.setTo(P.clone().addXY(1,1)),k.setTo(P.clone().subXY(1,1))),h.setTo(E),p.setTo(k),g.setTo(P);const W=XM(h,p,g);return{isStraight:!1,start:{point:h,handle:s.start,arrowhead:e.props.arrowheadStart},end:{point:p,handle:s.end,arrowhead:e.props.arrowheadEnd},middle:g,handleArc:v,bodyArc:W,isValid:W.length!==0&&isFinite(W.center.x)&&isFinite(W.center.y)}}function XM(n,e,t){const r=-2*(n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y),i={x:((n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y))/r,y:((n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x))/r},o=C.Dist(i,n),s=+C.Clockwise(n,t,e),a=Math.hypot(n.y-e.y,n.x-e.x),l=Math.hypot(e.y-t.y,e.x-t.x),c=Math.hypot(t.y-n.y,t.x-n.x),d=Math.acos((l*l+c*c-a*a)/(2*l*c))*2,u=+(Ue>d),h=(Xe-d)*(s?1:-1),p=h*o;return{center:i,radius:o,size:h,length:p,largeArcFlag:u,sweepFlag:s}}function VU(n,e,t,r,i,o,s){const a=C.Angle(n,t),l=C.Angle(n,r);let c=Zf(a,l);s||(c=Xe-c);const d=.5*(s?1:-1),u=C.FromAngle(a+c*d);if(i.setTo(n).add(u.mul(e)),c>o){i.rotWith(n,Ue);const h=r.clone();r.setTo(t),t.setTo(h)}}const HU={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"};class ae{constructor(e,t){y(this,"id");y(this,"type");y(this,"shapeType");y(this,"initial");y(this,"children");y(this,"parent");y(this,"_path");y(this,"_current");y(this,"_isActive");y(this,"transition",(e,t={})=>{var o;const r=e.split(".");let i=this;for(let s=0;s<r.length;s++){const a=r[s],l=i.getCurrent(),c=(o=i.children)==null?void 0:o[a];if(!c)throw Error(`${i.id} - no child state exists with the id ${a}.`);if((l==null?void 0:l.id)!==c.id&&(l==null||l.exit(t,a),i._current.set(c),c.enter(t,(l==null?void 0:l.id)||"initial"),!c.getIsActive()))break;i=c}return this});y(this,"handleEvent",e=>{var i;const t=HU[e.name],r=this.getCurrent();(i=this[t])==null||i.call(this,e),this.getCurrent()===r&&this.getIsActive()&&(r==null||r.handleEvent(e))});y(this,"enter",(e,t)=>{var r;if(this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,e,t),this.onTick&&this.editor.on("tick",this.onTick),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(e,t)}});y(this,"exit",(e,t)=>{var r,i;this._isActive.set(!1),this.onTick&&this.editor.off("tick",this.onTick),(r=this.onExit)==null||r.call(this,e,t),this.getIsActive()||((i=this.getCurrent())==null||i.exit(e,t))});y(this,"_currentToolIdMask",On("curent tool id mask",void 0));y(this,"onWheel");y(this,"onPointerDown");y(this,"onPointerMove");y(this,"onPointerUp");y(this,"onDoubleClick");y(this,"onTripleClick");y(this,"onQuadrupleClick");y(this,"onRightClick");y(this,"onMiddleClick");y(this,"onKeyDown");y(this,"onKeyUp");y(this,"onKeyRepeat");y(this,"onCancel");y(this,"onComplete");y(this,"onInterrupt");y(this,"onEnter");y(this,"onExit");y(this,"onTick");this.editor=e;const{id:r,children:i,initial:o}=this.constructor;this.id=r,this._isActive=On("toolIsActive"+this.id,!1),this._current=On("toolState"+this.id,void 0),this._path=Q("toolPath"+this.id,()=>{const s=this.getCurrent();return this.id+(s?`.${s.getPath()}`:"")}),this.parent=t??{},this.parent?i&&o?(this.type="branch",this.initial=o,this.children=Object.fromEntries(i().map(s=>[s.id,new s(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&o&&(this.initial=o,this.children=Object.fromEntries(i().map(s=>[s.id,new s(this.editor,this)])),this._current.set(this.children[this.initial])))}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}y(ae,"id"),y(ae,"initial"),y(ae,"children");class vg extends ae{constructor(){super(...arguments);y(this,"onKeyDown",t=>{var r;switch(t.code){case"KeyZ":{if(!(t.shiftKey||t.ctrlKey)){const i=this.getCurrent();i&&((r=i.getCurrent())==null?void 0:r.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...t,onInteractionEnd:i.id})}break}}})}}y(vg,"id","root"),y(vg,"initial",""),y(vg,"children",()=>[]);var WU=Object.defineProperty,KU=Object.getOwnPropertyDescriptor,he=(n,e,t,r)=>{for(var i=r>1?void 0:r?KU(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&WU(e,t,i),i};class ue extends oU.EventEmitter{constructor({store:t,user:r,shapeUtils:i,tools:o,getContainer:s,initialState:a,inferDarkMode:l}){super();y(this,"store");y(this,"root");y(this,"disposables",new Set);y(this,"_tickManager",new FU(this));y(this,"snaps");y(this,"user");y(this,"textMeasure");y(this,"environment");y(this,"scribbles");y(this,"getContainer");y(this,"sideEffects");y(this,"shapeUtils");y(this,"styleProps");y(this,"history",new MU(this,t=>{this.annotateError(t,{origin:"history.batch",willCrashApp:!0}),this.crash(t)}));y(this,"_crashingError",null);y(this,"_updateInstanceState",this.history.createCommand("updateInstanceState",(t,r)=>{const i=this.store.get(this.getInstanceState().id),o={...i,...t};return{data:{prev:i,next:o},ephemeral:!1,squashing:!1,...r}},{do:({next:t})=>{this.store.put([t])},undo:({prev:t})=>{this.store.put([t])},squash({prev:t},{next:r}){return{prev:t,next:r}}}));y(this,"_isChangingStyleTimeout",-1);y(this,"setCursor",t=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...t}},{ephemeral:!0}),this));y(this,"_setInstancePageState",this.history.createCommand("setInstancePageState",(t,r)=>({data:{prev:this.store.get(t.id??this.getCurrentPageState().id),partial:t},...r}),{do:({prev:t,partial:r})=>{this.store.update(t.id,i=>({...i,...r}))},undo:({prev:t})=>{this.store.update(t.id,()=>t)}}));y(this,"_setSelectedShapes",this.history.createCommand("setSelectedShapes",(t,r)=>{const{selectedShapeIds:i}=this.getCurrentPageState(),o=new Set(i);return t.length===o.size&&t.every(s=>o.has(s))?null:{data:{selectedShapeIds:t,prevSelectedShapeIds:i},preservesRedoStack:!0,...r}},{do:({selectedShapeIds:t})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},undo:({prevSelectedShapeIds:t})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},squash({prevSelectedShapeIds:t},{selectedShapeIds:r}){return{selectedShapeIds:r,prevSelectedShapeIds:t}}}));y(this,"_setFocusedGroupId",this.history.createCommand("setFocusedGroupId",t=>{const r=this.getCurrentPageState().focusedGroupId;if(r!==t)return{data:{prev:r,next:t},preservesRedoStack:!0,squashing:!0}},{do:({next:t})=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:t}))},undo:({prev:t})=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:t}))},squash({prev:t},{next:r}){return{prev:t,next:r}}}));y(this,"_viewportAnimation",null);y(this,"_willSetInitialBounds",!0);y(this,"_cameraState",On("camera state","idle"));y(this,"_cameraStateTimeoutRemaining",0);y(this,"_lastUpdateRenderingBoundsTimestamp",Date.now());y(this,"_decayCameraStateTimeout",t=>{this._cameraStateTimeoutRemaining-=t,this._cameraStateTimeoutRemaining<=0&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"),this.updateRenderingBounds())});y(this,"_tickCameraState",()=>{this._cameraStateTimeoutRemaining=M9;const t=Date.now();this._cameraState.__unsafe__getWithoutCapture()==="idle"?(this._lastUpdateRenderingBoundsTimestamp=t,this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout)):t-this._lastUpdateRenderingBoundsTimestamp>A9&&this.updateRenderingBounds()});y(this,"_renderingBounds",On("rendering viewport",new de));y(this,"_renderingBoundsExpanded",On("rendering viewport expanded",new de));y(this,"renderingBoundsMargin",100);y(this,"_currentPageShapeIds");y(this,"_setCurrentPageId",this.history.createCommand("setCurrentPage",(t,r)=>{if(!this.store.has(t)){console.error("Tried to set the current page id to a page that doesn't exist.");return}return this.stopFollowingUser(),{data:{toId:t,fromId:this.getCurrentPageId()},squashing:!0,preservesRedoStack:!0,...r}},{do:({toId:t})=>{if(this.store.has(t)){if(!this.getPageStates().find(r=>r.pageId===t)){const r=nn.create({id:nn.createId(t)});this.store.put([r,rn.create({id:rn.createId(t),pageId:t})])}this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.updateRenderingBounds()}},undo:({fromId:t})=>{this.store.has(t)&&(this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.updateRenderingBounds())},squash:({fromId:t},{toId:r})=>({toId:r,fromId:t})}));y(this,"_updatePage",this.history.createCommand("updatePage",(t,r)=>{if(this.getInstanceState().isReadonly)return null;const i=this.getPage(t.id);return i?{data:{prev:i,partial:t},...r}:null},{do:({partial:t})=>{this.store.update(t.id,r=>({...r,...t}))},undo:({prev:t,partial:r})=>{this.store.update(r.id,()=>t)},squash(t,r){return{prev:{...t.prev,...r.prev},partial:r.partial}}}));y(this,"_createPage",this.history.createCommand("createPage",t=>{if(this.getInstanceState().isReadonly||this.getPages().length>=ng)return null;const r=this.getPages(),i=fU(t.name??"Page 1",r.map(c=>c.name));let o=t.index;(!o||r.some(c=>c.index===o))&&(o=Io(r[r.length-1].index));const s=ko.create({meta:{},...t,name:i,index:o}),a=nn.create({id:nn.createId(s.id)}),l=rn.create({id:rn.createId(s.id),pageId:s.id});return{data:{newPage:s,newTabPageState:l,newCamera:a}}},{do:({newPage:t,newTabPageState:r,newCamera:i})=>{this.store.put([t,i,r])},undo:({newPage:t,newTabPageState:r,newCamera:i})=>{this.getPages().length!==1&&this.store.remove([r.id,t.id,i.id])}}));y(this,"_deletePage",this.history.createCommand("delete_page",t=>{if(this.getInstanceState().isReadonly)return null;const r=this.getPages();if(r.length===1)return null;const i=this.getPage(t),o=this.getPageStates().filter(s=>s.pageId===t);if(!i)return null;if(t===this.getCurrentPageId()){const s=r.findIndex(l=>l.id===t),a=r[s-1]??r[s+1];this.setCurrentPage(a.id)}return{data:{id:t,deletedPage:i,deletedPageStates:o}}},{do:({deletedPage:t,deletedPageStates:r})=>{const i=this.getPages();if(i.length!==1){if(t.id===this.getCurrentPageId()){const o=i.findIndex(a=>a.id===t.id),s=i[o-1]??i[o+1];this.setCurrentPage(s.id)}this.store.remove(r.map(o=>o.id)),this.store.remove([t.id]),this.updateRenderingBounds()}},undo:({deletedPage:t,deletedPageStates:r})=>{this.store.put([t]),this.store.put(r),this.updateRenderingBounds()}}));y(this,"_createAssets",this.history.createCommand("createAssets",t=>this.getInstanceState().isReadonly||t.length<=0?null:{data:{assets:t}},{do:({assets:t})=>{this.store.put(t)},undo:({assets:t})=>{this.store.remove(t.map(r=>r.id))}}));y(this,"_updateAssets",this.history.createCommand("updateAssets",t=>this.getInstanceState().isReadonly||t.length<=0?void 0:{data:{snapshots:{},assets:t}},{do:({assets:t,snapshots:r})=>{this.store.put(t.map(i=>{const o=this.store.get(i.id);return r[i.id]=o,{...o,...i}}))},undo:({snapshots:t})=>{this.store.put(Object.values(t))}}));y(this,"_deleteAssets",this.history.createCommand("deleteAssets",t=>{if(this.getInstanceState().isReadonly||t.length<=0)return;const r=me(t.map(i=>this.store.get(i)));return{data:{ids:t,prev:r}}},{do:({ids:t})=>{this.store.remove(t)},undo:({prev:t})=>{this.store.put(t)}}));y(this,"_parentIdsToChildIds");y(this,"_childIdsCache",new Rv);y(this,"_createShapes",this.history.createCommand("createShapes",t=>{if(this.getInstanceState().isReadonly||t.length<=0)return null;const r=this.getCurrentPageShapeIds();if(t.length+r.size>Eo){Sg(this);return}return t.length===0?null:{data:{currentPageId:this.getCurrentPageId(),partials:t.map(i=>i.id?i:{...i,id:ot()})}}},{do:({partials:t})=>{var a,l;const r=this.getFocusedGroupId(),i=this.getCurrentPageShapesSorted();t=t.map(c=>{if(!c.parentId||!(this.store.has(c.parentId)||t.some(d=>d.id===c.parentId))){let d=this.getFocusedGroupId();for(let h=i.length-1;h>=0;h--){const p=i[h];if(this.getShapeUtil(p).canReceiveNewChildrenOfType(p,c.type)&&this.isPointInShape(p,{x:c.x??0,y:c.y??0},{margin:0,hitInside:!0})){d=p.id;break}}const u=c.parentId;if(d===c.id&&(d=r),d!==u&&(c={...c},c.parentId=d,Nr(d))){const h=this.getPointInShapeSpace(this.getShape(d),{x:c.x??0,y:c.y??0});c.x=h.x,c.y=h.y,c.rotation=-this.getShapePageTransform(d).rotation()+(c.rotation??0)}}return c});const o=new Map,s=[];for(const c of t){const d=this.getShapeUtil(c);let u=c.index;if(!u){const f=c.parentId??r;o.has(f)||o.set(f,this.getHighestIndexForParent(f)),u=o.get(f),o.set(f,Io(u))}const h=d.getDefaultProps();for(const[f,w]of this.styleProps[c.type])h[w]=this.getStyleForNextShape(f);let p=this.store.schema.types.shape.create({...c,index:u,opacity:c.opacity??this.getInstanceState().opacityForNextShape,parentId:c.parentId??r,props:"props"in c?{...h,...c.props}:h});if(p.index===void 0)throw Error("no index!");const g=(l=(a=this.getShapeUtil(p)).onBeforeCreate)==null?void 0:l.call(a,p);g&&(p=g),s.push(p)}s.forEach(c=>{c.meta={...this.getInitialMetaForShape(c),...c.meta}}),this.store.put(s)},undo:({partials:t})=>{this.store.remove(t.map(r=>r.id))}}));y(this,"animatingShapes",new Map);y(this,"_updateShapes",this.history.createCommand("updateShapes",(t,r)=>{if(this.getInstanceState().isReadonly)return null;const i=me(t),o=Object.fromEntries(me(i.map(({id:l})=>this.getShape(l))).map(l=>[l.id,l]));if(i.length<=0)return null;const s=me(i.map(l=>{const c=o[l.id];if(!c)return null;let d=null;for(const[u,h]of Object.entries(l))if(h!==void 0)switch(u){case"id":case"type":continue;default:if(h!==c[u])if(d||(d={...c}),u==="props"){const p={...c.props};for(const[g,f]of Object.entries(h))f!==void 0&&(p[g]=f);d.props=p}else if(u==="meta"){const p={...c.meta};for(const[g,f]of Object.entries(h))f!==void 0&&(p[g]=f);d.meta=p}else d[u]=h}return d??c})),a=Object.fromEntries(s.map(l=>[l.id,l]));return{data:{snapshots:o,updates:a},...r}},{do:({updates:t})=>{var i,o;const r=Object.values(t);for(let s=0;s<r.length;s++){const a=r[s],l=this.store.get(a.id);if(!l)continue;const c=(o=(i=this.getShapeUtil(a)).onBeforeUpdate)==null?void 0:o.call(i,l,a);c&&(r[s]=c)}this.store.put(r)},undo:({snapshots:t})=>{this.store.put(Object.values(t))},squash(t,r){return{snapshots:{...r.snapshots,...t.snapshots},updates:{...t.updates,...r.updates}}}}));y(this,"_deleteShapes",this.history.createCommand("delete_shapes",t=>{if(this.getInstanceState().isReadonly||t.length===0)return null;const r=[...this.getCurrentPageState().selectedShapeIds],i=new Set(t);for(const c of t)this.visitDescendants(c,d=>{i.add(d)});const o=[...i],s=this._getArrowBindingsIndex().get(),a=me(o.flatMap(c=>{const d=this.getShape(c),u=s[c];return u&&u.length>0?u.map(({arrowId:h})=>this.getShape(h)).concat(d):d})),l=r.filter(c=>!i.has(c));return{data:{deletedIds:o,snapshots:a,prevSelectedShapeIds:r,postSelectedShapeIds:l}}},{do:({deletedIds:t,postSelectedShapeIds:r})=>{this.store.remove(t),this.store.update(this.getCurrentPageState().id,i=>({...i,selectedShapeIds:r}))},undo:({snapshots:t,prevSelectedShapeIds:r})=>{this.store.put(t),this.store.update(this.getCurrentPageState().id,i=>({...i,selectedShapeIds:r}))}}));y(this,"_selectionSharedStyles",Q("_selectionSharedStyles",()=>{const t=this.getSelectedShapes(),r=new jv;for(const i of t)this._extractSharedStyles(i,r);return r}));y(this,"externalAssetContentHandlers",{file:null,url:null});y(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null});y(this,"inputs",{originPagePoint:new C,originScreenPoint:new C,previousPagePoint:new C,previousScreenPoint:new C,currentPagePoint:new C,currentScreenPoint:new C,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new C});y(this,"_clickManager",new EU(this));y(this,"_prevCursor","default");y(this,"_shiftKeyTimeout",-1);y(this,"_setShiftKeyTimeout",()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})});y(this,"_altKeyTimeout",-1);y(this,"_setAltKeyTimeout",()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})});y(this,"_ctrlKeyTimeout",-1);y(this,"_setCtrlKeyTimeout",()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})});y(this,"_restoreToolId","select");y(this,"_pinchStart",1);y(this,"_didPinch",!1);y(this,"_selectedShapeIdsAtPointerDown",[]);y(this,"capturedPointerId",null);y(this,"dispatch",t=>{if(this.getCrashingError())return this;const{inputs:r}=this,{type:i}=t;return this.batch(()=>{if(t.type==="misc"){(t.name==="cancel"||t.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))),this.root.handleEvent(t);return}t.shiftKey?(clearInterval(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,r.shiftKey=!0):!t.shiftKey&&r.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=setTimeout(this._setShiftKeyTimeout,150)),t.altKey?(clearInterval(this._altKeyTimeout),this._altKeyTimeout=-1,r.altKey=!0):!t.altKey&&r.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=setTimeout(this._setAltKeyTimeout,150)),t.ctrlKey?(clearInterval(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,r.ctrlKey=!0):!t.ctrlKey&&r.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:o,originScreenPoint:s,currentPagePoint:a,currentScreenPoint:l}=r;switch(r.isPointing||(r.isDragging=!1),i){case"pinch":{if(!this.getInstanceState().canMoveCamera)return;switch(this._updateInputsFromEvent(t),t.name){case"pinch_start":{if(r.isPinching)return;r.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds()),this._didPinch=!0,r.isPinching=!0,this.interrupt());return}case"pinch":{if(!r.isPinching)return;const{point:{x:c,y:d,z:u=1},delta:{x:h,y:p}}=t,{x:g,y:f,z:w}=this.getCamera(),v=Math.min(xs,Math.max(vu,u));this.setCamera({x:g+h/w-c/w+c/v,y:f+p/w-d/w+d/v,z:v});return}case"pinch_end":{if(!r.isPinching)return this;r.isPinching=!1;const{_selectedShapeIdsAtPointerDown:c}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown,{squashing:!0}),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,requestAnimationFrame(()=>{this._didPinch||this.setSelectedShapes(c,{squashing:!0})}));return}}}case"wheel":{if(!this.getInstanceState().canMoveCamera)return;if(this._updateInputsFromEvent(t),!this.getIsMenuOpen()){if(r.ctrlKey){const{x:c,y:d}=this.inputs.currentScreenPoint,{x:u,y:h,z:p}=this.getCamera(),g=Math.min(xs,Math.max(vu,p+(t.delta.z??0)*p));this.setCamera({x:u+(c/g-c)-(c/p-c),y:h+(d/g-d)-(d/p-d),z:g});return}this.pan(t.delta),!r.isDragging&&r.isPointing&&o.dist(a)>(this.getInstanceState().isCoarsePointer?gv:Su)/this.getZoomLevel()&&(r.isDragging=!0)}break}case"pointer":{if(r.isPinching)return;this._updateInputsFromEvent(t);const{isPen:c}=t;switch(t.name){case"pointer_down":{if(this.clearOpenMenus(),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),t.button===0&&(this.capturedPointerId=t.pointerId),r.buttons.add(t.button),r.isPointing=!0,r.isDragging=!1,this.getInstanceState().isPenMode){if(!c)return}else c&&this.updateInstanceState({isPenMode:!0});if(t.button===5?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):t.button===1&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0),this.inputs.isPanning)return this.stopCameraAnimation(),this.updateInstanceState({cursor:{type:"grabbing",rotation:0}}),this;s.setTo(l),o.setTo(a);break}case"pointer_move":{if(!c&&this.getInstanceState().isPenMode)return;if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:d,previousScreenPoint:u}=this.inputs;this.pan(C.Sub(d,u));return}!r.isDragging&&r.isPointing&&o.dist(a)>(this.getInstanceState().isCoarsePointer?gv:Su)/this.getZoomLevel()&&(r.isDragging=!0);break}case"pointer_up":{if(r.buttons.delete(t.button),r.isPointing=!1,r.isDragging=!1,this.getIsMenuOpen()||!c&&this.getInstanceState().isPenMode)return;this.capturedPointerId===t.pointerId&&(this.capturedPointerId=null,t.button=0),r.isPanning?t.button===1?this.inputs.keys.has(" ")?(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:ig}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):(r.isPanning=!1,this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:ig}),this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}})):t.button===0&&(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:ig}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):t.button===5&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(t.key==="ShiftRight"&&(t.key="ShiftLeft"),t.key==="AltRight"&&(t.key="AltLeft"),t.code==="ControlRight"&&(t.code="ControlLeft"),t.name){case"key_down":{r.keys.add(t.code),!t.ctrlKey&&t.code==="Space"&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,this.updateInstanceState({cursor:{type:this.inputs.isPointing?"grabbing":"grab",rotation:0}}));break}case"key_up":{r.keys.delete(t.code),t.code==="Space"&&!this.inputs.buttons.has(1)&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}));break}}break}}if(t.type==="pointer"&&(t.button===1?t.name="middle_click":t.button===2&&(t.name="right_click"),t.isPen===this.getInstanceState().isPenMode))switch(t.name){case"pointer_down":{const c=this._clickManager.transformPointerDownEvent(t);if(t.name!==c.name){this.root.handleEvent(t),this.emit("event",t),this.root.handleEvent(c),this.emit("event",c);return}break}case"pointer_up":{const c=this._clickManager.transformPointerUpEvent(t);if(t.name!==c.name){this.root.handleEvent(t),this.emit("event",t),this.root.handleEvent(c),this.emit("event",c);return}break}case"pointer_move":{this._clickManager.handleMove();break}}this.root.handleEvent(t),this.emit("event",t)}),this});this.store=t,this.snaps=new Es(this),this.user=new Ni(r??EM(),l??!1),this.getContainer=s??(()=>document.body),this.textMeasure=new NU(this);class c extends vg{}y(c,"initial",a??""),this.root=new c(this),this.root.children={};const d=DM(i),u=new Set(Object.keys(t.schema.types.shape.migrations.subTypeMigrations));for(const x of d){if(!u.has(x.type))throw Error(`Editor and store have different shapes: "${x.type}" was passed into the editor but not the schema`);u.delete(x.type)}if(u.size>0)throw Error(`Editor and store have different shapes: "${[...u][0]}" is present in the store schema but not provided to the editor`);const h={},p={},g=new Map;for(const x of d){const E=new x(this);h[x.type]=E;const k=dI(x.props??{});p[x.type]=k;for(const P of k.keys())if(!g.has(P.id))g.set(P.id,P);else if(g.get(P.id)!==P)throw Error(`Multiple style props with id "${P.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=h,this.styleProps=p;for(const x of[...o]){if(Rf(this.root.children,x.id))throw Error(`Can't override tool with id "${x.id}"`);this.root.children[x.id]=new x(this,this.root)}this.environment=new PU(this),this.scribbles=new AU(this);const f=new Set,w=x=>{var W;const E=this.getShape(x);if(!E)return;const{start:k,end:P}=E.props,I=k.type==="binding"?this.getShape(k.boundShapeId):void 0,A=P.type==="binding"?this.getShape(P.boundShapeId):void 0,T=this.getAncestorPageId(E);if(!T)return;let O;if(I&&A)O=this.findCommonAncestor([I,A])??T;else if(I||A){const N=(W=I||A)==null?void 0:W.parentId;N&&N===E.parentId?O=E.parentId:O=T}else return;O&&O!==E.parentId&&this.reparentShapes([x],O);const F=this.getShape(x);if(!F)throw Error("no reparented arrow");const H=this.getShapeNearestSibling(F,I),D=this.getShapeNearestSibling(F,A);let K;if(H&&D)K=H.index>D.index?H:D;else if(H&&!D)K=H;else if(D&&!H)K=D;else return;let B;const te=this.getSortedChildIdsForParent(K.parentId).map(N=>this.getShape(N)).filter(N=>N.index>K.index);if(te.length){const N=te.find(Y=>Y.type!=="arrow");if(F.index>K.index&&(!N||F.index<N.index))return;B=Mu(K.index,te[0].index)}else B=Io(K.index);B!==F.index&&this.updateShapes([{id:x,type:"arrow",index:B}])},v=(x,E)=>{const{x:k,y:P}=di(this,x)[E];this.store.put([{...x,props:{...x.props,[E]:{type:"point",x:k,y:P}}}])},b=x=>{for(const E of["start","end"]){const k=x.props[E];if(k.type!=="binding")continue;const P=this.getShape(k.boundShapeId),I=this.getAncestorPageId(x)===this.getAncestorPageId(P);(!P||!I)&&v(x,E)}w(x.id)},_=(x,E)=>{let k=null;const P=x.selectedShapeIds.filter(T=>!E.has(T));P.length!==x.selectedShapeIds.length&&(k||(k={...x}),k.selectedShapeIds=P);const I=x.erasingShapeIds.filter(T=>!E.has(T));I.length!==x.erasingShapeIds.length&&(k||(k={...x}),k.erasingShapeIds=I),x.hoveredShapeId&&E.has(x.hoveredShapeId)&&(k||(k={...x}),k.hoveredShapeId=null),x.editingShapeId&&E.has(x.editingShapeId)&&(k||(k={...x}),k.editingShapeId=null);const A=x.hintingShapeIds.filter(T=>!E.has(T));return A.length!==x.hintingShapeIds.length&&(k||(k={...x}),k.hintingShapeIds=A),x.focusedGroupId&&E.has(x.focusedGroupId)&&(k||(k={...x}),k.focusedGroupId=null),k};if(this.sideEffects=new TU(this),this.sideEffects.registerBatchCompleteHandler(()=>{var x,E;for(const k of f){f.delete(k);const P=this.getShape(k);if(!P)continue;const I=(E=(x=this.getShapeUtil(P)).onChildrenChange)==null?void 0:E.call(x,P);I!=null&&I.length&&this.updateShapes(I,{squashing:!0})}this.emit("update")}),this.sideEffects.registerBeforeDeleteHandler("shape",x=>{x.parentId&&Nr(x.parentId)&&f.add(x.parentId);const E=this._getArrowBindingsIndex().get()[x.id];if(E!=null&&E.length)for(const{arrowId:I,handleId:A}of E){const T=this.getShape(I);T&&v(T,A)}const k=new Set([x.id]),P=me(this.getPageStates().map(I=>_(I,k)));P.length&&this.store.put(P)}),this.sideEffects.registerBeforeDeleteHandler("page",x=>{var I;if(this.getInstanceState().currentPageId!==x.id)return;const E=(I=this.getPages().find(A=>A.id!==x.id))==null?void 0:I.id;if(!E)return;this.store.put([{...this.getInstanceState(),currentPageId:E}]);const k=nn.createId(x.id),P=rn.createId(x.id);this.store.remove([k,P])}),this.sideEffects.registerAfterChangeHandler("shape",(x,E)=>{if(this.isShapeOfType(E,"arrow")&&b(E),x.parentId!==E.parentId){const k=P=>{const I=this._getArrowBindingsIndex().get()[P];if(I!=null&&I.length)for(const A of I)w(A.arrowId)};k(E.id),this.visitDescendants(E.id,k)}if(x.parentId!==E.parentId&&Zn(E.parentId)){const k=new Set([x.id]);this.visitDescendants(x.id,P=>{k.add(P)});for(const P of this.getPageStates()){if(P.pageId===E.parentId)continue;const I=_(P,k);I&&this.store.put([I])}}x.parentId&&Nr(x.parentId)&&f.add(x.parentId),E.parentId!==x.parentId&&Nr(E.parentId)&&f.add(E.parentId)}),this.sideEffects.registerAfterChangeHandler("instance_page_state",(x,E)=>{if((x==null?void 0:x.selectedShapeIds)!==(E==null?void 0:E.selectedShapeIds)){const k=E.selectedShapeIds.filter(I=>{var T,O;let A=(T=this.getShape(I))==null?void 0:T.parentId;for(;Nr(A);){if(E.selectedShapeIds.includes(A))return!1;A=(O=this.getShape(A))==null?void 0:O.parentId}return!0});let P=null;if(k.length>0){const I=this.findCommonAncestor(me(k.map(A=>this.getShape(A))),A=>this.isShapeOfType(A,"group"));I&&(P=I)}else E!=null&&E.focusedGroupId&&(P=E.focusedGroupId);(k.length!==E.selectedShapeIds.length||P!==E.focusedGroupId)&&this.store.put([{...E,selectedShapeIds:k,focusedGroupId:P??null}])}}),this.sideEffects.registerAfterCreateHandler("shape",x=>{this.isShapeOfType(x,"arrow")&&b(x)}),this.sideEffects.registerAfterCreateHandler("page",x=>{const E=nn.createId(x.id),k=rn.createId(x.id);this.store.has(E)||this.store.put([nn.create({id:E})]),this.store.has(k)||this.store.put([rn.create({id:k,pageId:x.id})])}),this._currentPageShapeIds=kU(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=_U(this.store),this.disposables.add(this.store.listen(x=>{this.emit("change",x)})),this.store.ensureStoreIsUsable(),this._setInstancePageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]},{ephemeral:!0}),a&&this.root.children[a]===void 0)throw Error(`No state found for initialState "${a}".`);this.root.enter(void 0,"initial"),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.updateRenderingBounds(),requestAnimationFrame(()=>{this._tickManager.start()})}dispose(){this.disposables.forEach(t=>t()),this.disposables.clear()}getShapeUtil(t){const r=typeof t=="string"?t:t.type,i=va(this.shapeUtils,r);return ba(i,`No shape util found for type "${r}"`),i}undo(){return this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this.history.redo(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(t,r,i){return this.history.mark(t,r,i),this}bail(){return this.history.bail(),this}bailToMark(t){return this.history.bailToMark(t),this}batch(t){return this.history.batch(t),this}_getArrowBindingsIndex(){return xU(this)}getArrowsBoundTo(t){return this._getArrowBindingsIndex().get()[t]||vo}getArrowInfoCache(){return this.store.createComputedCache("arrow infoCache",t=>Au(t)?Tu(this,t):Nv(this,t))}getArrowInfo(t){const r=typeof t=="string"?t:t.id;return this.getArrowInfoCache().get(r)}annotateError(t,{origin:r,willCrashApp:i,tags:o,extras:s}){const a=this.createErrorAnnotations(r,i);return Ub(t,{tags:{...a.tags,...o},extras:{...a.extras,...s}}),i&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(t,r){try{const i=this.getEditingShapeId();return{tags:{origin:t,willCrashApp:r},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:i?this.getShape(i):void 0,inputs:this.inputs}}}catch{return{tags:{origin:t,willCrashApp:r},extras:{}}}}getCrashingError(){return this._crashingError}crash(t){return this._crashingError=t,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:t}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(t){const r=t.split(".").reverse();let i=this.root;for(;r.length>0;){const o=r.pop();if(!o)return!0;const s=i.getCurrent();if((s==null?void 0:s.id)===o){if(r.length===0)return!0;i=s;continue}else return!1}return!1}isInAny(...t){return t.some(r=>this.isIn(r))}setCurrentTool(t,r={}){return this.root.transition(t,r),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const t=this.getCurrentTool();return t?t.getCurrentToolIdMask()??t.id:""}getStateDescendant(t){var o;const r=t.split(".").reverse();let i=this.root;for(;r.length>0;){const s=r.pop();if(!s)return i;const a=(o=i.children)==null?void 0:o[s];if(!a)return;i=a}return i}getDocumentSettings(){return this.store.get(ov)}updateDocumentSettings(t){return this.store.put([{...this.getDocumentSettings(),...t}]),this}getInstanceState(){return this.store.get(vn)}updateInstanceState(t,r){return this._updateInstanceState(t,{ephemeral:!0,squashing:!0,...r}),t.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),t.isChangingStyle===!0&&(this._isChangingStyleTimeout=setTimeout(()=>{this.updateInstanceState({isChangingStyle:!1})},2e3))),this}getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(t){const r=new Set(this.getOpenMenus());return r.has(t)||(r.add(t),this.updateInstanceState({openMenus:[...r]})),this}deleteOpenMenu(t){const r=new Set(this.getOpenMenus());return r.has(t)&&(r.delete(t),this.updateInstanceState({openMenus:[...r]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return rn.createId(this.getCurrentPageId())}updateCurrentPageState(t,r){return this._setInstancePageState(t,r),this}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:t}=this.getCurrentPageState();return me(t.map(r=>this.store.get(r)))}setSelectedShapes(t,r){const i=t.map(o=>typeof o=="string"?o:o.id);return this._setSelectedShapes(i,r),this}isAncestorSelected(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null,i=this.getShape(r);if(!i)return!1;const o=this.getSelectedShapeIds();return!!this.findShapeAncestor(i,s=>o.includes(s.id))}select(...t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this.setSelectedShapes(r),this}deselect(...t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=this.getSelectedShapeIds();return i.length>0&&r.length>0&&this.setSelectedShapes(i.filter(o=>!r.includes(o))),this}selectAll(){const t=this.getSortedChildIdsForParent(this.getCurrentPageId());return t.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(t)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShape(){const t=this.getSelectedShapes();return t.length===1?t[0]:null}getSelectionPageBounds(){const t=this.getCurrentPageState().selectedShapeIds;return t.length===0?null:de.Common(me(t.map(r=>this.getShapePageBounds(r))))}getSelectionRotation(){const t=this.getSelectedShapeIds();if(t.length===0)return 0;if(t.length===1)return this.getShapePageTransform(this.getSelectedShapeIds()[0]).rotation();const r=t.map(i=>this.getShapePageTransform(i).rotation());return r.every(i=>Math.abs(i-r[0])<Math.PI/180)?this.getShapePageTransform(t[0]).rotation():0}getSelectionRotatedPageBounds(){const t=this.getSelectedShapeIds();if(t.length===0)return;const r=this.getSelectionRotation();if(r===0)return this.getSelectionPageBounds();if(t.length===1){const o=this.getShapeGeometry(t[0]).bounds.clone(),s=this.getShapePageTransform(t[0]);return o.point=s.applyToPoint(o.point),o}const i=de.FromPoints(this.getSelectedShapeIds().flatMap(o=>{const s=this.getShapePageTransform(o);return s?s.applyToPoints(this.getShapeGeometry(o).vertices):[]}).map(o=>C.Rot(o,-r)));return i.point=i.point.rot(r),i}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const t=this.getFocusedGroupId();return t?this.getShape(t):void 0}setFocusedGroup(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==null){const i=this.getShape(r);if(!i)throw Error(`Editor.setFocusedGroup: Shape with id ${r} does not exist`);if(!this.isShapeOfType(i,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${i.type}`)}return r===this.getFocusedGroupId()?this:(this._setFocusedGroupId(r),this)}popFocusedGroupId(){const t=this.getFocusedGroup();if(t){const r=this.findShapeAncestor(t,i=>this.isShapeOfType(i,"group"));this.setFocusedGroup((r==null?void 0:r.id)??null),this.select(t.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const t=this.getEditingShapeId();return t?this.getShape(t):void 0}setEditingShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==this.getEditingShapeId()){if(r){const i=this.getShape(r);if(i&&this.getShapeUtil(i).canEdit(i))return this._setInstancePageState({editingShapeId:r}),this}this._setInstancePageState({editingShapeId:null})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const t=this.getHoveredShapeId();return t?this.getShape(t):void 0}setHoveredShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;return r===this.getHoveredShapeId()?this:(this.updateCurrentPageState({hoveredShapeId:r},{ephemeral:!0}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const t=this.getHintingShapeIds();return me(t.map(r=>this.getShape(r)))}setHintingShapes(t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this.updateCurrentPageState({hintingShapeIds:Af(r)},{ephemeral:!0}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const t=this.getErasingShapeIds();return me(t.map(r=>this.getShape(r)))}setErasingShapes(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id);r.sort();const i=this.getErasingShapeIds();if(r.length===i.length){for(let o=0;o<r.length;o++)if(r[o]!==i[o]){this._setInstancePageState({erasingShapeIds:r},{ephemeral:!0});break}}else this._setInstancePageState({erasingShapeIds:r},{ephemeral:!0});return this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==this.getCroppingShapeId())if(!r)this.updateCurrentPageState({croppingShapeId:null});else{const i=this.getShape(r),o=this.getShapeUtil(i);i&&o.canCrop(i)&&this.updateCurrentPageState({croppingShapeId:r})}return this}getCameraId(){return nn.createId(this.getCurrentPageId())}getCamera(){return this.store.get(this.getCameraId())}getZoomLevel(){return this.getCamera().z}_setCamera(t){const r=this.getCamera();return r.x===t.x&&r.y===t.y&&r.z===t.z?this:(this.batch(()=>{this.store.put([{...r,...t}]);const{currentScreenPoint:i}=this.inputs;this.dispatch({type:"pointer",target:"canvas",name:"pointer_move",point:i,pointerId:RI.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1}),this._tickCameraState()}),this)}setCamera(t,r){const i=Number.isFinite(t.x)?t.x:0,o=Number.isFinite(t.y)?t.y:0,s=Number.isFinite(t.z)?t.z:this.getZoomLevel();if(this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),r){const{width:a,height:l}=this.getViewportScreenBounds();return this._animateToViewport(new de(-i,-o,a/s,l/s),r)}else this._setCamera({x:i,y:o,z:s});return this}centerOnPoint(t,r){if(!this.getInstanceState().canMoveCamera)return this;const{width:i,height:o}=this.getViewportPageBounds();return this.setCamera({x:-(t.x-i/2),y:-(t.y-o/2),z:this.getCamera().z},r),this}zoomToContent(){const t=this.getSelectionPageBounds()??this.getCurrentPageBounds();return t&&this.zoomToBounds(t,Math.min(1,this.getZoomLevel()),{duration:220}),this}zoomToFit(t){if(!this.getInstanceState().canMoveCamera)return this;const r=[...this.getCurrentPageShapeIds()];if(r.length<=0)return this;const i=de.Common(me(r.map(o=>this.getShapePageBounds(o))));return this.zoomToBounds(i,void 0,t),this}resetZoom(t=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera(),{x:a,y:l}=t;return this.setCamera({x:i+(a/1-a)-(a/s-a),y:o+(l/1-l)-(l/s-l),z:1},r),this}zoomIn(t=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();let a=xs;for(let d=1;d<Yl.length;d++){const u=Yl[d-1],h=Yl[d];if(!(h-s<=(h-u)/2)){a=h;break}}const{x:l,y:c}=t;return this.setCamera({x:i+(l/a-l)-(l/s-l),y:o+(c/a-c)-(c/s-c),z:a},r),this}zoomOut(t=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();let a=vu;for(let d=Yl.length-1;d>0;d--){const u=Yl[d-1],h=Yl[d];if(!(h-s>=(h-u)/2)){a=u;break}}const{x:l,y:c}=t;return this.setCamera({x:i+(l/a-l)-(l/s-l),y:o+(c/a-c)-(c/s-c),z:a},r),this}zoomToSelection(t){if(!this.getInstanceState().canMoveCamera)return this;const r=this.getSelectionPageBounds();return r?(this.zoomToBounds(r,Math.max(1,this.getZoomLevel()),t),this):this}panZoomIntoView(t,r){if(!this.getInstanceState().canMoveCamera)return this;if(t.length<=0)return this;const i=de.Common(me(t.map(s=>this.getShapePageBounds(s)))),o=this.getViewportPageBounds();if(o.h<i.h||o.w<i.w)return this.zoomToBounds(i,this.getCamera().z,r),this;{const s=this.getViewportPageBounds().clone().expandBy(-32/this.getZoomLevel());let a=0,l=0;s.maxY<i.maxY?l=s.maxY-i.maxY:s.minY>i.minY&&(l=s.minY-i.minY),s.maxX<i.maxX?a=s.maxX-i.maxX:s.minX>i.minX&&(a=s.minX-i.minX);const c=this.getCamera();this.setCamera({x:c.x+a,y:c.y+l,z:c.z},r)}return this}zoomToBounds(t,r,i){if(!this.getInstanceState().canMoveCamera)return this;const o=this.getViewportScreenBounds(),s=Math.min(256,o.width*.28);let a=Li(Math.min((o.width-s)/t.width,(o.height-s)/t.height),vu,xs);return r!==void 0&&(a=Math.min(r,a)),this.setCamera({x:-t.minX+(o.width-t.width*a)/2/a,y:-t.minY+(o.height-t.height*a)/2/a,z:a},i),this}pan(t,r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();return this.setCamera({x:i+t.x/s,y:o+t.y/s,z:s},r),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(t){if(!this._viewportAnimation)return;const r=()=>{this.removeListener("tick",this._animateViewport),this.removeListener("stop-camera-animation",r),this._viewportAnimation=null};this.once("stop-camera-animation",r),this._viewportAnimation.elapsed+=t;const{elapsed:i,easing:o,duration:s,start:a,end:l}=this._viewportAnimation;if(i>s){this._setCamera({x:-l.x,y:-l.y,z:this.getViewportScreenBounds().width/l.width}),r();return}const c=s-i,d=o(1-c/s),u=a.minX+(l.minX-a.minX)*d,h=a.minY+(l.minY-a.minY)*d,p=a.maxX+(l.maxX-a.maxX)*d;this._setCamera({x:-u,y:-h,z:this.getViewportScreenBounds().width/(p-u)})}_animateToViewport(t,r={}){const{duration:i=0,easing:o=_n.easeInOutCubic}=r,s=this.user.getAnimationSpeed(),a=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),i===0||s===0?this._setCamera({x:-t.x,y:-t.y,z:this.getViewportScreenBounds().width/t.width}):(this._viewportAnimation={elapsed:0,duration:i/s,easing:o,start:a.clone(),end:t.clone()},this.addListener("tick",this._animateViewport),this)}slideCamera(t={}){if(!this.getInstanceState().canMoveCamera)return this;if(this.stopCameraAnimation(),this.user.getAnimationSpeed()===0)return this;const{speed:r,friction:i,direction:o,speedThreshold:s=.01}=t;let a=Math.min(r,1);const l=()=>{this.removeListener("tick",c),this.removeListener("stop-camera-animation",l)};this.once("stop-camera-animation",l);const c=d=>{const{x:u,y:h,z:p}=this.getCamera(),g=C.Mul(o,a*d/p);a*=1-i,a<s?l():this._setCamera({x:u+g.x,y:h+g.y,z:p})};return this.addListener("tick",c),this}animateToUser(t){const r=[...this.store.query.records("instance_presence",()=>({userId:{eq:t}})).get()].sort((i,o)=>i.lastActivityTimestamp-o.lastActivityTimestamp).pop();return r?(this.batch(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const i=r.currentPageId===this.getCurrentPageId();i||this.setCurrentPage(r.currentPageId);const o=i?{duration:500}:void 0;this.centerOnPoint(r.cursor,o);const{highlightedUserIds:s}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...s,t]}),setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],l=a.indexOf(t);l<0||(a.splice(l,1),this.updateInstanceState({highlightedUserIds:a}))},jI)}),this):this}animateToShape(t,r=E9){if(!this.getInstanceState().canMoveCamera)return this;const i=this.getViewportScreenBounds().clone().expandBy(-32),o=i.width/i.height,s=this.getShapePageBounds(t);if(!s)return this;const a=s.width/s.height,l=s.clone(),c=s.width/i.width;return l.width+=(i.minX+i.maxX)*c,l.height+=(i.minY+i.maxY)*c,l.x-=i.minX*c,l.y-=i.minY*c,a>o?(l.height=s.width/o,l.y-=(l.height-s.height)/2):(l.width=s.height*o,l.x-=(l.width-s.width)/2),this._animateToViewport(l,r)}updateViewportScreenBounds(t=!1){const r=this.getContainer();if(!r)return this;const i=r.getBoundingClientRect(),o=new de(i.left||i.x,i.top||i.y,Math.max(i.width,1),Math.max(i.height,1)),s=o.equals(this.getViewportScreenBounds()),{_willSetInitialBounds:a}=this;if(s)this._willSetInitialBounds=!1;else if(a)this._willSetInitialBounds=!1,this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0});else if(t&&!this.getInstanceState().followingUserId){const l=this.getViewportPageCenter();this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0}),this.centerOnPoint(l)}else this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0});return this._tickCameraState(),this.updateRenderingBounds(),this}getViewportScreenBounds(){const{x:t,y:r,w:i,h:o}=this.getInstanceState().screenBounds;return new de(t,r,i,o)}getViewportScreenCenter(){return this.getViewportScreenBounds().center}getViewportPageBounds(){const{w:t,h:r}=this.getViewportScreenBounds(),{x:i,y:o,z:s}=this.getCamera();return new de(-i,-o,t/s,r/s)}getViewportPageCenter(){return this.getViewportPageBounds().center}screenToPage(t){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(vn),{x:i,y:o,z:s=1}=this.getCamera();return{x:(t.x-r.x)/s-i,y:(t.y-r.y)/s-o,z:t.z??.5}}pageToScreen(t){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(vn),{x:i,y:o,z:s=1}=this.getCamera();return{x:(t.x+i)*s+r.x,y:(t.y+o)*s+r.y,z:t.z??.5}}startFollowingUser(t){const r=this.store.query.records("instance_presence",()=>({userId:{eq:t}})),i=this.user.getId();if(i||console.warn("You should set the userId for the current instance before following a user"),r.get().some(l=>l.followingUserId===i))return this;zr(()=>{this.stopFollowingUser(),this.updateInstanceState({followingUserId:t},{ephemeral:!0})});const o=()=>{this.removeListener("frame",a),this.removeListener("stop-following",o)};let s=!1;const a=()=>{const l=[...r.get()].sort((H,D)=>H.lastActivityTimestamp-D.lastActivityTimestamp).pop();if(!l){this.stopFollowingUser();return}const c=l.currentPageId===this.getCurrentPageId(),d=c?w9:1;if(!c){this.stopFollowingUser(),this.setCurrentPage(l.currentPageId),this.startFollowingUser(t);return}const{center:u,width:h,height:p}=this.getViewportPageBounds(),g=de.From(l.screenBounds),f=g.width/l.camera.z,w=g.height/l.camera.z,v=new C(f/2-l.camera.x,w/2-l.camera.y),b=l.followingUserId===i,_=h+(f-h)*d,x=p+(w-p)*d,E=b?p/x:Math.min(h/_,p/x),k=Li(this.getCamera().z*E,vu,xs),P=this.getViewportScreenBounds().w/k,I=this.getViewportScreenBounds().h/k,A=v.sub(u),T=C.Add(u,C.Mul(A,d)),O=C.Sub(T,u).len(),F=Math.abs(k-this.getCamera().z);if(O<b9&&F<S9){s=!0;return}s&&O<v9&&F<x9||(s=!1,this.stopCameraAnimation(),this._setCamera({x:-(T.x-P/2),y:-(T.y-I/2),z:k}))};return this.once("stop-following",o),this.addListener("frame",a),this}stopFollowingUser(){return this.updateInstanceState({followingUserId:null},{ephemeral:!0}),this.emit("stop-following"),this}getCameraState(){return this._cameraState.get()}getUnorderedRenderingShapes(t){const r=[];let i=Eo*2,o=Eo;const s=this.getEditingShapeId(),a=this.getSelectedShapeIds(),l=this.getErasingShapeIds(),c=this.getRenderingBoundsExpanded(),d=Number.isFinite(this.renderingBoundsMargin),u=(h,p,g)=>{const f=this.getShape(h);if(!f)return;p*=f.opacity;let w=!1,v=!1;const b=this.getShapeUtil(f),_=this.getShapeMaskedPageBounds(h);t&&(v=!g&&l.includes(h),v&&(p*=.32),w=d&&b.canUnmount(f)&&s!==h&&(_===void 0||!c.includes(_)&&!a.includes(h))),r.push({id:h,shape:f,util:b,index:i,backgroundIndex:o,opacity:p,isCulled:w,maskedPageBounds:_}),i+=1,o+=1;const x=this.getSortedChildIdsForParent(h);if(!x.length)return;let E=null;b.providesBackgroundForChildren(f)&&(E=o,o=i,i+=Eo);for(const k of x)u(k,p,g||v);E!==null&&(o=E)};for(const h of this.getSortedChildIdsForParent(this.getCurrentPageId()))u(h,1,!1);return r}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(c6)}getRenderingBounds(){return this._renderingBounds.get()}getRenderingBoundsExpanded(){return this._renderingBoundsExpanded.get()}updateRenderingBounds(){const t=this.getViewportPageBounds();return t.equals(this._renderingBounds.__unsafe__getWithoutCapture())?this:(this._renderingBounds.set(t.clone()),Number.isFinite(this.renderingBoundsMargin)?this._renderingBoundsExpanded.set(t.clone().expandBy(this.renderingBoundsMargin/this.getZoomLevel())):this._renderingBoundsExpanded.set(t),this)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(Cn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(t){return this.store.get(typeof t=="string"?t:t.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getPageShapeIds(t){const r=typeof t=="string"?t:t.id,i=this.store.query.exec("shape",{parentId:{eq:r}});return this.getShapeAndDescendantIds(i.map(o=>o.id))}setCurrentPage(t,r){const i=typeof t=="string"?t:t.id;return this._setCurrentPageId(i,r),this}updatePage(t,r){return this._updatePage(t,r),this}createPage(t){return this._createPage(t),this}deletePage(t){const r=typeof t=="string"?t:t.id;return this._deletePage(r),this}duplicatePage(t,r=ko.createId()){if(this.getPages().length>=ng)return this;const i=typeof t=="string"?t:t.id,o=this.getPage(i);if(!o)return this;const s={...this.getCamera()},a=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(o.id));return this.batch(()=>{var d;const l=this.getPages(),c=Mu(o.index,(d=l[l.indexOf(o)+1])==null?void 0:d.index);if(this.createPage({name:o.name+" Copy",id:r,index:c}),this.setCurrentPage(r),this.setCamera(s),a)return this.putContentOntoCurrentPage(a)}),this}renamePage(t,r,i){const o=typeof t=="string"?t:t.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:o,name:r},i),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(t){return this._createAssets(t),this}updateAssets(t){return this._updateAssets(t),this}deleteAssets(t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this._deleteAssets(r),this}getAsset(t){return this.store.get(typeof t=="string"?t:t.id)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",t=>this.getShapeUtil(t).getGeometry(t),(t,r)=>t.props===r.props)}getShapeGeometry(t){return this._getShapeGeometryCache().get(typeof t=="string"?t:t.id)}_getShapeOutlineSegmentsCache(){return this.store.createComputedCache("outline-segments",t=>this.getShapeUtil(t).getOutlineSegments(t))}getShapeOutlineSegments(t){return this._getShapeOutlineSegmentsCache().get(typeof t=="string"?t:t.id)??vo}_getShapeHandlesCache(){return this.store.createComputedCache("handles",t=>{var r,i;return(i=(r=this.getShapeUtil(t)).getHandles)==null?void 0:i.call(r,t)})}getShapeHandles(t){return this._getShapeHandlesCache().get(typeof t=="string"?t:t.id)}getShapeLocalTransform(t){const r=typeof t=="string"?t:t.id,i=this.getShape(r);if(!i)throw Error("Editor.getTransform: shape not found");return oe.Identity().translate(i.x,i.y).rotate(i.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",t=>{if(Zn(t.parentId))return this.getShapeLocalTransform(t);const r=this._getShapePageTransformCache().get(t.parentId)??oe.Identity();return oe.Compose(r,this.getShapeLocalTransform(t))})}getShapeParentTransform(t){const r=typeof t=="string"?t:t.id,i=this.getShape(r);return!i||Zn(i.parentId)?oe.Identity():this._getShapePageTransformCache().get(i.parentId)??oe.Identity()}getShapePageTransform(t){const r=typeof t=="string"?t:this.getShape(t).id;return this._getShapePageTransformCache().get(r)??oe.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",t=>{const r=this._getShapePageTransformCache().get(t.id);return r?de.FromPoints(oe.applyToPoints(r,this.getShapeGeometry(t).vertices)):new de})}getShapePageBounds(t){return this._getShapePageBoundsCache().get(typeof t=="string"?t:t.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",t=>{const r=this._getShapeMaskCache().get(t.id);if(!r)return;if(r.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const i=this._getShapePageTransformCache().get(t.id);return i?`polygon(${oe.applyToPoints(oe.Inverse(i),r).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(t){return this._getShapeClipPathCache().get(typeof t=="string"?t:t.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",t=>{if(Zn(t.parentId))return;const r=this.getShapeAncestors(t.id).filter(i=>this.isShapeOfType(i,"frame"));return r.length===0?void 0:r.map(i=>this._getShapePageTransformCache().get(i.id).applyToPoints(this.getShapeGeometry(i).vertices)).reduce((i,o)=>{if(!(o&&i))return;const s=Av(i,o);return s?s.map(C.Cast):[]})})}getShapeMask(t){return this._getShapeMaskCache().get(typeof t=="string"?t:t.id)}getShapeMaskedPageBounds(t){typeof t!="string"&&(t=t.id);const r=this._getShapePageBoundsCache().get(t);if(!r)return;const i=this._getShapeMaskCache().get(t);if(i){if(i.length===0)return;const{corners:o}=r;if(o.every((a,l)=>a&&C.Equals(a,i[l])))return r.clone();const s=Av(i,o);return s?de.FromPoints(s):void 0}return r}getShapeAncestors(t,r=[]){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return r;const s=o.parentId;if(Zn(s))return r.reverse(),r;const a=this.store.get(s);return a?(r.push(a),this.getShapeAncestors(a,r)):r}findShapeAncestor(t,r){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return;const s=o.parentId;if(Zn(s))return;const a=this.getShape(s);if(a)return r(a)?a:this.findShapeAncestor(a,r)}hasAncestor(t,r){const i=typeof t=="string"?t:t==null?void 0:t.id,o=i&&this.getShape(i);return o?o.parentId===r?!0:this.hasAncestor(this.getShapeParent(o),r):!1}findCommonAncestor(t,r){var c;if(t.length===0)return;const i=typeof t[0]=="string"?t:t.map(d=>d.id),o=me(i.map(d=>this.getShape(d)));if(o.length===1){const d=o[0].parentId;return Zn(d)?void 0:r?(c=this.findShapeAncestor(o[0],r))==null?void 0:c.id:d}const[s,...a]=o;let l=this.getShapeParent(s);for(;l;){if(r&&!r(l)){l=this.getShapeParent(l);continue}if(a.every(d=>this.hasAncestor(d,l.id)))return l.id;l=this.getShapeParent(l)}}isShapeOrAncestorLocked(t){const r=typeof t=="string"?this.getShape(t):t;return r===void 0?!1:r.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(r))}getCurrentPageBounds(){let t;return this.getCurrentPageShapeIds().forEach(r=>{const i=this.getShapeMaskedPageBounds(r);i&&(t?t=t.expand(i):t=i.clone())}),t}getSelectedShapeAtPoint(t){const r=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(i=>i.type!=="group"&&r.includes(i.id)).reverse().find(i=>this.isPointInShape(i,t,{hitInside:!0,margin:0}))}getShapeAtPoint(t,r={}){const i=this.getZoomLevel(),o=this.getViewportPageBounds(),{filter:s,margin:a=0,hitLabels:l=!1,hitInside:c=!1,hitFrameInside:d=!1}=r;let u=1/0,h=null,p=1/0,g=null;const f=(r.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(w=>{if(this.isShapeOfType(w,"group"))return!1;const v=this.getShapeMask(w);return v&&!zi(t,v)?!1:s?s(w):!0});for(let w=f.length-1;w>=0;w--){const v=f[w],b=this.getShapeGeometry(v),_=b instanceof _s,x=this.getPointInShapeSpace(v,t);if((this.isShapeOfType(v,"arrow")||this.isShapeOfType(v,"geo")&&v.props.fill==="none")&&v.props.text.trim()){for(const k of b.children)if(k.isLabel&&k.isPointInBounds(x))return v}if(this.isShapeOfType(v,"frame")){const k=b.distanceToPoint(x,c);if(Math.abs(k)<=a)return g||v;if(b.hitTestPoint(x,0,!0))return g||h||(d?v:void 0);continue}let E;if(_){let k=1/0;for(const P of b.children){if(P.isLabel&&!l)continue;const I=P.distanceToPoint(x,c);I<k&&(k=I)}E=k}else a===0&&(b.bounds.w<1||b.bounds.h<1)||b.bounds.containsPoint(x,a)?E=b.distanceToPoint(x,c):E=1/0;if(b.isClosed){if(E<=a){if(b.isFilled||_&&b.children[0].isFilled)return g||v;if(this.getShapePageBounds(v).contains(o))continue;if(Math.abs(E)<a)Math.abs(E)<p&&(p=Math.abs(E),g=v);else if(!g){const{area:k}=b;k<u&&(u=k,h=v)}}}else if(E<li/i)return v}return g||h||void 0}getShapesAtPoint(t,r={}){return this.getCurrentPageShapes().filter(i=>this.isPointInShape(i,t,r))}isPointInShape(t,r,i={}){const{hitInside:o=!1,margin:s=0}=i,a=typeof t=="string"?t:t.id,l=this.getShapeMask(a);return l&&!zi(r,l)?!1:this.getShapeGeometry(a).hitTestPoint(this.getPointInShapeSpace(t,r),s,o)}getPointInShapeSpace(t,r){const i=typeof t=="string"?t:t.id;return this._getShapePageTransformCache().get(i).clone().invert().applyToPoint(r)}getPointInParentSpace(t,r){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return new C(0,0);if(Zn(o.parentId))return C.From(r);const s=this.getShapePageTransform(o.parentId);return s?s.clone().invert().applyToPoint(r):C.From(r)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),t=>this.store.get(t))}getCurrentPageShapesSorted(){const t=new Set(this.getCurrentPageShapes().sort(Cn)),r=[];function i(o){r.push(o),t.delete(o),t.forEach(s=>{s.parentId===o.id&&i(s)})}return t.forEach(o=>{const s=this.getShape(o.parentId);xa(s)||i(o)}),r}getCurrentPageRenderingShapesSorted(){return this.getRenderingShapes().filter(({isCulled:t})=>!t).sort((t,r)=>t.index-r.index).map(({shape:t})=>t)}isShapeOfType(t,r){return(typeof t=="string"?this.getShape(t):t).type===r}getShape(t){const r=typeof t=="string"?t:t.id;if(Nr(r))return this.store.get(r)}getShapeParent(t){const r=typeof t=="string"?t:t==null?void 0:t.id;if(!r)return;const i=this.getShape(r);if(!(i===void 0||!Nr(i.parentId)))return this.store.get(i.parentId)}getShapeNearestSibling(t,r){return r?r.parentId===t.parentId?r:this.findShapeAncestor(r,i=>i.parentId===t.parentId):void 0}isShapeInPage(t,r=this.getCurrentPageId()){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return!1;let s=!1;if(o.parentId===r)s=!0;else{let a=this.getShape(o.parentId);e:for(;a;){if(a.parentId===r){s=!0;break e}a=this.getShape(a.parentId)}}return s}getAncestorPageId(t){const r=typeof t=="string"?t:t==null?void 0:t.id,i=r&&this.getShape(r);if(i)return Zn(i.parentId)?i.parentId:this.getAncestorPageId(this.getShape(i.parentId))}reparentShapes(t,r,i){const o=typeof t[0]=="string"?t:t.map(g=>g.id);if(o.length===0)return this;const s=[],a=Zn(r)?oe.Identity():this.getShapePageTransform(r),l=a.rotation();let c=[];const d=me(this.getSortedChildIdsForParent(r).map(g=>this.getShape(g)));if(i){const g=d.find(f=>f.index===i);if(g){const f=d[d.indexOf(g)+1];f?c=ic(i,f.index,o.length):c=Dv(i,o.length)}else{const f=d.sort(Cn).find(w=>w.index>i);f?c=ic(i,f.index,o.length):c=Dv(i,o.length)}}else{const g=d.length&&d[d.length-1];c=g?Dv(g.index,o.length):UM(o.length)}const u=a.clone().invert(),h=me(o.map(g=>this.getShape(g))),p=h.filter(g=>g.isLocked);p.length&&this.updateShapes(p.map(({id:g,type:f})=>({id:g,type:f,isLocked:!1})));for(let g=0;g<h.length;g++){const f=h[g],w=this.getShapePageTransform(f);if(!w)continue;const v=w.point();if(!v)continue;const b=u.applyToPoint(v),_=w.rotation()-l;s.push({id:f.id,type:f.type,parentId:r,x:b.x,y:b.y,rotation:_,index:c[g],isLocked:f.isLocked})}return this.updateShapes(s),this}getHighestIndexForParent(t){const r=typeof t=="string"?t:t.id,i=this._parentIdsToChildIds.get()[r];if(!i||i.length===0)return"a1";const o=this.getShape(i[i.length-1]);return Io(o.index)}getSortedChildIdsForParent(t){const r=typeof t=="string"?t:t.id,i=this._parentIdsToChildIds.get()[r];return i?this._childIdsCache.get(i,()=>i):vo}visitDescendants(t,r){const i=typeof t=="string"?t:t.id,o=this.getSortedChildIdsForParent(i);for(const s of o)r(s)!==!1&&this.visitDescendants(s,r);return this}getShapeAndDescendantIds(t){const r=new Set,i=[...t];for(;i.length>0;){const o=i.pop();if(!o)break;if(!r.has(o)){r.add(o);for(const s of this.getSortedChildIdsForParent(o))i.push(s)}}return r}getDroppingOverShape(t,r=[]){const i=this.getCurrentPageShapesSorted();for(let o=i.length-1;o>=0;o--){const s=i[o];if(!this.getShapeUtil(s).canDropShapes(s,r)||r.find(l=>l.id===s.id||this.hasAncestor(s,l.id)))continue;const a=this.getShapeMaskedPageBounds(s.id);if(a&&a.containsPoint(t)&&this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(s,t),0,!0))return s}}getOutermostSelectableShape(t,r){const i=typeof t=="string"?t:t.id,o=this.getShape(i);let s=o,a=o;const l=this.getFocusedGroup();for(;a;){if(this.isShapeOfType(a,"group")&&(l==null?void 0:l.id)!==a.id&&!this.hasAncestor(l,a.id)&&((r==null?void 0:r(a))??!0))s=a;else if((l==null?void 0:l.id)===a.id)break;a=this.getShapeParent(a)}return s}rotateShapesBy(t,r){if((typeof t[0]=="string"?t:t.map(o=>o.id)).length<=0)return this;const i=VM({editor:this});return i?(yg({delta:r,snapshot:i,editor:this,stage:"one-off"}),this):this}nudgeShapes(t,r,i){var a,l;const o=typeof t[0]=="string"?t:t.map(c=>c.id);if(o.length<=0)return this;const s=[];for(const c of o){const d=this.getShape(c);if(!d)throw Error(`Could not find a shape with the id ${c}.`);const u=C.Cast(r),h=this.getShapeParentTransform(d);h&&u.rot(-h.rotation());const p=(l=(a=this.getShapeUtil(d)).onTranslateStart)==null?void 0:l.call(a,d);s.push(p?{...p,x:d.x+u.x,y:d.y+u.y}:{id:c,x:d.x+u.x,y:d.y+u.y,type:d.type})}return this.updateShapes(s,{squashing:!0,...i}),this}duplicateShapes(t,r){const i=typeof t[0]=="string"?t:t.map(d=>d.id);if(i.length<=0)return this;const o=new Set(i),s=[],a=[...i];for(;a.length>0;){const d=a.pop();if(!d)break;s.push(d),this.getSortedChildIdsForParent(d).forEach(u=>a.push(u))}s.reverse();const l=new Map(s.map(d=>[d,ot()])),c=me(s.map(d=>{const u=this.getShape(d);if(!u)return null;const h=l.get(d);let p=0,g=0;if(r&&o.has(d)){const k=this.getShapeParentTransform(u),P=new C(r.x,r.y).rot(-k.rotation());p=P.x,g=P.y}const f=u.parentId??this.getCurrentPageId(),w=this.getSortedChildIdsForParent(f),v=w.indexOf(u.id),b=w[v+1],_=b?this.getShape(b):null,x=_?Mu(u.index,_.index):Io(u.index);let E=bn(u);if(this.isShapeOfType(u,"arrow")&&this.isShapeOfType(E,"arrow")){const k=this.getArrowInfo(u);let P,I;if(u.props.start.type==="binding"&&(P=l.get(u.props.start.boundShapeId),!P))if(k!=null&&k.isValid){const{x:T,y:O}=k.start.point;E.props.start={type:"point",x:T,y:O}}else{const{start:T}=di(this,u);E.props.start={type:"point",x:T.x,y:T.y}}if(u.props.end.type==="binding"&&(I=l.get(u.props.end.boundShapeId),!I))if(k!=null&&k.isValid){const{x:T,y:O}=k.end.point;E.props.end={type:"point",x:T,y:O}}else{const{end:T}=di(this,u);E.props.start={type:"point",x:T.x,y:T.y}}const A=Au(E)?Tu(this,E):Nv(this,E);if(k!=null&&k.isValid&&(A!=null&&A.isValid)&&!Au(u)){const T=C.Med(k.start.handle,k.end.handle),O=C.Dist(k.middle,T),F=C.Dist(A.middle,T);E.props.bend<0?E.props.bend+=F-O:E.props.bend-=F-O}E.props.start.type==="binding"&&P&&(E.props.start.boundShapeId=P),E.props.end.type==="binding"&&I&&(E.props.end.boundShapeId=I)}return E={...E,id:h,x:u.x+p,y:u.y+g,index:x},E}));return c.forEach(d=>{Nr(d.parentId)&&l.has(d.parentId)&&(d.parentId=l.get(d.parentId))}),this.history.batch(()=>{const d=c.length+this.getCurrentPageShapeIds().size>Eo;d&&Sg(this);const u=d?c.slice(0,Eo-this.getCurrentPageShapeIds().size):c,h=u.map(p=>p.id);if(this.createShapes(u),this.setSelectedShapes(h),r!==void 0){const p=this.getSelectionPageBounds(),g=this.getViewportPageBounds();p&&!g.contains(p)&&this.centerOnPoint(p.center,{duration:Po})}}),this}moveShapesToPage(t,r){const i=typeof t[0]=="string"?t:t.map(l=>l.id);if(i.length===0)return this;if(this.getInstanceState().isReadonly)return this;const o=this.getCurrentPageId();if(r===o)return this;if(!this.store.has(r))return this;const s=this.getContentFromCurrentPage(i);if(!s)return this;if(this.getPageShapeIds(r).size+s.shapes.length>Eo)return Sg(this,r),this;const a=this.getCamera().z;return this.history.batch(()=>{this.deleteShapes(i),this.setCurrentPage(r),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(s,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:a}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(t){const r=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly||r.length===0)return this;let i=!0,o=!0;const s=[];for(const a of r){const l=this.getShape(a);l&&(s.push(l),l.isLocked?o=!1:i=!1)}return this.batch(()=>{o?(this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):i?this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=mg(this,"toBack",r);return i&&this.updateShapes(i),this}sendBackward(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=mg(this,"backward",r);return i&&this.updateShapes(i),this}bringForward(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=mg(this,"forward",r);return i&&this.updateShapes(i),this}bringToFront(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=mg(this,"toFront",r);return i&&this.updateShapes(i),this}flipShapes(t,r){const i=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;let o=me(i.map(a=>this.getShape(a)));if(!o.length)return this;o=me(o.map(a=>this.isShapeOfType(a,"group")?this.getSortedChildIdsForParent(a.id).map(l=>this.getShape(l)):a).flat());const s=de.Common(me(o.map(a=>this.getShapePageBounds(a)))).center;return this.batch(()=>{for(const a of o){const l=this.getShapeGeometry(a).bounds,c=this.getShapePageTransform(a.id);c&&this.resizeShape(a.id,{x:r==="horizontal"?-1:1,y:r==="vertical"?-1:1},{initialBounds:l,initialPageTransform:c,initialShape:a,mode:"scale_shape",scaleOrigin:s,scaleAxisRotation:0})}}),this}stackShapes(t,r,i){const o=typeof t[0]=="string"?t:t.map(w=>w.id);if(this.getInstanceState().isReadonly)return this;const s=me(o.map(w=>this.getShape(w)).filter(w=>!(!w||this.isShapeOfType(w,"arrow")&&(w.props.start.type==="binding"||w.props.end.type==="binding")))),a=s.length;if(i===0&&a<3||a<2)return this;const l=Object.fromEntries(s.map(w=>[w.id,this.getShapePageBounds(w)]));let c,d,u,h;r==="horizontal"?(c="x",d="minX",u="maxX",h="width"):(c="y",d="minY",u="maxY",h="height");let p;if(i===0){const w=[];s.sort((b,_)=>l[b.id][d]-l[_.id][d]);for(let b=0;b<a-1;b++){const _=s[b],x=s[b+1],E=l[_.id],k=l[x.id][d]-E[u],P=w.find(I=>I.gap===k);P?P.count++:w.push({gap:k,count:1})}let v=0;w.forEach(b=>{b.count>v&&(v=b.count,p=b.gap)}),v===1&&(p=Math.max(0,w.reduce((b,_)=>b+_.gap*_.count,0)/(a-1)))}else p=i;const g=[];let f=l[s[0].id][u];return s.forEach((w,v)=>{var k,P;if(v===0)return;const b={x:0,y:0};b[c]=f+p-l[w.id][c];const _=this.getShapeParent(w),x=_?C.Rot(b,-this.getShapePageTransform(_).decompose().rotation):b,E=(P=(k=this.getShapeUtil(w)).onTranslateStart)==null?void 0:P.call(k,w);g.push(E?{...E,[c]:w[c]+x[c]}:{id:w.id,type:w.type,[c]:w[c]+x[c]}),f+=l[w.id][h]+p}),this.updateShapes(g),this}packShapes(t,r){var P,I;const i=typeof t[0]=="string"?t:t.map(A=>A.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=me(i.map(A=>this.getShape(A)).filter(A=>!(!A||this.isShapeOfType(A,"arrow")&&(A.props.start.type==="binding"||A.props.end.type==="binding")))),s={},a={};let l,c,d=0;for(let A=0;A<o.length;A++)l=o[A],c=this.getShapePageBounds(l),s[l.id]=c,a[l.id]=c.clone(),d+=c.width*c.height;const u=de.Common(me(Object.values(s))),h=u.width;o.sort((A,T)=>s[T.id].height-s[A.id].height);const p=Math.max(Math.ceil(Math.sqrt(d/.95)),h),g=[new de(u.x,u.y,p,1/0)];let f=0,w=0,v,b;for(let A=0;A<o.length;A++){l=o[A],c=a[l.id];for(let T=g.length-1;T>=0;T--)if(v=g[T],!(c.width>v.width||c.height>v.height)){c.x=v.x,c.y=v.y,w=Math.max(w,c.maxY),f=Math.max(f,c.maxX),c.width===v.width&&c.height===v.height?(b=g.pop(),T<g.length&&(g[T]=b)):c.height===v.height?(v.x+=c.width+r,v.width-=c.width+r):c.width===v.width?(v.y+=c.height+r,v.height-=c.height+r):(g.push(new de(v.x+(c.width+r),v.y,v.width-(c.width+r),c.height)),v.y+=c.height+r,v.height-=c.height+r);break}}const _=de.Common(Object.values(a)),x=C.Sub(u.center,_.center);let E;const k=[];for(let A=0;A<o.length;A++){l=o[A],c=s[l.id],E=a[l.id];const T=C.Sub(E.point,c.point).add(x),O=this.getShapeParentTransform(l);O&&T.rot(-O.rotation());const F={id:l.id,type:l.type,x:l.x+T.x,y:l.y+T.y},H=(I=(P=this.getShapeUtil(l)).onTranslateStart)==null?void 0:I.call(P,{...l,...F});H?k.push({...F,...H}):k.push(F)}return k.length&&this.updateShapes(k),this}alignShapes(t,r){const i=typeof t[0]=="string"?t:t.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=me(i.map(c=>this.getShape(c))),s=Object.fromEntries(o.map(c=>[c.id,this.getShapePageBounds(c)])),a=de.Common(me(Object.values(s))),l=[];return o.forEach(c=>{var f,w;const d=s[c.id];if(!d)return;const u={x:0,y:0};switch(r){case"top":{u.y=a.minY-d.minY;break}case"center-vertical":{u.y=a.midY-d.minY-d.height/2;break}case"bottom":{u.y=a.maxY-d.minY-d.height;break}case"left":{u.x=a.minX-d.minX;break}case"center-horizontal":{u.x=a.midX-d.minX-d.width/2;break}case"right":{u.x=a.maxX-d.minX-d.width;break}}const h=this.getShapeParent(c),p=h?C.Rot(u,-this.getShapePageTransform(h).decompose().rotation):u,g=(w=(f=this.getShapeUtil(c)).onTranslateStart)==null?void 0:w.call(f,c);l.push(g?{...g,x:c.x+p.x,y:c.y+p.y}:{id:c.id,type:c.type,x:c.x+p.x,y:c.y+p.y})}),this.updateShapes(l),this}distributeShapes(t,r){const i=typeof t[0]=="string"?t:t.map(_=>_.id);if(this.getInstanceState().isReadonly)return this;if(i.length<3)return this;const o=i.length,s=me(i.map(_=>this.getShape(_))),a=Object.fromEntries(s.map(_=>[_.id,this.getShapePageBounds(_)]));let l,c,d,u,h;r==="horizontal"?(l="x",c="minX",d="maxX",u="midX",h="width"):(l="y",c="minY",d="maxY",u="midY",h="height");const p=[],g=s.sort((_,x)=>a[_.id][c]-a[x.id][c])[0],f=s.sort((_,x)=>a[x.id][d]-a[_.id][d])[0],w=a[g.id][u],v=(a[f.id][u]-w)/(o-1),b=w+v;return s.filter(_=>_!==g&&_!==f).sort((_,x)=>a[_.id][u]-a[x.id][u]).forEach((_,x)=>{var A,T;const E={x:0,y:0};E[l]=b+v*x-a[_.id][h]/2-a[_.id][l];const k=this.getShapeParent(_),P=k?C.Rot(E,-this.getShapePageTransform(k).rotation()):E,I=(T=(A=this.getShapeUtil(_)).onTranslateStart)==null?void 0:T.call(A,_);p.push(I?{...I,[l]:_[l]+P[l]}:{id:_.id,type:_.type,[l]:_[l]+P[l]})}),this.updateShapes(p),this}stretchShapes(t,r){const i=typeof t[0]=="string"?t:t.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=me(i.map(c=>this.getShape(c))),s=Object.fromEntries(i.map(c=>[c,this.getShapeGeometry(c).bounds])),a=Object.fromEntries(i.map(c=>[c,this.getShapePageBounds(c)])),l=de.Common(me(Object.values(a)));switch(r){case"vertical":{this.batch(()=>{for(const c of o){if(this.getShapePageTransform(c).rotation()%Xe)continue;const d=s[c.id],u=a[c.id],h=new C(0,l.minY-u.minY),p=this.getShapeParentTransform(c);p&&h.rot(-p.rotation());const{x:g,y:f}=C.Add(h,c);this.updateShapes([{id:c.id,type:c.type,x:g,y:f}],{squashing:!0});const w=new C(1,l.height/u.height);this.resizeShape(c.id,w,{initialBounds:d,scaleOrigin:new C(u.center.x,l.minY),scaleAxisRotation:0})}});break}case"horizontal":{this.batch(()=>{for(const c of o){const d=s[c.id],u=a[c.id];if(this.getShapePageTransform(c).rotation()%Xe)continue;const h=new C(l.minX-u.minX,0),p=this.getShapeParentTransform(c);p&&h.rot(-p.rotation());const{x:g,y:f}=C.Add(h,c);this.updateShapes([{id:c.id,type:c.type,x:g,y:f}],{squashing:!0});const w=new C(l.width/u.width,1);this.resizeShape(c.id,w,{initialBounds:d,scaleOrigin:new C(l.minX,u.center.y),scaleAxisRotation:0})}});break}}return this}resizeShape(t,r,i={}){var p;const o=typeof t=="string"?t:t.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(r.x)||(r=new C(1,r.y)),Number.isFinite(r.y)||(r=new C(r.x,1));const s=i.initialShape??this.getShape(o);if(!s)return this;const a=i.scaleOrigin??((p=this.getShapePageBounds(o))==null?void 0:p.center);if(!a)return this;const l=i.initialPageTransform?oe.Cast(i.initialPageTransform):this.getShapePageTransform(o);if(!l)return this;const c=l.rotation();if(c==null)return this;const d=i.scaleAxisRotation??c,u=i.initialBounds??this.getShapeGeometry(o).bounds;if(!u)return this;if(!kI(c,d))return this._resizeUnalignedShape(o,r,{...i,initialBounds:u,scaleOrigin:a,scaleAxisRotation:d,initialPageTransform:l,initialShape:s});const h=this.getShapeUtil(s);if(h.isAspectRatioLocked(s)&&(Math.abs(r.x)>Math.abs(r.y)?r=new C(r.x,Math.sign(r.y)*Math.abs(r.x)):r=new C(Math.sign(r.x)*Math.abs(r.y),r.y)),h.onResize&&h.canResize(s)){const g=this._scalePagePoint(oe.applyToPoint(l,new C(0,0)),a,r,d),f=this.getPointInParentSpace(s.id,g),w=new C(r.x,r.y),v=mu((c-d)%Math.PI,0);w.x=v?r.x:r.y,w.y=v?r.y:r.x;const b=oe.applyToPoint(l,new C),{x:_,y:x}=this.getPointInParentSpace(s.id,b);this.updateShapes([{id:o,type:s.type,x:f.x,y:f.y,...h.onResize({...s,x:_,y:x},{newPoint:f,handle:i.dragHandle??"bottom_right",mode:i.mode??"scale_shape",scaleX:w.x,scaleY:w.y,initialBounds:u,initialShape:s})}],{squashing:!0})}else{const g=oe.applyToPoint(l,u.center),f=this._scalePagePoint(g,a,r,d),w=this.getPointInParentSpace(s.id,g),v=this.getPointInParentSpace(s.id,f),b=C.Sub(v,w);this.updateShapes([{id:o,type:s.type,x:s.x+b.x,y:s.y+b.y}],{squashing:!0})}return this}_scalePagePoint(t,r,i,o){const s=C.RotWith(t,r,-o).sub(r),a=C.MulV(s,i);return C.Add(a,r).rotWith(r,o)}_resizeUnalignedShape(t,r,i){const{type:o}=i.initialShape,s=new C(r.x,r.y);if(Math.abs(r.x)>Math.abs(r.y)?s.x=Math.sign(r.x)*Math.abs(r.y):s.y=Math.sign(r.y)*Math.abs(r.x),this.resizeShape(t,s,{initialShape:i.initialShape,initialBounds:i.initialBounds}),Math.sign(r.x)*Math.sign(r.y)<0){let{rotation:v}=oe.Decompose(i.initialPageTransform);v-=2*v,this.updateShapes([{id:t,type:o,rotation:v}],{squashing:!0})}const a=oe.applyToPoint(i.initialPageTransform,i.initialBounds.center),l=this._scalePagePoint(a,i.scaleOrigin,r,i.scaleAxisRotation),c=this.getShapePageBounds(t),d=this.getShapePageTransform(t),u=c.center,h=d.point();if(!u||!h)return this;const p=C.Sub(l,u),g=C.Add(h,p),{x:f,y:w}=this.getPointInParentSpace(t,g);return this.updateShapes([{id:t,type:o,x:f,y:w}],{squashing:!0}),this}getInitialMetaForShape(t){return{}}createShape(t){return this._createShapes([t]),this}createShapes(t){if(!Array.isArray(t))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");return this._createShapes(t),this}animateShape(t,r){return this.animateShapes([t],r)}animateShapes(t,r={}){const{duration:i=500,easing:o=_n.linear}=r,s=et();let a=i,l;const c=[];t.forEach(h=>{if(!h)return;const p={partial:h,values:[]},g=this.getShape(h.id);if(g){for(const f of["x","y","rotation"])h[f]!==void 0&&g[f]!==h[f]&&p.values.push({prop:f,from:g[f],to:h[f]});c.push(p),this.animatingShapes.set(g.id,s)}});let d;const u=h=>{if(a-=h,a<0){const{animatingShapes:g}=this,f=t.filter(w=>w&&g.get(w.id)===s);f.length&&this.updateShapes(f,{squashing:!1}),this.removeListener("tick",u);return}l=o(1-a/i);const{animatingShapes:p}=this;try{const g=[];for(let f=0;f<c.length;f++)d=c[f],p.get(d.partial.id)===s&&g.push({id:d.partial.id,type:d.partial.type,...d.values.reduce((w,{prop:v,from:b,to:_})=>(w[v]=b+(_-b)*l,w),{})});this._updateShapes(g,{squashing:!0})}catch{}};return this.addListener("tick",u),this}groupShapes(t,r=ot()){var p;if(!Array.isArray(t))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const i=typeof t[0]=="string"?t:t.map(g=>g.id);if(i.length<=1)return this;const o=me(this._getUnlockedShapeIds(i).map(g=>this.getShape(g))),s=o.sort(Cn).map(g=>g.id),a=de.Common(me(o.map(g=>this.getShapePageBounds(g)))),{x:l,y:c}=a.point,d=this.findCommonAncestor(o)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const u=o.filter(g=>g.parentId===d).sort(Cn),h=(p=u[u.length-1])==null?void 0:p.index;return this.batch(()=>{this.createShapes([{id:r,type:"group",parentId:d,index:h,x:l,y:c,opacity:1,props:{}}]),this.reparentShapes(s,r),this.select(r)}),this}ungroupShapes(t){const r=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;if(r.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const i=new Set,o=me(r.map(a=>this.getShape(a))),s=[];return o.forEach(a=>{this.isShapeOfType(a,"group")?s.push(a):i.add(a.id)}),s.length===0?this:(this.batch(()=>{let a;for(let l=0,c=s.length;l<c;l++){a=s[l];const d=this.getSortedChildIdsForParent(a.id);for(let u=0,h=d.length;u<h;u++)i.add(d[u]);this.reparentShapes(d,a.parentId,a.index)}this.deleteShapes(s.map(l=>l.id)),this.select(...i)}),this)}updateShape(t,r){return this.updateShapes([t],r),this}updateShapes(t,r){let i=me(t);return this.animatingShapes.size>0&&i.forEach(o=>this.animatingShapes.delete(o.id)),i=i.filter(o=>{const s=this.getShape(o.id);return!(!s||this.isShapeOrAncestorLocked(s)&&!Object.hasOwn(o,"isLocked"))}),this._updateShapes(i,r),this}_getUnlockedShapeIds(t){return t.filter(r=>{var i;return!((i=this.getShape(r))!=null&&i.isLocked)})}deleteShapes(t){if(!Array.isArray(t))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");return this._deleteShapes(this._getUnlockedShapeIds(typeof t[0]=="string"?t:t.map(r=>r.id))),this}deleteShape(t){return this.deleteShapes([typeof t=="string"?t:t.id]),this}_extractSharedStyles(t,r){if(this.isShapeOfType(t,"group")){const i=this._parentIdsToChildIds.get()[t.id];if(!i)return;for(let o=0,s=i.length;o<s;o++)this._extractSharedStyles(this.getShape(i[o]),r)}else for(const[i,o]of this.styleProps[t.type])r.applyValue(i,va(t.props,o))}getStyleForNextShape(t){const r=this.getInstanceState().stylesForNextShape[t.id];return r===void 0?t.defaultValue:r}getShapeStyleIfExists(t,r){const i=this.styleProps[t.type].get(r);if(i!==void 0)return va(t.props,i)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._selectionSharedStyles.get();const t=this.root.getCurrent(),r=new jv;if(!t)return r;if(t.shapeType)for(const i of this.styleProps[t.shapeType].keys())r.applyValue(i,this.getStyleForNextShape(i));return r}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const t=[],r=o=>{const s=this.getShape(o);if(s)if(this.isShapeOfType(s,"group"))for(const a of this.getSortedChildIdsForParent(s.id))r(a);else t.push(s)};for(const o of this.getSelectedShapeIds())r(o);let i=null;for(const o of t)if(i===null)i=o.opacity;else if(i!==o.opacity)return{type:"mixed"};if(i!==null)return{type:"shared",value:i}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(t,r){return this.updateInstanceState({opacityForNextShape:t},r),this}setOpacityForSelectedShapes(t,r){const i=this.getSelectedShapes();if(i.length>0){const o=[],s=a=>{if(this.isShapeOfType(a,"group")){const l=this.getSortedChildIdsForParent(a);for(const c of l)s(this.getShape(c))}else o.push(a)};for(const a of i)s(a);this.updateShapes(o.map(a=>({id:a.id,type:a.type,opacity:t})),r)}return this}setStyleForNextShapes(t,r,i){const o=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...o,[t.id]:r}},i),this}setStyleForSelectedShapes(t,r,i){const o=this.getSelectedShapes();if(o.length>0){const s=[],a=l=>{if(this.isShapeOfType(l,"group")){const c=this.getSortedChildIdsForParent(l.id);for(const d of c)a(this.getShape(d))}else{const c=this.getShapeUtil(l),d=this.styleProps[l.type].get(t);if(d){const u={id:l.id,type:l.type,props:{[d]:r}};s.push({util:c,originalShape:l,updatePartial:u})}}};for(const l of o)a(l);this.updateShapes(s.map(({updatePartial:l})=>l),i)}return this}registerExternalAssetHandler(t,r){return this.externalAssetContentHandlers[t]=r,this}async getAssetForExternalContent(t){var r,i;return await((i=(r=this.externalAssetContentHandlers)[t.type])==null?void 0:i.call(r,t))}registerExternalContentHandler(t,r){return this.externalContentHandlers[t]=r,this}async putExternalContent(t){var r,i;return(i=(r=this.externalContentHandlers)[t.type])==null?void 0:i.call(r,t)}getContentFromCurrentPage(t){const r=typeof t[0]=="string"?t:t.map(l=>l.id);if(!r||r.length===0)return;const i={};let o=Af(r.map(l=>this.getShape(l)).sort(Cn).flatMap(l=>{const c=[l];return this.visitDescendants(l.id,d=>{c.push(this.getShape(d))}),c}));o=o.map(l=>{if(i[l.id]=this.getShapePageTransform(l.id),l=Ss(l),this.isShapeOfType(l,"arrow")){const c=l.props.start.type==="binding"?l.props.start.boundShapeId:void 0,d=l.props.end.type==="binding"?l.props.end.boundShapeId:void 0,u=this.getArrowInfo(l);if(l.props.start.type==="binding"&&!o.some(p=>p.id===c))if(u!=null&&u.isValid){const{x:p,y:g}=u.start.point;l.props.start={type:"point",x:p,y:g}}else{const{start:p}=di(this,l);l.props.start={type:"point",x:p.x,y:p.y}}if(l.props.end.type==="binding"&&!o.some(p=>p.id===d))if(u!=null&&u.isValid){const{x:p,y:g}=u.end.point;l.props.end={type:"point",x:p,y:g}}else{const{end:p}=di(this,l);l.props.end={type:"point",x:p.x,y:p.y}}const h=Au(l)?Tu(this,l):Nv(this,l);if(u!=null&&u.isValid&&(h!=null&&h.isValid)&&!Au(l)){const p=C.Med(u.start.handle,u.end.handle),g=C.Dist(u.middle,p),f=C.Dist(h.middle,p);l.props.bend<0?l.props.bend+=f-g:l.props.bend-=f-g}return l}return l});const s=[];o.forEach(l=>{if(o.find(c=>c.id===l.parentId)===void 0){const c=this.getShapePageTransform(l.id),d=c.point(),u=c.rotation();l.x=d.x,l.y=d.y,l.rotation=u,l.parentId=this.getCurrentPageId(),s.push(l.id)}});const a=new Set;return o.forEach(l=>{"assetId"in l.props&&l.props.assetId!==null&&a.add(l.props.assetId)}),{shapes:o,rootShapeIds:s,schema:this.store.schema.serialize(),assets:me(Array.from(a).map(l=>this.getAsset(l)))}}putContentOntoCurrentPage(t,r={}){if(this.getInstanceState().isReadonly)return this;if(!t.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:i=!1,preserveIds:o=!1,preservePosition:s=!1}=r;let{point:a=void 0}=r;const l=this.getCurrentPageId(),{assets:c,shapes:d,rootShapeIds:u}=t,h=new Map(d.map(E=>[E.id,ot()]));let p=this.getCurrentPageId(),g=1/0,f=[];for(const E of this.getSelectedShapes()){if(g===0)break;const k=this.isShapeOfType(E,"frame"),P=this.getShapeAncestors(E);k&&P.push(E);const I=k?P.length+1:P.length;if(I<g)g=I,f=P,p=k?E.id:E.parentId;else if(I===g){if(f.length!==P.length)throw Error(`Ancestors: ${f.length} !== ${P.length}`);if(f.length===0){p=l;break}else{p=l;for(let A=0;A<f.length&&P[A]===f[A];A++)p=P[A].id}}}let w=!1;if(!Zn(p)){const E=this.getShape(p);if(E){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(E)))p=l;else if(u.length===1){const k=d.find(P=>P.id===u[0]);this.isShapeOfType(E,"frame")&&this.isShapeOfType(k,"frame")&&k.props.w===(E==null?void 0:E.props.w)&&k.props.h===(E==null?void 0:E.props.h)&&(w=!0)}}else p=l}w||(w=h.has(p)),w&&(p=this.getShape(p).parentId);let v=this.getHighestIndexForParent(p);const b=[],_=d.map(E=>{let k;if(o)k=bn(E),h.set(E.id,E.id);else{const P=h.get(E.id);k=bn({...E,id:P})}if(u.includes(E.id)&&(k.parentId=l,b.push(k)),h.has(k.parentId)?k.parentId=h.get(E.parentId):(u.push(k.id),k.index=v,v=Io(v)),this.isShapeOfType(k,"arrow")){if(k.props.start.type==="binding"){const P=h.get(k.props.start.boundShapeId);k.props.start=P?{...k.props.start,boundShapeId:P}:{type:"point",x:0,y:0}}if(k.props.end.type==="binding"){const P=h.get(k.props.end.boundShapeId);k.props.end=P?{...k.props.end,boundShapeId:P}:{type:"point",x:0,y:0}}}return k});if(_.length+this.getCurrentPageShapeIds().size>Eo)return Sg(this),this;let x=[];if(c){for(let k=0;k<c.length;k++){const P=c[k],I=this.store.schema.migratePersistedRecord(P,t.schema);if(I.type==="success")c[k]=I.value;else throw Error(`Could not put content:
could not migrate content for asset:
${P.id}
${P.type}
reason:${I.reason}`)}const E=[];x=c.filter(k=>!this.store.has(k.id)).map(k=>{var P;return(k.type==="image"||k.type==="video")&&(k.props.src&&((P=k.props.src)!=null&&P.startsWith("data:image"))?(E.push(Ss(k)),k.props.src=null):E.push(Ss(k))),k}),Promise.allSettled(E.map(async k=>{const P=await pU(k.props.src,k.props.name,k.props.mimeType??"image/png"),I=await this.getAssetForExternalContent({type:"file",file:P});return I?[k,I]:null})).then(k=>{this.updateAssets(me(k.map(P=>P.status==="fulfilled"&&P.value?{...P.value[1],id:P.value[0].id}:void 0)))})}for(let E=0;E<_.length;E++){const k=_[E],P=this.store.schema.migratePersistedRecord(k,t.schema);if(P.type==="success")_[E]=P.value;else throw Error(`Could not put content:
could not migrate content for shape:
${k.id}, ${k.type}
reason:${P.reason}`)}return this.batch(()=>{x.length>0&&this.createAssets(x),this.createShapes(_),i&&this.select(...b.map(A=>A.id)),p!==l&&this.reparentShapes(b.map(A=>A.id),p);const E=_.map(A=>this.getShape(A.id)),k=de.Common(E.map(A=>this.getShapePageBounds(A)));if(a===void 0)if(Zn(p)){const A=this.getViewportPageBounds();s||A.includes(de.From(k))?a=k.center:a=A.center}else{const A=this.getShape(p);a=oe.applyToPoint(this.getShapePageTransform(A),this.getShapeGeometry(A).bounds.center)}if(b.length===1){const A=b[0];if(this.isShapeOfType(A,"frame"))for(;this.getShapesAtPoint(a).some(T=>this.isShapeOfType(T,"frame")&&T.props.w===A.props.w&&T.props.h===A.props.h);)a.x+=k.w+16}const P=de.Common(me(b.map(({id:A})=>this.getShapePageBounds(A)))).center,I=C.Sub(a,P);this.updateShapes(b.map(({id:A})=>{const T=this.getShape(A),O=this.getShapeParentTransform(A).decompose().rotation,F=C.Rot(I,-O);return{id:T.id,type:T.type,x:T.x+F.x,y:T.y+F.y}}))}),this}async getSvg(t,r={}){var E,k;const i=typeof t[0]=="string"?t:t.map(P=>P.id);if(i.length===0)return;if(!window.document)throw Error("No document");const{scale:o=1,background:s=!1,padding:a=C9,preserveAspectRatio:l=!1}=r,c=Qn({isDarkMode:this.user.getIsDarkMode()}),d=this.getShapeAndDescendantIds(i),u=this.getUnorderedRenderingShapes(!1).filter(({id:P})=>d.has(P));let h=null;if(r.bounds)h=r.bounds;else for(const{maskedPageBounds:P}of u)P&&(h?h.union(P):h=P.clone());if(!h)return;const p=i.length===1&&this.isShapeOfType(this.getShape(i[0]),"frame")?i[0]:null;p||h.expandBy(a);const g=h.width*o,f=h.height*o,w=window.document.createElementNS("http://www.w3.org/2000/svg","svg");l&&w.setAttribute("preserveAspectRatio",l),w.setAttribute("direction","ltr"),w.setAttribute("width",g+""),w.setAttribute("height",f+""),w.setAttribute("viewBox",`${h.minX} ${h.minY} ${h.width} ${h.height}`),w.setAttribute("stroke-linecap","round"),w.setAttribute("stroke-linejoin","round"),s?p?w.style.setProperty("background",c.solid):w.style.setProperty("background-color",c.background):w.style.setProperty("background-color","transparent");try{(k=(E=document.body).focus)==null||k.call(E)}catch{}const v=window.document.createElementNS("http://www.w3.org/2000/svg","defs");w.append(v);const b=new Map,_={addExportDef:P=>{if(b.has(P.key))return;const I=(async()=>{const A=await P.getElement();if(!A)return;const T=document.createComment(`def: ${P.key}`);v.appendChild(T);for(const O of Array.isArray(A)?A:[A])v.appendChild(O)})();b.set(P.key,I)}},x=(await Promise.all(u.map(async({id:P,opacity:I,index:A,backgroundIndex:T})=>{var W,N;if(P===p)return[];const O=this.getShape(P);if(this.isShapeOfType(O,"group"))return[];const F=this.getShapeUtil(O);let H=await((W=F.toSvg)==null?void 0:W.call(F,O,_)),D=await((N=F.toBackgroundSvg)==null?void 0:N.call(F,O,_));if(H){const Y=document.createElementNS("http://www.w3.org/2000/svg","g");Y.appendChild(H),H=Y}if(D){const Y=document.createElementNS("http://www.w3.org/2000/svg","g");Y.appendChild(D),D=Y}if(!H&&!D){const Y=this.getShapePageBounds(O),ee=window.document.createElementNS("http://www.w3.org/2000/svg","rect");ee.setAttribute("width",Y.width+""),ee.setAttribute("height",Y.height+""),ee.setAttribute("fill",c.solid),ee.setAttribute("stroke",c.grey.pattern),ee.setAttribute("stroke-width","1"),H=ee}let K=this.getShapePageTransform(O).toCssString();"scale"in O.props&&O.props.scale!==1&&(K=`${K} scale(${O.props.scale}, ${O.props.scale})`),H==null||H.setAttribute("transform",K),D==null||D.setAttribute("transform",K),H==null||H.setAttribute("opacity",I+""),D==null||D.setAttribute("opacity",I+"");const B=this.getShapeMask(O.id);if(B){const Y=document.createElementNS("http://www.w3.org/2000/svg","clipPath");v.appendChild(Y);const ee=et();Y.id=ee;const pe=document.createElementNS("http://www.w3.org/2000/svg","path");if(pe.setAttribute("d",`M${B.map(({x:ve,y:be})=>`${ve},${be}`).join("L")}Z`),Y.appendChild(pe),H){const ve=document.createElementNS("http://www.w3.org/2000/svg","g");ve.setAttribute("clip-path",`url(#${ee})`),ve.appendChild(H),H=ve}if(D){const ve=document.createElementNS("http://www.w3.org/2000/svg","g");ve.setAttribute("clip-path",`url(#${ee})`),ve.appendChild(D),D=ve}}const te=[];return H&&te.push({zIndex:A,element:H}),D&&te.push({zIndex:T,element:D}),te}))).flat();await Promise.all(b.values());for(const{element:P}of x.sort((I,A)=>I.zIndex-A.zIndex))w.appendChild(P);return w}_updateInputsFromEvent(t){var g;const{previousScreenPoint:r,previousPagePoint:i,currentScreenPoint:o,currentPagePoint:s}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(vn),{x:l,y:c,z:d}=t.point,{x:u,y:h,z:p}=this.getCamera();r.setTo(o),i.setTo(s),o.set(l,c),s.set((l-a.x)/p-u,(c-a.y)/p-h,d??.5),this.inputs.isPen=t.type==="pointer"&&t.isPen,t.name==="pointer_down"&&this.inputs.pointerVelocity.set(0,0),this.store.put([{id:iu,typeName:"pointer",x:s.x,y:s.y,lastActivityTimestamp:t.type==="pointer"&&t.pointerId===RI.CAMERA_MOVE?((g=this.store.get(iu))==null?void 0:g.lastActivityTimestamp)??Date.now():Date.now(),meta:{}}])}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}}he([Q],ue.prototype,"getCanUndo",1),he([Q],ue.prototype,"getCanRedo",1),he([Q],ue.prototype,"_getArrowBindingsIndex",1),he([Q],ue.prototype,"getArrowInfoCache",1),he([Q],ue.prototype,"getPath",1),he([Q],ue.prototype,"getCurrentTool",1),he([Q],ue.prototype,"getCurrentToolId",1),he([Q],ue.prototype,"getDocumentSettings",1),he([Q],ue.prototype,"getInstanceState",1),he([Q],ue.prototype,"getOpenMenus",1),he([Q],ue.prototype,"getIsMenuOpen",1),he([Q],ue.prototype,"getPageStates",1),he([Q],ue.prototype,"_getPageStatesQuery",1),he([Q],ue.prototype,"getCurrentPageState",1),he([Q],ue.prototype,"_getCurrentPageStateId",1),he([Q],ue.prototype,"getSelectedShapeIds",1),he([Q],ue.prototype,"getSelectedShapes",1),he([Q],ue.prototype,"getOnlySelectedShape",1),he([Q],ue.prototype,"getSelectionPageBounds",1),he([Q],ue.prototype,"getSelectionRotation",1),he([Q],ue.prototype,"getSelectionRotatedPageBounds",1),he([Q],ue.prototype,"getFocusedGroupId",1),he([Q],ue.prototype,"getFocusedGroup",1),he([Q],ue.prototype,"getEditingShapeId",1),he([Q],ue.prototype,"getEditingShape",1),he([Q],ue.prototype,"getHoveredShapeId",1),he([Q],ue.prototype,"getHoveredShape",1),he([Q],ue.prototype,"getHintingShapeIds",1),he([Q],ue.prototype,"getHintingShape",1),he([Q],ue.prototype,"getErasingShapeIds",1),he([Q],ue.prototype,"getErasingShapes",1),he([Q],ue.prototype,"getCameraId",1),he([Q],ue.prototype,"getCamera",1),he([Q],ue.prototype,"getZoomLevel",1),he([Q],ue.prototype,"getViewportScreenBounds",1),he([Q],ue.prototype,"getViewportScreenCenter",1),he([Q],ue.prototype,"getViewportPageBounds",1),he([Q],ue.prototype,"getViewportPageCenter",1),he([Q],ue.prototype,"getRenderingShapes",1),he([Q],ue.prototype,"_getAllPagesQuery",1),he([Q],ue.prototype,"getPages",1),he([Q],ue.prototype,"_getAllAssetsQuery",1),he([Q],ue.prototype,"_getShapeGeometryCache",1),he([Q],ue.prototype,"_getShapeOutlineSegmentsCache",1),he([Q],ue.prototype,"_getShapeHandlesCache",1),he([Q],ue.prototype,"_getShapePageTransformCache",1),he([Q],ue.prototype,"_getShapePageBoundsCache",1),he([Q],ue.prototype,"_getShapeClipPathCache",1),he([Q],ue.prototype,"_getShapeMaskCache",1),he([Q],ue.prototype,"getCurrentPageBounds",1),he([Q],ue.prototype,"getCurrentPageShapes",1),he([Q],ue.prototype,"getCurrentPageShapesSorted",1),he([Q],ue.prototype,"getCurrentPageRenderingShapesSorted",1),he([Q({isEqual:(n,e)=>n.equals(e)})],ue.prototype,"getSharedStyles",1),he([Q],ue.prototype,"getSharedOpacity",1);function Sg(n,e=n.getCurrentPageId()){const t=n.getPage(e).name;n.emit("max-shapes",{name:t,pageId:e,count:Eo})}function xg(){const n=G();return q("isDarkMode",()=>n.user.getIsDarkMode(),[n])}const GU='<path d="m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z" fill="white"/><path d="m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z" fill="white"/><path d="m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z" fill="black"/><path d="m13 10.814v11.188l2.969-2.866.428-.139h4.768z" fill="black"/>',YU='<path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" stroke-linejoin="round"/><path d="m21.5664 21.7344v-3.459"/><path d="m19.5508 21.7461-.016-3.473"/><path d="m17.5547 18.3047.021 3.426"/></g>',XU='<path d="m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z" fill="white"/><path d="m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z" fill="%23231f1f"/>',qU='<path d="m19 14h1v1h-1zm1 6h-1v-1h1zm-5-5h-1v-1h1zm0 5h-1v-1h1zm2-10.987-7.985 7.988 5.222 5.221 2.763 2.763 7.984-7.985z" fill="white"/><g fill="black"><path d="m23.5664 16.9971-2.557-2.809v1.829h-4.009-4.001v-1.829l-2.571 2.809 2.572 2.808-.001-1.808h4.001 4.009l-.001 1.808z"/><path d="m17.9873 17h.013v-4.001l1.807.001-2.807-2.571-2.809 2.57h1.809v4.001h.008v4.002l-1.828-.001 2.807 2.577 2.805-2.576h-1.805z"/></g>',qM="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",JM="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",_g='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>',JU='<path fill="white" d="M7.94 0a5.25 5.25 0 0 0-3.47 1.17A5.27 5.27 0 0 0 1 0H0v3h1c1.41 0 1.85.7 2 1v3.94H2v3h1v3c-.13.3-.57 1-2 1H0v3h1a5.27 5.27 0 0 0 3.47-1.17c.98.8 2.21 1.21 3.47 1.17h1v-3h-1c-1.41 0-1.85-.7-2-1v-3H7v-3H6V4c.13-.3.57-1 2-1h1V0H7.94z"/><path fill="black" d="M7.94 2V1a4 4 0 0 0-3.47 1.64A4 4 0 0 0 1 1v1c1.3-.17 2.56.6 3 1.84v5.1H3v1h1v4.16c-.45 1.24-1.7 2-3 1.84v1a4.05 4.05 0 0 0 3.47-1.63 4.05 4.05 0 0 0 3.47 1.63v-1A2.82 2.82 0 0 1 5 14.1V9.93h1v-1H5V3.85A2.81 2.81 0 0 1 7.94 2z"/>',ZU="<path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042' fill='white'/><g stroke='black' stroke-width='.75'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042z' stroke-linejoin='round'/><path d='m20.5664 19.7344v-3.459' stroke-linecap='round'/><path d='m18.5508 19.7461-.016-3.473' stroke-linecap='round'/><path d='m16.5547 16.3047.021 3.426' stroke-linecap='round'/></g>",QU='<path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" stroke-linejoin="round"/><path d="m20.5664 21.7344v-3.459"/><path d="m18.5508 21.7461-.016-3.473"/><path d="m16.5547 18.3047.021 3.426"/></g>',eV='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 14h-2v-2h-2v2h-2v1.98h2v2.02h2v-2.02h2z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>',tV='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 16h-5.98v-1.98h5.98z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>';function an(n,e,t,r,i,o=16,s=16){const a=(-t-e)*(Ue/180),l=Math.sin(a),c=Math.cos(a),d=1*c-1*l,u=1*l+1*c;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${d}' dy='${u}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${o} ${s}, pointer`}const nV={none:()=>"none",default:(n,e,t)=>an(GU,n,0,e,t,12,8),pointer:(n,e,t)=>an(YU,n,0,e,t,14,10),cross:(n,e,t)=>an(XU,n,0,e,t),move:(n,e,t)=>an(qU,n,0,e,t),grab:(n,e,t)=>an(QU,n,0,e,t),grabbing:(n,e,t)=>an(ZU,n,0,e,t),text:(n,e,t)=>an(JU,n,0,e,t,4,10),"ew-resize":(n,e,t)=>an(JM,n,0,e,t),"ns-resize":(n,e,t)=>an(JM,n,90,e,t),"nesw-resize":(n,e,t)=>an(qM,n,0,e,t),"nwse-resize":(n,e,t)=>an(qM,n,90,e,t),"nwse-rotate":(n,e,t)=>an(_g,n,0,e,t),"nesw-rotate":(n,e,t)=>an(_g,n,90,e,t),"senw-rotate":(n,e,t)=>an(_g,n,180,e,t),"swne-rotate":(n,e,t)=>an(_g,n,270,e,t),"zoom-in":(n,e,t)=>an(eV,n,0,e,t),"zoom-out":(n,e,t)=>an(tV,n,0,e,t)};function br(n,e=0,t="black"){return nV[n](h9(e),!1,t)}const rV=["default","pointer","cross","move","grab","grabbing","text"];function iV(){const n=G(),e=xn(),t=xg();wa("useCursor",()=>{const{type:r,rotation:i}=n.getInstanceState().cursor;if(rV.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",br(r,i,t?"white":"black"))},[n,e,t])}function oV(){const n=G(),e=xn(),t=xg(),r=q(st.forceSrgb);re.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[n,e,r,t])}function sV(n){const e=S.useRef();return S.useLayoutEffect(()=>{e.current=n}),S.useDebugValue(n),S.useCallback((...t)=>{const r=e.current;return ba(r,"fn does not exist"),r(...t)},[])}function aV(n){const e=G(),t=xn();S.useLayoutEffect(()=>{n?(e.getInstanceState().isFocused||e.updateInstanceState({isFocused:!0}),e.getContainer().focus()):e.getInstanceState().isFocused&&e.updateInstanceState({isFocused:!1})},[e,t,n])}function lV(){const[n,e]=S.useState(0);S.useEffect(()=>e(t=>t+1),[])}const sc="TLDRAW_TAB_ID_v2",ln=globalThis.window;function cV(){return ln?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(ln.navigator.platform)||ln.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const kg=(ln==null?void 0:ln[sc])??(ln==null?void 0:ln.sessionStorage[sc])??"TLDRAW_INSTANCE_STATE_V1_"+et();ln&&(ln[sc]=kg,cV()?ln.sessionStorage[sc]=kg:delete ln.sessionStorage[sc]),ln==null||ln.addEventListener("beforeunload",()=>{ln.sessionStorage[sc]=kg});const dV={Initial:0},ju=dV.Initial,ZM=je({version:we,currentPageId:ru,isFocusMode:Ie,exportBackground:Ie,isDebugMode:Ie,isToolLocked:Ie,isGridMode:Ie,pageStates:zn(je({pageId:ru,camera:je({x:we,y:we,z:we}),selectedShapeIds:zn(oi),focusedGroupId:oi.nullable()}))}),uV=Be({currentVersion:ju});function hV(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;const e=Gb({value:n,fromVersion:n.version,toVersion:ju,migrations:uV});if(e.type==="error")return console.warn(e.reason),null;const t={...e.value,version:ju};try{ZM.validate(t)}catch(r){return console.warn(r),null}return t}function pV(n){const e=n.query.ids("page");return Q("sessionStateSnapshot",()=>{const t=n.get(vn);if(!t)return null;const r=[...e.get()];return{version:ju,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:r.map(i=>{const o=n.get(rn.createId(i)),s=n.get(nn.createId(i));return{pageId:i,camera:{x:(s==null?void 0:s.x)??0,y:(s==null?void 0:s.y)??0,z:(s==null?void 0:s.z)??1},selectedShapeIds:(o==null?void 0:o.selectedShapeIds)??[],focusedGroupId:(o==null?void 0:o.focusedGroupId)??null}})}})}function fV(n,e){const t=hV(e);if(!t)return;const r=n.allRecords().filter(s=>s.typeName==="instance_page_state"||s.typeName==="camera"),i={added:{},updated:{},removed:{...VP(r.map(s=>[s.id,s]))}};n.has(vn)&&(i.removed[vn]=n.get(vn));const o={removed:{},updated:{},added:{[vn]:n.schema.types.instance.create({id:vn,currentPageId:t.currentPageId,isDebugMode:t.isDebugMode,isFocusMode:t.isFocusMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,exportBackground:t.exportBackground})}};for(const s of t.pageStates){const a=nn.createId(s.pageId),l=rn.createId(s.pageId);o.added[a]=nn.create({id:nn.createId(s.pageId),x:s.camera.x,y:s.camera.y,z:s.camera.z}),o.added[l]=rn.create({id:rn.createId(s.pageId),pageId:s.pageId,selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId})}zr(()=>{n.applyDiff(zf([i,o])),n.ensureStoreIsUsable()})}function gV(n){var i;const e=[];for(const o of Object.values(n))(i=o.typeName)!=null&&i.match(/^(instance.*|pointer|camera)$/)&&e.push(o);const t=e.filter(o=>o.typeName==="instance"&&o.id!==vn)[0];if(!t)return null;const r={version:ju,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(o=>o.typeName==="instance_page_state"&&o.instanceId===t.id).map(o=>{const s=n[o.cameraId]??{x:0,y:0,z:1};return{pageId:o.pageId,camera:{x:s.x,y:s.y,z:s.z},selectedShapeIds:o.selectedShapeIds,focusedGroupId:o.focusedGroupId}})};try{return ZM.validate(r),r}catch{return null}}function mV(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`)}function yV(){window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const wV=(n,e)=>e.some(t=>n instanceof t);let QM,eA;function bV(){return QM||(QM=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function vV(){return eA||(eA=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tA=new WeakMap,Fv=new WeakMap,nA=new WeakMap,$v=new WeakMap,Bv=new WeakMap;function SV(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",s)},o=()=>{t(To(n.result)),i()},s=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",s)});return e.then(t=>{t instanceof IDBCursor&&tA.set(t,n)}).catch(()=>{}),Bv.set(e,n),e}function xV(n){if(Fv.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",s),n.removeEventListener("abort",s)},o=()=>{t(),i()},s=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",s),n.addEventListener("abort",s)});Fv.set(n,e)}let Uv={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Fv.get(n);if(e==="objectStoreNames")return n.objectStoreNames||nA.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return To(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function _V(n){Uv=n(Uv)}function kV(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Vv(this),e,...t);return nA.set(r,e.sort?e.sort():[e]),To(r)}:vV().includes(n)?function(...e){return n.apply(Vv(this),e),To(tA.get(this))}:function(...e){return To(n.apply(Vv(this),e))}}function CV(n){return typeof n=="function"?kV(n):(n instanceof IDBTransaction&&xV(n),wV(n,bV())?new Proxy(n,Uv):n)}function To(n){if(n instanceof IDBRequest)return SV(n);if($v.has(n))return $v.get(n);const e=CV(n);return e!==n&&($v.set(n,e),Bv.set(e,n)),e}const Vv=n=>Bv.get(n);function EV(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){const s=indexedDB.open(n,e),a=To(s);return r&&s.addEventListener("upgradeneeded",l=>{r(To(s.result),l.oldVersion,l.newVersion,To(s.transaction),l)}),t&&s.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function PV(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),To(t).then(()=>{})}const IV=["get","getKey","getAll","getAllKeys","count"],MV=["put","add","delete","clear"],Hv=new Map;function rA(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Hv.get(e))return Hv.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=MV.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||IV.includes(t)))return;const o=async function(s,...a){const l=this.transaction(s,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),i&&l.done]))[0]};return Hv.set(e,o),o}_V(n=>({...n,get:(e,t,r)=>rA(e,t)||n.get(e,t,r),has:(e,t)=>!!rA(e,t)||n.has(e,t)}));const Cg="TLDRAW_DOCUMENT_v2",iA="TLDRAW_DB_NAME_INDEX_v2",qe={Records:"records",Schema:"schema",SessionState:"session_state"};async function Eg(n,e){DV(n);const t=await EV(n,3,{upgrade(r){r.objectStoreNames.contains(qe.Records)||r.createObjectStore(qe.Records),r.objectStoreNames.contains(qe.Schema)||r.createObjectStore(qe.Schema),r.objectStoreNames.contains(qe.SessionState)||r.createObjectStore(qe.SessionState)}});try{return await e(t)}finally{t.close()}}async function AV({persistenceKey:n,sessionId:e,didCancel:t}){const r=Cg+n;if(Wv().includes(r))return await RV({persistenceKey:n,didCancel:t}),await Eg(r,async i=>{var u,h;if(t!=null&&t())return;const o=i.transaction([qe.Records,qe.Schema,qe.SessionState],"readonly"),s=o.objectStore(qe.Records),a=o.objectStore(qe.Schema),l=o.objectStore(qe.SessionState);let c=e?(u=await l.get(e))==null?void 0:u.snapshot:null;c||(c=(h=(await l.getAll()).sort((p,g)=>p.updatedAt-g.updatedAt).pop())==null?void 0:h.snapshot);const d={records:await s.getAll(),schema:await a.get(qe.Schema),sessionStateSnapshot:c};if(t!=null&&t()){o.abort();return}return await o.done,d})}async function TV({persistenceKey:n,schema:e,changes:t,sessionId:r,sessionStateSnapshot:i,didCancel:o}){const s=Cg+n;await Eg(s,async a=>{const l=a.transaction([qe.Records,qe.Schema,qe.SessionState],"readwrite"),c=l.objectStore(qe.Records),d=l.objectStore(qe.Schema),u=l.objectStore(qe.SessionState);for(const[h,p]of Object.entries(t.added))await c.put(p,h);for(const[h,p]of Object.values(t.updated))await c.put(p,p.id);for(const h of Object.keys(t.removed))await c.delete(h);if(d.put(e.serialize(),qe.Schema),i&&r?u.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o==null?void 0:o())return l.abort();await l.done})}async function jV({persistenceKey:n,schema:e,snapshot:t,sessionId:r,sessionStateSnapshot:i,didCancel:o}){const s=Cg+n;await Eg(s,async a=>{const l=a.transaction([qe.Records,qe.Schema,qe.SessionState],"readwrite"),c=l.objectStore(qe.Records),d=l.objectStore(qe.Schema),u=l.objectStore(qe.SessionState);await c.clear();for(const[h,p]of Object.entries(t))await c.put(p,h);if(d.put(e.serialize(),qe.Schema),i&&r?u.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o==null?void 0:o())return l.abort();await l.done})}async function RV({persistenceKey:n,didCancel:e}){await Eg(Cg+n,async t=>{const r=t.transaction([qe.SessionState],"readwrite"),i=r.objectStore(qe.SessionState),o=(await i.getAll()).sort((a,l)=>a.updatedAt-l.updatedAt);if(o.length<10){await r.done;return}const s=o.slice(0,o.length-10);for(const{id:a}of s)await i.delete(a);if(e!=null&&e())return r.abort();await r.done})}function Wv(){const n=JSON.parse((window==null?void 0:window.localStorage.getItem(iA))||"[]")??[];return Array.isArray(n)?n:[]}function DV(n){const e=new Set(Wv());e.add(n),window==null||window.localStorage.setItem(iA,JSON.stringify([...e]))}const OV=350,LV=1e4,oA=Symbol("UPDATE_INSTANCE_STATE"),zV=n=>n;class NV{constructor(e){y(this,"onmessage")}postMessage(e){}close(){}}const FV=typeof BroadcastChannel>"u"?NV:BroadcastChannel;class $V{constructor(e,{persistenceKey:t,sessionId:r=kg,onLoad:i,onLoadError:o},s=new FV(`tldraw-tab-sync-${t}`)){y(this,"disposables",new Set);y(this,"diffQueue",[]);y(this,"didDispose",!1);y(this,"shouldDoFullDBWrite",!0);y(this,"isReloading",!1);y(this,"persistenceKey");y(this,"sessionId");y(this,"serializedSchema");y(this,"isDebugging",!1);y(this,"documentTypes");y(this,"$sessionStateSnapshot");y(this,"initTime",Date.now());y(this,"isPersisting",!1);y(this,"didLastWriteError",!1);y(this,"scheduledPersistTimeout",null);this.store=e,this.channel=s,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=r,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=pV(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(zV({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(oA),this.schedulePersist()},{scope:"session"})),this.connect(i,o),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let r;try{r=await AV({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(i){t(i),yV(),typeof window<"u"&&window.location.reload();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const i=Object.fromEntries(r.records.map(a=>[a.id,a])),o=r.sessionStateSnapshot??gV(i),s=this.store.schema.migrateStoreSnapshot({store:i,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(s.type==="error"){console.error("failed to migrate store",s),t(new Error(`Failed to migrate store: ${s.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(s.value).filter(a=>this.documentTypes.has(a.typeName)),"initialize")}),o&&fV(this.store,o)}this.channel.onmessage=({data:i})=>{var a,l;this.debug("got message",i);const o=i,s=b6(this.serializedSchema,o.schema??this.store.schema.serializeEarliestVersion());if(s===-1){if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(l=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||l.call(a);return}else if(s===1){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}o.type==="diff"&&(this.debug("applying diff"),zr(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(o.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;t(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?LV:OV))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){ba(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await jV({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=zf(e.filter(r=>r!==oA));await TV({persistenceKey:this.persistenceKey,changes:t,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),mV(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function sA({initialData:n,defaultName:e="",...t}){const r="schema"in t&&t.schema?t.schema:hF({shapes:BV(DM("shapeUtils"in t&&t.shapeUtils?t.shapeUtils:[]))});return new XP({schema:r,initialData:n,props:{defaultName:e}})}function BV(n){return Object.fromEntries(n.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}function aA(n){const e=sA(n);return n.snapshot&&e.loadSnapshot(n.snapshot),{store:e,opts:n}}function UV(n){const[e,t]=S.useState(()=>aA(n));if(!WP(e.opts,n)){const r=aA(n);return t(r),r.store}return e.store}function VV({persistenceKey:n,sessionId:e,...t}){const[r,i]=S.useState(null),o=UV(t);return S.useEffect(()=>{const s=et();if(!n){i({id:s,storeWithStatus:{status:"not-synced",store:o}});return}i({id:s,storeWithStatus:{status:"loading"}});const a=c=>{i(d=>(d==null?void 0:d.id)===s?{id:s,storeWithStatus:c}:d)},l=new $V(o,{sessionId:e,persistenceKey:n,onLoad(){a({store:o,status:"synced-local"})},onLoadError(c){a({status:"error",error:c})}});return()=>{i(c=>(c==null?void 0:c.id)===s?null:c),l.close()}},[n,o,e]),(r==null?void 0:r.storeWithStatus)??{status:"loading"}}let lA=!1;if(typeof window<"u"){const n=window.navigator.userAgent,e=!!n.match(/iPad/i)||!!n.match(/iPhone/i),t=!!n.match(/WebKit/i);lA=e&&t&&!n.match(/CriOS/i)}function HV(){const n=G();S.useEffect(()=>{if(!lA)return;function e(t){(t.target instanceof HTMLInputElement&&t.target.type==="text"||t.target instanceof HTMLTextAreaElement)&&n.complete()}return document.addEventListener("focusout",e),()=>document.removeEventListener("focusout",e)},[n])}function WV(){const n=G(),e=xn();S.useEffect(()=>{const t=o=>e.style.setProperty("--tl-zoom",o.toString()),r=zP(t,100),i=new Ol("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?t(n.getZoomLevel()):r(n.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach()}},[n,e])}const KV=[],GV=[],YV=S.memo(function({store:n,components:e,className:t,user:r,...i}){const[o,s]=re.useState(null),a=S.useMemo(()=>r??EM(),[r]),l=(e==null?void 0:e.ErrorFallback)===void 0?AI:e==null?void 0:e.ErrorFallback,c={...i,shapeUtils:i.shapeUtils??KV,tools:i.tools??GV,components:e};return m.jsx("div",{ref:s,draggable:!1,className:ye("tl-container tl-theme__light",t),onPointerDown:Wt,tabIndex:-1,children:m.jsx(fu,{fallback:l,onError:d=>Ub(d,{tags:{origin:"react.tldraw-before-app"}}),children:o&&m.jsx(QF,{container:o,children:m.jsx(H9,{overrides:e,children:n?n instanceof XP?m.jsx(dA,{...c,store:n,user:a}):m.jsx(cA,{...c,store:n,user:a}):m.jsx(XV,{...c,store:n,user:a})})})})})});function XV(n){const{defaultName:e,snapshot:t,initialData:r,shapeUtils:i,persistenceKey:o,sessionId:s,user:a}=n,l=VV({shapeUtils:i,initialData:r,persistenceKey:o,sessionId:s,defaultName:e,snapshot:t});return m.jsx(cA,{...n,store:l,user:a})}const cA=S.memo(function({store:n,user:e,...t}){var i;const r=xn();switch(S.useLayoutEffect(()=>{e.userPreferences.get().isDarkMode&&(r.classList.remove("tl-theme__light"),r.classList.add("tl-theme__dark"))},[r,e]),n.status){case"error":throw n.error;case"loading":{const o=((i=t.components)==null?void 0:i.LoadingScreen)??qB;return m.jsx(o,{})}}return m.jsx(dA,{...t,store:n.store,user:e})});function dA({onMount:n,children:e,store:t,tools:r,shapeUtils:i,user:o,initialState:s,autoFocus:a=!0,inferDarkMode:l}){const{ErrorFallback:c}=Kt(),d=xn(),[u,h]=S.useState(null);S.useLayoutEffect(()=>{const g=new ue({store:t,shapeUtils:i,tools:r,getContainer:()=>d,user:o,initialState:s,inferDarkMode:l});return window.app=g,window.editor=g,h(g),()=>{g.dispose()}},[d,i,r,t,o,s,l]);const p=S.useSyncExternalStore(S.useCallback(g=>u?(u.on("crash",g),()=>u.off("crash",g)):()=>{},[u]),()=>(u==null?void 0:u.getCrashingError())??null);return u?m.jsx(fu,{fallback:c,onError:g=>u.annotateError(g,{origin:"react.tldraw",willCrashApp:!0}),children:p?m.jsx(JV,{crashingError:p}):m.jsx(uv.Provider,{value:u,children:m.jsx(qV,{autoFocus:a,onMount:n,children:e})})}):null}function qV({children:n,onMount:e,autoFocus:t}){return WV(),iV(),oV(),HV(),lV(),aV(t),QV(e),kB(),G().updateViewportScreenBounds(),n??m.jsx(Pv,{})}function JV({crashingError:n}){throw n}function uA({children:n}){const{Spinner:e}=Kt();return m.jsxs("div",{className:"tl-loading",children:[e?m.jsx(e,{}):null,n]})}function ZV({children:n}){return m.jsx("div",{className:"tl-loading",children:n})}function QV(n){const e=G(),t=sV(r=>{const i=n==null?void 0:n(r);return r.emit("mount"),window.tldrawReady=!0,i});re.useLayoutEffect(()=>{if(e)return t==null?void 0:t(e)},[e,t])}function Aa({children:n,className:e="",...t}){return m.jsx("div",{...t,className:`tl-html-container ${e}`,children:n})}$e(function({x:n=0,y:e=0,rotation:t=0,...r}){const i=G(),o=S.useRef(null),s=i.getCamera();return S.useLayoutEffect(()=>{const{x:a,y:l,z:c}=i.getCamera(),d=o.current;d&&a!==void 0&&(d.style.transform=`translate(${a}px, ${l}px) scale(${c}) rotate(${t}rad) translate(${n}px, ${e}px)`)},[s,i,n,e,t]),m.jsx("div",{ref:o,...r,className:ye("tl-positioned",r.className)})});function hA(n,e,t={}){const{newPoint:r,handle:i,scaleX:o,scaleY:s}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:d=1/0}=t;let u=n.props.w*o,h=n.props.h*s;const p=new C(0,0);if(u>0){if(u<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=u-a;break}case"top":case"bottom":{p.x=(u-a)/2;break}default:p.x=0}u=a}}else if(p.x=u,u=-u,u<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=-u;break}default:p.x=-a}u=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=h-c;break}case"right":case"left":{p.y=(h-c)/2;break}default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=-h;break}default:p.y=-c}h=c}const{x:g,y:f}=p.rot(n.rotation).add(r);return{x:g,y:f,props:{w:Math.min(l,u),h:Math.min(d,h)}}}class ac extends ci{constructor(){super(...arguments);y(this,"onResize",(t,r)=>hA(t,r))}getGeometry(t){return new ks({width:t.props.w,height:t.props.h,isFilled:!0})}}let eH=(_k=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(_k,"id","idle"),_k),tH=(kk=class extends ae{constructor(){super(...arguments);y(this,"markId","");y(this,"wasFocusedOnEnter",!1);y(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()});y(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=this.parent.shapeType,i=ot();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:r,x:t.x,y:t.y,props:{w:1,h:1}}]).select(i),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const t=this.parent.shapeType,r=ot();this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:t,x:e.x,y:e.y}]);const i=this.editor.getShape(r),{w:o,h:s}=this.editor.getShapeUtil(i).getDefaultProps(),a=new C(o/2,s/2),l=this.editor.getShapeParentTransform(i);l&&a.rot(-l.rotation()),this.editor.updateShapes([{id:r,type:t,x:i.x-a.x,y:i.y-a.y}]),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},y(kk,"id","pointing"),kk);class Pg extends ae{constructor(){super(...arguments);y(this,"onCreate")}}y(Pg,"id","box"),y(Pg,"initial","idle"),y(Pg,"children",()=>[eH,tH]);function pA(n,e){const t=S.useRef(n);return e(n,t.current)?t.current:(t.current=n,n)}function fA(n){return pA(n,t6)}function nH(n){return pA(n,WP)}function gA(n){const e=G();return q("isCropping",()=>e.getCroppingShapeId()===n,[e,n])}function Ig(n){const e=G();return q("isEditing",()=>e.getEditingShapeId()===n,[e,n])}function Fi(n){const e=G();return S.useMemo(function(){const t=s=>{if(s.isKilled)return;if(s.button===2){e.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...er(s)});return}if(s.button!==0)return;const a=qf(s.currentTarget);function l(){a.removeEventListener("pointerup",l),hu(a,s)}uu(a,s),a.addEventListener("pointerup",l),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...er(s)}),Wt(s)};let r,i;function o(s){s.isKilled||s.button===0&&(s.clientX===r&&s.clientY===i||(r=s.clientX,i=s.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...er(s)})))}return{onPointerDown:t,onPointerMove:o,onPointerUp:s=>{s.isKilled||s.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...er(s)})}}},[e,n])}const rH=20,iH=8;function Kv(n,e=rH){return Math.max(iH,Math.ceil(n/e))}class oH extends Ca{constructor(t){super({...t,isFilled:!1,isClosed:!1});y(this,"_center");y(this,"radius");y(this,"start");y(this,"end");y(this,"measure");y(this,"length");y(this,"angleStart");y(this,"angleEnd");const{center:r,radius:i,sweepFlag:o,largeArcFlag:s,start:a,end:l}=t;if(a.equals(l))throw Error("Arc must have different start and end points.");this.angleStart=C.Angle(r,a),this.angleEnd=C.Angle(r,l),this.measure=sH(this.angleStart,this.angleEnd,o,s),this.length=this.measure*i,this.start=a,this.end=l,this._center=r,this.radius=i}nearestPoint(t){const{_center:r,measure:i,radius:o,angleEnd:s,angleStart:a,start:l,end:c}=this,d=mA(i,a,s,r.angle(t));if(d<=0)return l;if(d>=1)return c;const u=r.clone().add(t.clone().sub(r).uni().mul(o));let h=1/0,p;for(const g of[l,c,u])t.dist(g)<h&&(p=g,h=t.dist(g));if(!p)throw Error("nearest point not found");return p}hitTestLineSegment(t,r,i){const{_center:o,radius:s,measure:a,angleStart:l,angleEnd:c}=this,d=hg(t,r,o,s);return d===null?!1:d.some(u=>{const h=mA(a,l,c,o.angle(u));return h>=0&&h<=1})}getVertices(){const{_center:t,measure:r,length:i,radius:o,angleStart:s}=this,a=[];for(let l=0,c=Kv(Math.abs(i));l<c+1;l++){const d=l/c*r,u=s+d;a.push(t.clone().add(new C(Math.cos(u),Math.sin(u)).mul(o)))}return a}}function mA(n,e,t,r){let i;if(Math.abs(n)>Ue){i=wu(e,r);const o=wu(r,t);return Math.abs(i)<Math.abs(o)?i/n:(n-o)/n}else return i=wu(e,r),i/n}function sH(n,e,t,r){const i=2*((e-n)%Xe)%Xe-(e-n)%Xe;return r?(Xe-Math.abs(i))*(t?1:-1):i}class yA extends Ca{constructor(t){super({isClosed:!0,...t});y(this,"_center");y(this,"radius");y(this,"x");y(this,"y");this.config=t;const{x:r=0,y:i=0,radius:o}=t;this.x=r,this.y=i,this._center=new C(o+r,o+i),this.radius=o}getBounds(){return new de(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:t,radius:r}=this,i=Xe*r,o=[];for(let s=0,a=Kv(i);s<a;s++){const l=s/a*Xe;o.push(t.clone().add(C.FromAngle(l).mul(r)))}return o}nearestPoint(t){const{_center:r,radius:i}=this;return r.equals(t)?C.AddXY(r,i,0):r.clone().add(t.clone().sub(r).uni().mul(i))}hitTestLineSegment(t,r,i){const{_center:o,radius:s}=this;return hg(t,r,o,s)!==null}}class aH extends Ea{constructor(t){const{start:r,cp1:i,cp2:o,end:s}=t;super({...t,points:[r,s]});y(this,"a");y(this,"b");y(this,"c");y(this,"d");this.a=r,this.b=i,this.c=o,this.d=s}getVertices(){const t=[],{a:r,b:i,c:o,d:s}=this;for(let a=0,l=10;a<=l;a++){const c=a/l;t.push(new C((1-c)*(1-c)*(1-c)*r.x+3*((1-c)*(1-c))*c*i.x+3*(1-c)*(c*c)*o.x+c*c*c*s.x,(1-c)*(1-c)*(1-c)*r.y+3*((1-c)*(1-c))*c*i.y+3*(1-c)*(c*c)*o.y+c*c*c*s.y))}return t}midPoint(){return lH(this,.5)}nearestPoint(t){let r,i=1/0;for(const o of this.segments){const s=o.nearestPoint(t),a=s.dist(t);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}}function lH(n,e){const{a:t,b:r,c:i,d:o}=n;return new C((1-e)*(1-e)*(1-e)*t.x+3*((1-e)*(1-e))*e*r.x+3*(1-e)*(e*e)*i.x+e*e*e*o.x,(1-e)*(1-e)*(1-e)*t.y+3*((1-e)*(1-e))*e*r.y+3*(1-e)*(e*e)*i.y+e*e*e*o.y)}class Mg extends Ca{constructor(t){super({...t,isClosed:!1,isFilled:!1});y(this,"points");y(this,"_segments");y(this,"_length");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:t}=this,r=t.length,i=r-2,o=1.25;for(let s=0;s<r-1;s++){const a=s===0?t[0]:t[s-1],l=t[s],c=t[s+1],d=s===i?c:t[s+2],u=l,h=s===0?a:new C(l.x+(c.x-a.x)/6*o,l.y+(c.y-a.y)/6*o),p=s===i?c:new C(c.x-(d.x-l.x)/6*o,c.y-(d.y-l.y)/6*o),g=c;this._segments.push(new aH({start:u,cp1:h,cp2:p,end:g}))}}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((t,r)=>t+r.length,0)),this._length}getVertices(){const t=this.segments.reduce((r,i)=>r.concat(i.vertices),[]);return t.push(this.points[this.points.length-1]),t}nearestPoint(t){let r,i=1/0;for(const o of this.segments){const s=o.nearestPoint(t),a=s.dist(t);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r,i){return this.segments.some(o=>o.hitTestLineSegment(t,r,i))}}class wA extends Ca{constructor(t){super({...t,isClosed:!0});y(this,"w");y(this,"h");y(this,"_edges");this.config=t;const{width:r,height:i}=t;this.w=r,this.h=i}get edges(){if(!this._edges){const{vertices:t}=this;this._edges=[];for(let r=0,i=t.length;r<i;r++){const o=t[r],s=t[(r+1)%i];this._edges.push(new fg({start:o,end:s}))}}return this._edges}getVertices(){const t=Math.max(1,this.w),r=Math.max(1,this.h),i=t/2,o=r/2,s=Math.pow(i-o,2)/Math.pow(i+o,2),a=Ue*(i+o)*(1+3*s/(10+Math.sqrt(4-3*s))),l=Kv(a),c=Xe/l,d=Math.cos(c),u=Math.sin(c);let h=0,p=1,g=0,f=1;const w=Array(l);for(let v=0;v<l;v++)w[v]=new C(i+i*p,o+o*h),g=u*p+d*h,f=d*p-u*h,h=g,p=f;return w}nearestPoint(t){let r,i=1/0;for(const o of this.edges){const s=o.nearestPoint(t),a=s.dist(t);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r,i){return this.edges.some(o=>o.hitTestLineSegment(t,r,i))}getBounds(){return new de(0,0,this.w,this.h)}}class cH extends wA{constructor(e){super({...e}),this.config=e}getVertices(){const e=Math.max(1,this.w),t=Math.max(1,this.h),r=e/2,i=t/2,o=10,s=Array(o*2-2);if(t>e)for(let a=0;a<o-1;a++){const l=-Ue+Ue*a/(o-2),c=Ue*a/(o-2);s[a]=new C(r+r*Math.cos(l),r+r*Math.sin(l)),s[a+(o-1)]=new C(r+r*Math.cos(c),t-r+r*Math.sin(c))}else for(let a=0;a<o-1;a++){const l=-at+Ue*a/(o-2),c=at+Ue*-a/(o-2);s[a]=new C(e-i+i*Math.cos(l),t-i+i*Math.sin(l)),s[a+(o-1)]=new C(i-i*Math.cos(c),t-i+i*Math.sin(c))}return s}}function bA(n,e){return n<0?1:n>e?-1:n<Xl?(Xl-n)/Xl:n>e-Xl?-(Xl-e+n)/Xl:0}function Gv(n){if(!n.inputs.isDragging||n.inputs.isPanning)return;const{inputs:{currentScreenPoint:{x:e,y:t}}}=n,r=n.getZoomLevel(),i=n.getViewportScreenBounds(),o=i.w<1e3?.612:1,s=i.h<1e3?.612:1,a=bA(e-i.x,i.w),l=bA(t-i.y,i.h);if(a===0&&l===0)return;const c=n.user.getEdgeScrollSpeed()*T9,d=c*a*o/r,u=c*l*s/r,h=n.getCamera();n.setCamera({x:h.x+d,y:h.y+u})}async function dH({shouldReload:n=!0}={}){sessionStorage.clear(),await Promise.all(Wv().map(e=>PV(e))),localStorage.clear(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=dH);function uH(n,e="_blank"){fv.openWindow(n,e)}var Ag=function(n){return n&&n.Math==Math&&n},rr=Ag(typeof globalThis=="object"&&globalThis)||Ag(typeof window=="object"&&window)||Ag(typeof self=="object"&&self)||Ag(typeof Ge=="object"&&Ge)||function(){return this}()||Ge||Function("return this")(),Yv={},Nn=function(n){try{return!!n()}catch{return!0}},hH=Nn,Is=!hH(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),pH=Nn,Tg=!pH(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),fH=Tg,jg=Function.prototype.call,Ms=fH?jg.bind(jg):function(){return jg.apply(jg,arguments)},vA={},SA={}.propertyIsEnumerable,xA=Object.getOwnPropertyDescriptor,gH=xA&&!SA.call({1:2},1);vA.f=gH?function(n){var e=xA(this,n);return!!e&&e.enumerable}:SA;var _A=function(n,e){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:e}},kA=Tg,CA=Function.prototype,Xv=CA.call,mH=kA&&CA.bind.bind(Xv,Xv),Yt=kA?mH:function(n){return function(){return Xv.apply(n,arguments)}},EA=Yt,yH=EA({}.toString),wH=EA("".slice),lc=function(n){return wH(yH(n),8,-1)},bH=Yt,vH=Nn,SH=lc,qv=Object,xH=bH("".split),_H=vH(function(){return!qv("z").propertyIsEnumerable(0)})?function(n){return SH(n)=="String"?xH(n,""):qv(n)}:qv,Rg=function(n){return n==null},kH=Rg,CH=TypeError,cc=function(n){if(kH(n))throw CH("Can't call method on "+n);return n},EH=_H,PH=cc,Dg=function(n){return EH(PH(n))},Jv=typeof document=="object"&&document.all,IH=typeof Jv>"u"&&Jv!==void 0,PA={all:Jv,IS_HTMLDDA:IH},IA=PA,MH=IA.all,Fn=IA.IS_HTMLDDA?function(n){return typeof n=="function"||n===MH}:function(n){return typeof n=="function"},MA=Fn,AA=PA,AH=AA.all,Ta=AA.IS_HTMLDDA?function(n){return typeof n=="object"?n!==null:MA(n)||n===AH}:function(n){return typeof n=="object"?n!==null:MA(n)},Zv=rr,TH=Fn,jH=function(n){return TH(n)?n:void 0},Og=function(n,e){return arguments.length<2?jH(Zv[n]):Zv[n]&&Zv[n][e]},RH=Yt,TA=RH({}.isPrototypeOf),DH=typeof navigator<"u"&&String(navigator.userAgent)||"",jA=rr,Qv=DH,RA=jA.process,DA=jA.Deno,OA=RA&&RA.versions||DA&&DA.version,LA=OA&&OA.v8,ui,Lg;LA&&(ui=LA.split("."),Lg=ui[0]>0&&ui[0]<4?1:+(ui[0]+ui[1])),!Lg&&Qv&&(ui=Qv.match(/Edge\/(\d+)/),(!ui||ui[1]>=74)&&(ui=Qv.match(/Chrome\/(\d+)/),ui&&(Lg=+ui[1])));var OH=Lg,zA=OH,LH=Nn,zH=rr,NH=zH.String,NA=!!Object.getOwnPropertySymbols&&!LH(function(){var n=Symbol();return!NH(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&zA&&zA<41}),FH=NA,FA=FH&&!Symbol.sham&&typeof Symbol.iterator=="symbol",$H=Og,BH=Fn,UH=TA,VH=FA,HH=Object,$A=VH?function(n){return typeof n=="symbol"}:function(n){var e=$H("Symbol");return BH(e)&&UH(e.prototype,HH(n))},WH=String,KH=function(n){try{return WH(n)}catch{return"Object"}},GH=Fn,YH=KH,XH=TypeError,e1=function(n){if(GH(n))return n;throw XH(YH(n)+" is not a function")},qH=e1,JH=Rg,t1=function(n,e){var t=n[e];return JH(t)?void 0:qH(t)},n1=Ms,r1=Fn,i1=Ta,ZH=TypeError,QH=function(n,e){var t,r;if(e==="string"&&r1(t=n.toString)&&!i1(r=n1(t,n))||r1(t=n.valueOf)&&!i1(r=n1(t,n))||e!=="string"&&r1(t=n.toString)&&!i1(r=n1(t,n)))return r;throw ZH("Can't convert object to primitive value")},BA={exports:{}},UA=rr,eW=Object.defineProperty,o1=function(n,e){try{eW(UA,n,{value:e,configurable:!0,writable:!0})}catch{UA[n]=e}return e},tW=rr,nW=o1,VA="__core-js_shared__",rW=tW[VA]||nW(VA,{}),s1=rW,HA=s1;(BA.exports=function(n,e){return HA[n]||(HA[n]=e!==void 0?e:{})})("versions",[]).push({version:"3.32.0",mode:"global",copyright:"\xA9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.0/LICENSE",source:"https://github.com/zloirock/core-js"});var a1=BA.exports,iW=cc,oW=Object,Ru=function(n){return oW(iW(n))},sW=Yt,aW=Ru,lW=sW({}.hasOwnProperty),As=Object.hasOwn||function(n,e){return lW(aW(n),e)},cW=Yt,dW=0,uW=Math.random(),hW=cW(1 .toString),WA=function(n){return"Symbol("+(n===void 0?"":n)+")_"+hW(++dW+uW,36)},pW=rr,fW=a1,KA=As,gW=WA,mW=NA,yW=FA,dc=pW.Symbol,l1=fW("wks"),wW=yW?dc.for||dc:dc&&dc.withoutSetter||gW,jo=function(n){return KA(l1,n)||(l1[n]=mW&&KA(dc,n)?dc[n]:wW("Symbol."+n)),l1[n]},bW=Ms,GA=Ta,YA=$A,vW=t1,SW=QH,xW=jo,_W=TypeError,kW=xW("toPrimitive"),CW=function(n,e){if(!GA(n)||YA(n))return n;var t=vW(n,kW),r;if(t){if(e===void 0&&(e="default"),r=bW(t,n,e),!GA(r)||YA(r))return r;throw _W("Can't convert object to primitive value")}return e===void 0&&(e="number"),SW(n,e)},EW=CW,PW=$A,XA=function(n){var e=EW(n,"string");return PW(e)?e:e+""},IW=rr,qA=Ta,c1=IW.document,MW=qA(c1)&&qA(c1.createElement),JA=function(n){return MW?c1.createElement(n):{}},AW=Is,TW=Nn,jW=JA,ZA=!AW&&!TW(function(){return Object.defineProperty(jW("div"),"a",{get:function(){return 7}}).a!=7}),RW=Is,DW=Ms,OW=vA,LW=_A,zW=Dg,NW=XA,FW=As,$W=ZA,QA=Object.getOwnPropertyDescriptor;Yv.f=RW?QA:function(n,e){if(n=zW(n),e=NW(e),$W)try{return QA(n,e)}catch{}if(FW(n,e))return LW(!DW(OW.f,n,e),n[e])};var uc={},BW=Is,UW=Nn,eT=BW&&UW(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),VW=Ta,HW=String,WW=TypeError,ja=function(n){if(VW(n))return n;throw WW(HW(n)+" is not an object")},KW=Is,GW=ZA,YW=eT,zg=ja,tT=XA,XW=TypeError,d1=Object.defineProperty,qW=Object.getOwnPropertyDescriptor,u1="enumerable",h1="configurable",p1="writable";uc.f=KW?YW?function(n,e,t){if(zg(n),e=tT(e),zg(t),typeof n=="function"&&e==="prototype"&&"value"in t&&p1 in t&&!t[p1]){var r=qW(n,e);r&&r[p1]&&(n[e]=t.value,t={configurable:h1 in t?t[h1]:r[h1],enumerable:u1 in t?t[u1]:r[u1],writable:!1})}return d1(n,e,t)}:d1:function(n,e,t){if(zg(n),e=tT(e),zg(t),GW)try{return d1(n,e,t)}catch{}if("get"in t||"set"in t)throw XW("Accessors not supported");return"value"in t&&(n[e]=t.value),n};var JW=Is,ZW=uc,QW=_A,f1=JW?function(n,e,t){return ZW.f(n,e,QW(1,t))}:function(n,e,t){return n[e]=t,n},nT={exports:{}},g1=Is,eK=As,rT=Function.prototype,tK=g1&&Object.getOwnPropertyDescriptor,m1=eK(rT,"name"),nK=m1&&(function(){}).name==="something",rK=m1&&(!g1||g1&&tK(rT,"name").configurable),iK={EXISTS:m1,PROPER:nK,CONFIGURABLE:rK},oK=Yt,sK=Fn,y1=s1,aK=oK(Function.toString);sK(y1.inspectSource)||(y1.inspectSource=function(n){return aK(n)});var iT=y1.inspectSource,lK=rr,cK=Fn,oT=lK.WeakMap,dK=cK(oT)&&/native code/.test(String(oT)),uK=a1,hK=WA,sT=uK("keys"),aT=function(n){return sT[n]||(sT[n]=hK(n))},w1={},pK=dK,lT=rr,fK=Ta,gK=f1,b1=As,v1=s1,mK=aT,yK=w1,cT="Object already initialized",S1=lT.TypeError,wK=lT.WeakMap,Ng,Du,Fg,bK=function(n){return Fg(n)?Du(n):Ng(n,{})},vK=function(n){return function(e){var t;if(!fK(e)||(t=Du(e)).type!==n)throw S1("Incompatible receiver, "+n+" required");return t}};if(pK||v1.state){var $i=v1.state||(v1.state=new wK);$i.get=$i.get,$i.has=$i.has,$i.set=$i.set,Ng=function(n,e){if($i.has(n))throw S1(cT);return e.facade=n,$i.set(n,e),e},Du=function(n){return $i.get(n)||{}},Fg=function(n){return $i.has(n)}}else{var hc=mK("state");yK[hc]=!0,Ng=function(n,e){if(b1(n,hc))throw S1(cT);return e.facade=n,gK(n,hc,e),e},Du=function(n){return b1(n,hc)?n[hc]:{}},Fg=function(n){return b1(n,hc)}}var dT={set:Ng,get:Du,has:Fg,enforce:bK,getterFor:vK},x1=Yt,SK=Nn,xK=Fn,$g=As,_1=Is,_K=iK.CONFIGURABLE,kK=iT,uT=dT,CK=uT.enforce,EK=uT.get,hT=String,Bg=Object.defineProperty,PK=x1("".slice),IK=x1("".replace),MK=x1([].join),AK=_1&&!SK(function(){return Bg(function(){},"length",{value:8}).length!==8}),TK=String(String).split("String"),jK=nT.exports=function(n,e,t){PK(hT(e),0,7)==="Symbol("&&(e="["+IK(hT(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!$g(n,"name")||_K&&n.name!==e)&&(_1?Bg(n,"name",{value:e,configurable:!0}):n.name=e),AK&&t&&$g(t,"arity")&&n.length!==t.arity&&Bg(n,"length",{value:t.arity});try{t&&$g(t,"constructor")&&t.constructor?_1&&Bg(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch{}var r=CK(n);return $g(r,"source")||(r.source=MK(TK,typeof e=="string"?e:"")),n};Function.prototype.toString=jK(function(){return xK(this)&&EK(this).source||kK(this)},"toString");var RK=nT.exports,DK=Fn,OK=uc,LK=RK,zK=o1,pT=function(n,e,t,r){r||(r={});var i=r.enumerable,o=r.name!==void 0?r.name:e;if(DK(t)&&LK(t,o,r),r.global)i?n[e]=t:zK(e,t);else{try{r.unsafe?n[e]&&(i=!0):delete n[e]}catch{}i?n[e]=t:OK.f(n,e,{value:t,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return n},fT={},NK=Math.ceil,FK=Math.floor,$K=Math.trunc||function(n){var e=+n;return(e>0?FK:NK)(e)},BK=$K,Ra=function(n){var e=+n;return e!==e||e===0?0:BK(e)},UK=Ra,VK=Math.max,HK=Math.min,WK=function(n,e){var t=UK(n);return t<0?VK(t+e,0):HK(t,e)},KK=Ra,GK=Math.min,gT=function(n){return n>0?GK(KK(n),9007199254740991):0},YK=gT,Ou=function(n){return YK(n.length)},XK=Dg,qK=WK,JK=Ou,mT=function(n){return function(e,t,r){var i=XK(e),o=JK(i),s=qK(r,o),a;if(n&&t!=t){for(;o>s;)if(a=i[s++],a!=a)return!0}else for(;o>s;s++)if((n||s in i)&&i[s]===t)return n||s||0;return!n&&-1}},ZK={includes:mT(!0),indexOf:mT(!1)},QK=Yt,k1=As,eG=Dg,tG=ZK.indexOf,nG=w1,yT=QK([].push),wT=function(n,e){var t=eG(n),r=0,i=[],o;for(o in t)!k1(nG,o)&&k1(t,o)&&yT(i,o);for(;e.length>r;)k1(t,o=e[r++])&&(~tG(i,o)||yT(i,o));return i},C1=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],rG=wT,iG=C1,oG=iG.concat("length","prototype");fT.f=Object.getOwnPropertyNames||function(n){return rG(n,oG)};var bT={};bT.f=Object.getOwnPropertySymbols;var sG=Og,aG=Yt,lG=fT,cG=bT,dG=ja,uG=aG([].concat),hG=sG("Reflect","ownKeys")||function(n){var e=lG.f(dG(n)),t=cG.f;return t?uG(e,t(n)):e},vT=As,pG=hG,fG=Yv,gG=uc,mG=function(n,e,t){for(var r=pG(e),i=gG.f,o=fG.f,s=0;s<r.length;s++){var a=r[s];!vT(n,a)&&!(t&&vT(t,a))&&i(n,a,o(e,a))}},yG=Nn,wG=Fn,bG=/#|\.prototype\./,Lu=function(n,e){var t=SG[vG(n)];return t==_G?!0:t==xG?!1:wG(e)?yG(e):!!e},vG=Lu.normalize=function(n){return String(n).replace(bG,".").toLowerCase()},SG=Lu.data={},xG=Lu.NATIVE="N",_G=Lu.POLYFILL="P",kG=Lu,E1=rr,CG=Yv.f,EG=f1,PG=pT,IG=o1,MG=mG,AG=kG,pc=function(n,e){var t=n.target,r=n.global,i=n.stat,o,s,a,l,c,d;if(r?s=E1:i?s=E1[t]||IG(t,{}):s=(E1[t]||{}).prototype,s)for(a in e){if(c=e[a],n.dontCallGetSet?(d=CG(s,a),l=d&&d.value):l=s[a],o=AG(r?a:t+(i?".":"#")+a,n.forced),!o&&l!==void 0){if(typeof c==typeof l)continue;MG(c,l)}(n.sham||l&&l.sham)&&EG(c,"sham",!0),PG(s,a,c,n)}},ST={},TG=wT,jG=C1,RG=Object.keys||function(n){return TG(n,jG)},DG=Is,OG=eT,LG=uc,zG=ja,NG=Dg,FG=RG;ST.f=DG&&!OG?Object.defineProperties:function(n,e){zG(n);for(var t=NG(e),r=FG(e),i=r.length,o=0,s;i>o;)LG.f(n,s=r[o++],t[s]);return n};var $G=Og,BG=$G("document","documentElement"),UG=ja,VG=ST,xT=C1,HG=w1,WG=BG,KG=JA,GG=aT,_T=">",kT="<",P1="prototype",I1="script",CT=GG("IE_PROTO"),M1=function(){},ET=function(n){return kT+I1+_T+n+kT+"/"+I1+_T},PT=function(n){n.write(ET("")),n.close();var e=n.parentWindow.Object;return n=null,e},YG=function(){var n=KG("iframe"),e="java"+I1+":",t;return n.style.display="none",WG.appendChild(n),n.src=String(e),t=n.contentWindow.document,t.open(),t.write(ET("document.F=Object")),t.close(),t.F},Ug,Vg=function(){try{Ug=new ActiveXObject("htmlfile")}catch{}Vg=typeof document<"u"?document.domain&&Ug?PT(Ug):YG():PT(Ug);for(var n=xT.length;n--;)delete Vg[P1][xT[n]];return Vg()};HG[CT]=!0;var IT=Object.create||function(n,e){var t;return n!==null?(M1[P1]=UG(n),t=new M1,M1[P1]=null,t[CT]=n):t=Vg(),e===void 0?t:VG.f(t,e)},XG=jo,qG=IT,JG=uc.f,A1=XG("unscopables"),T1=Array.prototype;T1[A1]==null&&JG(T1,A1,{configurable:!0,value:qG(null)});var j1=function(n){T1[A1][n]=!0},ZG=pc,QG=Ru,eY=Ou,tY=Ra,nY=j1;ZG({target:"Array",proto:!0},{at:function(n){var e=QG(this),t=eY(e),r=tY(n),i=r>=0?r:t+r;return i<0||i>=t?void 0:e[i]}}),nY("at");var rY=rr,iY=Yt,zu=function(n,e){return iY(rY[n].prototype[e])},oY=zu;oY("Array","at");var sY=lc,MT=Array.isArray||function(n){return sY(n)=="Array"},aY=TypeError,lY=9007199254740991,cY=function(n){if(n>lY)throw aY("Maximum allowed index exceeded");return n},dY=lc,uY=Yt,AT=function(n){if(dY(n)==="Function")return uY(n)},TT=AT,hY=e1,pY=Tg,fY=TT(TT.bind),gY=function(n,e){return hY(n),e===void 0?n:pY?fY(n,e):function(){return n.apply(e,arguments)}},mY=MT,yY=Ou,wY=cY,bY=gY,jT=function(n,e,t,r,i,o,s,a){for(var l=i,c=0,d=s?bY(s,a):!1,u,h;c<r;)c in t&&(u=d?d(t[c],c,e):t[c],o>0&&mY(u)?(h=yY(u),l=jT(n,e,u,h,l,o-1)-1):(wY(l+1),n[l]=u),l++),c++;return l},RT=jT,vY=jo,SY=vY("toStringTag"),DT={};DT[SY]="z";var xY=String(DT)==="[object z]",_Y=xY,kY=Fn,Hg=lc,CY=jo,EY=CY("toStringTag"),PY=Object,IY=Hg(function(){return arguments}())=="Arguments",MY=function(n,e){try{return n[e]}catch{}},OT=_Y?Hg:function(n){var e,t,r;return n===void 0?"Undefined":n===null?"Null":typeof(t=MY(e=PY(n),EY))=="string"?t:IY?Hg(e):(r=Hg(e))=="Object"&&kY(e.callee)?"Arguments":r},AY=Yt,TY=Nn,LT=Fn,jY=OT,RY=Og,DY=iT,zT=function(){},OY=[],NT=RY("Reflect","construct"),R1=/^\s*(?:class|function)\b/,LY=AY(R1.exec),zY=!R1.exec(zT),Nu=function(n){if(!LT(n))return!1;try{return NT(zT,OY,n),!0}catch{return!1}},FT=function(n){if(!LT(n))return!1;switch(jY(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return zY||!!LY(R1,DY(n))}catch{return!0}};FT.sham=!0;var NY=!NT||TY(function(){var n;return Nu(Nu.call)||!Nu(Object)||!Nu(function(){n=!0})||n})?FT:Nu,$T=MT,FY=NY,$Y=Ta,BY=jo,UY=BY("species"),BT=Array,VY=function(n){var e;return $T(n)&&(e=n.constructor,FY(e)&&(e===BT||$T(e.prototype))?e=void 0:$Y(e)&&(e=e[UY],e===null&&(e=void 0))),e===void 0?BT:e},HY=VY,UT=function(n,e){return new(HY(n))(e===0?0:e)},WY=pc,KY=RT,GY=Ru,YY=Ou,XY=Ra,qY=UT;WY({target:"Array",proto:!0},{flat:function(){var n=arguments.length?arguments[0]:void 0,e=GY(this),t=YY(e),r=qY(e,0);return r.length=KY(r,e,e,t,0,n===void 0?1:XY(n)),r}});var JY=j1;JY("flat");var ZY=zu;ZY("Array","flat");var QY=pc,eX=RT,tX=e1,nX=Ru,rX=Ou,iX=UT;QY({target:"Array",proto:!0},{flatMap:function(n){var e=nX(this),t=rX(e),r;return tX(n),r=iX(e,0),r.length=eX(r,e,e,t,0,1,n,arguments.length>1?arguments[1]:void 0),r}});var oX=j1;oX("flatMap");var sX=zu;sX("Array","flatMap");var aX=OT,lX=String,Fu=function(n){if(aX(n)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return lX(n)},cX=pc,dX=Yt,uX=cc,hX=Ra,pX=Fu,fX=Nn,gX=dX("".charAt),mX=fX(function(){return"\u{20BB7}".at(-2)!=="\uD842"});cX({target:"String",proto:!0,forced:mX},{at:function(n){var e=pX(uX(this)),t=e.length,r=hX(n),i=r>=0?r:t+r;return i<0||i>=t?void 0:gX(e,i)}});var yX=zu;yX("String","at");var wX=ja,VT=function(){var n=wX(this),e="";return n.hasIndices&&(e+="d"),n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.dotAll&&(e+="s"),n.unicode&&(e+="u"),n.unicodeSets&&(e+="v"),n.sticky&&(e+="y"),e},D1=Nn,bX=rr,O1=bX.RegExp,L1=D1(function(){var n=O1("a","y");return n.lastIndex=2,n.exec("abcd")!=null}),vX=L1||D1(function(){return!O1("a","y").sticky}),SX=L1||D1(function(){var n=O1("^r","gy");return n.lastIndex=2,n.exec("str")!=null}),xX={BROKEN_CARET:SX,MISSED_STICKY:vX,UNSUPPORTED_Y:L1},_X=Nn,kX=rr,CX=kX.RegExp,EX=_X(function(){var n=CX(".","s");return!(n.dotAll&&n.exec(`
`)&&n.flags==="s")}),PX=Nn,IX=rr,MX=IX.RegExp,AX=PX(function(){var n=MX("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),fc=Ms,Wg=Yt,TX=Fu,jX=VT,RX=xX,DX=a1,OX=IT,LX=dT.get,zX=EX,NX=AX,FX=DX("native-string-replace",String.prototype.replace),Kg=RegExp.prototype.exec,z1=Kg,$X=Wg("".charAt),BX=Wg("".indexOf),UX=Wg("".replace),N1=Wg("".slice),F1=function(){var n=/a/,e=/b*/g;return fc(Kg,n,"a"),fc(Kg,e,"a"),n.lastIndex!==0||e.lastIndex!==0}(),HT=RX.BROKEN_CARET,$1=/()??/.exec("")[1]!==void 0,VX=F1||$1||HT||zX||NX;VX&&(z1=function(n){var e=this,t=LX(e),r=TX(n),i=t.raw,o,s,a,l,c,d,u;if(i)return i.lastIndex=e.lastIndex,o=fc(z1,i,r),e.lastIndex=i.lastIndex,o;var h=t.groups,p=HT&&e.sticky,g=fc(jX,e),f=e.source,w=0,v=r;if(p&&(g=UX(g,"y",""),BX(g,"g")===-1&&(g+="g"),v=N1(r,e.lastIndex),e.lastIndex>0&&(!e.multiline||e.multiline&&$X(r,e.lastIndex-1)!==`
`)&&(f="(?: "+f+")",v=" "+v,w++),s=new RegExp("^(?:"+f+")",g)),$1&&(s=new RegExp("^"+f+"$(?!\\s)",g)),F1&&(a=e.lastIndex),l=fc(Kg,p?s:e,v),p?l?(l.input=N1(l.input,w),l[0]=N1(l[0],w),l.index=e.lastIndex,e.lastIndex+=l[0].length):e.lastIndex=0:F1&&l&&(e.lastIndex=e.global?l.index+l[0].length:a),$1&&l&&l.length>1&&fc(FX,l[0],s,function(){for(c=1;c<arguments.length-2;c++)arguments[c]===void 0&&(l[c]=void 0)}),l&&h)for(l.groups=d=OX(null),c=0;c<h.length;c++)u=h[c],d[u[0]]=l[u[1]];return l});var B1=z1,HX=pc,WT=B1;HX({target:"RegExp",proto:!0,forced:/./.exec!==WT},{exec:WT});var WX=Tg,KT=Function.prototype,GT=KT.apply,YT=KT.call,KX=typeof Reflect=="object"&&Reflect.apply||(WX?YT.bind(GT):function(){return YT.apply(GT,arguments)}),XT=AT,qT=pT,GX=B1,JT=Nn,ZT=jo,YX=f1,XX=ZT("species"),U1=RegExp.prototype,qX=function(n,e,t,r){var i=ZT(n),o=!JT(function(){var c={};return c[i]=function(){return 7},""[n](c)!=7}),s=o&&!JT(function(){var c=!1,d=/a/;return n==="split"&&(d={},d.constructor={},d.constructor[XX]=function(){return d},d.flags="",d[i]=/./[i]),d.exec=function(){return c=!0,null},d[i](""),!c});if(!o||!s||t){var a=XT(/./[i]),l=e(i,""[n],function(c,d,u,h,p){var g=XT(c),f=d.exec;return f===GX||f===U1.exec?o&&!p?{done:!0,value:a(d,u,h)}:{done:!0,value:g(u,d,h)}:{done:!1}});qT(String.prototype,n,l[0]),qT(U1,i,l[1])}r&&YX(U1[i],"sham",!0)},V1=Yt,JX=Ra,ZX=Fu,QX=cc,eq=V1("".charAt),QT=V1("".charCodeAt),tq=V1("".slice),e3=function(n){return function(e,t){var r=ZX(QX(e)),i=JX(t),o=r.length,s,a;return i<0||i>=o?n?"":void 0:(s=QT(r,i),s<55296||s>56319||i+1===o||(a=QT(r,i+1))<56320||a>57343?n?eq(r,i):s:n?tq(r,i,i+2):(s-55296<<10)+(a-56320)+65536)}},nq={codeAt:e3(!1),charAt:e3(!0)},rq=nq.charAt,iq=function(n,e,t){return e+(t?rq(n,e).length:1)},H1=Yt,oq=Ru,sq=Math.floor,W1=H1("".charAt),aq=H1("".replace),K1=H1("".slice),lq=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,cq=/\$([$&'`]|\d{1,2})/g,t3=function(n,e,t,r,i,o){var s=t+n.length,a=r.length,l=cq;return i!==void 0&&(i=oq(i),l=lq),aq(o,l,function(c,d){var u;switch(W1(d,0)){case"$":return"$";case"&":return n;case"`":return K1(e,0,t);case"'":return K1(e,s);case"<":u=i[K1(d,1,-1)];break;default:var h=+d;if(h===0)return c;if(h>a){var p=sq(h/10);return p===0?c:p<=a?r[p-1]===void 0?W1(d,1):r[p-1]+W1(d,1):c}u=r[h-1]}return u===void 0?"":u})},n3=Ms,dq=ja,uq=Fn,hq=lc,pq=B1,fq=TypeError,gq=function(n,e){var t=n.exec;if(uq(t)){var r=n3(t,n,e);return r!==null&&dq(r),r}if(hq(n)==="RegExp")return n3(pq,n,e);throw fq("RegExp#exec called on incompatible receiver")},mq=KX,r3=Ms,Gg=Yt,yq=qX,wq=Nn,bq=ja,vq=Fn,Sq=Rg,xq=Ra,_q=gT,gc=Fu,kq=cc,Cq=iq,Eq=t1,Pq=t3,Iq=gq,Mq=jo,G1=Mq("replace"),Aq=Math.max,Tq=Math.min,jq=Gg([].concat),Y1=Gg([].push),i3=Gg("".indexOf),o3=Gg("".slice),Rq=function(n){return n===void 0?n:String(n)},Dq=function(){return"a".replace(/./,"$0")==="$0"}(),s3=function(){return/./[G1]?/./[G1]("a","$0")==="":!1}(),Oq=!wq(function(){var n=/./;return n.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(n,"$<a>")!=="7"});yq("replace",function(n,e,t){var r=s3?"$":"$0";return[function(i,o){var s=kq(this),a=Sq(i)?void 0:Eq(i,G1);return a?r3(a,i,s,o):r3(e,gc(s),i,o)},function(i,o){var s=bq(this),a=gc(i);if(typeof o=="string"&&i3(o,r)===-1&&i3(o,"$<")===-1){var l=t(e,s,a,o);if(l.done)return l.value}var c=vq(o);c||(o=gc(o));var d=s.global;if(d){var u=s.unicode;s.lastIndex=0}for(var h=[];;){var p=Iq(s,a);if(p===null||(Y1(h,p),!d))break;var g=gc(p[0]);g===""&&(s.lastIndex=Cq(a,_q(s.lastIndex),u))}for(var f="",w=0,v=0;v<h.length;v++){p=h[v];for(var b=gc(p[0]),_=Aq(Tq(xq(p.index),a.length),0),x=[],E=1;E<p.length;E++)Y1(x,Rq(p[E]));var k=p.groups;if(c){var P=jq([b],x,_,a);k!==void 0&&Y1(P,k);var I=gc(mq(o,void 0,P))}else I=Pq(b,a,_,x,k,o);_>=w&&(f+=o3(a,w,_)+I,w=_+b.length)}return f+o3(a,w)}]},!Oq||!Dq||s3);var Lq=Ta,zq=lc,Nq=jo,Fq=Nq("match"),$q=function(n){var e;return Lq(n)&&((e=n[Fq])!==void 0?!!e:zq(n)=="RegExp")},Bq=Ms,Uq=As,Vq=TA,Hq=VT,a3=RegExp.prototype,Wq=function(n){var e=n.flags;return e===void 0&&!("flags"in a3)&&!Uq(n,"flags")&&Vq(a3,n)?Bq(Hq,n):e},Kq=pc,Gq=Ms,X1=Yt,l3=cc,Yq=Fn,Xq=Rg,qq=$q,$u=Fu,Jq=t1,Zq=Wq,Qq=t3,eJ=jo,tJ=eJ("replace"),nJ=TypeError,c3=X1("".indexOf);X1("".replace);var d3=X1("".slice),rJ=Math.max,u3=function(n,e,t){return t>n.length?-1:e===""?t:c3(n,e,t)};Kq({target:"String",proto:!0},{replaceAll:function(n,e){var t=l3(this),r,i,o,s,a,l,c,d,u,h=0,p=0,g="";if(!Xq(n)){if(r=qq(n),r&&(i=$u(l3(Zq(n))),!~c3(i,"g")))throw nJ("`.replaceAll` does not allow non-global regexes");if(o=Jq(n,tJ),o)return Gq(o,n,t,e)}for(s=$u(t),a=$u(n),l=Yq(e),l||(e=$u(e)),c=a.length,d=rJ(1,c),h=u3(s,a,0);h!==-1;)u=l?$u(e(a,h,s)):Qq(a,s,h,[],void 0,e),g+=d3(s,p,h)+u,p=h+c,h=u3(s,a,h+d);return p<s.length&&(g+=d3(s,p)),g}});var iJ=zu;iJ("String","replaceAll");const oJ=({children:n})=>{const e=G();return q("shouldDisplayHandles",()=>e.isInAny("select.idle","select.pointing_handle"),[e])?m.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null},sJ=({shapeId:n})=>{const e=G();return q("show hovered",()=>e.isIn("select.editing_shape")?e.getHoveredShapeId()!==e.getEditingShapeId():e.isInAny("select.idle"),[e])?m.jsx(gu,{className:"tl-user-indicator__hovered",id:n}):null},{PI:aJ}=Math,mc=aJ+1e-4;function h3(n,e={}){const{size:t=16,smoothing:r=.5}=e;if(n.length===0||t<=0)return{left:[],right:[]};const i=n[0],o=n[n.length-1],s=o.runningLength,a=Math.pow(t*r,2),l=[],c=[];let d=n[0].vector,u=n[0].point,h=u,p=u,g=h,f=!1,w;for(let v=0;v<n.length;v++){w=n[v];const{point:b,vector:_}=n[v],x=w.vector.dpr(d),E=(v<n.length-1?n[v+1]:n[v]).vector,k=v<n.length-1?E.dpr(w.vector):1,P=x<0&&!f,I=k!==null&&k<.2;if(P||I){if(k>-.62&&s-w.runningLength>w.radius){const T=d.clone().mul(w.radius);d.clone().cpr(E)<0?(p=C.Add(b,T),g=C.Sub(b,T)):(p=C.Sub(b,T),g=C.Add(b,T)),l.push(p),c.push(g)}else{const T=d.clone().mul(w.radius).per(),O=C.Sub(w.input,T);for(let F=1/13,H=0;H<1;H+=F)p=C.RotWith(O,w.input,mc*H),l.push(p),g=C.RotWith(O,w.input,mc+mc*-H),c.push(g)}u=p,h=g,I&&(f=!0);continue}if(f=!1,w===i||w===o){const T=C.Per(_).mul(w.radius);l.push(C.Sub(b,T)),c.push(C.Add(b,T));continue}const A=C.Lrp(E,_,k).per().mul(w.radius);p=C.Sub(b,A),(v<=1||C.Dist2(u,p)>a)&&(l.push(p),u=p),g=C.Add(b,A),(v<=1||C.Dist2(h,g)>a)&&(c.push(g),h=g),d=_}return{left:l,right:c}}function Bu(n,e={}){const{size:t=16,start:r={},end:i={},last:o=!1}=e,{cap:s=!0}=r,{cap:a=!0}=i;if(n.length===0||t<=0)return[];const l=n[0],c=n[n.length-1],d=c.runningLength,u=r.taper===!1?0:r.taper===!0?Math.max(t,d):r.taper,h=i.taper===!1?0:i.taper===!0?Math.max(t,d):i.taper,{left:p,right:g}=h3(n,e),f=l.point,w=n.length>1?n[n.length-1].point:C.AddXY(l.point,1,1);if(n.length===1&&(!(u||h)||o)){const x=C.Add(f,C.Sub(f,w).uni().per().mul(-l.radius)),E=[];for(let k=1/13,P=k;P<=1;P+=k)E.push(C.RotWith(x,f,mc*2*P));return E}const v=[];if(!(u||h&&n.length===1))if(s)for(let x=1/8,E=x;E<=1;E+=x){const k=C.RotWith(g[0],f,mc*E);v.push(k)}else{const x=C.Sub(p[0],g[0]),E=C.Mul(x,.5),k=C.Mul(x,.51);v.push(C.Sub(f,E),C.Sub(f,k),C.Add(f,k),C.Add(f,E))}const b=[],_=c.vector.clone().per().neg();if(h||u&&n.length===1)b.push(w);else if(a){const x=C.Add(w,C.Mul(_,c.radius));for(let E=1/29,k=E;k<1;k+=E)b.push(C.RotWith(x,w,mc*3*k))}else b.push(C.Add(w,C.Mul(_,c.radius)),C.Add(w,C.Mul(_,c.radius*.99)),C.Sub(w,C.Mul(_,c.radius*.99)),C.Sub(w,C.Mul(_,c.radius)));return p.concat(b,g.reverse(),v)}const lJ=.025,cJ=.01;function hi(n,e={}){var w;const{streamline:t=.5,size:r=16,simulatePressure:i=!1}=e;if(n.length===0)return[];const o=.15+(1-t)*.85;let s=n.map(C.From),a=0;if(!i){let v=s[0];for(;v&&!(v.z>=lJ);)s.shift(),v=s[0]}if(!i){let v=s[s.length-1];for(;v&&!(v.z>=cJ);)s.pop(),v=s[s.length-1]}if(s.length===0)return[{point:C.From(n[0]),input:C.From(n[0]),pressure:i?.5:.15,vector:new C(1,1),distance:0,runningLength:0,radius:1}];let l=s[1];for(;l&&!(C.Dist(l,s[0])>r/3);)s[0].z=Math.max(s[0].z,l.z),s.splice(1,1),l=s[1];const c=s.pop();for(l=s[s.length-1];l&&!(C.Dist(l,c)>r/3);)s.pop(),l=s[s.length-1],a++;s.push(c);const d=e.last||!e.simulatePressure||s.length>1&&C.Dist(s[s.length-1],s[s.length-2])<r||a>0;if(s.length===2&&e.simulatePressure){const v=s[1];s=s.slice(0,-1);for(let b=1;b<5;b++){const _=C.Lrp(s[0],v,b/4);_.z=(s[0].z+(v.z-s[0].z))*b/4,s.push(_)}}const u=[{point:s[0],input:s[0],pressure:i?.5:s[0].z,vector:new C(1,1),distance:0,runningLength:0,radius:1}];let h=0,p=u[0],g,f;d&&t>0&&s.push(s[s.length-1].clone());for(let v=1,b=s.length;v<b;v++)g=!o||e.last&&v===b-1?s[v].clone():s[v].clone().lrp(p.point,1-o),!p.point.equals(g)&&(f=C.Dist(g,p.point),h+=f,!(v<4&&h<r)&&(p={input:s[v],point:g,pressure:i?.5:s[v].z,vector:C.Sub(p.point,g).uni(),distance:f,runningLength:h,radius:1},u.push(p)));if((w=u[1])!=null&&w.vector&&(u[0].vector=u[1].vector.clone()),h<1){const v=Math.max(.5,...u.map(b=>b.pressure));u.forEach(b=>b.pressure=v)}return u}const{min:Ts}=Math,q1=.275;function yc(n,e){const{size:t=16,thinning:r=.5,simulatePressure:i=!0,easing:o=w=>w,start:s={},end:a={}}=e,{easing:l=_n.easeOutQuad}=s,{easing:c=_n.easeOutCubic}=a,d=n[n.length-1].runningLength;let u,h=n[0].pressure,p;if(!i&&d<t){const w=n.reduce((v,b)=>Math.max(v,b.pressure),.5);return n.forEach(v=>{v.pressure=w,v.radius=t*o(.5-r*(.5-v.pressure))}),n}else{let w;for(let v=0,b=n.length;v<b&&(p=n[v],!(p.runningLength>t*5));v++){const _=Ts(1,p.distance/t);if(i){const x=Ts(1,1-_);w=Ts(1,h+(x-h)*(_*q1))}else w=Ts(1,h+(p.pressure-h)*.5);h=h+(w-h)*.5}for(let v=0;v<n.length;v++){if(p=n[v],r){let{pressure:b}=p;const _=Ts(1,p.distance/t);if(i){const x=Ts(1,1-_);b=Ts(1,h+(x-h)*(_*q1))}else b=Ts(1,h+(b-h)*(_*q1));p.radius=t*o(.5-r*(.5-b)),h=b}else p.radius=t/2;u===void 0&&(u=p.radius)}}const g=s.taper===!1?0:s.taper===!0?Math.max(t,d):s.taper,f=a.taper===!1?0:a.taper===!0?Math.max(t,d):a.taper;if(g||f)for(let w=0;w<n.length;w++){p=n[w];const{runningLength:v}=p,b=v<g?l(v/g):1,_=d-v<f?c((d-v)/f):1;p.radius=Math.max(.01,p.radius*Math.min(b,_))}return n}function dJ(n,e={}){return Bu(yc(hi(n,e),e),e)}const p3=({scribble:n,zoom:e,color:t,opacity:r,className:i})=>{if(!n.points.length)return null;const o=dJ(n.points,{size:n.size/e,start:{taper:n.taper,easing:_n.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let s;if(o.length<4){const a=n.size/e/2,{x:l,y:c}=n.points[n.points.length-1];s=`M ${l-a},${c} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else s=xu(o);return m.jsx("svg",{className:i&&ye("tl-overlays__item",i),children:m.jsx("path",{className:"tl-scribble",d:s,fill:t??`var(--color-${n.color})`,opacity:r??n.opacity})})},uJ=({bounds:n,rotation:e})=>{const t=G();return q("should display",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[t])?m.jsx(OI,{bounds:n,rotation:e}):null};function Br(){const n=G();return q("isReadonlyMode",()=>n.getInstanceState().isReadonly,[n])}function hJ({size:n,width:e,height:t,hideAlternateHandles:r}){const i=R(n/3),o=i/2;return m.jsxs("svg",{className:"tl-overlays__item",children:[m.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${R(0-o)},${R(n)} 
						${R(0-o)},${R(0-o)} 
						${R(n)},${R(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),m.jsx("line",{className:ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(e/2-n),y1:R(0-o),x2:R(e/2+n),y2:R(0-o),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),m.jsx("polyline",{className:ye("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${R(e-n)},${R(0-o)} 
						${R(e+o)},${R(0-o)} 
						${R(e+o)},${R(n)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),m.jsx("line",{className:ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(e+o),y1:R(t/2-n),x2:R(e+o),y2:R(t/2+n),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),m.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${R(e+o)},${R(t-n)} 
						${R(e+o)},${R(t+o)}
						${R(e-n)},${R(t+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),m.jsx("line",{className:ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(e/2-n),y1:R(t+o),x2:R(e/2+n),y2:R(t+o),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),m.jsx("polyline",{className:ye("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${R(0+n)},${R(t+o)} 
						${R(0-o)},${R(t+o)}
						${R(0-o)},${R(t-n)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),m.jsx("line",{className:ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(0-o),y1:R(t/2-n),x2:R(0-o),y2:R(t/2+n),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const pJ=$e(function({bounds:n,rotation:e}){const t=G(),r=S.useRef(null),i=Br(),o=Fi("top"),s=Fi("right"),a=Fi("bottom"),l=Fi("left"),c=Fi("top_left"),d=Fi("top_right"),u=Fi("bottom_right"),h=Fi("bottom_left"),p=!t.getIsMenuOpen()&&t.getInstanceState().cursor.type==="default",g=t.getInstanceState().isCoarsePointer,f=t.getOnlySelectedShape(),w=f&&t.isShapeOrAncestorLocked(f),v=f?t.getShapeUtil(f).expandSelectionOutlinePx(f):0;if(Gl(r,n==null?void 0:n.x,n==null?void 0:n.y,1,t.getSelectionRotation(),{x:-v,y:-v}),!n)return null;n=n.clone().expandBy(v).zeroFix();const b=t.getZoomLevel(),_=t.getInstanceState().isChangingStyle,x=n.width,E=n.height,k=8/b,P=x<k*2,I=E<k*2,A=x<k*4,T=E<k*4,O=x<k*5,F=E<k*5,H=g?1.75:1,D=6/b*H,K=(A?D/2:D)*(H*.75),B=(T?D/2:D)*(H*.75),te=(f?!t.getShapeUtil(f).hideSelectionBoundsFg(f):!0)&&!_;let W=te&&t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||te&&t.isIn("select.resizing")&&f&&t.isShapeOfType(f,"text");f&&W&&t.environment.isFirefox&&t.isShapeOfType(f,"embed")&&(W=!1);const N=t.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!_&&!i,Y=t.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!_&&!i,ee=!g&&!(P||I)&&(Y||N)&&(f?!t.getShapeUtil(f).hideRotateHandle(f):!0)&&!w,pe=g&&(!A||!T)&&(Y||N)&&(f?!t.getShapeUtil(f).hideRotateHandle(f):!0)&&!w,ve=Y&&(f?t.getShapeUtil(f).canResize(f)&&!t.getShapeUtil(f).hideResizeHandles(f):!0)&&!N&&!w,be=P||I,fe=P&&I,Ee=O||F,zt=ve||N,We=!ee,Fe=!Y||!pe,Ke=!Y||!zt,ki=!Y||!zt||be,or=!Y||!zt||be,Mr=!Y||!zt||fe&&!N;let Nt=g;Nt&&f&&f.type==="text"&&(Nt=!1);let Tt=!0;N?Tt=Ee:ve&&(Tt=be||fe||Nt);const qo=Math.min(24/b,E-B*3),op=Y&&g&&f&&t.isShapeOfType(f,"text")&&qo*b>=4;return m.jsx("svg",{className:"tl-overlays__item tl-selection__fg tl-svg-context","data-testid":"selection-foreground",children:m.jsxs("g",{ref:r,children:[W&&m.jsx("rect",{className:ye("tl-selection__fg__outline"),width:R(x),height:R(E)}),m.jsx(Yg,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:D,corner:"top_left_rotate",cursor:p?br("nwse-rotate",e):void 0,isHidden:We}),m.jsx(Yg,{"data-testid":"selection.rotate.top-right",cx:x+D*3,cy:0,targetSize:D,corner:"top_right_rotate",cursor:p?br("nesw-rotate",e):void 0,isHidden:We}),m.jsx(Yg,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:E+D*3,targetSize:D,corner:"bottom_left_rotate",cursor:p?br("swne-rotate",e):void 0,isHidden:We}),m.jsx(Yg,{"data-testid":"selection.rotate.bottom-right",cx:x+D*3,cy:E+D*3,targetSize:D,corner:"bottom_right_rotate",cursor:p?br("senw-rotate",e):void 0,isHidden:We}),m.jsx(gJ,{"data-testid":"selection.rotate.mobile",cx:A?-D*1.5:x/2,cy:A?E/2:-D*1.5,size:k,isHidden:Fe}),m.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Tt}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:R(0-(T?B*2:B)),width:R(x),height:R(Math.max(1,B*2)),style:p?{cursor:br("ns-resize",e)}:void 0,...o}),m.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Tt}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:R(x-(A?0:K)),y:0,height:R(E),width:R(Math.max(1,K*2)),style:p?{cursor:br("ew-resize",e)}:void 0,...s}),m.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Tt}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:R(E-(T?0:B)),width:R(x),height:R(Math.max(1,B*2)),style:p?{cursor:br("ns-resize",e)}:void 0,...a}),m.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Tt}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:R(0-(A?K*2:K)),y:0,height:R(E),width:R(Math.max(1,K*2)),style:p?{cursor:br("ew-resize",e)}:void 0,...l}),m.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Ke}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:R(0-(A?K*2:K*1.5)),y:R(0-(T?B*2:B*1.5)),width:R(K*3),height:R(B*3),style:p?{cursor:br("nwse-resize",e)}:void 0,...c}),m.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":ki}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:R(x-(A?0:K*1.5)),y:R(0-(T?B*2:B*1.5)),width:R(K*3),height:R(B*3),style:p?{cursor:br("nesw-resize",e)}:void 0,...d}),m.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Mr}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:R(x-(A?K:K*1.5)),y:R(E-(T?B:B*1.5)),width:R(K*3),height:R(B*3),style:p?{cursor:br("nwse-resize",e)}:void 0,...u}),m.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":or}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:R(0-(A?K*3:K*1.5)),y:R(E-(T?0:B*1.5)),width:R(K*3),height:R(B*3),style:p?{cursor:br("nesw-resize",e)}:void 0,...h}),ve&&m.jsxs(m.Fragment,{children:[m.jsx("rect",{"data-testid":"selection.resize.top-left",className:ye("tl-corner-handle",{"tl-hidden":Ke}),"aria-label":"top_left handle",x:R(0-k/2),y:R(0-k/2),width:R(k),height:R(k)}),m.jsx("rect",{"data-testid":"selection.resize.top-right",className:ye("tl-corner-handle",{"tl-hidden":ki}),"aria-label":"top_right handle",x:R(x-k/2),y:R(0-k/2),width:R(k),height:R(k)}),m.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:ye("tl-corner-handle",{"tl-hidden":Mr}),"aria-label":"bottom_right handle",x:R(x-k/2),y:R(E-k/2),width:R(k),height:R(k)}),m.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:ye("tl-corner-handle",{"tl-hidden":or}),"aria-label":"bottom_left handle",x:R(0-k/2),y:R(E-k/2),width:R(k),height:R(k)})]}),op&&m.jsxs(m.Fragment,{children:[m.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:R(0-k/4),y:R(E/2-qo/2),rx:k/4,width:R(k/2),height:R(qo)}),m.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:k/4,x:R(x-k/4),y:R(E/2-qo/2),width:R(k/2),height:R(qo)})]}),N&&m.jsx(hJ,{size:k,width:x,height:E,hideAlternateHandles:Ee})]})})}),Yg=function({cx:n,cy:e,targetSize:t,corner:r,cursor:i,isHidden:o,"data-testid":s}){const a=Fi(r);return m.jsx("rect",{className:ye("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":s,"aria-label":`${r} target`,pointerEvents:"all",x:R(n-t*3),y:R(e-t*3),width:R(Math.max(1,t*3)),height:R(Math.max(1,t*3)),cursor:i,...a})},fJ=Math.sqrt(Math.PI),gJ=function({cx:n,cy:e,size:t,isHidden:r,"data-testid":i}){const o=Fi("mobile_rotate"),s=G(),a=q("zoom level",()=>s.getZoomLevel(),[s]),l=Math.max(14*(1/a),20/Math.max(1,a));return m.jsxs("g",{children:[m.jsx("circle",{"data-testid":i,pointerEvents:"all",className:ye("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:n,cy:e,r:l,...o}),m.jsx("circle",{className:ye("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:n,cy:e,r:t/fJ})]})},cn={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},En={s:2,m:3.5,l:5,xl:10},js={s:18,m:24,l:36,xl:44},wc={s:18,m:22,l:26,xl:32},Rs={s:18,m:20,l:24,xl:28},Ro={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};var f3={exports:{}};(function(n){(function(e,t){n.exports?n.exports=t():e.downscale=t()})(Ge,function(){function e(I,v,b,_,x,E,k,P){var I=document.createElement("canvas");I.width=b,I.height=_;var A=I.getContext("2d");return A.mozImageSmoothingEnabled=!0,A.imageSmoothingQuality="high",A.webkitImageSmoothingEnabled=!0,A.msImageSmoothingEnabled=!0,A.imageSmoothingEnabled=!0,A.drawImage(v,x,E,k,P,0,0,b,_),I}function t(w){return w+.49<<0}function r(w,v,b,_,x,E,k){for(var P=new ImageData(v,b),I=new Int32Array(w.data.buffer),A=w.width,T=new Int32Array(P.data.buffer),O=P.width,F=v/E,H=b/k,D=t(1/F),K=t(1/H),B=D*K,te=0;te<P.height;te++)for(var W=0;W<O;W++){for(var N=_+t(W/F)+(x+t(te/H))*A,Y=0,ee=0,pe=0,ve=0,be=0;be<K;be++)for(var fe=0;fe<D;fe++){var Ee=I[N+fe+be*A];Y+=Ee<<24>>>24,ee+=Ee<<16>>>24,pe+=Ee<<8>>>24,ve+=Ee>>>24}Y=t(Y/B),ee=t(ee/B),pe=t(pe/B),ve=t(ve/B),T[W+te*O]=ve<<24|pe<<16|ee<<8|Y}return P}function i(w,v,b,_){var x=new Date,E={},k=x,P="01";return{mark:w?function(I){I=P+". "+(I||"..."),E[I]={"time (ms)":new Date-k},k=new Date,P=("0"+((P>>0)+1)).substr(-2)}:new Function,finish:w?function(){E[P+" TOTAL"]={"time (ms)":new Date-x},console.log("IMAGE SOURCE:",v),console.log("DOWNSCALE TO:",b+"x"+_),console.table(E)}:new Function}}function o(){var w=[],v=[],b=[],_=new Object;return{createSetter:function(x){if(!this.get(x)){var E=w.push(x)-1;return v.push(_),b.push([]),function(k){v[E]=k,b[E]=b[E].reduce(function(P,I){I(k)},[])}}},get:function(x,E){var k=w.indexOf(x);if(~k){if(v[k]===_){b[k].push(E);return}E(v[k])}},has:function(x){return!!~w.indexOf(x)}}}function s(w,v,b,_){w.width=b,w.height=_;var x=w.getContext("2d");return x.drawImage(v,0,0),x.getImageData(0,0,b,_)}function a(w,v){w.width=v.width,w.height=v.height;var b=w.getContext("2d");return b.putImageData(v,0,0),w}function l(w,v,T,O,x,E){var k=x,P=E,I=x/E;w===0&&(w=v*I>>0),v===0&&(v=w/I>>0);var A=w/v;A>I?E=x/A>>0:x=E*A>>0;var T=T||(k-x)/2>>0,O=O||(P-E)/2>>0;return{destWidth:w,destHeight:v,sourceX:T,sourceY:O,sourceWidth:x,sourceHeight:E}}function c(w,v,b){if(v.returnCanvas){b(w);return}if(v.returnBlob){w.toBlob(b,"image/"+(v.imageType||"jpeg"),v.quality||.85);return}var _=w.toDataURL("image/"+(v.imageType||"jpeg"),v.quality||.85);b(_)}function d(w,v){var b=new XMLHttpRequest;b.open("GET",w),b.responseType="arraybuffer",b.addEventListener("load",function(){v(this.response)}),b.send()}function u(w,v){w.complete?v():w.addEventListener("load",v)}function h(w,v){w.readyState>1?v():w.addEventListener("loadeddata",v)}function p(w){if(w instanceof File)return"File";if(w instanceof HTMLImageElement)return"HTMLImageElement";if(w instanceof HTMLVideoElement)return"HTMLVideoElement";if(typeof w=="string")return"URL"}function g(w){if(w.length<3)return new TypeError("3 arguments required, but only "+w.length+" present.");if(!p(w[0]))return new TypeError("First argument should be HTMLImageElement, HTMLVideoElement, File of String");if(typeof w[1]!="number")return new TypeError("Second argument should be a number");if(typeof w[2]!="number")return new TypeError("Third argument should be a number")}function f(w,v,b,_){var x=i(_&&_.debug||!1,w,v,b),E=g(arguments);if(E instanceof TypeError)return Promise.reject(E);_=_||{};var k,P=new Promise(function(H,D){k=H});f.canvas=f.canvas||document.createElement("canvas"),f.cache=f.cache||o();var I=f.canvas,A=f.cache;if(A.has(w))return x.mark(),A.get(w,function(H){x.mark("PENDING CACHE");var D=H[0],K=H[1],B=l(v,b,_.sourceX,_.sourceY,K.width,K.height);if(B.sourceWidth/B.destWidth>=2&&B.sourceHeight/B.destHeight>=2){x.mark();var te=r(K,B.destWidth,B.destHeight,B.sourceX,B.sourceY,B.sourceWidth,B.sourceHeight);x.mark("DOWNSCALE"),I=a(I,te)}else I=e(I,D,B.destWidth,B.destHeight,B.sourceX,B.sourceY,B.sourceWidth,B.sourceHeight),x.mark("RESIZE WITH CANVAS");c(I,_,function(W){x.mark("PRODUCE RESULT"),k(W),x.finish()})}),P;var T=function(H,D,K){var B=l(v,b,_.sourceX,_.sourceY,D,K);if(B.sourceWidth/B.destWidth>=2&&B.sourceHeight/B.destHeight>=2){x.mark();var te=s(I,H,D,K);x.mark("GET IMAGE DATA");var W=r(te,B.destWidth,B.destHeight,B.sourceX,B.sourceY,B.sourceWidth,B.sourceHeight);x.mark("DOWNSCALE"),I=a(I,W),p(H)!=="HTMLVideoElement"&&A.createSetter(H)([H,te])}else I=e(I,H,B.destWidth,B.destHeight,B.sourceX,B.sourceY,B.sourceWidth,B.sourceHeight),x.mark("RESIZE WITH CANVAS");c(I,_,function(N){x.mark("PRODUCE RESULT"),k(N),x.finish()})},O=window.URL||window.webkitURL;switch(p(w)){case"File":var F=document.createElement("img");x.mark(),F.src=O.createObjectURL(w),x.mark("READ FILE"),u(F,function(){x.mark("LOAD IMAGE"),T(F,F.naturalWidth,F.naturalHeight)});break;case"HTMLImageElement":x.mark(),u(w,function(){x.mark("LOAD IMAGE"),T(w,w.naturalWidth,w.naturalHeight)});break;case"HTMLVideoElement":h(w,function(){T(w,w.videoWidth,w.videoHeight)});break;case"URL":x.mark(),setTimeout(function(){d(w,function(H){x.mark("LOAD ARRAY BUFFER");var D=new Uint8Array(H),K=new Blob([D],{type:"image/jpeg"}),B=document.createElement("img");B.src=O.createObjectURL(K),x.mark(),u(B,function(){x.mark("LOAD IMAGE"),T(B,B.naturalWidth,B.naturalHeight)})})});break}return P}return f})})(f3);var mJ=f3.exports;const yJ=sr(mJ);function wJ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,o,s,a=[],l=!0,c=!1;try{if(o=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(r=o.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(d){c=!0,i=d}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}function g3(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function vr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?g3(Object(t),!0).forEach(function(r){bJ(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):g3(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function bJ(n,e,t){return e=IJ(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function vJ(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function SJ(n,e){if(n==null)return{};var t=vJ(n,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function m3(n,e){return _J(n)||wJ(n,e)||y3(n,e)||EJ()}function Xg(n){return xJ(n)||kJ(n)||y3(n)||CJ()}function xJ(n){if(Array.isArray(n))return J1(n)}function _J(n){if(Array.isArray(n))return n}function kJ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function y3(n,e){if(n){if(typeof n=="string")return J1(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return J1(n,e)}}function J1(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function CJ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PJ(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function IJ(n){var e=PJ(n,"string");return typeof e=="symbol"?e:String(e)}function Uu(n){var e=n.sizes.shift(),t=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),i=[t-1,r-1,1,1],o=Date.now(),s=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,l;s?(a=new OffscreenCanvas(1,1),l=new OffscreenCanvas(t,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,l=document.createElement("canvas"),l.width=t,l.height=r);var c=a.getContext("2d"),d=l.getContext("2d");d&&(d.fillRect.apply(d,i),c.drawImage(l,t-1,r-1,1,1,0,0,1,1));var u=c&&c.getImageData(0,0,1,1).data[3]!==0,h=Date.now()-o;return[a,l].forEach(function(p){p.height=0,p.width=0}),s?(postMessage({width:t,height:r,benchmark:h,isTestPass:u}),!u&&n.sizes.length&&Uu(n)):u?n.onSuccess(t,r,h):(n.onError(t,r,h),n.sizes.length&&Uu(n)),u}var Z1={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},MJ=["onError","onSuccess"],bc={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Vu={};function Q1(n){var e=n.width===n.height,t=n.height===1,r=n.width===1,i=[];if(!n.width||!n.height)n.sizes.forEach(function(d){var u=e||t?d:1,h=e||r?d:1;i.push([u,h])});else for(var o=n.min||bc.min,s=n.step||bc.step,a=Math.max(n.width,n.height);a>=o;){var l=e||t?a:1,c=e||r?a:1;i.push([l,c]),a-=s}return i}function qg(n){var e=window&&"HTMLCanvasElement"in window,t=window&&"OffscreenCanvas"in window,r=Date.now(),i=n.onError,o=n.onSuccess,s=SJ(n,MJ),a=null;if(!e)return!1;if(n.useWorker&&t){var l=`
            var canvasTest = `.concat(Uu.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),c=new Blob([l],{type:"application/javascript"}),d=URL.createObjectURL(c);a=new Worker(d),URL.revokeObjectURL(d),a.onmessage=function(u){var h=u.data,p=h.width,g=h.height,f=h.benchmark,w=h.isTestPass;w?(Vu[r].onSuccess(p,g,f),delete Vu[r]):Vu[r].onError(p,g,f)}}if(n.usePromise)return new Promise(function(u,h){var p=vr(vr({},n),{},{onError:function(w,v,b){var _;if(n.sizes.length===0)_=!0;else{var x=n.sizes.slice(-1),E=m3(x,1),k=m3(E[0],2),P=k[0],I=k[1];_=w===P&&v===I}i(w,v,b),_&&h({width:w,height:v,benchmark:b})},onSuccess:function(w,v,b){o(w,v,b),u({width:w,height:v,benchmark:b})}});if(a){var g=p.onError,f=p.onSuccess;Vu[r]={onError:g,onSuccess:f},a.postMessage(s)}else Uu(p)});if(a)Vu[r]={onError:i,onSuccess:o},a.postMessage(s);else return Uu(n)}var eS={maxArea:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Q1({width:n.max,height:n.max,min:n.min,step:n.step,sizes:Xg(Z1.area)}),t=vr(vr(vr({},bc),n),{},{sizes:e});return qg(t)},maxHeight:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Q1({width:1,height:n.max,min:n.min,step:n.step,sizes:Xg(Z1.height)}),t=vr(vr(vr({},bc),n),{},{sizes:e});return qg(t)},maxWidth:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Q1({width:n.max,height:1,min:n.min,step:n.step,sizes:Xg(Z1.width)}),t=vr(vr(vr({},bc),n),{},{sizes:e});return qg(t)},test:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=vr(vr({},bc),n);return e.sizes=Xg(e.sizes),e.width&&e.height&&(e.sizes=[[e.width,e.height]]),qg(e)}};let tS=null;function w3(){return tS||(tS=AJ()),tS}async function AJ(){const n=await eS.maxWidth({usePromise:!0}),e=await eS.maxHeight({usePromise:!0}),t=await eS.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:e.height,maxArea:t.width*t.height}}function b3(n,e){let t=0;for(;n[e+t];)t+=n[e+t]+1;return t+1}function TJ(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function jJ(n){const e=new Uint8Array(n);let t,r,i=0,o=0;if(!TJ(n))return!1;for(t=e[10]&128,r=e[10]&7,i+=6,i+=7,i+=t?3*Math.pow(2,r+1):0;o<2&&i<e.length;)switch(e[i]){case 44:o+=1,t=e[i+9]&128,r=e[i+9]&7,i+=10,i+=t?3*Math.pow(2,r+1):0,i+=b3(e,i+1)+1;break;case 33:i+=2,i+=b3(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return o>1}function RJ(n,e){const t=n.w/e.w,r=n.h/e.h;return t<=1&&r<=1?n:t>r?{w:n.w/t,h:n.h/t}:{w:n.w/r,h:n.h/r}}async function DJ(n,e,t,r={}){let i=e*2,o=t*2;const{type:s="image/jpeg",quality:a=.92}=r,l=await w3(),c=e/t;if(i>l.maxWidth&&(i=l.maxWidth,o=i/c),o>l.maxHeight&&(o=l.maxHeight,i=o*c),i*o>l.maxArea){const d=Math.sqrt(l.maxArea/(i*o));i*=d,o*=d}return await yJ(n,i,o,{imageType:s.replace("image/",""),quality:a})}async function OJ(n){return await new Promise((e,t)=>{const r=new FileReader;r.onerror=()=>t(r.error),r.onload=()=>{e(r.result?jJ(r.result):!1)},r.readAsArrayBuffer(n)})}function LJ(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function zJ(n){const e=new URL(n).host.replace("www.","");for(const t of Wl)if(v3(t.hostnames,e)){const r=t.fromEmbedUrl(n);if(r)return{definition:t,url:r,embedUrl:n}}}const NJ=n=>n.split("*").map(e=>LJ(e)).join(".+"),v3=(n,e)=>!!n.find(t=>{const r=new RegExp(NJ(t));return e.match(r)});function FJ(n){const e=new URL(n).host.replace("www.","");for(const t of Wl)if(v3(t.hostnames,e)){const r=t.toEmbedUrl(n);if(r)return{definition:t,embedUrl:r,url:n}}}function S3(n){return FJ(n)??zJ(n)}function Do(n){try{return S3(n)}catch(e){console.error(e)}}const vc="  ",Vn=class Vn{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const r=e.ownerDocument,i=r.activeElement;i!==e&&e.focus(),r.execCommand("insertText",!1,t)||Vn.insertTextFirefox(e,t),i===r.body?e.blur():i instanceof HTMLElement&&i!==e&&i.focus()}static set(e,t){e.select(),Vn.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:r}=e;return e.value.slice(t||void 0,r||void 0)}static wrapSelection(e,t,r){const{selectionStart:i,selectionEnd:o}=e,s=Vn.getSelection(e);Vn.insert(e,t+s+(r??t)),e.selectionStart=(i||0)+t.length,e.selectionEnd=(o||0)+t.length}static replace(e,t,r){let i=0;e.value.replace(t,(...o)=>{const s=i+o[o.length-2],a=o[0].length;e.selectionStart=s,e.selectionEnd=s+a;const l=typeof r=="string"?r:r(...o);return Vn.insert(e,l),e.selectionStart=s,i+=l.length-a,l})}static findLineEnd(e,t){const r=e.lastIndexOf(`
`,t-1)+1;return e.charAt(r)!=="	"?t:r+1}static indent(e){var a;const{selectionStart:t,selectionEnd:r,value:i}=e,o=i.slice(t,r),s=(a=/\n/g.exec(o))==null?void 0:a.length;if(s&&s>0){const l=i.lastIndexOf(`
`,t-1)+1,c=e.value.slice(l,r-1),d=c.replace(/^|\n/g,`$&${vc}`),u=d.length-c.length;e.setSelectionRange(l,r-1),Vn.insert(e,d),e.setSelectionRange(t+1,r+u)}else Vn.insert(e,vc)}static unindent(e){const{selectionStart:t,selectionEnd:r,value:i}=e,o=i.lastIndexOf(`
`,t-1)+1,s=Vn.findLineEnd(i,r),a=e.value.slice(o,s),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=a.length-l.length;e.setSelectionRange(o,s),Vn.insert(e,l);const d=/\t| {1,2}/.exec(i.slice(o,t)),u=d?d[0].length:0,h=t-u;e.setSelectionRange(t-u,Math.max(h,r-c))}static indentCE(e){var l;const t=window.getSelection(),r=e.innerText,i=Jg(e)??0,o=Jg(e)??0,s=r.slice(i,o),a=(l=/\n/g.exec(s))==null?void 0:l.length;if(a&&a>0){const c=r.lastIndexOf(`
`,i-1)+1,d=r.slice(c,o-1),u=d.replace(/^|\n/g,`$&${vc}`).length-d.length;t&&t.setBaseAndExtent(e,i+1,e,o+u)}else{const c=window.getSelection();e.innerText=r.slice(0,i)+vc+r.slice(i),c==null||c.setBaseAndExtent(e,i+1,e,i+2)}}static unindentCE(e){const t=window.getSelection(),r=e.innerText,i=Jg(e)??0,o=Jg(e)??0,s=r.lastIndexOf(`
`,i-1)+1,a=Vn.findLineEnd(r,o),l=r.slice(s,a),c=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=l.length-c.length;if(t){t.setBaseAndExtent(e,s,e,a);const u=/\t| {1,2}/.exec(r.slice(s,i)),h=u?u[0].length:0,p=i-h;t.setBaseAndExtent(e,i-h,e,Math.max(p,o-d))}}static normalizeText(e){return e.replace(Vn.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(Vn.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}};y(Vn,"fixNewLines",/\r?\n|\r/g);let Ds=Vn;function Jg(n){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let t=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(n),i.setEnd(r.endContainer,r.endOffset),t=i.toString().length}return t}const $J=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function BJ(n){return $J.test(n)}function UJ(n){return n.replace(/\t/g,vc)}function VJ(n){const e=n.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const r of e)if(r.trim().length>0){const i=r.length-r.trimStart().length;t=Math.min(t,i)}return e.map(r=>r.slice(t)).join(`
`)}function HJ(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function WJ(n){return HJ(VJ(UJ(n)))}const Hu=(n,e)=>n.length<=e?n:n.substring(0,e-3)+"...";function KJ(n,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i}){n.registerExternalAssetHandler("file",async({file:o})=>await new Promise((s,a)=>{!r.includes(o.type)&&!i.includes(o.type)&&(console.warn(`File type not allowed: ${o.type}`),a()),o.size>t&&(console.warn(`File size too big: ${(o.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`),a());const l=new FileReader;l.onerror=()=>a(l.error),l.onload=async()=>{let c=l.result;o.type==="video/quicktime"&&c.includes("video/quicktime")&&(c=c.replace("video/quicktime","video/mp4"));const d=r.includes(o.type);let u,h;if(d?(u=await BP.getImageSizeFromSrc(c),h=o.type==="image/gif"&&await OJ(o)):(h=!0,u=await BP.getVideoSizeFromSrc(c)),isFinite(e)){const f=RJ(u,{w:e,h:e});u!==f&&(o.type==="image/jpeg"||o.type==="image/png")&&(u=f)}(o.type==="image/jpeg"||o.type==="image/png")&&(c=await DJ(c,u.w,u.h,{type:o.type,quality:.92}));const p=Sa.createId(Tf(c)),g=Sa.create({id:p,type:d?"image":"video",typeName:"asset",props:{name:o.name,src:c,w:u.w,h:u.h,mimeType:o.type,isAnimated:h}});s(g)},l.readAsDataURL(o)})),n.registerExternalAssetHandler("url",async({url:o})=>{var a,l,c;let s;try{const d=await(await fetch(o,{method:"GET",mode:"no-cors"})).text(),u=new DOMParser().parseFromString(d,"text/html");s={image:((a=u.head.querySelector('meta[property="og:image"]'))==null?void 0:a.getAttribute("content"))??"",title:((l=u.head.querySelector('meta[property="og:title"]'))==null?void 0:l.getAttribute("content"))??Hu(o,32),description:((c=u.head.querySelector('meta[property="og:description"]'))==null?void 0:c.getAttribute("content"))??""}}catch(d){console.error(d),s={image:"",title:Hu(o,32),description:""}}return{id:Sa.createId(Tf(o)),typeName:"asset",type:"bookmark",props:{src:o,description:s.description,image:s.image,title:s.title},meta:{}}}),n.registerExternalContentHandler("svg-text",async({point:o,text:s})=>{const a=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),l=new DOMParser().parseFromString(s,"image/svg+xml").querySelector("svg");if(!l)throw new Error("No <svg/> element present");let c=parseFloat(l.getAttribute("width")||"0"),d=parseFloat(l.getAttribute("height")||"0");if(!(c&&d)){document.body.appendChild(l);const h=l.getBoundingClientRect();document.body.removeChild(l),c=h.width,d=h.height}const u=await n.getAssetForExternalContent({type:"file",file:new File([s],"asset.svg",{type:"image/svg+xml"})});if(!u)throw Error("Could not create an asset");x3(n,[u],a)}),n.registerExternalContentHandler("embed",({point:o,url:s,embed:a})=>{const l=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),{width:c,height:d}=a,u=ot(),h={id:u,type:"embed",x:l.x-(c||450)/2,y:l.y-(d||450)/2,props:{w:c,h:d,url:s}};n.createShapes([h]).select(u)}),n.registerExternalContentHandler("files",async({point:o,files:s})=>{const a=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),l=new C(a.x,a.y),c=[];await Promise.all(s.map(async(d,u)=>{if(d.size>t)return console.warn(`File size too big: ${(d.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`),null;if(!d.type)throw new Error("No mime type");if(!r.concat(i).includes(d.type))return console.warn(`${d.name} not loaded - Extension not allowed.`),null;try{const h=await n.getAssetForExternalContent({type:"file",file:d});if(!h)throw Error("Could not create an asset");c[u]=h}catch(h){return console.error(h),null}})),x3(n,me(c),l)}),n.registerExternalContentHandler("text",async({point:o,text:s})=>{const a=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),l=n.getShapeUtil("text").getDefaultProps(),c=WJ(s);let d,u,h,p="middle";const g=c.split(`
`).length>1,f=BJ(c);g&&(p=g?f?"end":"start":"middle");const w=n.textMeasure.measureText(c,{...cn,fontFamily:Ro[l.font],fontSize:js[l.size],maxWidth:null}),v=Math.min(g?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(w.w>v){const b=n.textMeasure.measureText(c,{...cn,fontFamily:Ro[l.font],fontSize:js[l.size],maxWidth:v});d=b.w,u=b.h,h=!1,p=f?"end":"start"}else d=w.w,u=w.h,h=!0;a.y-u/2<n.getViewportPageBounds().minY+40&&(a.y=n.getViewportPageBounds().minY+40+u/2),n.createShapes([{id:ot(),type:"text",x:a.x-d/2,y:a.y-u/2,props:{text:c,align:p,autoSize:h,w:d}}])}),n.registerExternalContentHandler("url",async({point:o,url:s})=>{const a=Do(s);if(a)return n.putExternalContent({type:"embed",url:a.url,point:o,embed:a.definition});const l=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),c=Sa.createId(Tf(s)),d=GJ(n,s,l);let u=n.getAsset(c),h=!1;if(!u){h=!0;const p=await n.getAssetForExternalContent({type:"url",url:s});if(!p)throw Error("Could not create an asset");u=p}n.batch(()=>{h&&n.createAssets([u]),n.updateShapes([{id:d.id,type:d.type,props:{assetId:u.id}}])})})}async function x3(n,e,t){if(!e.length)return[];const r=C.From(t),i=[];for(const o of e)switch(o.type){case"bookmark":{i.push({id:ot(),type:"bookmark",x:r.x-150,y:r.y-160,opacity:1,props:{assetId:o.id,url:o.props.src}}),r.x+=300;break}case"image":{i.push({id:ot(),type:"image",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break}case"video":i.push({id:ot(),type:"video",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}return n.batch(()=>{const o=e.filter(s=>!n.getAsset(s.id));o.length&&n.createAssets(o),n.createShapes(i).select(...i.map(s=>s.id)),_3(n,t)}),i.map(o=>o.id)}function _3(n,e){const t=n.getViewportPageBounds();let r=n.getSelectionPageBounds();if(r){const i=r.center.sub(e);n.updateShapes(n.getSelectedShapes().map(o=>{const s=n.getShapeParentTransform(o).decompose().rotation,a=C.Rot(i,-s);return{id:o.id,type:o.type,x:o.x-a.x,y:o.y-a.y}}))}r=n.getSelectionPageBounds(),r&&!t.contains(r)&&n.zoomToSelection()}function GJ(n,e,t){const r={id:ot(),type:"bookmark",x:t.x-150,y:t.y-160,opacity:1,props:{assetId:null,url:e}};return n.batch(()=>{n.createShapes([r]).select(r.id),_3(n,t)}),n.getShape(r.id)}let YJ=(Ck=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")});y(this,"onKeyUp",e=>{var t;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}})}},y(Ck,"id","idle"),Ck),XJ=(Ek=class extends ae{constructor(){super(...arguments);y(this,"shape");y(this,"markId","");y(this,"onEnter",()=>{this.didTimeout=!1;const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:t=>!t.isLocked&&this.editor.getShapeUtil(t).canBind(t),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()});y(this,"onExit",()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()});y(this,"onPointerMove",()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:this.editor.getShapeHandles(this.shape).find(e=>e.id==="end"),isCreating:!0,onInteractionEnd:"arrow"})}});y(this,"onPointerUp",()=>{this.cancel()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()});y(this,"preciseTimeout",-1);y(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var c,d;const{originPagePoint:e}=this.editor.inputs,t=ot();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"arrow",x:e.x,y:e.y}]);const r=this.editor.getShape(t);if(!r)throw Error("expected shape");const i=this.editor.getShapeHandles(r);if(!i)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),s=this.shape,a=i.find(u=>u.id==="start"),l=(c=o.onHandleChange)==null?void 0:c.call(o,r,{handle:{...a,x:0,y:0},isPrecise:!0,initial:s});if(l){const u=(d=l.props)==null?void 0:d.start;(u==null?void 0:u.type)==="binding"&&this.editor.setHintingShapes([u.boundShapeId]),this.editor.updateShapes([l],{squashing:!0})}this.shape=this.editor.getShape(t),this.editor.select(t)}updateArrowShapeEndHandle(){var i,o,s;const e=this.shape;if(!e)throw Error("expected shape");const t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");const r={...e,props:{...e.props,end:{...e.props.end,x:0,y:0}}};{const a=this.editor.getShapeUtil("arrow"),l=this.shape,c=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),d=t.find(h=>h.id==="end"),u=(i=a.onHandleChange)==null?void 0:i.call(a,r,{handle:{...d,x:c.x,y:c.y},isPrecise:!1,initial:l});if(u){const h=(o=u.props)==null?void 0:o.end;(h==null?void 0:h.type)==="binding"&&this.editor.setHintingShapes([h.boundShapeId]),this.editor.updateShapes([u],{squashing:!0})}}{const a=this.editor.getShapeUtil("arrow"),l=this.shape,c=t.find(u=>u.id==="start"),d=(s=a.onHandleChange)==null?void 0:s.call(a,r,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:l});d&&this.editor.updateShapes([d],{squashing:!0})}this.shape=this.editor.getShape(e.id)}startPreciseTimeout(){this.preciseTimeout=window.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},y(Ek,"id","pointing"),Ek);class Zg extends ae{constructor(){super(...arguments);y(this,"shapeType","arrow")}}y(Zg,"id","arrow"),y(Zg,"initial","idle"),y(Zg,"children",()=>[YJ,XJ]);class nS extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"initialShape");y(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");y(this,"util",this.editor.getShapeUtil(this.shapeType));y(this,"isPen",!1);y(this,"segmentMode","free");y(this,"didJustShiftClickToExtendPreviousShapeLine",!1);y(this,"pagePointWhereCurrentSegmentChanged",{});y(this,"pagePointWhereNextSegmentChanged",null);y(this,"lastRecordedPoint",{});y(this,"mergeNextPoint",!1);y(this,"currentLineLength",0);y(this,"canDraw",!1);y(this,"markId",null);y(this,"onEnter",t=>{this.markId=null,this.info=t,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()});y(this,"onPointerMove",()=>{const{editor:{inputs:t}}=this;if(this.isPen!==t.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&t.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(t.isPen?C.Dist(t.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=t.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateShapes())});y(this,"onKeyDown",t=>{if(t.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateShapes()});y(this,"onKeyUp",t=>{if(t.key==="Shift")switch(this.editor.snaps.clear(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateShapes()});y(this,"onExit",()=>{this.editor.snaps.clear(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())})}canClose(){return this.shapeType!=="highlight"}getIsClosed(t,r){if(!this.canClose())return!1;const i=En[r],o=t[0].points[0],s=t[t.length-1],a=s.points[s.points.length-1];return o!==a&&this.currentLineLength>i*4&&C.Dist(o,a)<i*2}startShape(){const{inputs:{originPagePoint:t,isPen:r}}=this.editor;this.markId="draw start "+et(),this.editor.mark(this.markId),this.isPen=r;const i=this.isPen?this.info.point.z*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=t.clone(),this.initialShape){const s=this.editor.getShape(this.initialShape.id);if(s&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const a=Xn(s.props.segments);if(!a)throw Error("Expected a previous segment!");const l=Xn(a.points);if(!l)throw Error("Expected a previous point!");const{x:c,y:d}=this.editor.getPointInShapeSpace(s,t).toFixed(),u=this.isPen?this.info.point.z*1.25:.5,h={type:this.segmentMode,points:[{x:l.x,y:l.y,z:+u.toFixed(2)},{x:c,y:d,z:+u.toFixed(2)}]},p=oe.applyToPoint(this.editor.getShapePageTransform(s.id),l);this.pagePointWhereCurrentSegmentChanged=p,this.pagePointWhereNextSegmentChanged=null;const g=[...s.props.segments,h];this.currentLineLength=this.getLineLength(g);const f={id:s.id,type:this.shapeType,props:{segments:g}};this.canClose()&&(f.props.isClosed=this.getIsClosed(g,s.props.size)),this.editor.updateShapes([f]);return}}this.pagePointWhereCurrentSegmentChanged=t.clone();const o=ot();this.editor.createShapes([{id:o,type:this.shapeType,x:t.x,y:t.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+i.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateShapes(){const{inputs:t}=this.editor,{initialShape:r}=this;if(!r)return;const{id:i,props:{size:o}}=r,s=this.editor.getShape(i);if(!s)return;const{segments:a}=s.props,{x:l,y:c,z:d}=this.editor.getPointInShapeSpace(s,t.currentPagePoint).toFixed(),u={x:l,y:c,z:this.isPen?+(d*1.25).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:h}=this;if(h===null)throw Error("We should have a point where the segment changed");if(C.Dist(h,t.currentPagePoint)>Su){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const p=Xn(a);if(!p)throw Error("Expected a previous segment!");const g=Xn(p.points);if(!g)throw Error("Expected a previous last point!");let f;const w=this.editor.getPointInShapeSpace(s,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(p.type==="straight"){this.currentLineLength+=C.Dist(g,w),f={type:"straight",points:[{...g},w]};const b=this.editor.getShapePageTransform(s);this.pagePointWhereCurrentSegmentChanged=oe.applyToPoint(b,g)}else f={type:"straight",points:[w,u]};const v={id:i,type:this.shapeType,props:{segments:[...a,f]}};this.canClose()&&(v.props.isClosed=this.getIsClosed(a,o)),this.editor.updateShapes([v],{squashing:!0})}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:h}=this;if(h===null)throw Error("We should have a point where the segment changed");if(C.Dist(h,t.currentPagePoint)>Su){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const p=a.slice(),g=p[p.length-1],f=Xn(g.points);if(!f)throw Error("No previous point!");const w={type:"free",points:[...C.PointsBetween(f,u,6).map(_=>_.toFixed().toJson())]},v=[...p,w];this.currentLineLength=this.getLineLength(v);const b={id:i,type:this.shapeType,props:{segments:v}};this.canClose()&&(b.props.isClosed=this.getIsClosed(v,o)),this.editor.updateShapes([b],{squashing:!0})}break}case"straight":{const h=a.slice(),p=h[h.length-1],{pagePointWhereCurrentSegmentChanged:g}=this,{currentPagePoint:f,ctrlKey:w}=this.editor.inputs;if(!g)throw Error("We should have a point where the segment changed");let v,b=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(b=!w,this.didJustShiftClickToExtendPreviousShapeLine=!1):b=!w;let _=this.editor.getPointInShapeSpace(s,f).toFixed().toJson(),x=!1,E;if((this.editor.user.getIsSnapMode()?!w:w)&&h.length>2){let P,I=8/this.editor.getZoomLevel();for(let A=0,T=a.length-2;A<T;A++){const O=a[A];if(!O)break;if(O.type==="free")continue;const F=O.points[0],H=Xn(O.points);if(!(F&&H))continue;const D=C.NearestPointOnLineSegment(F,H,_),K=C.Dist(D,_);if(K<I){P=D.toFixed().toJson(),I=K,E=O;break}}P&&(x=!0,_=P)}if(x&&E){const P=this.editor.getShapePageTransform(s),I=E.points[0],A=Xn(E.points);if(!A)throw Error("Expected a last point!");const T=oe.applyToPoint(P,I),O=oe.applyToPoint(P,A),F=oe.applyToPoint(P,_);this.editor.snaps.setLines([{id:et(),type:"points",points:[T,F,O]}])}else{if(this.editor.snaps.clear(),b){const P=C.Angle(g,f),I=Qf(P,24)-P;v=C.RotWith(f,g,I)}else v=f;_=this.editor.getPointInShapeSpace(s,v).toFixed().toJson()}this.currentLineLength+=C.Dist(p.points[0],_),h[h.length-1]={...p,type:"straight",points:[p.points[0],_]};const k={id:i,type:this.shapeType,props:{segments:h}};this.canClose()&&(k.props.isClosed=this.getIsClosed(a,o)),this.editor.updateShapes([k],{squashing:!0});break}case"free":{const h=a.slice(),p=h[h.length-1],g=[...p.points];if(g.length&&this.mergeNextPoint){const{z:w}=g[g.length-1];g[g.length-1]={x:u.x,y:u.y,z:w?Math.max(w,u.z):u.z}}else this.currentLineLength+=C.Dist(g[g.length-1],u),g.push(u);h[h.length-1]={...p,points:g},this.currentLineLength=this.getLineLength(h);const f={id:i,type:this.shapeType,props:{segments:h}};if(this.canClose()&&(f.props.isClosed=this.getIsClosed(h,o)),this.editor.updateShapes([f],{squashing:!0}),g.length>500){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const{currentPagePoint:w}=this.editor.inputs,v=ot();this.editor.createShapes([{id:v,type:this.shapeType,x:eg(w.x),y:eg(w.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(d*1.25).toFixed():.5}]}]}}]),this.initialShape=structuredClone(this.editor.getShape(v)),this.mergeNextPoint=!1,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(t){let r=0;for(const i of t)for(let o=0;o<i.points.length-1;o++){const s=i.points[o],a=i.points[o+1];r+=C.Sub(a,s).len2()}return Math.sqrt(r)}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:t}=this;t&&(this.editor.updateShapes([{id:t.id,type:t.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}y(nS,"id","drawing");let k3=(Pk=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("drawing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(Pk,"id","idle"),Pk);class Qg extends ae{constructor(){super(...arguments);y(this,"shapeType","draw");y(this,"onExit",()=>{const t=this.children.drawing;t.initialShape=void 0})}}y(Qg,"id","draw"),y(Qg,"initial","idle"),y(Qg,"children",()=>[k3,nS]);class rS extends Pg{constructor(){super(...arguments);y(this,"shapeType","frame");y(this,"onCreate",t=>{if(!t)return;const r=this.editor.getShapePageBounds(t),i=[],o=this.editor.getShapeAncestors(t).map(s=>s.id);this.editor.getCurrentPageShapes().map(s=>{if(s.id===t.id||s.isLocked)return;const a=this.editor.getShapePageBounds(s);a&&r.contains(a)&&qJ(s,o,t)&&i.push(s.id)}),this.editor.reparentShapes(i,t.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")})}}y(rS,"id","frame"),y(rS,"initial","idle");function qJ(n,e,t){return e.includes(n.id)?!1:n.parentId===t.parentId}let JJ=(Ik=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onKeyUp",e=>{var t;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(Ik,"id","idle"),Ik),ZJ=(Mk=class extends ae{constructor(){super(...arguments);y(this,"markId","");y(this,"onPointerUp",()=>{this.complete()});y(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=ot();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"geo",x:t.x,y:t.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Oi)}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:e}=this.editor.inputs,t=ot();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(Oi),w:1,h:1}}]);const r=this.editor.getShape(t);if(!r)return;const i=r.props.geo==="star"?new de(0,0,200,190):r.props.geo==="cloud"?new de(0,0,300,180):new de(0,0,200,200),o=i.center,s=this.editor.getShapeParentTransform(r);s&&o.rot(-s.rotation()),this.editor.select(t),this.editor.updateShapes([{id:r.id,type:"geo",x:r.x-o.x,y:r.y-o.y,props:{geo:this.editor.getStyleForNextShape(Oi),w:i.width,h:i.height}}]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},y(Mk,"id","pointing"),Mk);class em extends ae{constructor(){super(...arguments);y(this,"shapeType","geo")}}y(em,"id","geo"),y(em,"initial","idle"),y(em,"children",()=>[JJ,ZJ]);class tm extends ae{constructor(){super(...arguments);y(this,"shapeType","highlight");y(this,"onExit",()=>{const t=this.children.drawing;t.initialShape=void 0})}}y(tm,"id","highlight"),y(tm,"initial","idle"),y(tm,"children",()=>[k3,nS]);let QJ=(Ak=class extends ae{constructor(){super(...arguments);y(this,"shapeId","");y(this,"onEnter",e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})});y(this,"onPointerDown",()=>{this.parent.transition("pointing",{shapeId:this.shapeId})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(Ak,"id","idle"),Ak);const C3=2;let eZ=(Tk=class extends ae{constructor(){super(...arguments);y(this,"shape",{});y(this,"markId");y(this,"onEnter",e=>{const{inputs:t}=this.editor,{currentPagePoint:r}=t;this.markId=void 0;const i=e.shapeId&&this.editor.getShape(e.shapeId);if(i&&t.shiftKey){this.markId=`creating:${i.id}`,this.editor.mark(this.markId),this.shape=i;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const s=o.filter(f=>f.type==="vertex").sort(Cn),a=s[s.length-1],l=s[s.length-2],c=oe.applyToPoint(this.editor.getShapeParentTransform(this.shape),new C(this.shape.x,this.shape.y));let d,u,h;const p=C.Sub(r,c);C.Dist(a,l)<C3||C.Dist(p,a)<C3?(d=a.index,u=a.id,h={...a,x:p.x+.1,y:p.y+.1}):(d=Io(a.index),u="handle:"+d,h={id:u,type:"vertex",index:d,x:p.x+.1,y:p.y+.1,canBind:!1});const g=Ss(this.shape.props.handles);g[h.id]=h,this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{handles:g}}])}else{const o=ot();this.markId=`creating:${o}`,this.editor.mark(this.markId),this.editor.createShapes([{id:o,type:"line",x:r.x,y:r.y}]),this.editor.select(o),this.shape=this.editor.getShape(o)}});y(this,"onPointerMove",()=>{if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const t=Xn(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clear()})}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}},y(Tk,"id","pointing"),Tk);class nm extends ae{constructor(){super(...arguments);y(this,"shapeType","line")}}y(nm,"id","line"),y(nm,"initial","idle"),y(nm,"children",()=>[QJ,eZ]);let tZ=(jk=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(jk,"id","idle"),jk),nZ=(Rk=class extends ae{constructor(){super(...arguments);y(this,"dragged",!1);y(this,"info",{});y(this,"wasFocusedOnEnter",!1);y(this,"markId","");y(this,"shape",{});y(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen(),this.wasFocusedOnEnter&&(this.shape=this.createShape())});y(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&(this.wasFocusedOnEnter||(this.shape=this.createShape()),this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}}))});y(this,"onPointerUp",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()})}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}createShape(){const{inputs:{originPagePoint:e}}=this.editor,t=ot();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"note",x:e.x,y:e.y}]).select(t);const r=this.editor.getShape(t),i=this.editor.getShapeGeometry(r).bounds;return this.editor.updateShapes([{id:t,type:"note",x:r.x-i.width/2,y:r.y-i.height/2}]),this.editor.getShape(t)}},y(Rk,"id","pointing"),Rk);class rm extends ae{constructor(){super(...arguments);y(this,"shapeType","note")}}y(rm,"id","note"),y(rm,"initial","idle"),y(rm,"children",()=>[tZ,nZ]);function Wu(n){const e=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:li/n.getZoomLevel(),renderingOnly:!0});if(!e)return n.setHoveredShape(null);let t;const r=n.getOutermostSelectableShape(e);return r===e||r.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(r.id)?t=e:t=r,n.setHoveredShape(t.id)}let rZ=(Dk=class extends ae{constructor(){super(...arguments);y(this,"onPointerMove",e=>{switch(e.target){case"shape":case"canvas":Wu(this.editor)}});y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onKeyDown",e=>{var t;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(Dk,"id","idle"),Dk),iZ=(Ok=class extends ae{constructor(){super(...arguments);y(this,"shape");y(this,"markId","");y(this,"onExit",()=>{this.editor.setHintingShapes([])});y(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:t}}=this.editor,r=ot();if(this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"text",x:t.x,y:t.y,props:{text:"",autoSize:!1,w:20}}]),this.editor.select(r),this.shape=this.editor.getShape(r),!this.shape)return;const{shape:i}=this;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(i.id),this.editor.setCurrentTool("select.editing_shape")}})}});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.cancel()});y(this,"onCancel",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){var i;this.editor.mark("creating text shape");const e=ot(),{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:e,type:"text",x:t,y:r,props:{text:"",autoSize:!0}}]).select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),(i=this.editor.root.getCurrent())==null||i.transition("editing_shape")}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}},y(Ok,"id","pointing"),Ok);class im extends ae{constructor(){super(...arguments);y(this,"shapeType","text")}}y(im,"id","text"),y(im,"initial","idle"),y(im,"children",()=>[rZ,iZ]);const oZ=[im,Qg,em,rm,nm,rS,Zg,tm];function Xt(){return Qn({isDarkMode:xg()})}const Dt=re.memo(function({theme:n,d:e,color:t,fill:r}){switch(r){case"none":return null;case"solid":return m.jsx("path",{fill:n[t].semi,d:e});case"semi":return m.jsx("path",{fill:n.solid,d:e});case"pattern":return m.jsx(sZ,{theme:n,color:t,fill:r,d:e})}}),sZ=function({d:n,color:e,theme:t}){const r=G(),i=q("zoomLevel",()=>r.getZoomLevel(),[r]),o=Math.ceil(i),s=r.getZoomLevel()<=.18;return m.jsxs(m.Fragment,{children:[m.jsx("path",{fill:t[e].pattern,d:n}),m.jsx("path",{fill:s?t[e].semi:`url(#${rg[`${o}_${t.id}`]})`,d:n})]})};function Sr({d:n,color:e,fill:t,theme:r}){if(t==="none")return;if(t==="pattern"){const o=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",n),s.setAttribute("fill",r[e].pattern);const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",n),a.setAttribute("fill","url(#hash_pattern)"),o.appendChild(s),o.appendChild(a),o}const i=document.createElementNS("http://www.w3.org/2000/svg","path");switch(i.setAttribute("d",n),t){case"semi":{i.setAttribute("fill",r.solid);break}case"solid":{i.setAttribute("fill",r[e].semi);break}}return i}function pi(n,e){if(e){const t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.appendChild(e),t.appendChild(n),t}else return n}function aZ(n){return n.replace(/\s/g,"\xA0")}function om(n,e,t){const{padding:r=0}=t,i=document.createElementNS("http://www.w3.org/2000/svg","text");if(i.setAttribute("font-size",t.fontSize+"px"),i.setAttribute("font-family",t.fontFamily),i.setAttribute("font-style",t.fontStyle),i.setAttribute("font-weight",t.fontWeight),i.setAttribute("line-height",t.lineHeight*t.fontSize+"px"),i.setAttribute("dominant-baseline","mathematical"),i.setAttribute("alignment-baseline","mathematical"),e.length===0)return i;const o=de.From(e[0].box);for(const{box:c}of e)o.union(c);const s=r+(t.offsetX??0),a=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?r:t.verticalTextAlign==="end"?t.height-r-o.height:(Math.ceil(t.height)-o.height)/2);let l=null;for(const{text:c,box:d}of e){if(l!==null&&d.y>l){const p=document.createElementNS("http://www.w3.org/2000/svg","tspan");p.setAttribute("alignment-baseline","mathematical"),p.setAttribute("x",s+"px"),p.setAttribute("y",d.y+a+"px"),p.textContent=`
`,i.appendChild(p)}const u=document.createElementNS("http://www.w3.org/2000/svg","tspan");u.setAttribute("alignment-baseline","mathematical"),u.setAttribute("x",d.x+s+"px"),u.setAttribute("y",d.y+a+"px");const h=aZ(c);u.textContent=h,i.appendChild(u),l=d.y}return t.stroke&&t.strokeWidth&&(i.setAttribute("stroke",t.stroke),i.setAttribute("stroke-width",t.strokeWidth+"px")),t.fill&&i.setAttribute("fill",t.fill),i}function sm(n){return{key:`${Ri.id}:${n}`,getElement:async()=>{const e=lZ(n);if(!e)return null;const t=e.$$_url,r=e.$$_fontface;if(!t||!r)return null;const i=await(await fetch(t)).blob(),o=await new Promise((l,c)=>{const d=new FileReader;d.onload=()=>l(d.result),d.onerror=c,d.readAsDataURL(i)}),s=r.replace(t,o),a=document.createElementNS("http://www.w3.org/2000/svg","style");return a.textContent=s,a}}}function lZ(n){const e=au[n];for(const t of document.fonts)if(e.includes(t.family))return t;return null}function iS(n,e){return{key:`${Ri.id}:${n}`,getElement:async()=>{if(n!=="pattern")return null;const t=8/12,r=document.createElement("div");return r.innerHTML=`
				<svg>
					<defs>
						<mask id="hash_pattern_mask">
							<rect x="0" y="0" width="8" height="8" fill="white" />
							<g
								strokeLinecap="round"
								stroke="black"
							>
								<line x1="${t*1}" y1="${t*3}" x2="${t*3}" y2="${t*1}" />
								<line x1="${t*5}" y1="${t*7}" x2="${t*7}" y2="${t*5}" />
								<line x1="${t*9}" y1="${t*11}" x2="${t*11}" y2="${t*9}" />
							</g>
						</mask>
						<pattern
							id="hash_pattern"
							width="8"
							height="8"
							patternUnits="userSpaceOnUse"
						>
							<rect x="0" y="0" width="8" height="8" fill="${e.solid}" mask="url(#hash_pattern_mask)" />
						</pattern>
					</defs>
				</svg>
			`,Array.from(r.querySelectorAll("defs > *"))}}}function oS(){return{key:`${Ri.id}:pattern`,component:uZ}}const Ku=8,E3=(n,e,t)=>new Promise((r,i)=>{const o=Ku*e*n,s=document.createElement("canvas");s.width=o,s.height=o;const a=s.getContext("2d");if(!a)return;a.fillStyle=t?"#212529":"#f8f9fa",a.fillRect(0,0,o,o),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*n;const l=8/12,c=d=>d*e*n;a.beginPath(),a.moveTo(c(l*1),c(l*3)),a.lineTo(c(l*3),c(l*1)),a.moveTo(c(l*5),c(l*7)),a.lineTo(c(l*7),c(l*5)),a.moveTo(c(l*9),c(l*11)),a.lineTo(c(l*11),c(l*9)),a.stroke(),s.toBlob(d=>{!d||st.throwToBlob.get()?i():r(d)})}),P3=(n,e)=>{const t=document.createElement("canvas");t.width=n[0],t.height=n[1];const r=t.getContext("2d");return r?(e(r),t.toDataURL()):""},cZ=()=>{const n=[];for(let e=1;e<=Math.ceil(xs);e++){const t=P3([1,1],i=>{i.fillStyle=Hf.lightMode.black.semi,i.fillRect(0,0,1,1)}),r=P3([1,1],i=>{i.fillStyle=Hf.darkMode.black.semi,i.fillRect(0,0,1,1)});n.push({zoom:e,url:t,darkMode:!1}),n.push({zoom:e,url:r,darkMode:!0})}return n};function dZ(){const n=G().getInstanceState().devicePixelRatio,[e,t]=S.useState(!1),r=S.useMemo(()=>cZ(),[]),[i,o]=S.useState(r);return S.useEffect(()=>{const s=[];for(let l=1;l<=Math.ceil(xs);l++)s.push(E3(n,l,!1).then(c=>({zoom:l,url:URL.createObjectURL(c),darkMode:!1}))),s.push(E3(n,l,!0).then(c=>({zoom:l,url:URL.createObjectURL(c),darkMode:!0})));let a=!1;return Promise.all(s).then(l=>{a||(o(l),t(!0))}),()=>{a=!0,t(!1)}},[n]),{defs:m.jsx(m.Fragment,{children:i.map(s=>{const a=s.zoom+(s.darkMode?"_dark":"_light");return m.jsx("pattern",{id:rg[a],width:Ku,height:Ku,patternUnits:"userSpaceOnUse",children:m.jsx("image",{href:s.url,width:Ku,height:Ku})},a)})}),isReady:e}}function uZ(){const n=G(),e=S.useRef(null),{defs:t,isReady:r}=dZ();return S.useEffect(()=>{if(r&&n.environment.isSafari){const i=I3(e.current);i&&requestAnimationFrame(()=>{i.style.display="none",requestAnimationFrame(()=>{i.style.display=""})})}},[n,r]),m.jsx("g",{ref:e,children:t})}function I3(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?I3(n.parentElement):null}function Pn(n,e,t={}){const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=t;let c=0,d=0,u=1,h=0,p=0;switch(l){case"dashed":{u=1,c=Math.min(e*a,n/4);break}case"dotted":{u=100,c=e/u;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(n+=c/2,p+=c/2):o==="skip"&&(n-=c,p-=c),s==="outset"?n+=c/2:s==="skip"&&(n-=c)),d=Math.floor(n/c/(2*u)),d-=d%i,d<3&&l==="dashed"?n/e<5?(c=n,d=1,h=0):(c=n*.333,h=n*.333):(d=Math.max(d,3),c=n/d/(2*u),r?(p=c/2,h=(n-d*c)/d):h=(n-d*c)/Math.max(1,d-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}function hZ(n,e,t){const r=e==="end"?n.end.point:n.start.point,i=e==="end"?n.start.point:n.end.point,o=n.isStraight?C.Dist(i,r):Math.abs(n.bodyArc.length),s=Math.max(Math.min(o/5,t*3),t);let a;if(n.isStraight)a=C.Nudge(r,i,s);else{const l=aU(r,s,n.handleArc.center,n.handleArc.radius);a=e==="end"?n.handleArc.sweepFlag?l[0]:l[1]:n.handleArc.sweepFlag?l[1]:l[0]}return{point:r,int:a}}function pZ({point:n,int:e}){const t=C.RotWith(e,n,Ue/6),r=C.RotWith(e,n,-Ue/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y}`}function fZ({point:n,int:e}){const t=C.RotWith(e,n,Ue/6),r=C.RotWith(e,n,-Ue/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function gZ({point:n,int:e}){const t=C.Sub(e,n).div(2),r=C.Add(n,C.Rot(t,at)),i=C.Sub(n,C.Rot(t,at));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function mZ({point:n,int:e}){const t=C.Lrp(n,e,.45),r=C.Dist(t,n);return`M ${t.x-r},${t.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function yZ({point:n,int:e}){const t=C.Lrp(n,e,.75),r=C.RotWith(t,n,Ue/4),i=C.RotWith(t,n,-Ue/4),o=C.Lrp(r,i,.5);return o.add(C.Sub(o,n)),`M ${o.x} ${o.y} L ${r.x} ${r.y} ${n.x} ${n.y} L ${i.x} ${i.y} Z`}function wZ({int:n,point:e}){const t=C.Lrp(e,n,.85),r=C.Sub(t,e).div(2),i=C.Add(e,C.Rot(r,at)),o=C.Sub(e,C.Rot(r,at)),s=C.Add(t,C.Rot(r,at)),a=C.Sub(t,C.Rot(r,at));return`M ${i.x} ${i.y} L ${s.x} ${s.y} L ${a.x} ${a.y} L ${o.x} ${o.y} Z`}function bZ({int:n,point:e}){const t=C.Sub(n,e).div(2),r=C.Add(e,C.Rot(t,at)),i=C.Sub(e,C.Rot(t,at));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}function Sc(n,e,t){const r=e==="end"?n.end.arrowhead:n.start.arrowhead;if(r==="none")return;const i=hZ(n,e,t);if(i){switch(r){case"bar":return bZ(i);case"square":return wZ(i);case"diamond":return yZ(i);case"dot":return mZ(i);case"inverted":return gZ(i);case"arrow":return pZ(i);case"triangle":return fZ(i)}return""}}function vZ(n){const{start:e,end:t,handleArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=n;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${i} ${o} ${t.handle.x},${t.handle.y}`}function sS(n){const{start:e,end:t,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=n;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${i} ${o} ${t.point.x},${t.point.y}`}function M3(n,e){return`M${n.x},${n.y}L${e.x},${e.y}`}function SZ(n){return M3(n.start.handle,n.end.handle)}function aS(n){return M3(n.start.point,n.end.point)}function lS(n,e,t){const r=G(),i=S.useRef(null),o=S.useRef(!1),s=S.useRef(),a=q("isEditing",()=>r.getEditingShapeId()===n,[r,n]);S.useEffect(()=>{const g=i.current;g&&a&&document.activeElement!==g&&g.focus()},[a]);const l=S.useCallback(()=>{const g=o.current;o.current=!1,requestAnimationFrame(()=>{const f=i.current;if(!f)return;const w=r.getShape(n);w&&(f.value=w.props.text,f.value.length&&!g&&f.select())})},[r,n]),c=S.useCallback(()=>{const g=s.current;requestAnimationFrame(()=>{var v;const f=i.current,w=r.getEditingShapeId();if(f&&w){if(w===n)if(g)if(!g.length)f.focus();else{o.current=!0,f.focus();const b=window.getSelection();b&&g.forEach(_=>b.addRange(_))}else f.focus()}else(v=window.getSelection())==null||v.removeAllRanges(),r.complete()})},[r,n]),d=S.useCallback(g=>{if(a)switch((g.ctrlKey||g.metaKey)&&Wt(g),g.key){case"Enter":{(g.ctrlKey||g.metaKey)&&r.complete();break}case"Tab":{ze(g),g.shiftKey?Ds.unindent(g.currentTarget):Ds.indent(g.currentTarget);break}}},[r,a]),u=S.useCallback(g=>{if(!a)return;let f=Ds.normalizeText(g.currentTarget.value);const w=f.replace(/\t/g,vc);if(w!==f){const v=g.currentTarget.selectionStart;g.currentTarget.value=w,g.currentTarget.selectionStart=v+(w.length-f.length),g.currentTarget.selectionEnd=v+(w.length-f.length),f=w}r.updateShapes([{id:n,type:e,props:{text:f}}])},[r,n,e,a]),h=t.trim().length===0;S.useEffect(()=>{if(a&&i.current){let g=function(){var w,v;const f=(w=window.getSelection)==null?void 0:w.call(window);if(f&&f.type!=="None"){const b=[];if(f)for(let _=0;_<f.rangeCount;_++)b.push((v=f.getRangeAt)==null?void 0:v.call(f,_));s.current=b}};return document.addEventListener("selectionchange",g),()=>{document.removeEventListener("selectionchange",g)}}},[a]);const p=S.useCallback(g=>{r.dispatch({...er(g),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(n)}),Wt(g)},[r,n]);return{rInput:i,isEditing:a,handleFocus:l,handleBlur:c,handleKeyDown:d,handleChange:u,handleInputPointerDown:p,handleDoubleClick:Wt,isEmpty:h}}const xZ=S.memo(function({id:n,text:e,size:t,font:r,position:i,width:o,labelColor:s}){const{rInput:a,isEditing:l,handleFocus:c,handleBlur:d,handleKeyDown:u,handleChange:h,isEmpty:p,handleInputPointerDown:g,handleDoubleClick:f}=lS(n,"arrow",e),w=Ds.normalizeTextForDom(e).trim().length>0;return!l&&!w?null:m.jsx("div",{className:"tl-arrow-label","data-font":r,"data-align":"center","data-hastext":!p,"data-isediting":l,style:{textAlign:"center",fontSize:Rs[t],lineHeight:Rs[t]*cn.lineHeight+"px",transform:`translate(${i.x}px, ${i.y}px)`,color:s},children:m.jsxs("div",{className:"tl-arrow-label__inner",children:[m.jsx("p",{style:{width:o||"9px"},children:e?Ds.normalizeTextForDom(e):" "}),l&&m.jsx("textarea",{ref:a,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:e,onFocus:c,onChange:h,onKeyDown:u,onBlur:d,onContextMenu:Wt,onPointerDown:g,onDoubleClick:f})]})})});let _Z=0;class am extends ci{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"canBind",()=>!1);y(this,"canSnap",()=>!1);y(this,"hideResizeHandles",()=>!0);y(this,"hideRotateHandle",()=>!0);y(this,"hideSelectionBoundsBg",()=>!0);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"onHandleChange",(t,{handle:r,isPrecise:i})=>{const o=r.id;if(o==="middle"){const{start:f,end:w}=di(this.editor,t),v=C.Sub(w,f),b=C.Per(v),_=C.Med(w,f),x=C.Sub(_,b),E=C.Add(_,b),k=C.NearestPointOnLineSegment(x,E,r,!1);let P=C.Dist(k,_);return C.Clockwise(k,w,_)&&(P*=-1),{id:t.id,type:t.type,props:{bend:P}}}const s=bn(t),a=this.editor.getShapePageTransform(s.id).applyToPoint(r);if(this.editor.inputs.ctrlKey)return s.props[o]={type:"point",x:r.x,y:r.y},s;const l=this.editor.getShapePageTransform(t.id).applyToPoint(r),c=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:f=>!f.isLocked&&this.editor.getShapeUtil(f).canBind(f)});if(!c)return s.props[o]={type:"point",x:r.x,y:r.y},s;const d=this.editor.getShapeGeometry(c),u=de.ZeroFix(d.bounds),h=this.editor.getPointInShapeSpace(c,a);let p=i;if(!p){const f=s.props[o];(f.type==="point"||f.type==="binding"&&c.id!==f.boundShapeId)&&(p=this.editor.inputs.pointerVelocity.len()<.5)}if(!i){d.isClosed||(p=!0);const f=s.props[o==="start"?"end":"start"];f.type==="binding"&&c.id===f.boundShapeId&&f.isPrecise&&(p=!0)}const g={x:(h.x-u.minX)/u.width,y:(h.y-u.minY)/u.height};return p&&C.Dist(h,u.center)<Math.max(4,Math.min(Math.min(u.width,u.height)*.15,16))/this.editor.getZoomLevel()&&(g.x=.5,g.y=.5),s.props[o]={type:"binding",boundShapeId:c.id,normalizedAnchor:g,isPrecise:p,isExact:this.editor.inputs.altKey},s.props.start.type==="binding"&&s.props.end.type==="binding"&&s.props.start.boundShapeId===s.props.end.boundShapeId&&C.Equals(s.props.start.normalizedAnchor,s.props.end.normalizedAnchor)&&(s.props.end.normalizedAnchor.x+=.05),s});y(this,"onTranslateStart",t=>{const r=t.props.start.type==="binding"?t.props.start.boundShapeId:null,i=t.props.end.type==="binding"?t.props.end.boundShapeId:null,o=this.editor.getSelectedShapeIds();if(r&&(o.includes(r)||this.editor.isAncestorSelected(r))||i&&(o.includes(i)||this.editor.isAncestorSelected(i)))return;const{start:s,end:a}=di(this.editor,t);return{id:t.id,type:t.type,props:{...t.props,start:{type:"point",x:s.x,y:s.y},end:{type:"point",x:a.x,y:a.y}}}});y(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=di(this.editor,t),{start:a,end:l}=bn(t.props);let{bend:c}=t.props;a.type==="point"&&(a.x=s.start.x*i,a.y=s.start.y*o),l.type==="point"&&(l.x=s.end.x*i,l.y=s.end.y*o);const d=Math.abs(i),u=Math.abs(o);return i<0&&o>=0?(c!==0&&(c*=-1,c*=Math.max(d,u)),a.type==="binding"&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x),l.type==="binding"&&(l.normalizedAnchor.x=1-l.normalizedAnchor.x)):i>=0&&o<0?(c!==0&&(c*=-1,c*=Math.max(d,u)),a.type==="binding"&&(a.normalizedAnchor.y=1-a.normalizedAnchor.y),l.type==="binding"&&(l.normalizedAnchor.y=1-l.normalizedAnchor.y)):i>=0&&o>=0?c!==0&&(c*=Math.max(d,u)):i<0&&o<0&&(c!==0&&(c*=Math.max(d,u)),a.type==="binding"&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x,a.normalizedAnchor.y=1-a.normalizedAnchor.y),l.type==="binding"&&(l.normalizedAnchor.x=1-l.normalizedAnchor.x,l.normalizedAnchor.y=1-l.normalizedAnchor.y)),{props:{start:a,end:l,bend:c}}});y(this,"onDoubleClickHandle",(t,r)=>{switch(r.id){case"start":return{id:t.id,type:t.type,props:{...t.props,arrowheadStart:t.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:t.id,type:t.type,props:{...t.props,arrowheadEnd:t.props.arrowheadEnd==="none"?"arrow":"none"}}}});y(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t;o.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])})}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{type:"point",x:0,y:0},end:{type:"point",x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",font:"draw"}}getGeometry(t){const r=this.editor.getArrowInfo(t),i=r.isStraight?new fg({start:C.From(r.start.point),end:C.From(r.end.point)}):new oH({center:C.Cast(r.handleArc.center),radius:r.handleArc.radius,start:C.Cast(r.start.point),end:C.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let o;if(t.props.text.trim()){const s=i.bounds,{w:a,h:l}=this.editor.textMeasure.measureText(t.props.text,{...cn,fontFamily:Ro[t.props.font],fontSize:Rs[t.props.size],maxWidth:null});let c=a,d=l;if(s.width>s.height){c=Math.max(Math.min(a,64),Math.min(s.width-64,a));const{w:u,h}=this.editor.textMeasure.measureText(t.props.text,{...cn,fontFamily:Ro[t.props.font],fontSize:Rs[t.props.size],maxWidth:c});c=u,d=h}if(c>16*Rs[t.props.size]){c=16*Rs[t.props.size];const{w:u,h}=this.editor.textMeasure.measureText(t.props.text,{...cn,fontFamily:Ro[t.props.font],fontSize:Rs[t.props.size],maxWidth:c});c=u,d=h}o=new ks({x:r.middle.x-c/2-4.25,y:r.middle.y-d/2-4.25,width:c+8.5,height:d+8.5,isFilled:!0,isLabel:!0})}return new _s({children:o?[i,o]:[i],isSnappable:!1})}getHandles(t){const r=this.editor.getArrowInfo(t);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y,canBind:!0},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y,canBind:!1},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y,canBind:!0}]}component(t){const r=Xt(),i=this.editor.getOnlySelectedShape(),o=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,s=this.editor.getArrowInfo(t),a=de.ZeroFix(this.editor.getShapeGeometry(t).bounds),l=re.useMemo(()=>this.editor.environment.isSafari?_Z+=1:0,[t]);if(!(s!=null&&s.isValid))return null;const c=En[t.props.size],d=s.start.arrowhead&&Sc(s,"start",c),u=s.end.arrowhead&&Sc(s,"end",c),h=s.isStraight?aS(s):sS(s);let p=null;if(i===t&&o){const{strokeDasharray:x,strokeDashoffset:E}=Pn(s.isStraight?C.Dist(s.start.handle,s.end.handle):Math.abs(s.handleArc.length),2,{end:"skip",start:"skip",lengthRatio:2.5});p=t.props.start.type==="binding"||t.props.end.type==="binding"?m.jsx("path",{className:"tl-arrow-hint",d:s.isStraight?SZ(s):vZ(s),strokeDasharray:x,strokeDashoffset:E,strokeWidth:2,markerStart:t.props.start.type==="binding"?t.props.start.isExact?"":t.props.start.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:t.props.end.type==="binding"?t.props.end.isExact?"":t.props.end.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:g,strokeDashoffset:f}=Pn(s.isStraight?s.length:Math.abs(s.bodyArc.length),c,{style:t.props.dash}),w=t.props.text.trim()?this.editor.getShapeGeometry(t).children[1]:null,v=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),b=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow"),_=(t.id+"_clip_"+l).replace(":","_");return m.jsxs(m.Fragment,{children:[m.jsxs(yr,{id:t.id,style:{minWidth:50,minHeight:50},children:[m.jsx("defs",{children:m.jsxs("mask",{id:_,children:[m.jsx("rect",{x:R(-100+a.minX),y:R(-100+a.minY),width:R(a.width+200),height:R(a.height+200),fill:"white"}),w&&m.jsx("rect",{x:w.x,y:w.y,width:w.w,height:w.h,fill:"black",rx:4,ry:4}),d&&v&&m.jsx("path",{d,fill:s.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),u&&b&&m.jsx("path",{d:u,fill:s.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),m.jsxs("g",{fill:"none",stroke:r[t.props.color].solid,strokeWidth:c,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[p,m.jsxs("g",{mask:`url(#${_})`,children:[m.jsx("rect",{x:R(a.minX-100),y:R(a.minY-100),width:R(a.width+200),height:R(a.height+200),opacity:0}),m.jsx("path",{d:h,strokeDasharray:g,strokeDashoffset:f})]}),d&&v&&t.props.fill!=="none"&&m.jsx(Dt,{theme:r,d,color:t.props.color,fill:t.props.fill}),u&&b&&t.props.fill!=="none"&&m.jsx(Dt,{theme:r,d:u,color:t.props.color,fill:t.props.fill}),d&&m.jsx("path",{d}),u&&m.jsx("path",{d:u})]})]}),m.jsx(xZ,{id:t.id,text:t.props.text,font:t.props.font,size:t.props.size,position:s.middle,width:(w==null?void 0:w.w)??0,labelColor:r[t.props.labelColor].solid})]})}indicator(t){const{start:r,end:i}=di(this.editor,t),o=this.editor.getArrowInfo(t),s=this.editor.getShapeGeometry(t),a=s.bounds,l=t.props.text.trim()?s.children[1]:null,c=Ig(t.id);if(!o||C.Equals(r,i))return null;const d=En[t.props.size],u=o.start.arrowhead&&Sc(o,"start",d),h=o.end.arrowhead&&Sc(o,"end",d),p=o.isStraight?aS(o):sS(o),g=u&&o.start.arrowhead!=="arrow"||h&&o.end.arrowhead!=="arrow"||!!l,f=(t.id+"_clip").replace(":","_");return c&&l?m.jsx("rect",{x:R(l.x),y:R(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5}):m.jsxs("g",{children:[g&&m.jsx("defs",{children:m.jsxs("mask",{id:f,children:[m.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.w+200,height:a.h+200,fill:"white"}),l&&m.jsx("rect",{x:R(l.x),y:R(l.y),width:l.w,height:l.h,fill:"black",rx:3.5,ry:3.5}),u&&m.jsx("path",{d:u,fill:o.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),h&&m.jsx("path",{d:h,fill:o.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),m.jsxs("g",{...g?{mask:`url(#${f})`}:void 0,children:[g&&m.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.width+200,height:a.height+200,opacity:0}),m.jsx("path",{d:p})]}),u&&m.jsx("path",{d:u}),h&&m.jsx("path",{d:h}),l&&m.jsx("rect",{x:R(l.x),y:R(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5})]})}toSvg(t,r){const i=Qn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(iS(t.props.fill,i));const o=i[t.props.color].solid,s=this.editor.getArrowInfo(t),a=En[t.props.size],l=document.createElementNS("http://www.w3.org/2000/svg","g");if(!s)return l;const c=s.start.arrowhead&&Sc(s,"start",a),d=s.end.arrowhead&&Sc(s,"end",a),u=this.editor.getShapeGeometry(t),h=u.bounds,p=t.props.text.trim()?u.children[1]:null,g=(t.id+"_clip").replace(":","_");if(c||d||p){const x=document.createElementNS("http://www.w3.org/2000/svg","defs"),E=document.createElementNS("http://www.w3.org/2000/svg","mask");E.id=g;const k=document.createElementNS("http://www.w3.org/2000/svg","rect");if(k.setAttribute("x",h.minX-100+""),k.setAttribute("y",h.minY-100+""),k.setAttribute("width",h.width+200+""),k.setAttribute("height",h.height+200+""),k.setAttribute("fill","white"),E.appendChild(k),c&&E.appendChild(A3(c,s.start.arrowhead)),d&&E.appendChild(A3(d,s.end.arrowhead)),p){const P=document.createElementNS("http://www.w3.org/2000/svg","rect");P.setAttribute("x",p.x+""),P.setAttribute("y",p.y+""),P.setAttribute("width",p.w+""),P.setAttribute("height",p.h+""),P.setAttribute("fill","black"),E.appendChild(P)}x.appendChild(E),l.appendChild(x)}const f=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttribute("mask",`url(#${g})`),l.appendChild(f);const w=document.createElementNS("http://www.w3.org/2000/svg","rect");w.setAttribute("x","-100"),w.setAttribute("y","-100"),w.setAttribute("width",h.width+200+""),w.setAttribute("height",h.height+200+""),w.setAttribute("fill","transparent"),w.setAttribute("stroke","none"),f.appendChild(w);const v=kZ(s.isStraight?aS(s):sS(s),o,a),{strokeDasharray:b,strokeDashoffset:_}=Pn(s.isStraight?s.length:Math.abs(s.bodyArc.length),a,{style:t.props.dash});if(v.setAttribute("stroke-dasharray",b),v.setAttribute("stroke-dashoffset",_),f.appendChild(v),c&&l.appendChild(T3(c,t.props.color,a,t.props.arrowheadStart==="arrow"?"none":t.props.fill,i)),d&&l.appendChild(T3(d,t.props.color,a,t.props.arrowheadEnd==="arrow"?"none":t.props.fill,i)),p){r.addExportDef(sm(t.props.font));const x={fontSize:Rs[t.props.size],lineHeight:cn.lineHeight,fontFamily:au[t.props.font],padding:0,textAlign:"middle",width:p.w-8,verticalTextAlign:"middle",height:p.h,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},E=om(this.editor,this.editor.textMeasure.measureTextSpans(t.props.text,x),x);E.setAttribute("fill",i[t.props.labelColor].solid),Array.from(E.children).forEach(P=>{const I=parseFloat(P.getAttribute("x")||"0"),A=parseFloat(P.getAttribute("y")||"0");P.setAttribute("x",I+4+p.x+"px"),P.setAttribute("y",A+p.y+"px")});const k=E.cloneNode(!0);k.setAttribute("stroke-width","2"),k.setAttribute("fill",i.background),k.setAttribute("stroke",i.background),l.appendChild(k),l.appendChild(E)}return l}getCanvasSvgDefs(){return[oS()]}}y(am,"type","arrow"),y(am,"props",pF),y(am,"migrations",fF);function A3(n,e){const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",n),t.setAttribute("fill",e==="arrow"?"none":"black"),t.setAttribute("stroke","none"),t}function kZ(n,e,t){const r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",n),r.setAttribute("fill","none"),r.setAttribute("stroke",e),r.setAttribute("stroke-width",t+""),r}function T3(n,e,t,r,i){const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",n),o.setAttribute("fill","none"),o.setAttribute("stroke",i[e].solid),o.setAttribute("stroke-width",t+"");const s=Sr({d:n,fill:r,color:e,theme:i});if(s){const a=document.createElementNS("http://www.w3.org/2000/svg","g");return a.appendChild(s),a.appendChild(o),a}else return o}const j3="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Gu({url:n,zoomLevel:e}){return m.jsx("a",{className:ye("tl-hyperlink-button",{"tl-hyperlink-button__hidden":e<.32}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:Wt,onPointerUp:Wt,title:n,draggable:!1,children:m.jsx("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${j3}") center 100% / 100% no-repeat`,WebkitMask:`url("${j3}") center 100% / 100% no-repeat`}})})}const CZ=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function cS(n){return CZ.map(e=>{const{offsetX:t,offsetY:r,blur:i,spread:o,color:s}=e,a=new C(t,r),{x:l,y:c}=a.rot(-n);return`${l}px ${c}px ${i}px ${o}px ${s}`}).join(", ")}class lm extends ac{constructor(){super(...arguments);y(this,"canResize",()=>!1);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"onBeforeCreate",t=>{R3(this.editor,t)});y(this,"onBeforeUpdate",(t,r)=>{if(t.props.url!==r.props.url)if(gr.isValid(r.props.url))R3(this.editor,r);else return{...r,props:{...r.props,url:t.props.url}}})}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(t){const r=t.props.assetId?this.editor.getAsset(t.props.assetId):null,i=this.editor.getShapePageTransform(t).rotation(),o=EZ(t);return m.jsx(Aa,{children:m.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:cS(i)},children:[m.jsxs("div",{className:"tl-bookmark__image_container",children:[r!=null&&r.props.image?m.jsx("img",{className:"tl-bookmark__image",draggable:!1,src:r==null?void 0:r.props.image,alt:(r==null?void 0:r.props.title)||""}):m.jsx("div",{className:"tl-bookmark__placeholder"}),m.jsx(Gu,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]}),m.jsxs("div",{className:"tl-bookmark__copy_container",children:[(r==null?void 0:r.props.title)&&m.jsx("h2",{className:"tl-bookmark__heading",children:Hu((r==null?void 0:r.props.title)||"",54)}),(r==null?void 0:r.props.description)&&m.jsx("p",{className:"tl-bookmark__description",children:Hu((r==null?void 0:r.props.description)||"",128)}),m.jsx("a",{className:"tl-bookmark__link",href:t.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Wt,onPointerUp:Wt,onClick:Wt,children:Hu(o,45)})]})]})})}indicator(t){return m.jsx("rect",{width:R(t.props.w),height:R(t.props.h),rx:"6",ry:"6"})}}y(lm,"type","bookmark"),y(lm,"props",gF),y(lm,"migrations",mF);const EZ=n=>{try{const e=new URL(n.props.url),t=e.pathname.replace(/\/*$/,"");return`${e.hostname}${t}`}catch{return n.props.url}};function R3(n,e){const{url:t}=e.props,r=Sa.createId(Tf(t));n.getAsset(r)?e.props.assetId!==r&&n.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(n.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),PZ(n,e))}const PZ=zP(async(n,e)=>{const{url:t}=e.props,r=await n.getAssetForExternalContent({type:"url",url:t});r&&n.batch(()=>{n.createAssets([r]),n.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function Os(n,e=!1){const t=n.length;if(t<2)return"";let r=n[0].point,i=n[1].point;if(t===2)return`M${on(r)}L${on(i)}`;let o="";for(let s=2,a=t-1;s<a;s++)r=n[s].point,i=n[s+1].point,o+=tr(r,i);return e?`M${tr(n[0].point,n[1].point)}Q${on(n[1].point)}${tr(n[1].point,n[2].point)}T${o}${tr(n[t-1].point,n[0].point)}${tr(n[0].point,n[1].point)}Z`:`M${on(n[0].point)}Q${on(n[1].point)}${tr(n[1].point,n[2].point)}${n.length>3?"T":""}${o}L${on(n[t-1].point)}`}function IZ(n,e={}){const{start:t={},end:r={}}=e,{cap:i=!0}=t,{cap:o=!0}=r;ba(!t.taper&&!r.taper,"cap taper not supported here"),ba(!t.easing&&!r.easing,"cap easing not supported here"),ba(i&&o,"cap must be true");const s=hi(n,e);yc(s,e);const a=MZ(s);let l="";for(const c of a)l+=TZ(c,e);return l}function MZ(n){if(n.length<=2)return[n];const e=[];let t=[n[0]];for(let r=1;r<n.length-1;r++){const i=n[r-1],o=n[r],s=n[r+1],a=C.Angle(i.point,o.point),l=C.Angle(o.point,s.point),c=Math.abs(wu(a,l))/Math.PI;if(c>.8){const p={...o,point:o.input};t.push(p),e.push(dS(t)),t=[p];continue}if(t.push(o),c<.25)continue;const d=(i.radius+o.radius+s.radius)/3,u=C.Dist(i.point,o.point)/d,h=C.Dist(o.point,s.point)/d;if(u+h<1.5){t.push(o),e.push(dS(t)),t=[o];continue}}return t.push(n[n.length-1]),e.push(dS(t)),e}function dS(n){const e=n[0];for(;n.length>2;){const r=n[1],i=C.Dist(e.point,r.point),o=(e.radius+r.radius)/2;if(i<o*.5)n.splice(1,1);else break}const t=n[n.length-1];for(;n.length>2;){const r=n[n.length-2],i=C.Dist(t.point,r.point),o=(t.radius+r.radius)/2;if(i<o*.5)n.splice(n.length-2,1);else break}return n.length>1&&(n[0]={...n[0],vector:C.FromAngle(C.Angle(n[1].point,n[0].point))},n[n.length-1]={...n[n.length-1],vector:C.FromAngle(C.Angle(n[n.length-1].point,n[n.length-2].point))}),n}function AZ(n,e,t){return"M "+n+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function TZ(n,e={}){if(n.length===0)return"";if(n.length===1)return AZ(n[0].point.x,n[0].point.y,n[0].radius);const{left:t,right:r}=h3(n,e);r.reverse();let i=`M${on(t[0])}T`;for(let o=1;o<t.length;o++)i+=tr(t[o-1],t[o]);{const o=n[n.length-1],s=o.radius,a=o.vector.clone().per().neg(),l=C.Add(o.point,C.Mul(a,s)),c=C.Add(o.point,C.Mul(a,-s));i+=`${on(l)}A${R(s)},${R(s)} 0 0 1 ${on(c)}T`}for(let o=1;o<r.length;o++)i+=tr(r[o-1],r[o]);{const o=n[0],s=o.radius,a=o.vector.clone().per(),l=C.Add(o.point,C.Mul(a,s)),c=C.Add(o.point,C.Mul(a,-s));i+=`${on(l)}A${R(s)},${R(s)} 0 0 1 ${on(c)}Z`}return i}function cm(){const n=G();return q("zoom",()=>n.getZoomLevel()<.35,[n])}const jZ=n=>n*.65+c9(n*Ue/2)*.35,RZ=n=>({size:1+n,thinning:.5,streamline:.62+(1+n)/8*.06,smoothing:.62,easing:_n.easeOutSine,simulatePressure:!0}),DZ=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:jZ}),D3=n=>({size:1+n,thinning:0,streamline:.62+(1+n)/8*.06,smoothing:.62,simulatePressure:!1,easing:_n.linear});function uS({strokeWidth:n,showAsComplete:e}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:_n.easeOutSine,last:e}}function dm(n,e,t,r){return{...r?D3(e):n.dash==="draw"?n.isPen?DZ(e):RZ(e):D3(e),last:n.isComplete||t}}function xc(n){const e=[];for(const t of n)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(C.Cast));else{const r=Math.max(4,Math.floor(C.Dist(t.points[0],t.points[1])/16));e.push(...C.PointsBetween(t.points[0],t.points[1],r))}return e}function O3(n,e){return{draw:"none",solid:"none",dotted:`0.1 ${e*2}`,dashed:`${e*2} ${e*2}`}[n.props.dash]}class um extends ci{constructor(){super(...arguments);y(this,"hideResizeHandles",t=>pS(t));y(this,"hideRotateHandle",t=>pS(t));y(this,"hideSelectionBoundsFg",t=>pS(t));y(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=[];for(const a of t.props.segments)s.push({...a,points:a.points.map(({x:l,y:c,z:d})=>({x:eg(i*l),y:eg(o*c),z:d}))});return{props:{segments:s}}})}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1}}getGeometry(t){const r=xc(t.props.segments),i=En[t.props.size];if(t.props.segments.length===1){const s=de.FromPoints(r);if(s.width<i*2&&s.height<i*2)return new yA({x:-i,y:-i,radius:i,isFilled:!0})}const o=hi(r,dm(t.props,i,!0,!0)).map(s=>s.point);return t.props.isClosed?new Gt({points:o,isFilled:t.props.fill!=="none"}):new Ea({points:o})}component(t){var p;const r=Xt(),i=cm(),o=En[t.props.size],s=xc(t.props.segments),a=t.props.isComplete||((p=Xn(t.props.segments))==null?void 0:p.type)==="straight";let l=o;!i&&!t.props.isPen&&t.props.dash==="draw"&&s.length===1&&(l+=vs(t.id)()*(o/6));const c=dm(t.props,l,a,i);if(!i&&t.props.dash==="draw")return m.jsxs(yr,{id:t.id,children:[t.props.isClosed&&t.props.fill&&s.length>1?m.jsx(Dt,{theme:r,fill:t.props.isClosed?t.props.fill:"none",color:t.props.color,d:Os(hi(s,c),t.props.isClosed)}):null,m.jsx("path",{d:IZ(s,c),strokeLinecap:"round",fill:r[t.props.color].solid})]});const d=hi(s,c),u=d.length<2,h=u?hS(s[0],0):Os(d,t.props.isClosed);return m.jsxs(yr,{id:t.id,children:[m.jsx(Dt,{theme:r,color:t.props.color,fill:u||t.props.isClosed?t.props.fill:"none",d:h}),m.jsx("path",{d:h,strokeLinecap:"round",fill:u?r[t.props.color].solid:"none",stroke:r[t.props.color].solid,strokeWidth:o,strokeDasharray:u?"none":O3(t,o),strokeDashoffset:"0"})]})}indicator(t){var u;const r=cm(),i=En[t.props.size],o=xc(t.props.segments);let s=i;!r&&!t.props.isPen&&t.props.dash==="draw"&&o.length===1&&(s+=vs(t.id)()*(i/6));const a=t.props.isComplete||((u=Xn(t.props.segments))==null?void 0:u.type)==="straight",l=dm(t.props,s,a,!0),c=hi(o,l),d=c.length>1?Os(c,t.props.isClosed):hS(o[0],s);return m.jsx("path",{d})}toSvg(t,r){var f;const i=Qn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(iS(t.props.fill,i));const{color:o}=t.props,s=En[t.props.size],a=xc(t.props.segments),l=t.props.isComplete||((f=Xn(t.props.segments))==null?void 0:f.type)==="straight";let c=s;!t.props.isPen&&t.props.dash==="draw"&&a.length===1&&(c+=vs(t.id)()*(s/6));const d=dm(t.props,c,l,!1),u=hi(a,d),h=u.length>1?Os(u,t.props.isClosed):hS(a[0],c);let p;if(t.props.dash==="draw"||u.length<2){yc(u,d);const w=Bu(u,d),v=document.createElementNS("http://www.w3.org/2000/svg","path");v.setAttribute("d",xu(w,!0)),v.setAttribute("fill",i[o].solid),v.setAttribute("stroke-linecap","round"),p=v}else{const w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttribute("d",h),w.setAttribute("stroke",i[o].solid),w.setAttribute("fill","none"),w.setAttribute("stroke-linecap","round"),w.setAttribute("stroke-width",s.toString()),w.setAttribute("stroke-dasharray",O3(t,s)),w.setAttribute("stroke-dashoffset","0"),p=w}const g=Sr({fill:t.props.isClosed?t.props.fill:"none",d:h,color:t.props.color,theme:i});if(g){const w=document.createElementNS("http://www.w3.org/2000/svg","g");return w.appendChild(g),w.appendChild(p),w}return p}getCanvasSvgDefs(){return[oS()]}expandSelectionOutlinePx(t){const r=t.props.dash==="draw"?1.6:1;return En[t.props.size]*r/2}}y(um,"type","draw"),y(um,"props",yF),y(um,"migrations",wF);function hS(n,e){const t=(e+1)*.5;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function pS(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function OZ(n,e,t={}){const{newPoint:r,handle:i,scaleX:o,scaleY:s}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:d=1/0}=t;let u=n.props.w*o,h=n.props.h*s;const p=new C(0,0);if(u>0){if(u<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=u-a;break}case"top":case"bottom":{p.x=(u-a)/2;break}default:p.x=0}u=a}}else if(p.x=u,u=-u,u<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=-u;break}default:p.x=-a}u=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=h-c;break}case"right":case"left":{p.y=(h-c)/2;break}default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=-h;break}default:p.y=-c}h=c}const{x:g,y:f}=p.rot(n.rotation).add(r);return{x:g,y:f,props:{w:Math.min(l,u),h:Math.min(d,h)}}}const LZ=n=>Object.entries(n).filter(([e,t])=>t).map(([e])=>e).join(" ");class hm extends ac{constructor(){super(...arguments);y(this,"hideSelectionBoundsFg",t=>!this.canResize(t));y(this,"canEdit",()=>!0);y(this,"canUnmount",t=>{var r,i;return!!((i=(r=Do(t.props.url))==null?void 0:r.definition)!=null&&i.canUnmount)});y(this,"canResize",t=>{var r,i;return!!((i=(r=Do(t.props.url))==null?void 0:r.definition)!=null&&i.doesResize)});y(this,"canEditInReadOnly",()=>!0);y(this,"isAspectRatioLocked",t=>{var r;return((r=Do(t.props.url))==null?void 0:r.definition.isAspectRatioLocked)??!1});y(this,"onResize",(t,r)=>{const i=this.isAspectRatioLocked(t),o=Do(t.props.url);let s=(o==null?void 0:o.definition.minWidth)??200,a=(o==null?void 0:o.definition.minHeight)??200;if(i){const l=t.props.w/t.props.h;l>1?s*=l:a/=l}return OZ(t,r,{minWidth:s,minHeight:a})})}getDefaultProps(){return{w:300,h:300,url:""}}component(t){const{w:r,h:i,url:o}=t.props,s=Ig(t.id),a=S.useMemo(()=>S3(o),[o]),l=q("is hovering",()=>{const{editingShapeId:h,hoveredShapeId:p}=this.editor.getCurrentPageState();if(h&&p!==h){const g=this.editor.getShape(h);if(g&&this.editor.isShapeOfType(g,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(t).rotation(),d=s||l;if((a==null?void 0:a.definition.type)==="github_gist"){const h=a.url.split("/").pop();if(!h)throw Error("No gist id!");return m.jsx(Aa,{className:"tl-embed-container",id:t.id,children:m.jsx(zZ,{id:h,width:R(r),height:R(i),isInteractive:d,pageRotation:c})})}const u=LZ({...bF,...(a==null?void 0:a.definition.overridePermissions)??{}});return m.jsx(Aa,{className:"tl-embed-container",id:t.id,children:a!=null&&a.definition?m.jsx("iframe",{className:"tl-embed",sandbox:u,src:a.embedUrl,width:R(r),height:R(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:d?"auto":"none",zIndex:d?"":"-1",boxShadow:cS(c),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:a==null?void 0:a.definition.backgroundColor}}):null})}indicator(t){const r=S.useMemo(()=>Do(t.props.url),[t.props.url]);return m.jsx("rect",{width:R(t.props.w),height:R(t.props.h),rx:(r==null?void 0:r.definition.overrideOutlineRadius)??8,ry:(r==null?void 0:r.definition.overrideOutlineRadius)??8})}}y(hm,"type","embed"),y(hm,"props",vF),y(hm,"migrations",SF);function zZ({id:n,file:e,isInteractive:t,width:r,height:i,style:o,pageRotation:s}){return m.jsx("iframe",{className:"tl-embed",draggable:!1,width:R(r),height:R(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...o,pointerEvents:t?"all":"none",zIndex:t?"":"-1",boxShadow:cS(s)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const NZ=S.forwardRef(({id:n,name:e,isEditing:t},r)=>{const i=G(),o=S.useCallback(l=>{l.key==="Enter"&&!l.nativeEvent.isComposing&&(Wt(l),l.currentTarget.blur(),i.setEditingShape(null))},[i]),s=S.useCallback(l=>{const c=i.getShape(n);if(!c)return;const d=c.props.name,u=l.currentTarget.value.trim();d!==u&&i.updateShapes([{id:n,type:"frame",props:{name:u}}],{squashing:!0})},[n,i]),a=S.useCallback(l=>{const c=i.getShape(n);if(!c)return;const d=c.props.name,u=l.currentTarget.value;d!==u&&i.updateShapes([{id:n,type:"frame",props:{name:u}}],{squashing:!0})},[n,i]);return m.jsxs("div",{className:`tl-frame-label ${t?"tl-frame-label__editing":""}`,children:[m.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:t?void 0:"none"},value:e,autoFocus:!0,onKeyDown:o,onBlur:s,onChange:a}),L3(e,"Frame")+String.fromCharCode(8203)]})}),FZ=function({id:n,name:e,width:t,height:r}){const i=G(),o=q("shape rotation",()=>si(i.getShapePageTransform(n).rotation()),[i,n]),s=Ig(n),a=S.useRef(null),l=S.useCallback(h=>{const p=er(h);i.getEditingShapeId()!==n&&(i.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(n),...p}),h.preventDefault())},[i,n]);S.useEffect(()=>{const h=a.current;h&&s&&(h.focus(),h.select(),requestAnimationFrame(()=>{document.activeElement!==h&&(h.focus(),h.select())}))},[a,s]);const c=((o+Math.PI/4)*(2/Math.PI)+4)%4,d=["top","left","bottom","right"][Math.floor(c)];let u;switch(d){case"top":u="";break;case"right":u=`translate(${R(t)}px, 0px) rotate(90deg)`;break;case"bottom":u=`translate(${R(t)}px, ${R(r)}px) rotate(180deg)`;break;case"left":u=`translate(0px, ${R(r)}px) rotate(270deg)`;break}return m.jsx("div",{className:"tl-frame-heading",style:{overflow:s?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(d==="top"||d==="bottom"?t:r)}px + var(--space-5))`,bottom:"100%",transform:`${u} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:l,children:m.jsx("div",{className:"tl-frame-heading-hit-area",children:m.jsx(NZ,{ref:a,id:n,name:e,isEditing:s})})})};function L3(n,e){return n.match(/^\s*$/)?e:n}class pm extends ac{constructor(){super(...arguments);y(this,"canBind",()=>!0);y(this,"canEdit",()=>!0);y(this,"canReceiveNewChildrenOfType",(t,r)=>!t.isLocked);y(this,"canDropShapes",(t,r)=>!t.isLocked);y(this,"onDragShapesOver",(t,r)=>r.every(i=>i.parentId===t.id)?{shouldHint:!1}:(this.editor.reparentShapes(r.map(i=>i.id),t.id),{shouldHint:!0}));y(this,"onDragShapesOut",(t,r)=>{const i=this.editor.getShape(t.parentId);i&&this.editor.isShapeOfType(i,"group")?this.editor.reparentShapes(r,i.id):this.editor.reparentShapes(r,this.editor.getCurrentPageId())});y(this,"onResizeEnd",t=>{const r=this.editor.getShapePageBounds(t),i=this.editor.getSortedChildIdsForParent(t.id),o=[];for(const s of i){const a=this.editor.getShapePageBounds(s);r.includes(a)||o.push(s)}o.length>0&&this.editor.reparentShapes(o,this.editor.getCurrentPageId())});y(this,"onResize",(t,r)=>hA(t,r))}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(t){return new ks({width:t.props.w,height:t.props.h,isFilled:!1})}component(t){const r=this.editor.getShapeGeometry(t).bounds,i=Xt(),o=q("is creating this shape",()=>{var l;const s=this.editor.getStateDescendant("select.resizing");if(!s||!s.getIsActive())return!1;const a=s==null?void 0:s.info;return a?a.isCreating&&((l=this.editor.getOnlySelectedShape())==null?void 0:l.id)===t.id:!1},[t.id]);return m.jsxs(m.Fragment,{children:[m.jsx(yr,{children:m.jsx("rect",{className:ye("tl-frame__body",{"tl-frame__creating":o}),width:r.width,height:r.height,fill:i.solid,stroke:i.text})}),o?null:m.jsx(FZ,{id:t.id,name:t.props.name,width:r.width,height:r.height})]})}toSvg(t){const r=Qn({isDarkMode:this.editor.user.getIsDarkMode()}),i=document.createElementNS("http://www.w3.org/2000/svg","g"),o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("width",t.props.w.toString()),o.setAttribute("height",t.props.h.toString()),o.setAttribute("fill",r.solid),o.setAttribute("stroke",r.black.solid),o.setAttribute("stroke-width","1"),o.setAttribute("rx","1"),o.setAttribute("ry","1"),i.appendChild(o);const s=((si(this.editor.getShapePageTransform(t.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,a=["top","left","bottom","right"][Math.floor(s)];let l;switch(a){case"top":l="";break;case"right":l=`translate(${R(t.props.w)}px, 0px) rotate(90deg)`;break;case"bottom":l=`translate(${R(t.props.w)}px, ${R(t.props.h)}px) rotate(180deg)`;break;case"left":l=`translate(0px, ${R(t.props.h)}px) rotate(270deg)`;break;default:l=""}const c={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:t.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},d=this.editor.textMeasure.measureTextSpans(L3(t.props.name,"Frame")+String.fromCharCode(8203),c),u=d[0],h=Xn(d),p=h.box.w+h.box.x-u.box.x,g=om(this.editor,d,{offsetY:-c.height-2,...c});g.style.setProperty("transform",l);const f=document.createElementNS("http://www.w3.org/2000/svg","rect");return f.setAttribute("x","-8px"),f.setAttribute("y",-c.height-4+"px"),f.setAttribute("width",p+16+"px"),f.setAttribute("height",`${c.height}px`),f.setAttribute("rx","4px"),f.setAttribute("ry","4px"),f.setAttribute("fill",r.background),i.appendChild(f),i.appendChild(g),i}indicator(t){const r=this.editor.getShapeGeometry(t).bounds;return m.jsx("rect",{width:R(r.width),height:R(r.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}y(pm,"type","frame"),y(pm,"props",xF),y(pm,"migrations",_F);function $Z(n,e,t,r){if((n==="start-legacy"||n==="end-legacy")&&t.length!==0){const i=de.From(t[0].box);for(const{box:o}of t)i.union(o);if(n==="start-legacy")return(r-2*e-i.width)/2;if(n==="end-legacy")return-(r-2*e-i.width)/2}}function BZ(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}const z3=re.memo(function({id:n,type:e,text:t,size:r,labelColor:i,font:o,align:s,verticalAlign:a,wrap:l,bounds:c}){const{rInput:d,isEmpty:u,isEditing:h,handleFocus:p,handleChange:g,handleKeyDown:f,handleBlur:w,handleInputPointerDown:v,handleDoubleClick:b}=lS(n,e,t),_=Ds.normalizeTextForDom(t),x=_.length>0,E=BZ(s),k=Xt();return!h&&!x?null:m.jsx("div",{className:"tl-text-label","data-font":o,"data-align":s,"data-hastext":!u,"data-isediting":h,"data-textwrap":!!l,style:{justifyContent:s==="middle"||E?"center":s,alignItems:a==="middle"?"center":a,...c?{top:c.minY,left:c.minX,width:c.width,height:c.height,position:"absolute"}:{}},children:m.jsxs("div",{className:"tl-text-label__inner",style:{fontSize:wc[r],lineHeight:wc[r]*cn.lineHeight+"px",minHeight:cn.lineHeight+32,minWidth:0,color:k[i].solid},children:[m.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",children:_}),h&&m.jsx("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:t,onFocus:p,onChange:g,onKeyDown:f,onBlur:w,onContextMenu:Wt,onPointerDown:v,onDoubleClick:b})]})})});function N3({bounds:n,editor:e,font:t,shape:r}){const i={fontSize:wc[r.props.size],fontFamily:t,textAlign:r.props.align,verticalTextAlign:r.props.verticalAlign,width:Math.ceil(n.width),height:Math.ceil(n.height),padding:16,lineHeight:cn.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0},o=e.textMeasure.measureTextSpans(r.props.text,i),s=$Z(r.props.align,16,o,n.width);return s&&(i.offsetX=s),om(e,o,i)}function In(n){return`${R(n.x)},${R(n.y)} `}function F3(n=""){let e=0,t=0,r=0,i=0;function o(){const s=e^e<<11;return e=t,t=r,r=i,i^=(i>>>19^s^s>>>8)>>>0,i/4294967296*2}for(let s=0;s<n.length+64;s++)e^=n.charCodeAt(s)|0,o();return o}function Yu(n){let e="M";const t=n.length;let r,i,o;for(let s=0,a=t;s<a;s+=3)r=n[s],i=n[s+1],o=n[s+2],e+=`${In(r)}L${In(i)}Q${In(o)}`;return e+=`${In(n[0])}`,e}function Xu(n,e,t,r,i){const o=[],s=F3(n);let a=e[0],l;const c=e.length;for(let d=0,u=c*i;d<u;d++){l=C.AddXY(e[(d+1)%c],s()*t,s()*t);const h=C.Sub(l,a),p=C.Len(h),g=C.Div(h,p).mul(Math.min(p/4,r));o.push(C.Add(a,g),C.Add(l,g.neg()),l),a=l}return o}function fS(n,e,t){let r=`M ${In(e[0])}L`,i=`M ${In(e[0])}L`;const o=t/3,s=t*2,a=F3(n);let l=e[0],c,d=e[0],u;const h=e.length;for(let p=0,g=h-1;p<g;p++){c=e[p+1],u=C.AddXY(e[p+1],a()*o,a()*o);const f=C.Sub(c,l),w=C.Len(f),v=C.Div(f,w).mul(Math.min(w/4,s)),b=C.Add(l,v),_=C.Add(c,v.neg()),x=C.Sub(u,d),E=C.Len(x),k=C.Div(x,E).mul(Math.min(E/4,s)),P=C.Add(d,k),I=C.Add(u,k.neg());p===g-1?(r+=`${In(b)}L ${In(c)}`,i+=`${In(P)}L ${In(u)}`):(r+=`${In(b)}L ${In(_)}Q ${In(c)}`,i+=`${In(P)}L ${In(I)}Q ${In(u)}`,l=c,d=u)}return[r,r+i]}function $3(n,e){const t=Math.min(n,e)/2,r=Math.max(n,e)-t*2;return Math.PI*(t*2)+2*r}function UZ(n,e,t){const r=Math.min(n,e)/2,i=Math.max(n,e)-r*2,o=(Math.PI*(r*2)+2*i)/t,s=n>e?[{type:"straight",start:new C(r,0),delta:new C(1,0)},{type:"arc",center:new C(n-r,r),startAngle:-Ue/2},{type:"straight",start:new C(n-r,e),delta:new C(-1,0)},{type:"arc",center:new C(r,r),startAngle:Ue/2}]:[{type:"straight",start:new C(n,r),delta:new C(0,1)},{type:"arc",center:new C(r,e-r),startAngle:0},{type:"straight",start:new C(0,e-r),delta:new C(0,-1)},{type:"arc",center:new C(r,r),startAngle:Ue}];let a=0;const l=[];for(let c=0;c<t;c++){const d=s[0];d.type==="straight"?l.push(C.Add(d.start,C.Mul(d.delta,a))):l.push(CI(d.center.x,d.center.y,r,d.startAngle+a/r)),a+=o;let u=d.type==="straight"?i:Ue*r;for(;a>u;)a-=u,s.push(s.shift()),u=s[0].type==="straight"?i:Ue*r}return l}const VZ=(n,e,t,r,i)=>{switch(n){case"s":return e;case"m":return t;case"l":return r;case"xl":return i}};function qu(n,e,t,r){const i=vs(t),o=$3(n,e),s=Math.max(Math.ceil(o/VZ(r,50,70,100,130)),6,Math.ceil(o/Math.min(n,e))),a=o/s*.2,l=Math.max(n-a*2,1),c=Math.max(e-a*2,1),d=(n-l)/2,u=(e-c)/2,h=$3(l,c)/s,p=UZ(l,c,s).map(b=>b.addXY(d,u)),g=n<20?0:a*.3,f=e<20?0:a*.3,w=p.slice(0);for(let b=0;b<Math.floor(s/2);b++)w[b]=C.AddXY(w[b],i()*g,i()*f),w[s-b-1]=C.AddXY(w[s-b-1],i()*g,i()*f);const v=[];for(let b=0;b<w.length;b++){const _=b===w.length-1?0:b+1,x=w[b],E=w[_],k=p[b],P=p[_],I=C.Average([k,P]),A=C.Angle(k,P)-Math.PI/2,T=C.Dist(k,P),O=h-T,F=C.Dist(x,E)/T,H=(Math.max(d,u)+O)*F,D=C.Add(I,C.FromAngle(A,H));D.x<0?D.x=0:D.x>n&&(D.x=n),D.y<0?D.y=0:D.y>e&&(D.y=e);const K=B3(x,E,D),B=C.Dist(K||C.Average([x,E]),x);v.push({leftPoint:x,rightPoint:E,arcPoint:D,center:K,radius:B})}return v}function B3(n,e,t){const r=n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y,i=(n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y),o=(n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x),s=-i/(2*r),a=-o/(2*r);return!Number.isFinite(s)||!Number.isFinite(a)?null:new C(s,a)}function HZ(n,e,t,r){const i=[],o=qu(n,e,t,r);for(const{center:s,radius:a,leftPoint:l,rightPoint:c}of o)i.push(...WZ(l,c,s,a,10));return i}function Ju(n,e,t,r){const i=qu(n,e,t,r);let o=`M${R(i[0].leftPoint.x)},${R(i[0].leftPoint.y)}`;for(const{leftPoint:s,rightPoint:a,radius:l,center:c}of i){if(c===null){o+=` L${R(a.x)},${R(a.y)}`;continue}const d=V3(s,a,c)?"0":"1";o+=` A${R(l)},${R(l)} 0 ${d},1 ${R(a.x)},${R(a.y)}`}return o+=" Z",o}function U3(n,e,t,r){const i=vs(t),o=r==="s"?.5:r==="m"?.7:r==="l"?.9:1.6,s=h=>h+i()*o*2,a=qu(n,e,t,r),l=a.reduce((h,p)=>h+C.Dist(p.leftPoint,p.rightPoint),0)/a.length>o*15?h=>new C(s(h.x),s(h.y)):h=>h;let c=`M${R(a[0].leftPoint.x)},${R(a[0].leftPoint.y)}`,d=l(a[0].leftPoint),u=`M${R(d.x)},${R(d.y)}`;for(const{leftPoint:h,center:p,rightPoint:g,radius:f,arcPoint:w}of a){if(p===null){c+=` L${R(g.x)},${R(g.y)}`;const k=l(g);u+=` L${R(k.x)},${R(k.y)}`,d=k;continue}const v=V3(h,g,p)?"0":"1";c+=` A${R(f)},${R(f)} 0 ${v},1 ${R(g.x)},${R(g.y)}`;const b=l(g),_=l(w),x=B3(d,b,_);if(!x){u+=` L${R(b.x)},${R(b.y)}`,d=b;continue}const E=Math.abs(C.Dist(x,d));u+=` A${R(E)},${R(E)} 0 ${v},1 ${R(b.x)},${R(b.y)}`,d=b}return c+u+" Z"}function WZ(n,e,t,r,i){if(t===null)return[C.From(n),C.From(e)];const o=[],s=C.Angle(t,n),a=C.Angle(t,e),l=Zf(s,a);for(let c=0;c<i;c++){const d=c/(i-1),u=s+l*d,h=CI(t.x,t.y,r,u);o.push(h)}return o}function V3(n,e,t){return(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x)>0}const KZ=S.memo(function({dash:n,fill:e,color:t,strokeWidth:r,w:i,h:o,id:s,size:a}){const l=Xt(),c=Ju(i,o,s,a),d=qu(i,o,s,a);return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{theme:l,d:c,fill:e,color:t}),m.jsx("g",{strokeWidth:r,stroke:l[t].solid,fill:"none",pointerEvents:"all",children:d.map(({leftPoint:u,rightPoint:h,center:p,radius:g},f)=>{const w=p?g*si(si(C.Angle(p,h))-si(C.Angle(p,u))):C.Dist(u,h),{strokeDasharray:v,strokeDashoffset:b}=Pn(w,r,{style:n,start:"outset",end:"outset"});return m.jsx("path",{d:p?`M${u.x},${u.y}A${g},${g},0,0,1,${h.x},${h.y}`:`M${u.x},${u.y}L${h.x},${h.y}`,strokeDasharray:v,strokeDashoffset:b},f)})})]})});function GZ({dash:n,fill:e,color:t,theme:r,strokeWidth:i,w:o,h:s,id:a,size:l}){const c=Ju(o,s,a,l),d=qu(o,s,a,l),u=document.createElementNS("http://www.w3.org/2000/svg","g");u.setAttribute("stroke-width",i.toString()),u.setAttribute("stroke",r[t].solid),u.setAttribute("fill","none");for(const{leftPoint:p,rightPoint:g,center:f,radius:w}of d){const v=f?w*si(si(C.Angle(f,g))-si(C.Angle(f,p))):C.Dist(p,g),{strokeDasharray:b,strokeDashoffset:_}=Pn(v,i,{style:n,start:"outset",end:"outset"}),x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttribute("d",f?`M${p.x},${p.y}A${w},${w},0,0,1,${g.x},${g.y}`:`M${p.x},${p.y}L${g.x},${g.y}`),x.setAttribute("stroke-dasharray",b.toString()),x.setAttribute("stroke-dashoffset",_.toString()),u.appendChild(x)}const h=Sr({d:c,fill:e,color:t,theme:r});return pi(u,h)}const YZ=S.memo(function({w:n,h:e,strokeWidth:t,dash:r,color:i,fill:o}){const s=Xt(),a=n/2,l=e/2,c=Math.max(0,a),d=Math.max(0,l),u=yu(c,d),{strokeDasharray:h,strokeDashoffset:p}=Pn(u<64?u*2:u,t,{style:r,snap:4,closed:!0}),g=`M${a-c},${l}a${c},${d},0,1,1,${c*2},0a${c},${d},0,1,1,-${c*2},0`;return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{theme:s,d:g,color:i,fill:o}),m.jsx("path",{d:g,strokeWidth:t,width:R(n),height:R(e),fill:"none",stroke:s[i].solid,strokeDasharray:h,strokeDashoffset:p,pointerEvents:"all"})]})});function XZ({w:n,h:e,strokeWidth:t,dash:r,color:i,theme:o,fill:s}){const a=n/2,l=e/2,c=Math.max(0,a-t/2),d=Math.max(0,l-t/2),u=yu(c,d),{strokeDasharray:h,strokeDashoffset:p}=Pn(u<64?u*2:u,t,{style:r,snap:4,closed:!0}),g=`M${a-c},${l}a${c},${d},0,1,1,${c*2},0a${c},${d},0,1,1,-${c*2},0`,f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d",g),f.setAttribute("stroke-width",t.toString()),f.setAttribute("width",n.toString()),f.setAttribute("height",e.toString()),f.setAttribute("fill","none"),f.setAttribute("stroke",o[i].solid),f.setAttribute("stroke-dasharray",h),f.setAttribute("stroke-dashoffset",p);const w=Sr({d:g,fill:s,color:i,theme:o});return pi(f,w)}function H3(n,e){if(e>n){const r=n/2;return`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${n},${e-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}const t=e/2;return`
    M${t},0
    L${n-t},0
    a${t},${t},0,1,1,0,${t*2}
    L${t},${e}
    a${t},${t},0,1,1,0,${-t*2}
    Z`}function W3(n,e){if(n>e){const r=e/2;return yu(r,r)+(n-r*2)*2}const t=n/2;return yu(t,t)+(e-t*2)*2}const qZ=S.memo(function({w:n,h:e,strokeWidth:t,dash:r,color:i,fill:o}){const s=Xt(),a=H3(n,e),l=W3(n,e),{strokeDasharray:c,strokeDashoffset:d}=Pn(l<64?l*2:l,t,{style:r,snap:4,start:"outset",end:"outset",closed:!0});return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{theme:s,d:a,color:i,fill:o}),m.jsx("path",{d:a,strokeWidth:t,width:R(n),height:R(e),fill:"none",stroke:s[i].solid,strokeDasharray:c,strokeDashoffset:d,pointerEvents:"all"})]})});function K3({w:n,h:e,strokeWidth:t,dash:r,color:i,theme:o,fill:s}){const a=H3(n,e),l=W3(n,e),{strokeDasharray:c,strokeDashoffset:d}=Pn(l<64?l*2:l,t,{style:r,snap:4,closed:!0}),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",a),u.setAttribute("stroke-width",t.toString()),u.setAttribute("width",n.toString()),u.setAttribute("height",e.toString()),u.setAttribute("fill","none"),u.setAttribute("stroke",o[i].solid),u.setAttribute("stroke-dasharray",c),u.setAttribute("stroke-dashoffset",d);const h=Sr({d:a,fill:s,color:i,theme:o});return pi(u,h)}const JZ=S.memo(function({dash:n,fill:e,color:t,strokeWidth:r,outline:i,lines:o}){const s=Xt(),a="M"+i[0]+"L"+i.slice(1)+"Z";return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{theme:s,d:a,fill:e,color:t}),m.jsxs("g",{strokeWidth:r,stroke:s[t].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(i.length)).map((l,c)=>{const d=i[c],u=i[(c+1)%i.length],h=C.Dist(d,u),{strokeDasharray:p,strokeDashoffset:g}=Pn(h,r,{style:n,start:"outset",end:"outset"});return m.jsx("line",{x1:d.x,y1:d.y,x2:u.x,y2:u.y,strokeDasharray:p,strokeDashoffset:g},c)}),o&&o.map(([l,c],d)=>{const u=C.Dist(l,c),{strokeDasharray:h,strokeDashoffset:p}=Pn(u,r,{style:n,start:"skip",end:"outset",snap:n==="dotted"?4:void 0});return m.jsx("path",{d:`M${l.x},${l.y}L${c.x},${c.y}`,stroke:s[t].solid,strokeWidth:r,fill:"none",strokeDasharray:h,strokeDashoffset:p},`line_fg_${d}`)})]})]})});function ZZ({dash:n,fill:e,color:t,theme:r,strokeWidth:i,outline:o,lines:s}){const a=document.createElementNS("http://www.w3.org/2000/svg","g");if(a.setAttribute("stroke-width",i.toString()),a.setAttribute("stroke",r[t].solid),a.setAttribute("fill","none"),Array.from(Array(o.length)).forEach((c,d)=>{const u=o[d],h=o[(d+1)%o.length],p=C.Dist(u,h),{strokeDasharray:g,strokeDashoffset:f}=Pn(p,i,{style:n}),w=document.createElementNS("http://www.w3.org/2000/svg","line");w.setAttribute("x1",u.x.toString()),w.setAttribute("y1",u.y.toString()),w.setAttribute("x2",h.x.toString()),w.setAttribute("y2",h.y.toString()),w.setAttribute("stroke-dasharray",g.toString()),w.setAttribute("stroke-dashoffset",f.toString()),a.appendChild(w)}),s)for(const[c,d]of s){const u=C.Dist(c,d),{strokeDasharray:h,strokeDashoffset:p}=Pn(u,i,{style:n,start:"skip",end:"skip",snap:n==="dotted"?4:2}),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",c.x.toString()),g.setAttribute("y1",c.y.toString()),g.setAttribute("x2",d.x.toString()),g.setAttribute("y2",d.y.toString()),g.setAttribute("stroke-dasharray",h.toString()),g.setAttribute("stroke-dashoffset",p.toString()),a.appendChild(g)}const l=Sr({d:"M"+o[0]+"L"+o.slice(1)+"Z",fill:e,color:t,theme:r});return pi(a,l)}const QZ=S.memo(function({fill:n,color:e,strokeWidth:t,w:r,h:i,id:o,size:s}){const a=Xt(),l=U3(r,i,o,s);return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{theme:a,d:l,fill:n,color:e}),m.jsx("path",{d:l,stroke:a[e].solid,strokeWidth:t,fill:"none"})]})});function eQ({fill:n,color:e,strokeWidth:t,theme:r,w:i,h:o,id:s,size:a}){const l=U3(i,o,s,a),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",t.toString()),c.setAttribute("stroke",r[e].solid),c.setAttribute("fill","none");const d=Sr({d:l,fill:n,color:e,theme:r});return pi(c,d)}S.memo(function({id:n,w:e,h:t,strokeWidth:r,fill:i,color:o}){const s=Xt(),a=gS(n,e,t,r),l=X3(n,e,t,r);return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{theme:s,d:a,color:o,fill:i}),m.jsx("path",{d:l,fill:s[o].solid,strokeWidth:0,pointerEvents:"all"})]})});function tQ({id:n,w:e,h:t,strokeWidth:r,fill:i,color:o,theme:s}){const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",X3(n,e,t,r)),a.setAttribute("fill",s[o].solid);const l=Sr({d:gS(n,e,t,r),fill:i,color:o,theme:s});return pi(a,l)}function G3(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function Y3(n,e,t,r){const i=vs(n),o=e/2,s=t/2,a=yu(o,s),l=[],c=Xe*i(),d=Xe+at/2+Math.abs(i())*at,u=Math.max(16,a/10);for(let h=0;h<u;h++){const p=h/(u-1),g=c+p*d,f=Math.cos(g),w=Math.sin(g);l.push(new C(o*f+e*.5+.05*i(),s*w+t/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?_n.easeInOutSine(p):_n.easeInExpo(p)))/2)))}return hi(l,G3(r))}function X3(n,e,t,r){const i=G3(r);return xu(Bu(yc(Y3(n,e,t,r),i),i))}function gS(n,e,t,r){return Os(Y3(n,e,t,r))}const nQ=S.memo(function({id:n,outline:e,lines:t,fill:r,color:i,strokeWidth:o}){const s=Xt(),a=Xu(n,e,o/3,o*2,2);let l=Yu(a);if(t)for(const[u,h]of t)l+=`M${u.x},${u.y}L${h.x},${h.y}`;const c=Xu(n,e,0,o*2,1),d=Yu(c);return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{d,fill:r,color:i,theme:s}),m.jsx("path",{d:l,stroke:s[i].solid,strokeWidth:o,fill:"none"})]})});function rQ({id:n,outline:e,lines:t,fill:r,color:i,theme:o,strokeWidth:s}){const a=Xu(n,e,s/3,s*2,2);let l=Yu(a);if(t)for(const[p,g]of t)l+=`M${p.x},${p.y}L${g.x},${g.y}`;const c=Xu(n,e,0,s*2,1),d=Yu(c),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",l),u.setAttribute("fill","none"),u.setAttribute("stroke",o[i].solid),u.setAttribute("stroke-width",s.toString());const h=Sr({d,fill:r,color:i,theme:o});return pi(u,h)}const iQ=S.memo(function({fill:n,color:e,strokeWidth:t,w:r,h:i,id:o,size:s}){const a=Xt(),l=Ju(r,i,o,s);return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{theme:a,d:l,fill:n,color:e}),m.jsx("path",{d:l,stroke:a[e].solid,strokeWidth:t,fill:"none"})]})});function oQ({fill:n,color:e,strokeWidth:t,theme:r,w:i,h:o,id:s,size:a}){const l=Ju(i,o,s,a),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",t.toString()),c.setAttribute("stroke",r[e].solid),c.setAttribute("fill","none");const d=Sr({d:l,fill:n,color:e,theme:r});return pi(c,d)}const q3=S.memo(function({w:n,h:e,strokeWidth:t,fill:r,color:i}){const o=Xt(),s=n/2,a=e/2,l=Math.max(0,s),c=Math.max(0,a),d=`M${s-l},${a}a${l},${c},0,1,1,${l*2},0a${l},${c},0,1,1,-${l*2},0`;return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{d,color:i,fill:r,theme:o}),m.jsx("path",{d,stroke:o[i].solid,strokeWidth:t,fill:"none"})]})});function sQ({w:n,h:e,strokeWidth:t,fill:r,color:i,theme:o}){const s=n/2,a=e/2,l=Math.max(0,s),c=Math.max(0,a),d=`M${s-l},${a}a${l},${c},0,1,1,${l*2},0a${l},${c},0,1,1,-${l*2},0`,u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",d),u.setAttribute("stroke-width",t.toString()),u.setAttribute("width",n.toString()),u.setAttribute("height",e.toString()),u.setAttribute("fill","none"),u.setAttribute("stroke",o[i].solid);const h=Sr({d,fill:r,color:i,theme:o});return pi(u,h)}const J3=S.memo(function({w:n,h:e,strokeWidth:t,fill:r,color:i}){const o=Xt(),s=mS(n,e);return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{d:s,color:i,fill:r,theme:o}),m.jsx("path",{d:s,stroke:o[i].solid,strokeWidth:t,fill:"none"})]})});function aQ({w:n,h:e,strokeWidth:t,fill:r,color:i,theme:o}){const s=mS(n,e),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",s),a.setAttribute("stroke-width",t.toString()),a.setAttribute("width",n.toString()),a.setAttribute("height",e.toString()),a.setAttribute("fill","none"),a.setAttribute("stroke",o[i].solid);const l=Sr({d:s,fill:r,color:i,theme:o});return pi(a,l)}function mS(n,e){let t;if(e>n){const r=n/2;t=`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${n},${e-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}else{const r=e/2;t=`
    M${r},0
    L${n-r},0
    a${r},${r},0,1,1,0,${r*2}
    L${r},${e}
    a${r},${r},0,1,1,0,${-r*2}
    Z`}return t}const lQ=S.memo(function({outline:n,lines:e,fill:t,color:r,strokeWidth:i}){const o=Xt();let s="M"+n[0]+"L"+n.slice(1)+"Z";if(e)for(const[a,l]of e)s+=`M${a.x},${a.y}L${l.x},${l.y}`;return m.jsxs(m.Fragment,{children:[m.jsx(Dt,{d:s,fill:t,color:r,theme:o}),m.jsx("path",{d:s,stroke:o[r].solid,strokeWidth:i,fill:"none"})]})});function cQ({outline:n,lines:e,fill:t,color:r,strokeWidth:i,theme:o}){const s="M"+n[0]+"L"+n.slice(1)+"Z",a=s;let l=s;if(e)for(const[u,h]of e)l+=`M${u.x},${u.y}L${h.x},${h.y}`;const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",i.toString()),c.setAttribute("stroke",o[r].solid),c.setAttribute("fill","none");const d=Sr({d:a,fill:t,color:r,theme:o});return pi(c,d)}const yS=16,Ur=17*3;class fm extends ac{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t;o.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])});y(this,"onResize",(t,{handle:r,newPoint:i,scaleX:o,scaleY:s,initialShape:a})=>{let l=a.props.w*o,c=(a.props.h+a.props.growY)*s,d=0,u=0;if(t.props.text.trim()){let f=Math.max(Math.abs(l),Ur),w=Math.max(Math.abs(c),Ur);f<Ur&&w===Ur&&(f=Ur),f===Ur&&w<Ur&&(w=Ur);const v=gm(this.editor,{...t,props:{...t.props,w:f,h:w}}),b=Math.max(Math.abs(l),v.w)*Math.sign(l),_=Math.max(Math.abs(c),v.h)*Math.sign(c);d=Math.abs(b)-Math.abs(l),u=Math.abs(_)-Math.abs(c),l=b,c=_}const h=new C(0,0);o<0&&(h.x+=l),(r==="left"||r==="top_left"||r==="bottom_left")&&(h.x+=o<0?d:-d),s<0&&(h.y+=c),(r==="top"||r==="top_left"||r==="top_right")&&(h.y+=s<0?u:-u);const{x:p,y:g}=h.rot(t.rotation).add(i);return{x:p,y:g,props:{w:Math.max(Math.abs(l),1),h:Math.max(Math.abs(c),1),growY:0}}});y(this,"onBeforeCreate",t=>{if(!t.props.text)return t.props.growY?{...t,props:{...t.props,growY:0}}:void 0;const r=t.props.h,i=gm(this.editor,t).h;let o=null;if(i>r?o=i-r:t.props.growY&&(o=0),o!==null)return{...t,props:{...t.props,growY:o}}});y(this,"onBeforeUpdate",(t,r)=>{const i=t.props.text,o=r.props.text;if(i===o&&t.props.font===r.props.font&&t.props.size===r.props.size)return;if(i&&!o)return{...r,props:{...r.props,growY:0}};const s=t.props.w,a=t.props.h,l=gm(this.editor,r),c=l.w,d=l.h;if(!i&&o&&o.length===1){let h=Math.max(s,c),p=Math.max(a,d);return t.props.w<Ur&&t.props.h<Ur&&(h=Math.max(h,Ur),p=Math.max(p,Ur),h=Math.max(h,p),p=Math.max(h,p)),{...r,props:{...r.props,w:h,h:p,growY:0}}}let u=null;if(d>a?u=d-a:t.props.growY&&(u=0),u!==null)return{...r,props:{...r.props,growY:u,w:Math.max(r.props.w,c)}};if(c>t.props.w)return{...r,props:{...r.props,w:c}}});y(this,"onDoubleClick",t=>{if(this.editor.inputs.altKey)switch(t.props.geo){case"rectangle":return{...t,props:{geo:"check-box"}};case"check-box":return{...t,props:{geo:"rectangle"}}}})}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:""}}getGeometry(t){const r=Math.max(1,t.props.w),i=Math.max(1,t.props.h+t.props.growY),o=r/2,s=i/2,a=En[t.props.size],l=t.props.fill!=="none";let c;switch(t.props.geo){case"cloud":{c=new Gt({points:HZ(r,i,t.id,t.props.size),isFilled:l});break}case"triangle":{c=new Gt({points:[new C(o,0),new C(r,i),new C(0,i)],isFilled:l});break}case"diamond":{c=new Gt({points:[new C(o,0),new C(r,s),new C(o,i),new C(0,s)],isFilled:l});break}case"pentagon":{c=new Gt({points:pv(r,i,5),isFilled:l});break}case"hexagon":{c=new Gt({points:pv(r,i,6),isFilled:l});break}case"octagon":{c=new Gt({points:pv(r,i,8),isFilled:l});break}case"ellipse":{c=new wA({width:r,height:i,isFilled:l});break}case"oval":{c=new cH({width:r,height:i,isFilled:l});break}case"star":{const f=Xe/5/2,w=Math.floor(5/4)*2,v=5*2-w,b=0,_=Math.floor(5/2)*2,x=Math.cos(-at+w*f)*r/2,E=Math.cos(-at+v*f)*r/2,k=Math.sin(-at+b*f)*i/2,P=Math.sin(-at+_*f)*i/2,I=r-Math.abs(x-E),A=i-Math.abs(P-k),T=r/2+E-(r/2-x),O=i/2+k-(i/2-P),F=1,H=(r-T)/2,D=(i-O)/2,K=(r+I)/2,B=(i+A)/2,te=K*F/2,W=B*F/2;c=new Gt({points:Array.from(Array(5*2)).map((N,Y)=>{const ee=-at+Y*f;return new C(H+(Y%2?te:K)*Math.cos(ee),D+(Y%2?W:B)*Math.sin(ee))}),isFilled:l});break}case"rhombus":{const f=Math.min(r*.38,i*.38);c=new Gt({points:[new C(f,0),new C(r,0),new C(r-f,i),new C(0,i)],isFilled:l});break}case"rhombus-2":{const f=Math.min(r*.38,i*.38);c=new Gt({points:[new C(0,0),new C(r-f,0),new C(r,i),new C(f,i)],isFilled:l});break}case"trapezoid":{const f=Math.min(r*.38,i*.38);c=new Gt({points:[new C(f,0),new C(r-f,0),new C(r,i),new C(0,i)],isFilled:l});break}case"arrow-right":{const f=Math.min(r,i)*.38,w=i*.16;c=new Gt({points:[new C(0,w),new C(r-f,w),new C(r-f,0),new C(r,i/2),new C(r-f,i),new C(r-f,i-w),new C(0,i-w)],isFilled:l});break}case"arrow-left":{const f=Math.min(r,i)*.38,w=i*.16;c=new Gt({points:[new C(f,0),new C(f,w),new C(r,w),new C(r,i-w),new C(f,i-w),new C(f,i),new C(0,i/2)],isFilled:l});break}case"arrow-up":{const f=r*.16,w=Math.min(r,i)*.38;c=new Gt({points:[new C(r/2,0),new C(r,w),new C(r-f,w),new C(r-f,i),new C(f,i),new C(f,w),new C(0,w)],isFilled:l});break}case"arrow-down":{const f=r*.16,w=Math.min(r,i)*.38;c=new Gt({points:[new C(f,0),new C(r-f,0),new C(r-f,i-w),new C(r,i-w),new C(r/2,i),new C(0,i-w),new C(f,i-w)],isFilled:l});break}case"check-box":case"x-box":case"rectangle":{c=new ks({width:r,height:i,isFilled:l,isSnappable:!0});break}}const d=gm(this.editor,t),u=Math.min(r,Math.max(d.w,Math.min(32,Math.max(1,r-8)))),h=Math.min(i,Math.max(d.h,Math.min(32,Math.max(1,r-8)))),p=mm(t.props,a),g=p?p.map(f=>new Ea({points:f})):[];return new _s({children:[c,new ks({x:t.props.align==="start"?0:t.props.align==="end"?r-u:(r-u)/2,y:t.props.verticalAlign==="start"?0:t.props.verticalAlign==="end"?i-h:(i-h)/2,width:u,height:h,isFilled:!0,isSnappable:!1,isLabel:!0}),...g],isSnappable:!1})}component(t){const{id:r,type:i,props:o}=t,s=En[o.size],{w:a,color:l,labelColor:c,fill:d,dash:u,growY:h,font:p,align:g,verticalAlign:f,size:w,text:v}=o,b=()=>{const _=o.h+h;switch(o.geo){case"cloud":{if(u==="solid")return m.jsx(iQ,{color:l,fill:d,strokeWidth:s,w:a,h:_,id:r,size:w});if(u==="dashed"||u==="dotted")return m.jsx(KZ,{color:l,fill:d,strokeWidth:s,w:a,h:_,id:r,size:w,dash:u});if(u==="draw")return m.jsx(QZ,{color:l,fill:d,strokeWidth:s,w:a,h:_,id:r,size:w});break}case"ellipse":{if(u==="solid")return m.jsx(q3,{strokeWidth:s,w:a,h:_,color:l,fill:d});if(u==="dashed"||u==="dotted")return m.jsx(YZ,{id:r,strokeWidth:s,w:a,h:_,dash:u,color:l,fill:d});if(u==="draw")return m.jsx(q3,{strokeWidth:s,w:a,h:_,color:l,fill:d});break}case"oval":{if(u==="solid")return m.jsx(J3,{strokeWidth:s,w:a,h:_,color:l,fill:d});if(u==="dashed"||u==="dotted")return m.jsx(qZ,{id:r,strokeWidth:s,w:a,h:_,dash:u,color:l,fill:d});if(u==="draw")return m.jsx(J3,{strokeWidth:s,w:a,h:_,color:l,fill:d});break}default:{const x=this.editor.getShapeGeometry(t),E=x instanceof _s?x.children[0].vertices:x.vertices,k=mm(t.props,s);if(u==="solid")return m.jsx(lQ,{fill:d,color:l,strokeWidth:s,outline:E,lines:k});if(u==="dashed"||u==="dotted")return m.jsx(JZ,{dash:u,fill:d,color:l,strokeWidth:s,outline:E,lines:k});if(u==="draw")return m.jsx(nQ,{id:r,fill:d,color:l,strokeWidth:s,outline:E,lines:k})}}};return m.jsxs(m.Fragment,{children:[m.jsx(yr,{id:r,children:b()}),m.jsxs(Aa,{id:t.id,style:{overflow:"hidden",width:t.props.w,height:t.props.h+o.growY},children:[m.jsx(z3,{id:r,type:i,font:p,fill:d,size:w,align:g,verticalAlign:f,text:v,labelColor:c,wrap:!0,bounds:o.geo==="cloud"?this.getGeometry(t).bounds:void 0}),t.props.url&&m.jsx(Gu,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(t){const{id:r,props:i}=t,{w:o,size:s}=i,a=i.h+i.growY,l=En[s];switch(i.geo){case"ellipse":return i.dash==="draw"?m.jsx("path",{d:gS(r,o,a,l)}):m.jsx("ellipse",{cx:o/2,cy:a/2,rx:o/2,ry:a/2});case"oval":return m.jsx("path",{d:mS(o,a)});case"cloud":return m.jsx("path",{d:Ju(o,a,r,s)});default:{const c=this.editor.getShapeGeometry(t),d=c instanceof _s?c.children[0].vertices:c.vertices;let u;if(i.dash==="draw"){const p=Xu(r,d,0,l*2,1);u=Yu(p)}else u="M"+d[0]+"L"+d.slice(1)+"Z";const h=mm(t.props,l);if(h)for(const[p,g]of h)u+=`M${p.x},${p.y}L${g.x},${g.y}`;return m.jsx("path",{d:u})}}}toSvg(t,r){const{id:i,props:o}=t,s=En[o.size],a=Qn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(iS(t.props.fill,a));let l;switch(o.geo){case"ellipse":{switch(o.dash){case"draw":l=tQ({id:i,w:o.w,h:o.h,color:o.color,fill:o.fill,strokeWidth:s,theme:a});break;case"solid":l=sQ({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,theme:a});break;default:l=XZ({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a});break}break}case"oval":{switch(o.dash){case"draw":l=K3({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a});break;case"solid":l=aQ({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,theme:a});break;default:l=K3({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a})}break}case"cloud":{switch(o.dash){case"draw":l=eQ({id:i,strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,size:o.size,theme:a});break;case"solid":l=oQ({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,size:o.size,id:i,theme:a});break;default:l=GZ({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a,size:o.size})}break}default:{const c=this.editor.getShapeGeometry(t),d=c instanceof _s?c.children[0].vertices:c.vertices,u=mm(t.props,s);switch(o.dash){case"draw":l=rQ({id:i,fill:o.fill,color:o.color,strokeWidth:s,outline:d,lines:u,theme:a});break;case"solid":l=cQ({fill:o.fill,color:o.color,strokeWidth:s,outline:d,lines:u,theme:a});break;default:l=ZZ({dash:o.dash,fill:o.fill,color:o.color,strokeWidth:s,outline:d,lines:u,theme:a});break}break}}if(o.text){const c=this.editor.getShapeGeometry(t).bounds;r.addExportDef(sm(t.props.font));const d=N3({editor:this.editor,shape:t,font:au[t.props.font],bounds:c}),u=d.cloneNode(!0);u.setAttribute("fill",a[t.props.labelColor].solid),u.setAttribute("stroke","none");const h=d.cloneNode(!0);h.setAttribute("stroke-width","2"),h.setAttribute("fill",a.background),h.setAttribute("stroke",a.background);const p=document.createElementNS("http://www.w3.org/2000/svg","g");if(p.append(h),p.append(u),l.nodeName==="g")return l.appendChild(p),l;{const g=document.createElementNS("http://www.w3.org/2000/svg","g");return g.appendChild(l),g.appendChild(p),g}}return l}getCanvasSvgDefs(){return[oS()]}}y(fm,"type","geo"),y(fm,"props",kF),y(fm,"migrations",CF);function gm(n,e){const t=e.props.text;if(!t)return{w:0,h:0};const r=n.textMeasure.measureText("w",{...cn,fontFamily:Ro[e.props.font],fontSize:wc[e.props.size],maxWidth:100}),i={s:2,m:3.5,l:5,xl:10},o=n.textMeasure.measureText(t,{...cn,fontFamily:Ro[e.props.font],fontSize:wc[e.props.size],minWidth:r.w+"px",maxWidth:Math.max(0,Math.ceil(r.w+i[e.props.size]),Math.ceil(e.props.w-yS*2))});return{w:o.w+yS*2,h:o.h+yS*2}}function mm(n,e){switch(n.geo){case"x-box":return dQ(n.w,n.h,e,n.dash);case"check-box":return uQ(n.w,n.h);default:return}}function dQ(n,e,t,r){const i=r==="draw"?.62:0;if(r==="dashed")return[[new C(0,0),new C(n/2,e/2)],[new C(n,e),new C(n/2,e/2)],[new C(0,e),new C(n/2,e/2)],[new C(n,0),new C(n/2,e/2)]];const o=a=>Math.max(0,Math.min(n,a)),s=a=>Math.max(0,Math.min(e,a));return[[new C(o(t*i),s(t*i)),new C(o(n-t*i),s(e-t*i))],[new C(o(t*i),s(e-t*i)),new C(o(n-t*i),s(t*i))]]}function uQ(n,e){const t=Math.min(n,e)*.82,r=(n-t)/2,i=(e-t)/2,o=a=>Math.max(0,Math.min(n,a)),s=a=>Math.max(0,Math.min(e,a));return[[new C(o(r+t*.25),s(i+t*.52)),new C(o(r+t*.45),s(i+t*.82))],[new C(o(r+t*.45),s(i+t*.82)),new C(o(r+t*.82),s(i+t*.22))]]}function hQ(){const[n,e]=S.useState(!1);return S.useEffect(()=>{const t=CSS.supports("color","color(display-p3 1 1 1)"),r=matchMedia("(color-gamut: p3)");e(t&&r.matches);const i=()=>e(t&&r.matches);return r.addEventListener("change",i),()=>r.removeEventListener("change",i)},[]),q(st.forceSrgb)||!n?"srgb":"p3"}const Z3=.35,Q3=.82;class ym extends ci{constructor(){super(...arguments);y(this,"hideResizeHandles",t=>wm(t));y(this,"hideRotateHandle",t=>wm(t));y(this,"hideSelectionBoundsFg",t=>wm(t));y(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=[];for(const a of t.props.segments)s.push({...a,points:a.points.map(({x:l,y:c,z:d})=>({x:i*l,y:o*c,z:d}))});return{props:{segments:s}}})}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1}}getGeometry(t){const r=_c(t);if(wm(t))return new yA({x:-r/2,y:-r/2,radius:r/2,isFilled:!0});const{strokePoints:i,sw:o}=ej(t,r,!0),s=uS({strokeWidth:o,showAsComplete:!0});return yc(i,s),new Gt({points:Bu(i,s),isFilled:!0})}component(t){return m.jsx(nj,{strokeWidth:_c(t),shape:t,opacity:Z3})}backgroundComponent(t){return m.jsx(nj,{strokeWidth:_c(t),shape:t,opacity:Q3})}indicator(t){var u;const r=cm(),i=_c(t),o=xc(t.props.segments);let s=i;!r&&!t.props.isPen&&o.length===1&&(s+=vs(t.id)()*(i/6));const a=t.props.isComplete||((u=Xn(t.props.segments))==null?void 0:u.type)==="straight",l=uS({strokeWidth:i,showAsComplete:a}),c=hi(o,l);let d;return c.length<2?d=fQ(o[0],s):d=Os(c,!1),m.jsx("path",{d})}toSvg(t){const r=Qn({isDarkMode:this.editor.user.getIsDarkMode()});return rj(_c(t),t,Z3,r)}toBackgroundSvg(t){const r=Qn({isDarkMode:this.editor.user.getIsDarkMode()});return rj(_c(t),t,Q3,r)}}y(ym,"type","highlight"),y(ym,"props",IF),y(ym,"migrations",MF);function pQ(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function fQ(n,e){const t=e/2;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function ej(n,e,t){var a;const r=xc(n.props.segments),i=n.props.isComplete||((a=Xn(n.props.segments))==null?void 0:a.type)==="straight";let o=e;!t&&!n.props.isPen&&r.length===1&&(o+=vs(n.id)()*(e/6));const s=uS({strokeWidth:o,showAsComplete:i});return{strokePoints:hi(r,s),sw:o}}function tj(n,e,t){const{strokePoints:r,sw:i}=ej(n,e,t);return{solidStrokePath:r.length>1?Os(r,!1):pQ(n.props.segments[0].points[0]),sw:i}}function nj({strokeWidth:n,shape:e,opacity:t}){const r=Xt(),i=cm(),{solidStrokePath:o,sw:s}=tj(e,n,i),a=hQ(),l=r[e.props.color].highlight[a];return m.jsx(yr,{id:e.id,style:{opacity:t},children:m.jsx("path",{d:o,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:l,strokeWidth:s})})}function rj(n,e,t,r){const{solidStrokePath:i,sw:o}=tj(e,n,!1),s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",i),s.setAttribute("fill","none"),s.setAttribute("stroke",r[e.props.color].highlight.srgb),s.setAttribute("stroke-width",`${o}`),s.setAttribute("opacity",`${t}`),s}function _c(n){return js[n.props.size]*1.12}function wm(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function ij(){const[n,e]=S.useState(!1);return S.useEffect(()=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(t.matches)};return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[]),n}const gQ=async n=>new Promise((e,t)=>{const r=new Image;r.onload=()=>e(r),r.onerror=()=>t(new Error("Failed to load image")),r.crossOrigin="anonymous",r.src=n}),mQ=async n=>{const e=await gQ(n),t=document.createElement("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");if(r)return r.drawImage(e,0,0),t.toDataURL()};async function yQ(n){const e=await(await fetch(n)).blob();return new Promise((t,r)=>{const i=new FileReader;i.onloadend=()=>t(i.result),i.onerror=r,i.readAsDataURL(e)})}class bm extends ac{constructor(){super(...arguments);y(this,"isAspectRatioLocked",()=>!0);y(this,"canCrop",()=>!0);y(this,"onDoubleClick",t=>{const r=t.props.assetId?this.editor.getAsset(t.props.assetId):void 0;!r||!(r.props.src&&"mimeType"in r.props&&r.props.mimeType==="image/gif")||this.editor.updateShapes([{type:"image",id:t.id,props:{playing:!t.props.playing}}])});y(this,"onDoubleClickEdge",t=>{const r=t.props;if(!r||this.editor.getCroppingShapeId()!==t.id)return;const i=bn(r.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},o=1/(i.bottomRight.x-i.topLeft.x)*t.props.w,s=1/(i.bottomRight.y-i.topLeft.y)*t.props.h,a=new C(i.topLeft.x*o,i.topLeft.y*s).rot(t.rotation),l={id:t.id,type:t.type,x:t.x-a.x,y:t.y-a.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:o,h:s}};this.editor.updateShapes([l])})}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}component(t){var u,h;const r=oj(t),i=gA(t.id),o=ij(),[s,a]=S.useState(""),l=t.props.assetId?this.editor.getAsset(t.props.assetId):void 0;if((l==null?void 0:l.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const c=q("onlySelectedShape",()=>{var p;return t.id===((p=this.editor.getOnlySelectedShape())==null?void 0:p.id)},[this.editor])&&i&&this.editor.isInAny("select.crop","select.cropping","select.pointing_crop_handle"),d=o&&(((u=l==null?void 0:l.props.mimeType)==null?void 0:u.includes("video"))||((h=l==null?void 0:l.props.mimeType)==null?void 0:h.includes("gif")));return S.useEffect(()=>{if(l!=null&&l.props.src&&"mimeType"in l.props&&(l==null?void 0:l.props.mimeType)==="image/gif"){let p=!1;return(async()=>{const g=await mQ(l.props.src);p||g&&a(g)})(),()=>{p=!0}}},[o,l==null?void 0:l.props]),m.jsxs(m.Fragment,{children:[(l==null?void 0:l.props.src)&&c&&m.jsx("div",{style:r,children:m.jsx("div",{className:"tl-image",style:{opacity:.1,backgroundImage:`url(${!t.props.playing||d?s:l.props.src})`},draggable:!1})}),m.jsxs(Aa,{id:t.id,style:{overflow:"hidden",width:t.props.w,height:t.props.h},children:[m.jsxs("div",{className:"tl-image-container",style:r,children:[l!=null&&l.props.src?m.jsx("div",{className:"tl-image",style:{backgroundImage:`url(${!t.props.playing||d?s:l.props.src})`},draggable:!1}):null,(l==null?void 0:l.props.isAnimated)&&!t.props.playing&&m.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),"url"in t.props&&t.props.url&&m.jsx(Gu,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(t){return gA(t.id)?null:m.jsx("rect",{width:R(t.props.w),height:R(t.props.h)})}async toSvg(t){var l;const r=document.createElementNS("http://www.w3.org/2000/svg","g");let i=((l=t.props.assetId?this.editor.getAsset(t.props.assetId):null)==null?void 0:l.props.src)||"";i&&i.startsWith("http")&&(i=await yQ(i)||"");const o=document.createElementNS("http://www.w3.org/2000/svg","image");o.setAttributeNS("http://www.w3.org/1999/xlink","href",i);const s=oj(t),a=t.props.crop;if(s.transform&&a){const{transform:c,width:d,height:u}=s,h=(a.bottomRight.x-a.topLeft.x)*d,p=(a.bottomRight.y-a.topLeft.y)*u,g=[new C(0,0),new C(h,0),new C(h,p),new C(0,p)],f=document.createElementNS("http://www.w3.org/2000/svg","polygon");f.setAttribute("points",g.map(_=>`${_.x},${_.y}`).join(" "));const w=document.createElementNS("http://www.w3.org/2000/svg","clipPath");w.setAttribute("id","cropClipPath"),w.appendChild(f);const v=document.createElementNS("http://www.w3.org/2000/svg","defs");v.appendChild(w),r.appendChild(v);const b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttribute("clip-path","url(#cropClipPath)"),o.setAttribute("width",d.toString()),o.setAttribute("height",u.toString()),o.style.transform=c,b.appendChild(o),r.appendChild(b)}else o.setAttribute("width",t.props.w.toString()),o.setAttribute("height",t.props.h.toString()),r.appendChild(o);return r}}y(bm,"type","image"),y(bm,"props",TF),y(bm,"migrations",jF);function oj(n){const e=n.props.crop,t=e==null?void 0:e.topLeft;if(!t)return{width:n.props.w,height:n.props.h};const r=1/(e.bottomRight.x-e.topLeft.x)*n.props.w,i=1/(e.bottomRight.y-e.topLeft.y)*n.props.h,o=-t.x*r,s=-t.y*i;return{transform:`translate(${o}px, ${s}px)`,width:r,height:i}}function wS(n,e){const{start:t,end:r}=n;return e?`M${R(t.x)},${R(t.y)} L${R(r.x)},${R(r.y)} `:`${R(r.x)},${R(r.y)} `}function bS(n,e){const{a:t,b:r,c:i,d:o}=n;return C.Equals(t,o)?"":`${e?`M${R(t.x)},${R(t.y)}`:""}C${R(r.x)},${R(r.y)} ${R(i.x)},${R(i.y)} ${R(o.x)},${R(o.y)}`}function sj(n,e){let t=n.segments.reduce((r,i,o)=>r+bS(i,o===0),"");return e&&(t+="Z"),t}function wQ(n,e){let t=n.segments.reduce((r,i,o)=>r+wS(i,o===0),"");return e&&(t+="Z"),t}function aj(n,e=!1){return n instanceof Ea?wQ(n,e):sj(n,e)}function lj(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function cj(n,e,t){const r=e.vertices,i=lj(t);return hi(r,i)}function bQ(n,e,t){const r=lj(t);return Bu(yc(cj(n,e,t),r),r)}function dj(n,e,t){const r=bQ(n,e,t);return xu(r)}function vQ(n,e,t){if(n.props.dash==="draw"){const r=cj(n,e,t);return Os(r)}return aj(e)}const SQ=new Rv;class vm extends ci{constructor(){super(...arguments);y(this,"hideResizeHandles",()=>!0);y(this,"hideRotateHandle",()=>!0);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"hideSelectionBoundsBg",()=>!0);y(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=bn(t.props.handles);return Object.values(t.props.handles).forEach(({id:a,x:l,y:c})=>{s[a].x=l*i,s[a].y=c*o}),{props:{handles:s}}});y(this,"onHandleChange",(t,{handle:r})=>{const i=bn(t);switch(r.id){case"start":case"end":{i.props.handles[r.id]={...i.props.handles[r.id],x:r.x,y:r.y};break}default:{const o="handle:"+r.index,s=t.props.handles[o];s?i.props.handles[o]={...s,x:r.x,y:r.y}:i.props.handles[o]={id:o,type:"vertex",canBind:!1,index:r.index,x:r.x,y:r.y};break}}return i})}getDefaultProps(){return{dash:"draw",size:"m",color:"black",spline:"line",handles:{start:{id:"start",type:"vertex",canBind:!1,canSnap:!0,index:"a1",x:0,y:0},end:{id:"end",type:"vertex",canBind:!1,canSnap:!0,index:"a2",x:.1,y:.1}}}}getGeometry(t){return Zu(t)}getHandles(t){return SQ.get(t.props,()=>{const r=t.props.handles,i=Zu(t),o=Object.values(r).sort(Cn),s=o.slice();for(let a=0;a<i.segments.length;a++){const l=i.segments[a].midPoint(),c=Mu(o[a].index,o[a+1].index);s.push({id:`mid-${a}`,type:"create",index:c,x:l.x,y:l.y})}return s.sort(Cn)})}getOutlineSegments(t){return this.editor.getShapeGeometry(t).segments.map(r=>r.vertices)}component(t){const r=Xt(),i=Zu(t),o=En[t.props.size],{dash:s,color:a}=t.props;if(t.props.spline==="line"){if(s==="solid"){const l=i.points,c="M"+l[0]+"L"+l.slice(1);return m.jsxs(yr,{id:t.id,children:[m.jsx(Dt,{d:c,fill:"none",color:a,theme:r}),m.jsx("path",{d:c,stroke:r[a].solid,strokeWidth:o,fill:"none"})]})}if(s==="dashed"||s==="dotted"){const l=i.points,c="M"+l[0]+"L"+l.slice(1);return m.jsxs(yr,{id:t.id,children:[m.jsx(Dt,{d:c,fill:"none",color:a,theme:r}),m.jsx("g",{stroke:r[a].solid,strokeWidth:o,children:i.segments.map((d,u)=>{const{strokeDasharray:h,strokeDashoffset:p}=Pn(d.length,o,{style:s,start:u>0?"outset":"none",end:u<i.segments.length-1?"outset":"none"});return m.jsx("path",{strokeDasharray:h,strokeDashoffset:p,d:wS(d,!0),fill:"none"},u)})})]})}if(s==="draw"){const l=i.points,[c,d]=fS(t.id,l,o);return m.jsxs(yr,{id:t.id,children:[m.jsx(Dt,{d:c,fill:"none",color:a,theme:r}),m.jsx("path",{d,stroke:r[a].solid,strokeWidth:o,fill:"none"})]})}}if(t.props.spline==="cubic"){const l=aj(i);if(s==="solid")return m.jsxs(yr,{id:t.id,children:[m.jsx(Dt,{d:l,fill:"none",color:a,theme:r}),m.jsx("path",{strokeWidth:o,stroke:r[a].solid,fill:"none",d:l})]});if(s==="dashed"||s==="dotted")return m.jsxs(yr,{id:t.id,children:[m.jsx(Dt,{d:l,fill:"none",color:a,theme:r}),m.jsx("g",{stroke:r[a].solid,strokeWidth:o,children:i.segments.map((c,d)=>{const{strokeDasharray:u,strokeDashoffset:h}=Pn(c.length,o,{style:s,start:d>0?"outset":"none",end:d<i.segments.length-1?"outset":"none"});return m.jsx("path",{strokeDasharray:u,strokeDashoffset:h,d:bS(c,!0),fill:"none"},d)})})]});if(s==="draw")return m.jsxs(yr,{id:t.id,children:[m.jsx(Dt,{d:l,fill:"none",color:a,theme:r}),m.jsx("path",{d:dj(t,i,o),strokeWidth:1,stroke:r[a].solid,fill:r[a].solid})]})}}indicator(t){const r=En[t.props.size],i=Zu(t),{dash:o}=t.props;let s;if(t.props.spline==="line"){const a=i.points;if(o==="solid"||o==="dotted"||o==="dashed")s="M"+a[0]+"L"+a.slice(1);else{const[l]=fS(t.id,a,r);s=l}}else s=vQ(t,i,r);return m.jsx("path",{d:s})}toSvg(t){const r=Qn({isDarkMode:this.editor.user.getIsDarkMode()})[t.props.color].solid,i=Zu(t),o=En[t.props.size];switch(t.props.dash){case"draw":{let s;if(i instanceof Mg)s=dj(t,i,o);else{const[l,c]=fS(t.id,i.points,o);s=c}const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("stroke-width",o+"px"),a.setAttribute("stroke",r),a.setAttribute("fill","none"),a.setAttribute("d",s),a}case"solid":{let s;if(i instanceof Mg)s=sj(i,!1);else{const l=i.points;s="M"+l[0]+"L"+l.slice(1)}const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("stroke-width",o+"px"),a.setAttribute("stroke",r),a.setAttribute("fill","none"),a.setAttribute("d",s),a}default:{const{segments:s}=i,a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("stroke",r),a.setAttribute("stroke-width",o.toString());const l=i instanceof Mg?bS:wS;return s.forEach((c,d)=>{const u=document.createElementNS("http://www.w3.org/2000/svg","path"),{strokeDasharray:h,strokeDashoffset:p}=Pn(c.length,o,{style:t.props.dash,start:d>0?"outset":"none",end:d<s.length-1?"outset":"none"});u.setAttribute("stroke-dasharray",h.toString()),u.setAttribute("stroke-dashoffset",p.toString()),u.setAttribute("d",l(c,!0)),u.setAttribute("fill","none"),a.appendChild(u)}),a}}}}y(vm,"type","line"),y(vm,"props",OF),y(vm,"migrations",LF);function Zu(n){const{spline:e,handles:t}=n.props,r=Object.values(t).sort(Cn).map(C.From);switch(e){case"cubic":return new Mg({points:r});case"line":return new Ea({points:r})}}const Oo=200;class Sm extends ci{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"hideResizeHandles",()=>!0);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"onBeforeCreate",t=>uj(this.editor,t,t.props.growY));y(this,"onBeforeUpdate",(t,r)=>{if(!(t.props.text===r.props.text&&t.props.font===r.props.font&&t.props.size===r.props.size))return uj(this.editor,r,t.props.growY)});y(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t;o.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])})}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,url:""}}getHeight(t){return Oo+t.props.growY}getGeometry(t){const r=this.getHeight(t);return new ks({width:Oo,height:r,isFilled:!0})}component(t){const{id:r,type:i,props:{color:o,font:s,size:a,align:l,text:c,verticalAlign:d}}=t,u=Xt(),h=o==="black"?"yellow":o;return m.jsxs(m.Fragment,{children:[m.jsx("div",{style:{position:"absolute",width:Oo,height:this.getHeight(t)},children:m.jsxs("div",{className:"tl-note__container",style:{color:u[h].solid,backgroundColor:u[h].solid},children:[m.jsx("div",{className:"tl-note__scrim"}),m.jsx(z3,{id:r,type:i,font:s,size:a,align:l,verticalAlign:d,text:c,labelColor:"black",wrap:!0})]})}),"url"in t.props&&t.props.url&&m.jsx(Gu,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(t){return m.jsx("rect",{rx:"7",width:R(Oo),height:R(this.getHeight(t))})}toSvg(t,r){r.addExportDef(sm(t.props.font));const i=Qn({isDarkMode:this.editor.user.getIsDarkMode()}),o=this.editor.getShapeGeometry(t).bounds,s=document.createElementNS("http://www.w3.org/2000/svg","g"),a=t.props.color==="black"?"yellow":t.props.color,l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("rx","10"),l.setAttribute("width",Oo.toString()),l.setAttribute("height",o.height.toString()),l.setAttribute("fill",i[a].solid),l.setAttribute("stroke",i[a].solid),l.setAttribute("stroke-width","1"),s.appendChild(l);const c=document.createElementNS("http://www.w3.org/2000/svg","rect");c.setAttribute("rx","10"),c.setAttribute("width",Oo.toString()),c.setAttribute("height",o.height.toString()),c.setAttribute("fill",i.background),c.setAttribute("opacity",".28"),s.appendChild(c);const d=N3({editor:this.editor,shape:t,font:au[t.props.font],bounds:o});return d.setAttribute("fill",i.text),d.setAttribute("stroke","none"),s.appendChild(d),s}}y(Sm,"type","note"),y(Sm,"props",zF),y(Sm,"migrations",NF);function uj(n,e,t=0){const r=n.textMeasure.measureText(e.props.text,{...cn,fontFamily:Ro[e.props.font],fontSize:wc[e.props.size],maxWidth:Oo-34}).h+34;let i=null;if(r>Oo?i=r-Oo:t&&(i=0),i!==null)return{...e,props:{...e.props,growY:i}}}function xQ(n,{initialBounds:e,scaleX:t,scaleY:r,newPoint:i}){const o=Math.max(.01,Math.min(Math.abs(t),Math.abs(r))),s=new C(0,0);t<0&&(s.x=-(e.width*o)),r<0&&(s.y=-(e.height*o));const{x:a,y:l}=C.Add(i,s.rot(n.rotation));return{x:a,y:l,props:{scale:o*n.props.scale}}}const _Q=new Rv;class xm extends ci{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"isAspectRatioLocked",()=>!0);y(this,"onResize",(t,r)=>{const{initialBounds:i,initialShape:o,scaleX:s,handle:a}=r;if(r.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:t.id,type:t.type,...xQ(t,r)};{const l=i.width;let c=l*s;const d=new C(0,0);c=Math.max(1,Math.abs(c)),a==="left"?(d.x=l-c,s<0&&(d.x+=c)):s<0&&(d.x-=c);const{x:u,y:h}=d.rot(t.rotation).add(o);return{id:t.id,type:t.type,x:u,y:h,props:{w:c/o.props.scale,autoSize:!1}}}});y(this,"onBeforeCreate",t=>{if(!t.props.autoSize||t.props.text.trim())return;const r=this.getMinDimensions(t);return{...t,x:t.x-r.width/2,y:t.y-r.height/2}});y(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t,s=t.props.text.trimEnd();s.length===0?this.editor.deleteShapes([t.id]):s!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])});y(this,"onBeforeUpdate",(t,r)=>{if(!r.props.autoSize)return;const i=t.props.size!==r.props.size||t.props.align!==r.props.align||t.props.font!==r.props.font||t.props.scale!==1&&r.props.scale===1,o=t.props.text!==r.props.text;if(!i&&!o)return;const s=this.getMinDimensions(t),a=hj(this.editor,r.props),l=s.width*t.props.scale,c=s.height*t.props.scale,d=a.width*r.props.scale,u=a.height*r.props.scale;let h;switch(r.props.align){case"middle":{h=new C((d-l)/2,o?0:(u-c)/2);break}case"end":{h=new C(d-l,o?0:(u-c)/2);break}default:{if(o)break;h=new C(0,(u-c)/2);break}}if(h){h.rot(r.rotation);const{x:p,y:g}=r;return{...r,x:p-h.x,y:g-h.y,props:{...r.props,w:d}}}else return{...r,props:{...r.props,w:d}}});y(this,"onDoubleClickEdge",t=>{if(!t.props.autoSize)return{id:t.id,type:t.type,props:{autoSize:!0}};if(t.props.scale!==1)return{id:t.id,type:t.type,props:{scale:1}}})}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",align:"middle",autoSize:!0,scale:1}}getMinDimensions(t){return _Q.get(t.props,r=>hj(this.editor,r))}getGeometry(t){const{scale:r}=t.props,{width:i,height:o}=this.getMinDimensions(t);return new ks({width:i*r,height:o*r,isFilled:!0})}component(t){const{id:r,type:i,props:{text:o,color:s}}=t,a=Qn({isDarkMode:this.editor.user.getIsDarkMode()}),{width:l,height:c}=this.getMinDimensions(t),{rInput:d,isEmpty:u,isEditing:h,handleFocus:p,handleChange:g,handleKeyDown:f,handleBlur:w,handleInputPointerDown:v,handleDoubleClick:b}=lS(r,i,o);return m.jsx(Aa,{id:t.id,children:m.jsxs("div",{className:"tl-text-shape__wrapper tl-text-shadow","data-font":t.props.font,"data-align":t.props.align,"data-hastext":!u,"data-isediting":h,"data-textwrap":!0,style:{fontSize:js[t.props.size],lineHeight:js[t.props.size]*cn.lineHeight+"px",transform:`scale(${t.props.scale})`,transformOrigin:"top left",width:Math.max(1,l),height:Math.max(js[t.props.size]*cn.lineHeight,c),color:a[s].solid},children:[m.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",children:o}),h?m.jsx("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:h,placeholder:"",spellCheck:"true",wrap:"off",dir:"ltr",datatype:"wysiwyg",defaultValue:o,onFocus:p,onChange:g,onKeyDown:f,onBlur:w,onTouchEnd:Wt,onContextMenu:Wt,onPointerDown:v,onDoubleClick:b}):null]})})}indicator(t){const r=this.editor.getShapeGeometry(t).bounds,i=G();return t.props.autoSize&&i.getEditingShapeId()===t.id?null:m.jsx("rect",{width:R(r.width),height:R(r.height)})}toSvg(t,r){r.addExportDef(sm(t.props.font));const i=Qn({isDarkMode:this.editor.user.getIsDarkMode()}),o=this.editor.getShapeGeometry(t).bounds,s=t.props.text,a=o.width/(t.props.scale??1),l=o.height/(t.props.scale??1),c={fontSize:js[t.props.size],fontFamily:au[t.props.font],textAlign:t.props.align,verticalTextAlign:"middle",width:a,height:l,padding:0,lineHeight:cn.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},d=i[t.props.color].solid,u=document.createElementNS("http://www.w3.org/2000/svg","g"),h=om(this.editor,this.editor.textMeasure.measureTextSpans(s,c),{...c,stroke:i.background,strokeWidth:2,fill:i.background,padding:0}),p=h.cloneNode(!0);return p.setAttribute("fill",d),p.setAttribute("stroke","none"),u.append(h),u.append(p),u}}y(xm,"type","text"),y(xm,"props",FF),y(xm,"migrations",$F);function hj(n,e){const{font:t,text:r,autoSize:i,size:o,w:s}=e,a=i?16:Math.max(16,s),l=js[o],c=i?null:Math.floor(Math.max(a,s)),d=n.textMeasure.measureText(r,{...cn,fontFamily:Ro[t],fontSize:l,maxWidth:c});return i&&(d.w+=1),{width:Math.max(a,d.w),height:Math.max(l,d.h)}}class _m extends ac{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(t){return m.jsx(CQ,{shape:t,videoUtil:this})}indicator(t){return m.jsx("rect",{width:R(t.props.w),height:R(t.props.h)})}toSvg(t){const r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","image");return i.setAttributeNS("http://www.w3.org/1999/xlink","href",kQ(t.id)),i.setAttribute("width",t.props.w.toString()),i.setAttribute("height",t.props.h.toString()),r.appendChild(i),r}}y(_m,"type","video"),y(_m,"props",BF),y(_m,"migrations",UF);function kQ(n){const e=n.split(":")[1],t=document.querySelector(`.tl-video-shape-${e}`);if(t){const r=document.createElement("canvas");return r.width=t.videoWidth,r.height=t.videoHeight,r.getContext("2d").drawImage(t,0,0),r.toDataURL("image/png")}else throw new Error("Video with id "+e+" not found")}const CQ=$e(function(n){const{shape:e,videoUtil:t}=n,r=t.editor.getShapeGeometry(e).bounds.w*t.editor.getZoomLevel()>=110,i=e.props.assetId?t.editor.getAsset(e.props.assetId):null,{time:o,playing:s}=e.props,a=Ig(e.id),l=ij(),c=re.useRef(null),d=re.useCallback(w=>{const v=w.currentTarget;t.editor.updateShapes([{type:"video",id:e.id,props:{playing:!0,time:v.currentTime}}])},[e.id,t.editor]),u=re.useCallback(w=>{const v=w.currentTarget;t.editor.updateShapes([{type:"video",id:e.id,props:{playing:!1,time:v.currentTime}}])},[e.id,t.editor]),h=re.useCallback(w=>{const v=w.currentTarget;a&&t.editor.updateShapes([{type:"video",id:e.id,props:{time:v.currentTime}}])},[a,e.id,t.editor]),[p,g]=re.useState(!1),f=re.useCallback(w=>{const v=w.currentTarget;o!==v.currentTime&&(v.currentTime=o),s||v.pause(),g(!0)},[s,o]);return re.useEffect(()=>{const w=c.current;w&&(p&&!a&&o!==w.currentTime&&(w.currentTime=o),a&&document.activeElement!==w&&w.focus())},[a,p,o]),re.useEffect(()=>{if(l){const w=c.current;w.pause(),w.currentTime=0}},[c,l]),m.jsxs(m.Fragment,{children:[m.jsx(Aa,{id:e.id,children:m.jsx("div",{className:"tl-counter-scaled",children:i!=null&&i.props.src?m.jsx("video",{ref:c,style:a?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${e.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:a&&r,onPlay:d,onPause:u,onTimeUpdate:h,onLoadedData:f,hidden:!p,children:m.jsx("source",{src:i.props.src})}):null})}),"url"in e.props&&e.props.url&&m.jsx(Gu,{url:e.props.url,zoomLevel:t.editor.getZoomLevel()})]})}),pj=[xm,lm,um,fm,Sm,vm,pm,am,ym,hm,bm,_m];function EQ(n){return[n.sideEffects.registerAfterChangeHandler("instance",(e,t)=>{e.isFocused!==t.isFocused&&(t.isFocused?(n.getContainer().focus(),n.updateViewportScreenBounds()):(n.complete(),n.getContainer().blur(),n.updateViewportScreenBounds()))}),n.sideEffects.registerAfterChangeHandler("instance_page_state",(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const r=n.isInAny("select.crop","select.pointing_crop_handle","select.cropping");!e.croppingShapeId&&t.croppingShapeId?r||n.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&r&&n.setCurrentTool("select.idle")}e.editingShapeId!==t.editingShapeId&&(!e.editingShapeId&&t.editingShapeId?n.isIn("select.editing_shape")||n.setCurrentTool("select.editing_shape"):e.editingShapeId&&!t.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle"))})]}class fj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"scribbleId","id");y(this,"markId","");y(this,"excludedShapeIds",new Set);y(this,"onEnter",t=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=t;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(o=>{if(this.editor.isShapeOrAncestorLocked(o))return!0;if(this.editor.isShapeOfType(o,"group")||this.editor.isShapeOfType(o,"frame")){const s=this.editor.getPointInShapeSpace(o,r);return this.editor.getShapeGeometry(o).bounds.containsPoint(s)}return!1}).map(o=>o.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()});y(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)});y(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});y(this,"onPointerMove",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()})}update(){const t=this.editor.getErasingShapeIds(),r=this.editor.getZoomLevel(),i=this.editor.getCurrentPageShapes(),{inputs:{currentPagePoint:o,previousPagePoint:s}}=this.editor,{excludedShapeIds:a}=this;this.pushPointToScribble();const l=new Set(t);for(const c of i){if(this.editor.isShapeOfType(c,"group"))continue;const d=this.editor.getShapeMask(c.id);if(d&&!zi(o,d))continue;const u=this.editor.getShapeGeometry(c),h=this.editor.getPointInShapeSpace(c,s),p=this.editor.getPointInShapeSpace(c,o);u.hitTestLineSegment(h,p,li/r)&&l.add(this.editor.getOutermostSelectableShape(c).id)}this.editor.setErasingShapes([...l].filter(c=>!a.has(c)))}complete(){this.editor.deleteShapes(this.editor.getCurrentPageState().erasingShapeIds),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}y(fj,"id","erasing");let PQ=(Lk=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(Lk,"id","idle"),Lk),IQ=(zk=class extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,i=new Set,o=i.size;for(let s=t.length,a=s-1;a>=0;a--){const l=t[a];if(!(this.editor.isShapeOrAncestorLocked(l)||this.editor.isShapeOfType(l,"group"))&&this.editor.isPointInShape(l,r,{hitInside:!1,margin:li/e})){const c=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(c,"frame")&&i.size>o)break;i.add(c.id)}}this.editor.setErasingShapes([...i])});y(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.parent.transition("erasing",e)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},y(zk,"id","pointing"),zk);class km extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}y(km,"id","eraser"),y(km,"initial","idle"),y(km,"children",()=>[PQ,IQ,fj]);class gj extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.update()});y(this,"onPointerMove",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()})}update(){const{currentScreenPoint:t,previousScreenPoint:r}=this.editor.inputs,i=C.Sub(t,r);(Math.abs(i.x)>0||Math.abs(i.y)>0)&&this.editor.pan(i)}complete(){this.editor.slideCamera({speed:Math.min(2,this.editor.inputs.pointerVelocity.len()),direction:this.editor.inputs.pointerVelocity,friction:ig}),this.parent.transition("idle")}}y(gj,"id","dragging");let MQ=(Nk=class extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.setCursor({type:"grab",rotation:0})});y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(Nk,"id","idle"),Nk),AQ=(Fk=class extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.stopCameraAnimation(),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})});y(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.parent.transition("dragging",e)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.complete()})}complete(){this.parent.transition("idle")}},y(Fk,"id","pointing"),Fk);class Cm extends ae{constructor(){super(...arguments);y(this,"onDoubleClick",t=>{if(t.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomIn(r,{duration:220,easing:_n.easeOutQuint})}});y(this,"onTripleClick",t=>{if(t.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomOut(r,{duration:320,easing:_n.easeOutQuint})}});y(this,"onQuadrupleClick",t=>{if(t.phase==="settle"){const r=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:i}}=this.editor;r===1?this.editor.zoomToFit({duration:400,easing:_n.easeOutQuint}):this.editor.resetZoom(i,{duration:320,easing:_n.easeOutQuint})}})}}y(Cm,"id","hand"),y(Cm,"initial","idle"),y(Cm,"children",()=>[MQ,AQ,gj]);let TQ=($k=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("lasering",e)})}},y($k,"id","idle"),$k);class mj extends ae{constructor(){super(...arguments);y(this,"scribbleId","id");y(this,"onEnter",()=>{const t=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=t.id,this.pushPointToScribble()});y(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});y(this,"onPointerMove",()=>{this.pushPointToScribble()});y(this,"onPointerUp",()=>{this.complete()});y(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()})}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}y(mj,"id","lasering");class Em extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}y(Em,"id","laser"),y(Em,"initial","idle"),y(Em,"children",()=>[TQ,mj]);class yj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"brush",new de);y(this,"initialSelectedShapeIds",[]);y(this,"excludedShapeIds",new Set);y(this,"initialStartShape",null);y(this,"onEnter",t=>{const{altKey:r,currentPagePoint:i}=this.editor.inputs;if(r){this.parent.transition("scribble_brushing",t);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(o=>this.editor.isShapeOfType(o,"group")||this.editor.isShapeOrAncestorLocked(o)).map(o=>o.id)),this.info=t,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(i)[0],this.onPointerMove()});y(this,"onExit",()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})});y(this,"onTick",()=>{Gv(this.editor)});y(this,"onPointerMove",()=>{this.hitTestShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",t=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds,{squashing:!0}),this.parent.transition("idle",t)});y(this,"onKeyDown",t=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",t):this.hitTestShapes()});y(this,"onKeyUp",()=>{this.hitTestShapes()});y(this,"onInterrupt",()=>{this.editor.updateInstanceState({brush:null})})}complete(){this.parent.transition("idle")}hitTestShapes(){const t=this.editor.getZoomLevel(),r=this.editor.getCurrentPageShapes(),i=this.editor.getCurrentPageId(),{inputs:{originPagePoint:o,currentPagePoint:s,shiftKey:a,ctrlKey:l}}=this.editor;this.brush.setTo(de.FromPoints([o,s]));const c=new Set(a?this.initialSelectedShapeIds:[]);let d,u,h,p,g,f;const{corners:w}=this.brush,{excludedShapeIds:v}=this;e:for(let b=0,_=r.length;b<_;b++){if(h=r[b],v.has(h.id)||c.has(h.id)||(p=this.editor.getShapePageBounds(h),!p))continue e;if(this.brush.contains(p)){this.handleHit(h,s,i,c,w);continue e}if(l||this.editor.isShapeOfType(h,"frame"))continue e;if(this.brush.collides(p)){const x=this.editor.getShapeGeometry(h);if(g=this.editor.getShapePageTransform(h),!g)continue e;f=g.clone().invert().applyToPoints(w);t:for(let E=0;E<f.length;E++)if(d=f[E],u=f[(E+1)%f.length],x.hitTestLineSegment(d,u,li/t)){this.handleHit(h,s,i,c,w);break t}}}this.editor.updateInstanceState({brush:{...this.brush.toJson()}}),this.editor.setSelectedShapes(Array.from(c),{squashing:!0})}handleHit(t,r,i,o,s){if(t.parentId===i){o.add(t.id);return}const a=this.editor.getOutermostSelectableShape(t),l=this.editor.getShapeMask(a.id);l&&!cU(l,s)&&!zi(r,l)||o.add(a.id)}}y(yj,"id","brushing");function vS(n){const e=n.getZoomLevel(),{inputs:{currentPagePoint:t}}=n;return n.getShapeAtPoint(t,{hitInside:!1,hitLabels:!1,margin:li/e,renderingOnly:!0})??n.getSelectedShapeAtPoint(t)}function wj(n,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const i=n.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;i==="x"?t.x=0:i==="y"&&(t.y=0),t.rot(-e.rotation);const o=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,s=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=r.bottomRight.y-r.topLeft.y,l=r.bottomRight.x-r.topLeft.x,c=bn(r);return c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-t.x/o)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-t.y/s)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a,{id:e.id,type:e.type,props:{crop:c}}}let jQ=(Bk=class extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0});const e=this.editor.getOnlySelectedShape();this.editor.on("change-history",this.cleanupCroppingState),e&&(this.editor.mark("crop"),this.editor.setCroppingShape(e.id))});y(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.off("change-history",this.cleanupCroppingState)});y(this,"onCancel",()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})});y(this,"onPointerDown",e=>{var t;if(!this.editor.getIsMenuOpen()){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=vS(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(t=this.editor.getShapeUtil(e.shape))!=null&&t.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop"});break}case"top":case"right":case"bottom":case"left":{this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break}default:this.cancel()}break}}}});y(this,"onDoubleClick",e=>{var o;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const t=this.editor.getCroppingShapeId();if(!t)return;const r=this.editor.getShape(t);if(!r)return;const i=this.editor.getShapeUtil(r);i&&e.target==="selection"&&((o=i.onDoubleClickEdge)==null||o.call(i,r))});y(this,"onKeyDown",()=>{this.nudgeCroppingImage(!1)});y(this,"onKeyRepeat",()=>{this.nudgeCroppingImage(!0)});y(this,"onKeyUp",e=>{switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}});y(this,"cleanupCroppingState",()=>{this.editor.getCroppingShapeId()||this.editor.setCurrentTool("select.idle",{})})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),i=new C(0,0);if(t.has("ArrowLeft")&&(i.x+=1),t.has("ArrowRight")&&(i.x-=1),t.has("ArrowUp")&&(i.y+=1),t.has("ArrowDown")&&(i.y-=1),i.equals(new C(0,0)))return;r&&i.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const s=wj(this.editor,o,i);s&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([s]))}},y(Bk,"id","idle"),Bk);class bj extends ae{constructor(){super(...arguments);y(this,"onCancel",()=>{this.editor.setCurrentTool("select.crop.idle",{})});y(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",t)});y(this,"onPointerUp",t=>{this.editor.setCurrentTool("select.crop.idle",t)})}}y(bj,"id","pointing_crop");class vj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"markId","translating crop");y(this,"snapshot",{});y(this,"onEnter",t=>{this.info=t,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()});y(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onKeyDown",t=>{switch(t.key){case"Alt":case"Shift":{this.updateShapes();return}}});y(this,"onKeyUp",t=>{switch(t.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}})}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const t=this.snapshot.shape;if(!t)return;const{originPagePoint:r,currentPagePoint:i}=this.editor.inputs,o=i.clone().sub(r),s=wj(this.editor,t,o);s&&this.editor.updateShapes([s],{squashing:!0})}}y(vj,"id","translating_crop");class Pm extends ae{}y(Pm,"id","crop"),y(Pm,"initial","idle"),y(Pm,"children",()=>[jQ,vj,bj]);const Vr=8,kc={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class Sj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t,this.updateCursor()});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("resizing",this.info)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const t=this.editor.getSelectedShapes(),r=kc[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:t.length===1?t[0].rotation:0}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}y(Sj,"id","pointing_resize_handle");class xj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"markId","");y(this,"snapshot",{});y(this,"onEnter",t=>{this.info=t,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"getDefaultCrop",()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}))}updateCursor(){const t=this.editor.getSelectedShapes()[0];if(!t)return;const r=kc[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:t.rotation}})}updateShapes(){const{shape:t,cursorHandleOffset:r}=this.snapshot;if(!t||!this.editor.getShapeUtil("image"))return;const i=t.props,o=this.editor.inputs.currentPagePoint.clone().sub(r),s=this.editor.inputs.originPagePoint.clone().sub(r),a=o.clone().sub(s).rot(-t.rotation),l=i.crop??this.getDefaultCrop(),c=bn(l),d=new C(t.x,t.y),u=new C(0,0),h=1/(l.bottomRight.x-l.topLeft.x)*i.w,p=1/(l.bottomRight.y-l.topLeft.y)*i.h;let g=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(p<Vr)break;g=!0,c.topLeft.y=c.topLeft.y+a.y/p,p*(c.bottomRight.y-c.topLeft.y)<Vr?(c.topLeft.y=c.bottomRight.y-Vr/p,u.y=(c.topLeft.y-l.topLeft.y)*p):c.topLeft.y<=0?(c.topLeft.y=0,u.y=(c.topLeft.y-l.topLeft.y)*p):u.y=a.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(p<Vr)break;g=!0,c.bottomRight.y=Math.min(1,c.bottomRight.y+a.y/p),p*(c.bottomRight.y-c.topLeft.y)<Vr&&(c.bottomRight.y=c.topLeft.y+Vr/p);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(h<Vr)break;g=!0,c.topLeft.x=c.topLeft.x+a.x/h,h*(c.bottomRight.x-c.topLeft.x)<Vr?(c.topLeft.x=c.bottomRight.x-Vr/h,u.x=(c.topLeft.x-l.topLeft.x)*h):c.topLeft.x<=0?(c.topLeft.x=0,u.x=(c.topLeft.x-l.topLeft.x)*h):u.x=a.x;break}case"right":case"top_right":case"bottom_right":{if(h<Vr)break;g=!0,c.bottomRight.x=Math.min(1,c.bottomRight.x+a.x/h),h*(c.bottomRight.x-c.topLeft.x)<Vr&&(c.bottomRight.x=c.topLeft.x+Vr/h);break}}if(!g)return;d.add(u.rot(t.rotation));const f={id:t.id,type:t.type,x:d.x,y:d.y,props:{crop:c,w:(c.bottomRight.x-c.topLeft.x)*h,h:(c.bottomRight.y-c.topLeft.y)*p}};this.editor.updateShapes([f],{squashing:!0}),this.updateCursor()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}createSnapshot(){const t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,i=this.editor.getOnlySelectedShape(),o=this.editor.getSelectionRotatedPageBounds(),s=C.RotWith(o.getHandlePoint(this.info.handle),o.point,t),a=C.Sub(r,s);return{shape:i,cursorHandleOffset:a}}}y(xj,"id","cropping");class _j extends ae{constructor(){super(...arguments);y(this,"shapeId","");y(this,"initialHandle",{});y(this,"initialAdjacentHandle",null);y(this,"initialPagePoint",{});y(this,"markId","");y(this,"initialPageTransform");y(this,"initialPageRotation");y(this,"info",{});y(this,"isPrecise",!1);y(this,"isPreciseId",null);y(this,"pointingId",null);y(this,"onEnter",t=>{const{shape:r,isCreating:i,handle:o}=t;this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.shapeId=r.id,this.markId=i?`creating:${r.id}`:"dragging handle",i||this.editor.mark(this.markId),this.initialHandle=bn(o),this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.updateInstanceState({cursor:{type:i?"cross":"grabbing",rotation:0}},{ephemeral:!0});const s=this.editor.getShapeHandles(r).sort(Cn),a=s.findIndex(c=>c.id===t.handle.id);this.initialAdjacentHandle=null;for(let c=a+1;c<s.length;c++){const d=s[c];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==t.handle.id){this.initialAdjacentHandle=d;break}}if(!this.initialAdjacentHandle)for(let c=s.length-1;c>=0;c--){const d=s[c];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==t.handle.id){this.initialAdjacentHandle=d;break}}const l=r.props[t.handle.id];this.isPrecise=!1,(l==null?void 0:l.type)==="binding"?(this.editor.setHintingShapes([l.boundShapeId]),this.isPrecise=l.isPrecise,this.isPrecise?this.isPreciseId=l.boundShapeId:this.resetExactTimeout()):this.editor.setHintingShapes([]),this.update(),this.editor.select(this.shapeId)});y(this,"exactTimeout",-1);y(this,"onPointerMove",()=>{this.update()});y(this,"onKeyDown",()=>{this.update()});y(this,"onKeyUp",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})})}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clear();const{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clear();const{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var k;const{editor:t,shapeId:r,initialPagePoint:i}=this,{initialHandle:o,initialPageRotation:s,initialAdjacentHandle:a}=this,l=this.editor.getHintingShapeIds(),c=this.editor.user.getIsSnapMode(),{snaps:d,inputs:{currentPagePoint:u,shiftKey:h,ctrlKey:p,altKey:g,pointerVelocity:f}}=t,w=this.info.shape,v=t.getShape(r);if(!v)return;const b=t.getShapeUtil(v);let _=u.clone().sub(i).rot(-s).add(o);if(h&&a&&o.id!=="middle"){const P=C.Angle(a,_),I=Qf(P,24)-P;_=C.RotWith(_,a,I)}if(t.snaps.clear(),o.canSnap&&(c?!p:p)){const P=t.getShapePageTransform(v.id);if(!P)throw Error("Expected a page transform");const I=t.getShapeHandles(v).filter(({type:O})=>O==="vertex").sort(Cn).findIndex(({index:O})=>o.index===O),A=b.getOutlineSegments(v).map(O=>oe.applyToPoints(P,O)).filter((O,F)=>F!==I-1&&F!==I),T=d.getSnappingHandleDelta({additionalSegments:A,handlePoint:oe.applyToPoint(P,_)});T&&(T.rot(-t.getShapeParentTransform(v).rotation()),_.add(T))}const x=(k=b.onHandleChange)==null?void 0:k.call(b,v,{handle:{...o,x:_.x,y:_.y},isPrecise:this.isPrecise||g,initial:w}),E={...v,...x};if(o.canBind){const P=E.props[o.id];(P==null?void 0:P.type)==="binding"?l[0]!==P.boundShapeId&&(t.setHintingShapes([P.boundShapeId]),this.pointingId=P.boundShapeId,this.isPrecise=f.len()<.5||g,this.isPreciseId=this.isPrecise?P.boundShapeId:null,this.resetExactTimeout()):l.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}x&&t.updateShapes([E],{squashing:!0})}}y(_j,"id","dragging_handle");class kj extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{const t=this.editor.getEditingShape();if(!t)throw Error("Entered editing state without an editing shape");Wu(this.editor),this.editor.select(t)});y(this,"onExit",()=>{var i,o;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null);const r=this.editor.getShape(t);(o=(i=this.editor.getShapeUtil(r)).onEditEnd)==null||o.call(i,r),setTimeout(()=>{this.editor.updateViewportScreenBounds()},500)});y(this,"onPointerMove",t=>{switch(t.target){case"shape":case"canvas":{Wu(this.editor);return}}});y(this,"onPointerDown",t=>{switch(t.target){case"canvas":{const r=vS(this.editor);if(r){this.onPointerDown({...t,shape:r,target:"shape"});return}break}case"shape":{const{shape:r}=t,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");if(r.type===i.type)if(this.editor.isShapeOfType(r,"geo")||this.editor.isShapeOfType(r,"arrow")){const o=this.editor.getShapeUtil(r).getGeometry(r).children[1];if(o){const s=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(o.bounds.containsPoint(s)){if(r.id===i.id)return;this.parent.transition("pointing_shape",t);return}}}else{if(r.id===i.id)this.editor.isShapeOfType(r,"frame")&&this.editor.setEditingShape(null);else{this.parent.transition("pointing_shape",t);return}return}break}}this.parent.transition("idle",t),this.editor.root.handleEvent(t)});y(this,"onComplete",t=>{this.parent.transition("idle",t)});y(this,"onCancel",t=>{this.parent.transition("idle",t)})}}y(kj,"id","editing_shape");function Cj(n){const e=n.getOnlySelectedShape();return!!(e&&!n.isShapeOrAncestorLocked(e)&&n.getShapeUtil(e).canCrop(e))}function Im(n){const e=n.getSelectedShapeIds(),{shiftKey:t,altKey:r,currentPagePoint:i}=n.inputs,o=n.getShapeAtPoint(i,{hitInside:!1,margin:li/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:s=>!s.isLocked});if(o){const s=n.getOutermostSelectableShape(o);if(t&&!r)n.cancelDoubleClick(),e.includes(s.id)?(n.mark("deselecting shape"),n.deselect(s)):(n.mark("shift selecting shape"),n.setSelectedShapes([...e,s.id]));else{let a;s===o||s.id===n.getFocusedGroupId()||e.includes(s.id)?a=o:a=s,a&&!e.includes(a.id)&&(n.mark("selecting shape"),n.select(a.id))}}else{if(t)return;{e.length>0&&(n.mark("selecting none"),n.selectNone());const s=n.getFocusedGroupId();if(Nr(s)){const a=n.getShape(s);n.isPointInShape(a,i,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}let RQ=(Uk=class extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.parent.setCurrentToolIdMask(void 0),Wu(this.editor),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});y(this,"onPointerMove",()=>{Wu(this.editor)});y(this,"onPointerDown",e=>{if(this.editor.getIsMenuOpen())return;const t=e.ctrlKey&&Cj(this.editor);if(e.ctrlKey&&!t){if(e.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{const r=vS(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&Ej(this.editor,s)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{if(this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":{t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}});y(this,"onDoubleClick",e=>{var t,r,i,o,s;if(!(this.editor.inputs.shiftKey||e.phase!=="up"))switch(e.target){case"canvas":{const a=this.editor.getHoveredShape(),l=a&&!this.editor.isShapeOfType(a,"group")?a:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:li/this.editor.getZoomLevel(),hitInside:!1}),c=this.editor.getFocusedGroupId();if(l){if(this.editor.isShapeOfType(l,"group")){Im(this.editor);return}else{const d=this.editor.getShape(l.parentId);if(d&&this.editor.isShapeOfType(d,"group")&&!(c&&d.id===c)){Im(this.editor);return}}this.onDoubleClick({...e,shape:l,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const a=this.editor.getOnlySelectedShape();if(a){const l=this.editor.getShapeUtil(a);if(!this.canInteractWithShapeInReadOnly(a))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const c=(t=l.onDoubleClickEdge)==null?void 0:t.call(l,a);if(c){this.editor.mark("double click edge"),this.editor.updateShapes([c]);return}}if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(a)&&this.startEditingShape(a,e)}break}case"shape":{const{shape:a}=e,l=this.editor.getShapeUtil(a);if(a.type!=="video"&&a.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(l.onDoubleClick){const c=(r=l.onDoubleClick)==null?void 0:r.call(l,a);if(c){this.editor.updateShapes([c]);return}else if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.editor.mark("select and crop"),this.editor.select((i=e.shape)==null?void 0:i.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(a)?this.startEditingShape(a,e):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:a,handle:l}=e,c=(s=(o=this.editor.getShapeUtil(a)).onDoubleClickHandle)==null?void 0:s.call(o,a,l);c?this.editor.updateShapes([c]):this.shouldStartEditingShape(a)&&this.startEditingShape(a,e)}}});y(this,"onRightClick",e=>{switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),r=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:li/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitFrameInside:!1,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&Ej(this.editor,s)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:r}=e,i=this.editor.getOutermostSelectableShape(r,o=>!t.includes(o.id));t.includes(i.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}});y(this,"onCancel",()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())});y(this,"onKeyDown",e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);break}}});y(this,"onKeyRepeat",e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}});y(this,"onKeyUp",e=>{switch(e.code){case"Enter":{const t=this.editor.getSelectedShapes();if(t.every(i=>this.editor.isShapeOfType(i,"group"))){this.editor.setSelectedShapes(t.flatMap(i=>this.editor.getSortedChildIdsForParent(i.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r});return}Cj(this.editor)&&this.parent.transition("crop",e);break}}});y(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.mark("editing shape"),this.editor.setEditingShape(e.id),this.parent.transition("editing_shape",t))}handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const t=ot(),{x:r,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:r,y:i,props:{text:"",autoSize:!0}}]);const o=this.editor.getShape(t);if(!o)return;const s=this.editor.getShapeUtil(o);this.editor.getInstanceState().isReadonly&&!s.canEditInReadOnly(o)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),i=new C(0,0);if(t.has("ArrowLeft")&&(i.x-=1),t.has("ArrowRight")&&(i.x+=1),t.has("ArrowUp")&&(i.y-=1),t.has("ArrowDown")&&(i.y+=1),i.equals(new C(0,0)))return;e||this.editor.mark("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),s=this.editor.getInstanceState().isGridMode?r?o*LQ:o:r?DQ:OQ;this.editor.nudgeShapes(this.editor.getSelectedShapeIds(),i.mul(s))}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},y(Uk,"id","idle"),Uk);const DQ=10,OQ=1,LQ=5;function Ej(n,e){const t=n.getSelectionRotatedPageBounds();if(!t)return!1;const r=n.getSelectionRotation();return r?zi(e,t.corners.map(i=>C.RotWith(i,t.point,r))):t.containsPoint(e)}class Pj extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{const{inputs:t}=this.editor;t.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())});y(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",t)});y(this,"onPointerUp",()=>{Im(this.editor),this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.parent.transition("idle")})}complete(){this.parent.transition("idle")}}y(Pj,"id","pointing_canvas");class Ij extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];r&&(this.updateCursor(r),this.editor.setCroppingShape(r.id))});y(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})});y(this,"onPointerUp",()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}updateCursor(t){const r=kc[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:t.rotation}})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}}y(Ij,"id","pointing_crop_handle");class Mj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t;const r=t.shape.props[t.handle.id];(r==null?void 0:r.type)==="binding"&&this.editor.setHintingShapes([r.boundShapeId]),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})});y(this,"onExit",()=>{this.editor.setHintingShapes([]),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});y(this,"onPointerUp",()=>{this.parent.transition("idle",this.info)});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("dragging_handle",this.info)});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}y(Mj,"id","pointing_handle");class Aj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.updateCursor()});y(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});y(this,"onPointerMove",()=>{const{isDragging:t}=this.editor.inputs;t&&this.parent.transition("rotating",this.info)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const t=this.editor.getSelectionRotation();this.editor.updateInstanceState({cursor:{type:kc[this.info.handle],rotation:t}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}y(Aj,"id","pointing_rotate_handle");class Tj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t});y(this,"onPointerUp",t=>{Im(this.editor),this.parent.transition("idle",t)});y(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly)return;this.parent.transition("translating",t)}});y(this,"onDoubleClick",t=>{var o,s;const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),(s=(o=this.parent).onDoubleClick)==null||s.call(o,{...t,target:"shape",shape:this.editor.getShape(i)});return}});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}y(Tj,"id","pointing_selection");class jj extends ae{constructor(){super(...arguments);y(this,"hitShape",{});y(this,"hitShapeForPointerUp",{});y(this,"didSelectOnEnter",!1);y(this,"onEnter",t=>{const r=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),o=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:s,shiftKey:a,altKey:l}}=this.editor;this.hitShape=t.shape;const c=this.editor.getOutermostSelectableShape(t.shape);if(this.editor.getShapeUtil(t.shape).onClick||c.id===o||r.includes(c.id)||this.editor.isAncestorSelected(c.id)||r.length>1&&(i!=null&&i.containsPoint(s))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=c;return}this.didSelectOnEnter=!0,a&&!l?(this.editor.cancelDoubleClick(),r.includes(c.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...r,c.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([c.id]))});y(this,"onPointerUp",t=>{var d;const r=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),o=this.editor.getZoomLevel(),{inputs:{currentPagePoint:s,shiftKey:a}}=this.editor,l=this.editor.getShapeAtPoint(s,{margin:li/o,hitInside:!0,renderingOnly:!0})??this.hitShape,c=l?this.editor.getOutermostSelectableShape(l):this.hitShapeForPointerUp;if(c){const u=this.editor.getShapeUtil(c);if(u.onClick){const h=(d=u.onClick)==null?void 0:d.call(u,c);if(h){this.editor.mark("shape on click"),this.editor.updateShapes([h]),this.parent.transition("idle",t);return}}if(c.id===i){r.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",t);return}}if(!this.didSelectOnEnter){const u=this.editor.getOutermostSelectableShape(l,h=>!r.includes(h.id));if(r.includes(u.id))if(a)this.editor.mark("deselecting on pointer up"),this.editor.deselect(c);else if(r.includes(c.id)){if(r.length===1&&(this.editor.isShapeOfType(c,"geo")||this.editor.isShapeOfType(c,"arrow"))){const h=this.editor.getShapeGeometry(c).children[1];if(h){const p=this.editor.getPointInShapeSpace(c,s);if(h.bounds.containsPoint(p,0)&&h.hitTestPoint(p)){this.editor.batch(()=>{this.editor.mark("editing on pointer up"),this.editor.select(c.id);const g=this.editor.getShapeUtil(c);this.editor.getInstanceState().isReadonly&&!g.canEditInReadOnly(c)||(this.editor.setEditingShape(c.id),this.editor.setCurrentTool("select.editing_shape"))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(c.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(c);else if(a){const h=this.editor.getShapeAncestors(u);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(p=>!h.find(g=>g.id===p)),u.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([u.id])}this.parent.transition("idle",t)});y(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly)return;this.parent.transition("translating",t)}});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}y(jj,"id","pointing_shape");class Rj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"markId","");y(this,"didHoldCommand",!1);y(this,"creationCursorOffset",{x:0,y:0});y(this,"snapshot",{});y(this,"onEnter",t=>{const{isCreating:r=!1,creationCursorOffset:i={x:0,y:0}}=t;this.info=t,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.creationCursorOffset=i,this.snapshot=this._createSnapshot(),r?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},{ephemeral:!0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()});y(this,"onTick",()=>{Gv(this.editor)});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onKeyDown",()=>{this.updateShapes()});y(this,"onKeyUp",()=>{this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.snaps.clear()});y(this,"_createSnapshot",()=>{const t=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:i}}=this.editor,o=this.editor.getSelectionRotatedPageBounds(),s=C.RotWith(o.getHandlePoint(this.info.handle),o.point,r),a=C.Sub(i,s),l=new Map,c=[];t.forEach(u=>{const h=this.editor.getShape(u);if(h){if(h.type==="frame"&&c.push({id:u,children:me(this.editor.getSortedChildIdsForParent(h).map(p=>this.editor.getShape(p)))}),l.set(h.id,this._createShapeSnapshot(h)),this.editor.isShapeOfType(h,"frame")&&t.length===1)return;this.editor.visitDescendants(h.id,p=>{const g=this.editor.getShape(p);if(g&&(l.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")))return!1})}});const d=![...l.values()].some(u=>!kI(u.pageRotation,r)||u.isAspectRatioLocked);return{shapeSnapshots:l,selectionBounds:o,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:t,canShapesDeform:d,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:c}});y(this,"_createShapeSnapshot",t=>{const r=this.editor.getShapePageTransform(t),i=this.editor.getShapeUtil(t);return{shape:t,bounds:this.editor.getShapeGeometry(t).bounds,pageTransform:r,pageRotation:oe.Decompose(r).rotation,isAspectRatioLocked:i.isAspectRatioLocked(t)}})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var t,r;if(this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(t=this.info).onCreate)==null||r.call(t,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var s,a;const o=(a=(s=this.editor.getShapeUtil(i)).onResizeStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onResizeEnd)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:t,shiftKey:r}=this.editor.inputs,{frames:i,shapeSnapshots:o,selectionBounds:s,cursorHandleOffset:a,selectedShapeIds:l,selectionRotation:c,canShapesDeform:d}=this.snapshot,u=r||!d,{ctrlKey:h}=this.editor.inputs,p=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),g=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!h){const{gridSize:P}=this.editor.getDocumentSettings();p.snapToGrid(P)}const f=this.info.handle,w=Dj(f,Math.PI);if(this.editor.snaps.clear(),(this.editor.user.getIsSnapMode()?!h:h)&&c%at===0){const{nudge:P}=this.editor.snaps.snapResize({dragDelta:C.Sub(p,g),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:Dj(f,c),isAspectRatioLocked:u,isResizingFromCenter:t});p.add(P)}const v=C.RotWith(t?s.center:s.getHandlePoint(w),s.point,c),b=C.Sub(p,v).rot(-c),_=C.Sub(g,v).rot(-c),x=C.DivV(b,_);Number.isFinite(x.x)||(x.x=1),Number.isFinite(x.y)||(x.y=1);const E=f==="top"||f==="bottom",k=f==="left"||f==="right";u?k?x.y=Math.abs(x.x):E?x.x=Math.abs(x.y):Math.abs(x.x)>Math.abs(x.y)?x.y=Math.abs(x.x)*(x.y<0?-1:1):x.x=Math.abs(x.y)*(x.x<0?-1:1):(E&&(x.x=1),k&&(x.y=1)),this.info.isCreating||this.updateCursor({dragHandle:f,isFlippedX:x.x<0,isFlippedY:x.y<0,rotation:c});for(const P of o.keys()){const I=o.get(P);this.editor.resizeShape(P,x,{initialShape:I.shape,initialBounds:I.bounds,initialPageTransform:I.pageTransform,dragHandle:f,mode:l.length===1&&P===l[0]?"resize_bounds":"scale_shape",scaleOrigin:v,scaleAxisRotation:c})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:P,children:I}of i){if(!I.length)continue;const A=o.get(P).shape,T=this.editor.getShape(P);if(!(A&&T))continue;const O=T.x-A.x,F=T.y-A.y,H=new C(O,F).rot(-A.rotation);if(H.x!==0||H.y!==0)for(const D of I)this.editor.updateShape({id:D.id,type:D.type,x:D.x-H.x,y:D.y-H.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:P}of i)if(P.length)for(const I of P)this.editor.updateShape({id:I.id,type:I.type,x:I.x,y:I.y})}}updateCursor({dragHandle:t,isFlippedX:r,isFlippedY:i,rotation:o}){const s={...this.editor.getInstanceState().cursor};switch(t){case"top_left":case"bottom_right":{s.type="nwse-resize",r!==i&&(s.type="nesw-resize");break}case"top_right":case"bottom_left":{s.type="nesw-resize",r!==i&&(s.type="nwse-resize");break}}s.rotation=o,this.editor.setCursor(s)}}y(Rj,"id","resizing");const SS=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function Dj(n,e){e=e%Xe;const t=Math.round(e/(Ue/4)),r=SS.indexOf(n);return SS[(r+t)%SS.length]}const Oj=Math.PI/180;class Lj extends ae{constructor(){super(...arguments);y(this,"snapshot",{});y(this,"info",{});y(this,"markId","");y(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const r=VM({editor:this.editor});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r,this.handleStart()});y(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}});y(this,"onPointerMove",()=>{this.update()});y(this,"onKeyDown",()=>{this.update()});y(this,"onKeyUp",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"update",()=>{const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});yg({editor:this.editor,delta:t,snapshot:this.snapshot,stage:"update"}),this.editor.updateInstanceState({cursor:{type:kc[this.info.handle],rotation:t+this.snapshot.initialSelectionRotation}})});y(this,"cancel",()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)});y(this,"complete",()=>{yg({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})}handleStart(){const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});yg({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.updateInstanceState({cursor:{type:kc[this.info.handle],rotation:t+this.snapshot.initialSelectionRotation}})}_getRotationFromPointerPosition({snapToNearestDegree:t}){const r=this.editor.getSelectionRotation(),i=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:o,currentPagePoint:s}}=this.editor,{initialCursorAngle:a,initialSelectionRotation:l}=this.snapshot;if(!i)return l;const c=i.center.clone().rotWith(i.point,r).angle(s)-a;let d=l+c;if(o)d=Qf(d,24);else if(t&&(d=Math.round(d/Oj)*Oj,this.editor.getInstanceState().isCoarsePointer)){const u=Qf(d,4),h=wu(d,u);Math.abs(h)<u9(5)&&(d=u)}return d-l}}y(Lj,"id","rotating");class zj extends ae{constructor(){super(...arguments);y(this,"hits",new Set);y(this,"size",0);y(this,"scribbleId","id");y(this,"initialSelectedShapeIds",new Set);y(this,"newlySelectedShapeIds",new Set);y(this,"onEnter",()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const t=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=t.id,this.updateScribbleSelection(!0),requestAnimationFrame(()=>{this.editor.updateInstanceState({brush:null})})});y(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});y(this,"onPointerMove",()=>{this.updateScribbleSelection(!0)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onKeyDown",()=>{this.updateScribbleSelection(!1)});y(this,"onKeyUp",()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)})}updateScribbleSelection(t){const r=this.editor.getZoomLevel(),i=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:o,originPagePoint:s,previousPagePoint:a,currentPagePoint:l}}=this.editor,{newlySelectedShapeIds:c,initialSelectedShapeIds:d}=this;t&&this.pushPointToScribble();const u=i;let h,p,g,f;for(let w=0,v=u.length;w<v;w++)if(h=u[w],p=this.editor.getShapeGeometry(h),!(this.editor.isShapeOfType(h,"group")||c.has(h.id)||this.editor.isShapeOrAncestorLocked(h))){if(this.editor.isShapeOfType(h,"frame")){const b=this.editor.getPointInShapeSpace(h,s);if(p.bounds.containsPoint(b))continue}if(g=this.editor.getPointInShapeSpace(h,a),f=this.editor.getPointInShapeSpace(h,l),p.hitTestLineSegment(g,f,li/r)){const b=this.editor.getOutermostSelectableShape(h),_=this.editor.getShapeMask(b.id);if(_&&IM(a,l,_)!==null&&!zi(l,_))continue;c.add(b.id)}}this.editor.setSelectedShapes([...new Set(o?[...c,...d]:[...c])],{squashing:!0})}complete(){this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds],{squashing:!0}),this.parent.transition("idle")}}y(zj,"id","scribble_brushing");const Nj=100;class zQ{constructor(e){y(this,"prevDroppingShapeId",null);y(this,"droppingNodeTimer",null);y(this,"first",!0);y(this,"dispose",()=>{this.clear()});this.editor=e,e.disposables.add(this.dispose)}updateDroppingNode(e,t){var r;this.first&&(this.prevDroppingShapeId=((r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:r.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,Nj*10,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(e,Nj,t))}setDragTimer(e,t,r){this.droppingNodeTimer=setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,r){var l,c,d,u,h;t=me(t.map(p=>this.editor.getShape(p.id)));const i=((l=this.editor.getDroppingOverShape(e,t))==null?void 0:l.id)??null;if(i===this.prevDroppingShapeId)return;const{prevDroppingShapeId:o}=this,s=o&&this.editor.getShape(o),a=i&&this.editor.getShape(i);if(s&&((d=(c=this.editor.getShapeUtil(s)).onDragShapesOut)==null||d.call(c,s,t)),a){const p=(h=(u=this.editor.getShapeUtil(a)).onDragShapesOver)==null?void 0:h.call(u,a,t);p&&p.shouldHint&&this.editor.setHintingShapes([a.id])}else this.editor.setHintingShapes([]);r==null||r(),this.prevDroppingShapeId=i}dropShapes(e){var r,i;const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){const o=this.editor.getShape(t);if(!o)return;(i=(r=this.editor.getShapeUtil(o)).onDropShapesOver)==null||i.call(r,o,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class Fj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"selectionSnapshot",{});y(this,"snapshot",{});y(this,"markId","");y(this,"isCloning",!1);y(this,"isCreating",!1);y(this,"onCreate",()=>{});y(this,"dragAndDropManager",new zQ(this.editor));y(this,"onEnter",t=>{const{isCreating:r=!1,onCreate:i=()=>{}}=t;if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.isCreating=r,this.onCreate=i,r?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=t,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=$j(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()});y(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.dragAndDropManager.clear()});y(this,"onTick",()=>{this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),Gv(this.editor)});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onKeyDown",()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()});y(this,"onKeyUp",()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"updateParentTransforms",()=>{const{editor:t,snapshot:{shapeSnapshots:r}}=this;r.forEach(i=>{const o=t.getShape(i.shape.id);if(!o)return null;const s=Zn(o.parentId)?null:oe.Inverse(t.getShapePageTransform(o.parentId));i.parentTransform=s})})}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=$j(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var t;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(t=this.onCreate)==null||t.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:t}=this.snapshot,r=[];t.forEach(i=>{var s,a;const o=(a=(s=this.editor.getShapeUtil(i)).onTranslateStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:t}=this.snapshot,r=[];t.forEach(i=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onTranslateEnd)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}handleChange(){const{movingShapes:t}=this.snapshot,r=[];t.forEach(i=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onTranslate)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{snapshot:t}=this;this.dragAndDropManager.updateDroppingNode(t.movingShapes,this.updateParentTransforms),NQ({editor:this.editor,shapeSnapshots:t.shapeSnapshots,averagePagePoint:t.averagePagePoint,initialSelectionPageBounds:t.initialPageBounds,initialSelectionSnapPoints:t.initialSnapPoints}),this.handleChange()}}y(Fj,"id","translating");function $j(n){const e=[],t=[],r=me(n.getSelectedShapeIds().map(o=>{const s=n.getShape(o);if(!s)return null;e.push(s);const a=n.getShapePageTransform(o).point();if(!a)return null;t.push(a);const l=ko.isId(s.parentId)?null:oe.Inverse(n.getShapePageTransform(s.parentId));return{shape:s,pagePoint:a,parentTransform:l}}));let i=[];if(n.getSelectedShapeIds().length===1)i=n.snaps.getSnapPointsCache().get(n.getSelectedShapeIds()[0]);else{const o=n.getSelectionPageBounds();o&&(i=o.snapPoints.map((s,a)=>({id:"selection:"+a,x:s.x,y:s.y})))}return{averagePagePoint:C.Average(t),movingShapes:e,shapeSnapshots:r,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:i}}function NQ({editor:n,shapeSnapshots:e,averagePagePoint:t,initialSelectionPageBounds:r,initialSelectionSnapPoints:i}){const{inputs:o}=n,s=n.getInstanceState().isGridMode,a=n.getDocumentSettings().gridSize,l=C.Sub(o.currentPagePoint,o.originPagePoint),c=n.inputs.shiftKey?Math.abs(l.x)<Math.abs(l.y)?"x":"y":null;if(c==="x"?l.x=0:c==="y"&&(l.y=0),n.snaps.clear(),(n.user.getIsSnapMode()?!o.ctrlKey:o.ctrlKey)&&n.inputs.pointerVelocity.len()<.5){const{nudge:h}=n.snaps.snapTranslate({dragDelta:l,initialSelectionPageBounds:r,lockedAxis:c,initialSelectionSnapPoints:i});l.add(h)}const d=C.Add(t,l);s&&!o.ctrlKey&&d.snapToGrid(a);const u=C.Sub(d,t);n.updateShapes(me(e.map(({shape:h,pagePoint:p,parentTransform:g})=>{const f=C.Add(p,u),w=g?oe.applyToPoint(g,f):f;return{id:h.id,type:h.type,x:w.x,y:w.y}})),{squashing:!0})}class Mm extends ae{constructor(){super(...arguments);y(this,"onExit",()=>{this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)})}}y(Mm,"id","select"),y(Mm,"initial","idle"),y(Mm,"children",()=>[Pm,xj,RQ,Pj,jj,Fj,yj,zj,Ij,Tj,Sj,kj,Rj,Lj,Aj,Mj,_j]);class Bj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t});y(this,"onPointerDown",()=>{this.parent.transition("pointing",this.info)})}}y(Bj,"id","idle");class Uj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t});y(this,"onPointerUp",()=>{this.complete()});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)});y(this,"onCancel",()=>{this.cancel()})}complete(){const{currentScreenPoint:t}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(t,{duration:220}):this.editor.zoomIn(t,{duration:220}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}y(Uj,"id","pointing");class Vj extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"zoomBrush",new de);y(this,"onEnter",t=>{this.info=t,this.update()});y(this,"onExit",()=>{this.editor.updateInstanceState({zoomBrush:null})});y(this,"onPointerMove",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()})}update(){const{inputs:{originPagePoint:t,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(de.FromPoints([t,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:t}=this,r=8/this.editor.getZoomLevel();if(t.width<r&&t.height<r){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{duration:220}):this.editor.zoomIn(i,{duration:220})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(t,i,{duration:220})}this.parent.transition("idle",this.info)}}y(Vj,"id","zoom_brushing");class Am extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.updateCursor()});y(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)});y(this,"onKeyDown",()=>{this.updateCursor()});y(this,"onKeyUp",t=>{this.updateCursor(),t.code==="KeyZ"&&this.complete()});y(this,"onInterrupt",()=>{this.complete()})}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.updateInstanceState({cursor:{type:"zoom-out",rotation:0}},{ephemeral:!0}):this.editor.updateInstanceState({cursor:{type:"zoom-in",rotation:0}},{ephemeral:!0})}}y(Am,"id","zoom"),y(Am,"initial","idle"),y(Am,"children",()=>[Bj,Vj,Uj]);const FQ=[km,Cm,Em,Am,Mm];function J(){return J=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},J.apply(this,arguments)}function ne(n,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(n==null||n(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function $Q(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function Tm(...n){return e=>n.forEach(t=>$Q(t,e))}function Je(...n){return S.useCallback(Tm(...n),n)}function Bi(n,e=[]){let t=[];function r(o,s){const a=S.createContext(s),l=t.length;t=[...t,s];function c(u){const{scope:h,children:p,...g}=u,f=(h==null?void 0:h[n][l])||a,w=S.useMemo(()=>g,Object.values(g));return S.createElement(f.Provider,{value:w},p)}function d(u,h){const p=(h==null?void 0:h[n][l])||a,g=S.useContext(p);if(g)return g;if(s!==void 0)return s;throw new Error(`\`${u}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,d]}const i=()=>{const o=t.map(s=>S.createContext(s));return function(s){const a=(s==null?void 0:s[n])||o;return S.useMemo(()=>({[`__scope${n}`]:{...s,[n]:a}}),[s,a])}};return i.scopeName=n,[r,BQ(i,...e)]}function BQ(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(i){const o=r.reduce((s,{useScope:a,scopeName:l})=>{const c=a(i)[`__scope${l}`];return{...s,...c}},{});return S.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}const Da=S.forwardRef((n,e)=>{const{children:t,...r}=n,i=S.Children.toArray(t),o=i.find(VQ);if(o){const s=o.props.children,a=i.map(l=>l===o?S.Children.count(s)>1?S.Children.only(null):S.isValidElement(s)?s.props.children:null:l);return S.createElement(xS,J({},r,{ref:e}),S.isValidElement(s)?S.cloneElement(s,void 0,a):null)}return S.createElement(xS,J({},r,{ref:e}),t)});Da.displayName="Slot";const xS=S.forwardRef((n,e)=>{const{children:t,...r}=n;return S.isValidElement(t)?S.cloneElement(t,{...HQ(r,t.props),ref:e?Tm(e,t.ref):t.ref}):S.Children.count(t)>1?S.Children.only(null):null});xS.displayName="SlotClone";const UQ=({children:n})=>S.createElement(S.Fragment,null,n);function VQ(n){return S.isValidElement(n)&&n.type===UQ}function HQ(n,e){const t={...e};for(const r in e){const i=n[r],o=e[r];/^on[A-Z]/.test(r)?i&&o?t[r]=(...s)=>{o(...s),i(...s)}:i&&(t[r]=i):r==="style"?t[r]={...i,...o}:r==="className"&&(t[r]=[i,o].filter(Boolean).join(" "))}return{...n,...t}}function jm(n){const e=n+"CollectionProvider",[t,r]=Bi(e),[i,o]=t(e,{collectionRef:{current:null},itemMap:new Map}),s=p=>{const{scope:g,children:f}=p,w=re.useRef(null),v=re.useRef(new Map).current;return re.createElement(i,{scope:g,itemMap:v,collectionRef:w},f)},a=n+"CollectionSlot",l=re.forwardRef((p,g)=>{const{scope:f,children:w}=p,v=o(a,f),b=Je(g,v.collectionRef);return re.createElement(Da,{ref:b},w)}),c=n+"CollectionItemSlot",d="data-radix-collection-item",u=re.forwardRef((p,g)=>{const{scope:f,children:w,...v}=p,b=re.useRef(null),_=Je(g,b),x=o(c,f);return re.useEffect(()=>(x.itemMap.set(b,{ref:b,...v}),()=>void x.itemMap.delete(b))),re.createElement(Da,{[d]:"",ref:_},w)});function h(p){const g=o(n+"CollectionConsumer",p);return re.useCallback(()=>{const f=g.collectionRef.current;if(!f)return[];const w=Array.from(f.querySelectorAll(`[${d}]`));return Array.from(g.itemMap.values()).sort((v,b)=>w.indexOf(v.ref.current)-w.indexOf(b.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:s,Slot:l,ItemSlot:u},h,r]}const WQ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Re=WQ.reduce((n,e)=>{const t=S.forwardRef((r,i)=>{const{asChild:o,...s}=r,a=o?Da:e;return S.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),S.createElement(a,J({},s,{ref:i}))});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function Cc(n,e){n&&Dl.flushSync(()=>n.dispatchEvent(e))}function It(n){const e=S.useRef(n);return S.useEffect(()=>{e.current=n}),S.useMemo(()=>(...t)=>{var r;return(r=e.current)===null||r===void 0?void 0:r.call(e,...t)},[])}function Rm(n,e=globalThis==null?void 0:globalThis.document){const t=It(n);S.useEffect(()=>{const r=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",r),()=>e.removeEventListener("keydown",r)},[t,e])}const _S="dismissableLayer.update",KQ="dismissableLayer.pointerDownOutside",GQ="dismissableLayer.focusOutside";let Hj;const Wj=S.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),YQ=S.forwardRef((n,e)=>{var t;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...c}=n,d=S.useContext(Wj),[u,h]=S.useState(null),p=(t=u==null?void 0:u.ownerDocument)!==null&&t!==void 0?t:globalThis==null?void 0:globalThis.document,[,g]=S.useState({}),f=Je(e,I=>h(I)),w=Array.from(d.layers),[v]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),b=w.indexOf(v),_=u?w.indexOf(u):-1,x=d.layersWithOutsidePointerEventsDisabled.size>0,E=_>=b,k=qQ(I=>{const A=I.target,T=[...d.branches].some(O=>O.contains(A));!E||T||(o==null||o(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p),P=JQ(I=>{const A=I.target;[...d.branches].some(T=>T.contains(A))||(s==null||s(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p);return Rm(I=>{_===d.layers.size-1&&(i==null||i(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},p),S.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(Hj=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),Kj(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=Hj)}},[u,p,r,d]),S.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),Kj())},[u,d]),S.useEffect(()=>{const I=()=>g({});return document.addEventListener(_S,I),()=>document.removeEventListener(_S,I)},[]),S.createElement(Re.div,J({},c,{ref:f,style:{pointerEvents:x?E?"auto":"none":void 0,...n.style},onFocusCapture:ne(n.onFocusCapture,P.onFocusCapture),onBlurCapture:ne(n.onBlurCapture,P.onBlurCapture),onPointerDownCapture:ne(n.onPointerDownCapture,k.onPointerDownCapture)}))}),XQ=S.forwardRef((n,e)=>{const t=S.useContext(Wj),r=S.useRef(null),i=Je(e,r);return S.useEffect(()=>{const o=r.current;if(o)return t.branches.add(o),()=>{t.branches.delete(o)}},[t.branches]),S.createElement(Re.div,J({},n,{ref:i}))});function qQ(n,e=globalThis==null?void 0:globalThis.document){const t=It(n),r=S.useRef(!1),i=S.useRef(()=>{});return S.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){Gj(KQ,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function JQ(n,e=globalThis==null?void 0:globalThis.document){const t=It(n),r=S.useRef(!1);return S.useEffect(()=>{const i=o=>{o.target&&!r.current&&Gj(GQ,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Kj(){const n=new CustomEvent(_S);document.dispatchEvent(n)}function Gj(n,e,t,{discrete:r}){const i=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?Cc(i,o):i.dispatchEvent(o)}const ZQ=YQ,QQ=XQ,eee=S.forwardRef((n,e)=>{var t;const{container:r=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...i}=n;return r?Ef.createPortal(S.createElement(Re.div,J({},i,{ref:e})),r):null}),Oa=globalThis!=null&&globalThis.document?S.useLayoutEffect:()=>{};function tee(n,e){return S.useReducer((t,r)=>e[t][r]??t,n)}const fi=n=>{const{present:e,children:t}=n,r=nee(e),i=typeof t=="function"?t({present:r.isPresent}):S.Children.only(t),o=Je(r.ref,i.ref);return typeof t=="function"||r.isPresent?S.cloneElement(i,{ref:o}):null};fi.displayName="Presence";function nee(n){const[e,t]=S.useState(),r=S.useRef({}),i=S.useRef(n),o=S.useRef("none"),s=n?"mounted":"unmounted",[a,l]=tee(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return S.useEffect(()=>{const c=Dm(r.current);o.current=a==="mounted"?c:"none"},[a]),Oa(()=>{const c=r.current,d=i.current;if(d!==n){const u=o.current,h=Dm(c);n?l("MOUNT"):h==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(d&&u!==h?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,l]),Oa(()=>{if(e){const c=u=>{const h=Dm(r.current).includes(u.animationName);u.target===e&&h&&Dl.flushSync(()=>l("ANIMATION_END"))},d=u=>{u.target===e&&(o.current=Dm(r.current))};return e.addEventListener("animationstart",d),e.addEventListener("animationcancel",c),e.addEventListener("animationend",c),()=>{e.removeEventListener("animationstart",d),e.removeEventListener("animationcancel",c),e.removeEventListener("animationend",c)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:S.useCallback(c=>{c&&(r.current=getComputedStyle(c)),t(c)},[])}}function Dm(n){return(n==null?void 0:n.animationName)||"none"}function Ls({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,i]=ree({defaultProp:e,onChange:t}),o=n!==void 0,s=o?n:r,a=It(t),l=S.useCallback(c=>{if(o){const d=typeof c=="function"?c(n):c;d!==n&&a(d)}else i(c)},[o,n,i,a]);return[s,l]}function ree({defaultProp:n,onChange:e}){const t=S.useState(n),[r]=t,i=S.useRef(r),o=It(e);return S.useEffect(()=>{i.current!==r&&(o(r),i.current=r)},[r,i,o]),t}const Yj=S.forwardRef((n,e)=>S.createElement(Re.span,J({},n,{ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}))),Xj="ToastProvider",[kS,iee,oee]=jm("Toast"),[qj,Ube]=Bi("Toast",[oee]),[see,Om]=qj(Xj),Jj=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:s}=n,[a,l]=S.useState(null),[c,d]=S.useState(0),u=S.useRef(!1),h=S.useRef(!1);return S.createElement(kS.Provider,{scope:e},S.createElement(see,{scope:e,label:t,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:S.useCallback(()=>d(p=>p+1),[]),onToastRemove:S.useCallback(()=>d(p=>p-1),[]),isFocusedToastEscapeKeyDownRef:u,isClosePausedRef:h},s))};Jj.propTypes={label(n){if(n.label&&typeof n.label=="string"&&!n.label.trim()){const e=`Invalid prop \`label\` supplied to \`${Xj}\`. Expected non-empty \`string\`.`;return new Error(e)}return null}};const aee="ToastViewport",lee=["F8"],CS="toast.viewportPause",ES="toast.viewportResume",cee=S.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=lee,label:i="Notifications ({hotkey})",...o}=n,s=Om(aee,t),a=iee(t),l=S.useRef(null),c=S.useRef(null),d=S.useRef(null),u=S.useRef(null),h=Je(e,u,s.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=s.toastCount>0;S.useEffect(()=>{const w=v=>{var b;r.every(_=>v[_]||v.code===_)&&((b=u.current)===null||b===void 0||b.focus())};return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[r]),S.useEffect(()=>{const w=l.current,v=u.current;if(g&&w&&v){const b=()=>{if(!s.isClosePausedRef.current){const k=new CustomEvent(CS);v.dispatchEvent(k),s.isClosePausedRef.current=!0}},_=()=>{if(s.isClosePausedRef.current){const k=new CustomEvent(ES);v.dispatchEvent(k),s.isClosePausedRef.current=!1}},x=k=>{!w.contains(k.relatedTarget)&&_()},E=()=>{w.contains(document.activeElement)||_()};return w.addEventListener("focusin",b),w.addEventListener("focusout",x),w.addEventListener("pointermove",b),w.addEventListener("pointerleave",E),window.addEventListener("blur",b),window.addEventListener("focus",_),()=>{w.removeEventListener("focusin",b),w.removeEventListener("focusout",x),w.removeEventListener("pointermove",b),w.removeEventListener("pointerleave",E),window.removeEventListener("blur",b),window.removeEventListener("focus",_)}}},[g,s.isClosePausedRef]);const f=S.useCallback(({tabbingDirection:w})=>{const v=a().map(b=>{const _=b.ref.current,x=[_,...Cee(_)];return w==="forwards"?x:x.reverse()});return(w==="forwards"?v.reverse():v).flat()},[a]);return S.useEffect(()=>{const w=u.current;if(w){const v=b=>{const _=b.altKey||b.ctrlKey||b.metaKey;if(b.key==="Tab"&&!_){const P=document.activeElement,I=b.shiftKey;if(b.target===w&&I){var x;(x=c.current)===null||x===void 0||x.focus();return}const A=f({tabbingDirection:I?"backwards":"forwards"}),T=A.findIndex(O=>O===P);if(PS(A.slice(T+1)))b.preventDefault();else{var E,k;I?(E=c.current)===null||E===void 0||E.focus():(k=d.current)===null||k===void 0||k.focus()}}};return w.addEventListener("keydown",v),()=>w.removeEventListener("keydown",v)}},[a,f]),S.createElement(QQ,{ref:l,role:"region","aria-label":i.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:g?void 0:"none"}},g&&S.createElement(Zj,{ref:c,onFocusFromOutsideViewport:()=>{const w=f({tabbingDirection:"forwards"});PS(w)}}),S.createElement(kS.Slot,{scope:t},S.createElement(Re.ol,J({tabIndex:-1},o,{ref:h}))),g&&S.createElement(Zj,{ref:d,onFocusFromOutsideViewport:()=>{const w=f({tabbingDirection:"backwards"});PS(w)}}))}),dee="ToastFocusProxy",Zj=S.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...i}=n,o=Om(dee,t);return S.createElement(Yj,J({"aria-hidden":!0,tabIndex:0},i,{ref:e,style:{position:"fixed"},onFocus:s=>{var a;const l=s.relatedTarget;!((a=o.viewport)!==null&&a!==void 0&&a.contains(l))&&r()}}))}),Lm="Toast",uee="toast.swipeStart",hee="toast.swipeMove",pee="toast.swipeCancel",fee="toast.swipeEnd",gee=S.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:i,onOpenChange:o,...s}=n,[a=!0,l]=Ls({prop:r,defaultProp:i,onChange:o});return S.createElement(fi,{present:t||a},S.createElement(Qj,J({open:a},s,{ref:e,onClose:()=>l(!1),onPause:It(n.onPause),onResume:It(n.onResume),onSwipeStart:ne(n.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ne(n.onSwipeMove,c=>{const{x:d,y:u}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${u}px`)}),onSwipeCancel:ne(n.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ne(n.onSwipeEnd,c=>{const{x:d,y:u}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${u}px`),l(!1)})})))}),[mee,yee]=qj(Lm,{onClose(){}}),Qj=S.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:i,open:o,onClose:s,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:d,onSwipeMove:u,onSwipeCancel:h,onSwipeEnd:p,...g}=n,f=Om(Lm,t),[w,v]=S.useState(null),b=Je(e,D=>v(D)),_=S.useRef(null),x=S.useRef(null),E=i||f.duration,k=S.useRef(0),P=S.useRef(E),I=S.useRef(0),{onToastAdd:A,onToastRemove:T}=f,O=It(()=>{var D;w!=null&&w.contains(document.activeElement)&&((D=f.viewport)===null||D===void 0||D.focus()),s()}),F=S.useCallback(D=>{!D||D===1/0||(window.clearTimeout(I.current),k.current=new Date().getTime(),I.current=window.setTimeout(O,D))},[O]);S.useEffect(()=>{const D=f.viewport;if(D){const K=()=>{F(P.current),c==null||c()},B=()=>{const te=new Date().getTime()-k.current;P.current=P.current-te,window.clearTimeout(I.current),l==null||l()};return D.addEventListener(CS,B),D.addEventListener(ES,K),()=>{D.removeEventListener(CS,B),D.removeEventListener(ES,K)}}},[f.viewport,E,l,c,F]),S.useEffect(()=>{o&&!f.isClosePausedRef.current&&F(E)},[o,E,f.isClosePausedRef,F]),S.useEffect(()=>(A(),()=>T()),[A,T]);const H=S.useMemo(()=>w?rR(w):null,[w]);return f.viewport?S.createElement(S.Fragment,null,H&&S.createElement(wee,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0},H),S.createElement(mee,{scope:t,onClose:O},Dl.createPortal(S.createElement(kS.ItemSlot,{scope:t},S.createElement(ZQ,{asChild:!0,onEscapeKeyDown:ne(a,()=>{f.isFocusedToastEscapeKeyDownRef.current||O(),f.isFocusedToastEscapeKeyDownRef.current=!1})},S.createElement(Re.li,J({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":f.swipeDirection},g,{ref:b,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:ne(n.onKeyDown,D=>{D.key==="Escape"&&(a==null||a(D.nativeEvent),D.nativeEvent.defaultPrevented||(f.isFocusedToastEscapeKeyDownRef.current=!0,O()))}),onPointerDown:ne(n.onPointerDown,D=>{D.button===0&&(_.current={x:D.clientX,y:D.clientY})}),onPointerMove:ne(n.onPointerMove,D=>{if(!_.current)return;const K=D.clientX-_.current.x,B=D.clientY-_.current.y,te=!!x.current,W=["left","right"].includes(f.swipeDirection),N=["left","up"].includes(f.swipeDirection)?Math.min:Math.max,Y=W?N(0,K):0,ee=W?0:N(0,B),pe=D.pointerType==="touch"?10:2,ve={x:Y,y:ee},be={originalEvent:D,delta:ve};te?(x.current=ve,zm(hee,u,be,{discrete:!1})):iR(ve,f.swipeDirection,pe)?(x.current=ve,zm(uee,d,be,{discrete:!1}),D.target.setPointerCapture(D.pointerId)):(Math.abs(K)>pe||Math.abs(B)>pe)&&(_.current=null)}),onPointerUp:ne(n.onPointerUp,D=>{const K=x.current,B=D.target;if(B.hasPointerCapture(D.pointerId)&&B.releasePointerCapture(D.pointerId),x.current=null,_.current=null,K){const te=D.currentTarget,W={originalEvent:D,delta:K};iR(K,f.swipeDirection,f.swipeThreshold)?zm(fee,p,W,{discrete:!0}):zm(pee,h,W,{discrete:!0}),te.addEventListener("click",N=>N.preventDefault(),{once:!0})}})})))),f.viewport))):null});Qj.propTypes={type(n){if(n.type&&!["foreground","background"].includes(n.type)){const e=`Invalid prop \`type\` supplied to \`${Lm}\`. Expected \`foreground | background\`.`;return new Error(e)}return null}};const wee=n=>{const{__scopeToast:e,children:t,...r}=n,i=Om(Lm,e),[o,s]=S.useState(!1),[a,l]=S.useState(!1);return _ee(()=>s(!0)),S.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:S.createElement(eee,{asChild:!0},S.createElement(Yj,r,o&&S.createElement(S.Fragment,null,i.label," ",t)))},bee=S.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return S.createElement(Re.div,J({},r,{ref:e}))}),vee=S.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return S.createElement(Re.div,J({},r,{ref:e}))}),See="ToastAction",eR=S.forwardRef((n,e)=>{const{altText:t,...r}=n;return t?S.createElement(nR,{altText:t,asChild:!0},S.createElement(tR,J({},r,{ref:e}))):null});eR.propTypes={altText(n){return n.altText?null:new Error(`Missing prop \`altText\` expected on \`${See}\``)}};const xee="ToastClose",tR=S.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,i=yee(xee,t);return S.createElement(nR,{asChild:!0},S.createElement(Re.button,J({type:"button"},r,{ref:e,onClick:ne(n.onClick,i.onClose)})))}),nR=S.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...i}=n;return S.createElement(Re.div,J({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0},i,{ref:e}))});function rR(n){const e=[];return Array.from(n.childNodes).forEach(t=>{if(t.nodeType===t.TEXT_NODE&&t.textContent&&e.push(t.textContent),kee(t)){const r=t.ariaHidden||t.hidden||t.style.display==="none",i=t.dataset.radixToastAnnounceExclude==="";if(!r)if(i){const o=t.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...rR(t))}}),e}function zm(n,e,t,{discrete:r}){const i=t.originalEvent.currentTarget,o=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?Cc(i,o):i.dispatchEvent(o)}const iR=(n,e,t=0)=>{const r=Math.abs(n.x),i=Math.abs(n.y),o=r>i;return e==="left"||e==="right"?o&&r>t:!o&&i>t};function _ee(n=()=>{}){const e=It(n);Oa(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function kee(n){return n.nodeType===n.ELEMENT_NODE}function Cee(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function PS(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}const Eee=gee,Pee=bee,Iee=vee,Mee=eR,oR=tR,La="2.0.0-beta.2";let IS={fonts:{draw:`https://unpkg.com/@tldraw/assets@${La}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`https://unpkg.com/@tldraw/assets@${La}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`https://unpkg.com/@tldraw/assets@${La}/fonts/IBMPlexSans-Medium.woff2`,monospace:`https://unpkg.com/@tldraw/assets@${La}/fonts/IBMPlexMono-Medium.woff2`}};function Aee(n){return S.useMemo(()=>n?{fonts:{...IS.fonts,...n==null?void 0:n.fonts}}:IS,[n])}let Qu={...IS,icons:Object.fromEntries(["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"].map(n=>[n,`https://unpkg.com/@tldraw/assets@${La}/icons/icon/${n}.svg`])),translations:Object.fromEntries(du.map(n=>[n.locale,`https://unpkg.com/@tldraw/assets@${La}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(Wl.map(n=>[n.type,`https://unpkg.com/@tldraw/assets@${La}/embed-icons/${n.type}.png`]))};function Tee(n){return n?{fonts:Object.assign({...Qu.fonts},{...n==null?void 0:n.fonts}),icons:Object.assign({...Qu.icons},{...n==null?void 0:n.icons}),embedIcons:Object.assign({...Qu.embedIcons},{...n==null?void 0:n.embedIcons}),translations:Object.assign({...Qu.translations},{...n==null?void 0:n.translations})}:Qu}function jee(n,e){const t=me(e.map(i=>n.getShape(i)).filter(i=>i&&n.isShapeOfType(i,"frame")));if(!t.length)return;const r=[];n.batch(()=>{t.map(i=>{const o=n.getSortedChildIdsForParent(i.id);o.length&&(n.reparentShapes(o,i.parentId,i.index),r.push(...o))}),n.setSelectedShapes(r),n.deleteShapes(e)})}const Ree=50;function Dee(n,e,t={}){const r=n.getShape(e);if(!r)return;const i=n.getSortedChildIdsForParent(r.id),o=me(i.map(p=>n.getShape(p)));if(!o.length)return;const s=de.FromPoints(o.flatMap(p=>{const g=n.getShapeGeometry(p.id);return n.getShapeLocalTransform(p).applyToPoints(g.vertices)})),{padding:a=Ree}=t,l=s.w+2*a,c=s.h+2*a,d=a-s.minX,u=a-s.minY;if(d===0&&u===0&&r.props.w===l&&r.props.h===c)return;const h=new C(d,u).rot(r.rotation);n.batch(()=>{const p=i.map(g=>{const f=n.getShape(g);return{id:f.id,type:f.type,x:f.x+d,y:f.y+u}});p.push({id:r.id,type:r.type,x:r.x-h.x,y:r.y-h.y,props:{w:l,h:c}}),n.updateShapes(p)})}const sR=S.createContext(null);function Oee({assetUrls:n,children:e}){return m.jsx(sR.Provider,{value:n,children:e})}function MS(){const n=S.useContext(sR);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const AS={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},Ec={locale:"en",label:"English",messages:AS};async function Lee(n,e){if(!(await fetch(e.translations.en)).ok)return console.warn("No main translations found."),Ec;if(n==="en")return Ec;const t=du.find(o=>o.locale===n);if(!t)return console.warn(`No translation found for locale ${n}`),Ec;const r=await(await fetch(e.translations[t.locale])).json();if(!r)return console.warn(`No messages found for locale ${n}`),Ec;const i=[];for(const o in Ec.messages)r[o]||i.push(o);return i.length>0,{locale:n,label:t.label,messages:{...Ec.messages,...r}}}const aR=S.createContext({}),zee=()=>S.useContext(aR),Nee=$e(function({overrides:n,children:e}){const t=G().user.getLocale(),r=MS(),[i,o]=S.useState(()=>n&&n.en?{locale:"en",label:"English",messages:{...AS,...n.en}}:{locale:"en",label:"English",messages:AS});return S.useEffect(()=>{let s=!1;async function a(){const l=await Lee(t,r);l&&!s&&(n&&n[t]?o({...l,messages:{...l.messages,...n[t]}}):o(l))}return a(),()=>{s=!0}},[r,t,n]),m.jsx(aR.Provider,{value:i,children:e})});function Ae(){const n=zee();return S.useCallback(function(e){return n.messages[e]??e},[n])}function Fee(n){return m.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:m.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[m.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),m.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:m.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const xr=S.memo(function({small:n,invertIcon:e,icon:t,color:r,className:i,...o}){const s=MS(),a=s.icons[t]??s.icons["question-mark-circle"],l=S.useRef(null);return S.useLayoutEffect(()=>{a||console.error(`Icon not found: ${t}. Add it to the assetUrls.icons object.`),l!=null&&l.current&&(l.current.style.webkitMask=`url(${a}) center 100% / 100% no-repeat`)},[l,a,t]),m.jsx("div",{...o,ref:l,className:ye("tlui-icon",{"tlui-icon__small":n},i),style:{color:r,mask:`url(${a}) center 100% / 100% no-repeat`,transform:e?"scale(-1, 1)":void 0}})}),lR=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,cR=lR?"\u2318":"Ctrl",dR=lR?"\u2325":"Alt";function $ee(n){return n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,cR).replace(/\?/g,dR).replace(/!/g,"\u21E7");return t[0].toUpperCase()+t.slice(1)})}function Ui(n){return"\u2014 "+n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,cR).replace(/\?/g,dR).replace(/!/g,"\u21E7");return t[0].toUpperCase()+t.slice(1)}).join("\u2009")}function Nm({children:n}){return m.jsx("kbd",{className:"tlui-kbd",children:$ee(n).map((e,t)=>m.jsx("span",{children:e},t))})}const le=S.forwardRef(function({label:n,icon:e,invertIcon:t,iconLeft:r,smallIcon:i,kbd:o,isChecked:s=!1,type:a,children:l,spinner:c,...d},u){const h=Ae(),p=n?h(n):"";return m.jsxs("button",{ref:u,draggable:!1,type:"button",...d,title:d.title??p,className:ye("tlui-button",`tlui-button__${a}`,d.className),children:[r&&m.jsx(xr,{icon:r,className:"tlui-button__icon-left",small:!0}),l,n&&m.jsxs("span",{className:"tlui-button__label",draggable:!1,children:[p,s&&m.jsx(xr,{icon:"check"})]}),o&&m.jsx(Nm,{children:o}),e&&!c&&m.jsx(xr,{icon:e,small:!!n||i,invertIcon:t}),c&&m.jsx(Fee,{})]})}),Bee=Iz["useId".toString()]||(()=>{});let Uee=0;function Lo(n){const[e,t]=S.useState(Bee());return Oa(()=>{n||t(r=>r??String(Uee++))},[n]),n||(e?`radix-${e}`:"")}const TS="dismissableLayer.update",Vee="dismissableLayer.pointerDownOutside",Hee="dismissableLayer.focusOutside";let uR;const Wee=S.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Kee=S.forwardRef((n,e)=>{var t;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...c}=n,d=S.useContext(Wee),[u,h]=S.useState(null),p=(t=u==null?void 0:u.ownerDocument)!==null&&t!==void 0?t:globalThis==null?void 0:globalThis.document,[,g]=S.useState({}),f=Je(e,I=>h(I)),w=Array.from(d.layers),[v]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),b=w.indexOf(v),_=u?w.indexOf(u):-1,x=d.layersWithOutsidePointerEventsDisabled.size>0,E=_>=b,k=Gee(I=>{const A=I.target,T=[...d.branches].some(O=>O.contains(A));!E||T||(o==null||o(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p),P=Yee(I=>{const A=I.target;[...d.branches].some(T=>T.contains(A))||(s==null||s(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p);return Rm(I=>{_===d.layers.size-1&&(i==null||i(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},p),S.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(uR=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),hR(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=uR)}},[u,p,r,d]),S.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),hR())},[u,d]),S.useEffect(()=>{const I=()=>g({});return document.addEventListener(TS,I),()=>document.removeEventListener(TS,I)},[]),S.createElement(Re.div,J({},c,{ref:f,style:{pointerEvents:x?E?"auto":"none":void 0,...n.style},onFocusCapture:ne(n.onFocusCapture,P.onFocusCapture),onBlurCapture:ne(n.onBlurCapture,P.onBlurCapture),onPointerDownCapture:ne(n.onPointerDownCapture,k.onPointerDownCapture)}))});function Gee(n,e=globalThis==null?void 0:globalThis.document){const t=It(n),r=S.useRef(!1),i=S.useRef(()=>{});return S.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){pR(Vee,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function Yee(n,e=globalThis==null?void 0:globalThis.document){const t=It(n),r=S.useRef(!1);return S.useEffect(()=>{const i=o=>{o.target&&!r.current&&pR(Hee,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function hR(){const n=new CustomEvent(TS);document.dispatchEvent(n)}function pR(n,e,t,{discrete:r}){const i=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?Cc(i,o):i.dispatchEvent(o)}const jS="focusScope.autoFocusOnMount",RS="focusScope.autoFocusOnUnmount",fR={bubbles:!1,cancelable:!0},DS=S.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=n,[a,l]=S.useState(null),c=It(i),d=It(o),u=S.useRef(null),h=Je(e,f=>l(f)),p=S.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;S.useEffect(()=>{if(r){let f=function(_){if(p.paused||!a)return;const x=_.target;a.contains(x)?u.current=x:zs(u.current,{select:!0})},w=function(_){if(p.paused||!a)return;const x=_.relatedTarget;x!==null&&(a.contains(x)||zs(u.current,{select:!0}))},v=function(_){if(document.activeElement===document.body)for(const x of _)x.removedNodes.length>0&&zs(a)};document.addEventListener("focusin",f),document.addEventListener("focusout",w);const b=new MutationObserver(v);return a&&b.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",f),document.removeEventListener("focusout",w),b.disconnect()}}},[r,a,p.paused]),S.useEffect(()=>{if(a){yR.add(p);const f=document.activeElement;if(!a.contains(f)){const w=new CustomEvent(jS,fR);a.addEventListener(jS,c),a.dispatchEvent(w),w.defaultPrevented||(Xee(ete(gR(a)),{select:!0}),document.activeElement===f&&zs(a))}return()=>{a.removeEventListener(jS,c),setTimeout(()=>{const w=new CustomEvent(RS,fR);a.addEventListener(RS,d),a.dispatchEvent(w),w.defaultPrevented||zs(f??document.body,{select:!0}),a.removeEventListener(RS,d),yR.remove(p)},0)}}},[a,c,d,p]);const g=S.useCallback(f=>{if(!t&&!r||p.paused)return;const w=f.key==="Tab"&&!f.altKey&&!f.ctrlKey&&!f.metaKey,v=document.activeElement;if(w&&v){const b=f.currentTarget,[_,x]=qee(b);_&&x?!f.shiftKey&&v===x?(f.preventDefault(),t&&zs(_,{select:!0})):f.shiftKey&&v===_&&(f.preventDefault(),t&&zs(x,{select:!0})):v===b&&f.preventDefault()}},[t,r,p.paused]);return S.createElement(Re.div,J({tabIndex:-1},s,{ref:h,onKeyDown:g}))});function Xee(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(zs(r,{select:e}),document.activeElement!==t)return}function qee(n){const e=gR(n),t=mR(e,n),r=mR(e.reverse(),n);return[t,r]}function gR(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function mR(n,e){for(const t of n)if(!Jee(t,{upTo:e}))return t}function Jee(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function Zee(n){return n instanceof HTMLInputElement&&"select"in n}function zs(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&Zee(n)&&e&&n.select()}}const yR=Qee();function Qee(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=wR(n,e),n.unshift(e)},remove(e){var t;n=wR(n,e),(t=n[0])===null||t===void 0||t.resume()}}}function wR(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function ete(n){return n.filter(e=>e.tagName!=="A")}const tte=S.forwardRef((n,e)=>{var t;const{container:r=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...i}=n;return r?Ef.createPortal(S.createElement(Re.div,J({},i,{ref:e})),r):null});let OS=0;function LS(){S.useEffect(()=>{var n,e;const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(n=t[0])!==null&&n!==void 0?n:bR()),document.body.insertAdjacentElement("beforeend",(e=t[1])!==null&&e!==void 0?e:bR()),OS++,()=>{OS===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),OS--}},[])}function bR(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",n}var Vi=function(){return Vi=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Vi.apply(this,arguments)};function vR(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function nte(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}var Fm="right-scroll-bar-position",$m="width-before-scroll-bar",rte="with-scroll-bars-hidden",ite="--removed-body-scroll-bar-size";function ote(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function ste(n,e){var t=S.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var i=t.value;i!==r&&(t.value=r,t.callback(r,i))}}}})[0];return t.callback=e,t.facade}function ate(n,e){return ste(e||null,function(t){return n.forEach(function(r){return ote(r,t)})})}function lte(n){return n}function cte(n,e){e===void 0&&(e=lte);var t=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(o){var s=e(o,r);return t.push(s),function(){t=t.filter(function(a){return a!==s})}},assignSyncMedium:function(o){for(r=!0;t.length;){var s=t;t=[],s.forEach(o)}t={push:function(a){return o(a)},filter:function(){return t}}},assignMedium:function(o){r=!0;var s=[];if(t.length){var a=t;t=[],a.forEach(o),s=t}var l=function(){var d=s;s=[],d.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(d){s.push(d),c()},filter:function(d){return s=s.filter(d),t}}}};return i}function dte(n){n===void 0&&(n={});var e=cte(null);return e.options=Vi({async:!0,ssr:!1},n),e}var SR=function(n){var e=n.sideCar,t=vR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return S.createElement(r,Vi({},t))};SR.isSideCarExport=!0;function ute(n,e){return n.useMedium(e),SR}var xR=dte(),zS=function(){},Bm=S.forwardRef(function(n,e){var t=S.useRef(null),r=S.useState({onScrollCapture:zS,onWheelCapture:zS,onTouchMoveCapture:zS}),i=r[0],o=r[1],s=n.forwardProps,a=n.children,l=n.className,c=n.removeScrollBar,d=n.enabled,u=n.shards,h=n.sideCar,p=n.noIsolation,g=n.inert,f=n.allowPinchZoom,w=n.as,v=w===void 0?"div":w,b=vR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),_=h,x=ate([t,e]),E=Vi(Vi({},b),i);return S.createElement(S.Fragment,null,d&&S.createElement(_,{sideCar:xR,removeScrollBar:c,shards:u,noIsolation:p,inert:g,setCallbacks:o,allowPinchZoom:!!f,lockRef:t}),s?S.cloneElement(S.Children.only(a),Vi(Vi({},E),{ref:x})):S.createElement(v,Vi({},E,{className:l,ref:x}),a))});Bm.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Bm.classNames={fullWidth:$m,zeroRight:Fm};var _R,hte=function(){if(_R)return _R;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function pte(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=hte();return e&&n.setAttribute("nonce",e),n}function fte(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function gte(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var mte=function(){var n=0,e=null;return{add:function(t){n==0&&(e=pte())&&(fte(e,t),gte(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},yte=function(){var n=mte();return function(e,t){S.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},kR=function(){var n=yte(),e=function(t){var r=t.styles,i=t.dynamic;return n(r,i),null};return e},wte={left:0,top:0,right:0,gap:0},NS=function(n){return parseInt(n||"",10)||0},bte=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],i=e[n==="padding"?"paddingRight":"marginRight"];return[NS(t),NS(r),NS(i)]},vte=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return wte;var e=bte(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},Ste=kR(),xte=function(n,e,t,r){var i=n.left,o=n.top,s=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(rte,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Fm,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat($m,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Fm," .").concat(Fm,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat($m," .").concat($m,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body {
    `).concat(ite,": ").concat(a,`px;
  }
`)},_te=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,i=r===void 0?"margin":r,o=S.useMemo(function(){return vte(i)},[i]);return S.createElement(Ste,{styles:xte(o,!e,i,t?"":"!important")})},FS=!1;if(typeof window<"u")try{var Um=Object.defineProperty({},"passive",{get:function(){return FS=!0,!0}});window.addEventListener("test",Um,Um),window.removeEventListener("test",Um,Um)}catch{FS=!1}var Pc=FS?{passive:!1}:!1,kte=function(n){return n.tagName==="TEXTAREA"},CR=function(n,e){var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!kte(n)&&t[e]==="visible")},Cte=function(n){return CR(n,"overflowY")},Ete=function(n){return CR(n,"overflowX")},ER=function(n,e){var t=e;do{typeof ShadowRoot<"u"&&t instanceof ShadowRoot&&(t=t.host);var r=PR(n,t);if(r){var i=IR(n,t),o=i[1],s=i[2];if(o>s)return!0}t=t.parentNode}while(t&&t!==document.body);return!1},Pte=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},Ite=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},PR=function(n,e){return n==="v"?Cte(e):Ete(e)},IR=function(n,e){return n==="v"?Pte(e):Ite(e)},Mte=function(n,e){return n==="h"&&e==="rtl"?-1:1},Ate=function(n,e,t,r,i){var o=Mte(n,window.getComputedStyle(e).direction),s=o*r,a=t.target,l=e.contains(a),c=!1,d=s>0,u=0,h=0;do{var p=IR(n,a),g=p[0],f=p[1],w=p[2],v=f-w-o*g;(g||v)&&PR(n,a)&&(u+=v,h+=g),a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(d&&(i&&u===0||!i&&s>u)||!d&&(i&&h===0||!i&&-s>h))&&(c=!0),c},Vm=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},MR=function(n){return[n.deltaX,n.deltaY]},AR=function(n){return n&&"current"in n?n.current:n},Tte=function(n,e){return n[0]===e[0]&&n[1]===e[1]},jte=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},Rte=0,Ic=[];function Dte(n){var e=S.useRef([]),t=S.useRef([0,0]),r=S.useRef(),i=S.useState(Rte++)[0],o=S.useState(function(){return kR()})[0],s=S.useRef(n);S.useEffect(function(){s.current=n},[n]),S.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var f=nte([n.lockRef.current],(n.shards||[]).map(AR),!0).filter(Boolean);return f.forEach(function(w){return w.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),f.forEach(function(w){return w.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var a=S.useCallback(function(f,w){if("touches"in f&&f.touches.length===2)return!s.current.allowPinchZoom;var v=Vm(f),b=t.current,_="deltaX"in f?f.deltaX:b[0]-v[0],x="deltaY"in f?f.deltaY:b[1]-v[1],E,k=f.target,P=Math.abs(_)>Math.abs(x)?"h":"v";if("touches"in f&&P==="h"&&k.type==="range")return!1;var I=ER(P,k);if(!I)return!0;if(I?E=P:(E=P==="v"?"h":"v",I=ER(P,k)),!I)return!1;if(!r.current&&"changedTouches"in f&&(_||x)&&(r.current=E),!E)return!0;var A=r.current||E;return Ate(A,w,f,A==="h"?_:x,!0)},[]),l=S.useCallback(function(f){var w=f;if(!(!Ic.length||Ic[Ic.length-1]!==o)){var v="deltaY"in w?MR(w):Vm(w),b=e.current.filter(function(E){return E.name===w.type&&E.target===w.target&&Tte(E.delta,v)})[0];if(b&&b.should){w.cancelable&&w.preventDefault();return}if(!b){var _=(s.current.shards||[]).map(AR).filter(Boolean).filter(function(E){return E.contains(w.target)}),x=_.length>0?a(w,_[0]):!s.current.noIsolation;x&&w.cancelable&&w.preventDefault()}}},[]),c=S.useCallback(function(f,w,v,b){var _={name:f,delta:w,target:v,should:b};e.current.push(_),setTimeout(function(){e.current=e.current.filter(function(x){return x!==_})},1)},[]),d=S.useCallback(function(f){t.current=Vm(f),r.current=void 0},[]),u=S.useCallback(function(f){c(f.type,MR(f),f.target,a(f,n.lockRef.current))},[]),h=S.useCallback(function(f){c(f.type,Vm(f),f.target,a(f,n.lockRef.current))},[]);S.useEffect(function(){return Ic.push(o),n.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Pc),document.addEventListener("touchmove",l,Pc),document.addEventListener("touchstart",d,Pc),function(){Ic=Ic.filter(function(f){return f!==o}),document.removeEventListener("wheel",l,Pc),document.removeEventListener("touchmove",l,Pc),document.removeEventListener("touchstart",d,Pc)}},[]);var p=n.removeScrollBar,g=n.inert;return S.createElement(S.Fragment,null,g?S.createElement(o,{styles:jte(i)}):null,p?S.createElement(_te,{gapMode:"margin"}):null)}const Ote=ute(xR,Dte);var TR=S.forwardRef(function(n,e){return S.createElement(Bm,Vi({},n,{ref:e,sideCar:Ote}))});TR.classNames=Bm.classNames;const $S=TR;var Lte=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Mc=new WeakMap,Hm=new WeakMap,Wm={},BS=0,jR=function(n){return n&&(n.host||jR(n.parentNode))},zte=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=jR(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},Nte=function(n,e,t,r){var i=zte(e,Array.isArray(n)?n:[n]);Wm[t]||(Wm[t]=new WeakMap);var o=Wm[t],s=[],a=new Set,l=new Set(i),c=function(u){!u||a.has(u)||(a.add(u),c(u.parentNode))};i.forEach(c);var d=function(u){!u||l.has(u)||Array.prototype.forEach.call(u.children,function(h){if(a.has(h))d(h);else{var p=h.getAttribute(r),g=p!==null&&p!=="false",f=(Mc.get(h)||0)+1,w=(o.get(h)||0)+1;Mc.set(h,f),o.set(h,w),s.push(h),f===1&&g&&Hm.set(h,!0),w===1&&h.setAttribute(t,"true"),g||h.setAttribute(r,"true")}})};return d(e),a.clear(),BS++,function(){s.forEach(function(u){var h=Mc.get(u)-1,p=o.get(u)-1;Mc.set(u,h),o.set(u,p),h||(Hm.has(u)||u.removeAttribute(r),Hm.delete(u)),p||u.removeAttribute(t)}),BS--,BS||(Mc=new WeakMap,Mc=new WeakMap,Hm=new WeakMap,Wm={})}},US=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),i=e||Lte(n);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),Nte(r,i,t,"aria-hidden")):function(){return null}};const RR="Dialog",[DR,Hbe]=Bi(RR),[Fte,zo]=DR(RR),$te=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:i,onOpenChange:o,modal:s=!0}=n,a=S.useRef(null),l=S.useRef(null),[c=!1,d]=Ls({prop:r,defaultProp:i,onChange:o});return S.createElement(Fte,{scope:e,triggerRef:a,contentRef:l,contentId:Lo(),titleId:Lo(),descriptionId:Lo(),open:c,onOpenChange:d,onOpenToggle:S.useCallback(()=>d(u=>!u),[d]),modal:s},t)},OR="DialogPortal",[Bte,LR]=DR(OR,{forceMount:void 0}),Ute=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:i}=n,o=zo(OR,e);return S.createElement(Bte,{scope:e,forceMount:t},S.Children.map(r,s=>S.createElement(fi,{present:t||o.open},S.createElement(tte,{asChild:!0,container:i},s))))},VS="DialogOverlay",Vte=S.forwardRef((n,e)=>{const t=LR(VS,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,o=zo(VS,n.__scopeDialog);return o.modal?S.createElement(fi,{present:r||o.open},S.createElement(Hte,J({},i,{ref:e}))):null}),Hte=S.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=zo(VS,t);return S.createElement($S,{as:Da,allowPinchZoom:!0,shards:[i.contentRef]},S.createElement(Re.div,J({"data-state":NR(i.open)},r,{ref:e,style:{pointerEvents:"auto",...r.style}})))}),eh="DialogContent",Wte=S.forwardRef((n,e)=>{const t=LR(eh,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,o=zo(eh,n.__scopeDialog);return S.createElement(fi,{present:r||o.open},o.modal?S.createElement(Kte,J({},i,{ref:e})):S.createElement(Gte,J({},i,{ref:e})))}),Kte=S.forwardRef((n,e)=>{const t=zo(eh,n.__scopeDialog),r=S.useRef(null),i=Je(e,t.contentRef,r);return S.useEffect(()=>{const o=r.current;if(o)return US(o)},[]),S.createElement(zR,J({},n,{ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ne(n.onCloseAutoFocus,o=>{var s;o.preventDefault(),(s=t.triggerRef.current)===null||s===void 0||s.focus()}),onPointerDownOutside:ne(n.onPointerDownOutside,o=>{const s=o.detail.originalEvent,a=s.button===0&&s.ctrlKey===!0;(s.button===2||a)&&o.preventDefault()}),onFocusOutside:ne(n.onFocusOutside,o=>o.preventDefault())}))}),Gte=S.forwardRef((n,e)=>{const t=zo(eh,n.__scopeDialog),r=S.useRef(!1),i=S.useRef(!1);return S.createElement(zR,J({},n,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var s;if((s=n.onCloseAutoFocus)===null||s===void 0||s.call(n,o),!o.defaultPrevented){var a;r.current||(a=t.triggerRef.current)===null||a===void 0||a.focus(),o.preventDefault()}r.current=!1,i.current=!1},onInteractOutside:o=>{var s,a;(s=n.onInteractOutside)===null||s===void 0||s.call(n,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const l=o.target;!((a=t.triggerRef.current)===null||a===void 0)&&a.contains(l)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),zR=S.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...s}=n,a=zo(eh,t),l=S.useRef(null),c=Je(e,l);return LS(),S.createElement(S.Fragment,null,S.createElement(DS,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},S.createElement(Kee,J({role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":NR(a.open)},s,{ref:c,onDismiss:()=>a.onOpenChange(!1)}))),!1)}),Yte="DialogTitle",Xte=S.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=zo(Yte,t);return S.createElement(Re.h2,J({id:i.titleId},r,{ref:e}))}),qte="DialogClose",Jte=S.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=zo(qte,t);return S.createElement(Re.button,J({type:"button"},r,{ref:e,onClick:ne(n.onClick,()=>i.onOpenChange(!1))}))});function NR(n){return n?"open":"closed"}const Zte=$te,Qte=Ute,ene=Vte,tne=Wte;function Km({className:n,children:e}){return m.jsx("div",{className:ye("tlui-dialog__header",n),children:e})}function Gm({className:n,children:e}){return m.jsx(Xte,{dir:"ltr",className:ye("tlui-dialog__header__title",n),children:e})}function Ym(){return m.jsx("div",{className:"tlui-dialog__header__close",children:m.jsx(Jte,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:m.jsx(le,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:m.jsx(xr,{small:!0,icon:"cross-2"})})})})}function th({className:n,children:e,style:t}){return m.jsx("div",{className:ye("tlui-dialog__body",n),style:t,children:e})}function HS({className:n,children:e}){return m.jsx("div",{className:ye("tlui-dialog__footer",n),children:e})}const WS=S.forwardRef(function({className:n,label:e,icon:t,iconLeft:r,autoselect:i=!1,autofocus:o=!1,defaultValue:s,placeholder:a,onComplete:l,onValueChange:c,onCancel:d,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:h=!1,children:p,value:g},f){const w=G(),v=S.useRef(null);S.useImperativeHandle(f,()=>v.current);const b=Ae(),_=S.useRef(s??""),x=S.useRef(s??""),[E,k]=S.useState(!1),P=S.useCallback(O=>{k(!0);const F=O.currentTarget;x.current=F.value,requestAnimationFrame(()=>{i&&F.select()})},[i]),I=S.useCallback(O=>{const F=O.currentTarget.value;x.current=F,c==null||c(F)},[c]),A=S.useCallback(O=>{switch(O.key){case"Enter":{O.currentTarget.blur(),Wt(O),l==null||l(O.currentTarget.value);break}case"Escape":{O.currentTarget.value=_.current,O.currentTarget.blur(),Wt(O),d==null||d(O.currentTarget.value);break}}},[l,d]),T=S.useCallback(O=>{k(!1);const F=O.currentTarget.value;u==null||u(F)},[u]);return S.useEffect(()=>{if(!w.environment.isIos)return;const O=window.visualViewport;if(E&&h&&O){const F=()=>{var H;(H=v.current)==null||H.scrollIntoView({block:"center"})};return O.addEventListener("resize",F),O.addEventListener("scroll",F),requestAnimationFrame(()=>{var H;(H=v.current)==null||H.scrollIntoView({block:"center"})}),()=>{O.removeEventListener("resize",F),O.removeEventListener("scroll",F)}}},[w,E,h]),m.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[p,e&&m.jsx("label",{children:b(e)}),r&&m.jsx(xr,{icon:r,className:"tlui-icon-left",small:!0}),m.jsx("input",{ref:v,className:ye("tlui-input",n),type:"text",defaultValue:s,onKeyUp:A,onChange:I,onFocus:P,onBlur:T,autoFocus:o,placeholder:a,value:g}),t&&m.jsx(xr,{icon:t,small:!!e})]})});function FR(n){return gr.isValid(n)?{isValid:!0,hasProtocol:!0}:gr.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const nne=$e(function({onClose:n}){const e=G().getOnlySelectedShape();return e&&"url"in e.props&&typeof e.props.url=="string"?m.jsx(rne,{onClose:n,selectedShape:e}):null}),rne=$e(function({onClose:n,selectedShape:e}){const t=G(),r=Ae(),i=S.useRef(null);S.useEffect(()=>{requestAnimationFrame(()=>{var p;return(p=i.current)==null?void 0:p.focus()})},[]);const o=S.useRef(e.props.url),[s,a]=S.useState(()=>{const p=FR(e.props.url),g=p.isValid===!0?p.hasProtocol?e.props.url:"https://"+e.props.url:"https://";return{actual:g,safe:g,valid:!0}}),l=S.useCallback(p=>{const g=p.replace(/https?:\/\/(https?:\/\/)/,(v,b)=>b),f=FR(g),w=f.isValid===!0?f.hasProtocol?g:"https://"+g:"https://";a({actual:g,safe:w,valid:f.isValid})},[]),c=S.useCallback(()=>{const p=t.getOnlySelectedShape();p&&(t.updateShapes([{id:p.id,type:p.type,props:{url:""}}]),n())},[t,n]),d=S.useCallback(()=>{const p=t.getOnlySelectedShape();p&&(p&&"url"in p.props&&p.props.url!==s.safe&&t.updateShapes([{id:p.id,type:p.type,props:{url:s.safe}}]),n())},[t,n,s]),u=S.useCallback(()=>{n()},[n]);if(!e)return n(),null;const h=o.current&&!s.valid;return m.jsxs(m.Fragment,{children:[m.jsxs(Km,{children:[m.jsx(Gm,{children:r("edit-link-dialog.title")}),m.jsx(Ym,{})]}),m.jsx(th,{children:m.jsxs("div",{className:"tlui-edit-link-dialog",children:[m.jsx(WS,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:s.actual,onValueChange:l,onComplete:d,onCancel:u}),m.jsx("div",{children:s.valid?r("edit-link-dialog.detail"):r("edit-link-dialog.invalid-url")})]})}),m.jsxs(HS,{className:"tlui-dialog__footer__actions",children:[m.jsx(le,{type:"normal",onClick:u,onTouchEnd:u,children:r("edit-link-dialog.cancel")}),h?m.jsx(le,{type:"danger",onTouchEnd:c,onClick:c,children:r("edit-link-dialog.clear")}):m.jsx(le,{type:"primary",disabled:!s.valid,onTouchEnd:d,onClick:d,children:r("edit-link-dialog.save")})]})]})}),$R=$e(function({onClose:n}){const e=G(),t=Ae(),r=MS(),[i,o]=S.useState(null),[s,a]=S.useState(""),[l,c]=S.useState(null),[d,u]=S.useState(!1),h=S.useRef(-1);return m.jsxs(m.Fragment,{children:[m.jsxs(Km,{children:[m.jsx(Gm,{children:i?`${t("embed-dialog.title")} \u2014 ${i.title}`:t("embed-dialog.title")}),m.jsx(Ym,{})]}),i?m.jsxs(m.Fragment,{children:[m.jsxs(th,{className:"tlui-embed-dialog__enter",children:[m.jsx(WS,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:p=>{a(p);const g=Do(p);c(g&&g.definition.type===i.type?g:null),u(!1),clearTimeout(h.current),h.current=setTimeout(()=>u(!g),320)}}),s===""?m.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[m.jsx("span",{children:t("embed-dialog.instruction")})," ",i.instructionLink&&m.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",m.jsx(xr,{icon:"external-link",small:!0})]})]}):m.jsx("div",{className:"tlui-embed-dialog__warning",children:d?t("embed-dialog.invalid-url"):"\xA0"})]}),m.jsxs(HS,{className:"tlui-dialog__footer__actions",children:[m.jsx(le,{type:"normal",onClick:()=>{o(null),c(null),a("")},label:"embed-dialog.back"}),m.jsx("div",{className:"tlui-embed__spacer"}),m.jsx(le,{type:"normal",label:"embed-dialog.cancel",onClick:n}),m.jsx(le,{type:"primary",disabled:!l,label:"embed-dialog.create",onClick:()=>{l&&(e.putExternalContent({type:"embed",url:s,point:e.getViewportPageCenter(),embed:l.definition}),n())}})]})]}):m.jsx(m.Fragment,{children:m.jsx(th,{className:"tlui-embed-dialog__list",children:Wl.map(p=>m.jsx(le,{type:"menu",onClick:()=>o(p),label:p.title,children:m.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${r.embedIcons[p.type]})`}})},p.type))})})]})});var KS={exports:{}};KS.exports,function(n){var e=function(){var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function s(l,c){if(!o[l]){o[l]={};for(var d=0;d<l.length;d++)o[l][l.charAt(d)]=d}return o[l][c]}var a={compressToBase64:function(l){if(l==null)return"";var c=a._compress(l,6,function(d){return r.charAt(d)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(c){return s(r,l.charAt(c))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(c){return t(c+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(c){return l.charCodeAt(c)-32})},compressToUint8Array:function(l){for(var c=a.compress(l),d=new Uint8Array(c.length*2),u=0,h=c.length;u<h;u++){var p=c.charCodeAt(u);d[u*2]=p>>>8,d[u*2+1]=p%256}return d},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var c=new Array(l.length/2),d=0,u=c.length;d<u;d++)c[d]=l[d*2]*256+l[d*2+1];var h=[];return c.forEach(function(p){h.push(t(p))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(c){return s(i,l.charAt(c))}))},compress:function(l){return a._compress(l,16,function(c){return t(c)})},_compress:function(l,c,d){if(l==null)return"";var u,h,p={},g={},f="",w="",v="",b=2,_=3,x=2,E=[],k=0,P=0,I;for(I=0;I<l.length;I+=1)if(f=l.charAt(I),Object.prototype.hasOwnProperty.call(p,f)||(p[f]=_++,g[f]=!0),w=v+f,Object.prototype.hasOwnProperty.call(p,w))v=w;else{if(Object.prototype.hasOwnProperty.call(g,v)){if(v.charCodeAt(0)<256){for(u=0;u<x;u++)k=k<<1,P==c-1?(P=0,E.push(d(k)),k=0):P++;for(h=v.charCodeAt(0),u=0;u<8;u++)k=k<<1|h&1,P==c-1?(P=0,E.push(d(k)),k=0):P++,h=h>>1}else{for(h=1,u=0;u<x;u++)k=k<<1|h,P==c-1?(P=0,E.push(d(k)),k=0):P++,h=0;for(h=v.charCodeAt(0),u=0;u<16;u++)k=k<<1|h&1,P==c-1?(P=0,E.push(d(k)),k=0):P++,h=h>>1}b--,b==0&&(b=Math.pow(2,x),x++),delete g[v]}else for(h=p[v],u=0;u<x;u++)k=k<<1|h&1,P==c-1?(P=0,E.push(d(k)),k=0):P++,h=h>>1;b--,b==0&&(b=Math.pow(2,x),x++),p[w]=_++,v=String(f)}if(v!==""){if(Object.prototype.hasOwnProperty.call(g,v)){if(v.charCodeAt(0)<256){for(u=0;u<x;u++)k=k<<1,P==c-1?(P=0,E.push(d(k)),k=0):P++;for(h=v.charCodeAt(0),u=0;u<8;u++)k=k<<1|h&1,P==c-1?(P=0,E.push(d(k)),k=0):P++,h=h>>1}else{for(h=1,u=0;u<x;u++)k=k<<1|h,P==c-1?(P=0,E.push(d(k)),k=0):P++,h=0;for(h=v.charCodeAt(0),u=0;u<16;u++)k=k<<1|h&1,P==c-1?(P=0,E.push(d(k)),k=0):P++,h=h>>1}b--,b==0&&(b=Math.pow(2,x),x++),delete g[v]}else for(h=p[v],u=0;u<x;u++)k=k<<1|h&1,P==c-1?(P=0,E.push(d(k)),k=0):P++,h=h>>1;b--,b==0&&(b=Math.pow(2,x),x++)}for(h=2,u=0;u<x;u++)k=k<<1|h&1,P==c-1?(P=0,E.push(d(k)),k=0):P++,h=h>>1;for(;;)if(k=k<<1,P==c-1){E.push(d(k));break}else P++;return E.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(c){return l.charCodeAt(c)})},_decompress:function(l,c,d){var u=[],h=4,p=4,g=3,f="",w=[],v,b,_,x,E,k,P,I={val:d(0),position:c,index:1};for(v=0;v<3;v+=1)u[v]=v;for(_=0,E=Math.pow(2,2),k=1;k!=E;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*k,k<<=1;switch(_){case 0:for(_=0,E=Math.pow(2,8),k=1;k!=E;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*k,k<<=1;P=t(_);break;case 1:for(_=0,E=Math.pow(2,16),k=1;k!=E;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*k,k<<=1;P=t(_);break;case 2:return""}for(u[3]=P,b=P,w.push(P);;){if(I.index>l)return"";for(_=0,E=Math.pow(2,g),k=1;k!=E;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*k,k<<=1;switch(P=_){case 0:for(_=0,E=Math.pow(2,8),k=1;k!=E;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*k,k<<=1;u[p++]=t(_),P=p-1,h--;break;case 1:for(_=0,E=Math.pow(2,16),k=1;k!=E;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*k,k<<=1;u[p++]=t(_),P=p-1,h--;break;case 2:return w.join("")}if(h==0&&(h=Math.pow(2,g),g++),u[P])f=u[P];else if(P===p)f=b+b.charAt(0);else return null;w.push(f),u[p++]=b+f.charAt(0),h--,b=f,h==0&&(h=Math.pow(2,g),g++)}}};return a}();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(KS);var BR=KS.exports;async function ine(n,e,t){var v,b,_;const{elements:r,files:i}=e,o={shapes:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},s=new Map,a=new Map,l=n.getCurrentPageId(),c=new Map,d=[],u=new Set;r.forEach(x=>{if(c.set(x.id,ot()),x.boundElements!==null)for(const E of x.boundElements)E.type==="text"&&u.add(E.id)});let h="a1";for(const x of r){if(u.has(x.id))continue;const E=c.get(x.id),k={id:E,typeName:"shape",parentId:l,index:h,x:x.x,y:x.y,rotation:0,isLocked:x.locked,opacity:one(x.opacity),meta:{}};switch(x.angle!==0&&a.set(E,x.angle),x.groupIds&&x.groupIds.length>0?s.has(x.groupIds[0])?(v=s.get(x.groupIds[0]))==null||v.push(E):s.set(x.groupIds[0],[E]):d.push(E),x.type){case"rectangle":case"ellipse":case"diamond":{let P="",I="middle";if(x.boundElements!==null){for(const T of x.boundElements)if(T.type==="text"){const O=r.find(F=>F.id===T.id);O&&(P=O.text,I=UR[O.textAlign])}}const A=x.backgroundColor==="transparent"?x.strokeColor:x.backgroundColor;o.shapes.push({...k,type:"geo",props:{geo:x.type,url:x.link??"",w:x.width,h:x.height,size:Xm[x.strokeWidth]??"draw",color:nh[A]??"black",text:P,align:I,dash:qm(x),fill:hne(x)}});break}case"freedraw":{o.shapes.push({...k,type:"draw",props:{dash:qm(x),size:Xm[x.strokeWidth],color:nh[x.strokeColor]??"black",segments:[{type:"free",points:x.points.map(([P,I,A=.5])=>({x:P,y:I,z:A}))}]}});break}case"line":{const P=x.points[0],I=x.points[x.points.length-1],A=UM(x.points.length);o.shapes.push({...k,type:"line",props:{dash:qm(x),size:Xm[x.strokeWidth],color:nh[x.strokeColor]??"black",spline:x.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:A[0],x:P[0],y:P[1]},end:{id:"end",type:"vertex",index:A[A.length-1],x:I[0],y:I[1]},...Object.fromEntries(x.points.slice(1,-1).map(([T,O],F)=>{const H=et();return[H,{id:H,type:"vertex",index:A[F+1],x:T,y:O}]}))}}});break}case"arrow":{let P="";if(x.boundElements!==null){for(const F of x.boundElements)if(F.type==="text"){const H=r.find(D=>D.id===F.id);H&&(P=H.text)}}const I=x.points[0],A=x.points[x.points.length-1],T=c.get((b=x.startBinding)==null?void 0:b.elementId),O=c.get((_=x.endBinding)==null?void 0:_.elementId);o.shapes.push({...k,type:"arrow",props:{text:P,bend:une(x,I,A),dash:qm(x),size:Xm[x.strokeWidth]??"m",color:nh[x.strokeColor]??"black",start:T?{type:"binding",boundShapeId:T,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:I[0],y:I[1]},end:O?{type:"binding",boundShapeId:O,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:A[0],y:A[1]},arrowheadEnd:VR[x.endArrowhead]??"none",arrowheadStart:VR[x.startArrowhead]??"none"}});break}case"text":{const{size:P,scale:I}=ane(x.fontSize);o.shapes.push({...k,type:"text",props:{size:P,scale:I,font:lne[x.fontFamily]??"draw",color:nh[x.strokeColor]??"black",text:x.text,align:UR[x.textAlign]}});break}case"image":{const P=i[x.fileId];if(!P)break;const I=Sa.createId();o.assets.push({id:I,typeName:"asset",type:"image",props:{w:x.width,h:x.height,name:x.id??"Untitled",isAnimated:!1,mimeType:P.mimeType,src:P.dataURL},meta:{}}),o.shapes.push({...k,type:"image",props:{w:x.width,h:x.height,assetId:I}})}}h=Io(h)}const p=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.mark("paste"),n.putContentOntoCurrentPage(o,{point:p,select:!1,preserveIds:!0});for(const x of s.values())if(x.length>1){n.groupShapes(x);const E=n.getShape(x[0]);E!=null&&E.parentId&&Nr(E.parentId)&&d.push(E.parentId)}for(const[x,E]of a)n.select(x),n.rotateShapesBy([x],E);const g=me(d.map(x=>n.getShape(x))),f=de.Common(g.map(x=>n.getShapePageBounds(x))),w=n.getViewportPageBounds().center;n.updateShapes(g.map(x=>{const E={x:(x.x??0)-(f.x+f.w/2),y:(x.y??0)-(f.y+f.h/2)};return{id:x.id,type:x.type,x:w.x+E.x,y:w.y+E.y}})),n.setSelectedShapes(d)}const one=n=>{const e=n/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},Xm={1:"s",2:"m",3:"l",4:"xl"},sne={16:"s",20:"m",28:"l",36:"xl"};function ane(n){const e=sne[n];return e?{size:e,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const lne={1:"draw",2:"sans",3:"mono"},nh={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},cne={solid:"draw",dashed:"dashed",dotted:"dotted"},dne={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},UR={left:"start",center:"middle",right:"end"},VR={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function une(n,e,t){let r=0;if(n.points.length>2){const i=new C(e[0],e[1]),o=new C(t[0],t[1]),s=new C(n.points[1][0],n.points[1][1]),a=C.Sub(o,i),l=C.Per(a),c=C.Med(o,i),d=C.Sub(c,l),u=C.Add(c,l),h=C.NearestPointOnLineSegment(d,u,s,!1);r=C.Dist(h,c),C.Clockwise(h,o,c)&&(r*=-1)}return r}const qm=n=>{let e=cne[n.strokeStyle]??"draw";return e==="draw"&&n.roughness===0&&(e="solid"),e},hne=n=>n.backgroundColor==="transparent"?"none":dne[n.fillStyle]??"solid";async function HR(n,e,t,r){const i=(await Promise.all(e.map(async o=>await(await fetch(o)).blob()))).map(o=>new File([o],"tldrawFile",{type:o.type}));n.mark("paste"),await n.putExternalContent({type:"files",files:i,point:t,ignoreParent:!1,sources:r}),e.forEach(o=>URL.revokeObjectURL(o))}function pne(n,e,t){const r=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.mark("paste"),n.putContentOntoCurrentPage(e,{point:r,select:!0})}async function GS(n,e,t,r){var i;try{if(new URL(e).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)&&((i=(await fetch(e,{method:"HEAD"})).headers.get("content-type"))!=null&&i.match(/^image\//))){n.mark("paste"),HR(n,[e]);return}}catch(o){o.message!=="Failed to fetch"&&console.error(o)}return n.mark("paste"),await n.putExternalContent({type:"url",point:t,url:e,sources:r})}const WR=()=>{},KR=S.createContext({});function fne({onEvent:n,children:e}){return m.jsx(KR.Provider,{value:n??WR,children:e})}function Ac(){return S.useContext(KR)??WR}function gne(n){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n.trim(),e.body.textContent||e.body.innerText||""}const mne=n=>{try{const e=new URL(n);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},yne=n=>{const e=n.split(/[\n\s]/);for(const t of e)try{const r=new URL(t);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return hM(e)},wne=n=>/^<svg/.test(n),bne=["input","select","textarea"];function Jm(n){const{activeElement:e}=document;return n.getIsMenuOpen()||e&&(e.getAttribute("contenteditable")||bne.indexOf(e.tagName.toLowerCase())>-1)}async function YS(n){return new Promise((e,t)=>{const r=new FileReader;r.addEventListener("loadend",()=>{const i=r.result;e(i)}),r.addEventListener("error",()=>{t(r.error)}),r.readAsText(n)})}const vne=n=>n.types.find(e=>e.match(/^image\//)),XS=(n,e,t,r)=>{const i=yne(e);if(i)for(const o of i)GS(n,o,t);else mne(e)?GS(n,e,t):wne(e)?(n.mark("paste"),n.putExternalContent({type:"svg-text",text:e,point:t,sources:r})):(n.mark("paste"),n.putExternalContent({type:"text",text:e,point:t,sources:r}))},Sne=async(n,e,t)=>{if(n.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{r.push({type:"file",source:new Promise(o=>o(i.getAsFile()))});break}case"string":{i.type==="text/html"?r.push({type:"html",source:new Promise(o=>i.getAsString(o))}):i.type==="text/plain"?r.push({type:"text",source:new Promise(o=>i.getAsString(o))}):r.push({type:i.type,source:new Promise(o=>i.getAsString(o))});break}}YR(n,r,t)},GR=async(n,e,t)=>{const r=[];for(const i of e){if(vne(i))for(const o of i.types)o.match(/^image\//)&&r.push({type:"blob",source:i.getType(o)});i.types.includes("text/html")&&r.push({type:"html",source:new Promise(o=>i.getType("text/html").then(s=>YS(s).then(o)))}),i.types.includes("text/uri-list")&&r.push({type:"url",source:new Promise(o=>i.getType("text/uri-list").then(s=>YS(s).then(o)))}),i.types.includes("text/plain")&&r.push({type:"text",source:new Promise(o=>i.getType("text/plain").then(s=>YS(s).then(o)))})}return await YR(n,r,t)};async function YR(n,e,t){const r=e.filter(o=>(o.type==="file"||o.type==="blob")&&o.source!==null);if(r.length){const o=(await Promise.all(r.map(s=>s.source))).filter(Boolean).map(s=>URL.createObjectURL(s));return await HR(n,o,t)}const i=await Promise.all(e.filter(o=>o.type!=="file").map(o=>new Promise(s=>{const a=o;if(a.type==="file"){s({type:"error",data:null,reason:"unexpected file"});return}a.source.then(l=>{var d;const c=(d=l.match(/<tldraw[^>]*>(.*)<\/tldraw>/))==null?void 0:d[1];if(c)try{const u=BR.decompressFromBase64(c);if(u===null){s({type:"error",data:u,reason:"found tldraw data comment but could not parse base64"});return}else{const h=JSON.parse(u);if(h.type!=="application/tldraw"&&s({type:"error",data:h,reason:`found tldraw data comment but JSON was of a different type: ${h.type}`}),typeof h.data=="string"){s({type:"error",data:h,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}s({type:"tldraw",data:h.data});return}}catch{s({type:"error",data:c,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){s({type:"text",data:l,subtype:"html"});return}if(a.type==="url"){s({type:"text",data:l,subtype:"url"});return}try{const u=JSON.parse(l);if(u.type==="excalidraw/clipboard"){s({type:"excalidraw",data:u});return}else{s({type:"text",data:l,subtype:"json"});return}}catch{s({type:"text",data:l,subtype:"text"});return}}s({type:"error",data:l,reason:"unhandled case"})})})));for(const o of i)if(o.type==="tldraw"){pne(n,o.data,t);return}for(const o of i)if(o.type==="excalidraw"){ine(n,o.data,t);return}for(const o of i)if(o.type==="text"&&o.subtype==="html"){const s=new DOMParser().parseFromString(o.data,"text/html").querySelector("body");if(s&&Array.from(s.children).filter(a=>a.nodeType===1).length===1&&s.firstElementChild&&s.firstElementChild.tagName==="A"&&s.firstElementChild.hasAttribute("href")&&s.firstElementChild.getAttribute("href")!==""){const a=s.firstElementChild.getAttribute("href");XS(n,a,t,i);return}if(!i.some(a=>a.type==="text"&&a.subtype!=="html")&&o.data.trim()){XS(n,gne(o.data),t,i);return}}for(const o of i)if(o.type==="text"&&o.subtype==="url"){GS(n,o.data,t,i);return}for(const o of i)if(o.type==="text"&&o.subtype==="text"&&o.data.trim()){XS(n,o.data,t,i);return}}const Zm=n=>{var r;const e=n.getContentFromCurrentPage(n.getSelectedShapeIds());if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const t=BR.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const i=e.shapes.map(o=>n.isShapeOfType(o,"text")||n.isShapeOfType(o,"geo")||n.isShapeOfType(o,"arrow")?o.props.text:n.isShapeOfType(o,"bookmark")||n.isShapeOfType(o,"embed")?o.props.url:null).filter(d6);if((r=navigator.clipboard)!=null&&r.write){const o=new Blob([`<tldraw>${t}</tldraw>`],{type:"text/html"});let s=i.join(" ");s===""&&(s=" "),navigator.clipboard.write([new ClipboardItem({"text/html":o,"text/plain":new Blob([s],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${t}</tldraw>`)}};function xne(){const n=G(),e=Ac(),t=S.useCallback(function(o){n.getSelectedShapeIds().length!==0&&(Zm(n),e("copy",{source:o}))},[n,e]),r=S.useCallback(function(o){n.getSelectedShapeIds().length!==0&&(Zm(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:o}))},[n,e]),i=S.useCallback(async function(o,s,a){n.getEditingShapeId()!==null||Jm(n)||(Array.isArray(o)&&o[0]instanceof ClipboardItem?(GR(n,o,a),e("paste",{source:"menu"})):navigator.clipboard.read().then(l=>{i(l,s,a)}))},[n,e]);return{copy:t,cut:r,paste:i}}function _ne(){const n=G(),e=Ac(),t=q("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);S.useEffect(()=>{if(!t)return;const r=()=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Jm(n)||(Zm(n),e("copy",{source:"kbd"}))};function i(){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Jm(n)||(Zm(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let o=!1;const s=l=>{l.button===1&&(o=!0,requestAnimationFrame(()=>{o=!1}))},a=l=>{if(o){l.stopPropagation();return}n.getEditingShapeId()!==null||Jm(n)||(l.clipboardData&&!n.inputs.shiftKey?Sne(n,l.clipboardData):navigator.clipboard.read().then(c=>{Array.isArray(c)&&c[0]instanceof ClipboardItem&&GR(n,c,n.inputs.currentPagePoint)}),e("paste",{source:"kbd"}))};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}},[n,e,t])}async function kne(n,e,t){const{type:r,quality:i,scale:o}=t,s=+n.getAttribute("width"),a=+n.getAttribute("height");let l=s*o,c=a*o;const d=await XR(n),u=URL.createObjectURL(new Blob([d],{type:"image/svg+xml"})),h=await w3();if(s>h.maxWidth&&(l=h.maxWidth,c=l/s*a),a>h.maxHeight&&(c=h.maxHeight,l=c/a*s),l*c>h.maxArea){const v=Math.sqrt(h.maxArea/(l*c));l*=v,c*=v}l=Math.floor(l),c=Math.floor(c);const p=l/s,g=await new Promise(v=>{const b=new Image;b.crossOrigin="anonymous",b.onload=async()=>{e&&await new Promise(E=>setTimeout(E,250));const _=document.createElement("canvas"),x=_.getContext("2d");_.width=l,_.height=c,x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(b,0,0,l,c),URL.revokeObjectURL(u),v(_)},b.onerror=()=>{v(null)},b.src=u});if(!g)return null;const f=await new Promise(v=>g.toBlob(b=>{(!b||st.throwToBlob.get())&&v(null),v(b)},"image/"+r,i));if(!f)return null;const w=new DataView(await f.arrayBuffer());return Ti.setPhysChunk(w,p,{type:"image/"+r})}async function XR(n){const e=n.cloneNode(!0);n.setAttribute("width",+n.getAttribute("width")+""),n.setAttribute("height",+n.getAttribute("height")+"");const t=new FileReader,r=Array.from(e.querySelectorAll("image"));for(const i of r){const o=i.getAttribute("xlink:href");if(o&&!o.startsWith("data:")){const s=await(await fetch(o)).blob(),a=await new Promise((l,c)=>{t.onload=()=>l(t.result),t.onerror=()=>c(t.error),t.readAsDataURL(s)});i.setAttribute("xlink:href",a)}}return new XMLSerializer().serializeToString(e).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}async function qR(n,e,t){const r=await n.getSvg(e!=null&&e.length?e:[...n.getCurrentPageShapeIds()],{scale:1,background:n.getInstanceState().exportBackground,...t});if(!r)throw new Error("Could not construct SVG.");return r}async function qS(n,e,t,r={}){switch(t){case"svg":return XR(await qR(n,e,r));case"json":{const i=n.getContentFromCurrentPage(e);return JSON.stringify(i)}default:Nl(t)}}async function JR(n,e,t,r={}){switch(t){case"svg":return new Blob([await qS(n,e,"svg",r)],{type:"text/plain"});case"json":return new Blob([await qS(n,e,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const i=await kne(await qR(n,e,r),n.environment.isSafari,{type:t,quality:1,scale:2});if(!i)throw new Error("Could not construct image.");return i}default:Nl(t)}}const Cne={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function Ene(n,e,t,r={}){return{blobPromise:JR(n,e,t,r),mimeType:Cne[t]}}function Pne(n,e,t="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:i,mimeType:o}=Ene(n,e,t,r);return window.navigator.clipboard.write([new ClipboardItem({[o]:i})]).catch(s=>(console.error(s),i.then(a=>window.navigator.clipboard.write([new ClipboardItem({[o]:a})]))))}switch(t){case"json":case"svg":return Ine(async()=>qS(n,e,t,r));case"jpeg":case"png":throw new Error("Copy not supported");default:Nl(t)}}async function Ine(n){var e,t;await((t=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:t.call(e,await n()))}const ZR=S.createContext({});function Mne({children:n}){const[e,t]=S.useState([]),r=S.useCallback(s=>{const a=s.id??et();return t(l=>[...l.filter(c=>c.id!==s.id),{...s,id:a}]),a},[]),i=S.useCallback(s=>(t(a=>a.filter(l=>l.id!==s)),s),[]),o=S.useCallback(()=>{t(()=>[])},[]);return m.jsx(ZR.Provider,{value:{toasts:e,addToast:r,removeToast:i,clearToasts:o},children:n})}function Hi(){const n=S.useContext(ZR);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}function Ane(){const n=G(),{addToast:e}=Hi(),t=Ae();return S.useCallback((r,i="svg")=>{Pne(n,r,i).catch(()=>{e({id:"copy-fail",icon:"warning-triangle",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[n,e,t])}const QR=S.createContext({});function Tne({children:n}){const e=G(),t=Ac(),[r,i]=S.useState([]),o=S.useCallback(c=>{const d=c.id??et();return i(u=>[...u.filter(h=>h.id!==c.id),{...c,id:d}]),t("open-menu",{source:"dialog",id:d}),e.addOpenMenu(d),d},[e,t]),s=S.useCallback((c,d)=>(i(u=>u.map(h=>h.id===c?{...h,...d}:h)),t("open-menu",{source:"dialog",id:c}),e.addOpenMenu(c),c),[e,t]),a=S.useCallback(c=>(i(d=>d.filter(u=>{var h;return u.id===c?((h=u.onClose)==null||h.call(u),!1):!0})),t("close-menu",{source:"dialog",id:c}),e.deleteOpenMenu(c),c),[e,t]),l=S.useCallback(()=>{i(c=>(c.forEach(d=>{var u;(u=d.onClose)==null||u.call(d),t("close-menu",{source:"dialog",id:d.id}),e.deleteOpenMenu(d.id)}),[]))},[e,t]);return m.jsx(QR.Provider,{value:{dialogs:r,addDialog:o,removeDialog:a,clearDialogs:l,updateDialog:s},children:n})}function za(){const n=S.useContext(QR);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}async function jne(n,e,t="png",r={}){let i=`shapes at ${eD()}`;if(e.length===1){const a=n.getShape(e[0]);n.isShapeOfType(a,"frame")?i=a.props.name??"frame":i=`${a.id.replace(/:/,"_")} at ${eD()}`}i+=`.${t}`;const o=await JR(n,e,t,r),s=new File([o],i,{type:o.type});Rne(s)}function eD(){const n=new Date,e=String(n.getFullYear()).slice(2),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),i=String(n.getHours()).padStart(2,"0"),o=String(n.getMinutes()).padStart(2,"0"),s=String(n.getSeconds()).padStart(2,"0");return`${e}-${t}-${r} ${i}.${o}.${s}`}function Rne(n){const e=document.createElement("a"),t=URL.createObjectURL(n);e.href=t,e.download=n.name,e.click(),URL.revokeObjectURL(t)}function Dne(){const n=G(),{addToast:e}=Hi(),t=Ae();return S.useCallback((r,i="png")=>{jne(n,r,i,{scale:1,background:n.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc")})})},[n,e,t])}function tD(){const n=G(),e=S.useRef();return S.useEffect(()=>{const t=window.document.createElement("input");t.type="file",t.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",t.multiple=!0,e.current=t;async function r(i){const o=i.target.files;!o||o.length===0||(await n.putExternalContent({type:"files",files:Array.from(o),point:n.getViewportPageBounds().center,ignoreParent:!1}),t.value="")}return t.addEventListener("change",r),()=>{e.current=void 0,t.removeEventListener("change",r)}},[n]),S.useCallback(()=>{var t;(t=e.current)==null||t.click()},[e])}function One(){const n=G(),e=S.useRef(null),t=S.useRef(null);return S.useCallback(async function(){const r=document.createElement("div"),i=document.createElement("style"),o=(f,w)=>{f&&(f.innerHTML=""),w&&document.head.contains(w)&&document.head.removeChild(w),f&&document.body.contains(f)&&document.body.removeChild(f)};o(e.current,t.current),e.current=r,t.current=i;const s=`tl-print-surface-${et()}`;r.className=s,i.innerHTML=`
			.${s} {
				display: none;
			}

			.${s} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${s} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${s}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${s}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${s}__item__header {
					display: none;
				}

				.${s}__item__footer {
					display: none;
					text-align: right;
				}

				.${s}__item__footer__hide {
					display: none;
				}

				
			}

		`;const a=()=>{document.head.appendChild(i),document.body.appendChild(r)},l=()=>{n.once("change-history",()=>{o(r,i)})};window.addEventListener("beforeprint",a),window.addEventListener("afterprint",l);function c(f,w,v){try{r.innerHTML+=`<div class="${s}__item">
        <div class="${s}__item__header">
          ${f.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${s}__item__main">
          ${v.outerHTML}
        </div>
        <div class="${s}__item__footer ${s}__item__footer__${w?"":"hide"}">
          ${w??""}
        </div>
      </div>`}catch(b){console.error(b)}}function d(){n.environment.isChromeForIos?(a(),window.print()):n.environment.isSafari?(a(),document.execCommand("print",!1)):window.print()}const u=n.getSelectedShapeIds(),h=n.getCurrentPageId(),p=n.getPages(),g={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const f=await n.getSvg(u,g);if(f){const w=p.find(v=>v.id===h);c(`tldraw \u2014 ${w==null?void 0:w.name}`,null,f),d()}}else{const f=n.getCurrentPage(),w=await n.getSvg(n.getSortedChildIdsForParent(f.id),g);w&&(c(`tldraw \u2014 ${f.name}`,null,w),d())}window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",l)},[n])}const nD=S.createContext({});function Lne(n){return Object.fromEntries(n.map(e=>[e.id,e]))}function zne({overrides:n,children:e}){const t=G(),{addDialog:r,clearDialogs:i}=za(),{clearToasts:o}=Hi(),s=tD(),a=One(),{cut:l,copy:c,paste:d}=xne(),u=Ane(),h=Dne(),p=Ac(),g=S.useMemo(()=>{function f(){return t.isIn("select")||(t.complete(),t.setCurrentTool("select")),!1}function w(){return t.getSelectedShapeIds().length>0}const v=Lne([{id:"edit-link",label:"action.edit-link",icon:"link",readonlyOk:!1,onSelect(b){w()&&(f()||(p("edit-link",{source:b}),t.mark("edit-link"),r({component:nne})))}},{id:"insert-embed",label:"action.insert-embed",readonlyOk:!1,kbd:"$i",onSelect(b){p("insert-embed",{source:b}),r({component:$R})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",readonlyOk:!1,onSelect(b){p("insert-media",{source:b}),s()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",readonlyOk:!1,onSelect(b){p("undo",{source:b}),t.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",readonlyOk:!1,onSelect(b){p("redo",{source:b}),t.redo()}},{id:"export-as-svg",label:"action.export-as-svg",menuLabel:"action.export-as-svg.short",contextMenuLabel:"action.export-as-svg.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"svg",source:b}),h(t.getSelectedShapeIds(),"svg")}},{id:"export-as-png",label:"action.export-as-png",menuLabel:"action.export-as-png.short",contextMenuLabel:"action.export-as-png.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"png",source:b}),h(t.getSelectedShapeIds(),"png")}},{id:"export-as-json",label:"action.export-as-json",menuLabel:"action.export-as-json.short",contextMenuLabel:"action.export-as-json.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"json",source:b}),h(t.getSelectedShapeIds(),"json")}},{id:"copy-as-svg",label:"action.copy-as-svg",menuLabel:"action.copy-as-svg.short",contextMenuLabel:"action.copy-as-svg.short",kbd:"$!c",readonlyOk:!0,onSelect(b){p("copy-as",{format:"svg",source:b}),u(t.getSelectedShapeIds(),"svg")}},{id:"copy-as-png",label:"action.copy-as-png",menuLabel:"action.copy-as-png.short",contextMenuLabel:"action.copy-as-png.short",readonlyOk:!0,onSelect(b){p("copy-as",{format:"png",source:b}),u(t.getSelectedShapeIds(),"png")}},{id:"copy-as-json",label:"action.copy-as-json",menuLabel:"action.copy-as-json.short",contextMenuLabel:"action.copy-as-json.short",readonlyOk:!0,onSelect(b){p("copy-as",{format:"json",source:b}),u(t.getSelectedShapeIds(),"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",readonlyOk:!1,onSelect(b){w()&&(f()||(p("toggle-auto-size",{source:b}),t.mark("toggling auto size"),t.updateShapes(t.getSelectedShapes().filter(_=>t.isShapeOfType(_,"text")&&_.props.autoSize===!1).map(_=>({id:_.id,type:_.type,props:{..._.props,w:8,autoSize:!0}})))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(b){p("open-embed-link",{source:b});const _=t.getSelectedShapeIds(),x="No embed shapes selected";if(_.length!==1){console.error(x);return}const E=t.getShape(_[0]);if(!E||!t.isShapeOfType(E,"embed")){console.error(x);return}uH(E.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(b){var _,x;if(((_=t.root.getCurrent())==null?void 0:_.id)!=="zoom"&&(p("zoom-tool",{source:b}),!(t.inputs.shiftKey||t.inputs.ctrlKey))){const E=t.root.getCurrent();E&&((x=E.getCurrent())==null?void 0:x.id)==="idle"&&t.setCurrentTool("zoom",{onInteractionEnd:E.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",readonlyOk:!1,onSelect(b){w()&&(f()||t.batch(()=>{p("convert-to-bookmark",{source:b});const _=t.getSelectedShapes(),x=[],E=[];for(const k of _){if(!k||!t.isShapeOfType(k,"embed")||!k.props.url)continue;const P=new C(k.x,k.y);P.rot(-k.rotation),P.add(new C(k.props.w/2-300/2,k.props.h/2-320/2)),P.rot(k.rotation);const I={id:ot(),type:"bookmark",rotation:k.rotation,x:P.x,y:P.y,opacity:1,props:{url:k.props.url}};x.push(I),E.push(k.id)}t.mark("convert shapes to bookmark"),t.deleteShapes(E),t.createShapes(x)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",readonlyOk:!1,onSelect(b){w()&&(f()||(p("convert-to-embed",{source:b}),t.batch(()=>{const _=t.getSelectedShapeIds(),x=me(_.map(P=>t.getShape(P))),E=[],k=[];for(const P of x){if(!t.isShapeOfType(P,"bookmark"))continue;const{url:I}=P.props,A=Do(P.props.url);if(!A||!A.definition)continue;const{width:T,height:O}=A.definition,F=new C(P.x,P.y);F.rot(-P.rotation),F.add(new C(P.props.w/2-T/2,P.props.h/2-O/2)),F.rot(P.rotation);const H={id:ot(),type:"embed",x:F.x,y:F.y,rotation:P.rotation,props:{url:I,w:T,h:O}};E.push(H),k.push(P.id)}t.mark("convert shapes to embed"),t.deleteShapes(k),t.createShapes(E)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",readonlyOk:!1,onSelect(b){if(!w()||f())return;p("duplicate-shapes",{source:b});const _=t.getSelectedShapeIds(),x=de.Common(me(_.map(k=>t.getShapePageBounds(k)))),E=t.getInstanceState().canMoveCamera?{x:x.width+10,y:0}:{x:16/t.getZoomLevel(),y:16/t.getZoomLevel()};t.mark("duplicate shapes"),t.duplicateShapes(_,E)}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",readonlyOk:!1,onSelect(b){w()&&(f()||(p("ungroup-shapes",{source:b}),t.mark("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",readonlyOk:!1,onSelect(b){if(!w()||f())return;p("group-shapes",{source:b});const _=t.getOnlySelectedShape();_&&t.isShapeOfType(_,"group")?(t.mark("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())):(t.mark("group"),t.groupShapes(t.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",readonlyOk:!1,onSelect(b){if(!w())return;p("remove-frame",{source:b});const _=t.getSelectedShapes();_.length>0&&_.every(x=>t.isShapeOfType(x,"frame"))&&(t.mark("remove-frame"),jee(t,_.map(x=>x.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",readonlyOk:!1,onSelect(b){if(!w())return;p("fit-frame-to-content",{source:b});const _=t.getOnlySelectedShape();_&&t.isShapeOfType(_,"frame")&&(t.mark("fit-frame-to-content"),Dee(t,_.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"left",source:b}),t.mark("align left"),t.alignShapes(t.getSelectedShapeIds(),"left")))}},{id:"align-center-horizontal",label:"action.align-center-horizontal",contextMenuLabel:"action.align-center-horizontal.short",kbd:"?H",icon:"align-center-horizontal",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"center-horizontal",source:b}),t.mark("align center horizontal"),t.alignShapes(t.getSelectedShapeIds(),"center-horizontal")))}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"right",source:b}),t.mark("align right"),t.alignShapes(t.getSelectedShapeIds(),"right")))}},{id:"align-center-vertical",label:"action.align-center-vertical",contextMenuLabel:"action.align-center-vertical.short",kbd:"?V",icon:"align-center-vertical",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"center-vertical",source:b}),t.mark("align center vertical"),t.alignShapes(t.getSelectedShapeIds(),"center-vertical")))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"top",source:b}),t.mark("align top"),t.alignShapes(t.getSelectedShapeIds(),"top")))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"bottom",source:b}),t.mark("align bottom"),t.alignShapes(t.getSelectedShapeIds(),"bottom")))}},{id:"distribute-horizontal",label:"action.distribute-horizontal",contextMenuLabel:"action.distribute-horizontal.short",icon:"distribute-horizontal",kbd:"?!h",readonlyOk:!1,onSelect(b){w()&&(f()||(p("distribute-shapes",{operation:"horizontal",source:b}),t.mark("distribute horizontal"),t.distributeShapes(t.getSelectedShapeIds(),"horizontal")))}},{id:"distribute-vertical",label:"action.distribute-vertical",contextMenuLabel:"action.distribute-vertical.short",icon:"distribute-vertical",kbd:"?!V",readonlyOk:!1,onSelect(b){w()&&(f()||(p("distribute-shapes",{operation:"vertical",source:b}),t.mark("distribute vertical"),t.distributeShapes(t.getSelectedShapeIds(),"vertical")))}},{id:"stretch-horizontal",label:"action.stretch-horizontal",contextMenuLabel:"action.stretch-horizontal.short",icon:"stretch-horizontal",readonlyOk:!1,onSelect(b){w()&&(f()||(p("stretch-shapes",{operation:"horizontal",source:b}),t.mark("stretch horizontal"),t.stretchShapes(t.getSelectedShapeIds(),"horizontal")))}},{id:"stretch-vertical",label:"action.stretch-vertical",contextMenuLabel:"action.stretch-vertical.short",icon:"stretch-vertical",readonlyOk:!1,onSelect(b){w()&&(f()||(p("stretch-shapes",{operation:"vertical",source:b}),t.mark("stretch vertical"),t.stretchShapes(t.getSelectedShapeIds(),"vertical")))}},{id:"flip-horizontal",label:"action.flip-horizontal",contextMenuLabel:"action.flip-horizontal.short",kbd:"!h",readonlyOk:!1,onSelect(b){w()&&(f()||(p("flip-shapes",{operation:"horizontal",source:b}),t.mark("flip horizontal"),t.flipShapes(t.getSelectedShapeIds(),"horizontal")))}},{id:"flip-vertical",label:"action.flip-vertical",contextMenuLabel:"action.flip-vertical.short",kbd:"!v",readonlyOk:!1,onSelect(b){w()&&(f()||(p("flip-shapes",{operation:"vertical",source:b}),t.mark("flip vertical"),t.flipShapes(t.getSelectedShapeIds(),"vertical")))}},{id:"pack",label:"action.pack",icon:"pack",readonlyOk:!1,onSelect(b){w()&&(f()||(p("pack-shapes",{source:b}),t.mark("pack"),t.packShapes(t.getSelectedShapeIds(),16)))}},{id:"stack-vertical",label:"action.stack-vertical",contextMenuLabel:"action.stack-vertical.short",icon:"stack-vertical",readonlyOk:!1,onSelect(b){w()&&(f()||(p("stack-shapes",{operation:"vertical",source:b}),t.mark("stack-vertical"),t.stackShapes(t.getSelectedShapeIds(),"vertical",16)))}},{id:"stack-horizontal",label:"action.stack-horizontal",contextMenuLabel:"action.stack-horizontal.short",icon:"stack-horizontal",readonlyOk:!1,onSelect(b){w()&&(f()||(p("stack-shapes",{operation:"horizontal",source:b}),t.mark("stack-horizontal"),t.stackShapes(t.getSelectedShapeIds(),"horizontal",16)))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",readonlyOk:!1,onSelect(b){w()&&(f()||(p("reorder-shapes",{operation:"toFront",source:b}),t.mark("bring to front"),t.bringToFront(t.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",readonlyOk:!1,onSelect(b){w()&&(f()||(p("reorder-shapes",{operation:"forward",source:b}),t.mark("bring forward"),t.bringForward(t.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",readonlyOk:!1,onSelect(b){w()&&(f()||(p("reorder-shapes",{operation:"backward",source:b}),t.mark("send backward"),t.sendBackward(t.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",readonlyOk:!1,onSelect(b){w()&&(f()||(p("reorder-shapes",{operation:"toBack",source:b}),t.mark("send to back"),t.sendToBack(t.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",readonlyOk:!1,onSelect(b){w()&&(f()||(t.mark("cut"),l(b)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(b){w()&&(f()||c(b))}},{id:"paste",label:"action.paste",kbd:"$v",readonlyOk:!1,onSelect(b){var _;(_=navigator.clipboard)==null||_.read().then(x=>{d(x,b,b==="context-menu"?t.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(b){t.batch(()=>{f()||(p("select-all-shapes",{source:b}),t.mark("select all kbd"),t.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(b){w()&&(f()||(p("select-none-shapes",{source:b}),t.mark("select none"),t.selectNone()))}},{id:"delete",label:"action.delete",kbd:"\u232B,del,backspace",icon:"trash",readonlyOk:!1,onSelect(b){w()&&(f()||(p("delete-shapes",{source:b}),t.mark("delete"),t.deleteShapes(t.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",readonlyOk:!1,onSelect(b){if(!w()||f())return;p("rotate-cw",{source:b}),t.mark("rotate-cw");const _=t.getSelectionRotation()%(at/2),x=mu(_,0)||mu(_,at/2);t.rotateShapesBy(t.getSelectedShapeIds(),at/2-(x?0:_))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",readonlyOk:!1,onSelect(b){if(!w()||f())return;p("rotate-ccw",{source:b}),t.mark("rotate-ccw");const _=t.getSelectionRotation()%(at/2),x=mu(_,0);t.rotateShapesBy(t.getSelectedShapeIds(),x?-(at/2):-_)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(b){p("zoom-in",{source:b}),t.zoomIn(t.getViewportScreenCenter(),{duration:Po})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(b){p("zoom-out",{source:b}),t.zoomOut(t.getViewportScreenCenter(),{duration:Po})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(b){p("reset-zoom",{source:b}),t.resetZoom(t.getViewportScreenCenter(),{duration:Po})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(b){p("zoom-to-fit",{source:b}),t.zoomToFit({duration:Po})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(b){w()&&(f()||(p("zoom-to-selection",{source:b}),t.zoomToSelection({duration:Po})))}},{id:"toggle-snap-mode",label:"action.toggle-snap-mode",menuLabel:"action.toggle-snap-mode.menu",readonlyOk:!1,onSelect(b){p("toggle-snap-mode",{source:b}),t.user.updateUserPreferences({isSnapMode:!t.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:"action.toggle-dark-mode",menuLabel:"action.toggle-dark-mode.menu",kbd:"$/",readonlyOk:!0,onSelect(b){p("toggle-dark-mode",{source:b}),t.user.updateUserPreferences({isDarkMode:!t.user.getIsDarkMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:"action.toggle-reduce-motion",menuLabel:"action.toggle-reduce-motion.menu",readonlyOk:!0,onSelect(b){p("toggle-reduce-motion",{source:b}),t.user.updateUserPreferences({animationSpeed:t.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:"action.toggle-edge-scrolling",menuLabel:"action.toggle-edge-scrolling.menu",readonlyOk:!0,onSelect(b){p("toggle-edge-scrolling",{source:b}),t.user.updateUserPreferences({edgeScrollSpeed:t.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:"action.toggle-transparent",menuLabel:"action.toggle-transparent.menu",contextMenuLabel:"action.toggle-transparent.context-menu",readonlyOk:!0,onSelect(b){p("toggle-transparent",{source:b}),t.updateInstanceState({exportBackground:!t.getInstanceState().exportBackground},{ephemeral:!0})},checkbox:!0},{id:"toggle-tool-lock",label:"action.toggle-tool-lock",menuLabel:"action.toggle-tool-lock.menu",readonlyOk:!1,kbd:"q",onSelect(b){p("toggle-tool-lock",{source:b}),t.updateInstanceState({isToolLocked:!t.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",readonlyOk:!1,onSelect(b){p("unlock-all",{source:b});const _=[];for(const x of t.getCurrentPageShapes())x.isLocked&&_.push({id:x.id,type:x.type,isLocked:!1});_.length>0&&t.updateShapes(_)}},{id:"toggle-focus-mode",label:"action.toggle-focus-mode",menuLabel:"action.toggle-focus-mode.menu",readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(b){requestAnimationFrame(()=>{t.batch(()=>{p("toggle-focus-mode",{source:b}),i(),o(),t.updateInstanceState({isFocusMode:!t.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:"action.toggle-grid",menuLabel:"action.toggle-grid.menu",readonlyOk:!0,kbd:"$'",onSelect(b){p("toggle-grid-mode",{source:b}),t.updateInstanceState({isGridMode:!t.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:"action.toggle-debug-mode",menuLabel:"action.toggle-debug-mode.menu",readonlyOk:!0,onSelect(b){p("toggle-debug-mode",{source:b}),t.updateInstanceState({isDebugMode:!t.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(b){p("print",{source:b}),a()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(b){p("exit-pen-mode",{source:b}),t.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(b){p("stop-following",{source:b}),t.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(b){p("zoom-to-content",{source:b}),t.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",readonlyOk:!1,kbd:"!l",onSelect(b){t.mark("locking"),p("toggle-lock",{source:b}),t.toggleLock(t.getSelectedShapeIds())}}]);return n?n(t,v,void 0):v},[t,p,n,r,s,h,u,l,c,d,i,o,a]);return m.jsx(nD.Provider,{value:g,children:e})}function Mn(){const n=S.useContext(nD);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function Qm(n){return n.filter(e=>e!=null&&e!==!1)}function _e(n,...e){const t=Qm(e);return t.length===0?null:{id:n,type:"group",checkbox:t.every(r=>r.type==="item"&&r.actionItem.checkbox),disabled:t.every(r=>r.disabled),readonlyOk:t.some(r=>r.readonlyOk),children:t}}function Wi(n,e,...t){const r=Qm(t);return r.length===0?null:{id:n,type:"submenu",label:e,children:r,disabled:r.every(i=>i.disabled),readonlyOk:r.some(i=>i.readonlyOk)}}function JS(n,e={}){const{readonlyOk:t=!0,disabled:r=!1}=e;return{id:n,type:"custom",disabled:r,readonlyOk:t}}function $(n,e={}){if(!n)throw Error("No action item provided to menuItem");if(!n.label)throw Error("Trying to create menu item for action item that doesn't have a label");const{checked:t=!1,disabled:r=!1}=e;return{id:n.id,type:"item",actionItem:n,disabled:r,checked:t,readonlyOk:n.readonlyOk}}function Nne(n){return n.getSelectedShapeIds().map(e=>n.getShape(e)).filter(e=>!(!e||n.isShapeOfType(e,"arrow")&&e.props.start.type==="binding"||n.isShapeOfType(e,"arrow")&&e.props.end.type==="binding"))}const rD=()=>{const n=G();return q("threeStackableItems",()=>Nne(n).length>2,[n])};function Fne(n){const e=n.getSelectedShapes(),t=[],r=new Map;e.forEach(o=>{o.type==="arrow"?t.push(o):r.set(o.id,o)});const i=t.filter(o=>!(o.props.start.type==="binding"&&!r.has(o.props.start.boundShapeId)||o.props.end.type==="binding"&&!r.has(o.props.end.boundShapeId)));return Array.from(r.values()).concat(i)}const ZS=()=>{const n=G();return q("allowGroup",()=>Fne(n).length>1,[n])},QS=()=>{const n=G();return q("allowUngroup",()=>n.getSelectedShapeIds().some(e=>{var t;return((t=n.getShape(e))==null?void 0:t.type)==="group"}),[n])},iD=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read,ex=[0,390,428,468,580,640,840,1023],oD=re.createContext(0);function $ne({forceMobile:n=!1,children:e}){const t=G(),r=q("breakpoint",()=>{const{width:i}=t.getViewportScreenBounds(),o=n?3:ex.length-1;for(let s=0;s<o;s++)if(i>ex[s]&&i<=ex[s+1])return s;return o},[t]);return m.jsx(oD.Provider,{value:r,children:e})}function Hr(){return S.useContext(oD)}function tx(){const n=G();return q("hasLinkShapeSelected",()=>{const e=n.getSelectedShapes();return e.length===1&&"url"in e[0].props&&e[0].type!=="embed"},[n])}const sD=re.createContext({}),Bne=({overrides:n,children:e})=>{const t=G(),r=Mn(),i=q("selected count",()=>t.getSelectedShapeIds().length,[t]),o=i>0,s=i>1,a=i>2,l=rD(),c=ZS(),d=QS(),u=tx(),h=Hr(),p=q("zoom is 1",()=>t.getZoomLevel()===1,[t]),g=S.useMemo(()=>{const f=[$(r["align-left"],{disabled:!s}),$(r["align-center-horizontal"],{disabled:!s}),$(r["align-right"],{disabled:!s}),$(r["stretch-horizontal"],{disabled:!s}),$(r["align-top"],{disabled:!s}),$(r["align-center-vertical"],{disabled:!s}),$(r["align-bottom"],{disabled:!s}),$(r["stretch-vertical"],{disabled:!s}),$(r["distribute-horizontal"],{disabled:!a}),$(r["distribute-vertical"],{disabled:!a}),$(r["stack-horizontal"],{disabled:!l}),$(r["stack-vertical"],{disabled:!l}),$(r["send-to-back"],{disabled:!o}),$(r["send-backward"],{disabled:!o}),$(r["bring-forward"],{disabled:!o}),$(r["bring-to-front"],{disabled:!o}),h<5?$(r["zoom-to-100"],{disabled:!!p}):$(r["rotate-ccw"],{disabled:!o}),$(r["rotate-cw"],{disabled:!o}),$(r["edit-link"],{disabled:!u}),c?$(r.group,{disabled:!s}):d?$(r.ungroup):$(r.group,{disabled:!s})];return n?n(t,f,{actions:r,oneSelected:o,twoSelected:s,threeSelected:a}):f},[t,p,c,n,r,o,s,a,l,d,u,h]);return m.jsx(sD.Provider,{value:g,children:e})};function Une(){const n=re.useContext(sD);if(!n)throw new Error("useActionsMenuSchema must be used inside of a ActionsMenuSchemaProvider.");return n}function Vne(){const n=G();return q("onlyFlippableShape",()=>{const e=n.getSelectedShapes();return e.length===1&&e.every(t=>n.isShapeOfType(t,"group")||n.isShapeOfType(t,"arrow")||n.isShapeOfType(t,"line")||n.isShapeOfType(t,"draw"))},[n])}function aD(){const n=G();return q("showAutoSizeToggle",()=>{const e=n.getSelectedShapes();return e.length===1&&n.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[n])}const lD=re.createContext({}),Hne=$e(function({overrides:n,children:e}){var P;const t=G(),r=Mn(),i=aD(),o=Vne(),s=t.getSelectedShapes(),a=s.length,l=a>0,c=a>1,d=a>2,u=rD(),h=q("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[]),p=q("isTransparentBg",()=>t.getInstanceState().exportBackground,[]),g=ZS(),f=QS(),w=!!((P=window.navigator.clipboard)!=null&&P.write),v=tx(),b=t.getOnlySelectedShape(),_=l&&s.every(I=>t.isShapeOfType(I,"frame")),x=b&&t.isShapeOfType(b,"frame")&&t.getSortedChildIdsForParent(b).length>0,E=b&&t.isShapeOrAncestorLocked(b),k=S.useMemo(()=>{let I=Qm([_e("selection",i&&$(r["toggle-auto-size"]),v&&!E&&$(r["edit-link"]),l&&!E&&$(r.duplicate),g&&!E&&$(r.group),f&&!E&&$(r.ungroup),_&&!E&&$(r["remove-frame"]),x&&!E&&$(r["fit-frame-to-content"]),l&&$(r["toggle-lock"])),_e("modify",(c||o)&&Wi("arrange","context-menu.arrange",c&&_e("align",$(r["align-left"]),$(r["align-center-horizontal"]),$(r["align-right"]),$(r["align-top"]),$(r["align-center-vertical"]),$(r["align-bottom"])),d&&_e("distribute",$(r["distribute-horizontal"]),$(r["distribute-vertical"])),c&&_e("stretch",$(r["stretch-horizontal"]),$(r["stretch-vertical"])),o&&!E&&_e("flip",$(r["flip-horizontal"]),$(r["flip-vertical"])),c&&_e("order",$(r.pack,{disabled:!c}),u&&$(r["stack-vertical"]),u&&$(r["stack-horizontal"]))),l&&!E&&Wi("reorder","context-menu.reorder",_e("reorder",$(r["bring-to-front"]),$(r["bring-forward"]),$(r["send-backward"]),$(r["send-to-back"]))),l&&!E&&JS("MOVE_TO_PAGE_MENU",{readonlyOk:!1})),_e("clipboard-group",l&&!E&&$(r.cut),l&&$(r.copy),iD&&$(r.paste)),h&&_e("conversions",Wi("copy-as","context-menu.copy-as",_e("copy-as-group",$(r["copy-as-svg"]),w&&$(r["copy-as-png"]),$(r["copy-as-json"])),_e("export-bg",$(r["toggle-transparent"],{checked:!p}))),Wi("export-as","context-menu.export-as",_e("export-as-group",$(r["export-as-svg"]),$(r["export-as-png"]),$(r["export-as-json"])),_e("export-bg,",$(r["toggle-transparent"],{checked:!p})))),h&&_e("set-selection-group",$(r["select-all"]),l&&$(r["select-none"])),l&&!E&&_e("delete-group",$(r.delete))]);return n&&(I=n(t,I,{actions:r,oneSelected:l,twoSelected:c,threeSelected:d,showAutoSizeToggle:i,showUngroup:f,onlyFlippableShapeSelected:o})),I},[t,n,r,l,c,d,i,o,h,u,g,f,_,x,w,v,p,E]);return m.jsx(lD.Provider,{value:k,children:e})});function cD(){const n=re.useContext(lD);if(!n)throw new Error("useContextMenuSchema must be used inside of a TLUiContextMenuSchemaProvider.");return n}const dD=S.createContext({});function Wne({overrides:n,children:e}){const t=G(),r=Ac(),{addDialog:i}=za(),o=tD(),s=S.useMemo(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(c){t.setCurrentTool("select"),r("select-tool",{source:c,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(c){t.setCurrentTool("hand"),r("select-tool",{source:c,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",readonlyOk:!1,onSelect(c){t.setCurrentTool("eraser"),r("select-tool",{source:c,id:"eraser"})}},{id:"draw",label:"tool.draw",readonlyOk:!1,icon:"tool-pencil",kbd:"d,b,x",onSelect(c){t.setCurrentTool("draw"),r("select-tool",{source:c,id:"draw"})}},...[...Oi.values].map(c=>({id:c,label:`tool.${c}`,readonlyOk:!1,meta:{geo:c},kbd:c==="rectangle"?"r":c==="ellipse"?"o":void 0,icon:"geo-"+c,onSelect(d){t.batch(()=>{t.updateInstanceState({stylesForNextShape:{...t.getInstanceState().stylesForNextShape,[Oi.id]:c}},{ephemeral:!0}),t.setCurrentTool("geo"),r("select-tool",{source:d,id:`geo-${c}`})})}})),{id:"arrow",label:"tool.arrow",readonlyOk:!1,icon:"tool-arrow",kbd:"a",onSelect(c){t.setCurrentTool("arrow"),r("select-tool",{source:c,id:"arrow"})}},{id:"line",label:"tool.line",readonlyOk:!1,icon:"tool-line",kbd:"l",onSelect(c){t.setCurrentTool("line"),r("select-tool",{source:c,id:"line"})}},{id:"frame",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"f",onSelect(c){t.setCurrentTool("frame"),r("select-tool",{source:c,id:"frame"})}},{id:"text",label:"tool.text",readonlyOk:!1,icon:"tool-text",kbd:"t",onSelect(c){t.setCurrentTool("text"),r("select-tool",{source:c,id:"text"})}},{id:"asset",label:"tool.asset",readonlyOk:!1,icon:"tool-media",kbd:"$u",onSelect(c){o(),r("select-tool",{source:c,id:"media"})}},{id:"note",label:"tool.note",readonlyOk:!1,icon:"tool-note",kbd:"n",onSelect(c){t.setCurrentTool("note"),r("select-tool",{source:c,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(c){t.setCurrentTool("laser"),r("select-tool",{source:c,id:"laser"})}},{id:"embed",label:"tool.embed",readonlyOk:!1,icon:"tool-embed",onSelect(c){i({component:$R}),r("select-tool",{source:c,id:"embed"})}}];a.push({id:"highlight",label:"tool.highlight",readonlyOk:!0,icon:"tool-highlight",kbd:"!d",onSelect(c){t.setCurrentTool("highlight"),r("select-tool",{source:c,id:"highlight"})}});const l=Object.fromEntries(a.map(c=>[c.id,c]));return n?n(t,l,{insertMedia:o}):l},[n,t,r,o,i]);return m.jsx(dD.Provider,{value:s,children:e})}function nx(){const n=S.useContext(dD);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}const uD=re.createContext({}),Kne=$e(function({overrides:n,children:e}){const t=G(),r=nx(),i=Mn(),o=S.useMemo(()=>{const s=me([_e("shortcuts-dialog.tools",$(i["toggle-tool-lock"]),$(r.select),$(r.draw),$(r.eraser),$(r.hand),$(r.rectangle),$(r.ellipse),$(r.arrow),$(r.line),$(r.text),$(r.frame),$(r.note),$(r.laser)),_e("shortcuts-dialog.file",$(i["insert-media"]),$(i.print)),_e("shortcuts-dialog.preferences",$(i["toggle-dark-mode"]),$(i["toggle-focus-mode"]),$(i["toggle-grid"])),_e("shortcuts-dialog.edit",$(i.undo),$(i.redo),$(i.cut),$(i.copy),$(i.paste),$(i["select-all"]),$(i.delete),$(i.duplicate),$(i["export-as-svg"]),$(i["export-as-png"])),_e("shortcuts-dialog.view",$(i["zoom-in"]),$(i["zoom-out"]),$(i["zoom-to-100"]),$(i["zoom-to-fit"]),$(i["zoom-to-selection"])),_e("shortcuts-dialog.transform",$(i["bring-to-front"]),$(i["bring-forward"]),$(i["send-backward"]),$(i["send-to-back"]),$(i.group),$(i.ungroup),$(i["flip-horizontal"]),$(i["flip-vertical"]),$(i["align-top"]),$(i["align-center-vertical"]),$(i["align-bottom"]),$(i["align-left"]),$(i["align-center-horizontal"]),$(i["align-right"]))]);return n?n(t,s,{tools:r,actions:i}):s},[t,n,i,r]);return m.jsx(uD.Provider,{value:o,children:e})});function Gne(){const n=re.useContext(uD);if(!n)throw new Error("Shortcuts must be used inside of a ShortcutsProvider.");return n}const Yne=()=>{const n=Ae(),e=Br(),t=Gne();function r(i){if(!i||e&&!i.readonlyOk)return null;switch(i.type){case"group":return m.jsxs("div",{className:"tlui-shortcuts-dialog__group",children:[m.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:n(i.id)}),m.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:i.children.filter(o=>o&&o.type==="item"&&o.actionItem.kbd).map(r)})]},i.id);case"item":{const{id:o,label:s,shortcutsLabel:a,kbd:l}=i.actionItem;return m.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair",children:[m.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:n(a??s)}),m.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:m.jsx(Nm,{children:l})})]},o)}}}return m.jsxs(m.Fragment,{children:[m.jsxs(Km,{className:"tlui-shortcuts-dialog__header",children:[m.jsx(Gm,{children:n("shortcuts-dialog.title")}),m.jsx(Ym,{})]}),m.jsx(th,{className:"tlui-shortcuts-dialog__body",children:t.map(r)}),m.jsx("div",{className:"tlui-dialog__scrim"})]})};function hD(){const n=G();return{languages:du,currentLanguage:n.user.getLocale()}}const pD=re.createContext({}),Xne=$e(function({overrides:n,children:e}){const t=G(),r=Mn(),i=t.getSelectedShapeIds().length,o=i>0,s=i>1,a=i>2,{languages:l,currentLanguage:c}=hD(),{addDialog:d}=za(),u=S.useMemo(()=>{const h=me([_e("top",JS("LANGUAGE_MENU",{readonlyOk:!0}),$({id:"keyboard-shortcuts",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect(){d({component:Yne})}}))]);return n?n(t,h,{actions:r,currentLanguage:c,languages:l,oneSelected:o,twoSelected:s,threeSelected:a}):h},[t,n,l,r,o,s,a,c,d]);return m.jsx(pD.Provider,{value:u,children:e})});function qne(){const n=re.useContext(pD);if(!n)throw new Error("useHelpMenuSchema must be used inside of a helpTLUiMenuSchemaProvider.");return n}function fD(){const n=G();return q("useCanRedo",()=>n.getCanRedo(),[n])}function gD(){const n=G();return q("useCanUndo",()=>n.getCanUndo(),[n])}const mD=re.createContext({});function Jne({overrides:n,children:e}){var K;const t=G(),r=Mn(),i=Hr()<5,o=q("isDarkMode",()=>t.user.getIsDarkMode(),[t]),s=q("animationSpeed",()=>t.user.getAnimationSpeed(),[t]),a=q("edgeScrollSpeed",()=>t.user.getEdgeScrollSpeed(),[t]),l=q("isGridMode",()=>t.getInstanceState().isGridMode,[t]),c=q("isSnapMode",()=>t.user.getIsSnapMode(),[t]),d=q("isToolLock",()=>t.getInstanceState().isToolLocked,[t]),u=q("isFocusMode",()=>t.getInstanceState().isFocusMode,[t]),h=q("isDebugMode",()=>t.getInstanceState().isDebugMode,[t]),p=q("exportBackground",()=>t.getInstanceState().exportBackground,[t]),g=q("emptyPage",()=>t.getCurrentPageShapeIds().size===0,[t]),f=q("selectedCount",()=>t.getSelectedShapeIds().length,[t]),w=f===0,v=f>0,b=f>1,_=f>2,x=!!((K=window.navigator.clipboard)!=null&&K.write),E=tx(),k=aD(),P=ZS(),I=QS(),A=gD(),T=fD(),O=q("isZoomedTo100",()=>t.getZoomLevel()===1,[t]),F=q("oneEmbedSelected",()=>{const B=t.getOnlySelectedShape();return B?!!(t.isShapeOfType(B,"embed")&&B.props.url&&!t.isShapeOrAncestorLocked(B)):!1},[]),H=q("oneEmbeddableBookmarkSelected",()=>{const B=t.getOnlySelectedShape();return B?!!(t.isShapeOfType(B,"bookmark")&&B.props.url&&Do(B.props.url)&&!t.isShapeOrAncestorLocked(B)):!1},[]),D=S.useMemo(()=>{const B=Qm([_e("menu",Wi("file","menu.file",_e("print",$(r.print,{disabled:g}))),Wi("edit","menu.edit",_e("undo-actions",$(r.undo,{disabled:!A}),$(r.redo,{disabled:!T})),_e("clipboard-actions",$(r.cut,{disabled:w}),$(r.copy,{disabled:w}),$(r.paste,{disabled:!iD})),_e("conversions",Wi("copy-as","menu.copy-as",_e("copy-as-group",$(r["copy-as-svg"],{disabled:g}),$(r["copy-as-png"],{disabled:g||!x}),$(r["copy-as-json"],{disabled:g})),_e("export-bg",$(r["toggle-transparent"],{checked:!p}))),Wi("export-as","menu.export-as",_e("export-as-group",$(r["export-as-svg"],{disabled:g}),$(r["export-as-png"],{disabled:g}),$(r["export-as-json"],{disabled:g})),_e("export-bg",$(r["toggle-transparent"],{checked:!p})))),_e("set-selection-group",$(r["select-all"],{disabled:g}),$(r["select-none"],{disabled:!v})),_e("selection",k&&$(r["toggle-auto-size"]),E&&$(r["edit-link"]),$(r.duplicate,{disabled:!v}),P&&$(r.group),I&&$(r.ungroup),$(r["unlock-all"],{disabled:g})),_e("delete-group",$(r.delete,{disabled:!v})),_e("embeds",F&&$(r["open-embed-link"]),F&&$(r["convert-to-bookmark"]),H&&$(r["convert-to-embed"]))),Wi("view","menu.view",_e("view-actions",$(r["zoom-in"]),$(r["zoom-out"]),$(r["zoom-to-100"],{disabled:O}),$(r["zoom-to-fit"],{disabled:g}),$(r["zoom-to-selection"],{disabled:g||!v})))),_e("extras",$(r["insert-embed"]),$(r["insert-media"])),_e("preferences",Wi("preferences","menu.preferences",_e("preferences-actions",$(r["toggle-snap-mode"],{checked:c}),$(r["toggle-tool-lock"],{checked:d}),$(r["toggle-grid"],{checked:l}),$(r["toggle-dark-mode"],{checked:o}),$(r["toggle-focus-mode"],{checked:u}),$(r["toggle-edge-scrolling"],{checked:a===1}),$(r["toggle-reduce-motion"],{checked:s===0}),$(r["toggle-debug-mode"],{checked:h}))),i&&JS("LANGUAGE_MENU",{readonlyOk:!0}))]);return n?n(t,B,{actions:r,noneSelected:w,oneSelected:v,twoSelected:b,threeSelected:_}):B},[t,n,r,v,b,_,g,i,P,I,E,x,k,w,A,T,s,o,l,c,d,u,p,h,a,O,H,F]);return m.jsx(mD.Provider,{value:D,children:e})}function Zne(){const n=re.useContext(mD);if(!n)throw new Error("useMenuSchema must be used inside of a TLUiMenuSchemaProvider.");return n}function tt(n){return{id:n.id,type:"item",readonlyOk:n.readonlyOk,toolItem:n}}const yD=re.createContext([]);function Qne({overrides:n,children:e}){const t=G(),r=nx(),i=re.useMemo(()=>{const o=me([tt(r.select),tt(r.hand),tt(r.draw),tt(r.eraser),tt(r.arrow),tt(r.text),tt(r.note),tt(r.asset),tt(r.rectangle),tt(r.ellipse),tt(r.diamond),tt(r.triangle),tt(r.trapezoid),tt(r.rhombus),tt(r.hexagon),tt(r.cloud),tt(r.star),tt(r.oval),tt(r["x-box"]),tt(r["check-box"]),tt(r["arrow-left"]),tt(r["arrow-up"]),tt(r["arrow-down"]),tt(r["arrow-right"]),tt(r.line),tt(r.highlight),tt(r.frame),tt(r.laser)]);return n?n(t,o,{tools:r}):o},[t,n,r]);return m.jsx(yD.Provider,{value:i,children:e})}function ere(){const n=re.useContext(yD);if(!n)throw new Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return n}function tre(){const{addToast:n,removeToast:e,clearToasts:t}=Hi(),{addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s}=za(),a=Hr()<5,l=Ae();return S.useMemo(()=>({addToast:n,removeToast:e,clearToasts:t,addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s,msg:l,isMobile:a}),[r,n,i,t,l,o,e,s,a])}function nre(n,e){const t={};for(const r of n)if(r.translations)for(const[i,o]of So(r.translations)){let s=t[i];s||(s=t[i]={}),Object.assign(s,o)}return{actionsMenu:(r,i,o)=>{for(const s of n)s.actionsMenu&&(i=s.actionsMenu(r,i,{...e,...o}));return i},actions:(r,i)=>{for(const o of n)o.actions&&(i=o.actions(r,i,e));return i},contextMenu:(r,i,o)=>{for(const s of n)s.contextMenu&&(i=s.contextMenu(r,i,{...e,...o}));return i},helpMenu:(r,i,o)=>{for(const s of n)s.helpMenu&&(i=s.helpMenu(r,i,{...e,...o}));return i},menu:(r,i,o)=>{for(const s of n)s.menu&&(i=s.menu(r,i,{...e,...o}));return i},toolbar:(r,i,o)=>{for(const s of n)s.toolbar&&(i=s.toolbar(r,i,{...e,...o}));return i},keyboardShortcutsMenu:(r,i,o)=>{for(const s of n)s.keyboardShortcutsMenu&&(i=s.keyboardShortcutsMenu(r,i,{...e,...o}));return i},tools:(r,i,o)=>{for(const s of n)s.tools&&(i=s.tools(r,i,{...e,...o}));return i},translations:t}}function wD(n){return S.useMemo(()=>n,n)}function rre(n){const e=wD(n==null?[]:Array.isArray(n)?n:[n]);return S.useMemo(()=>{const t={};for(const r of e)if(r.translations)for(const[i,o]of So(r.translations)){let s=t[i];s||(s=t[i]={}),Object.assign(s,o)}return t},[e])}function ire(n){const e=tre(),t=wD(n==null?[]:Array.isArray(n)?n:[n]);return S.useMemo(()=>nre(t,e),[t,e])}function ore({overrides:n,assetUrls:e,onUiEvent:t,forceMobile:r,children:i}){return m.jsx(Oee,{assetUrls:Tee(e),children:m.jsx(Nee,{overrides:rre(n),children:m.jsx(fne,{onEvent:t,children:m.jsx(Mne,{children:m.jsx(Tne,{children:m.jsx($ne,{forceMobile:r,children:m.jsx(sre,{overrides:n,children:i})})})})})})})}function sre({overrides:n,children:e}){const t=ire(n);return m.jsx(zne,{overrides:t.actions,children:m.jsx(Wne,{overrides:t.tools,children:m.jsx(Qne,{overrides:t.toolbar,children:m.jsx(Bne,{overrides:t.actionsMenu,children:m.jsx(Kne,{overrides:t.keyboardShortcutsMenu,children:m.jsx(Hne,{overrides:t.contextMenu,children:m.jsx(Xne,{overrides:t.helpMenu,children:m.jsx(Jne,{overrides:t.menu,children:e})})})})})})})})}function are(){const n=G(),e=Mn()["back-to-content"],[t,r]=S.useState(!1);return S.useEffect(()=>{let i=!1;const o=setInterval(()=>{const s=n.getRenderingShapes(),a=n.getRenderingBounds(),l=s.filter(c=>c.maskedPageBounds&&a.includes(c.maskedPageBounds)).length===0&&n.getCurrentPageShapes().length>0;i!==l&&(r(l),i=l)},1e3);return()=>{clearInterval(o)}},[n]),t?m.jsx(le,{iconLeft:e.icon,label:e.label,type:"low",onClick:()=>{e.onSelect("helper-buttons"),r(!1)}}):null}const lre=S.createContext(void 0);function rx(n){const e=S.useContext(lre);return n||e||"ltr"}const ix="dismissableLayer.update",cre="dismissableLayer.pointerDownOutside",dre="dismissableLayer.focusOutside";let bD;const ure=S.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),hre=S.forwardRef((n,e)=>{var t;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...c}=n,d=S.useContext(ure),[u,h]=S.useState(null),p=(t=u==null?void 0:u.ownerDocument)!==null&&t!==void 0?t:globalThis==null?void 0:globalThis.document,[,g]=S.useState({}),f=Je(e,I=>h(I)),w=Array.from(d.layers),[v]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),b=w.indexOf(v),_=u?w.indexOf(u):-1,x=d.layersWithOutsidePointerEventsDisabled.size>0,E=_>=b,k=pre(I=>{const A=I.target,T=[...d.branches].some(O=>O.contains(A));!E||T||(o==null||o(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p),P=fre(I=>{const A=I.target;[...d.branches].some(T=>T.contains(A))||(s==null||s(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p);return Rm(I=>{_===d.layers.size-1&&(i==null||i(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},p),S.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(bD=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),vD(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=bD)}},[u,p,r,d]),S.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),vD())},[u,d]),S.useEffect(()=>{const I=()=>g({});return document.addEventListener(ix,I),()=>document.removeEventListener(ix,I)},[]),S.createElement(Re.div,J({},c,{ref:f,style:{pointerEvents:x?E?"auto":"none":void 0,...n.style},onFocusCapture:ne(n.onFocusCapture,P.onFocusCapture),onBlurCapture:ne(n.onBlurCapture,P.onBlurCapture),onPointerDownCapture:ne(n.onPointerDownCapture,k.onPointerDownCapture)}))});function pre(n,e=globalThis==null?void 0:globalThis.document){const t=It(n),r=S.useRef(!1),i=S.useRef(()=>{});return S.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){SD(cre,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function fre(n,e=globalThis==null?void 0:globalThis.document){const t=It(n),r=S.useRef(!1);return S.useEffect(()=>{const i=o=>{o.target&&!r.current&&SD(dre,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function vD(){const n=new CustomEvent(ix);document.dispatchEvent(n)}function SD(n,e,t,{discrete:r}){const i=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?Cc(i,o):i.dispatchEvent(o)}const gre=["top","right","bottom","left"],Ns=Math.min,_r=Math.max,ey=Math.round,ty=Math.floor,Fs=n=>({x:n,y:n}),mre={left:"right",right:"left",bottom:"top",top:"bottom"},yre={start:"end",end:"start"};function ox(n,e,t){return _r(n,Ns(e,t))}function No(n,e){return typeof n=="function"?n(e):n}function Fo(n){return n.split("-")[0]}function Tc(n){return n.split("-")[1]}function sx(n){return n==="x"?"y":"x"}function ax(n){return n==="y"?"height":"width"}function jc(n){return["top","bottom"].includes(Fo(n))?"y":"x"}function lx(n){return sx(jc(n))}function wre(n,e,t){t===void 0&&(t=!1);const r=Tc(n),i=lx(n),o=ax(i);let s=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(s=ny(s)),[s,ny(s)]}function bre(n){const e=ny(n);return[cx(n),e,cx(e)]}function cx(n){return n.replace(/start|end/g,e=>yre[e])}function vre(n,e,t){const r=["left","right"],i=["right","left"],o=["top","bottom"],s=["bottom","top"];switch(n){case"top":case"bottom":return t?e?i:r:e?r:i;case"left":case"right":return e?o:s;default:return[]}}function Sre(n,e,t,r){const i=Tc(n);let o=vre(Fo(n),t==="start",r);return i&&(o=o.map(s=>s+"-"+i),e&&(o=o.concat(o.map(cx)))),o}function ny(n){return n.replace(/left|right|bottom|top/g,e=>mre[e])}function xre(n){return{top:0,right:0,bottom:0,left:0,...n}}function xD(n){return typeof n!="number"?xre(n):{top:n,right:n,bottom:n,left:n}}function ry(n){return{...n,top:n.y,left:n.x,right:n.x+n.width,bottom:n.y+n.height}}function _D(n,e,t){let{reference:r,floating:i}=n;const o=jc(e),s=lx(e),a=ax(s),l=Fo(e),c=o==="y",d=r.x+r.width/2-i.width/2,u=r.y+r.height/2-i.height/2,h=r[a]/2-i[a]/2;let p;switch(l){case"top":p={x:d,y:r.y-i.height};break;case"bottom":p={x:d,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:u};break;case"left":p={x:r.x-i.width,y:u};break;default:p={x:r.x,y:r.y}}switch(Tc(e)){case"start":p[s]-=h*(t&&c?-1:1);break;case"end":p[s]+=h*(t&&c?-1:1);break}return p}const _re=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=t,a=o.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(e));let c=await s.getElementRects({reference:n,floating:e,strategy:i}),{x:d,y:u}=_D(c,r,l),h=r,p={},g=0;for(let f=0;f<a.length;f++){const{name:w,fn:v}=a[f],{x:b,y:_,data:x,reset:E}=await v({x:d,y:u,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:c,platform:s,elements:{reference:n,floating:e}});if(d=b??d,u=_??u,p={...p,[w]:{...p[w],...x}},E&&g<=50){g++,typeof E=="object"&&(E.placement&&(h=E.placement),E.rects&&(c=E.rects===!0?await s.getElementRects({reference:n,floating:e,strategy:i}):E.rects),{x:d,y:u}=_D(c,h,l)),f=-1;continue}}return{x:d,y:u,placement:h,strategy:i,middlewareData:p}};async function rh(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=No(e,n),g=xD(p),f=a[h?u==="floating"?"reference":"floating":u],w=ry(await o.getClippingRect({element:(t=await(o.isElement==null?void 0:o.isElement(f)))==null||t?f:f.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),v=u==="floating"?{...s.floating,x:r,y:i}:s.reference,b=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),_=await(o.isElement==null?void 0:o.isElement(b))?await(o.getScale==null?void 0:o.getScale(b))||{x:1,y:1}:{x:1,y:1},x=ry(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:v,offsetParent:b,strategy:l}):v);return{top:(w.top-x.top+g.top)/_.y,bottom:(x.bottom-w.bottom+g.bottom)/_.y,left:(w.left-x.left+g.left)/_.x,right:(x.right-w.right+g.right)/_.x}}const kD=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:i,rects:o,platform:s,elements:a}=e,{element:l,padding:c=0}=No(n,e)||{};if(l==null)return{};const d=xD(c),u={x:t,y:r},h=lx(i),p=ax(h),g=await s.getDimensions(l),f=h==="y",w=f?"top":"left",v=f?"bottom":"right",b=f?"clientHeight":"clientWidth",_=o.reference[p]+o.reference[h]-u[h]-o.floating[p],x=u[h]-o.reference[h],E=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l));let k=E?E[b]:0;(!k||!await(s.isElement==null?void 0:s.isElement(E)))&&(k=a.floating[b]||o.floating[p]);const P=_/2-x/2,I=k/2-g[p]/2-1,A=Ns(d[w],I),T=Ns(d[v],I),O=A,F=k-g[p]-T,H=k/2-g[p]/2+P,D=ox(O,H,F),K=Tc(i)!=null&&H!=D&&o.reference[p]/2-(H<O?A:T)-g[p]/2<0?H<O?O-H:F-H:0;return{[h]:u[h]-K,data:{[h]:D,centerOffset:H-D+K}}}}),kre=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t;const{placement:r,middlewareData:i,rects:o,initialPlacement:s,platform:a,elements:l}=e,{mainAxis:c=!0,crossAxis:d=!0,fallbackPlacements:u,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:g=!0,...f}=No(n,e),w=Fo(r),v=Fo(s)===s,b=await(a.isRTL==null?void 0:a.isRTL(l.floating)),_=u||(v||!g?[ny(s)]:bre(s));!u&&p!=="none"&&_.push(...Sre(s,g,p,b));const x=[s,..._],E=await rh(e,f),k=[];let P=((t=i.flip)==null?void 0:t.overflows)||[];if(c&&k.push(E[w]),d){const O=wre(r,o,b);k.push(E[O[0]],E[O[1]])}if(P=[...P,{placement:r,overflows:k}],!k.every(O=>O<=0)){var I,A;const O=(((I=i.flip)==null?void 0:I.index)||0)+1,F=x[O];if(F)return{data:{index:O,overflows:P},reset:{placement:F}};let H=(A=P.filter(D=>D.overflows[0]<=0).sort((D,K)=>D.overflows[1]-K.overflows[1])[0])==null?void 0:A.placement;if(!H)switch(h){case"bestFit":{var T;const D=(T=P.map(K=>[K.placement,K.overflows.filter(B=>B>0).reduce((B,te)=>B+te,0)]).sort((K,B)=>K[1]-B[1])[0])==null?void 0:T[0];D&&(H=D);break}case"initialPlacement":H=s;break}if(r!==H)return{reset:{placement:H}}}return{}}}};function CD(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function ED(n){return gre.some(e=>n[e]>=0)}const Cre=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...i}=No(n,e);switch(r){case"referenceHidden":{const o=await rh(e,{...i,elementContext:"reference"}),s=CD(o,t.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:ED(s)}}}case"escaped":{const o=await rh(e,{...i,altBoundary:!0}),s=CD(o,t.floating);return{data:{escapedOffsets:s,escaped:ED(s)}}}default:return{}}}}};async function Ere(n,e){const{placement:t,platform:r,elements:i}=n,o=await(r.isRTL==null?void 0:r.isRTL(i.floating)),s=Fo(t),a=Tc(t),l=jc(t)==="y",c=["left","top"].includes(s)?-1:1,d=o&&l?-1:1,u=No(e,n);let{mainAxis:h,crossAxis:p,alignmentAxis:g}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...u};return a&&typeof g=="number"&&(p=a==="end"?g*-1:g),l?{x:p*d,y:h*c}:{x:h*c,y:p*d}}const Pre=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){const{x:t,y:r}=e,i=await Ere(e,n);return{x:t+i.x,y:r+i.y,data:i}}}},Ire=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:w=>{let{x:v,y:b}=w;return{x:v,y:b}}},...l}=No(n,e),c={x:t,y:r},d=await rh(e,l),u=jc(Fo(i)),h=sx(u);let p=c[h],g=c[u];if(o){const w=h==="y"?"top":"left",v=h==="y"?"bottom":"right",b=p+d[w],_=p-d[v];p=ox(b,p,_)}if(s){const w=u==="y"?"top":"left",v=u==="y"?"bottom":"right",b=g+d[w],_=g-d[v];g=ox(b,g,_)}const f=a.fn({...e,[h]:p,[u]:g});return{...f,data:{x:f.x-t,y:f.y-r}}}}},Mre=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:i,rects:o,middlewareData:s}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=No(n,e),d={x:t,y:r},u=jc(i),h=sx(u);let p=d[h],g=d[u];const f=No(a,e),w=typeof f=="number"?{mainAxis:f,crossAxis:0}:{mainAxis:0,crossAxis:0,...f};if(l){const _=h==="y"?"height":"width",x=o.reference[h]-o.floating[_]+w.mainAxis,E=o.reference[h]+o.reference[_]-w.mainAxis;p<x?p=x:p>E&&(p=E)}if(c){var v,b;const _=h==="y"?"width":"height",x=["top","left"].includes(Fo(i)),E=o.reference[u]-o.floating[_]+(x&&((v=s.offset)==null?void 0:v[u])||0)+(x?0:w.crossAxis),k=o.reference[u]+o.reference[_]+(x?0:((b=s.offset)==null?void 0:b[u])||0)-(x?w.crossAxis:0);g<E?g=E:g>k&&(g=k)}return{[h]:p,[u]:g}}}},Are=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){const{placement:t,rects:r,platform:i,elements:o}=e,{apply:s=()=>{},...a}=No(n,e),l=await rh(e,a),c=Fo(t),d=Tc(t),u=jc(t)==="y",{width:h,height:p}=r.floating;let g,f;c==="top"||c==="bottom"?(g=c,f=d===(await(i.isRTL==null?void 0:i.isRTL(o.floating))?"start":"end")?"left":"right"):(f=c,g=d==="end"?"top":"bottom");const w=p-l[g],v=h-l[f],b=!e.middlewareData.shift;let _=w,x=v;if(u){const k=h-l.left-l.right;x=d||b?Ns(v,k):k}else{const k=p-l.top-l.bottom;_=d||b?Ns(w,k):k}if(b&&!d){const k=_r(l.left,0),P=_r(l.right,0),I=_r(l.top,0),A=_r(l.bottom,0);u?x=h-2*(k!==0||P!==0?k+P:_r(l.left,l.right)):_=p-2*(I!==0||A!==0?I+A:_r(l.top,l.bottom))}await s({...e,availableWidth:x,availableHeight:_});const E=await i.getDimensions(o.floating);return h!==E.width||p!==E.height?{reset:{rects:!0}}:{}}}};function $s(n){return PD(n)?(n.nodeName||"").toLowerCase():"#document"}function kr(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function $o(n){var e;return(e=(PD(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function PD(n){return n instanceof Node||n instanceof kr(n).Node}function Bo(n){return n instanceof Element||n instanceof kr(n).Element}function Ki(n){return n instanceof HTMLElement||n instanceof kr(n).HTMLElement}function ID(n){return typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof kr(n).ShadowRoot}function ih(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=Wr(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(i)}function Tre(n){return["table","td","th"].includes($s(n))}function dx(n){const e=ux(),t=Wr(n);return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function jre(n){let e=Rc(n);for(;Ki(e)&&!iy(e);){if(dx(e))return e;e=Rc(e)}return null}function ux(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function iy(n){return["html","body","#document"].includes($s(n))}function Wr(n){return kr(n).getComputedStyle(n)}function oy(n){return Bo(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.pageXOffset,scrollTop:n.pageYOffset}}function Rc(n){if($s(n)==="html")return n;const e=n.assignedSlot||n.parentNode||ID(n)&&n.host||$o(n);return ID(e)?e.host:e}function MD(n){const e=Rc(n);return iy(e)?n.ownerDocument?n.ownerDocument.body:n.body:Ki(e)&&ih(e)?e:MD(e)}function sy(n,e){var t;e===void 0&&(e=[]);const r=MD(n),i=r===((t=n.ownerDocument)==null?void 0:t.body),o=kr(r);return i?e.concat(o,o.visualViewport||[],ih(r)?r:[]):e.concat(r,sy(r))}function AD(n){const e=Wr(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Ki(n),o=i?n.offsetWidth:t,s=i?n.offsetHeight:r,a=ey(t)!==o||ey(r)!==s;return a&&(t=o,r=s),{width:t,height:r,$:a}}function hx(n){return Bo(n)?n:n.contextElement}function Dc(n){const e=hx(n);if(!Ki(e))return Fs(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:o}=AD(e);let s=(o?ey(t.width):t.width)/r,a=(o?ey(t.height):t.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const Rre=Fs(0);function TD(n){const e=kr(n);return!ux()||!e.visualViewport?Rre:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Dre(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==kr(n)?!1:e}function Na(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),o=hx(n);let s=Fs(1);e&&(r?Bo(r)&&(s=Dc(r)):s=Dc(n));const a=Dre(o,t,r)?TD(o):Fs(0);let l=(i.left+a.x)/s.x,c=(i.top+a.y)/s.y,d=i.width/s.x,u=i.height/s.y;if(o){const h=kr(o),p=r&&Bo(r)?kr(r):r;let g=h.frameElement;for(;g&&r&&p!==h;){const f=Dc(g),w=g.getBoundingClientRect(),v=Wr(g),b=w.left+(g.clientLeft+parseFloat(v.paddingLeft))*f.x,_=w.top+(g.clientTop+parseFloat(v.paddingTop))*f.y;l*=f.x,c*=f.y,d*=f.x,u*=f.y,l+=b,c+=_,g=kr(g).frameElement}}return ry({width:d,height:u,x:l,y:c})}function Ore(n){let{rect:e,offsetParent:t,strategy:r}=n;const i=Ki(t),o=$o(t);if(t===o)return e;let s={scrollLeft:0,scrollTop:0},a=Fs(1);const l=Fs(0);if((i||!i&&r!=="fixed")&&(($s(t)!=="body"||ih(o))&&(s=oy(t)),Ki(t))){const c=Na(t);a=Dc(t),l.x=c.x+t.clientLeft,l.y=c.y+t.clientTop}return{width:e.width*a.x,height:e.height*a.y,x:e.x*a.x-s.scrollLeft*a.x+l.x,y:e.y*a.y-s.scrollTop*a.y+l.y}}function Lre(n){return Array.from(n.getClientRects())}function jD(n){return Na($o(n)).left+oy(n).scrollLeft}function zre(n){const e=$o(n),t=oy(n),r=n.ownerDocument.body,i=_r(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),o=_r(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let s=-t.scrollLeft+jD(n);const a=-t.scrollTop;return Wr(r).direction==="rtl"&&(s+=_r(e.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}function Nre(n,e){const t=kr(n),r=$o(n),i=t.visualViewport;let o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;const c=ux();(!c||c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}function Fre(n,e){const t=Na(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,o=Ki(n)?Dc(n):Fs(1),s=n.clientWidth*o.x,a=n.clientHeight*o.y,l=i*o.x,c=r*o.y;return{width:s,height:a,x:l,y:c}}function RD(n,e,t){let r;if(e==="viewport")r=Nre(n,t);else if(e==="document")r=zre($o(n));else if(Bo(e))r=Fre(e,t);else{const i=TD(n);r={...e,x:e.x-i.x,y:e.y-i.y}}return ry(r)}function DD(n,e){const t=Rc(n);return t===e||!Bo(t)||iy(t)?!1:Wr(t).position==="fixed"||DD(t,e)}function $re(n,e){const t=e.get(n);if(t)return t;let r=sy(n).filter(a=>Bo(a)&&$s(a)!=="body"),i=null;const o=Wr(n).position==="fixed";let s=o?Rc(n):n;for(;Bo(s)&&!iy(s);){const a=Wr(s),l=dx(s);!l&&a.position==="fixed"&&(i=null),(o?!l&&!i:!l&&a.position==="static"&&i&&["absolute","fixed"].includes(i.position)||ih(s)&&!l&&DD(n,s))?r=r.filter(c=>c!==s):i=a,s=Rc(s)}return e.set(n,r),r}function Bre(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const o=[...t==="clippingAncestors"?$re(e,this._c):[].concat(t),r],s=o[0],a=o.reduce((l,c)=>{const d=RD(e,c,i);return l.top=_r(d.top,l.top),l.right=Ns(d.right,l.right),l.bottom=Ns(d.bottom,l.bottom),l.left=_r(d.left,l.left),l},RD(e,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function Ure(n){return AD(n)}function Vre(n,e,t){const r=Ki(e),i=$o(e),o=t==="fixed",s=Na(n,!0,o,e);let a={scrollLeft:0,scrollTop:0};const l=Fs(0);if(r||!r&&!o)if(($s(e)!=="body"||ih(i))&&(a=oy(e)),r){const c=Na(e,!0,o,e);l.x=c.x+e.clientLeft,l.y=c.y+e.clientTop}else i&&(l.x=jD(i));return{x:s.left+a.scrollLeft-l.x,y:s.top+a.scrollTop-l.y,width:s.width,height:s.height}}function OD(n,e){return!Ki(n)||Wr(n).position==="fixed"?null:e?e(n):n.offsetParent}function LD(n,e){const t=kr(n);if(!Ki(n))return t;let r=OD(n,e);for(;r&&Tre(r)&&Wr(r).position==="static";)r=OD(r,e);return r&&($s(r)==="html"||$s(r)==="body"&&Wr(r).position==="static"&&!dx(r))?t:r||jre(n)||t}const Hre=async function(n){let{reference:e,floating:t,strategy:r}=n;const i=this.getOffsetParent||LD,o=this.getDimensions;return{reference:Vre(e,await i(t),r),floating:{x:0,y:0,...await o(t)}}};function Wre(n){return Wr(n).direction==="rtl"}const Kre={convertOffsetParentRelativeRectToViewportRelativeRect:Ore,getDocumentElement:$o,getClippingRect:Bre,getOffsetParent:LD,getElementRects:Hre,getClientRects:Lre,getDimensions:Ure,getScale:Dc,isElement:Bo,isRTL:Wre};function Gre(n,e){let t=null,r;const i=$o(n);function o(){clearTimeout(r),t&&t.disconnect(),t=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();const{left:c,top:d,width:u,height:h}=n.getBoundingClientRect();if(a||e(),!u||!h)return;const p=ty(d),g=ty(i.clientWidth-(c+u)),f=ty(i.clientHeight-(d+h)),w=ty(c),v={rootMargin:-p+"px "+-g+"px "+-f+"px "+-w+"px",threshold:_r(0,Ns(1,l))||1};let b=!0;function _(x){const E=x[0].intersectionRatio;if(E!==l){if(!b)return s();E?s(!1,E):r=setTimeout(()=>{s(!1,1e-7)},100)}b=!1}try{t=new IntersectionObserver(_,{...v,root:i.ownerDocument})}catch{t=new IntersectionObserver(_,v)}t.observe(n)}return s(!0),o}function Yre(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=hx(n),d=i||o?[...c?sy(c):[],...sy(e)]:[];d.forEach(v=>{i&&v.addEventListener("scroll",t,{passive:!0}),o&&v.addEventListener("resize",t)});const u=c&&a?Gre(c,t):null;let h=-1,p=null;s&&(p=new ResizeObserver(v=>{let[b]=v;b&&b.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{p&&p.observe(e)})),t()}),c&&!l&&p.observe(c),p.observe(e));let g,f=l?Na(n):null;l&&w();function w(){const v=Na(n);f&&(v.x!==f.x||v.y!==f.y||v.width!==f.width||v.height!==f.height)&&t(),f=v,g=requestAnimationFrame(w)}return t(),()=>{d.forEach(v=>{i&&v.removeEventListener("scroll",t),o&&v.removeEventListener("resize",t)}),u&&u(),p&&p.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const Xre=(n,e,t)=>{const r=new Map,i={platform:Kre,...t},o={...i.platform,_c:r};return _re(n,e,{...i,platform:o})},qre=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:i}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?kD({element:r.current,padding:i}).fn(t):{}:r?kD({element:r,padding:i}).fn(t):{}}}};var ay=typeof document<"u"?S.useLayoutEffect:S.useEffect;function ly(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!=e.length)return!1;for(r=t;r--!==0;)if(!ly(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const o=i[r];if(!(o==="_owner"&&n.$$typeof)&&!ly(n[o],e[o]))return!1}return!0}return n!==n&&e!==e}function zD(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function ND(n,e){const t=zD(n);return Math.round(e*t)/t}function FD(n){const e=S.useRef(n);return ay(()=>{e.current=n}),e}function Jre(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:c}=n,[d,u]=S.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=S.useState(r);ly(h,r)||p(r);const[g,f]=S.useState(null),[w,v]=S.useState(null),b=S.useCallback(B=>{B!=k.current&&(k.current=B,f(B))},[f]),_=S.useCallback(B=>{B!==P.current&&(P.current=B,v(B))},[v]),x=o||g,E=s||w,k=S.useRef(null),P=S.useRef(null),I=S.useRef(d),A=FD(l),T=FD(i),O=S.useCallback(()=>{if(!k.current||!P.current)return;const B={placement:e,strategy:t,middleware:h};T.current&&(B.platform=T.current),Xre(k.current,P.current,B).then(te=>{const W={...te,isPositioned:!0};F.current&&!ly(I.current,W)&&(I.current=W,Dl.flushSync(()=>{u(W)}))})},[h,e,t,T]);ay(()=>{c===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,u(B=>({...B,isPositioned:!1})))},[c]);const F=S.useRef(!1);ay(()=>(F.current=!0,()=>{F.current=!1}),[]),ay(()=>{if(x&&(k.current=x),E&&(P.current=E),x&&E){if(A.current)return A.current(x,E,O);O()}},[x,E,O,A]);const H=S.useMemo(()=>({reference:k,floating:P,setReference:b,setFloating:_}),[b,_]),D=S.useMemo(()=>({reference:x,floating:E}),[x,E]),K=S.useMemo(()=>{const B={position:t,left:0,top:0};if(!D.floating)return B;const te=ND(D.floating,d.x),W=ND(D.floating,d.y);return a?{...B,transform:"translate("+te+"px, "+W+"px)",...zD(D.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:te,top:W}},[t,a,D.floating,d.x,d.y]);return S.useMemo(()=>({...d,update:O,refs:H,elements:D,floatingStyles:K}),[d,O,H,D,K])}function $D(n){const[e,t]=S.useState(void 0);return Oa(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const o=i[0];let s,a;if("borderBoxSize"in o){const l=o.borderBoxSize,c=Array.isArray(l)?l[0]:l;s=c.inlineSize,a=c.blockSize}else s=n.offsetWidth,a=n.offsetHeight;t({width:s,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}const BD="Popper",[UD,cy]=Bi(BD),[Zre,VD]=UD(BD),Qre=n=>{const{__scopePopper:e,children:t}=n,[r,i]=S.useState(null);return S.createElement(Zre,{scope:e,anchor:r,onAnchorChange:i},t)},eie="PopperAnchor",tie=S.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...i}=n,o=VD(eie,t),s=S.useRef(null),a=Je(e,s);return S.useEffect(()=>{o.onAnchorChange((r==null?void 0:r.current)||s.current)}),r?null:S.createElement(Re.div,J({},i,{ref:a}))}),HD="PopperContent",[nie,Wbe]=UD(HD),rie=S.forwardRef((n,e)=>{var t,r,i,o,s,a,l,c;const{__scopePopper:d,side:u="bottom",sideOffset:h=0,align:p="center",alignOffset:g=0,arrowPadding:f=0,avoidCollisions:w=!0,collisionBoundary:v=[],collisionPadding:b=0,sticky:_="partial",hideWhenDetached:x=!1,updatePositionStrategy:E="optimized",onPlaced:k,...P}=n,I=VD(HD,d),[A,T]=S.useState(null),O=Je(e,Tt=>T(Tt)),[F,H]=S.useState(null),D=$D(F),K=(t=D==null?void 0:D.width)!==null&&t!==void 0?t:0,B=(r=D==null?void 0:D.height)!==null&&r!==void 0?r:0,te=u+(p!=="center"?"-"+p:""),W=typeof b=="number"?b:{top:0,right:0,bottom:0,left:0,...b},N=Array.isArray(v)?v:[v],Y=N.length>0,ee={padding:W,boundary:N.filter(iie),altBoundary:Y},{refs:pe,floatingStyles:ve,placement:be,isPositioned:fe,middlewareData:Ee}=Jre({strategy:"fixed",placement:te,whileElementsMounted:(...Tt)=>Yre(...Tt,{animationFrame:E==="always"}),elements:{reference:I.anchor},middleware:[Pre({mainAxis:h+B,alignmentAxis:g}),w&&Ire({mainAxis:!0,crossAxis:!1,limiter:_==="partial"?Mre():void 0,...ee}),w&&kre({...ee}),Are({...ee,apply:({elements:Tt,rects:qo,availableWidth:op,availableHeight:Vk})=>{const{width:Hk,height:Wk}=qo.reference,ad=Tt.floating.style;ad.setProperty("--radix-popper-available-width",`${op}px`),ad.setProperty("--radix-popper-available-height",`${Vk}px`),ad.setProperty("--radix-popper-anchor-width",`${Hk}px`),ad.setProperty("--radix-popper-anchor-height",`${Wk}px`)}}),F&&qre({element:F,padding:f}),oie({arrowWidth:K,arrowHeight:B}),x&&Cre({strategy:"referenceHidden",...ee})]}),[zt,We]=WD(be),Fe=It(k);Oa(()=>{fe&&(Fe==null||Fe())},[fe,Fe]);const Ke=(i=Ee.arrow)===null||i===void 0?void 0:i.x,ki=(o=Ee.arrow)===null||o===void 0?void 0:o.y,or=((s=Ee.arrow)===null||s===void 0?void 0:s.centerOffset)!==0,[Mr,Nt]=S.useState();return Oa(()=>{A&&Nt(window.getComputedStyle(A).zIndex)},[A]),S.createElement("div",{ref:pe.setFloating,"data-radix-popper-content-wrapper":"",style:{...ve,transform:fe?ve.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Mr,"--radix-popper-transform-origin":[(a=Ee.transformOrigin)===null||a===void 0?void 0:a.x,(l=Ee.transformOrigin)===null||l===void 0?void 0:l.y].join(" ")},dir:n.dir},S.createElement(nie,{scope:d,placedSide:zt,onArrowChange:H,arrowX:Ke,arrowY:ki,shouldHideArrow:or},S.createElement(Re.div,J({"data-side":zt,"data-align":We},P,{ref:O,style:{...P.style,animation:fe?void 0:"none",opacity:(c=Ee.hide)!==null&&c!==void 0&&c.referenceHidden?0:void 0}}))))});function iie(n){return n!==null}const oie=n=>({name:"transformOrigin",options:n,fn(e){var t,r,i,o,s;const{placement:a,rects:l,middlewareData:c}=e,d=((t=c.arrow)===null||t===void 0?void 0:t.centerOffset)!==0,u=d?0:n.arrowWidth,h=d?0:n.arrowHeight,[p,g]=WD(a),f={start:"0%",center:"50%",end:"100%"}[g],w=((r=(i=c.arrow)===null||i===void 0?void 0:i.x)!==null&&r!==void 0?r:0)+u/2,v=((o=(s=c.arrow)===null||s===void 0?void 0:s.y)!==null&&o!==void 0?o:0)+h/2;let b="",_="";return p==="bottom"?(b=d?f:`${w}px`,_=`${-h}px`):p==="top"?(b=d?f:`${w}px`,_=`${l.floating.height+h}px`):p==="right"?(b=`${-h}px`,_=d?f:`${v}px`):p==="left"&&(b=`${l.floating.width+h}px`,_=d?f:`${v}px`),{data:{x:b,y:_}}}});function WD(n){const[e,t="center"]=n.split("-");return[e,t]}const px=Qre,KD=tie,GD=rie,sie=S.forwardRef((n,e)=>{var t;const{container:r=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...i}=n;return r?Ef.createPortal(S.createElement(Re.div,J({},i,{ref:e})),r):null}),fx="rovingFocusGroup.onEntryFocus",aie={bubbles:!1,cancelable:!0},gx="RovingFocusGroup",[mx,YD,lie]=jm(gx),[cie,XD]=Bi(gx,[lie]),[die,uie]=cie(gx),hie=S.forwardRef((n,e)=>S.createElement(mx.Provider,{scope:n.__scopeRovingFocusGroup},S.createElement(mx.Slot,{scope:n.__scopeRovingFocusGroup},S.createElement(pie,J({},n,{ref:e}))))),pie=S.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,...d}=n,u=S.useRef(null),h=Je(e,u),p=rx(o),[g=null,f]=Ls({prop:s,defaultProp:a,onChange:l}),[w,v]=S.useState(!1),b=It(c),_=YD(t),x=S.useRef(!1),[E,k]=S.useState(0);return S.useEffect(()=>{const P=u.current;if(P)return P.addEventListener(fx,b),()=>P.removeEventListener(fx,b)},[b]),S.createElement(die,{scope:t,orientation:r,dir:p,loop:i,currentTabStopId:g,onItemFocus:S.useCallback(P=>f(P),[f]),onItemShiftTab:S.useCallback(()=>v(!0),[]),onFocusableItemAdd:S.useCallback(()=>k(P=>P+1),[]),onFocusableItemRemove:S.useCallback(()=>k(P=>P-1),[])},S.createElement(Re.div,J({tabIndex:w||E===0?-1:0,"data-orientation":r},d,{ref:h,style:{outline:"none",...n.style},onMouseDown:ne(n.onMouseDown,()=>{x.current=!0}),onFocus:ne(n.onFocus,P=>{const I=!x.current;if(P.target===P.currentTarget&&I&&!w){const A=new CustomEvent(fx,aie);if(P.currentTarget.dispatchEvent(A),!A.defaultPrevented){const T=_().filter(D=>D.focusable),O=T.find(D=>D.active),F=T.find(D=>D.id===g),H=[O,F,...T].filter(Boolean).map(D=>D.ref.current);qD(H)}}x.current=!1}),onBlur:ne(n.onBlur,()=>v(!1))})))}),fie="RovingFocusGroupItem",gie=S.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:i=!1,tabStopId:o,...s}=n,a=Lo(),l=o||a,c=uie(fie,t),d=c.currentTabStopId===l,u=YD(t),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return S.useEffect(()=>{if(r)return h(),()=>p()},[r,h,p]),S.createElement(mx.ItemSlot,{scope:t,id:l,focusable:r,active:i},S.createElement(Re.span,J({tabIndex:d?0:-1,"data-orientation":c.orientation},s,{ref:e,onMouseDown:ne(n.onMouseDown,g=>{r?c.onItemFocus(l):g.preventDefault()}),onFocus:ne(n.onFocus,()=>c.onItemFocus(l)),onKeyDown:ne(n.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){c.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const f=wie(g,c.orientation,c.dir);if(f!==void 0){g.preventDefault();let w=u().filter(v=>v.focusable).map(v=>v.ref.current);if(f==="last")w.reverse();else if(f==="prev"||f==="next"){f==="prev"&&w.reverse();const v=w.indexOf(g.currentTarget);w=c.loop?bie(w,v+1):w.slice(v+1)}setTimeout(()=>qD(w))}})})))}),mie={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function yie(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function wie(n,e,t){const r=yie(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return mie[r]}function qD(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function bie(n,e){return n.map((t,r)=>n[(e+r)%n.length])}const vie=hie,Sie=gie,yx=["Enter"," "],xie=["ArrowDown","PageUp","Home"],JD=["ArrowUp","PageDown","End"],_ie=[...xie,...JD],kie={ltr:[...yx,"ArrowRight"],rtl:[...yx,"ArrowLeft"]},Cie={ltr:["ArrowLeft"],rtl:["ArrowRight"]},dy="Menu",[oh,Eie,Pie]=jm(dy),[Fa,uy]=Bi(dy,[Pie,cy,XD]),hy=cy(),ZD=XD(),[QD,Bs]=Fa(dy),[Iie,sh]=Fa(dy),Mie=n=>{const{__scopeMenu:e,open:t=!1,children:r,dir:i,onOpenChange:o,modal:s=!0}=n,a=hy(e),[l,c]=S.useState(null),d=S.useRef(!1),u=It(o),h=rx(i);return S.useEffect(()=>{const p=()=>{d.current=!0,document.addEventListener("pointerdown",g,{capture:!0,once:!0}),document.addEventListener("pointermove",g,{capture:!0,once:!0})},g=()=>d.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",g,{capture:!0}),document.removeEventListener("pointermove",g,{capture:!0})}},[]),S.createElement(px,a,S.createElement(QD,{scope:e,open:t,onOpenChange:u,content:l,onContentChange:c},S.createElement(Iie,{scope:e,onClose:S.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:h,modal:s},r)))},e4=S.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=hy(t);return S.createElement(KD,J({},i,r,{ref:e}))}),t4="MenuPortal",[Aie,n4]=Fa(t4,{forceMount:void 0}),Tie=n=>{const{__scopeMenu:e,forceMount:t,children:r,container:i}=n,o=Bs(t4,e);return S.createElement(Aie,{scope:e,forceMount:t},S.createElement(fi,{present:t||o.open},S.createElement(sie,{asChild:!0,container:i},r)))},gi="MenuContent",[jie,wx]=Fa(gi),Rie=S.forwardRef((n,e)=>{const t=n4(gi,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,o=Bs(gi,n.__scopeMenu),s=sh(gi,n.__scopeMenu);return S.createElement(oh.Provider,{scope:n.__scopeMenu},S.createElement(fi,{present:r||o.open},S.createElement(oh.Slot,{scope:n.__scopeMenu},s.modal?S.createElement(Die,J({},i,{ref:e})):S.createElement(Oie,J({},i,{ref:e})))))}),Die=S.forwardRef((n,e)=>{const t=Bs(gi,n.__scopeMenu),r=S.useRef(null),i=Je(e,r);return S.useEffect(()=>{const o=r.current;if(o)return US(o)},[]),S.createElement(bx,J({},n,{ref:i,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:ne(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)}))}),Oie=S.forwardRef((n,e)=>{const t=Bs(gi,n.__scopeMenu);return S.createElement(bx,J({},n,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)}))}),bx=S.forwardRef((n,e)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,disableOutsideScroll:g,...f}=n,w=Bs(gi,t),v=sh(gi,t),b=hy(t),_=ZD(t),x=Eie(t),[E,k]=S.useState(null),P=S.useRef(null),I=Je(e,P,w.onContentChange),A=S.useRef(0),T=S.useRef(""),O=S.useRef(0),F=S.useRef(null),H=S.useRef("right"),D=S.useRef(0),K=g?$S:S.Fragment,B=g?{as:Da,allowPinchZoom:!0}:void 0,te=N=>{var Y,ee;const pe=T.current+N,ve=x().filter(Fe=>!Fe.disabled),be=document.activeElement,fe=(Y=ve.find(Fe=>Fe.ref.current===be))===null||Y===void 0?void 0:Y.textValue,Ee=ve.map(Fe=>Fe.textValue),zt=Yie(Ee,pe,fe),We=(ee=ve.find(Fe=>Fe.textValue===zt))===null||ee===void 0?void 0:ee.ref.current;(function Fe(Ke){T.current=Ke,window.clearTimeout(A.current),Ke!==""&&(A.current=window.setTimeout(()=>Fe(""),1e3))})(pe),We&&setTimeout(()=>We.focus())};S.useEffect(()=>()=>window.clearTimeout(A.current),[]),LS();const W=S.useCallback(N=>{var Y,ee;return H.current===((Y=F.current)===null||Y===void 0?void 0:Y.side)&&qie(N,(ee=F.current)===null||ee===void 0?void 0:ee.area)},[]);return S.createElement(jie,{scope:t,searchRef:T,onItemEnter:S.useCallback(N=>{W(N)&&N.preventDefault()},[W]),onItemLeave:S.useCallback(N=>{var Y;W(N)||((Y=P.current)===null||Y===void 0||Y.focus(),k(null))},[W]),onTriggerLeave:S.useCallback(N=>{W(N)&&N.preventDefault()},[W]),pointerGraceTimerRef:O,onPointerGraceIntentChange:S.useCallback(N=>{F.current=N},[])},S.createElement(K,B,S.createElement(DS,{asChild:!0,trapped:i,onMountAutoFocus:ne(o,N=>{var Y;N.preventDefault(),(Y=P.current)===null||Y===void 0||Y.focus()}),onUnmountAutoFocus:s},S.createElement(hre,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p},S.createElement(vie,J({asChild:!0},_,{dir:v.dir,orientation:"vertical",loop:r,currentTabStopId:E,onCurrentTabStopIdChange:k,onEntryFocus:ne(l,N=>{v.isUsingKeyboardRef.current||N.preventDefault()})}),S.createElement(GD,J({role:"menu","aria-orientation":"vertical","data-state":c4(w.open),"data-radix-menu-content":"",dir:v.dir},b,f,{ref:I,style:{outline:"none",...f.style},onKeyDown:ne(f.onKeyDown,N=>{const Y=N.target.closest("[data-radix-menu-content]")===N.currentTarget,ee=N.ctrlKey||N.altKey||N.metaKey,pe=N.key.length===1;Y&&(N.key==="Tab"&&N.preventDefault(),!ee&&pe&&te(N.key));const ve=P.current;if(N.target!==ve||!_ie.includes(N.key))return;N.preventDefault();const be=x().filter(fe=>!fe.disabled).map(fe=>fe.ref.current);JD.includes(N.key)&&be.reverse(),Kie(be)}),onBlur:ne(n.onBlur,N=>{N.currentTarget.contains(N.target)||(window.clearTimeout(A.current),T.current="")}),onPointerMove:ne(n.onPointerMove,ah(N=>{const Y=N.target,ee=D.current!==N.clientX;if(N.currentTarget.contains(Y)&&ee){const pe=N.clientX>D.current?"right":"left";H.current=pe,D.current=N.clientX}}))})))))))}),Lie=S.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return S.createElement(Re.div,J({role:"group"},r,{ref:e}))}),vx="MenuItem",r4="menu.itemSelect",i4=S.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:r,...i}=n,o=S.useRef(null),s=sh(vx,n.__scopeMenu),a=wx(vx,n.__scopeMenu),l=Je(e,o),c=S.useRef(!1),d=()=>{const u=o.current;if(!t&&u){const h=new CustomEvent(r4,{bubbles:!0,cancelable:!0});u.addEventListener(r4,p=>r==null?void 0:r(p),{once:!0}),Cc(u,h),h.defaultPrevented?c.current=!1:s.onClose()}};return S.createElement(o4,J({},i,{ref:l,disabled:t,onClick:ne(n.onClick,d),onPointerDown:u=>{var h;(h=n.onPointerDown)===null||h===void 0||h.call(n,u),c.current=!0},onPointerUp:ne(n.onPointerUp,u=>{var h;c.current||(h=u.currentTarget)===null||h===void 0||h.click()}),onKeyDown:ne(n.onKeyDown,u=>{const h=a.searchRef.current!=="";t||h&&u.key===" "||yx.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})}))}),o4=S.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:r=!1,textValue:i,...o}=n,s=wx(vx,t),a=ZD(t),l=S.useRef(null),c=Je(e,l),[d,u]=S.useState(!1),[h,p]=S.useState("");return S.useEffect(()=>{const g=l.current;if(g){var f;p(((f=g.textContent)!==null&&f!==void 0?f:"").trim())}},[o.children]),S.createElement(oh.ItemSlot,{scope:t,disabled:r,textValue:i??h},S.createElement(Sie,J({asChild:!0},a,{focusable:!r}),S.createElement(Re.div,J({role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0},o,{ref:c,onPointerMove:ne(n.onPointerMove,ah(g=>{r?s.onItemLeave(g):(s.onItemEnter(g),g.defaultPrevented||g.currentTarget.focus())})),onPointerLeave:ne(n.onPointerLeave,ah(g=>s.onItemLeave(g))),onFocus:ne(n.onFocus,()=>u(!0)),onBlur:ne(n.onBlur,()=>u(!1))}))))}),zie=S.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:r,...i}=n;return S.createElement(Nie,{scope:n.__scopeMenu,checked:t},S.createElement(i4,J({role:"menuitemcheckbox","aria-checked":fy(t)?"mixed":t},i,{ref:e,"data-state":d4(t),onSelect:ne(i.onSelect,()=>r==null?void 0:r(fy(t)?!0:!t),{checkForDefaultPrevented:!1})})))});Fa("MenuRadioGroup",{value:void 0,onValueChange:()=>{}});const s4="MenuItemIndicator",[Nie,Fie]=Fa(s4,{checked:!1}),$ie=S.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:r,...i}=n,o=Fie(s4,t);return S.createElement(fi,{present:r||fy(o.checked)||o.checked===!0},S.createElement(Re.span,J({},i,{ref:e,"data-state":d4(o.checked)})))}),a4="MenuSub",[Bie,l4]=Fa(a4),Uie=n=>{const{__scopeMenu:e,children:t,open:r=!1,onOpenChange:i}=n,o=Bs(a4,e),s=hy(e),[a,l]=S.useState(null),[c,d]=S.useState(null),u=It(i);return S.useEffect(()=>(o.open===!1&&u(!1),()=>u(!1)),[o.open,u]),S.createElement(px,s,S.createElement(QD,{scope:e,open:r,onOpenChange:u,content:c,onContentChange:d},S.createElement(Bie,{scope:e,contentId:Lo(),triggerId:Lo(),trigger:a,onTriggerChange:l},t)))},py="MenuSubTrigger",Vie=S.forwardRef((n,e)=>{const t=Bs(py,n.__scopeMenu),r=sh(py,n.__scopeMenu),i=l4(py,n.__scopeMenu),o=wx(py,n.__scopeMenu),s=S.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,c={__scopeMenu:n.__scopeMenu},d=S.useCallback(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return S.useEffect(()=>d,[d]),S.useEffect(()=>{const u=a.current;return()=>{window.clearTimeout(u),l(null)}},[a,l]),S.createElement(e4,J({asChild:!0},c),S.createElement(o4,J({id:i.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":i.contentId,"data-state":c4(t.open)},n,{ref:Tm(e,i.onTriggerChange),onClick:u=>{var h;(h=n.onClick)===null||h===void 0||h.call(n,u),!(n.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:ne(n.onPointerMove,ah(u=>{o.onItemEnter(u),!u.defaultPrevented&&!n.disabled&&!t.open&&!s.current&&(o.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{t.onOpenChange(!0),d()},100))})),onPointerLeave:ne(n.onPointerLeave,ah(u=>{var h;d();const p=(h=t.content)===null||h===void 0?void 0:h.getBoundingClientRect();if(p){var g;const f=(g=t.content)===null||g===void 0?void 0:g.dataset.side,w=f==="right",v=w?-5:5,b=p[w?"left":"right"],_=p[w?"right":"left"];o.onPointerGraceIntentChange({area:[{x:u.clientX+v,y:u.clientY},{x:b,y:p.top},{x:_,y:p.top},{x:_,y:p.bottom},{x:b,y:p.bottom}],side:f}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(u),u.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:ne(n.onKeyDown,u=>{const h=o.searchRef.current!=="";if(!(n.disabled||h&&u.key===" ")&&kie[r.dir].includes(u.key)){var p;t.onOpenChange(!0),(p=t.content)===null||p===void 0||p.focus(),u.preventDefault()}})})))}),Hie="MenuSubContent",Wie=S.forwardRef((n,e)=>{const t=n4(gi,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,o=Bs(gi,n.__scopeMenu),s=sh(gi,n.__scopeMenu),a=l4(Hie,n.__scopeMenu),l=S.useRef(null),c=Je(e,l);return S.createElement(oh.Provider,{scope:n.__scopeMenu},S.createElement(fi,{present:r||o.open},S.createElement(oh.Slot,{scope:n.__scopeMenu},S.createElement(bx,J({id:a.contentId,"aria-labelledby":a.triggerId},i,{ref:c,align:"start",side:s.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var u;s.isUsingKeyboardRef.current&&((u=l.current)===null||u===void 0||u.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:ne(n.onFocusOutside,d=>{d.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:ne(n.onEscapeKeyDown,d=>{s.onClose(),d.preventDefault()}),onKeyDown:ne(n.onKeyDown,d=>{const u=d.currentTarget.contains(d.target),h=Cie[s.dir].includes(d.key);if(u&&h){var p;o.onOpenChange(!1),(p=a.trigger)===null||p===void 0||p.focus(),d.preventDefault()}})})))))});function c4(n){return n?"open":"closed"}function fy(n){return n==="indeterminate"}function d4(n){return fy(n)?"indeterminate":n?"checked":"unchecked"}function Kie(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function Gie(n,e){return n.map((t,r)=>n[(e+r)%n.length])}function Yie(n,e,t){const r=e.length>1&&Array.from(e).every(a=>a===e[0])?e[0]:e,i=t?n.indexOf(t):-1;let o=Gie(n,Math.max(i,0));r.length===1&&(o=o.filter(a=>a!==t));const s=o.find(a=>a.toLowerCase().startsWith(r.toLowerCase()));return s!==t?s:void 0}function Xie(n,e){const{x:t,y:r}=n;let i=!1;for(let o=0,s=e.length-1;o<e.length;s=o++){const a=e[o].x,l=e[o].y,c=e[s].x,d=e[s].y;l>r!=d>r&&t<(c-a)*(r-l)/(d-l)+a&&(i=!i)}return i}function qie(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return Xie(t,e)}function ah(n){return e=>e.pointerType==="mouse"?n(e):void 0}const u4=Mie,h4=e4,p4=Tie,f4=Rie,g4=Lie,m4=i4,y4=zie,Jie=$ie,w4=Uie,b4=Vie,v4=Wie,S4="DropdownMenu",[Zie,Gbe]=Bi(S4,[uy]),mi=uy(),[Qie,x4]=Zie(S4),eoe=n=>{const{__scopeDropdownMenu:e,children:t,dir:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=n,l=mi(e),c=S.useRef(null),[d=!1,u]=Ls({prop:i,defaultProp:o,onChange:s});return S.createElement(Qie,{scope:e,triggerId:Lo(),triggerRef:c,contentId:Lo(),open:d,onOpenChange:u,onOpenToggle:S.useCallback(()=>u(h=>!h),[u]),modal:a},S.createElement(u4,J({},l,{open:d,onOpenChange:u,dir:r,modal:a}),t))},toe="DropdownMenuTrigger",noe=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...i}=n,o=x4(toe,t),s=mi(t);return S.createElement(h4,J({asChild:!0},s),S.createElement(Re.button,J({type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r},i,{ref:Tm(e,o.triggerRef),onPointerDown:ne(n.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(o.onOpenToggle(),o.open||a.preventDefault())}),onKeyDown:ne(n.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&o.onOpenToggle(),a.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})))}),roe=n=>{const{__scopeDropdownMenu:e,...t}=n,r=mi(e);return S.createElement(p4,J({},r,t))},ioe="DropdownMenuContent",ooe=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=x4(ioe,t),o=mi(t),s=S.useRef(!1);return S.createElement(f4,J({id:i.contentId,"aria-labelledby":i.triggerId},o,r,{ref:e,onCloseAutoFocus:ne(n.onCloseAutoFocus,a=>{var l;s.current||(l=i.triggerRef.current)===null||l===void 0||l.focus(),s.current=!1,a.preventDefault()}),onInteractOutside:ne(n.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;(!i.modal||d)&&(s.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),soe=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=mi(t);return S.createElement(g4,J({},i,r,{ref:e}))}),aoe=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=mi(t);return S.createElement(m4,J({},i,r,{ref:e}))}),loe=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=mi(t);return S.createElement(y4,J({},i,r,{ref:e}))}),coe=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=mi(t);return S.createElement(Jie,J({},i,r,{ref:e}))}),doe=n=>{const{__scopeDropdownMenu:e,children:t,open:r,onOpenChange:i,defaultOpen:o}=n,s=mi(e),[a=!1,l]=Ls({prop:r,defaultProp:o,onChange:i});return S.createElement(w4,J({},s,{open:a,onOpenChange:l}),t)},uoe=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=mi(t);return S.createElement(b4,J({},i,r,{ref:e}))}),hoe=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=mi(t);return S.createElement(v4,J({},i,r,{ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),_4=eoe,lh=noe,Sx=roe,k4=ooe,poe=soe,Oc=aoe,C4=loe,foe=coe,goe=doe,moe=uoe,yoe=hoe;function $a(n,e){const t=G(),r=S.useRef(!1),i=Ac(),o=S.useRef(0),s=S.useCallback(l=>{const c=Date.now();c-o.current<50||(o.current=c,r.current=l,t.batch(()=>{l?(t.complete(),t.addOpenMenu(n)):t.updateInstanceState({openMenus:t.getOpenMenus().filter(d=>!d.startsWith(n))}),e==null||e(l)}))},[t,n,e]),a=q("is menu open",()=>t.getOpenMenus().includes(n),[t,n]);return S.useEffect(()=>(r.current&&(i("open-menu",{source:"unknown",id:n}),t.addOpenMenu(n)),()=>{r.current&&(t.deleteOpenMenu(n),t.getOpenMenus().forEach(l=>{l.startsWith(n)&&(i("close-menu",{source:"unknown",id:n}),t.deleteOpenMenu(l))}),r.current=!1)}),[t,n,i]),[a,s]}function Us({id:n,children:e,modal:t=!1,debugOpen:r=!1}){const[i,o]=$a(n);return m.jsx(_4,{open:r||i,dir:"ltr",modal:t,onOpenChange:o,children:e})}function ch({children:n,"data-testid":e}){return m.jsx(lh,{dir:"ltr","data-testid":e,asChild:!0,onTouchEnd:t=>ze(t),children:n})}function Vs({side:n="bottom",align:e="start",sideOffset:t=8,alignOffset:r=8,children:i}){const o=xn();return m.jsx(Sx,{container:o,children:m.jsx(k4,{className:"tlui-menu",align:e,sideOffset:t,side:n,alignOffset:r,collisionPadding:4,children:i})})}function xx({id:n,children:e}){const[t,r]=$a(n);return m.jsx(goe,{open:t,onOpenChange:r,children:e})}function _x({label:n,"data-testid":e,"data-direction":t}){return m.jsx(moe,{dir:"ltr","data-direction":t,"data-testid":e,asChild:!0,children:m.jsx(le,{type:"menu",className:"tlui-menu__submenu__trigger",label:n,icon:"chevron-right"})})}function kx({alignOffset:n=0,sideOffset:e=5,children:t}){const r=xn();return m.jsx(Sx,{container:r,children:m.jsx(yoe,{className:"tlui-menu tlui-menu__submenu__content",alignOffset:n,sideOffset:e,collisionPadding:4,children:t})})}function Uo({children:n,size:e="medium"}){return m.jsx(poe,{dir:"ltr",className:"tlui-menu__group","data-size":e,children:n})}function Cr({noClose:n,...e}){return m.jsx(Oc,{dir:"ltr",asChild:!0,onClick:n||e.isChecked!==void 0?ze:void 0,children:m.jsx(le,{...e})})}function E4({children:n,onSelect:e,...t}){return m.jsxs(C4,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:r=>{e==null||e(r),ze(r)},...t,children:[m.jsx(xr,{small:!0,icon:t.checked?"check":"checkbox-empty"}),n]})}function woe({children:n,onSelect:e,...t}){return m.jsxs(C4,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:r=>{e==null||e(r),ze(r)},...t,children:[m.jsx("div",{className:"tlui-button__checkbox__indicator",children:m.jsx(foe,{dir:"ltr",children:m.jsx(xr,{icon:"check",small:!0})})}),n]})}let P4=0;function boe(n,e){const t=Array(e),r=Math.floor(Math.sqrt(e));for(let i=0;i<e;i++)P4++,t[i]={id:ot("box"+P4),type:"geo",x:i%r*132,y:Math.floor(i/r)*132};n.batch(()=>{n.createShapes(t).setSelectedShapes(t.map(i=>i.id))})}const voe=S.memo(function({renderDebugMenuItems:n}){const e=Ae();return m.jsxs("div",{className:"tlui-debug-panel",children:[m.jsx(Soe,{}),m.jsx(xoe,{}),m.jsxs(Us,{id:"debug",children:[m.jsx(ch,{children:m.jsx(le,{type:"icon",icon:"dots-horizontal",title:e("debug-panel.more")})}),m.jsx(Vs,{side:"top",align:"end",alignOffset:0,children:m.jsx(_oe,{renderDebugMenuItems:n})})]})]})}),Soe=$e(function(){const n=G();return m.jsx("div",{className:"tlui-debug-panel__current-state",children:n.getPath()})}),xoe=function(){const n=G(),e=q("rendering shapes count",()=>n.getRenderingShapes().length,[n]);return m.jsxs("div",{children:[e," Shapes"]})},_oe=$e(function({renderDebugMenuItems:n}){const e=G(),{addToast:t}=Hi(),{addDialog:r}=za(),[i,o]=S.useState(!1);return m.jsxs(m.Fragment,{children:[m.jsxs(Uo,{children:[m.jsx(Cr,{type:"menu",onClick:()=>{t({id:et(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0}),t({id:et(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:et(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,icon:"twitter",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]})},label:"Show toast"}),m.jsx(Cr,{type:"menu",onClick:()=>{r({component:({onClose:s})=>m.jsx(Coe,{displayDontShowAgain:!0,onCancel:()=>{s()},onContinue:()=>{s()}}),onClose:()=>{}})},label:"Show dialog"}),m.jsx(Cr,{type:"menu",onClick:()=>boe(e,100),label:"Create 100 shapes"}),m.jsx(Cr,{type:"menu",onClick:()=>{function s({children:u}){let h=0;if(!u.length)return 0;for(const p of[...u])h++,h+=s(p);return h}const a=e.getSelectedShapes(),l=a.length===0?e.getRenderingShapes():a,c=l.map(u=>document.getElementById(u.id).parentElement);let d=c.length;for(const u of c)d+=s(u);window.alert(`Shapes ${l.length}, DOM nodes:${d}`)},label:"Count shapes / nodes"}),(()=>{if(i)throw Error("oh no!")})(),m.jsx(Cr,{type:"menu",onClick:()=>{o(!0)},label:"Throw error"}),m.jsx(Cr,{type:"menu",onClick:()=>{MI()},label:"Hard reset"})]}),m.jsxs(Uo,{children:[m.jsx(dh,{flag:st.debugSvg}),m.jsx(dh,{flag:st.forceSrgb}),m.jsx(dh,{flag:st.debugGeometry}),m.jsx(dh,{flag:st.hideShapes})]}),m.jsx(Uo,{children:Object.values(GF).map(s=>m.jsx(dh,{flag:s},s.name))}),n==null?void 0:n()]})});function koe({label:n,value:e,onChange:t}){return m.jsx(E4,{title:n,checked:e,onSelect:()=>t(!e),children:m.jsx("span",{className:"tlui-button__label",draggable:!1,children:n})})}const dh=$e(function({flag:n,onChange:e}){return m.jsx(koe,{label:n.name.replace(/([a-z0-9])([A-Z])/g,t=>`${t[0]} ${t[1].toLowerCase()}`).replace(/^[a-z]/,t=>t.toUpperCase()),value:n.get(),onChange:t=>{n.set(t),e==null||e(t)}})});function Coe({title:n="title",body:e="hello hello hello",cancel:t="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:o,onContinue:s}){const[a,l]=S.useState(!1);return m.jsxs(m.Fragment,{children:[m.jsxs(Km,{children:[m.jsx(Gm,{children:n}),m.jsx(Ym,{})]}),m.jsx(th,{style:{maxWidth:350},children:e}),m.jsxs(HS,{className:"tlui-dialog__footer__actions",children:[i&&m.jsx(le,{type:"normal",onClick:()=>l(!a),iconLeft:a?"check":"checkbox-empty",style:{marginRight:"auto"},children:"Don't show again"}),m.jsx(le,{type:"normal",onClick:o,children:t}),m.jsx(le,{type:"primary",onClick:async()=>s(),children:r})]})]})}const Eoe=({id:n,component:e,onClose:t})=>{const{removeDialog:r}=za(),i=xn(),o=S.useCallback(s=>{if(!s){if(t)try{t()}catch(a){console.warn(a)}r(n)}},[n,t,r]);return m.jsx(Zte,{onOpenChange:o,defaultOpen:!0,children:m.jsx(Qte,{container:i,children:m.jsx(ene,{dir:"ltr",className:"tlui-dialog__overlay",children:m.jsx(tne,{dir:"ltr",className:"tlui-dialog__content",children:m.jsx(e,{onClose:()=>o(!1)})})})})})};function Poe(){const{dialogs:n}=za();return m.jsx(m.Fragment,{children:n.map(e=>m.jsx(Eoe,{...e},e.id))})}const Ioe=re.memo(Poe);function Moe(){const n=G(),e=q("follow",()=>n.getInstanceState().followingUserId,[n]);return e?m.jsx(Aoe,{userId:e}):null}function Aoe({userId:n}){const e=pM(n);return e?m.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}function I4(){const n=G(),{languages:e,currentLanguage:t}=hD(),r=S.useCallback(i=>n.user.updateUserPreferences({locale:i}),[n]);return m.jsxs(xx,{id:"help menu language",children:[m.jsx(_x,{label:"menu.language","data-direction":"left"}),m.jsx(kx,{sideOffset:-4,children:m.jsx(Uo,{children:e.map(({locale:i,label:o})=>m.jsx(woe,{title:i,checked:i===t,onSelect:()=>r(i),children:m.jsx("span",{className:"tlui-button__label",children:o})},i))})})]})}const Toe=S.memo(function(){const n=xn(),e=Ae(),[t,r]=$a("help menu");return m.jsx("div",{className:"tlui-help-menu",children:m.jsxs(_4,{dir:"ltr",open:t,onOpenChange:r,modal:!1,children:[m.jsx(lh,{asChild:!0,dir:"ltr",children:m.jsx(le,{type:"help",className:"tlui-button",smallIcon:!0,title:e("help-menu.title"),icon:"question-mark"})}),m.jsx(Sx,{container:n,children:m.jsx(k4,{className:"tlui-menu",side:"top",sideOffset:8,align:"end",alignOffset:0,collisionPadding:4,children:m.jsx(joe,{})})})]})})});function joe(){const n=qne(),e=Br();function t(r){if(!r||e&&!r.readonlyOk)return null;switch(r.type){case"custom":{if(r.id==="LANGUAGE_MENU")return m.jsx(I4,{},"item");break}case"group":return m.jsx(Uo,{size:"small",children:r.children.map(t)},r.id);case"submenu":return m.jsxs(xx,{id:`help menu ${r.id}`,children:[m.jsx(_x,{label:r.label}),m.jsx(kx,{children:r.children.map(t)})]},r.id);case"item":{const{id:i,kbd:o,label:s,onSelect:a,icon:l}=r.actionItem;return m.jsx(Cr,{type:"menu",kbd:o,label:s,onClick:()=>a("help-menu"),iconLeft:l},i)}}}return m.jsx(m.Fragment,{children:n.map(t)})}const Cx="dismissableLayer.update",Roe="dismissableLayer.pointerDownOutside",Doe="dismissableLayer.focusOutside";let M4;const Ooe=S.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Loe=S.forwardRef((n,e)=>{var t;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...c}=n,d=S.useContext(Ooe),[u,h]=S.useState(null),p=(t=u==null?void 0:u.ownerDocument)!==null&&t!==void 0?t:globalThis==null?void 0:globalThis.document,[,g]=S.useState({}),f=Je(e,I=>h(I)),w=Array.from(d.layers),[v]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),b=w.indexOf(v),_=u?w.indexOf(u):-1,x=d.layersWithOutsidePointerEventsDisabled.size>0,E=_>=b,k=zoe(I=>{const A=I.target,T=[...d.branches].some(O=>O.contains(A));!E||T||(o==null||o(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p),P=Noe(I=>{const A=I.target;[...d.branches].some(T=>T.contains(A))||(s==null||s(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p);return Rm(I=>{_===d.layers.size-1&&(i==null||i(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},p),S.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(M4=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),A4(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=M4)}},[u,p,r,d]),S.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),A4())},[u,d]),S.useEffect(()=>{const I=()=>g({});return document.addEventListener(Cx,I),()=>document.removeEventListener(Cx,I)},[]),S.createElement(Re.div,J({},c,{ref:f,style:{pointerEvents:x?E?"auto":"none":void 0,...n.style},onFocusCapture:ne(n.onFocusCapture,P.onFocusCapture),onBlurCapture:ne(n.onBlurCapture,P.onBlurCapture),onPointerDownCapture:ne(n.onPointerDownCapture,k.onPointerDownCapture)}))});function zoe(n,e=globalThis==null?void 0:globalThis.document){const t=It(n),r=S.useRef(!1),i=S.useRef(()=>{});return S.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){T4(Roe,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function Noe(n,e=globalThis==null?void 0:globalThis.document){const t=It(n),r=S.useRef(!1);return S.useEffect(()=>{const i=o=>{o.target&&!r.current&&T4(Doe,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function A4(){const n=new CustomEvent(Cx);document.dispatchEvent(n)}function T4(n,e,t,{discrete:r}){const i=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?Cc(i,o):i.dispatchEvent(o)}const Foe=S.forwardRef((n,e)=>{var t;const{container:r=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...i}=n;return r?Ef.createPortal(S.createElement(Re.div,J({},i,{ref:e})),r):null}),j4="Popover",[R4,Ybe]=Bi(j4,[cy]),Ex=cy(),[$oe,Lc]=R4(j4),Boe=n=>{const{__scopePopover:e,children:t,open:r,defaultOpen:i,onOpenChange:o,modal:s=!1}=n,a=Ex(e),l=S.useRef(null),[c,d]=S.useState(!1),[u=!1,h]=Ls({prop:r,defaultProp:i,onChange:o});return S.createElement(px,a,S.createElement($oe,{scope:e,contentId:Lo(),triggerRef:l,open:u,onOpenChange:h,onOpenToggle:S.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:c,onCustomAnchorAdd:S.useCallback(()=>d(!0),[]),onCustomAnchorRemove:S.useCallback(()=>d(!1),[]),modal:s},t))},Uoe="PopoverTrigger",Voe=S.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Lc(Uoe,t),o=Ex(t),s=Je(e,i.triggerRef),a=S.createElement(Re.button,J({type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":L4(i.open)},r,{ref:s,onClick:ne(n.onClick,i.onOpenToggle)}));return i.hasCustomAnchor?a:S.createElement(KD,J({asChild:!0},o),a)}),D4="PopoverPortal",[Hoe,Woe]=R4(D4,{forceMount:void 0}),Koe=n=>{const{__scopePopover:e,forceMount:t,children:r,container:i}=n,o=Lc(D4,e);return S.createElement(Hoe,{scope:e,forceMount:t},S.createElement(fi,{present:t||o.open},S.createElement(Foe,{asChild:!0,container:i},r)))},uh="PopoverContent",Goe=S.forwardRef((n,e)=>{const t=Woe(uh,n.__scopePopover),{forceMount:r=t.forceMount,...i}=n,o=Lc(uh,n.__scopePopover);return S.createElement(fi,{present:r||o.open},o.modal?S.createElement(Yoe,J({},i,{ref:e})):S.createElement(Xoe,J({},i,{ref:e})))}),Yoe=S.forwardRef((n,e)=>{const t=Lc(uh,n.__scopePopover),r=S.useRef(null),i=Je(e,r),o=S.useRef(!1);return S.useEffect(()=>{const s=r.current;if(s)return US(s)},[]),S.createElement($S,{as:Da,allowPinchZoom:!0},S.createElement(O4,J({},n,{ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ne(n.onCloseAutoFocus,s=>{var a;s.preventDefault(),o.current||(a=t.triggerRef.current)===null||a===void 0||a.focus()}),onPointerDownOutside:ne(n.onPointerDownOutside,s=>{const a=s.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;o.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:ne(n.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1})})))}),Xoe=S.forwardRef((n,e)=>{const t=Lc(uh,n.__scopePopover),r=S.useRef(!1),i=S.useRef(!1);return S.createElement(O4,J({},n,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var s;if((s=n.onCloseAutoFocus)===null||s===void 0||s.call(n,o),!o.defaultPrevented){var a;r.current||(a=t.triggerRef.current)===null||a===void 0||a.focus(),o.preventDefault()}r.current=!1,i.current=!1},onInteractOutside:o=>{var s,a;(s=n.onInteractOutside)===null||s===void 0||s.call(n,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const l=o.target;!((a=t.triggerRef.current)===null||a===void 0)&&a.contains(l)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),O4=S.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:d,...u}=n,h=Lc(uh,t),p=Ex(t);return LS(),S.createElement(DS,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},S.createElement(Loe,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:d,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1)},S.createElement(GD,J({"data-state":L4(h.open),role:"dialog",id:h.contentId},p,u,{ref:e,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))});function L4(n){return n?"open":"closed"}const qoe=Boe,Joe=Voe,z4=Koe,N4=Goe,Px=({id:n,children:e,onOpenChange:t,open:r})=>{const[i,o]=$a(n,t);return m.jsx(qoe,{onOpenChange:o,open:r||i,children:m.jsx("div",{className:"tlui-popover",children:e})})},Ix=({children:n,disabled:e,"data-testid":t})=>m.jsx(Joe,{"data-testid":t,disabled:e,asChild:!0,dir:"ltr",children:n}),F4=({side:n,children:e,align:t="center",sideOffset:r=8,alignOffset:i=0})=>{const o=xn();return m.jsx(z4,{container:o,children:m.jsx(N4,{className:"tlui-popover__content",side:n,sideOffset:r,align:t,alignOffset:i,dir:"ltr",children:e})})},$4=S.memo(function(){const n=Ae(),e=xn(),t=Une(),r=Br();function i(o){if(!o||r&&!o.readonlyOk)return null;switch(o.type){case"item":{const{id:s,icon:a,label:l,kbd:c,onSelect:d}=o.actionItem;return m.jsx(le,{"data-testid":`menu-item.${o.id}`,icon:a,type:"icon",title:l?c?`${n(l)} ${Ui(c)}`:`${n(l)}`:c?`${Ui(c)}`:"",onClick:()=>d("actions-menu"),disabled:o.disabled},s)}}}return m.jsxs(Px,{id:"actions-menu",children:[m.jsx(Ix,{children:m.jsx(le,{className:"tlui-menu__trigger","data-testid":"main.action-menu",icon:"dots-vertical",title:n("actions-menu.title"),type:"icon",smallIcon:!0})}),m.jsx(z4,{container:e,children:m.jsx(N4,{className:"tlui-popover__content",side:"bottom",dir:"ltr",sideOffset:6,children:m.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid",children:t.map(i)})})})]})}),B4=$e(function(){const n=G(),e=Mn(),t=Ae(),r=e.duplicate;return m.jsx(le,{icon:r.icon,type:"icon",onClick:()=>r.onSelect("quick-actions"),disabled:!(n.isIn("select")&&n.getSelectedShapeIds().length>0),title:`${t(r.label)} ${Ui(r.kbd)}`,smallIcon:!0})}),Zoe=S.memo(function(){const n=Ae();return m.jsxs(Us,{id:"main menu",children:[m.jsx(ch,{children:m.jsx(le,{type:"icon",className:"tlui-menu__trigger","data-testid":"main.menu",title:n("menu.title"),icon:"menu",smallIcon:!0})}),m.jsx(Vs,{alignOffset:0,sideOffset:6,children:m.jsx(Qoe,{})})]})});function Qoe(){const n=G(),e=Ae(),t=Zne(),r=Hr(),i=Br();function o(s,a,l,c){if(!a)return null;switch(a.type){case"custom":return i&&!a.readonlyOk?null:a.id==="LANGUAGE_MENU"?m.jsx(I4,{},"item"):null;case"group":return i&&!a.readonlyOk?null:m.jsx(Uo,{size:c<=1?"medium":r<3||(l==null?void 0:l.type)==="submenu"&&c>2?"tiny":"medium",children:a.children.map(d=>o(s,d,a,c+1))},a.id);case"submenu":return i&&!a.readonlyOk?null:m.jsxs(xx,{id:`main menu ${l?l.id+" ":""}${a.id}`,children:[m.jsx(_x,{label:a.label,"data-testid":`menu-item.${a.id}`}),m.jsx(kx,{sideOffset:-4,alignOffset:-1,children:a.children.map(d=>o(s,d,a,c+1))})]},a.id);case"item":{if(i&&!a.readonlyOk)return null;const{id:d,checkbox:u,menuLabel:h,label:p,onSelect:g,kbd:f}=a.actionItem,w=h??p,v=w?e(w):void 0;return u?m.jsxs(E4,{onSelect:()=>g("menu"),title:v||"",checked:a.checked,disabled:a.disabled,children:[v&&m.jsx("span",{className:"tlui-button__label",children:v}),f&&m.jsx(Nm,{children:f})]},d):m.jsx(Cr,{type:"menu","data-testid":`menu-item.${a.id}`,kbd:f,label:w,onClick:()=>g("menu"),disabled:a.disabled},d)}}}return m.jsx(m.Fragment,{children:t.map(s=>o(n,s,null,0))})}const ese=function({name:n,id:e,isCurrentPage:t}){const r=G(),i=S.useRef(null),o=S.useCallback(a=>{r.renamePage(e,a||"New Page",{ephemeral:!0})},[r,e]),s=S.useCallback(a=>{r.mark("rename page"),r.renamePage(e,a||"New Page",{ephemeral:!1})},[r,e]);return m.jsx(WS,{className:"tlui-page-menu__item__input",ref:a=>i.current=a,defaultValue:n,onValueChange:o,onComplete:s,onCancel:s,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:t,autoselect:!0})},Mx=(n,e,t,r)=>{let i;const o=n.getPages(),s=t>r?o[r-1]:o[r],a=t>r?o[r]:o[r+1];s&&!a?i=Io(s.index):!s&&a?i=yU(o[0].index):i=Mu(s.index,a.index),i!==o[t].index&&(n.mark("moving page"),n.updatePage({id:e,index:i}))},U4=$e(function({index:n,listSize:e,item:t,onRename:r}){const i=G(),o=Ae(),s=i.getPages(),a=S.useCallback(()=>{i.mark("creating page");const u=ko.createId();i.duplicatePage(t.id,u)},[i,t]),l=S.useCallback(()=>{Mx(i,t.id,n,n-1)},[i,t,n]),c=S.useCallback(()=>{Mx(i,t.id,n,n+1)},[i,t,n]),d=S.useCallback(()=>{i.mark("deleting page"),i.deletePage(t.id)},[i,t]);return m.jsxs(Us,{id:`page item submenu ${n}`,children:[m.jsx(ch,{children:m.jsx(le,{type:"icon",title:o("page-menu.submenu.title"),icon:"dots-vertical"})}),m.jsxs(Vs,{alignOffset:0,children:[m.jsxs(Uo,{children:[r&&m.jsx(Oc,{dir:"ltr",onSelect:r,asChild:!0,children:m.jsx(le,{type:"menu",label:"page-menu.submenu.rename"})}),m.jsx(Oc,{dir:"ltr",onSelect:a,disabled:s.length>=ng,asChild:!0,children:m.jsx(le,{type:"menu",label:"page-menu.submenu.duplicate-page"})}),n>0&&m.jsx(Oc,{dir:"ltr",onSelect:l,asChild:!0,children:m.jsx(le,{type:"menu",label:"page-menu.submenu.move-up"})}),n<e-1&&m.jsx(Oc,{dir:"ltr",onSelect:c,asChild:!0,children:m.jsx(le,{type:"menu",label:"page-menu.submenu.move-down"})})]}),e>1&&m.jsx(Uo,{children:m.jsx(Oc,{dir:"ltr",onSelect:d,asChild:!0,children:m.jsx(le,{type:"menu",label:"page-menu.submenu.delete"})})})]})]})}),tse=function(){const n=G(),e=Ae(),t=Hr(),r=S.useCallback(()=>f(!1),[]),[i,o]=$a("page-menu",r),s=36,a=S.useRef(null),l=q("pages",()=>n.getPages(),[n]),c=q("currentPage",()=>n.getCurrentPage(),[n]),d=q("currentPageId",()=>n.getCurrentPageId(),[n]),u=Br(),h=q("maxPageCountReached",()=>n.getPages().length>=ng,[n]),p=q("isCoarsePointer",()=>n.getInstanceState().isCoarsePointer,[n]),[g,f]=S.useState(!1),w=S.useCallback(()=>{u||f(A=>!A)},[u]),v=S.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[b,_]=S.useState(Object.fromEntries(l.map((A,T)=>[A.id,{y:T*s,offsetY:0,isSelected:!1}])));S.useLayoutEffect(()=>{_(Object.fromEntries(l.map((A,T)=>[A.id,{y:T*s,offsetY:0,isSelected:!1}])))},[s,l]),S.useEffect(()=>{i&&requestAnimationFrame(()=>{const A=document.querySelector(`[data-testid="page-menu-item-${d}"]`);if(A){const T=a.current;if(!T)return;const O=A.offsetTop,F=T.scrollTop;O<F&&T.scrollTo({top:O});const H=O+s,D=T.scrollTop+T.offsetHeight;H>D&&T.scrollTo({top:H-T.offsetHeight})}})},[s,d,i]);const x=S.useCallback(A=>{const{clientY:T,currentTarget:O}=A,{dataset:{id:F,index:H}}=O;if(!F||!H)return;const D=v.current;uu(A.currentTarget,A),D.status="pointing",D.pointing={id:F,index:+H};const K=b[F].y;D.startY=T,D.startIndex=Math.max(0,Math.min(Math.round(K/s),l.length-1))},[s,l.length,b]),E=S.useCallback(A=>{const T=v.current;if(T.status==="pointing"){const{clientY:O}=A,F=O-T.startY;Math.abs(F)>5&&(T.status="dragging")}if(T.status==="dragging"){const{clientY:O}=A,F=O-T.startY,H=b[T.pointing.id],{startIndex:D,pointing:K}=T,B=H.y+F,te=Math.max(0,Math.min(Math.round(B/s),l.length-1)),W={...b};if(W[K.id]={y:H.y,offsetY:F,isSelected:!0},te!==T.dragIndex){T.dragIndex=te;for(let N=0;N<l.length;N++){const Y=l[N];if(Y.id===T.pointing.id)continue;let{y:ee}=W[Y.id];te===D?ee=N*s:te<D?te<=N&&N<D?ee=(N+1)*s:ee=N*s:te>D&&(te>=N&&N>D?ee=(N-1)*s:ee=N*s),ee!==W[Y.id].y&&(W[Y.id]={y:ee,offsetY:0,isSelected:!0})}}_(W)}},[s,l,b]),k=S.useCallback(A=>{const T=v.current;if(T.status==="dragging"){const{id:O,index:F}=T.pointing;Mx(n,O,F,T.dragIndex)}hu(A.currentTarget,A),T.status="idle"},[n]),P=S.useCallback(A=>{const T=v.current;A.key==="Escape"&&(T.status==="dragging"&&_(Object.fromEntries(l.map((O,F)=>[O.id,{y:F*s,offsetY:0,isSelected:!1}]))),T.status="idle")},[s,l]),I=S.useCallback(()=>{u||n.batch(()=>{n.mark("creating page");const A=ko.createId();n.createPage({name:e("page-menu.new-page-initial-name"),id:A}),n.setCurrentPage(A),f(!0)})},[n,e,u]);return m.jsxs(Px,{id:"pages",onOpenChange:o,open:i,children:[m.jsx(Ix,{children:m.jsx(le,{className:"tlui-page-menu__trigger tlui-menu__trigger","data-testid":"main.page-menu",icon:"chevron-down",type:"menu",title:c.name,children:m.jsx("div",{className:"tlui-page-menu__name",children:c.name})})}),m.jsx(F4,{side:"bottom",align:"start",sideOffset:6,children:m.jsxs("div",{className:"tlui-page-menu__wrapper",children:[m.jsxs("div",{className:"tlui-page-menu__header",children:[m.jsx("div",{className:"tlui-page-menu__header__title",children:e("page-menu.title")}),!u&&m.jsxs("div",{className:"tlui-buttons__horizontal",children:[m.jsx(le,{type:"icon","data-testid":"page-menu.edit",title:e(g?"page-menu.edit-done":"page-menu.edit-start"),icon:g?"check":"edit",onClick:w}),m.jsx(le,{type:"icon","data-testid":"page-menu.create",icon:"plus",title:e(h?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:h,onClick:I})]})]}),m.jsx("div",{className:"tlui-page-menu__list tlui-menu__group",style:{height:s*l.length+4},ref:a,children:l.map((A,T)=>{const O=b[A.id]??{position:T*40,offsetY:0};return g?m.jsxs("div",{"data-testid":`page-menu-item-${A.id}`,className:"tlui-page_menu__item__sortable",style:{zIndex:A.id===c.id?888:T,transform:`translate(0px, ${O.y+O.offsetY}px)`},children:[m.jsx(le,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",icon:"drag-handle-dots",onPointerDown:x,onPointerUp:k,onPointerMove:E,onKeyDown:P,"data-id":A.id,"data-index":T}),t<5&&p?m.jsx(le,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const F=window.prompt("Rename page",A.name);F&&F!==A.name&&n.renamePage(A.id,F)},onDoubleClick:w,isChecked:A.id===c.id,children:m.jsx("span",{children:A.name})}):m.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:s},children:m.jsx(ese,{id:A.id,name:A.name,isCurrentPage:A.id===c.id})}),!u&&m.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":g,children:m.jsx(U4,{index:T,item:A,listSize:l.length})})]},A.id+"_editing"):m.jsxs("div",{"data-testid":`page-menu-item-${A.id}`,className:"tlui-page-menu__item",children:[m.jsxs(le,{type:"normal",className:"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox",onClick:()=>n.setCurrentPage(A.id),onDoubleClick:w,isChecked:A.id===c.id,title:e("page-menu.go-to-page"),children:[m.jsx("div",{className:"tlui-page-menu__item__button__check",children:A.id===c.id&&m.jsx(xr,{icon:"check"})}),m.jsx("span",{children:A.name})]}),!u&&m.jsx("div",{className:"tlui-page_menu__item__submenu",children:m.jsx(U4,{index:T,item:A,listSize:l.length,onRename:()=>{if(n.environment.isIos){const F=window.prompt("Rename page",A.name);F&&F!==A.name&&n.renamePage(A.id,F)}else n.batch(()=>{f(!0),n.setCurrentPage(A.id)})}})})]},A.id)})})]})})]})},V4=S.memo(function(){const n=Ae(),e=fD(),t=Mn().redo;return m.jsx(le,{"data-testid":"main.redo",icon:t.icon,type:"icon",title:`${n(t.label)} ${Ui(t.kbd)}`,disabled:!e,onClick:()=>t.onSelect("quick-actions"),smallIcon:!0})}),H4=$e(function(){const n=G(),e=Mn(),t=Ae(),r=e.delete;return Br()?null:m.jsx(le,{icon:r.icon,type:"icon",onClick:()=>{r.onSelect("quick-actions"),n.getContainer().focus()},disabled:!(n.isIn("select")&&n.getSelectedShapeIds().length>0),title:`${t(r.label)} ${Ui(r.kbd)}`,smallIcon:!0})}),W4=S.memo(function(){const n=Ae(),e=gD(),t=Mn().undo;return m.jsx(le,{"data-testid":"main.undo",icon:t.icon,type:"icon",title:`${n(t.label)} ${Ui(t.kbd)}`,disabled:!e,onClick:()=>t.onSelect("quick-actions"),smallIcon:!0})}),nse=$e(function(){const n=G(),e=Hr(),t=Br();return m.jsx("div",{className:"tlui-menu-zone",children:m.jsxs("div",{className:"tlui-buttons__horizontal",children:[m.jsx(Zoe,{}),m.jsx(tse,{}),e>=6&&!t&&!n.isInAny("hand","zoom")&&m.jsxs(m.Fragment,{children:[m.jsx(W4,{}),m.jsx(V4,{}),m.jsx(H4,{}),m.jsx(B4,{}),m.jsx($4,{})]})]})})});function rse(n,e){const[t,r]=re.useState(e);re.useLayoutEffect(()=>{const o=localStorage.getItem(n);if(o)try{r(JSON.parse(o))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const i=re.useCallback(o=>{r(s=>{const a=typeof o=="function"?o(s):o;return localStorage.setItem(n,JSON.stringify(a)),a})},[n]);return[t,i]}class hh{constructor(e){y(this,"dpr",1);y(this,"colors",{shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"});y(this,"id",et());y(this,"cvs",null);y(this,"pageBounds",[]);y(this,"collaborators",[]);y(this,"canvasScreenBounds",new de);y(this,"canvasPageBounds",new de);y(this,"contentPageBounds",new de);y(this,"contentScreenBounds",new de);y(this,"originPagePoint",new C);y(this,"originPageCenter",new C);y(this,"isInViewport",!1);y(this,"debug",!1);y(this,"updateContentScreenBounds",()=>{const{contentScreenBounds:e,contentPageBounds:t,canvasScreenBounds:r}=this;let{x:i,y:o,w:s,h:a}=e;if(t.w>t.h){const l=r.w/(t.w/t.h);l>r.h?(i=(r.w-r.w*(r.h/l))/2,o=0,s=r.w*(r.h/l),a=r.h):(i=0,o=(r.h-l)/2,s=r.w,a=l)}else if(t.w<t.h){const l=r.h/(t.h/t.w);i=(r.w-l)/2,o=0,s=l,a=r.h}else i=r.h/2,o=0,s=r.h,a=r.h;e.set(i,o,s,a)});y(this,"updateCanvasPageBounds",()=>{const{canvasPageBounds:e,canvasScreenBounds:t,contentPageBounds:r,contentScreenBounds:i}=this;e.set(0,0,r.width/(i.width/t.width),r.height/(i.height/t.height)),e.center=r.center});y(this,"getScreenPoint",(e,t)=>{const{canvasScreenBounds:r}=this,i=(e-r.minX)*this.dpr,o=(t-r.minY)*this.dpr;return{x:i,y:o}});y(this,"getPagePoint",(e,t)=>{const{contentPageBounds:r,contentScreenBounds:i,canvasPageBounds:o}=this,{x:s,y:a}=this.getScreenPoint(e,t);return new C(o.minX+s*r.width/i.width,o.minY+a*r.height/i.height,1)});y(this,"minimapScreenPointToPagePoint",(e,t,r=!1,i=!1)=>{const{editor:o}=this,s=o.getViewportPageBounds();let{x:a,y:l}=this.getPagePoint(e,t);if(i){const c=this.editor.getCurrentPageBounds(),d=s,u=((c==null?void 0:c.minX)??0)-d.width/2,h=((c==null?void 0:c.maxX)??0)+d.width/2,p=((c==null?void 0:c.minY)??0)-d.height/2,g=((c==null?void 0:c.maxY)??0)+d.height/2,f=Math.max(0,u+d.width-a),w=Math.max(0,-(h-d.width-a)),v=Math.max(0,p+d.height-l),b=Math.max(0,-(g-d.height-l)),_=Math.max(0,f-w),x=Math.max(0,w-f),E=Math.max(0,v-b),k=Math.max(0,b-v);_&&_>x?a+=_/2:x&&(a-=x/2),E&&E>k?l+=E/2:k&&(l-=k/2),a=Li(a,u,h),l=Li(l,p,g)}if(r){const{originPagePoint:c}=this,d=Math.abs(a-c.x),u=Math.abs(l-c.y);d>u?l=c.y:a=c.x}return new C(a,l)});y(this,"render",()=>{const{cvs:e,pageBounds:t}=this;this.updateCanvasPageBounds();const{editor:r,canvasScreenBounds:i,canvasPageBounds:o,contentPageBounds:s,contentScreenBounds:a}=this,{width:l,height:c}=i,d=r.getSelectedShapeIds(),u=r.getViewportPageBounds();if(!e||!t)return;const h=e.getContext("2d");if(!h)throw new Error("Minimap (shapes): Could not get context");h.resetTransform(),h.globalAlpha=1,h.clearRect(0,0,l,c);const p=a.width/s.width,g=a.height/s.height;h.translate((l-a.width)/2,(c-a.height)/2),h.scale(p,g),h.translate(-s.minX,-s.minY);const f=8/p,w=8/p,v=1/p,b=1/p,_=f/4,x=w/4,E=new Path2D,k=new Path2D,{shapeFill:P,selectFill:I,viewportFill:A}=this.colors;let T;for(let K=0,B=t.length;K<B;K++)T=t[K],hh.roundedRect(d.includes(T.id)?k:E,T.minX,T.minY,T.width,T.height,Li(f,v,T.width/_),Li(w,b,T.height/x));if(h.fillStyle=P,h.fill(E),h.fillStyle=I,h.fill(k),this.debug){const K=de.Common(t),{minX:B,minY:te,width:W,height:N}=K;h.strokeStyle="green",h.lineWidth=2/p,h.strokeRect(B+1/p,te+1/g,W-2/p,N-2/g)}{const{brush:K}=r.getInstanceState();if(K){const{x:B,y:te,w:W,h:N}=K;h.beginPath(),hh.sharpRect(h,B,te,W,N),h.closePath(),h.fillStyle=A,h.fill()}}{const{minX:K,minY:B,width:te,height:W}=u;h.beginPath();const N=12/p,Y=12/p;hh.roundedRect(h,K,B,te,W,Math.min(te/4,N),Math.min(W/4,Y)),h.closePath(),h.fillStyle=A,h.fill(),this.debug&&(h.strokeStyle="orange",h.strokeRect(K+1/p,B+1/g,te-2/p,W-2/g))}const O=2.5/p,F=2.5/g,H=r.getCurrentPageId();let D;for(let K=0;K<this.collaborators.length;K++)D=this.collaborators[K],D.currentPageId===H&&(h.beginPath(),h.ellipse(Li(D.cursor.x,o.minX+O,o.maxX-O),Li(D.cursor.y,o.minY+F,o.maxY-F),5/p,5/g,0,0,Xe),h.fillStyle=D.color,h.fill());if(this.debug){h.lineWidth=2/p;{const{minX:K,minY:B,width:te,height:W}=s;h.strokeStyle="red",h.strokeRect(K+1/p,B+1/g,te-2/p,W-2/g)}{const{minX:K,minY:B,width:te,height:W}=o;h.strokeStyle="blue",h.strokeRect(K+1/p,B+1/g,te-2/p,W-2/g)}}});this.editor=e}setDpr(e){this.dpr=+e.toFixed(2)}static roundedRect(e,t,r,i,o,s,a){if(s<1&&a<1){e.rect(t,r,i,o);return}e.moveTo(t+s,r),e.lineTo(t+i-s,r),e.quadraticCurveTo(t+i,r,t+i,r+a),e.lineTo(t+i,r+o-a),e.quadraticCurveTo(t+i,r+o,t+i-s,r+o),e.lineTo(t+s,r+o),e.quadraticCurveTo(t,r+o,t,r+o-a),e.lineTo(t,r+a),e.quadraticCurveTo(t,r,t+s,r)}static sharpRect(e,t,r,i,o,s,a){e.rect(t,r,i,o)}}function ise({shapeFill:n,selectFill:e,viewportFill:t}){const r=G(),i=S.useRef(null),o=S.useRef(!1),s=xg(),a=OP("dpr",()=>r.getInstanceState().devicePixelRatio,[r]),l=S.useMemo(()=>r.store.query.records("instance_presence"),[r]),c=S.useMemo(()=>new hh(r),[r]);S.useEffect(()=>{const g=requestAnimationFrame(()=>{const f=getComputedStyle(r.getContainer());c.colors={shapeFill:f.getPropertyValue(n).trim(),selectFill:f.getPropertyValue(e).trim(),viewportFill:f.getPropertyValue(t).trim()},c.render()});return()=>{cancelAnimationFrame(g)}},[r,e,n,t,c,s]);const d=S.useCallback(g=>{if(!r.getCurrentPageShapeIds().size)return;const f=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!1),w=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!0);c.originPagePoint.setTo(w),c.originPageCenter.setTo(r.getViewportPageBounds().center),r.centerOnPoint(f,{duration:Po})},[r,c]),u=S.useCallback(g=>{const f=g.currentTarget;if(uu(f,g),!r.getCurrentPageShapeIds().size)return;o.current=!0,c.isInViewport=!1;const w=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!1),v=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!0),b=r.getViewportPageBounds();if(c.isInViewport=b.containsPoint(v),c.isInViewport)c.originPagePoint.setTo(v),c.originPageCenter.setTo(b.center);else{const x=C.Sub(b.center,b.point),E=C.Add(w,x);c.originPagePoint.setTo(E),c.originPageCenter.setTo(w),r.centerOnPoint(w,{duration:Po})}function _(x){f&&hu(f,x),o.current=!1,document.body.removeEventListener("pointerup",_)}document.body.addEventListener("pointerup",_)},[r,c]),h=S.useCallback(g=>{const f=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,g.shiftKey,!0);if(o.current){if(c.isInViewport){const _=c.originPagePoint.clone().sub(c.originPageCenter);r.centerOnPoint(C.Sub(f,_));return}r.centerOnPoint(f)}const w=c.getPagePoint(g.clientX,g.clientY),v=r.pageToScreen(w),b={type:"pointer",target:"canvas",name:"pointer_move",...er(g),point:v,isPen:r.getInstanceState().isPenMode};r.dispatch(b)},[r,c]),p=S.useCallback(g=>{const f=rM(g);r.dispatch({type:"wheel",name:"wheel",delta:f,point:new C(g.clientX,g.clientY),shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey})},[r]);return wa("update when dpr changes",()=>{const g=a.get();c.setDpr(g);const f=i.current,w=f.getBoundingClientRect(),v=w.width*g,b=w.height*g;f.width=v,f.height=b,c.canvasScreenBounds.set(w.x,w.y,v,b),c.cvs=i.current},[a,c]),wa("minimap render when pagebounds or collaborators changes",()=>{const g=r.getCurrentPageShapeIds(),f=r.getCurrentPageBounds(),w=r.getViewportPageBounds();a.get(),c.contentPageBounds=f?de.Expand(f,w):w,c.updateContentScreenBounds();const v=[];g.forEach(b=>{let _=r.getShapePageBounds(b);if(!_)return;const x=r.getShapeMask(b);if(x){const E=Av(x,_.corners);if(!E)return;_=de.FromPoints(E)}_&&(_.id=b,v.push(_))}),c.pageBounds=v,c.collaborators=l.get(),c.render()},[r,c]),m.jsx("div",{className:"tlui-minimap",children:m.jsx("canvas",{ref:i,className:"tlui-minimap__canvas",onDoubleClick:d,onPointerMove:h,onPointerDown:u,onWheel:p})})}const Ax=$e(function(){const n=G(),e=Ae(),t=Hr(),r=n.getZoomLevel(),i=n.getCurrentPageShapeIds().size>0,o=n.getSelectedShapeIds().length>0,s=n.getZoomLevel()===1,a=S.useCallback(()=>{n.resetZoom(n.getViewportScreenCenter(),{duration:Po})},[n]);return m.jsxs(Us,{id:"zoom",children:[m.jsx(ch,{children:m.jsx(le,{type:"icon",title:`${e("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu",className:t<5?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,icon:t<4?"zoom-in":void 0,children:t<4?null:m.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(r*100),"%"]})})}),m.jsx(Vs,{side:"top",align:"start",alignOffset:0,children:m.jsxs(Uo,{children:[m.jsx(ph,{action:"zoom-in","data-testid":"minimap.zoom-menu.zoom-in",noClose:!0}),m.jsx(ph,{action:"zoom-out","data-testid":"minimap.zoom-menu.zoom-out",noClose:!0}),m.jsx(ph,{action:"zoom-to-100","data-testid":"minimap.zoom-menu.zoom-to-100",noClose:!0,disabled:s}),m.jsx(ph,{action:"zoom-to-fit",disabled:!i,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0}),m.jsx(ph,{action:"zoom-to-selection",disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})]})})]})});function ph(n){const{action:e,disabled:t=!1,noClose:r=!1}=n,i=Mn();return m.jsx(Cr,{type:"menu",label:i[e].label,kbd:i[e].kbd,"data-testid":n["data-testid"],onClick:()=>i[e].onSelect("zoom-menu"),noClose:r,disabled:t})}const ose=S.memo(function(){const n=Mn(),e=Ae(),t=Hr(),[r,i]=rse("minimap",!0),o=S.useCallback(()=>{i(s=>!s)},[i]);return t<4?null:m.jsxs("div",{className:"tlui-navigation-zone",children:[m.jsx("div",{className:"tlui-buttons__horizontal",children:t<6?m.jsx(Ax,{}):r?m.jsxs(m.Fragment,{children:[m.jsx(Ax,{}),m.jsx(le,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:e("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]}):m.jsxs(m.Fragment,{children:[m.jsx(le,{type:"icon",icon:"minus","data-testid":"minimap.zoom-out",title:`${e(n["zoom-out"].label)} ${Ui(n["zoom-out"].kbd)}`,onClick:()=>n["zoom-out"].onSelect("navigation-zone")}),m.jsx(Ax,{}),m.jsx(le,{type:"icon",icon:"plus","data-testid":"minimap.zoom-in",title:`${e(n["zoom-in"].label)} ${Ui(n["zoom-in"].kbd)}`,onClick:()=>n["zoom-in"].onSelect("navigation-zone")}),m.jsx(le,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:e("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]})}),t>=6&&!r&&m.jsx(ise,{viewportFill:"--color-muted-1",selectFill:"--color-selected",shapeFill:"--color-text-3"})]})}),sse=$e(function(){const n=G().getInstanceState().isPenMode,e=Mn();if(!n)return null;const t=e["exit-pen-mode"];return m.jsx(le,{type:"normal",label:t.label,iconLeft:t.icon,onClick:()=>t.onSelect("helper-buttons")})}),ase=$e(function(){const n=G(),e=Mn();if(!n.getInstanceState().followingUserId)return null;const t=e["stop-following"];return m.jsx(le,{type:"normal",label:t.label,iconLeft:t.icon,onClick:()=>t.onSelect("people-menu")})}),lse=[Fr,_a,Hl,Di];function K4(){const n=G();return q("getRelevantStyles",()=>{var r;const e=new jv(n.getSharedStyles()),t=n.getSelectedShapeIds().length>0||!!((r=n.root.getCurrent())!=null&&r.shapeType);if(e.size===0&&n.isIn("select")&&n.getSelectedShapeIds().length===0)for(const i of lse)e.applyValue(i,n.getStyleForNextShape(i));return e.size===0&&!t?null:{styles:e,opacity:n.getSharedOpacity()}},[n])}function cse(n){const{uiType:e,items:t,title:r,style:i,value:o,onValueChange:s}=n,a=G(),l=Ae(),c=S.useRef(!1),{handleButtonClick:d,handleButtonPointerDown:u,handleButtonPointerEnter:h,handleButtonPointerUp:p}=S.useMemo(()=>{const f=()=>{c.current=!1,window.removeEventListener("pointerup",f)};return{handleButtonClick:w=>{const{id:v}=w.currentTarget.dataset;o.type==="shared"&&o.value===v||(a.mark("point picker item"),s(i,v,!1))},handleButtonPointerDown:w=>{const{id:v}=w.currentTarget.dataset;a.mark("point picker item"),s(i,v,!0),c.current=!0,window.addEventListener("pointerup",f)},handleButtonPointerEnter:w=>{if(!c.current)return;const{id:v}=w.currentTarget.dataset;s(i,v,!0)},handleButtonPointerUp:w=>{const{id:v}=w.currentTarget.dataset;s(i,v,!1)}}},[o,a,s,i]),g=q("theme",()=>Qn({isDarkMode:a.user.getIsDarkMode()}),[a]);return m.jsx("div",{className:ye("tlui-buttons__grid"),children:t.map(f=>m.jsx(le,{type:"icon","data-id":f.value,"data-testid":`style.${e}.${f.value}`,"aria-label":f.value,"data-state":o.type==="shared"&&o.value===f.value?"hinted":void 0,title:r+" \u2014 "+l(`${e}-style.${f.value}`),className:ye("tlui-button-grid__button"),style:i===Fr?{color:g[f.value].solid}:void 0,onPointerEnter:h,onPointerDown:u,onPointerUp:p,onClick:d,icon:f.icon},f.value))})}const zc=S.memo(cse);function G4(n,[e,t]){return Math.min(t,Math.max(e,n))}function dse(n){const e=S.useRef({value:n,previous:n});return S.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}const Y4=["PageUp","PageDown"],X4=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],q4={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},fh="Slider",[Tx,use,hse]=jm(fh),[J4,Xbe]=Bi(fh,[hse]),[pse,gy]=J4(fh),fse=S.forwardRef((n,e)=>{const{name:t,min:r=0,max:i=100,step:o=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:d,onValueChange:u=()=>{},onValueCommit:h=()=>{},inverted:p=!1,...g}=n,[f,w]=S.useState(null),v=Je(e,D=>w(D)),b=S.useRef(new Set),_=S.useRef(0),x=s==="horizontal",E=f?!!f.closest("form"):!0,k=x?gse:mse,[P=[],I]=Ls({prop:d,defaultProp:c,onChange:D=>{var K;(K=[...b.current][_.current])===null||K===void 0||K.focus(),u(D)}}),A=S.useRef(P);function T(D){const K=Cse(P,D);H(D,K)}function O(D){H(D,_.current)}function F(){const D=A.current[_.current];P[_.current]!==D&&h(P)}function H(D,K,{commit:B}={commit:!1}){const te=Mse(o),W=Ase(Math.round((D-r)/o)*o+r,te),N=G4(W,[r,i]);I((Y=[])=>{const ee=_se(Y,N,K);if(Ise(ee,l*o)){_.current=ee.indexOf(N);const pe=String(ee)!==String(Y);return pe&&B&&h(ee),pe?ee:Y}else return Y})}return S.createElement(pse,{scope:n.__scopeSlider,disabled:a,min:r,max:i,valueIndexToChangeRef:_,thumbs:b.current,values:P,orientation:s},S.createElement(Tx.Provider,{scope:n.__scopeSlider},S.createElement(Tx.Slot,{scope:n.__scopeSlider},S.createElement(k,J({"aria-disabled":a,"data-disabled":a?"":void 0},g,{ref:v,onPointerDown:ne(g.onPointerDown,()=>{a||(A.current=P)}),min:r,max:i,inverted:p,onSlideStart:a?void 0:T,onSlideMove:a?void 0:O,onSlideEnd:a?void 0:F,onHomeKeyDown:()=>!a&&H(r,0,{commit:!0}),onEndKeyDown:()=>!a&&H(i,P.length-1,{commit:!0}),onStepKeyDown:({event:D,direction:K})=>{if(!a){const B=Y4.includes(D.key)||D.shiftKey&&X4.includes(D.key)?10:1,te=_.current,W=P[te],N=o*B*K;H(W+N,te,{commit:!0})}}})))),E&&P.map((D,K)=>S.createElement(xse,{key:K,name:t?t+(P.length>1?"[]":""):void 0,value:D})))}),[Z4,Q4]=J4(fh,{startEdge:"left",endEdge:"right",size:"width",direction:1}),gse=S.forwardRef((n,e)=>{const{min:t,max:r,dir:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...d}=n,[u,h]=S.useState(null),p=Je(e,_=>h(_)),g=S.useRef(),f=rx(i),w=f==="ltr",v=w&&!o||!w&&o;function b(_){const x=g.current||u.getBoundingClientRect(),E=[0,x.width],k=jx(E,v?[t,r]:[r,t]);return g.current=x,k(_-x.left)}return S.createElement(Z4,{scope:n.__scopeSlider,startEdge:v?"left":"right",endEdge:v?"right":"left",direction:v?1:-1,size:"width"},S.createElement(e5,J({dir:f,"data-orientation":"horizontal"},d,{ref:p,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:_=>{const x=b(_.clientX);s==null||s(x)},onSlideMove:_=>{const x=b(_.clientX);a==null||a(x)},onSlideEnd:()=>{g.current=void 0,l==null||l()},onStepKeyDown:_=>{const x=q4[v?"from-left":"from-right"].includes(_.key);c==null||c({event:_,direction:x?-1:1})}})))}),mse=S.forwardRef((n,e)=>{const{min:t,max:r,inverted:i,onSlideStart:o,onSlideMove:s,onSlideEnd:a,onStepKeyDown:l,...c}=n,d=S.useRef(null),u=Je(e,d),h=S.useRef(),p=!i;function g(f){const w=h.current||d.current.getBoundingClientRect(),v=[0,w.height],b=jx(v,p?[r,t]:[t,r]);return h.current=w,b(f-w.top)}return S.createElement(Z4,{scope:n.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1},S.createElement(e5,J({"data-orientation":"vertical"},c,{ref:u,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:f=>{const w=g(f.clientY);o==null||o(w)},onSlideMove:f=>{const w=g(f.clientY);s==null||s(w)},onSlideEnd:()=>{h.current=void 0,a==null||a()},onStepKeyDown:f=>{const w=q4[p?"from-bottom":"from-top"].includes(f.key);l==null||l({event:f,direction:w?-1:1})}})))}),e5=S.forwardRef((n,e)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:l,...c}=n,d=gy(fh,t);return S.createElement(Re.span,J({},c,{ref:e,onKeyDown:ne(n.onKeyDown,u=>{u.key==="Home"?(s(u),u.preventDefault()):u.key==="End"?(a(u),u.preventDefault()):Y4.concat(X4).includes(u.key)&&(l(u),u.preventDefault())}),onPointerDown:ne(n.onPointerDown,u=>{const h=u.target;h.setPointerCapture(u.pointerId),u.preventDefault(),d.thumbs.has(h)?h.focus():r(u)}),onPointerMove:ne(n.onPointerMove,u=>{u.target.hasPointerCapture(u.pointerId)&&i(u)}),onPointerUp:ne(n.onPointerUp,u=>{const h=u.target;h.hasPointerCapture(u.pointerId)&&(h.releasePointerCapture(u.pointerId),o(u))})}))}),yse="SliderTrack",wse=S.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=gy(yse,t);return S.createElement(Re.span,J({"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation},r,{ref:e}))}),t5="SliderRange",bse=S.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=gy(t5,t),o=Q4(t5,t),s=S.useRef(null),a=Je(e,s),l=i.values.length,c=i.values.map(h=>r5(h,i.min,i.max)),d=l>1?Math.min(...c):0,u=100-Math.max(...c);return S.createElement(Re.span,J({"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0},r,{ref:a,style:{...n.style,[o.startEdge]:d+"%",[o.endEdge]:u+"%"}}))}),n5="SliderThumb",vse=S.forwardRef((n,e)=>{const t=use(n.__scopeSlider),[r,i]=S.useState(null),o=Je(e,a=>i(a)),s=S.useMemo(()=>r?t().findIndex(a=>a.ref.current===r):-1,[t,r]);return S.createElement(Sse,J({},n,{ref:o,index:s}))}),Sse=S.forwardRef((n,e)=>{const{__scopeSlider:t,index:r,...i}=n,o=gy(n5,t),s=Q4(n5,t),[a,l]=S.useState(null),c=Je(e,w=>l(w)),d=$D(a),u=o.values[r],h=u===void 0?0:r5(u,o.min,o.max),p=kse(r,o.values.length),g=d==null?void 0:d[s.size],f=g?Ese(g,h,s.direction):0;return S.useEffect(()=>{if(a)return o.thumbs.add(a),()=>{o.thumbs.delete(a)}},[a,o.thumbs]),S.createElement("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[s.startEdge]:`calc(${h}% + ${f}px)`}},S.createElement(Tx.ItemSlot,{scope:n.__scopeSlider},S.createElement(Re.span,J({role:"slider","aria-label":n["aria-label"]||p,"aria-valuemin":o.min,"aria-valuenow":u,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0},i,{ref:c,style:u===void 0?{display:"none"}:n.style,onFocus:ne(n.onFocus,()=>{o.valueIndexToChangeRef.current=r})}))))}),xse=n=>{const{value:e,...t}=n,r=S.useRef(null),i=dse(e);return S.useEffect(()=>{const o=r.current,s=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(s,"value").set;if(i!==e&&a){const l=new Event("input",{bubbles:!0});a.call(o,e),o.dispatchEvent(l)}},[i,e]),S.createElement("input",J({style:{display:"none"}},t,{ref:r,defaultValue:e}))};function _se(n=[],e,t){const r=[...n];return r[t]=e,r.sort((i,o)=>i-o)}function r5(n,e,t){const r=100/(t-e)*(n-e);return G4(r,[0,100])}function kse(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function Cse(n,e){if(n.length===1)return 0;const t=n.map(i=>Math.abs(i-e)),r=Math.min(...t);return t.indexOf(r)}function Ese(n,e,t){const r=n/2,i=jx([0,50],[0,r]);return(r-i(e)*t)*t}function Pse(n){return n.slice(0,-1).map((e,t)=>n[t+1]-e)}function Ise(n,e){if(e>0){const t=Pse(n);return Math.min(...t)>=e}return!0}function jx(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(n[1]-n[0]);return e[0]+r*(t-n[0])}}function Mse(n){return(String(n).split(".")[1]||"").length}function Ase(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}const Tse=fse,jse=wse,Rse=bse,Dse=vse,Ose=S.memo(function(n){const{title:e,steps:t,value:r,label:i,onValueChange:o}=n,s=G(),a=Ae(),l=S.useCallback(u=>{o(u[0],!0)},[o]),c=S.useCallback(()=>{s.mark("click slider")},[s]),d=S.useCallback(()=>{r&&o(r,!1)},[r,o]);return m.jsx("div",{className:"tlui-slider__container",children:m.jsxs(Tse,{"data-testid":n["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:t,step:1,value:r?[r]:void 0,onPointerDown:c,onValueChange:l,onPointerUp:d,title:e+" \u2014 "+a(i),children:[m.jsx(jse,{className:"tlui-slider__track",dir:"ltr",children:r!==null&&m.jsx(Rse,{className:"tlui-slider__range",dir:"ltr"})}),r!==null&&m.jsx(Dse,{className:"tlui-slider__thumb",dir:"ltr"})]})})}),Lse=S.memo(function({label:n,uiTypeA:e,uiTypeB:t,labelA:r,labelB:i,itemsA:o,itemsB:s,styleA:a,styleB:l,valueA:c,valueB:d,onValueChange:u}){const h=Ae(),p=S.useMemo(()=>{var f;return((f=o.find(w=>c.type==="shared"&&c.value===w.value))==null?void 0:f.icon)??"mixed"},[o,c]),g=S.useMemo(()=>{var f;return((f=s.find(w=>d.type==="shared"&&d.value===w.value))==null?void 0:f.icon)??"mixed"},[s,d]);return c===void 0&&d===void 0?null:m.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[m.jsx("div",{title:h(n),className:"tlui-style-panel__double-select-picker-label",children:h(n)}),m.jsxs("div",{className:"tlui-buttons__horizontal",children:[m.jsxs(Us,{id:`style panel ${e} A`,children:[m.jsx(lh,{asChild:!0,onTouchEnd:f=>ze(f),children:m.jsx(le,{type:"icon","data-testid":`style.${e}`,title:h(r)+" \u2014 "+(c===null||c.type==="mixed"?h("style-panel.mixed"):h(`${e}-style.${c.value}`)),icon:p,invertIcon:!0,smallIcon:!0})}),m.jsx(Vs,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:m.jsx("div",{className:"tlui-buttons__grid",children:o.map(f=>m.jsx(Cr,{type:"icon",title:h(r)+" \u2014 "+h(`${e}-style.${f.value}`),"data-testid":`style.${e}.${f.value}`,icon:f.icon,onClick:()=>u(a,f.value,!1),invertIcon:!0},f.value))})})]}),m.jsxs(Us,{id:`style panel ${t}`,children:[m.jsx(lh,{asChild:!0,onTouchEnd:f=>ze(f),children:m.jsx(le,{type:"icon","data-testid":`style.${t}`,title:h(i)+" \u2014 "+(d===null||d.type==="mixed"?h("style-panel.mixed"):h(`${t}-style.${d.value}`)),icon:g,smallIcon:!0})}),m.jsx(Vs,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:m.jsx("div",{className:"tlui-buttons__grid",children:s.map(f=>m.jsx(Cr,{type:"icon",title:h(i)+" \u2014 "+h(`${t}-style.${f.value}`),"data-testid":`style.${t}.${f.value}`,icon:f.icon,onClick:()=>u(l,f.value,!1)},f.value))})})]})]})]})}),Rx=S.memo(function({id:n,label:e,uiType:t,style:r,items:i,type:o,value:s,onValueChange:a}){const l=Ae(),c=S.useMemo(()=>{var d;return(d=i.find(u=>s.type==="shared"&&u.value===s.value))==null?void 0:d.icon},[i,s]);return m.jsxs(Us,{id:`style panel ${n}`,children:[m.jsx(lh,{asChild:!0,onTouchEnd:d=>ze(d),children:m.jsx(le,{type:o,"data-testid":`style.${t}`,title:s.type==="mixed"?l("style-panel.mixed"):l(`${t}-style.${s.value}`),label:e,icon:c??"mixed"})}),m.jsx(Vs,{side:"left",align:"center",alignOffset:0,children:m.jsx("div",{className:"tlui-buttons__grid",children:i.map(d=>m.jsx(Cr,{type:"icon","data-testid":`style.${t}.${d.value}`,title:l(`${t}-style.${d.value}`),icon:d.icon,onClick:()=>a(r,d.value,!1)},d.value))})})]})}),yi={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},i5=function({isMobile:n}){const e=G(),t=K4(),r=S.useCallback(()=>{n||e.updateInstanceState({isChangingStyle:!1})},[e,n]);if(!t)return null;const{styles:i,opacity:o}=t,s=i.get(Oi),a=i.get(Kf),l=i.get(Wf),c=i.get(Xf),d=i.get(Ri),u=s===void 0,h=a===void 0&&l===void 0,p=c===void 0,g=d===void 0;return m.jsxs("div",{className:"tlui-style-panel","data-ismobile":n,onPointerLeave:r,children:[m.jsx(zse,{styles:i,opacity:o}),!g&&m.jsx(Nse,{styles:i}),!(u&&h&&p)&&m.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[m.jsx(Fse,{styles:i}),m.jsx(Bse,{styles:i}),m.jsx($se,{styles:i})]})]})};function gh(){const n=G();return re.useMemo(()=>function(e,t,r){n.batch(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(e,t,{squashing:r}),n.setStyleForNextShapes(e,t,{squashing:r}),n.updateInstanceState({isChangingStyle:!0})})},[n])}const mh=[.1,.25,.5,.75,1];function zse({styles:n,opacity:e}){const t=G(),r=Ae(),i=gh(),o=re.useCallback((h,p)=>{const g=mh[h];t.batch(()=>{t.isIn("select")&&t.setOpacityForSelectedShapes(g,{ephemeral:p}),t.setOpacityForNextShapes(g,{ephemeral:p}),t.updateInstanceState({isChangingStyle:!0})})},[t]),s=n.get(Fr),a=n.get(Hl),l=n.get(_a),c=n.get(Di),d=a!==void 0||l!==void 0||c!==void 0,u=e.type==="mixed"?-1:mh.indexOf(e6(mh,h=>Math.abs(h-e.value)));return m.jsxs(m.Fragment,{children:[m.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles",children:[s===void 0?null:m.jsx(zc,{title:r("style-panel.color"),uiType:"color",style:Fr,items:yi.color,value:s,onValueChange:i}),e===void 0?null:m.jsx(Ose,{"data-testid":"style.opacity",value:u>=0?u:mh.length-1,label:e.type==="mixed"?"style-panel.mixed":`opacity-style.${e.value}`,onValueChange:o,steps:mh.length-1,title:r("style-panel.opacity")})]}),d&&m.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:m.jsx(zc,{title:r("style-panel.fill"),uiType:"fill",style:Hl,items:yi.fill,value:a,onValueChange:i}),l===void 0?null:m.jsx(zc,{title:r("style-panel.dash"),uiType:"dash",style:_a,items:yi.dash,value:l,onValueChange:i}),c===void 0?null:m.jsx(zc,{title:r("style-panel.size"),uiType:"size",style:Di,items:yi.size,value:c,onValueChange:i})]})]})}function Nse({styles:n}){const e=Ae(),t=gh(),r=n.get(Ri),i=n.get(cu),o=n.get(Gf);return r===void 0&&i===void 0?null:m.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[r===void 0?null:m.jsx(zc,{title:e("style-panel.font"),uiType:"font",style:Ri,items:yi.font,value:r,onValueChange:t}),i===void 0?null:m.jsxs("div",{className:"tlui-style-panel__row",children:[m.jsx(zc,{title:e("style-panel.align"),uiType:"align",style:cu,items:yi.horizontalAlign,value:i,onValueChange:t}),m.jsx("div",{className:"tlui-style-panel__row__extra-button",children:o===void 0?m.jsx(le,{type:"icon",title:e("style-panel.vertical-align"),"data-testid":"vertical-align",icon:"vertical-align-center",disabled:!0}):m.jsx(Rx,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:Gf,items:yi.verticalAlign,value:o,onValueChange:t})})]})]})}function Fse({styles:n}){const e=gh(),t=n.get(Oi);return t===void 0?null:m.jsx(Rx,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:Oi,items:yi.geo,value:t,onValueChange:e})}function $se({styles:n}){const e=gh(),t=n.get(Xf);return t===void 0?null:m.jsx(Rx,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:Xf,items:yi.spline,value:t,onValueChange:e})}function Bse({styles:n}){const e=gh(),t=n.get(Kf),r=n.get(Wf);return!t||!r?null:m.jsx(Lse,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:Wf,itemsA:yi.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:Kf,itemsB:yi.arrowheadEnd,valueB:t,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}function Use({toast:n}){const{removeToast:e}=Hi(),t=Ae(),r=o=>{o||e(n.id)},i=n.actions&&n.actions.length>0;return m.jsxs(Eee,{onOpenChange:r,className:"tlui-toast__container",duration:n.keepOpen?1/0:5e3,children:[n.icon&&m.jsx("div",{className:"tlui-toast__icon",children:m.jsx(xr,{icon:n.icon})}),m.jsxs("div",{className:"tlui-toast__main",children:[m.jsxs("div",{className:"tlui-toast__content",children:[n.title&&m.jsx(Pee,{className:"tlui-toast__title",children:n.title}),n.description&&m.jsx(Iee,{className:"tlui-toast__description",children:n.description})]}),n.actions&&m.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((o,s)=>m.jsx(Mee,{altText:o.label,asChild:!0,onClick:o.onClick,children:m.jsx(le,{type:o.type,children:o.label})},s)),m.jsx(oR,{asChild:!0,children:m.jsx(le,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:n.closeLabel??t("toast.close")})})]})]}),!i&&m.jsx(oR,{asChild:!0,children:m.jsx(le,{type:"normal",className:"tlui-toast__close",children:n.closeLabel??t("toast.close")})})]})}function Vse(){const{toasts:n}=Hi();return m.jsx(m.Fragment,{children:n.map(e=>m.jsx(Use,{toast:e},e.id))})}const Hse=S.memo(Vse);function Wse(){const{toasts:n}=Hi(),[e,t]=S.useState(!1);return S.useEffect(()=>{let r=!1;return n.length?t(!0):setTimeout(()=>{r||t(!1)},1e3),()=>{r=!0}},[n.length,t]),e?m.jsx(cee,{className:"tlui-toast__viewport"}):null}function Kse(){var a;const n=G(),e=Ae(),t=(a=K4())==null?void 0:a.styles.get(Fr),r=Qn({isDarkMode:n.user.getIsDarkMode()}),i=((t==null?void 0:t.type)==="shared"?r[t.value]:r.black).solid,o=q("isHandOrEraserToolActive",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),s=S.useCallback(l=>{l||n.updateInstanceState({isChangingStyle:!1})},[n]);return m.jsxs(Px,{id:"style menu",onOpenChange:s,children:[m.jsx(Ix,{disabled:o,children:m.jsx(le,{type:"tool","data-testid":"mobile.styles",style:{color:o?"var(--color-muted-1)":i},title:e("style-panel.title"),children:m.jsx(xr,{icon:o?"blob":(t==null?void 0:t.type)==="mixed"?"mixed":"blob"})})}),m.jsx(F4,{side:"top",align:"end",children:m.jsx(i5,{isMobile:!0})})]})}const Gse=["select","hand","draw","eraser","text","zoom","laser","highlight"];function Yse({activeToolId:n}){const e=G(),t=Hr(),r=Ae(),i=q("is tool locked",()=>e.getInstanceState().isToolLocked,[e]);return!n||Gse.includes(n)?null:m.jsx(le,{type:"normal",title:r("action.toggle-tool-lock"),className:ye("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":t<5}),icon:i?"lock":"unlock",onClick:()=>e.updateInstanceState({isToolLocked:!i}),smallIcon:!0})}const Xse=S.memo(function(){const n=G(),e=Ae(),t=Hr(),r=re.useRef(void 0),i=Br(),o=ere(),s=o.find(f=>f.toolItem.id==="laser"),a=q("current tool id",()=>n.getCurrentToolId(),[n]),l=q("geo",()=>n.getSharedStyles().getAsKnownValue(Oi),[n]),c=!i,d=f=>f.label?`${e(f.label)} ${f.kbd?Ui(f.kbd):""}`:"",u=o.find(f=>Nc(f.toolItem,a,l)),{itemsInPanel:h,itemsInDropdown:p,dropdownFirstItem:g}=re.useMemo(()=>{const f=[],w=[];let v;const b=Math.min(8,5+t);for(let _=4;_<o.length;_++){const x=o[_];_<b?f.push(x):(x===u&&(v=x),w.push(x))}return v||(r.current||(r.current=w[0]),v=r.current,w.includes(v)||(v=w[0])),r.current=v,w.length<=2&&(f.push(...w),w.length=0),{itemsInPanel:f,itemsInDropdown:w,dropdownFirstItem:v}},[o,u,t]);return m.jsx("div",{className:"tlui-toolbar",children:m.jsxs("div",{className:"tlui-toolbar__inner",children:[m.jsxs("div",{className:"tlui-toolbar__left",children:[!i&&m.jsxs("div",{className:"tlui-toolbar__extras",children:[t<6&&!(a==="hand"||a==="zoom")&&m.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[m.jsx(W4,{}),m.jsx(V4,{}),m.jsx(H4,{}),m.jsx(B4,{}),m.jsx($4,{})]}),m.jsx(Yse,{activeToolId:a})]}),m.jsxs("div",{className:ye("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":t<5}),children:[o.slice(0,2).map(({toolItem:f})=>m.jsx(yh,{item:f,title:d(f),isSelected:Nc(f,a,l)},f.id)),i&&s&&m.jsx(yh,{item:s.toolItem,title:d(s.toolItem),isSelected:Nc(s.toolItem,a,l)},s.toolItem.id),c&&m.jsxs(m.Fragment,{children:[o.slice(2,4).map(({toolItem:f})=>m.jsx(yh,{item:f,title:d(f),isSelected:Nc(f,a,l)},f.id)),h.map(({toolItem:f})=>m.jsx(yh,{item:f,title:d(f),isSelected:Nc(f,a,l)},f.id)),p.length?m.jsxs(m.Fragment,{children:[m.jsx(yh,{item:g.toolItem,title:d(g.toolItem),isSelected:Nc(g.toolItem,a,l)},g.toolItem.id),m.jsxs(Us,{id:"toolbar overflow",modal:!1,children:[m.jsx(ch,{children:m.jsx(le,{className:"tlui-toolbar__overflow",icon:"chevron-up",type:"tool","data-testid":"tools.more",title:e("tool-panel.more")})}),m.jsx(Vs,{side:"top",align:"center",children:m.jsx(qse,{toolbarItems:p})})]})]}):null]})]})]}),t<5&&!i&&m.jsx("div",{className:"tlui-toolbar__tools",children:m.jsx(Kse,{})})]})})}),qse=$e(function({toolbarItems:n}){const e=Ae();return m.jsx("div",{className:"tlui-buttons__grid",children:n.map(({toolItem:{id:t,meta:r,kbd:i,label:o,onSelect:s,icon:a}})=>m.jsx(Cr,{type:"icon",className:"tlui-button-grid__button","data-testid":`tools.more.${t}`,"data-tool":t,"data-geo":(r==null?void 0:r.geo)??"","aria-label":o,onClick:()=>s("toolbar"),title:o?`${e(o)} ${i?Ui(i):""}`:"",icon:a},t))})});function yh({item:n,title:e,isSelected:t}){var r;return m.jsx(le,{type:"tool","data-testid":`tools.${n.id}`,"data-tool":n.id,"data-geo":((r=n.meta)==null?void 0:r.geo)??"","aria-label":n.label,title:e,icon:n.icon,"data-state":t?"selected":void 0,onClick:()=>n.onSelect("toolbar"),onTouchStart:i=>{ze(i),n.onSelect("toolbar")}})}const Nc=(n,e,t)=>{var r,i;return(r=n.meta)!=null&&r.geo?e==="geo"&&t===((i=n.meta)==null?void 0:i.geo):e===n.id};function Jse(){const n=G(),{addToast:e}=Hi();S.useEffect(()=>{function t({name:r,count:i}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${i}). Please delete some shapes or move to a different page to continue.`})}return n.addListener("max-shapes",t),()=>{n.removeListener("max-shapes",t)}},[n,e])}var Dx=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Ox(n,e,t,r){n.addEventListener?n.addEventListener(e,t,r):n.attachEvent&&n.attachEvent("on".concat(e),function(){t(window.event)})}function o5(n,e){for(var t=e.slice(0,e.length-1),r=0;r<t.length;r++)t[r]=n[t[r].toLowerCase()];return t}function s5(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");for(var e=n.split(","),t=e.lastIndexOf("");t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function Zse(n,e){for(var t=n.length>=e.length?n:e,r=n.length>=e.length?e:n,i=!0,o=0;o<t.length;o++)r.indexOf(t[o])===-1&&(i=!1);return i}for(var wh={backspace:8,"\u232B":8,tab:9,clear:12,enter:13,"\u21A9":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"\u21EA":20,",":188,".":190,"/":191,"`":192,"-":Dx?173:189,"=":Dx?61:187,";":Dx?59:186,"'":222,"[":219,"]":221,"\\":220},Gi={"\u21E7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,cmd:91,command:91},Lx={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},dn={16:!1,18:!1,17:!1,91:!1},Mt={},my=1;my<20;my++)wh["f".concat(my)]=111+my;var lt=[],a5=!1,l5="all",c5=[],bh=function(n){return wh[n.toLowerCase()]||Gi[n.toLowerCase()]||n.toUpperCase().charCodeAt(0)},Qse=function(n){return Object.keys(wh).find(function(e){return wh[e]===n})},eae=function(n){return Object.keys(Gi).find(function(e){return Gi[e]===n})};function d5(n){l5=n||"all"}function vh(){return l5||"all"}function tae(){return lt.slice(0)}function nae(){return lt.map(function(n){return Qse(n)||eae(n)||String.fromCharCode(n)})}function rae(){var n=[];return Object.keys(Mt).forEach(function(e){Mt[e].forEach(function(t){var r=t.key,i=t.scope,o=t.mods,s=t.shortcut;n.push({scope:i,shortcut:s,mods:o,keys:r.split("+").map(function(a){return bh(a)})})})}),n}function iae(n){var e=n.target||n.srcElement,t=e.tagName,r=!0;return(e.isContentEditable||(t==="INPUT"||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(r=!1),r}function oae(n){return typeof n=="string"&&(n=bh(n)),lt.indexOf(n)!==-1}function sae(n,e){var t,r;n||(n=vh());for(var i in Mt)if(Object.prototype.hasOwnProperty.call(Mt,i))for(t=Mt[i],r=0;r<t.length;)t[r].scope===n?t.splice(r,1):r++;vh()===n&&d5(e||"all")}function aae(n){var e=n.keyCode||n.which||n.charCode,t=lt.indexOf(e);if(t>=0&&lt.splice(t,1),n.key&&n.key.toLowerCase()==="meta"&&lt.splice(0,lt.length),(e===93||e===224)&&(e=91),e in dn){dn[e]=!1;for(var r in Gi)Gi[r]===e&&(wi[r]=!1)}}function lae(n){if(typeof n>"u")Object.keys(Mt).forEach(function(s){return delete Mt[s]});else if(Array.isArray(n))n.forEach(function(s){s.key&&zx(s)});else if(typeof n=="object")n.key&&zx(n);else if(typeof n=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];var i=t[0],o=t[1];typeof i=="function"&&(o=i,i=""),zx({key:n,scope:i,method:o,splitKey:"+"})}}var zx=function(n){var e=n.key,t=n.scope,r=n.method,i=n.splitKey,o=i===void 0?"+":i,s=s5(e);s.forEach(function(a){var l=a.split(o),c=l.length,d=l[c-1],u=d==="*"?"*":bh(d);if(Mt[u]){t||(t=vh());var h=c>1?o5(Gi,l):[];Mt[u]=Mt[u].filter(function(p){var g=r?p.method===r:!0;return!(g&&p.scope===t&&Zse(p.mods,h))})}})};function u5(n,e,t,r){if(e.element===r){var i;if(e.scope===t||e.scope==="all"){i=e.mods.length>0;for(var o in dn)Object.prototype.hasOwnProperty.call(dn,o)&&(!dn[o]&&e.mods.indexOf(+o)>-1||dn[o]&&e.mods.indexOf(+o)===-1)&&(i=!1);(e.mods.length===0&&!dn[16]&&!dn[18]&&!dn[17]&&!dn[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(lt),e.method(n,e)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}}function h5(n,e){var t=Mt["*"],r=n.keyCode||n.which||n.charCode;if(wi.filter.call(this,n)){if((r===93||r===224)&&(r=91),lt.indexOf(r)===-1&&r!==229&&lt.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(g){var f=Lx[g];n[g]&&lt.indexOf(f)===-1?lt.push(f):!n[g]&&lt.indexOf(f)>-1?lt.splice(lt.indexOf(f),1):g==="metaKey"&&n[g]&&lt.length===3&&(n.ctrlKey||n.shiftKey||n.altKey||(lt=lt.slice(lt.indexOf(f))))}),r in dn){dn[r]=!0;for(var i in Gi)Gi[i]===r&&(wi[i]=!0);if(!t)return}for(var o in dn)Object.prototype.hasOwnProperty.call(dn,o)&&(dn[o]=n[Lx[o]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(lt.indexOf(17)===-1&&lt.push(17),lt.indexOf(18)===-1&&lt.push(18),dn[17]=!0,dn[18]=!0);var s=vh();if(t)for(var a=0;a<t.length;a++)t[a].scope===s&&(n.type==="keydown"&&t[a].keydown||n.type==="keyup"&&t[a].keyup)&&u5(n,t[a],s,e);if(r in Mt){for(var l=0;l<Mt[r].length;l++)if((n.type==="keydown"&&Mt[r][l].keydown||n.type==="keyup"&&Mt[r][l].keyup)&&Mt[r][l].key){for(var c=Mt[r][l],d=c.splitKey,u=c.key.split(d),h=[],p=0;p<u.length;p++)h.push(bh(u[p]));h.sort().join("")===lt.sort().join("")&&u5(n,c,s,e)}}}}function cae(n){return c5.indexOf(n)>-1}function wi(n,e,t){lt=[];var r=s5(n),i=[],o="all",s=document,a=0,l=!1,c=!0,d="+",u=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(o=e.scope),e.element&&(s=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(u=e.capture),typeof e.splitKey=="string"&&(d=e.splitKey)),typeof e=="string"&&(o=e);a<r.length;a++)n=r[a].split(d),i=[],n.length>1&&(i=o5(Gi,n)),n=n[n.length-1],n=n==="*"?"*":bh(n),n in Mt||(Mt[n]=[]),Mt[n].push({keyup:l,keydown:c,scope:o,mods:i,shortcut:r[a],method:t,key:r[a],splitKey:d,element:s});typeof s<"u"&&!cae(s)&&window&&(c5.push(s),Ox(s,"keydown",function(h){h5(h,s)},u),a5||(a5=!0,Ox(window,"focus",function(){lt=[]},u)),Ox(s,"keyup",function(h){h5(h,s),aae(h)},u))}function dae(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Mt).forEach(function(t){var r=Mt[t].filter(function(i){return i.scope===e&&i.shortcut===n});r.forEach(function(i){i&&i.method&&i.method()})})}var Nx={getPressedKeyString:nae,setScope:d5,getScope:vh,deleteScope:sae,getPressedKeyCodes:tae,getAllKeyCodes:rae,isPressed:oae,filter:iae,trigger:dae,unbind:lae,keyMap:wh,modifier:Gi,modifierMap:Lx};for(var Fx in Nx)Object.prototype.hasOwnProperty.call(Nx,Fx)&&(wi[Fx]=Nx[Fx]);if(typeof window<"u"){var uae=window.hotkeys;wi.noConflict=function(n){return n&&window.hotkeys===wi&&(window.hotkeys=uae),wi},window.hotkeys=wi}const p5=["copy","cut","paste","asset"];function hae(){const n=G(),e=Br(),t=Mn(),r=nx(),i=q("is focused",()=>n.getInstanceState().isFocused,[n]);S.useEffect(()=>{if(!i)return;const o=n.getContainer();wi.setScope(n.store.id);const s=(l,c)=>{wi(l,{element:o,scope:n.store.id},c)},a=()=>n.getIsMenuOpen()||n.getEditingShapeId()!==null||n.getCrashingError();for(const l of Object.values(t))l.kbd&&(e&&!l.readonlyOk||p5.includes(l.id)||s(f5(l.kbd),c=>{a()||(ze(c),l.onSelect("kbd"))}));for(const l of Object.values(r))!l.kbd||!l.readonlyOk&&n.getInstanceState().isReadonly||p5.includes(l.id)||s(f5(l.kbd),c=>{a()||(ze(c),l.onSelect("kbd"))});return()=>{wi.deleteScope(n.store.id)}},[t,r,e,n,i])}function f5(n){return pae(n).map(e=>{let t="";const r=e.split("");return r.length===1?t=r[0]:r[0]==="!"?t=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?t=`alt+shift+${r[2]}`:t=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?t=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?t=`cmd+\u2325+${r[2]},ctrl+alt+${r[2]}`:t=`cmd+${r[1]},ctrl+${r[1]}`:t=e,t}).join(",")}function pae(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}const fae=re.memo(function({shareZone:n,topZone:e,renderDebugMenuItems:t,children:r,hideUi:i,...o}){return m.jsx(ore,{...o,children:m.jsx(gae,{hideUi:i,shareZone:n,topZone:e,renderDebugMenuItems:t,children:r})})}),gae=re.memo(function({children:n,hideUi:e,...t}){return m.jsxs(m.Fragment,{children:[n,e?null:m.jsx(mae,{...t})]})}),mae=re.memo(function({shareZone:n,topZone:e,renderDebugMenuItems:t}){const r=G(),i=Ae(),o=Hr(),s=q("isReadonlyMode",()=>r.getInstanceState().isReadonly,[r]),a=q("focus",()=>r.getInstanceState().isFocusMode,[r]),l=q("debug",()=>r.getInstanceState().isDebugMode,[r]);hae(),_ne(),Jse();const{"toggle-focus-mode":c}=Mn();return m.jsx(Jj,{children:m.jsxs("div",{className:ye("tlui-layout",{"tlui-layout__mobile":o<5}),"data-breakpoint":o,children:[a?m.jsx("div",{className:"tlui-layout__top",children:m.jsx(le,{type:"icon",className:"tlui-focus-button",title:`${i("focus-mode.toggle-focus-mode")}`,icon:"dot",onClick:()=>c.onSelect("menu")})}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"tlui-layout__top",children:[m.jsxs("div",{className:"tlui-layout__top__left",children:[m.jsx(nse,{}),m.jsxs("div",{className:"tlui-helper-buttons",children:[m.jsx(sse,{}),m.jsx(are,{}),m.jsx(ase,{})]})]}),m.jsx("div",{className:"tlui-layout__top__center",children:e}),m.jsxs("div",{className:"tlui-layout__top__right",children:[n,o>=5&&!s&&m.jsx("div",{className:"tlui-style-panel__wrapper",children:m.jsx(i5,{})})]})]}),m.jsxs("div",{className:"tlui-layout__bottom",children:[m.jsxs("div",{className:"tlui-layout__bottom__main",children:[m.jsx(ose,{}),m.jsx(Xse,{}),o>=4&&m.jsx(Toe,{})]}),l&&m.jsx(voe,{renderDebugMenuItems:t??null})]})]}),m.jsx(Hse,{}),m.jsx(Ioe,{}),m.jsx(Wse,{}),m.jsx(Moe,{})]})})}),g5="ContextMenu",[yae,qbe]=Bi(g5,[uy]),Yi=uy(),[wae,m5]=yae(g5),bae=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,dir:i,modal:o=!0}=n,[s,a]=S.useState(!1),l=Yi(e),c=It(r),d=S.useCallback(u=>{a(u),c(u)},[c]);return S.createElement(wae,{scope:e,open:s,onOpenChange:d,modal:o},S.createElement(u4,J({},l,{dir:i,open:s,onOpenChange:d,modal:o}),t))},vae="ContextMenuTrigger",Sae=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,disabled:r=!1,...i}=n,o=m5(vae,t),s=Yi(t),a=S.useRef({x:0,y:0}),l=S.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=S.useRef(0),d=S.useCallback(()=>window.clearTimeout(c.current),[]),u=h=>{a.current={x:h.clientX,y:h.clientY},o.onOpenChange(!0)};return S.useEffect(()=>d,[d]),S.useEffect(()=>void(r&&d()),[r,d]),S.createElement(S.Fragment,null,S.createElement(h4,J({},s,{virtualRef:l})),S.createElement(Re.span,J({"data-state":o.open?"open":"closed","data-disabled":r?"":void 0},i,{ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:r?n.onContextMenu:ne(n.onContextMenu,h=>{d(),u(h),h.preventDefault()}),onPointerDown:r?n.onPointerDown:ne(n.onPointerDown,yy(h=>{d(),c.current=window.setTimeout(()=>u(h),700)})),onPointerMove:r?n.onPointerMove:ne(n.onPointerMove,yy(d)),onPointerCancel:r?n.onPointerCancel:ne(n.onPointerCancel,yy(d)),onPointerUp:r?n.onPointerUp:ne(n.onPointerUp,yy(d))})))}),xae=n=>{const{__scopeContextMenu:e,...t}=n,r=Yi(e);return S.createElement(p4,J({},r,t))},_ae="ContextMenuContent",kae=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=m5(_ae,t),o=Yi(t),s=S.useRef(!1);return S.createElement(f4,J({},o,r,{ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var l;(l=n.onCloseAutoFocus)===null||l===void 0||l.call(n,a),!a.defaultPrevented&&s.current&&a.preventDefault(),s.current=!1},onInteractOutside:a=>{var l;(l=n.onInteractOutside)===null||l===void 0||l.call(n,a),!a.defaultPrevented&&!i.modal&&(s.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),Cae=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Yi(t);return S.createElement(g4,J({},i,r,{ref:e}))}),Eae=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Yi(t);return S.createElement(m4,J({},i,r,{ref:e}))}),Pae=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Yi(t);return S.createElement(y4,J({},i,r,{ref:e}))}),Iae=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,open:i,defaultOpen:o}=n,s=Yi(e),[a,l]=Ls({prop:i,defaultProp:o,onChange:r});return S.createElement(w4,J({},s,{open:a,onOpenChange:l}),t)},Mae=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Yi(t);return S.createElement(b4,J({},i,r,{ref:e}))}),Aae=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Yi(t);return S.createElement(v4,J({},i,r,{ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))});function yy(n){return e=>e.pointerType!=="mouse"?n(e):void 0}const Tae=bae,jae=Sae,$x=xae,Rae=kae,Bx=Cae,Ux=Eae,Dae=Pae,y5=Iae,w5=Mae,b5=Aae,Oae=$e(function(){const n=G(),e=xn(),t=n.getPages(),r=n.getCurrentPageId(),i=Ae(),{addToast:o}=Hi();return m.jsxs(y5,{children:[m.jsx(w5,{dir:"ltr",asChild:!0,children:m.jsx(le,{type:"menu",label:"context-menu.move-to-page","data-testid":"menu-item.move-to-page",icon:"chevron-right"})}),m.jsx($x,{container:e,children:m.jsxs(b5,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:[m.jsx(Bx,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.pages",children:t.map(s=>m.jsx(Ux,{disabled:r===s.id,onSelect:()=>{n.mark("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),s.id);const a=n.getPage(s.id);a&&o({title:"Changed Page",description:`Moved to ${a.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.mark("change-page"),n.setCurrentPage(r)}}]})},asChild:!0,children:m.jsx(le,{type:"menu",title:s.name,className:"tlui-context-menu__move-to-page__name",children:m.jsx("span",{className:"tlui-button__label",children:s.name})})},s.id))},"pages"),m.jsx(Bx,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.new-page",children:m.jsx(Ux,{onSelect:()=>{const s=ko.createId(),a=n.getSelectedShapeIds();n.batch(()=>{n.mark("move_shapes_to_page"),n.createPage({name:i("page-menu.new-page-initial-name"),id:s}),n.moveShapesToPage(a,s)})},asChild:!0,children:m.jsx(le,{type:"menu",title:i("context.pages.new-page"),className:"tlui-context-menu__move-to-page__name",children:m.jsx("span",{className:"tlui-button__label",children:i("context.pages.new-page")})})},"new-page")},"new-page")]})})]})}),Lae=function({children:n}){const e=G(),t=cD(),r=S.useCallback(c=>{if(c){if(e.getInstanceState().isCoarsePointer){const d=e.getSelectedShapes(),{inputs:{currentPagePoint:u}}=e,h=e.getShapesAtPoint(u);if(!e.getSelectedShapes().length||!h.some(p=>d.includes(p))){const p=h.filter(g=>e.isShapeOrAncestorLocked(g));p.length&&e.select(...p.map(g=>g.id))}}}else{const d=e.getOnlySelectedShape();d&&e.isShapeOrAncestorLocked(d)&&e.setSelectedShapes([])}},[e]),[i,o]=$a("context menu",r),s=Br(),a=t.length===0||s&&t.every(c=>!c.readonlyOk),l=!q("isSelectToolActive",()=>e.getCurrentToolId()==="select",[e])||a;return m.jsxs(Tae,{dir:"ltr",onOpenChange:o,modal:!1,children:[m.jsx(jae,{onContextMenu:l?ze:void 0,dir:"ltr",disabled:l,children:n}),i&&m.jsx(zae,{})]})},zae=S.forwardRef(function(){const n=G(),e=Ae(),t=cD(),[r,i]=$a("context menu sub"),o=Br(),s=Hr(),a=xn(),[l,c]=S.useState(!1);function d(u,h,p,g){if(!h||o&&!h.readonlyOk)return null;switch(h.type){case"custom":{switch(h.id){case"MOVE_TO_PAGE_MENU":return m.jsx(Oae,{},h.id)}break}case"group":return m.jsx(Bx,{dir:"ltr",className:ye("tlui-menu__group",{"tlui-menu__group__small":(p==null?void 0:p.type)==="submenu"}),"data-testid":`menu-item.${h.id}`,children:h.children.map(f=>d(u,f,h,g+1))},h.id);case"submenu":return m.jsxs(y5,{onOpenChange:i,children:[m.jsx(w5,{dir:"ltr",disabled:h.disabled,asChild:!0,children:m.jsx(le,{type:"menu",label:h.label,"data-testid":`menu-item.${h.id}`,icon:"chevron-right"})}),m.jsx($x,{container:a,children:m.jsx(b5,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:h.children.map(f=>d(u,f,h,g+1))})})]},h.id);case"item":{if(o&&!h.readonlyOk)return null;const{id:f,checkbox:w,contextMenuLabel:v,label:b,onSelect:_,kbd:x,icon:E}=h.actionItem,k=v??b,P=k?e(k):void 0;return w?m.jsxs(Dae,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",disabled:h.disabled,onSelect:I=>{_("context-menu"),ze(I)},title:P||void 0,checked:h.checked,children:[m.jsx(xr,{small:!0,icon:h.checked?"check":"checkbox-empty"}),P&&m.jsx("span",{className:"tlui-button__label",draggable:!1,children:P}),x&&m.jsx(Nm,{children:x})]},f):m.jsx(Ux,{dir:"ltr",asChild:!0,children:m.jsx(le,{type:"menu","data-testid":`menu-item.${f}`,kbd:x,label:k,disabled:h.disabled,iconLeft:s<3&&g>2?E:void 0,onClick:()=>{l?c(!1):_("context-menu")}})},f)}}}return m.jsx($x,{container:a,children:m.jsx(Rae,{className:"tlui-menu scrollable",alignOffset:-4,collisionPadding:4,onContextMenu:ze,children:t.map(u=>d(n,u,null,0))})})}),wy=(n,e)=>{const[t,r]=S.useState(2);return S.useEffect(()=>{const{url:i,style:o="normal",weight:s="500",display:a,featureSettings:l,stretch:c,unicodeRange:d,variant:u}=e;let h=!1;r(2);const p={style:o,weight:s,display:a,featureSettings:l,stretch:c,unicodeRange:d,variant:u},g=new FontFace(n,`url(${i})`,p);return g.load().then(()=>{h||(document.fonts.add(g),r(0))}).catch(f=>{h||(console.error(f),r(1))}),g.$$_url=i,g.$$_fontface=`
@font-face {
	font-family: ${g.family};
	font-stretch: ${g.stretch};
	font-weight: ${g.weight};
	font-style: ${g.style};
	src: url("${i}") format("woff2")
}`,()=>{document.fonts.delete(g),h=!0}},[n,e]),t};function Nae(n){return{draw:{url:n.fonts.draw},serif:{url:n.fonts.serif},sansSerif:{url:n.fonts.sansSerif},monospace:{url:n.fonts.monospace}}}function Fae(n){const e=S.useMemo(()=>Nae(n),[n]),t=[wy("tldraw_draw",e.draw),wy("tldraw_serif",e.serif),wy("tldraw_sans",e.sansSerif),wy("tldraw_mono",e.monospace)];return{error:t.some(r=>r===1),done:!t.some(r=>r===2)}}function $ae(n){const{children:e,maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s,...a}=n,l=nH(a.components??{}),c=fA(a.shapeUtils??[]),d=fA(a.tools??[]),u={initialState:"select",...a,components:S.useMemo(()=>({Scribble:p3,CollaboratorScribble:p3,SelectionForeground:pJ,SelectionBackground:uJ,Handles:oJ,HoveredShapeIndicator:sJ,...l}),[l]),shapeUtils:S.useMemo(()=>[...pj,...c],[c]),tools:S.useMemo(()=>[...FQ,...oZ,...d],[d])},h=Aee(a.assetUrls),{done:p,error:g}=Fae(h);return g?m.jsx(ZV,{children:"Could not load assets. Please refresh the page."}):p?m.jsx(YV,{...u,children:m.jsxs(fae,{...u,children:[m.jsx(Lae,{children:m.jsx(Pv,{})}),m.jsx(Bae,{maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s}),e]})}):m.jsx(uA,{children:"Loading assets..."})}function Bae({maxImageDimension:n=1e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:t=["image/jpeg","image/png","image/gif","image/svg+xml"],acceptedVideoMimeTypes:r=["video/mp4","video/quicktime"],onMount:i}){const o=G(),s=Uae(a=>{const l=[];return l.push(...EQ(a)),KJ(a,{maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:r}),l.push(i==null?void 0:i(a)),()=>{l.forEach(c=>c==null?void 0:c())}});return S.useLayoutEffect(()=>{if(o)return s==null?void 0:s(o)},[o,s]),null}function Uae(n){const e=S.useRef();return S.useLayoutEffect(()=>{e.current=n}),S.useDebugValue(n),S.useCallback((...t)=>{const r=e.current;return ba(r,"fn does not exist"),r(...t)},[])}je({tldrawFileFormatVersion:k6,schema:je({schemaVersion:Ff,storeVersion:Ff,recordVersions:Qb(Se,je({version:Ff,subTypeVersions:Qb(Se,Ff).optional(),subTypeKey:Se.optional()}))}),records:zn(je({id:Se,typeName:Se}).allowUnknownProperties())});const Vae="/assets/rapier_wasm2d_bg-b5dc53dc.wasm",Hae=async(n={},e)=>{let t;if(e.startsWith("data:")){const r=e.replace(/^data:.*?base64,/,"");let i;if(typeof Buffer=="function"&&typeof Buffer.from=="function")i=Buffer.from(r,"base64");else if(typeof atob=="function"){const o=atob(r);i=new Uint8Array(o.length);for(let s=0;s<o.length;s++)i[s]=o.charCodeAt(s)}else throw new Error("Cannot decode base64-encoded data URL");t=await WebAssembly.instantiate(i,n)}else{const r=await fetch(e),i=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&i.startsWith("application/wasm"))t=await WebAssembly.instantiateStreaming(r,n);else{const o=await r.arrayBuffer();t=await WebAssembly.instantiate(o,n)}}return t.instance.exports},Oe=new Array(32).fill(void 0);Oe.push(void 0,null,!0,!1);function Ve(n){return Oe[n]}let Sh=Oe.length;function Wae(n){n<36||(Oe[n]=Sh,Sh=n)}function by(n){const e=Ve(n);return Wae(n),e}function Lt(n){Sh===Oe.length&&Oe.push(Oe.length+1);const e=Sh;return Sh=Oe[e],Oe[e]=n,e}function ce(n){return n==null}let Vx=new Float64Array;function vy(){return Vx.byteLength===0&&(Vx=new Float64Array($c.buffer)),Vx}let Hx=new Int32Array;function mt(){return Hx.byteLength===0&&(Hx=new Int32Array($c.buffer)),Hx}const Kae=typeof TextDecoder>"u"?(0,hz.require)("util").TextDecoder:TextDecoder;let v5=new Kae("utf-8",{ignoreBOM:!0,fatal:!0});v5.decode();let Wx=new Uint8Array;function Gae(){return Wx.byteLength===0&&(Wx=new Uint8Array($c.buffer)),Wx}function S5(n,e){return v5.decode(Gae().subarray(n,n+e))}function Yae(){try{const t=Ne(-16);wle(t);var n=mt()[t/4+0],e=mt()[t/4+1];return S5(n,e)}finally{Ne(16),Dy(n,e)}}function L(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`);return n.ptr}let Kx=new Float32Array;function Hs(){return Kx.byteLength===0&&(Kx=new Float32Array($c.buffer)),Kx}let ct=32;function _t(n){if(ct==1)throw new Error("out of js stack");return Oe[--ct]=n,ct}function x5(n,e){return Hs().subarray(n/4,n/4+e)}let Gx=new Uint32Array;function _5(){return Gx.byteLength===0&&(Gx=new Uint32Array($c.buffer)),Gx}function Xae(n,e){return _5().subarray(n/4,n/4+e)}let bi=0;function Ba(n,e){const t=e(n.length*4);return Hs().set(n,t/4),bi=n.length,t}function k5(n,e){const t=e(n.length*4);return _5().set(n,t/4),bi=n.length,t}function Yx(n,e){try{return n.apply(this,e)}catch(t){tge(Lt(t))}}const Sy=Object.freeze({X:0,0:"X",Y:1,1:"Y",AngX:2,2:"AngX"});class Ws{static __wrap(e){const t=Object.create(Ws.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();kue(e)}constructor(){const e=Cue();return Ws.__wrap(e)}}class Fc{static __wrap(e){const t=Object.create(Fc.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Jle(e)}constructor(){const e=Zle();return Fc.__wrap(e)}}class xh{static __wrap(e){const t=Object.create(xh.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Vle(e)}constructor(){const e=Hle();return xh.__wrap(e)}handle(){return Wle(this.ptr)}translationApplied(){const e=Ph(this.ptr);return V.__wrap(e)}translationRemaining(){const e=C5(this.ptr);return V.__wrap(e)}toi(){return Kle(this.ptr)}worldWitness1(){const e=Gle(this.ptr);return V.__wrap(e)}worldWitness2(){const e=Yle(this.ptr);return V.__wrap(e)}worldNormal1(){const e=Xle(this.ptr);return V.__wrap(e)}worldNormal2(){const e=qle(this.ptr);return V.__wrap(e)}}class kt{static __wrap(e){const t=Object.create(kt.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Dhe(e)}coTranslation(e){const t=Eue(this.ptr,e);return V.__wrap(t)}coRotation(e){const t=Pue(this.ptr,e);return Le.__wrap(t)}coSetTranslation(e,t,r){Iue(this.ptr,e,t,r)}coSetTranslationWrtParent(e,t,r){Mue(this.ptr,e,t,r)}coSetRotation(e,t){Aue(this.ptr,e,t)}coSetRotationWrtParent(e,t){Tue(this.ptr,e,t)}coIsSensor(e){return jue(this.ptr,e)!==0}coShapeType(e){return Rue(this.ptr,e)>>>0}coHalfspaceNormal(e){const t=Due(this.ptr,e);return t===0?void 0:V.__wrap(t)}coHalfExtents(e){const t=Oue(this.ptr,e);return t===0?void 0:V.__wrap(t)}coSetHalfExtents(e,t){L(t,V),Lue(this.ptr,e,t.ptr)}coRadius(e){try{const i=Ne(-16);zue(i,this.ptr,e);var t=mt()[i/4+0],r=Hs()[i/4+1];return t===0?void 0:r}finally{Ne(16)}}coSetRadius(e,t){Nue(this.ptr,e,t)}coHalfHeight(e){try{const i=Ne(-16);Fue(i,this.ptr,e);var t=mt()[i/4+0],r=Hs()[i/4+1];return t===0?void 0:r}finally{Ne(16)}}coSetHalfHeight(e,t){$ue(this.ptr,e,t)}coRoundRadius(e){try{const i=Ne(-16);Bue(i,this.ptr,e);var t=mt()[i/4+0],r=Hs()[i/4+1];return t===0?void 0:r}finally{Ne(16)}}coSetRoundRadius(e,t){Uue(this.ptr,e,t)}coVertices(e){try{const i=Ne(-16);Vue(i,this.ptr,e);var t=mt()[i/4+0],r=mt()[i/4+1];let o;return t!==0&&(o=x5(t,r).slice(),Dy(t,r*4)),o}finally{Ne(16)}}coIndices(e){try{const i=Ne(-16);Hue(i,this.ptr,e);var t=mt()[i/4+0],r=mt()[i/4+1];let o;return t!==0&&(o=Xae(t,r).slice(),Dy(t,r*4)),o}finally{Ne(16)}}coHeightfieldHeights(e){try{const i=Ne(-16);Wue(i,this.ptr,e);var t=mt()[i/4+0],r=mt()[i/4+1];let o;return t!==0&&(o=x5(t,r).slice(),Dy(t,r*4)),o}finally{Ne(16)}}coHeightfieldScale(e){const t=Kue(this.ptr,e);return t===0?void 0:V.__wrap(t)}coParent(e){try{const i=Ne(-16);Gue(i,this.ptr,e);var t=mt()[i/4+0],r=vy()[i/8+1];return t===0?void 0:r}finally{Ne(16)}}coSetEnabled(e,t){Yue(this.ptr,e,t)}coIsEnabled(e){return Xue(this.ptr,e)!==0}coFriction(e){return que(this.ptr,e)}coRestitution(e){return Jue(this.ptr,e)}coDensity(e){return Zue(this.ptr,e)}coMass(e){return Que(this.ptr,e)}coVolume(e){return ehe(this.ptr,e)}coCollisionGroups(e){return the(this.ptr,e)>>>0}coSolverGroups(e){return nhe(this.ptr,e)>>>0}coActiveHooks(e){return rhe(this.ptr,e)>>>0}coActiveCollisionTypes(e){return ihe(this.ptr,e)}coActiveEvents(e){return ohe(this.ptr,e)>>>0}coContactForceEventThreshold(e){return she(this.ptr,e)}coContainsPoint(e,t){return L(t,V),ahe(this.ptr,e,t.ptr)!==0}coCastShape(e,t,r,i,o,s,a,l){L(t,V),L(r,xe),L(i,V),L(o,Le),L(s,V);const c=lhe(this.ptr,e,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a,l);return c===0?void 0:Ty.__wrap(c)}coCastCollider(e,t,r,i,o,s){L(t,V),L(i,V);const a=che(this.ptr,e,t.ptr,r,i.ptr,o,s);return a===0?void 0:Ay.__wrap(a)}coIntersectsShape(e,t,r,i){return L(t,xe),L(r,V),L(i,Le),dhe(this.ptr,e,t.ptr,r.ptr,i.ptr)!==0}coContactShape(e,t,r,i,o){L(t,xe),L(r,V),L(i,Le);const s=uhe(this.ptr,e,t.ptr,r.ptr,i.ptr,o);return s===0?void 0:Ch.__wrap(s)}coContactCollider(e,t,r){const i=hhe(this.ptr,e,t,r);return i===0?void 0:Ch.__wrap(i)}coProjectPoint(e,t,r){L(t,V);const i=phe(this.ptr,e,t.ptr,r);return Ey.__wrap(i)}coIntersectsRay(e,t,r,i){return L(t,V),L(r,V),fhe(this.ptr,e,t.ptr,r.ptr,i)!==0}coCastRay(e,t,r,i,o){return L(t,V),L(r,V),ghe(this.ptr,e,t.ptr,r.ptr,i,o)}coCastRayAndGetNormal(e,t,r,i,o){L(t,V),L(r,V);const s=mhe(this.ptr,e,t.ptr,r.ptr,i,o);return s===0?void 0:Iy.__wrap(s)}coSetSensor(e,t){yhe(this.ptr,e,t)}coSetRestitution(e,t){whe(this.ptr,e,t)}coSetFriction(e,t){bhe(this.ptr,e,t)}coFrictionCombineRule(e){return vhe(this.ptr,e)>>>0}coSetFrictionCombineRule(e,t){She(this.ptr,e,t)}coRestitutionCombineRule(e){return xhe(this.ptr,e)>>>0}coSetRestitutionCombineRule(e,t){_he(this.ptr,e,t)}coSetCollisionGroups(e,t){khe(this.ptr,e,t)}coSetSolverGroups(e,t){Che(this.ptr,e,t)}coSetActiveHooks(e,t){Ehe(this.ptr,e,t)}coSetActiveEvents(e,t){Phe(this.ptr,e,t)}coSetActiveCollisionTypes(e,t){Ihe(this.ptr,e,t)}coSetShape(e,t){L(t,xe),Mhe(this.ptr,e,t.ptr)}coSetContactForceEventThreshold(e,t){Ahe(this.ptr,e,t)}coSetDensity(e,t){The(this.ptr,e,t)}coSetMass(e,t){jhe(this.ptr,e,t)}coSetMassProperties(e,t,r,i){L(r,V),Rhe(this.ptr,e,t,r.ptr,i)}constructor(){const e=Ohe();return kt.__wrap(e)}len(){return Lhe(this.ptr)>>>0}contains(e){return M5(this.ptr,e)!==0}createCollider(e,t,r,i,o,s,a,l,c,d,u,h,p,g,f,w,v,b,_,x,E,k,P){try{const T=Ne(-16);L(t,xe),L(r,V),L(i,Le),L(a,V),L(P,At),zhe(T,this.ptr,e,t.ptr,r.ptr,i.ptr,o,s,a.ptr,l,c,d,u,h,p,g,f,w,v,b,_,x,E,k,P.ptr);var I=mt()[T/4+0],A=vy()[T/8+1];return I===0?void 0:A}finally{Ne(16)}}remove(e,t,r,i){L(t,Ji),L(r,At),Nhe(this.ptr,e,t.ptr,r.ptr,i)}isHandleValid(e){return M5(this.ptr,e)!==0}forEachColliderHandle(e){try{Fhe(this.ptr,_t(e))}finally{Oe[ct++]=void 0}}}class Xx{static __wrap(e){const t=Object.create(Xx.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();hfe(e)}collider1(){return Ih(this.ptr)}collider2(){return pfe(this.ptr)}total_force(){const e=Mh(this.ptr);return V.__wrap(e)}total_force_magnitude(){return Ry(this.ptr)}max_force_direction(){const e=Ph(this.ptr);return V.__wrap(e)}max_force_magnitude(){return ffe(this.ptr)}}class qx{static __wrap(e){const t=Object.create(qx.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Ghe(e)}normal(){const e=Zhe(this.ptr);return V.__wrap(e)}local_n1(){const e=Qhe(this.ptr);return V.__wrap(e)}local_n2(){const e=epe(this.ptr);return V.__wrap(e)}subshape1(){return tpe(this.ptr)>>>0}subshape2(){return npe(this.ptr)>>>0}num_contacts(){return rpe(this.ptr)>>>0}contact_local_p1(e){const t=ipe(this.ptr,e);return t===0?void 0:V.__wrap(t)}contact_local_p2(e){const t=ope(this.ptr,e);return t===0?void 0:V.__wrap(t)}contact_dist(e){return spe(this.ptr,e)}contact_fid1(e){return ape(this.ptr,e)>>>0}contact_fid2(e){return lpe(this.ptr,e)>>>0}contact_impulse(e){return cpe(this.ptr,e)}contact_tangent_impulse(e){return dpe(this.ptr,e)}num_solver_contacts(){return upe(this.ptr)>>>0}solver_contact_point(e){const t=hpe(this.ptr,e);return t===0?void 0:V.__wrap(t)}solver_contact_dist(e){return ppe(this.ptr,e)}solver_contact_friction(e){return fpe(this.ptr,e)}solver_contact_restitution(e){return gpe(this.ptr,e)}solver_contact_tangent_velocity(e){const t=mpe(this.ptr,e);return V.__wrap(t)}}class Jx{static __wrap(e){const t=Object.create(Jx.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Yfe(e)}collider1(){return Yhe(this.ptr)}collider2(){return Xhe(this.ptr)}numContactManifolds(){return qhe(this.ptr)>>>0}contactManifold(e){const t=Jhe(this.ptr,e);return t===0?void 0:qx.__wrap(t)}}class xy{static __wrap(e){const t=Object.create(xy.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();sfe(e)}constructor(){const e=afe();return xy.__wrap(e)}vertices(){const e=lfe(this.ptr);return by(e)}colors(){const e=cfe(this.ptr);return by(e)}render(e,t,r,i,o){L(e,At),L(t,kt),L(r,qi),L(i,Zi),L(o,Vo),dfe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr)}}class Zx{static __wrap(e){const t=Object.create(Zx.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Lfe(e)}takeGravity(){const e=zfe(this.ptr);return e===0?void 0:V.__wrap(e)}takeIntegrationParameters(){const e=Nfe(this.ptr);return e===0?void 0:Ks.__wrap(e)}takeIslandManager(){const e=Ffe(this.ptr);return e===0?void 0:Ji.__wrap(e)}takeBroadPhase(){const e=$fe(this.ptr);return e===0?void 0:Ws.__wrap(e)}takeNarrowPhase(){const e=Bfe(this.ptr);return e===0?void 0:Vo.__wrap(e)}takeBodies(){const e=Ufe(this.ptr);return e===0?void 0:At.__wrap(e)}takeColliders(){const e=Vfe(this.ptr);return e===0?void 0:kt.__wrap(e)}takeImpulseJoints(){const e=Hfe(this.ptr);return e===0?void 0:qi.__wrap(e)}takeMultibodyJoints(){const e=Wfe(this.ptr);return e===0?void 0:Zi.__wrap(e)}}class _h{static __wrap(e){const t=Object.create(_h.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();ufe(e)}constructor(e){const t=gfe(e);return _h.__wrap(t)}drainCollisionEvents(e){try{mfe(this.ptr,_t(e))}finally{Oe[ct++]=void 0}}drainContactForceEvents(e){try{yfe(this.ptr,_t(e))}finally{Oe[ct++]=void 0}}clear(){wfe(this.ptr)}}class Xi{static __wrap(e){const t=Object.create(Xi.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Vce(e)}static prismatic(e,t,r,i,o,s){L(e,V),L(t,V),L(r,V);const a=Hce(e.ptr,t.ptr,r.ptr,i,o,s);return a===0?void 0:Xi.__wrap(a)}static fixed(e,t,r,i){L(e,V),L(t,Le),L(r,V),L(i,Le);const o=Wce(e.ptr,t.ptr,r.ptr,i.ptr);return Xi.__wrap(o)}static revolute(e,t){L(e,V),L(t,V);const r=Kce(e.ptr,t.ptr);return r===0?void 0:Xi.__wrap(r)}}class qi{static __wrap(e){const t=Object.create(qi.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();wce(e)}jointType(e){return Qle(this.ptr,e)>>>0}jointBodyHandle1(e){return ece(this.ptr,e)}jointBodyHandle2(e){return tce(this.ptr,e)}jointFrameX1(e){const t=nce(this.ptr,e);return Le.__wrap(t)}jointFrameX2(e){const t=rce(this.ptr,e);return Le.__wrap(t)}jointAnchor1(e){const t=ice(this.ptr,e);return V.__wrap(t)}jointAnchor2(e){const t=oce(this.ptr,e);return V.__wrap(t)}jointSetAnchor1(e,t){L(t,V),sce(this.ptr,e,t.ptr)}jointSetAnchor2(e,t){L(t,V),ace(this.ptr,e,t.ptr)}jointContactsEnabled(e){return lce(this.ptr,e)!==0}jointSetContactsEnabled(e,t){cce(this.ptr,e,t)}jointLimitsEnabled(e,t){return dce(this.ptr,e,t)!==0}jointLimitsMin(e,t){return uce(this.ptr,e,t)}jointLimitsMax(e,t){return hce(this.ptr,e,t)}jointSetLimits(e,t,r,i){pce(this.ptr,e,t,r,i)}jointConfigureMotorModel(e,t,r){fce(this.ptr,e,t,r)}jointConfigureMotorVelocity(e,t,r,i){gce(this.ptr,e,t,r,i)}jointConfigureMotorPosition(e,t,r,i,o){mce(this.ptr,e,t,r,i,o)}jointConfigureMotor(e,t,r,i,o,s){yce(this.ptr,e,t,r,i,o,s)}constructor(){const e=bce();return qi.__wrap(e)}createJoint(e,t,r,i){return L(e,Xi),vce(this.ptr,e.ptr,t,r,i)}remove(e,t){Sce(this.ptr,e,t)}len(){return xce(this.ptr)>>>0}contains(e){return _ce(this.ptr,e)!==0}forEachJointHandle(e){try{kce(this.ptr,_t(e))}finally{Oe[ct++]=void 0}}forEachJointAttachedToRigidBody(e,t){try{Cce(this.ptr,e,_t(t))}finally{Oe[ct++]=void 0}}}class Ks{static __wrap(e){const t=Object.create(Ks.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Ece(e)}constructor(){const e=Pce();return Ks.__wrap(e)}get dt(){return e_(this.ptr)}get erp(){return E5(this.ptr)}get allowedLinearError(){return t_(this.ptr)}get predictionDistance(){return Ry(this.ptr)}get maxVelocityIterations(){return Ice(this.ptr)>>>0}get maxVelocityFrictionIterations(){return Mce(this.ptr)>>>0}get maxStabilizationIterations(){return Ace(this.ptr)>>>0}get minIslandSize(){return Tce(this.ptr)>>>0}get maxCcdSubsteps(){return jce(this.ptr)>>>0}set dt(e){P5(this.ptr,e)}set erp(e){Rce(this.ptr,e)}set allowedLinearError(e){I5(this.ptr,e)}set predictionDistance(e){Dce(this.ptr,e)}set maxVelocityIterations(e){Oce(this.ptr,e)}set maxVelocityFrictionIterations(e){Lce(this.ptr,e)}set maxStabilizationIterations(e){zce(this.ptr,e)}set minIslandSize(e){Nce(this.ptr,e)}set maxCcdSubsteps(e){Fce(this.ptr,e)}}class Ji{static __wrap(e){const t=Object.create(Ji.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();$ce(e)}constructor(){const e=Bce();return Ji.__wrap(e)}forEachActiveRigidBodyHandle(e){try{Uce(this.ptr,_t(e))}finally{Oe[ct++]=void 0}}}class _y{static __wrap(e){const t=Object.create(_y.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();ble(e)}constructor(e){const t=vle(e);return _y.__wrap(t)}up(){const e=Eh(this.ptr);return V.__wrap(e)}setUp(e){L(e,V),Sle(this.ptr,e.ptr)}offset(){return xle(this.ptr)}setOffset(e){_le(this.ptr,e)}slideEnabled(){return kle(this.ptr)!==0}setSlideEnabled(e){Cle(this.ptr,e)}autostepMaxHeight(){try{const r=Ne(-16);Ele(r,this.ptr);var e=mt()[r/4+0],t=Hs()[r/4+1];return e===0?void 0:t}finally{Ne(16)}}autostepMinWidth(){try{const r=Ne(-16);Ple(r,this.ptr);var e=mt()[r/4+0],t=Hs()[r/4+1];return e===0?void 0:t}finally{Ne(16)}}autostepIncludesDynamicBodies(){const e=Ile(this.ptr);return e===16777215?void 0:e!==0}autostepEnabled(){return Mle(this.ptr)!==0}enableAutostep(e,t,r){Ale(this.ptr,e,t,r)}disableAutostep(){Tle(this.ptr)}maxSlopeClimbAngle(){return t_(this.ptr)}setMaxSlopeClimbAngle(e){I5(this.ptr,e)}minSlopeSlideAngle(){return jle(this.ptr)}setMinSlopeSlideAngle(e){Rle(this.ptr,e)}snapToGroundDistance(){try{const r=Ne(-16);Dle(r,this.ptr);var e=mt()[r/4+0],t=Hs()[r/4+1];return e===0?void 0:t}finally{Ne(16)}}enableSnapToGround(e){Ole(this.ptr,e)}disableSnapToGround(){Lle(this.ptr)}snapToGroundEnabled(){return zle(this.ptr)!==0}computeColliderMovement(e,t,r,i,o,s,a,l,c,d,u){try{L(t,At),L(r,kt),L(i,kh),L(s,V),Nle(this.ptr,e,t.ptr,r.ptr,i.ptr,o,s.ptr,a,!ce(l),ce(l)?0:l,c,!ce(d),ce(d)?0:d,_t(u))}finally{Oe[ct++]=void 0}}computedMovement(){const e=Fle(this.ptr);return V.__wrap(e)}computedGrounded(){return $le(this.ptr)!==0}numComputedCollisions(){return Ble(this.ptr)>>>0}computedCollision(e,t){return L(t,xh),Ule(this.ptr,e,t.ptr)!==0}}class Zi{static __wrap(e){const t=Object.create(Zi.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();rde(e)}jointType(e){return Gce(this.ptr,e)>>>0}jointFrameX1(e){const t=Yce(this.ptr,e);return Le.__wrap(t)}jointFrameX2(e){const t=Xce(this.ptr,e);return Le.__wrap(t)}jointAnchor1(e){const t=qce(this.ptr,e);return V.__wrap(t)}jointAnchor2(e){const t=Jce(this.ptr,e);return V.__wrap(t)}jointContactsEnabled(e){return Zce(this.ptr,e)!==0}jointSetContactsEnabled(e,t){Qce(this.ptr,e,t)}jointLimitsEnabled(e,t){return ede(this.ptr,e,t)!==0}jointLimitsMin(e,t){return tde(this.ptr,e,t)}jointLimitsMax(e,t){return nde(this.ptr,e,t)}constructor(){const e=ide();return Zi.__wrap(e)}createJoint(e,t,r,i){return L(e,Xi),ode(this.ptr,e.ptr,t,r,i)}remove(e,t){sde(this.ptr,e,t)}contains(e){return ade(this.ptr,e)!==0}forEachJointHandle(e){try{lde(this.ptr,_t(e))}finally{Oe[ct++]=void 0}}forEachJointAttachedToRigidBody(e,t){try{cde(this.ptr,e,_t(t))}finally{Oe[ct++]=void 0}}}class Vo{static __wrap(e){const t=Object.create(Vo.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Bhe(e)}constructor(){const e=Uhe();return Vo.__wrap(e)}contacts_with(e,t){Vhe(this.ptr,e,Lt(t))}contact_pair(e,t){const r=Hhe(this.ptr,e,t);return r===0?void 0:Jx.__wrap(r)}intersections_with(e,t){Whe(this.ptr,e,Lt(t))}intersection_pair(e,t){return Khe(this.ptr,e,t)!==0}}class ky{static __wrap(e){const t=Object.create(ky.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();bfe(e)}constructor(){const e=vfe();return ky.__wrap(e)}step(e,t,r,i,o,s,a,l,c,d){L(e,V),L(t,Ks),L(r,Ji),L(i,Ws),L(o,Vo),L(s,At),L(a,kt),L(l,qi),L(c,Zi),L(d,Fc),Sfe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l.ptr,c.ptr,d.ptr)}stepWithEvents(e,t,r,i,o,s,a,l,c,d,u,h,p,g){L(e,V),L(t,Ks),L(r,Ji),L(i,Ws),L(o,Vo),L(s,At),L(a,kt),L(l,qi),L(c,Zi),L(d,Fc),L(u,_h),xfe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l.ptr,c.ptr,d.ptr,u.ptr,Lt(h),Lt(p),Lt(g))}}class Cy{static __wrap(e){const t=Object.create(Cy.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();bpe(e)}colliderHandle(){return Ih(this.ptr)}point(){const e=Mh(this.ptr);return V.__wrap(e)}isInside(){return vpe(this.ptr)!==0}featureType(){return A5(this.ptr)>>>0}featureId(){try{const r=Ne(-16);T5(r,this.ptr);var e=mt()[r/4+0],t=mt()[r/4+1];return e===0?void 0:t>>>0}finally{Ne(16)}}}class Ey{static __wrap(e){const t=Object.create(Ey.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();ype(e)}point(){const e=Eh(this.ptr);return V.__wrap(e)}isInside(){return wpe(this.ptr)!==0}}class kh{static __wrap(e){const t=Object.create(kh.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();_fe(e)}constructor(){const e=kfe();return kh.__wrap(e)}update(e,t){L(e,At),L(t,kt),Cfe(this.ptr,e.ptr,t.ptr)}castRay(e,t,r,i,o,s,a,l,c,d,u){try{L(e,At),L(t,kt),L(r,V),L(i,V);const h=Efe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s,a,!ce(l),ce(l)?0:l,!ce(c),ce(c)?0:c,!ce(d),ce(d)?0:d,_t(u));return h===0?void 0:Qx.__wrap(h)}finally{Oe[ct++]=void 0}}castRayAndGetNormal(e,t,r,i,o,s,a,l,c,d,u){try{L(e,At),L(t,kt),L(r,V),L(i,V);const h=Pfe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s,a,!ce(l),ce(l)?0:l,!ce(c),ce(c)?0:c,!ce(d),ce(d)?0:d,_t(u));return h===0?void 0:Py.__wrap(h)}finally{Oe[ct++]=void 0}}intersectionsWithRay(e,t,r,i,o,s,a,l,c,d,u,h){try{L(e,At),L(t,kt),L(r,V),L(i,V),Ife(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s,_t(a),l,!ce(c),ce(c)?0:c,!ce(d),ce(d)?0:d,!ce(u),ce(u)?0:u,_t(h))}finally{Oe[ct++]=void 0,Oe[ct++]=void 0}}intersectionWithShape(e,t,r,i,o,s,a,l,c,d){try{const p=Ne(-16);L(e,At),L(t,kt),L(r,V),L(i,Le),L(o,xe),Mfe(p,this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s,!ce(a),ce(a)?0:a,!ce(l),ce(l)?0:l,!ce(c),ce(c)?0:c,_t(d));var u=mt()[p/4+0],h=vy()[p/8+1];return u===0?void 0:h}finally{Ne(16),Oe[ct++]=void 0}}projectPoint(e,t,r,i,o,s,a,l,c){try{L(e,At),L(t,kt),L(r,V);const d=Afe(this.ptr,e.ptr,t.ptr,r.ptr,i,o,!ce(s),ce(s)?0:s,!ce(a),ce(a)?0:a,!ce(l),ce(l)?0:l,_t(c));return d===0?void 0:Cy.__wrap(d)}finally{Oe[ct++]=void 0}}projectPointAndGetFeature(e,t,r,i,o,s,a,l){try{L(e,At),L(t,kt),L(r,V);const c=Tfe(this.ptr,e.ptr,t.ptr,r.ptr,i,!ce(o),ce(o)?0:o,!ce(s),ce(s)?0:s,!ce(a),ce(a)?0:a,_t(l));return c===0?void 0:Cy.__wrap(c)}finally{Oe[ct++]=void 0}}intersectionsWithPoint(e,t,r,i,o,s,a,l,c){try{L(e,At),L(t,kt),L(r,V),jfe(this.ptr,e.ptr,t.ptr,r.ptr,_t(i),o,!ce(s),ce(s)?0:s,!ce(a),ce(a)?0:a,!ce(l),ce(l)?0:l,_t(c))}finally{Oe[ct++]=void 0,Oe[ct++]=void 0}}castShape(e,t,r,i,o,s,a,l,c,d,u,h,p){try{L(e,At),L(t,kt),L(r,V),L(i,Le),L(o,V),L(s,xe);const g=Rfe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a,l,c,!ce(d),ce(d)?0:d,!ce(u),ce(u)?0:u,!ce(h),ce(h)?0:h,_t(p));return g===0?void 0:Ay.__wrap(g)}finally{Oe[ct++]=void 0}}intersectionsWithShape(e,t,r,i,o,s,a,l,c,d,u){try{L(e,At),L(t,kt),L(r,V),L(i,Le),L(o,xe),Dfe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,_t(s),a,!ce(l),ce(l)?0:l,!ce(c),ce(c)?0:c,!ce(d),ce(d)?0:d,_t(u))}finally{Oe[ct++]=void 0,Oe[ct++]=void 0}}collidersWithAabbIntersectingAabb(e,t,r){try{L(e,V),L(t,V),Ofe(this.ptr,e.ptr,t.ptr,_t(r))}finally{Oe[ct++]=void 0}}}class Py{static __wrap(e){const t=Object.create(Py.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Xfe(e)}colliderHandle(){return Ih(this.ptr)}normal(){const e=jy(this.ptr);return V.__wrap(e)}toi(){return t_(this.ptr)}featureType(){return _pe(this.ptr)>>>0}featureId(){try{const r=Ne(-16);kpe(r,this.ptr);var e=mt()[r/4+0],t=mt()[r/4+1];return e===0?void 0:t>>>0}finally{Ne(16)}}}class Qx{static __wrap(e){const t=Object.create(Qx.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();qfe(e)}colliderHandle(){return Ih(this.ptr)}toi(){return E5(this.ptr)}}class Iy{static __wrap(e){const t=Object.create(Iy.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Spe(e)}normal(){const e=Eh(this.ptr);return V.__wrap(e)}toi(){return xpe(this.ptr)}featureType(){return A5(this.ptr)>>>0}featureId(){try{const r=Ne(-16);T5(r,this.ptr);var e=mt()[r/4+0],t=mt()[r/4+1];return e===0?void 0:t>>>0}finally{Ne(16)}}}class At{static __wrap(e){const t=Object.create(At.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();mue(e)}rbTranslation(e){const t=dde(this.ptr,e);return V.__wrap(t)}rbRotation(e){const t=ude(this.ptr,e);return Le.__wrap(t)}rbSleep(e){hde(this.ptr,e)}rbIsSleeping(e){return pde(this.ptr,e)!==0}rbIsMoving(e){return fde(this.ptr,e)!==0}rbNextTranslation(e){const t=gde(this.ptr,e);return V.__wrap(t)}rbNextRotation(e){const t=mde(this.ptr,e);return Le.__wrap(t)}rbSetTranslation(e,t,r,i){yde(this.ptr,e,t,r,i)}rbSetRotation(e,t,r){wde(this.ptr,e,t,r)}rbSetLinvel(e,t,r){L(t,V),bde(this.ptr,e,t.ptr,r)}rbSetAngvel(e,t,r){vde(this.ptr,e,t,r)}rbSetNextKinematicTranslation(e,t,r){Sde(this.ptr,e,t,r)}rbSetNextKinematicRotation(e,t){xde(this.ptr,e,t)}rbRecomputeMassPropertiesFromColliders(e,t){L(t,kt),_de(this.ptr,e,t.ptr)}rbSetAdditionalMass(e,t,r){kde(this.ptr,e,t,r)}rbSetAdditionalMassProperties(e,t,r,i,o){L(r,V),Cde(this.ptr,e,t,r.ptr,i,o)}rbLinvel(e){const t=Ede(this.ptr,e);return V.__wrap(t)}rbAngvel(e){return Pde(this.ptr,e)}rbLockTranslations(e,t,r){Ide(this.ptr,e,t,r)}rbSetEnabledTranslations(e,t,r,i){Mde(this.ptr,e,t,r,i)}rbLockRotations(e,t,r){Ade(this.ptr,e,t,r)}rbDominanceGroup(e){return Tde(this.ptr,e)}rbSetDominanceGroup(e,t){jde(this.ptr,e,t)}rbEnableCcd(e,t){Rde(this.ptr,e,t)}rbMass(e){return Dde(this.ptr,e)}rbInvMass(e){return Ode(this.ptr,e)}rbEffectiveInvMass(e){const t=Lde(this.ptr,e);return V.__wrap(t)}rbLocalCom(e){const t=zde(this.ptr,e);return V.__wrap(t)}rbWorldCom(e){const t=Nde(this.ptr,e);return V.__wrap(t)}rbInvPrincipalInertiaSqrt(e){return Fde(this.ptr,e)}rbPrincipalInertia(e){return $de(this.ptr,e)}rbEffectiveWorldInvInertiaSqrt(e){return Bde(this.ptr,e)}rbEffectiveAngularInertia(e){return Ude(this.ptr,e)}rbWakeUp(e){Vde(this.ptr,e)}rbIsCcdEnabled(e){return Hde(this.ptr,e)!==0}rbNumColliders(e){return Wde(this.ptr,e)>>>0}rbCollider(e,t){return Kde(this.ptr,e,t)}rbBodyType(e){return Gde(this.ptr,e)>>>0}rbSetBodyType(e,t,r){Yde(this.ptr,e,t,r)}rbIsFixed(e){return Xde(this.ptr,e)!==0}rbIsKinematic(e){return qde(this.ptr,e)!==0}rbIsDynamic(e){return Jde(this.ptr,e)!==0}rbLinearDamping(e){return Zde(this.ptr,e)}rbAngularDamping(e){return Qde(this.ptr,e)}rbSetLinearDamping(e,t){eue(this.ptr,e,t)}rbSetAngularDamping(e,t){tue(this.ptr,e,t)}rbSetEnabled(e,t){nue(this.ptr,e,t)}rbIsEnabled(e){return rue(this.ptr,e)!==0}rbGravityScale(e){return iue(this.ptr,e)}rbSetGravityScale(e,t,r){oue(this.ptr,e,t,r)}rbResetForces(e,t){sue(this.ptr,e,t)}rbResetTorques(e,t){aue(this.ptr,e,t)}rbAddForce(e,t,r){L(t,V),lue(this.ptr,e,t.ptr,r)}rbApplyImpulse(e,t,r){L(t,V),cue(this.ptr,e,t.ptr,r)}rbAddTorque(e,t,r){due(this.ptr,e,t,r)}rbApplyTorqueImpulse(e,t,r){uue(this.ptr,e,t,r)}rbAddForceAtPoint(e,t,r,i){L(t,V),L(r,V),hue(this.ptr,e,t.ptr,r.ptr,i)}rbApplyImpulseAtPoint(e,t,r,i){L(t,V),L(r,V),pue(this.ptr,e,t.ptr,r.ptr,i)}rbUserData(e){return fue(this.ptr,e)>>>0}rbSetUserData(e,t){gue(this.ptr,e,t)}constructor(){const e=yue();return At.__wrap(e)}createRigidBody(e,t,r,i,o,s,a,l,c,d,u,h,p,g,f,w,v,b,_,x){return L(t,V),L(r,Le),L(a,V),L(l,V),wue(this.ptr,e,t.ptr,r.ptr,i,o,s,a.ptr,l.ptr,c,d,u,h,p,g,f,w,v,b,_,x)}remove(e,t,r,i,o){L(t,Ji),L(r,kt),L(i,qi),L(o,Zi),bue(this.ptr,e,t.ptr,r.ptr,i.ptr,o.ptr)}len(){return vue(this.ptr)>>>0}contains(e){return Sue(this.ptr,e)!==0}forEachRigidBodyHandle(e){try{xue(this.ptr,_t(e))}finally{Oe[ct++]=void 0}}propagateModifiedBodyPositionsToColliders(e){L(e,kt),_ue(this.ptr,e.ptr)}}class Le{static __wrap(e){const t=Object.create(Le.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Jpe(e)}static identity(){const e=Zpe();return Le.__wrap(e)}static fromAngle(e){const t=Qpe(e);return Le.__wrap(t)}get im(){return j5(this.ptr)}get re(){return e_(this.ptr)}get angle(){return efe(this.ptr)}}class My{static __wrap(e){const t=Object.create(My.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();ege(e)}constructor(){const e=Qfe();return My.__wrap(e)}serializeAll(e,t,r,i,o,s,a,l,c){L(e,V),L(t,Ks),L(r,Ji),L(i,Ws),L(o,Vo),L(s,At),L(a,kt),L(l,qi),L(c,Zi);const d=Kfe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l.ptr,c.ptr);return by(d)}deserializeAll(e){const t=Gfe(this.ptr,Lt(e));return t===0?void 0:Zx.__wrap(t)}}class xe{static __wrap(e){const t=Object.create(xe.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Cpe(e)}static cuboid(e,t){const r=Epe(e,t);return xe.__wrap(r)}static roundCuboid(e,t,r){const i=Ppe(e,t,r);return xe.__wrap(i)}static ball(e){const t=Ipe(e);return xe.__wrap(t)}static halfspace(e){L(e,V);const t=Mpe(e.ptr);return xe.__wrap(t)}static capsule(e,t){const r=Ape(e,t);return xe.__wrap(r)}static polyline(e,t){const r=Ba(e,Ho),i=bi,o=k5(t,Ho),s=Tpe(r,i,o,bi);return xe.__wrap(s)}static trimesh(e,t){const r=Ba(e,Ho),i=bi,o=k5(t,Ho),s=jpe(r,i,o,bi);return xe.__wrap(s)}static heightfield(e,t){const r=Ba(e,Ho),i=bi;L(t,V);const o=Rpe(r,i,t.ptr);return xe.__wrap(o)}static segment(e,t){L(e,V),L(t,V);const r=Dpe(e.ptr,t.ptr);return xe.__wrap(r)}static triangle(e,t,r){L(e,V),L(t,V),L(r,V);const i=Ope(e.ptr,t.ptr,r.ptr);return xe.__wrap(i)}static roundTriangle(e,t,r,i){L(e,V),L(t,V),L(r,V);const o=Lpe(e.ptr,t.ptr,r.ptr,i);return xe.__wrap(o)}static convexHull(e){const t=Ba(e,Ho),r=zpe(t,bi);return r===0?void 0:xe.__wrap(r)}static roundConvexHull(e,t){const r=Ba(e,Ho),i=Npe(r,bi,t);return i===0?void 0:xe.__wrap(i)}static convexPolyline(e){const t=Ba(e,Ho),r=Fpe(t,bi);return r===0?void 0:xe.__wrap(r)}static roundConvexPolyline(e,t){const r=Ba(e,Ho),i=$pe(r,bi,t);return i===0?void 0:xe.__wrap(i)}castShape(e,t,r,i,o,s,a,l,c){L(e,V),L(t,Le),L(r,V),L(i,xe),L(o,V),L(s,Le),L(a,V);const d=Bpe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l,c);return d===0?void 0:Ty.__wrap(d)}intersectsShape(e,t,r,i,o){return L(e,V),L(t,Le),L(r,xe),L(i,V),L(o,Le),Upe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr)!==0}contactShape(e,t,r,i,o,s){L(e,V),L(t,Le),L(r,xe),L(i,V),L(o,Le);const a=Vpe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s);return a===0?void 0:Ch.__wrap(a)}containsPoint(e,t,r){return L(e,V),L(t,Le),L(r,V),Hpe(this.ptr,e.ptr,t.ptr,r.ptr)!==0}projectPoint(e,t,r,i){L(e,V),L(t,Le),L(r,V);const o=Wpe(this.ptr,e.ptr,t.ptr,r.ptr,i);return Ey.__wrap(o)}intersectsRay(e,t,r,i,o){return L(e,V),L(t,Le),L(r,V),L(i,V),Kpe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o)!==0}castRay(e,t,r,i,o,s){return L(e,V),L(t,Le),L(r,V),L(i,V),Gpe(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s)}castRayAndGetNormal(e,t,r,i,o,s){L(e,V),L(t,Le),L(r,V),L(i,V);const a=Ype(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s);return a===0?void 0:Iy.__wrap(a)}}class Ay{static __wrap(e){const t=Object.create(Ay.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Xpe(e)}colliderHandle(){return Ih(this.ptr)}toi(){return qpe(this.ptr)}witness1(){const e=jy(this.ptr);return V.__wrap(e)}witness2(){const e=Mh(this.ptr);return V.__wrap(e)}normal1(){const e=Ph(this.ptr);return V.__wrap(e)}normal2(){const e=C5(this.ptr);return V.__wrap(e)}}class Ch{static __wrap(e){const t=Object.create(Ch.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();$he(e)}distance(){return Ry(this.ptr)}point1(){const e=Eh(this.ptr);return V.__wrap(e)}point2(){const e=jy(this.ptr);return V.__wrap(e)}normal1(){const e=Mh(this.ptr);return V.__wrap(e)}normal2(){const e=Ph(this.ptr);return V.__wrap(e)}}class Ty{static __wrap(e){const t=Object.create(Ty.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Zfe(e)}toi(){return Ry(this.ptr)}witness1(){const e=Eh(this.ptr);return V.__wrap(e)}witness2(){const e=jy(this.ptr);return V.__wrap(e)}normal1(){const e=Mh(this.ptr);return V.__wrap(e)}normal2(){const e=Ph(this.ptr);return V.__wrap(e)}}class V{static __wrap(e){const t=Object.create(V.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Jfe(e)}static zero(){const e=tfe();return V.__wrap(e)}constructor(e,t){const r=nfe(e,t);return V.__wrap(r)}get x(){return e_(this.ptr)}set x(e){P5(this.ptr,e)}get y(){return j5(this.ptr)}set y(e){rfe(this.ptr,e)}xy(){const e=ife(this.ptr);return V.__wrap(e)}yx(){const e=ofe(this.ptr);return V.__wrap(e)}}function qae(n){by(n)}function Jae(n){return Lt(n)}function Zae(n,e){const t=Ve(e),r=typeof t=="number"?t:void 0;vy()[n/8+1]=ce(r)?0:r,mt()[n/4+0]=!ce(r)}function Qae(n){const e=Ve(n);return typeof e=="boolean"?e?1:0:2}function ele(n){return typeof Ve(n)=="function"}function tle(n){const e=Py.__wrap(n);return Lt(e)}function nle(n){const e=Xx.__wrap(n);return Lt(e)}function rle(){return Yx(function(n,e,t){const r=Ve(n).call(Ve(e),Ve(t));return Lt(r)},arguments)}function ile(){return Yx(function(n,e,t,r){const i=Ve(n).call(Ve(e),Ve(t),Ve(r));return Lt(i)},arguments)}function ole(){return Yx(function(n,e,t,r,i){const o=Ve(n).call(Ve(e),Ve(t),Ve(r),Ve(i));return Lt(o)},arguments)}function sle(n,e,t,r){const i=Ve(n).bind(Ve(e),Ve(t),Ve(r));return Lt(i)}function ale(n){const e=Ve(n).buffer;return Lt(e)}function lle(n,e,t){const r=new Uint8Array(Ve(n),e>>>0,t>>>0);return Lt(r)}function cle(n){const e=new Uint8Array(Ve(n));return Lt(e)}function dle(n,e,t){Ve(n).set(Ve(e),t>>>0)}function ule(n){return Ve(n).length}function hle(n,e,t){const r=new Float32Array(Ve(n),e>>>0,t>>>0);return Lt(r)}function ple(n,e,t){Ve(n).set(Ve(e),t>>>0)}function fle(n){return Ve(n).length}function gle(n){const e=new Float32Array(n>>>0);return Lt(e)}function mle(n,e){throw new Error(S5(n,e))}function yle(){return Lt($c)}URL=globalThis.URL;const M=await Hae({"./rapier_wasm2d_bg.js":{__wbindgen_object_drop_ref:qae,__wbindgen_number_new:Jae,__wbindgen_number_get:Zae,__wbindgen_boolean_get:Qae,__wbindgen_is_function:ele,__wbg_rawraycolliderintersection_new:tle,__wbg_rawcontactforceevent_new:nle,__wbg_call_168da88779e35f61:rle,__wbg_call_3999bee59e9f7719:ile,__wbg_call_e1f72c051cdab859:ole,__wbg_bind_10dfe70e95d2a480:sle,__wbg_buffer_3f3d764d4747d564:ale,__wbg_newwithbyteoffsetandlength_d9aa266703cb98be:lle,__wbg_new_8c3f0052272a457a:cle,__wbg_set_83db9690f9353e79:dle,__wbg_length_9e1ae1900cb0fbd5:ule,__wbg_newwithbyteoffsetandlength_be22e5fcf4f69ab4:hle,__wbg_set_0e0314cf6675c1b9:ple,__wbg_length_9a2deed95d22668d:fle,__wbg_newwithlength_a7168e4a1e8f5e12:gle,__wbindgen_throw:mle,__wbindgen_memory:yle}},Vae),$c=M.memory,wle=M.version,ble=M.__wbg_rawkinematiccharactercontroller_free,vle=M.rawkinematiccharactercontroller_new,Eh=M.rawkinematiccharactercontroller_up,Sle=M.rawkinematiccharactercontroller_setUp,xle=M.rawkinematiccharactercontroller_offset,_le=M.rawkinematiccharactercontroller_setOffset,kle=M.rawkinematiccharactercontroller_slideEnabled,Cle=M.rawkinematiccharactercontroller_setSlideEnabled,Ele=M.rawkinematiccharactercontroller_autostepMaxHeight,Ple=M.rawkinematiccharactercontroller_autostepMinWidth,Ile=M.rawkinematiccharactercontroller_autostepIncludesDynamicBodies,Mle=M.rawkinematiccharactercontroller_autostepEnabled,Ale=M.rawkinematiccharactercontroller_enableAutostep,Tle=M.rawkinematiccharactercontroller_disableAutostep,jle=M.rawkinematiccharactercontroller_minSlopeSlideAngle,Rle=M.rawkinematiccharactercontroller_setMinSlopeSlideAngle,Dle=M.rawkinematiccharactercontroller_snapToGroundDistance,Ole=M.rawkinematiccharactercontroller_enableSnapToGround,Lle=M.rawkinematiccharactercontroller_disableSnapToGround,zle=M.rawkinematiccharactercontroller_snapToGroundEnabled,Nle=M.rawkinematiccharactercontroller_computeColliderMovement,Fle=M.rawkinematiccharactercontroller_computedMovement,$le=M.rawkinematiccharactercontroller_computedGrounded,Ble=M.rawkinematiccharactercontroller_numComputedCollisions,Ule=M.rawkinematiccharactercontroller_computedCollision,Vle=M.__wbg_rawcharactercollision_free,Hle=M.rawcharactercollision_new,Wle=M.rawcharactercollision_handle,Ph=M.rawcharactercollision_translationApplied,C5=M.rawcharactercollision_translationRemaining,Kle=M.rawcharactercollision_toi,Gle=M.rawcharactercollision_worldWitness1,Yle=M.rawcharactercollision_worldWitness2,Xle=M.rawcharactercollision_worldNormal1,qle=M.rawcharactercollision_worldNormal2,Jle=M.__wbg_rawccdsolver_free,Zle=M.rawccdsolver_new,Qle=M.rawimpulsejointset_jointType,ece=M.rawimpulsejointset_jointBodyHandle1,tce=M.rawimpulsejointset_jointBodyHandle2,nce=M.rawimpulsejointset_jointFrameX1,rce=M.rawimpulsejointset_jointFrameX2,ice=M.rawimpulsejointset_jointAnchor1,oce=M.rawimpulsejointset_jointAnchor2,sce=M.rawimpulsejointset_jointSetAnchor1,ace=M.rawimpulsejointset_jointSetAnchor2,lce=M.rawimpulsejointset_jointContactsEnabled,cce=M.rawimpulsejointset_jointSetContactsEnabled,dce=M.rawimpulsejointset_jointLimitsEnabled,uce=M.rawimpulsejointset_jointLimitsMin,hce=M.rawimpulsejointset_jointLimitsMax,pce=M.rawimpulsejointset_jointSetLimits,fce=M.rawimpulsejointset_jointConfigureMotorModel,gce=M.rawimpulsejointset_jointConfigureMotorVelocity,mce=M.rawimpulsejointset_jointConfigureMotorPosition,yce=M.rawimpulsejointset_jointConfigureMotor,wce=M.__wbg_rawimpulsejointset_free,bce=M.rawimpulsejointset_new,vce=M.rawimpulsejointset_createJoint,Sce=M.rawimpulsejointset_remove,xce=M.rawimpulsejointset_len,_ce=M.rawimpulsejointset_contains,kce=M.rawimpulsejointset_forEachJointHandle,Cce=M.rawimpulsejointset_forEachJointAttachedToRigidBody,Ece=M.__wbg_rawintegrationparameters_free,Pce=M.rawintegrationparameters_new,e_=M.rawintegrationparameters_dt,E5=M.rawintegrationparameters_erp,t_=M.rawintegrationparameters_allowedLinearError,Ice=M.rawintegrationparameters_maxVelocityIterations,Mce=M.rawintegrationparameters_maxVelocityFrictionIterations,Ace=M.rawintegrationparameters_maxStabilizationIterations,Tce=M.rawintegrationparameters_minIslandSize,jce=M.rawintegrationparameters_maxCcdSubsteps,P5=M.rawintegrationparameters_set_dt,Rce=M.rawintegrationparameters_set_erp,I5=M.rawintegrationparameters_set_allowedLinearError,Dce=M.rawintegrationparameters_set_predictionDistance,Oce=M.rawintegrationparameters_set_maxVelocityIterations,Lce=M.rawintegrationparameters_set_maxVelocityFrictionIterations,zce=M.rawintegrationparameters_set_maxStabilizationIterations,Nce=M.rawintegrationparameters_set_minIslandSize,Fce=M.rawintegrationparameters_set_maxCcdSubsteps,$ce=M.__wbg_rawislandmanager_free,Bce=M.rawislandmanager_new,Uce=M.rawislandmanager_forEachActiveRigidBodyHandle,Vce=M.__wbg_rawgenericjoint_free,Hce=M.rawgenericjoint_prismatic,Wce=M.rawgenericjoint_fixed,Kce=M.rawgenericjoint_revolute,Gce=M.rawmultibodyjointset_jointType,Yce=M.rawmultibodyjointset_jointFrameX1,Xce=M.rawmultibodyjointset_jointFrameX2,qce=M.rawmultibodyjointset_jointAnchor1,Jce=M.rawmultibodyjointset_jointAnchor2,Zce=M.rawmultibodyjointset_jointContactsEnabled,Qce=M.rawmultibodyjointset_jointSetContactsEnabled,ede=M.rawmultibodyjointset_jointLimitsEnabled,tde=M.rawmultibodyjointset_jointLimitsMin,nde=M.rawmultibodyjointset_jointLimitsMax,rde=M.__wbg_rawmultibodyjointset_free,ide=M.rawmultibodyjointset_new,ode=M.rawmultibodyjointset_createJoint,sde=M.rawmultibodyjointset_remove,ade=M.rawmultibodyjointset_contains,lde=M.rawmultibodyjointset_forEachJointHandle,cde=M.rawmultibodyjointset_forEachJointAttachedToRigidBody,dde=M.rawrigidbodyset_rbTranslation,ude=M.rawrigidbodyset_rbRotation,hde=M.rawrigidbodyset_rbSleep,pde=M.rawrigidbodyset_rbIsSleeping,fde=M.rawrigidbodyset_rbIsMoving,gde=M.rawrigidbodyset_rbNextTranslation,mde=M.rawrigidbodyset_rbNextRotation,yde=M.rawrigidbodyset_rbSetTranslation,wde=M.rawrigidbodyset_rbSetRotation,bde=M.rawrigidbodyset_rbSetLinvel,vde=M.rawrigidbodyset_rbSetAngvel,Sde=M.rawrigidbodyset_rbSetNextKinematicTranslation,xde=M.rawrigidbodyset_rbSetNextKinematicRotation,_de=M.rawrigidbodyset_rbRecomputeMassPropertiesFromColliders,kde=M.rawrigidbodyset_rbSetAdditionalMass,Cde=M.rawrigidbodyset_rbSetAdditionalMassProperties,Ede=M.rawrigidbodyset_rbLinvel,Pde=M.rawrigidbodyset_rbAngvel,Ide=M.rawrigidbodyset_rbLockTranslations,Mde=M.rawrigidbodyset_rbSetEnabledTranslations,Ade=M.rawrigidbodyset_rbLockRotations,Tde=M.rawrigidbodyset_rbDominanceGroup,jde=M.rawrigidbodyset_rbSetDominanceGroup,Rde=M.rawrigidbodyset_rbEnableCcd,Dde=M.rawrigidbodyset_rbMass,Ode=M.rawrigidbodyset_rbInvMass,Lde=M.rawrigidbodyset_rbEffectiveInvMass,zde=M.rawrigidbodyset_rbLocalCom,Nde=M.rawrigidbodyset_rbWorldCom,Fde=M.rawrigidbodyset_rbInvPrincipalInertiaSqrt,$de=M.rawrigidbodyset_rbPrincipalInertia,Bde=M.rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt,Ude=M.rawrigidbodyset_rbEffectiveAngularInertia,Vde=M.rawrigidbodyset_rbWakeUp,Hde=M.rawrigidbodyset_rbIsCcdEnabled,Wde=M.rawrigidbodyset_rbNumColliders,Kde=M.rawrigidbodyset_rbCollider,Gde=M.rawrigidbodyset_rbBodyType,Yde=M.rawrigidbodyset_rbSetBodyType,Xde=M.rawrigidbodyset_rbIsFixed,qde=M.rawrigidbodyset_rbIsKinematic,Jde=M.rawrigidbodyset_rbIsDynamic,Zde=M.rawrigidbodyset_rbLinearDamping,Qde=M.rawrigidbodyset_rbAngularDamping,eue=M.rawrigidbodyset_rbSetLinearDamping,tue=M.rawrigidbodyset_rbSetAngularDamping,nue=M.rawrigidbodyset_rbSetEnabled,rue=M.rawrigidbodyset_rbIsEnabled,iue=M.rawrigidbodyset_rbGravityScale,oue=M.rawrigidbodyset_rbSetGravityScale,sue=M.rawrigidbodyset_rbResetForces,aue=M.rawrigidbodyset_rbResetTorques,lue=M.rawrigidbodyset_rbAddForce,cue=M.rawrigidbodyset_rbApplyImpulse,due=M.rawrigidbodyset_rbAddTorque,uue=M.rawrigidbodyset_rbApplyTorqueImpulse,hue=M.rawrigidbodyset_rbAddForceAtPoint,pue=M.rawrigidbodyset_rbApplyImpulseAtPoint,fue=M.rawrigidbodyset_rbUserData,gue=M.rawrigidbodyset_rbSetUserData,mue=M.__wbg_rawrigidbodyset_free,yue=M.rawrigidbodyset_new,wue=M.rawrigidbodyset_createRigidBody,bue=M.rawrigidbodyset_remove,vue=M.rawrigidbodyset_len,Sue=M.rawrigidbodyset_contains,xue=M.rawrigidbodyset_forEachRigidBodyHandle,_ue=M.rawrigidbodyset_propagateModifiedBodyPositionsToColliders,kue=M.__wbg_rawbroadphase_free,Cue=M.rawbroadphase_new,Eue=M.rawcolliderset_coTranslation,Pue=M.rawcolliderset_coRotation,Iue=M.rawcolliderset_coSetTranslation,Mue=M.rawcolliderset_coSetTranslationWrtParent,Aue=M.rawcolliderset_coSetRotation,Tue=M.rawcolliderset_coSetRotationWrtParent,jue=M.rawcolliderset_coIsSensor,Rue=M.rawcolliderset_coShapeType,Due=M.rawcolliderset_coHalfspaceNormal,Oue=M.rawcolliderset_coHalfExtents,Lue=M.rawcolliderset_coSetHalfExtents,zue=M.rawcolliderset_coRadius,Nue=M.rawcolliderset_coSetRadius,Fue=M.rawcolliderset_coHalfHeight,$ue=M.rawcolliderset_coSetHalfHeight,Bue=M.rawcolliderset_coRoundRadius,Uue=M.rawcolliderset_coSetRoundRadius,Vue=M.rawcolliderset_coVertices,Hue=M.rawcolliderset_coIndices,Wue=M.rawcolliderset_coHeightfieldHeights,Kue=M.rawcolliderset_coHeightfieldScale,Gue=M.rawcolliderset_coParent,Yue=M.rawcolliderset_coSetEnabled,Xue=M.rawcolliderset_coIsEnabled,que=M.rawcolliderset_coFriction,Jue=M.rawcolliderset_coRestitution,Zue=M.rawcolliderset_coDensity,Que=M.rawcolliderset_coMass,ehe=M.rawcolliderset_coVolume,the=M.rawcolliderset_coCollisionGroups,nhe=M.rawcolliderset_coSolverGroups,rhe=M.rawcolliderset_coActiveHooks,ihe=M.rawcolliderset_coActiveCollisionTypes,ohe=M.rawcolliderset_coActiveEvents,she=M.rawcolliderset_coContactForceEventThreshold,ahe=M.rawcolliderset_coContainsPoint,lhe=M.rawcolliderset_coCastShape,che=M.rawcolliderset_coCastCollider,dhe=M.rawcolliderset_coIntersectsShape,uhe=M.rawcolliderset_coContactShape,hhe=M.rawcolliderset_coContactCollider,phe=M.rawcolliderset_coProjectPoint,fhe=M.rawcolliderset_coIntersectsRay,ghe=M.rawcolliderset_coCastRay,mhe=M.rawcolliderset_coCastRayAndGetNormal,yhe=M.rawcolliderset_coSetSensor,whe=M.rawcolliderset_coSetRestitution,bhe=M.rawcolliderset_coSetFriction,vhe=M.rawcolliderset_coFrictionCombineRule,She=M.rawcolliderset_coSetFrictionCombineRule,xhe=M.rawcolliderset_coRestitutionCombineRule,_he=M.rawcolliderset_coSetRestitutionCombineRule,khe=M.rawcolliderset_coSetCollisionGroups,Che=M.rawcolliderset_coSetSolverGroups,Ehe=M.rawcolliderset_coSetActiveHooks,Phe=M.rawcolliderset_coSetActiveEvents,Ihe=M.rawcolliderset_coSetActiveCollisionTypes,Mhe=M.rawcolliderset_coSetShape,Ahe=M.rawcolliderset_coSetContactForceEventThreshold,The=M.rawcolliderset_coSetDensity,jhe=M.rawcolliderset_coSetMass,Rhe=M.rawcolliderset_coSetMassProperties,Dhe=M.__wbg_rawcolliderset_free,Ohe=M.rawcolliderset_new,Lhe=M.rawcolliderset_len,M5=M.rawcolliderset_contains,zhe=M.rawcolliderset_createCollider,Nhe=M.rawcolliderset_remove,Fhe=M.rawcolliderset_forEachColliderHandle,$he=M.__wbg_rawshapecontact_free,Bhe=M.__wbg_rawnarrowphase_free,Uhe=M.rawnarrowphase_new,Vhe=M.rawnarrowphase_contacts_with,Hhe=M.rawnarrowphase_contact_pair,Whe=M.rawnarrowphase_intersections_with,Khe=M.rawnarrowphase_intersection_pair,Ghe=M.__wbg_rawcontactmanifold_free,Yhe=M.rawcontactpair_collider1,Xhe=M.rawcontactpair_collider2,qhe=M.rawcontactpair_numContactManifolds,Jhe=M.rawcontactpair_contactManifold,Zhe=M.rawcontactmanifold_normal,Qhe=M.rawcontactmanifold_local_n1,epe=M.rawcontactmanifold_local_n2,tpe=M.rawcontactmanifold_subshape1,npe=M.rawcontactmanifold_subshape2,rpe=M.rawcontactmanifold_num_contacts,ipe=M.rawcontactmanifold_contact_local_p1,ope=M.rawcontactmanifold_contact_local_p2,spe=M.rawcontactmanifold_contact_dist,ape=M.rawcontactmanifold_contact_fid1,lpe=M.rawcontactmanifold_contact_fid2,cpe=M.rawcontactmanifold_contact_impulse,dpe=M.rawcontactmanifold_contact_tangent_impulse,upe=M.rawcontactmanifold_num_solver_contacts,hpe=M.rawcontactmanifold_solver_contact_point,ppe=M.rawcontactmanifold_solver_contact_dist,fpe=M.rawcontactmanifold_solver_contact_friction,gpe=M.rawcontactmanifold_solver_contact_restitution,mpe=M.rawcontactmanifold_solver_contact_tangent_velocity,ype=M.__wbg_rawpointprojection_free,wpe=M.rawpointprojection_isInside,bpe=M.__wbg_rawpointcolliderprojection_free,vpe=M.rawpointcolliderprojection_isInside,A5=M.rawpointcolliderprojection_featureType,T5=M.rawpointcolliderprojection_featureId,Spe=M.__wbg_rawrayintersection_free,xpe=M.rawrayintersection_toi,jy=M.rawraycolliderintersection_normal,_pe=M.rawraycolliderintersection_featureType,kpe=M.rawraycolliderintersection_featureId,Cpe=M.__wbg_rawshape_free,Epe=M.rawshape_cuboid,Ppe=M.rawshape_roundCuboid,Ipe=M.rawshape_ball,Mpe=M.rawshape_halfspace,Ape=M.rawshape_capsule,Tpe=M.rawshape_polyline,jpe=M.rawshape_trimesh,Rpe=M.rawshape_heightfield,Dpe=M.rawshape_segment,Ope=M.rawshape_triangle,Lpe=M.rawshape_roundTriangle,zpe=M.rawshape_convexHull,Npe=M.rawshape_roundConvexHull,Fpe=M.rawshape_convexPolyline,$pe=M.rawshape_roundConvexPolyline,Bpe=M.rawshape_castShape,Upe=M.rawshape_intersectsShape,Vpe=M.rawshape_contactShape,Hpe=M.rawshape_containsPoint,Wpe=M.rawshape_projectPoint,Kpe=M.rawshape_intersectsRay,Gpe=M.rawshape_castRay,Ype=M.rawshape_castRayAndGetNormal,Xpe=M.__wbg_rawshapecollidertoi_free,qpe=M.rawshapecollidertoi_toi,Jpe=M.__wbg_rawrotation_free,Zpe=M.rawrotation_identity,Qpe=M.rawrotation_fromAngle,j5=M.rawrotation_im,efe=M.rawrotation_angle,tfe=M.rawvector_zero,nfe=M.rawvector_new,rfe=M.rawvector_set_y,ife=M.rawvector_xy,ofe=M.rawvector_yx,sfe=M.__wbg_rawdebugrenderpipeline_free,afe=M.rawdebugrenderpipeline_new,lfe=M.rawdebugrenderpipeline_vertices,cfe=M.rawdebugrenderpipeline_colors,dfe=M.rawdebugrenderpipeline_render,ufe=M.__wbg_raweventqueue_free,hfe=M.__wbg_rawcontactforceevent_free,Ih=M.rawcontactforceevent_collider1,pfe=M.rawcontactforceevent_collider2,Mh=M.rawcontactforceevent_total_force,Ry=M.rawcontactforceevent_total_force_magnitude,ffe=M.rawcontactforceevent_max_force_magnitude,gfe=M.raweventqueue_new,mfe=M.raweventqueue_drainCollisionEvents,yfe=M.raweventqueue_drainContactForceEvents,wfe=M.raweventqueue_clear,bfe=M.__wbg_rawphysicspipeline_free,vfe=M.rawphysicspipeline_new,Sfe=M.rawphysicspipeline_step,xfe=M.rawphysicspipeline_stepWithEvents,_fe=M.__wbg_rawquerypipeline_free,kfe=M.rawquerypipeline_new,Cfe=M.rawquerypipeline_update,Efe=M.rawquerypipeline_castRay,Pfe=M.rawquerypipeline_castRayAndGetNormal,Ife=M.rawquerypipeline_intersectionsWithRay,Mfe=M.rawquerypipeline_intersectionWithShape,Afe=M.rawquerypipeline_projectPoint,Tfe=M.rawquerypipeline_projectPointAndGetFeature,jfe=M.rawquerypipeline_intersectionsWithPoint,Rfe=M.rawquerypipeline_castShape,Dfe=M.rawquerypipeline_intersectionsWithShape,Ofe=M.rawquerypipeline_collidersWithAabbIntersectingAabb,Lfe=M.__wbg_rawdeserializedworld_free,zfe=M.rawdeserializedworld_takeGravity,Nfe=M.rawdeserializedworld_takeIntegrationParameters,Ffe=M.rawdeserializedworld_takeIslandManager,$fe=M.rawdeserializedworld_takeBroadPhase,Bfe=M.rawdeserializedworld_takeNarrowPhase,Ufe=M.rawdeserializedworld_takeBodies,Vfe=M.rawdeserializedworld_takeColliders,Hfe=M.rawdeserializedworld_takeImpulseJoints,Wfe=M.rawdeserializedworld_takeMultibodyJoints,Kfe=M.rawserializationpipeline_serializeAll,Gfe=M.rawserializationpipeline_deserializeAll,Yfe=M.__wbg_rawcontactpair_free,Xfe=M.__wbg_rawraycolliderintersection_free,qfe=M.__wbg_rawraycollidertoi_free,Jfe=M.__wbg_rawvector_free,Zfe=M.__wbg_rawshapetoi_free;M.rawkinematiccharactercontroller_setMaxSlopeClimbAngle,M.rawvector_set_x,M.rawcolliderset_isHandleValid,M.rawrayintersection_featureType,M.rawrayintersection_featureId,M.rawshapecontact_point1,M.rawshapecontact_normal2,M.rawpointprojection_point,M.rawshapecontact_normal1,M.rawrayintersection_normal,M.rawshapecontact_point2,M.rawshapetoi_witness1,M.rawshapetoi_witness2,M.rawshapetoi_normal1,M.rawshapetoi_normal2,M.rawshapecollidertoi_witness1,M.rawshapecollidertoi_witness2,M.rawshapecollidertoi_normal1,M.rawshapecollidertoi_normal2,M.rawpointcolliderprojection_point,M.rawcontactforceevent_max_force_direction;const Qfe=M.rawserializationpipeline_new;M.rawkinematiccharactercontroller_maxSlopeClimbAngle,M.rawshapecontact_distance,M.rawraycolliderintersection_toi,M.rawraycollidertoi_toi,M.rawshapetoi_toi,M.rawrotation_re,M.rawvector_x,M.rawvector_y,M.rawintegrationparameters_predictionDistance,M.rawraycolliderintersection_colliderHandle,M.rawraycollidertoi_colliderHandle,M.rawshapecollidertoi_colliderHandle,M.rawpointcolliderprojection_colliderHandle;const ege=M.__wbg_rawserializationpipeline_free,Ne=M.__wbindgen_add_to_stack_pointer,Dy=M.__wbindgen_free,Ho=M.__wbindgen_malloc,tge=M.__wbindgen_exn_store;class R5{constructor(e,t){this.x=e,this.y=t}}class U{static new(e,t){return new R5(e,t)}static zeros(){return U.new(0,0)}static fromRaw(e){if(!e)return null;let t=U.new(e.x,e.y);return e.free(),t}static intoRaw(e){return new V(e.x,e.y)}static copy(e,t){e.x=t.x,e.y=t.y}}class rt{static identity(){return 0}static fromRaw(e){if(!e)return null;let t=e.angle;return e.free(),t}static intoRaw(e){return Le.fromAngle(e)}}var vi;(function(n){n[n.Dynamic=0]="Dynamic",n[n.Fixed=1]="Fixed",n[n.KinematicPositionBased=2]="KinematicPositionBased",n[n.KinematicVelocityBased=3]="KinematicVelocityBased"})(vi||(vi={}));class n_{constructor(e,t,r){this.rawSet=e,this.colliderSet=t,this.handle=r}finalizeDeserialization(e){this.colliderSet=e}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(e,t){return this.rawSet.rbLockTranslations(this.handle,e,t)}lockRotations(e,t){return this.rawSet.rbLockRotations(this.handle,e,t)}setEnabledTranslations(e,t,r){return this.rawSet.rbSetEnabledTranslations(this.handle,e,t,r)}restrictTranslations(e,t,r){this.setEnabledTranslations(e,e,r)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(e){this.rawSet.rbSetDominanceGroup(this.handle,e)}enableCcd(e){this.rawSet.rbEnableCcd(this.handle,e)}translation(){let e=this.rawSet.rbTranslation(this.handle);return U.fromRaw(e)}rotation(){let e=this.rawSet.rbRotation(this.handle);return rt.fromRaw(e)}nextTranslation(){let e=this.rawSet.rbNextTranslation(this.handle);return U.fromRaw(e)}nextRotation(){let e=this.rawSet.rbNextRotation(this.handle);return rt.fromRaw(e)}setTranslation(e,t){this.rawSet.rbSetTranslation(this.handle,e.x,e.y,t)}setLinvel(e,t){let r=U.intoRaw(e);this.rawSet.rbSetLinvel(this.handle,r,t),r.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(e,t){this.rawSet.rbSetGravityScale(this.handle,e,t)}setRotation(e,t){this.rawSet.rbSetRotation(this.handle,e,t)}setAngvel(e,t){this.rawSet.rbSetAngvel(this.handle,e,t)}setNextKinematicTranslation(e){this.rawSet.rbSetNextKinematicTranslation(this.handle,e.x,e.y)}setNextKinematicRotation(e){this.rawSet.rbSetNextKinematicRotation(this.handle,e)}linvel(){return U.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return this.rawSet.rbAngvel(this.handle)}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return U.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return U.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return U.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return this.rawSet.rbInvPrincipalInertiaSqrt(this.handle)}principalInertia(){return this.rawSet.rbPrincipalInertia(this.handle)}effectiveWorldInvInertiaSqrt(){return this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle)}effectiveAngularInertia(){return this.rawSet.rbEffectiveAngularInertia(this.handle)}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(e){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,e))}setEnabled(e){this.rawSet.rbSetEnabled(this.handle,e)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(e,t){return this.rawSet.rbSetBodyType(this.handle,e,t)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(e){this.rawSet.rbSetLinearDamping(this.handle,e)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(e,t){this.rawSet.rbSetAdditionalMass(this.handle,e,t)}setAdditionalMassProperties(e,t,r,i){let o=U.intoRaw(t);this.rawSet.rbSetAdditionalMassProperties(this.handle,e,o,r,i),o.free()}setAngularDamping(e){this.rawSet.rbSetAngularDamping(this.handle,e)}resetForces(e){this.rawSet.rbResetForces(this.handle,e)}resetTorques(e){this.rawSet.rbResetTorques(this.handle,e)}addForce(e,t){const r=U.intoRaw(e);this.rawSet.rbAddForce(this.handle,r,t),r.free()}applyImpulse(e,t){const r=U.intoRaw(e);this.rawSet.rbApplyImpulse(this.handle,r,t),r.free()}addTorque(e,t){this.rawSet.rbAddTorque(this.handle,e,t)}applyTorqueImpulse(e,t){this.rawSet.rbApplyTorqueImpulse(this.handle,e,t)}addForceAtPoint(e,t,r){const i=U.intoRaw(e),o=U.intoRaw(t);this.rawSet.rbAddForceAtPoint(this.handle,i,o,r),i.free(),o.free()}applyImpulseAtPoint(e,t,r){const i=U.intoRaw(e),o=U.intoRaw(t);this.rawSet.rbApplyImpulseAtPoint(this.handle,i,o,r),i.free(),o.free()}}class Qi{constructor(e){this.enabled=!0,this.status=e,this.translation=U.zeros(),this.rotation=rt.identity(),this.gravityScale=1,this.linvel=U.zeros(),this.mass=0,this.massOnly=!1,this.centerOfMass=U.zeros(),this.translationsEnabledX=!0,this.translationsEnabledY=!0,this.angvel=0,this.principalAngularInertia=0,this.rotationsEnabled=!0,this.linearDamping=0,this.angularDamping=0,this.canSleep=!0,this.sleeping=!1,this.ccdEnabled=!1,this.dominanceGroup=0}static dynamic(){return new Qi(vi.Dynamic)}static kinematicPositionBased(){return new Qi(vi.KinematicPositionBased)}static kinematicVelocityBased(){return new Qi(vi.KinematicVelocityBased)}static fixed(){return new Qi(vi.Fixed)}static newDynamic(){return new Qi(vi.Dynamic)}static newKinematicPositionBased(){return new Qi(vi.KinematicPositionBased)}static newKinematicVelocityBased(){return new Qi(vi.KinematicVelocityBased)}static newStatic(){return new Qi(vi.Fixed)}setDominanceGroup(e){return this.dominanceGroup=e,this}setEnabled(e){return this.enabled=e,this}setTranslation(e,t){if(typeof e!="number"||typeof t!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:t},this}setRotation(e){return this.rotation=e,this}setGravityScale(e){return this.gravityScale=e,this}setAdditionalMass(e){return this.mass=e,this.massOnly=!0,this}setLinvel(e,t){if(typeof e!="number"||typeof t!="number")throw TypeError("The linvel components must be numbers.");return this.linvel={x:e,y:t},this}setAngvel(e){return this.angvel=e,this}setAdditionalMassProperties(e,t,r){return this.mass=e,U.copy(this.centerOfMass,t),this.principalAngularInertia=r,this.massOnly=!1,this}enabledTranslations(e,t){return this.translationsEnabledX=e,this.translationsEnabledY=t,this}restrictTranslations(e,t){return this.enabledTranslations(e,t)}lockTranslations(){return this.restrictTranslations(!1,!1)}lockRotations(){return this.rotationsEnabled=!1,this}setLinearDamping(e){return this.linearDamping=e,this}setAngularDamping(e){return this.angularDamping=e,this}setCanSleep(e){return this.canSleep=e,this}setSleeping(e){return this.sleeping=e,this}setCcdEnabled(e){return this.ccdEnabled=e,this}setUserData(e){return this.userData=e,this}}class Oy{constructor(){this.fconv=new Float64Array(1),this.uconv=new Uint32Array(this.fconv.buffer),this.data=new Array,this.size=0}set(e,t){let r=this.index(e);for(;this.data.length<=r;)this.data.push(null);this.data[r]==null&&(this.size+=1),this.data[r]=t}len(){return this.size}delete(e){let t=this.index(e);t<this.data.length&&(this.data[t]!=null&&(this.size-=1),this.data[t]=null)}clear(){this.data=new Array}get(e){let t=this.index(e);return t<this.data.length?this.data[t]:null}forEach(e){for(const t of this.data)t!=null&&e(t)}getAll(){return this.data.filter(e=>e!=null)}index(e){return this.fconv[0]=e,this.uconv[0]}}class D5{constructor(e){this.raw=e||new At,this.map=new Oy,e&&e.forEachRigidBodyHandle(t=>{this.map.set(t,new n_(e,null,t))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}finalizeDeserialization(e){this.map.forEach(t=>t.finalizeDeserialization(e))}createRigidBody(e,t){let r=U.intoRaw(t.translation),i=rt.intoRaw(t.rotation),o=U.intoRaw(t.linvel),s=U.intoRaw(t.centerOfMass),a=this.raw.createRigidBody(t.enabled,r,i,t.gravityScale,t.mass,t.massOnly,s,o,t.angvel,t.principalAngularInertia,t.translationsEnabledX,t.translationsEnabledY,t.rotationsEnabled,t.linearDamping,t.angularDamping,t.status,t.canSleep,t.sleeping,t.ccdEnabled,t.dominanceGroup);r.free(),i.free(),o.free(),s.free();const l=new n_(this.raw,e,a);return l.userData=t.userData,this.map.set(a,l),l}remove(e,t,r,i,o){for(let s=0;s<this.raw.rbNumColliders(e);s+=1)r.unmap(this.raw.rbCollider(e,s));i.forEachJointHandleAttachedToRigidBody(e,s=>i.unmap(s)),o.forEachJointHandleAttachedToRigidBody(e,s=>o.unmap(s)),this.raw.remove(e,t.raw,r.raw,i.raw,o.raw),this.map.delete(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}get(e){return this.map.get(e)}forEach(e){this.map.forEach(e)}forEachActiveRigidBody(e,t){e.forEachActiveRigidBodyHandle(r=>{t(this.get(r))})}getAll(){return this.map.getAll()}}class O5{constructor(e){this.raw=e||new Ks}free(){this.raw&&this.raw.free(),this.raw=void 0}get dt(){return this.raw.dt}get erp(){return this.raw.erp}get allowedLinearError(){return this.raw.allowedLinearError}get predictionDistance(){return this.raw.predictionDistance}get maxVelocityIterations(){return this.raw.maxVelocityIterations}get maxVelocityFrictionIterations(){return this.raw.maxVelocityFrictionIterations}get maxStabilizationIterations(){return this.raw.maxStabilizationIterations}get minIslandSize(){return this.raw.minIslandSize}get maxCcdSubsteps(){return this.raw.maxCcdSubsteps}set dt(e){this.raw.dt=e}set erp(e){this.raw.erp=e}set allowedLinearError(e){this.raw.allowedLinearError=e}set predictionDistance(e){this.raw.predictionDistance=e}set maxVelocityIterations(e){this.raw.maxVelocityIterations=e}set maxVelocityFrictionIterations(e){this.raw.maxVelocityFrictionIterations=e}set maxStabilizationIterations(e){this.raw.maxStabilizationIterations=e}set minIslandSize(e){this.raw.minIslandSize=e}set maxCcdSubsteps(e){this.raw.maxCcdSubsteps=e}}var $n;(function(n){n[n.Revolute=0]="Revolute",n[n.Fixed=1]="Fixed",n[n.Prismatic=2]="Prismatic"})($n||($n={}));var r_;(function(n){n[n.AccelerationBased=0]="AccelerationBased",n[n.ForceBased=1]="ForceBased"})(r_||(r_={}));class Ua{constructor(e,t,r){this.rawSet=e,this.bodySet=t,this.handle=r}static newTyped(e,t,r){switch(e.jointType(r)){case $n.Revolute:return new N5(e,t,r);case $n.Prismatic:return new z5(e,t,r);case $n.Fixed:return new L5(e,t,r);default:return new Ua(e,t,r)}}finalizeDeserialization(e){this.bodySet=e}isValid(){return this.rawSet.contains(this.handle)}body1(){return this.bodySet.get(this.rawSet.jointBodyHandle1(this.handle))}body2(){return this.bodySet.get(this.rawSet.jointBodyHandle2(this.handle))}type(){return this.rawSet.jointType(this.handle)}anchor1(){return U.fromRaw(this.rawSet.jointAnchor1(this.handle))}anchor2(){return U.fromRaw(this.rawSet.jointAnchor2(this.handle))}setAnchor1(e){const t=U.intoRaw(e);this.rawSet.jointSetAnchor1(this.handle,t),t.free()}setAnchor2(e){const t=U.intoRaw(e);this.rawSet.jointSetAnchor2(this.handle,t),t.free()}setContactsEnabled(e){this.rawSet.jointSetContactsEnabled(this.handle,e)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class i_ extends Ua{limitsEnabled(){return this.rawSet.jointLimitsEnabled(this.handle,this.rawAxis())}limitsMin(){return this.rawSet.jointLimitsMin(this.handle,this.rawAxis())}limitsMax(){return this.rawSet.jointLimitsMax(this.handle,this.rawAxis())}setLimits(e,t){this.rawSet.jointSetLimits(this.handle,this.rawAxis(),e,t)}configureMotorModel(e){this.rawSet.jointConfigureMotorModel(this.handle,this.rawAxis(),e)}configureMotorVelocity(e,t){this.rawSet.jointConfigureMotorVelocity(this.handle,this.rawAxis(),e,t)}configureMotorPosition(e,t,r){this.rawSet.jointConfigureMotorPosition(this.handle,this.rawAxis(),e,t,r)}configureMotor(e,t,r,i){this.rawSet.jointConfigureMotor(this.handle,this.rawAxis(),e,t,r,i)}}class L5 extends Ua{}class z5 extends i_{rawAxis(){return Sy.X}}class N5 extends i_{rawAxis(){return Sy.AngX}}class Ah{constructor(){}static fixed(e,t,r,i){let o=new Ah;return o.anchor1=e,o.anchor2=r,o.frame1=t,o.frame2=i,o.jointType=$n.Fixed,o}static revolute(e,t){let r=new Ah;return r.anchor1=e,r.anchor2=t,r.jointType=$n.Revolute,r}static prismatic(e,t,r){let i=new Ah;return i.anchor1=e,i.anchor2=t,i.axis=r,i.jointType=$n.Prismatic,i}intoRaw(){let e=U.intoRaw(this.anchor1),t=U.intoRaw(this.anchor2),r,i,o=!1,s=0,a=0;switch(this.jointType){case $n.Fixed:let l=rt.intoRaw(this.frame1),c=rt.intoRaw(this.frame2);i=Xi.fixed(e,l,t,c),l.free(),c.free();break;case $n.Prismatic:r=U.intoRaw(this.axis),this.limitsEnabled&&(o=!0,s=this.limits[0],a=this.limits[1]),i=Xi.prismatic(e,t,r,o,s,a),r.free();break;case $n.Revolute:i=Xi.revolute(e,t);break}return e.free(),t.free(),i}}class F5{constructor(e){this.raw=e||new qi,this.map=new Oy,e&&e.forEachJointHandle(t=>{this.map.set(t,Ua.newTyped(e,null,t))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}finalizeDeserialization(e){this.map.forEach(t=>t.finalizeDeserialization(e))}createJoint(e,t,r,i,o){const s=t.intoRaw(),a=this.raw.createJoint(s,r,i,o);s.free();let l=Ua.newTyped(this.raw,e,a);return this.map.set(a,l),l}remove(e,t){this.raw.remove(e,t),this.unmap(e)}forEachJointHandleAttachedToRigidBody(e,t){this.raw.forEachJointAttachedToRigidBody(e,t)}unmap(e){this.map.delete(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}get(e){return this.map.get(e)}forEach(e){this.map.forEach(e)}getAll(){return this.map.getAll()}}class Va{constructor(e,t){this.rawSet=e,this.handle=t}static newTyped(e,t){switch(e.jointType(t)){case $n.Revolute:return new U5(e,t);case $n.Prismatic:return new B5(e,t);case $n.Fixed:return new $5(e,t);default:return new Va(e,t)}}isValid(){return this.rawSet.contains(this.handle)}setContactsEnabled(e){this.rawSet.jointSetContactsEnabled(this.handle,e)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class o_ extends Va{}class $5 extends Va{}class B5 extends o_{rawAxis(){return Sy.X}}class U5 extends o_{rawAxis(){return Sy.AngX}}class V5{constructor(e){this.raw=e||new Zi,this.map=new Oy,e&&e.forEachJointHandle(t=>{this.map.set(t,Va.newTyped(this.raw,t))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}createJoint(e,t,r,i){const o=e.intoRaw(),s=this.raw.createJoint(o,t,r,i);o.free();let a=Va.newTyped(this.raw,s);return this.map.set(s,a),a}remove(e,t){this.raw.remove(e,t),this.map.delete(e)}unmap(e){this.map.delete(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}get(e){return this.map.get(e)}forEach(e){this.map.forEach(e)}forEachJointHandleAttachedToRigidBody(e,t){this.raw.forEachJointAttachedToRigidBody(e,t)}getAll(){return this.map.getAll()}}var Th;(function(n){n[n.Average=0]="Average",n[n.Min=1]="Min",n[n.Multiply=2]="Multiply",n[n.Max=3]="Max"})(Th||(Th={}));class H5{constructor(e){this.raw=e||new Fc}free(){this.raw&&this.raw.free(),this.raw=void 0}}class W5{constructor(e){this.raw=e||new Ji}free(){this.raw&&this.raw.free(),this.raw=void 0}forEachActiveRigidBodyHandle(e){this.raw.forEachActiveRigidBodyHandle(e)}}class K5{constructor(e){this.raw=e||new Ws}free(){this.raw&&this.raw.free(),this.raw=void 0}}class G5{constructor(e){this.raw=e||new Vo,this.tempManifold=new Y5(null)}free(){this.raw&&this.raw.free(),this.raw=void 0}contactsWith(e,t){this.raw.contacts_with(e,t)}intersectionsWith(e,t){this.raw.intersections_with(e,t)}contactPair(e,t,r){const i=this.raw.contact_pair(e,t);if(i){const o=i.collider1()!=e;let s;for(s=0;s<i.numContactManifolds();++s)this.tempManifold.raw=i.contactManifold(s),this.tempManifold.raw&&r(this.tempManifold,o),this.tempManifold.free();i.free()}}intersectionPair(e,t){return this.raw.intersection_pair(e,t)}}class Y5{constructor(e){this.raw=e}free(){this.raw&&this.raw.free(),this.raw=void 0}normal(){return U.fromRaw(this.raw.normal())}localNormal1(){return U.fromRaw(this.raw.local_n1())}localNormal2(){return U.fromRaw(this.raw.local_n2())}subshape1(){return this.raw.subshape1()}subshape2(){return this.raw.subshape2()}numContacts(){return this.raw.num_contacts()}localContactPoint1(e){return U.fromRaw(this.raw.contact_local_p1(e))}localContactPoint2(e){return U.fromRaw(this.raw.contact_local_p2(e))}contactDist(e){return this.raw.contact_dist(e)}contactFid1(e){return this.raw.contact_fid1(e)}contactFid2(e){return this.raw.contact_fid2(e)}contactImpulse(e){return this.raw.contact_impulse(e)}contactTangentImpulse(e){return this.raw.contact_tangent_impulse(e)}numSolverContacts(){return this.raw.num_solver_contacts()}solverContactPoint(e){return U.fromRaw(this.raw.solver_contact_point(e))}solverContactDist(e){return this.raw.solver_contact_dist(e)}solverContactFriction(e){return this.raw.solver_contact_friction(e)}solverContactRestitution(e){return this.raw.solver_contact_restitution(e)}solverContactTangentVelocity(e){return U.fromRaw(this.raw.solver_contact_tangent_velocity(e))}}class Bc{constructor(e,t,r,i,o){this.distance=e,this.point1=t,this.point2=r,this.normal1=i,this.normal2=o}static fromRaw(e){if(!e)return null;const t=new Bc(e.distance(),U.fromRaw(e.point1()),U.fromRaw(e.point2()),U.fromRaw(e.normal1()),U.fromRaw(e.normal2()));return e.free(),t}}var Uc;(function(n){n[n.Vertex=0]="Vertex",n[n.Face=1]="Face",n[n.Unknown=2]="Unknown"})(Uc||(Uc={}));class jh{constructor(e,t){this.point=e,this.isInside=t}static fromRaw(e){if(!e)return null;const t=new jh(U.fromRaw(e.point()),e.isInside());return e.free(),t}}class Rh{constructor(e,t,r,i,o){this.featureType=Uc.Unknown,this.featureId=void 0,this.collider=e,this.point=t,this.isInside=r,o!==void 0&&(this.featureId=o),i!==void 0&&(this.featureType=i)}static fromRaw(e,t){if(!t)return null;const r=new Rh(e.get(t.colliderHandle()),U.fromRaw(t.point()),t.isInside(),t.featureType(),t.featureId());return t.free(),r}}class nge{constructor(e,t){this.origin=e,this.dir=t}pointAt(e){return{x:this.origin.x+this.dir.x*e,y:this.origin.y+this.dir.y*e}}}class Dh{constructor(e,t,r,i){this.featureType=Uc.Unknown,this.featureId=void 0,this.toi=e,this.normal=t,i!==void 0&&(this.featureId=i),r!==void 0&&(this.featureType=r)}static fromRaw(e){if(!e)return null;const t=new Dh(e.toi(),U.fromRaw(e.normal()),e.featureType(),e.featureId());return e.free(),t}}class Oh{constructor(e,t,r,i,o){this.featureType=Uc.Unknown,this.featureId=void 0,this.collider=e,this.toi=t,this.normal=r,o!==void 0&&(this.featureId=o),i!==void 0&&(this.featureType=i)}static fromRaw(e,t){if(!t)return null;const r=new Oh(e.get(t.colliderHandle()),t.toi(),U.fromRaw(t.normal()),t.featureType(),t.featureId());return t.free(),r}}class Ly{constructor(e,t){this.collider=e,this.toi=t}static fromRaw(e,t){if(!t)return null;const r=new Ly(e.get(t.colliderHandle()),t.toi());return t.free(),r}}class Vc{constructor(e,t,r,i,o){this.toi=e,this.witness1=t,this.witness2=r,this.normal1=i,this.normal2=o}static fromRaw(e,t){if(!t)return null;const r=new Vc(t.toi(),U.fromRaw(t.witness1()),U.fromRaw(t.witness2()),U.fromRaw(t.normal1()),U.fromRaw(t.normal2()));return t.free(),r}}class Lh extends Vc{constructor(e,t,r,i,o,s){super(t,r,i,o,s),this.collider=e}static fromRaw(e,t){if(!t)return null;const r=new Lh(e.get(t.colliderHandle()),t.toi(),U.fromRaw(t.witness1()),U.fromRaw(t.witness2()),U.fromRaw(t.normal1()),U.fromRaw(t.normal2()));return t.free(),r}}class Bn{static fromRaw(e,t){const r=e.coShapeType(t);let i,o,s,a,l,c,d;switch(r){case Ze.Ball:return new s_(e.coRadius(t));case Ze.Cuboid:return i=e.coHalfExtents(t),new l_(i.x,i.y);case Ze.RoundCuboid:return i=e.coHalfExtents(t),o=e.coRoundRadius(t),new c_(i.x,i.y,o);case Ze.Capsule:return l=e.coHalfHeight(t),c=e.coRadius(t),new d_(l,c);case Ze.Segment:return s=e.coVertices(t),new u_(U.new(s[0],s[1]),U.new(s[2],s[3]));case Ze.Polyline:return s=e.coVertices(t),a=e.coIndices(t),new f_(s,a);case Ze.Triangle:return s=e.coVertices(t),new h_(U.new(s[0],s[1]),U.new(s[2],s[3]),U.new(s[4],s[5]));case Ze.RoundTriangle:return s=e.coVertices(t),o=e.coRoundRadius(t),new p_(U.new(s[0],s[1]),U.new(s[2],s[3]),U.new(s[4],s[5]),o);case Ze.HalfSpace:return d=U.fromRaw(e.coHalfspaceNormal(t)),new a_(d);case Ze.TriMesh:return s=e.coVertices(t),a=e.coIndices(t),new g_(s,a);case Ze.HeightField:const u=e.coHeightfieldScale(t),h=e.coHeightfieldHeights(t);return new m_(h,u);case Ze.ConvexPolygon:return s=e.coVertices(t),new zy(s,!1);case Ze.RoundConvexPolygon:return s=e.coVertices(t),o=e.coRoundRadius(t),new Ny(s,o,!1);default:throw new Error("unknown shape type: "+r)}}castShape(e,t,r,i,o,s,a,l,c){let d=U.intoRaw(e),u=rt.intoRaw(t),h=U.intoRaw(r),p=U.intoRaw(o),g=rt.intoRaw(s),f=U.intoRaw(a),w=this.intoRaw(),v=i.intoRaw(),b=Vc.fromRaw(null,w.castShape(d,u,h,v,p,g,f,l,c));return d.free(),u.free(),h.free(),p.free(),g.free(),f.free(),w.free(),v.free(),b}intersectsShape(e,t,r,i,o){let s=U.intoRaw(e),a=rt.intoRaw(t),l=U.intoRaw(i),c=rt.intoRaw(o),d=this.intoRaw(),u=r.intoRaw(),h=d.intersectsShape(s,a,u,l,c);return s.free(),a.free(),l.free(),c.free(),d.free(),u.free(),h}contactShape(e,t,r,i,o,s){let a=U.intoRaw(e),l=rt.intoRaw(t),c=U.intoRaw(i),d=rt.intoRaw(o),u=this.intoRaw(),h=r.intoRaw(),p=Bc.fromRaw(u.contactShape(a,l,h,c,d,s));return a.free(),l.free(),c.free(),d.free(),u.free(),h.free(),p}containsPoint(e,t,r){let i=U.intoRaw(e),o=rt.intoRaw(t),s=U.intoRaw(r),a=this.intoRaw(),l=a.containsPoint(i,o,s);return i.free(),o.free(),s.free(),a.free(),l}projectPoint(e,t,r,i){let o=U.intoRaw(e),s=rt.intoRaw(t),a=U.intoRaw(r),l=this.intoRaw(),c=jh.fromRaw(l.projectPoint(o,s,a,i));return o.free(),s.free(),a.free(),l.free(),c}intersectsRay(e,t,r,i){let o=U.intoRaw(t),s=rt.intoRaw(r),a=U.intoRaw(e.origin),l=U.intoRaw(e.dir),c=this.intoRaw(),d=c.intersectsRay(o,s,a,l,i);return o.free(),s.free(),a.free(),l.free(),c.free(),d}castRay(e,t,r,i,o){let s=U.intoRaw(t),a=rt.intoRaw(r),l=U.intoRaw(e.origin),c=U.intoRaw(e.dir),d=this.intoRaw(),u=d.castRay(s,a,l,c,i,o);return s.free(),a.free(),l.free(),c.free(),d.free(),u}castRayAndGetNormal(e,t,r,i,o){let s=U.intoRaw(t),a=rt.intoRaw(r),l=U.intoRaw(e.origin),c=U.intoRaw(e.dir),d=this.intoRaw(),u=Dh.fromRaw(d.castRayAndGetNormal(s,a,l,c,i,o));return s.free(),a.free(),l.free(),c.free(),d.free(),u}}var Ze;(function(n){n[n.Ball=0]="Ball",n[n.Cuboid=1]="Cuboid",n[n.Capsule=2]="Capsule",n[n.Segment=3]="Segment",n[n.Polyline=4]="Polyline",n[n.Triangle=5]="Triangle",n[n.TriMesh=6]="TriMesh",n[n.HeightField=7]="HeightField",n[n.ConvexPolygon=9]="ConvexPolygon",n[n.RoundCuboid=10]="RoundCuboid",n[n.RoundTriangle=11]="RoundTriangle",n[n.RoundConvexPolygon=12]="RoundConvexPolygon",n[n.HalfSpace=13]="HalfSpace"})(Ze||(Ze={}));class s_ extends Bn{constructor(e){super(),this.type=Ze.Ball,this.radius=e}intoRaw(){return xe.ball(this.radius)}}class a_ extends Bn{constructor(e){super(),this.type=Ze.HalfSpace,this.normal=e}intoRaw(){let e=U.intoRaw(this.normal),t=xe.halfspace(e);return e.free(),t}}class l_ extends Bn{constructor(e,t){super(),this.type=Ze.Cuboid,this.halfExtents=U.new(e,t)}intoRaw(){return xe.cuboid(this.halfExtents.x,this.halfExtents.y)}}class c_ extends Bn{constructor(e,t,r){super(),this.type=Ze.RoundCuboid,this.halfExtents=U.new(e,t),this.borderRadius=r}intoRaw(){return xe.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.borderRadius)}}class d_ extends Bn{constructor(e,t){super(),this.type=Ze.Capsule,this.halfHeight=e,this.radius=t}intoRaw(){return xe.capsule(this.halfHeight,this.radius)}}class u_ extends Bn{constructor(e,t){super(),this.type=Ze.Segment,this.a=e,this.b=t}intoRaw(){let e=U.intoRaw(this.a),t=U.intoRaw(this.b),r=xe.segment(e,t);return e.free(),t.free(),r}}class h_ extends Bn{constructor(e,t,r){super(),this.type=Ze.Triangle,this.a=e,this.b=t,this.c=r}intoRaw(){let e=U.intoRaw(this.a),t=U.intoRaw(this.b),r=U.intoRaw(this.c),i=xe.triangle(e,t,r);return e.free(),t.free(),r.free(),i}}class p_ extends Bn{constructor(e,t,r,i){super(),this.type=Ze.RoundTriangle,this.a=e,this.b=t,this.c=r,this.borderRadius=i}intoRaw(){let e=U.intoRaw(this.a),t=U.intoRaw(this.b),r=U.intoRaw(this.c),i=xe.roundTriangle(e,t,r,this.borderRadius);return e.free(),t.free(),r.free(),i}}class f_ extends Bn{constructor(e,t){super(),this.type=Ze.Polyline,this.vertices=e,this.indices=t??new Uint32Array(0)}intoRaw(){return xe.polyline(this.vertices,this.indices)}}class g_ extends Bn{constructor(e,t){super(),this.type=Ze.TriMesh,this.vertices=e,this.indices=t}intoRaw(){return xe.trimesh(this.vertices,this.indices)}}class zy extends Bn{constructor(e,t){super(),this.type=Ze.ConvexPolygon,this.vertices=e,this.skipConvexHullComputation=!!t}intoRaw(){return this.skipConvexHullComputation?xe.convexPolyline(this.vertices):xe.convexHull(this.vertices)}}class Ny extends Bn{constructor(e,t,r){super(),this.type=Ze.RoundConvexPolygon,this.vertices=e,this.borderRadius=t,this.skipConvexHullComputation=!!r}intoRaw(){return this.skipConvexHullComputation?xe.roundConvexPolyline(this.vertices,this.borderRadius):xe.roundConvexHull(this.vertices,this.borderRadius)}}class m_ extends Bn{constructor(e,t){super(),this.type=Ze.HeightField,this.heights=e,this.scale=t}intoRaw(){let e=U.intoRaw(this.scale),t=xe.heightfield(this.heights,e);return e.free(),t}}var Fy;(function(n){n[n.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",n[n.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",n[n.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",n[n.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",n[n.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",n[n.FIXED_FIXED=32]="FIXED_FIXED",n[n.DEFAULT=15]="DEFAULT",n[n.ALL=60943]="ALL"})(Fy||(Fy={}));class y_{constructor(e,t,r,i){this.colliderSet=e,this.handle=t,this._parent=r,this._shape=i}finalizeDeserialization(e){this.handle!=null&&(this._parent=e.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=Bn.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return U.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return rt.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(e){this.colliderSet.raw.coSetSensor(this.handle,e)}setShape(e){let t=e.intoRaw();this.colliderSet.raw.coSetShape(this.handle,t),t.free(),this._shape=e}setEnabled(e){this.colliderSet.raw.coSetEnabled(this.handle,e)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(e){this.colliderSet.raw.coSetRestitution(this.handle,e)}setFriction(e){this.colliderSet.raw.coSetFriction(this.handle,e)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(e){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,e)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(e){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,e)}setCollisionGroups(e){this.colliderSet.raw.coSetCollisionGroups(this.handle,e)}setSolverGroups(e){this.colliderSet.raw.coSetSolverGroups(this.handle,e)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(e){this.colliderSet.raw.coSetActiveHooks(this.handle,e)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(e){this.colliderSet.raw.coSetActiveEvents(this.handle,e)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(e){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,e)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(e){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,e)}setDensity(e){this.colliderSet.raw.coSetDensity(this.handle,e)}setMass(e){this.colliderSet.raw.coSetMass(this.handle,e)}setMassProperties(e,t,r){let i=U.intoRaw(t);this.colliderSet.raw.coSetMassProperties(this.handle,e,i,r),i.free()}setTranslation(e){this.colliderSet.raw.coSetTranslation(this.handle,e.x,e.y)}setTranslationWrtParent(e){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,e.x,e.y)}setRotation(e){this.colliderSet.raw.coSetRotation(this.handle,e)}setRotationWrtParent(e){this.colliderSet.raw.coSetRotationWrtParent(this.handle,e)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return U.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(e){const t=U.intoRaw(e);this.colliderSet.raw.coSetHalfExtents(this.handle,t)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(e){this.colliderSet.raw.coSetRadius(this.handle,e)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(e){this.colliderSet.raw.coSetRoundRadius(this.handle,e)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(e){this.colliderSet.raw.coSetHalfHeight(this.handle,e)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let e=this.colliderSet.raw.coHeightfieldScale(this.handle);return U.fromRaw(e)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(e){let t=U.intoRaw(e),r=this.colliderSet.raw.coContainsPoint(this.handle,t);return t.free(),r}projectPoint(e,t){let r=U.intoRaw(e),i=jh.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,r,t));return r.free(),i}intersectsRay(e,t){let r=U.intoRaw(e.origin),i=U.intoRaw(e.dir),o=this.colliderSet.raw.coIntersectsRay(this.handle,r,i,t);return r.free(),i.free(),o}castShape(e,t,r,i,o,s,a){let l=U.intoRaw(e),c=U.intoRaw(r),d=rt.intoRaw(i),u=U.intoRaw(o),h=t.intoRaw(),p=Vc.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,l,h,c,d,u,s,a));return l.free(),c.free(),d.free(),u.free(),h.free(),p}castCollider(e,t,r,i,o){let s=U.intoRaw(e),a=U.intoRaw(r),l=Lh.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,s,t.handle,a,i,o));return s.free(),a.free(),l}intersectsShape(e,t,r){let i=U.intoRaw(t),o=rt.intoRaw(r),s=e.intoRaw(),a=this.colliderSet.raw.coIntersectsShape(this.handle,s,i,o);return i.free(),o.free(),s.free(),a}contactShape(e,t,r,i){let o=U.intoRaw(t),s=rt.intoRaw(r),a=e.intoRaw(),l=Bc.fromRaw(this.colliderSet.raw.coContactShape(this.handle,a,o,s,i));return o.free(),s.free(),a.free(),l}contactCollider(e,t){return Bc.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,e.handle,t))}castRay(e,t,r){let i=U.intoRaw(e.origin),o=U.intoRaw(e.dir),s=this.colliderSet.raw.coCastRay(this.handle,i,o,t,r);return i.free(),o.free(),s}castRayAndGetNormal(e,t,r){let i=U.intoRaw(e.origin),o=U.intoRaw(e.dir),s=Dh.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,i,o,t,r));return i.free(),o.free(),s}}var Ha;(function(n){n[n.Density=0]="Density",n[n.Mass=1]="Mass",n[n.MassProps=2]="MassProps"})(Ha||(Ha={}));class un{constructor(e){this.enabled=!0,this.shape=e,this.massPropsMode=Ha.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=rt.identity(),this.translation=U.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=Th.Average,this.restitutionCombineRule=Th.Average,this.activeCollisionTypes=Fy.DEFAULT,this.activeEvents=0,this.activeHooks=0,this.mass=0,this.centerOfMass=U.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=0,this.rotationsEnabled=!0}static ball(e){const t=new s_(e);return new un(t)}static capsule(e,t){const r=new d_(e,t);return new un(r)}static segment(e,t){const r=new u_(e,t);return new un(r)}static triangle(e,t,r){const i=new h_(e,t,r);return new un(i)}static roundTriangle(e,t,r,i){const o=new p_(e,t,r,i);return new un(o)}static polyline(e,t){const r=new f_(e,t);return new un(r)}static trimesh(e,t){const r=new g_(e,t);return new un(r)}static cuboid(e,t){const r=new l_(e,t);return new un(r)}static roundCuboid(e,t,r){const i=new c_(e,t,r);return new un(i)}static halfspace(e){const t=new a_(e);return new un(t)}static heightfield(e,t){const r=new m_(e,t);return new un(r)}static convexHull(e){const t=new zy(e,!1);return new un(t)}static convexPolyline(e){const t=new zy(e,!0);return new un(t)}static roundConvexHull(e,t){const r=new Ny(e,t,!1);return new un(r)}static roundConvexPolyline(e,t){const r=new Ny(e,t,!0);return new un(r)}setTranslation(e,t){if(typeof e!="number"||typeof t!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:t},this}setRotation(e){return this.rotation=e,this}setSensor(e){return this.isSensor=e,this}setEnabled(e){return this.enabled=e,this}setDensity(e){return this.massPropsMode=Ha.Density,this.density=e,this}setMass(e){return this.massPropsMode=Ha.Mass,this.mass=e,this}setMassProperties(e,t,r){return this.massPropsMode=Ha.MassProps,this.mass=e,U.copy(this.centerOfMass,t),this.principalAngularInertia=r,this}setRestitution(e){return this.restitution=e,this}setFriction(e){return this.friction=e,this}setFrictionCombineRule(e){return this.frictionCombineRule=e,this}setRestitutionCombineRule(e){return this.restitutionCombineRule=e,this}setCollisionGroups(e){return this.collisionGroups=e,this}setSolverGroups(e){return this.solverGroups=e,this}setActiveHooks(e){return this.activeHooks=e,this}setActiveEvents(e){return this.activeEvents=e,this}setActiveCollisionTypes(e){return this.activeCollisionTypes=e,this}setContactForceEventThreshold(e){return this.contactForceEventThreshold=e,this}}class X5{constructor(e){this.raw=e||new kt,this.map=new Oy,e&&e.forEachColliderHandle(t=>{this.map.set(t,new y_(this,t,null))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}castClosure(e){return t=>{if(e)return e(this.get(t))}}finalizeDeserialization(e){this.map.forEach(t=>t.finalizeDeserialization(e))}createCollider(e,t,r){let i=r!=null&&r!=null;if(i&&isNaN(r))throw Error("Cannot create a collider with a parent rigid-body handle that is not a number.");let o=t.shape.intoRaw(),s=U.intoRaw(t.translation),a=rt.intoRaw(t.rotation),l=U.intoRaw(t.centerOfMass),c=this.raw.createCollider(t.enabled,o,s,a,t.massPropsMode,t.mass,l,t.principalAngularInertia,t.density,t.friction,t.restitution,t.frictionCombineRule,t.restitutionCombineRule,t.isSensor,t.collisionGroups,t.solverGroups,t.activeCollisionTypes,t.activeHooks,t.activeEvents,t.contactForceEventThreshold,i,i?r:0,e.raw);o.free(),s.free(),a.free(),l.free();let d=i?e.get(r):null,u=new y_(this,c,d,t.shape);return this.map.set(c,u),u}remove(e,t,r,i){this.raw.remove(e,t.raw,r.raw,i),this.unmap(e)}unmap(e){this.map.delete(e)}get(e){return this.map.get(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}forEach(e){this.map.forEach(e)}getAll(){return this.map.getAll()}}class q5{constructor(e){this.raw=e||new ky}free(){this.raw&&this.raw.free(),this.raw=void 0}step(e,t,r,i,o,s,a,l,c,d,u,h){let p=U.intoRaw(e);u?this.raw.stepWithEvents(p,t.raw,r.raw,i.raw,o.raw,s.raw,a.raw,l.raw,c.raw,d.raw,u.raw,h,h?h.filterContactPair:null,h?h.filterIntersectionPair:null):this.raw.step(p,t.raw,r.raw,i.raw,o.raw,s.raw,a.raw,l.raw,c.raw,d.raw),p.free()}}var w_;(function(n){n[n.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",n[n.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",n[n.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",n[n.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",n[n.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",n[n.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",n[n.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",n[n.ONLY_FIXED=6]="ONLY_FIXED"})(w_||(w_={}));class J5{constructor(e){this.raw=e||new kh}free(){this.raw&&this.raw.free(),this.raw=void 0}update(e,t){this.raw.update(e.raw,t.raw)}castRay(e,t,r,i,o,s,a,l,c,d){let u=U.intoRaw(r.origin),h=U.intoRaw(r.dir),p=Ly.fromRaw(t,this.raw.castRay(e.raw,t.raw,u,h,i,o,s,a,l,c,d));return u.free(),h.free(),p}castRayAndGetNormal(e,t,r,i,o,s,a,l,c,d){let u=U.intoRaw(r.origin),h=U.intoRaw(r.dir),p=Oh.fromRaw(t,this.raw.castRayAndGetNormal(e.raw,t.raw,u,h,i,o,s,a,l,c,d));return u.free(),h.free(),p}intersectionsWithRay(e,t,r,i,o,s,a,l,c,d,u){let h=U.intoRaw(r.origin),p=U.intoRaw(r.dir),g=f=>s(Oh.fromRaw(t,f));this.raw.intersectionsWithRay(e.raw,t.raw,h,p,i,o,g,a,l,c,d,u),h.free(),p.free()}intersectionWithShape(e,t,r,i,o,s,a,l,c,d){let u=U.intoRaw(r),h=rt.intoRaw(i),p=o.intoRaw(),g=this.raw.intersectionWithShape(e.raw,t.raw,u,h,p,s,a,l,c,d);return u.free(),h.free(),p.free(),g}projectPoint(e,t,r,i,o,s,a,l,c){let d=U.intoRaw(r),u=Rh.fromRaw(t,this.raw.projectPoint(e.raw,t.raw,d,i,o,s,a,l,c));return d.free(),u}projectPointAndGetFeature(e,t,r,i,o,s,a,l){let c=U.intoRaw(r),d=Rh.fromRaw(t,this.raw.projectPointAndGetFeature(e.raw,t.raw,c,i,o,s,a,l));return c.free(),d}intersectionsWithPoint(e,t,r,i,o,s,a,l,c){let d=U.intoRaw(r);this.raw.intersectionsWithPoint(e.raw,t.raw,d,i,o,s,a,l,c),d.free()}castShape(e,t,r,i,o,s,a,l,c,d,u,h,p){let g=U.intoRaw(r),f=rt.intoRaw(i),w=U.intoRaw(o),v=s.intoRaw(),b=Lh.fromRaw(t,this.raw.castShape(e.raw,t.raw,g,f,w,v,a,l,c,d,u,h,p));return g.free(),f.free(),w.free(),v.free(),b}intersectionsWithShape(e,t,r,i,o,s,a,l,c,d,u){let h=U.intoRaw(r),p=rt.intoRaw(i),g=o.intoRaw();this.raw.intersectionsWithShape(e.raw,t.raw,h,p,g,s,a,l,c,d,u),h.free(),p.free(),g.free()}collidersWithAabbIntersectingAabb(e,t,r){let i=U.intoRaw(e),o=U.intoRaw(t);this.raw.collidersWithAabbIntersectingAabb(i,o,r),i.free(),o.free()}}class b_{constructor(e){this.raw=e||new My}free(){this.raw&&this.raw.free(),this.raw=void 0}serializeAll(e,t,r,i,o,s,a,l,c){let d=U.intoRaw(e);const u=this.raw.serializeAll(d,t.raw,r.raw,i.raw,o.raw,s.raw,a.raw,l.raw,c.raw);return d.free(),u}deserializeAll(e){return $y.fromRaw(this.raw.deserializeAll(e))}}class Z5{constructor(e,t){this.vertices=e,this.colors=t}}class Q5{constructor(e){this.raw=e||new xy}free(){this.raw&&this.raw.free(),this.raw=void 0,this.vertices=void 0,this.colors=void 0}render(e,t,r,i,o){this.raw.render(e.raw,t.raw,r.raw,i.raw,o.raw),this.vertices=this.raw.vertices(),this.colors=this.raw.colors()}}class eO{}class tO{constructor(e,t,r,i,o){this.params=t,this.bodies=r,this.colliders=i,this.queries=o,this.raw=new _y(e),this.rawCharacterCollision=new xh,this._applyImpulsesToDynamicBodies=!1,this._characterMass=null}free(){this.raw&&(this.raw.free(),this.rawCharacterCollision.free()),this.raw=void 0,this.rawCharacterCollision=void 0}up(){return this.raw.up()}setUp(e){let t=U.intoRaw(e);return this.raw.setUp(t)}applyImpulsesToDynamicBodies(){return this._applyImpulsesToDynamicBodies}setApplyImpulsesToDynamicBodies(e){this._applyImpulsesToDynamicBodies=e}characterMass(){return this._characterMass}setCharacterMass(e){this._characterMass=e}offset(){return this.raw.offset()}setOffset(e){this.raw.setOffset(e)}slideEnabled(){return this.raw.slideEnabled()}setSlideEnabled(e){this.raw.setSlideEnabled(e)}autostepMaxHeight(){return this.raw.autostepMaxHeight()}autostepMinWidth(){return this.raw.autostepMinWidth()}autostepIncludesDynamicBodies(){return this.raw.autostepIncludesDynamicBodies()}autostepEnabled(){return this.raw.autostepEnabled()}enableAutostep(e,t,r){this.raw.enableAutostep(e,t,r)}disableAutostep(){return this.raw.disableAutostep()}maxSlopeClimbAngle(){return this.raw.maxSlopeClimbAngle()}setMaxSlopeClimbAngle(e){this.raw.setMaxSlopeClimbAngle(e)}minSlopeSlideAngle(){return this.raw.minSlopeSlideAngle()}setMinSlopeSlideAngle(e){this.raw.setMinSlopeSlideAngle(e)}snapToGroundDistance(){return this.raw.snapToGroundDistance()}enableSnapToGround(e){this.raw.enableSnapToGround(e)}disableSnapToGround(){this.raw.disableSnapToGround()}snapToGroundEnabled(){return this.raw.snapToGroundEnabled()}computeColliderMovement(e,t,r,i,o){let s=U.intoRaw(t);this.raw.computeColliderMovement(this.params.dt,this.bodies.raw,this.colliders.raw,this.queries.raw,e.handle,s,this._applyImpulsesToDynamicBodies,this._characterMass,r,i,this.colliders.castClosure(o)),s.free()}computedMovement(){return U.fromRaw(this.raw.computedMovement())}computedGrounded(){return this.raw.computedGrounded()}numComputedCollisions(){return this.raw.numComputedCollisions()}computedCollision(e,t){if(this.raw.computedCollision(e,this.rawCharacterCollision)){let r=this.rawCharacterCollision;return t=t??new eO,t.translationApplied=U.fromRaw(r.translationApplied()),t.translationRemaining=U.fromRaw(r.translationRemaining()),t.toi=r.toi(),t.witness1=U.fromRaw(r.worldWitness1()),t.witness2=U.fromRaw(r.worldWitness2()),t.normal1=U.fromRaw(r.worldNormal1()),t.normal2=U.fromRaw(r.worldNormal2()),t.collider=this.colliders.get(r.handle()),t}else return null}}class $y{constructor(e,t,r,i,o,s,a,l,c,d,u,h,p,g){this.gravity=e,this.integrationParameters=new O5(t),this.islands=new W5(r),this.broadPhase=new K5(i),this.narrowPhase=new G5(o),this.bodies=new D5(s),this.colliders=new X5(a),this.impulseJoints=new F5(l),this.multibodyJoints=new V5(c),this.ccdSolver=new H5(d),this.queryPipeline=new J5(u),this.physicsPipeline=new q5(h),this.serializationPipeline=new b_(p),this.debugRenderPipeline=new Q5(g),this.characterControllers=new Set,this.impulseJoints.finalizeDeserialization(this.bodies),this.bodies.finalizeDeserialization(this.colliders),this.colliders.finalizeDeserialization(this.bodies)}free(){this.integrationParameters.free(),this.islands.free(),this.broadPhase.free(),this.narrowPhase.free(),this.bodies.free(),this.colliders.free(),this.impulseJoints.free(),this.multibodyJoints.free(),this.ccdSolver.free(),this.queryPipeline.free(),this.physicsPipeline.free(),this.serializationPipeline.free(),this.debugRenderPipeline.free(),this.characterControllers.forEach(e=>e.free()),this.integrationParameters=void 0,this.islands=void 0,this.broadPhase=void 0,this.narrowPhase=void 0,this.bodies=void 0,this.colliders=void 0,this.ccdSolver=void 0,this.impulseJoints=void 0,this.multibodyJoints=void 0,this.queryPipeline=void 0,this.physicsPipeline=void 0,this.serializationPipeline=void 0,this.debugRenderPipeline=void 0,this.characterControllers=void 0}static fromRaw(e){return e?new $y(U.fromRaw(e.takeGravity()),e.takeIntegrationParameters(),e.takeIslandManager(),e.takeBroadPhase(),e.takeNarrowPhase(),e.takeBodies(),e.takeColliders(),e.takeImpulseJoints(),e.takeMultibodyJoints()):null}takeSnapshot(){return this.serializationPipeline.serializeAll(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints)}static restoreSnapshot(e){return new b_().deserializeAll(e)}debugRender(){return this.debugRenderPipeline.render(this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.narrowPhase),new Z5(this.debugRenderPipeline.vertices,this.debugRenderPipeline.colors)}step(e,t){this.physicsPipeline.step(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.ccdSolver,e,t),this.queryPipeline.update(this.bodies,this.colliders)}propagateModifiedBodyPositionsToColliders(){this.bodies.raw.propagateModifiedBodyPositionsToColliders(this.colliders.raw)}updateSceneQueries(){this.propagateModifiedBodyPositionsToColliders(),this.queryPipeline.update(this.bodies,this.colliders)}get timestep(){return this.integrationParameters.dt}set timestep(e){this.integrationParameters.dt=e}get maxVelocityIterations(){return this.integrationParameters.maxVelocityIterations}set maxVelocityIterations(e){this.integrationParameters.maxVelocityIterations=e}get maxVelocityFrictionIterations(){return this.integrationParameters.maxVelocityFrictionIterations}set maxVelocityFrictionIterations(e){this.integrationParameters.maxVelocityFrictionIterations=e}get maxStabilizationIterations(){return this.integrationParameters.maxStabilizationIterations}set maxStabilizationIterations(e){this.integrationParameters.maxStabilizationIterations=e}createRigidBody(e){return this.bodies.createRigidBody(this.colliders,e)}createCharacterController(e){let t=new tO(e,this.integrationParameters,this.bodies,this.colliders,this.queryPipeline);return this.characterControllers.add(t),t}removeCharacterController(e){this.characterControllers.delete(e),e.free()}createCollider(e,t){let r=t?t.handle:void 0;return this.colliders.createCollider(this.bodies,e,r)}createImpulseJoint(e,t,r,i){return this.impulseJoints.createJoint(this.bodies,e,t.handle,r.handle,i)}createMultibodyJoint(e,t,r,i){return this.multibodyJoints.createJoint(e,t.handle,r.handle,i)}getRigidBody(e){return this.bodies.get(e)}getCollider(e){return this.colliders.get(e)}getImpulseJoint(e){return this.impulseJoints.get(e)}getMultibodyJoint(e){return this.multibodyJoints.get(e)}removeRigidBody(e){this.bodies&&this.bodies.remove(e.handle,this.islands,this.colliders,this.impulseJoints,this.multibodyJoints)}removeCollider(e,t){this.colliders&&this.colliders.remove(e.handle,this.islands,this.bodies,t)}removeImpulseJoint(e,t){this.impulseJoints&&this.impulseJoints.remove(e.handle,t)}removeMultibodyJoint(e,t){this.impulseJoints&&this.multibodyJoints.remove(e.handle,t)}forEachCollider(e){this.colliders.forEach(e)}forEachRigidBody(e){this.bodies.forEach(e)}forEachActiveRigidBody(e){this.bodies.forEachActiveRigidBody(this.islands,e)}castRay(e,t,r,i,o,s,a,l){return this.queryPipeline.castRay(this.bodies,this.colliders,e,t,r,i,o,s?s.handle:null,a?a.handle:null,this.colliders.castClosure(l))}castRayAndGetNormal(e,t,r,i,o,s,a,l){return this.queryPipeline.castRayAndGetNormal(this.bodies,this.colliders,e,t,r,i,o,s?s.handle:null,a?a.handle:null,this.colliders.castClosure(l))}intersectionsWithRay(e,t,r,i,o,s,a,l,c){this.queryPipeline.intersectionsWithRay(this.bodies,this.colliders,e,t,r,i,o,s,a?a.handle:null,l?l.handle:null,this.colliders.castClosure(c))}intersectionWithShape(e,t,r,i,o,s,a,l){let c=this.queryPipeline.intersectionWithShape(this.bodies,this.colliders,e,t,r,i,o,s?s.handle:null,a?a.handle:null,this.colliders.castClosure(l));return c!=null?this.colliders.get(c):null}projectPoint(e,t,r,i,o,s,a){return this.queryPipeline.projectPoint(this.bodies,this.colliders,e,t,r,i,o?o.handle:null,s?s.handle:null,this.colliders.castClosure(a))}projectPointAndGetFeature(e,t,r,i,o,s){return this.queryPipeline.projectPointAndGetFeature(this.bodies,this.colliders,e,t,r,i?i.handle:null,o?o.handle:null,this.colliders.castClosure(s))}intersectionsWithPoint(e,t,r,i,o,s,a){this.queryPipeline.intersectionsWithPoint(this.bodies,this.colliders,e,this.colliders.castClosure(t),r,i,o?o.handle:null,s?s.handle:null,this.colliders.castClosure(a))}castShape(e,t,r,i,o,s,a,l,c,d,u){return this.queryPipeline.castShape(this.bodies,this.colliders,e,t,r,i,o,s,a,l,c?c.handle:null,d?d.handle:null,this.colliders.castClosure(u))}intersectionsWithShape(e,t,r,i,o,s,a,l,c){this.queryPipeline.intersectionsWithShape(this.bodies,this.colliders,e,t,r,this.colliders.castClosure(i),o,s,a?a.handle:null,l?l.handle:null,this.colliders.castClosure(c))}collidersWithAabbIntersectingAabb(e,t,r){this.queryPipeline.collidersWithAabbIntersectingAabb(e,t,this.colliders.castClosure(r))}contactsWith(e,t){this.narrowPhase.contactsWith(e.handle,this.colliders.castClosure(t))}intersectionsWith(e,t){this.narrowPhase.intersectionsWith(e.handle,this.colliders.castClosure(t))}contactPair(e,t,r){this.narrowPhase.contactPair(e.handle,t.handle,r)}intersectionPair(e,t){return this.narrowPhase.intersectionPair(e.handle,t.handle)}}var v_;(function(n){n[n.COLLISION_EVENTS=1]="COLLISION_EVENTS",n[n.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(v_||(v_={}));class nO{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return U.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return U.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class rge{constructor(e,t){this.raw=t||new _h(e)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(e){this.raw.drainCollisionEvents(e)}drainContactForceEvents(e){let t=new nO;this.raw.drainContactForceEvents(r=>{t.raw=r,e(t),t.free()})}clear(){this.raw.clear()}}var S_;(function(n){n[n.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",n[n.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(S_||(S_={}));var x_;(function(n){n[n.EMPTY=0]="EMPTY",n[n.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"})(x_||(x_={}));function ige(){return Yae()}const Si=Object.freeze(Object.defineProperty({__proto__:null,get ActiveCollisionTypes(){return Fy},get ActiveEvents(){return v_},get ActiveHooks(){return S_},Ball:s_,BroadPhase:K5,CCDSolver:H5,Capsule:d_,CharacterCollision:eO,get CoefficientCombineRule(){return Th},Collider:y_,ColliderDesc:un,ColliderSet:X5,ConvexPolygon:zy,Cuboid:l_,DebugRenderBuffers:Z5,DebugRenderPipeline:Q5,EventQueue:rge,get FeatureType(){return Uc},FixedImpulseJoint:L5,FixedMultibodyJoint:$5,HalfSpace:a_,Heightfield:m_,ImpulseJoint:Ua,ImpulseJointSet:F5,IntegrationParameters:O5,IslandManager:W5,JointData:Ah,get JointType(){return $n},KinematicCharacterController:tO,get MassPropsMode(){return Ha},get MotorModel(){return r_},MultibodyJoint:Va,MultibodyJointSet:V5,NarrowPhase:G5,PhysicsPipeline:q5,PointColliderProjection:Rh,PointProjection:jh,Polyline:f_,PrismaticImpulseJoint:z5,PrismaticMultibodyJoint:B5,get QueryFilterFlags(){return w_},QueryPipeline:J5,Ray:nge,RayColliderIntersection:Oh,RayColliderToi:Ly,RayIntersection:Dh,RevoluteImpulseJoint:N5,RevoluteMultibodyJoint:U5,RigidBody:n_,RigidBodyDesc:Qi,RigidBodySet:D5,get RigidBodyType(){return vi},RotationOps:rt,RoundConvexPolygon:Ny,RoundCuboid:c_,RoundTriangle:p_,Segment:u_,SerializationPipeline:b_,Shape:Bn,ShapeColliderTOI:Lh,ShapeContact:Bc,ShapeTOI:Vc,get ShapeType(){return Ze},get SolverFlags(){return x_},TempContactForceEvent:nO,TempContactManifold:Y5,TriMesh:g_,Triangle:h_,UnitImpulseJoint:i_,UnitMultibodyJoint:o_,Vector2:R5,VectorOps:U,World:$y,version:ige},Symbol.toStringTag,{value:"Module"})),__={x:0,y:98};function k_(n){return!(!n||n==="black")}function oge(n){return n==="grey"?0:1}function sge(n){return n==="orange"?.9:0}function age(n){return n==="blue"?.1:.8}const rO={defaultRestitution:0,defaultFriction:.1},ir={up:{x:0,y:-1},additionalMass:20,maxSlopeClimbAngle:1,slideEnabled:!0,minSlopeSlideAngle:.9,applyImpulsesToDynamicBodies:!0,autostepHeight:5,autostepMaxClimbAngle:1,snapToGroundDistance:3,maxMoveSpeedX:100,moveAcceleration:600,moveDeceleration:500,jumpVelocity:300,gravityMultiplier:10},iO=(n,e,t,r,i)=>{const o=Math.cos(i),s=Math.sin(i);return{x:o*(t-n)-s*(r-e)+n,y:s*(t-n)+o*(r-e)+e}},By=({x:n,y:e,width:t,height:r,rotation:i,parent:o})=>{const s=n+t/2,a=e+r/2,l=iO(n,e,s,a,i);return o&&(l.x-=o.center.x,l.y-=o.center.y),l},lge=({x:n,y:e,width:t,height:r,rotation:i})=>{const o=n-t/2,s=e-r/2;return iO(n,e,o,s,i)},cge=(n,e,t,r,i)=>{let o=e.x===0&&n.x!==0?Math.max(Math.abs(n.x)-i*t,0)*Math.sign(n.x):n.x+e.x*t;o=Math.min(Math.abs(o),r)*Math.sign(o);const s=(n.x+o)/2*t,a=n.y*t+.5*e.y*t**2;return{x:s,y:a}},oO=(n,e,t)=>{const r=new Float32Array(n.length*2),i=e/2,o=t/2;for(let s=0;s<n.length;s++)r[s*2]=n[s].x-i,r[s*2+1]=n[s].y-o;return r};class dge{constructor(e){y(this,"editor");y(this,"world");y(this,"rigidbodyLookup");y(this,"animFrame",-1);y(this,"character");this.editor=e,this.world=new Si.World(__),this.rigidbodyLookup={},this.character={rigidbody:null,collider:null}}start(){this.world=new Si.World(__),this.addShapes(this.editor.getSelectedShapes());const e=()=>{this.world.step(),this.updateCharacterControllers(),this.updateRigidbodies(),this.animFrame=requestAnimationFrame(e)};return e(),()=>cancelAnimationFrame(this.animFrame)}stop(){this.animFrame!==-1&&(cancelAnimationFrame(this.animFrame),this.animFrame=-1)}addShapes(e){for(const t of e){if("color"in t.props&&t.props.color==="violet"){this.createCharacter(t);continue}switch(t.type){case"geo":case"image":case"video":this.createShape(t);break;case"draw":this.createCompoundLine(t);break;case"group":this.createGroup(t);break}}}createShape(e){if(e.props.dash!=="dashed")if(k_(e.props.color)){const t=oge(e.props.color),r=this.createRigidbody(e,t);this.createCollider(e,r)}else this.createCollider(e)}createCharacter(e){const t=By({x:e.x,y:e.y,width:e.props.w,height:e.props.h,rotation:e.rotation}),r=this.editor.getShapeGeometry(e).vertices,i=oO(r,e.props.w,e.props.h),o=Si.ColliderDesc.convexHull(i);if(!o){console.error("Failed to create collider description.");return}const s=Si.RigidBodyDesc.kinematicPositionBased().setTranslation(t.x,t.y).setAdditionalMass(ir.additionalMass),a=this.world.createRigidBody(s),l=this.world.createCollider(o,a),c=this.world.createCharacterController(.1);c.setUp(ir.up),c.setMaxSlopeClimbAngle(ir.maxSlopeClimbAngle),c.setSlideEnabled(ir.slideEnabled),c.setMinSlopeSlideAngle(ir.minSlopeSlideAngle),c.setApplyImpulsesToDynamicBodies(ir.applyImpulsesToDynamicBodies),c.enableAutostep(ir.autostepHeight,ir.autostepMaxClimbAngle,!0),c.enableSnapToGround(ir.snapToGroundDistance),this.character.rigidbody=a,this.character.collider=l,a.userData={id:e.id,type:e.type,w:e.props.w,h:e.props.h}}createGroup(e){const t=this.createRigidbody(e),r=this.editor.getShapeGeometry(e);this.editor.getSortedChildIdsForParent(e.id).forEach(i=>{const o=this.editor.getShape(i);o&&("color"in o.props&&k_(o==null?void 0:o.props.color)?this.createCollider(o,t,r):this.createCollider(o))})}createCompoundLine(e){const t=this.createRigidbody(e),r=this.editor.getShapeGeometry(e).vertices,i="color"in e.props&&k_(e.props.color);r.forEach(o=>{i?this.createColliderAtPoint(o,e,t):this.createColliderAtPoint(o,e)})}updateRigidbodies(){this.world.bodies.forEach(e=>{var s,a,l,c,d;if(e===((s=this.character)==null?void 0:s.rigidbody)||!e.userData)return;const t=e,r=t.translation(),i=t.rotation(),o=lge({x:r.x,y:r.y,width:(a=t.userData)==null?void 0:a.w,height:(l=t.userData)==null?void 0:l.h,rotation:i});this.editor.updateShape({id:(c=t.userData)==null?void 0:c.id,type:(d=t.userData)==null?void 0:d.type,rotation:i,x:o.x,y:o.y})})}updateCharacterControllers(){const e=this.editor.inputs.keys.has("ArrowRight")?1:0,t=this.editor.inputs.keys.has("ArrowLeft")?-1:0,r={x:(e+t)*ir.moveAcceleration,y:ir.gravityMultiplier*__.y};this.world.characterControllers.forEach(i=>{if(!this.character.rigidbody||!this.character.collider)return;const o=this.character.rigidbody,s=this.character.collider,a=i.computedGrounded(),l=this.editor.inputs.keys.has("ArrowUp")&&a,c={x:o.linvel().x,y:l?-ir.jumpVelocity:o.linvel().y},d=cge(c,r,1/60,ir.maxMoveSpeedX,ir.moveDeceleration);i.computeColliderMovement(s,new Si.Vector2(d.x,d.y));const u=i.computedMovement(),h=o.translation(),p=h.x+u.x,g=h.y+u.y;o==null||o.setNextKinematicTranslation({x:p,y:g});const f=o.userData.w,w=o.userData.h;this.editor.updateShape({id:o.userData.id,type:o.userData.type,x:p-f/2,y:g-w/2})})}getShapeDimensions(e){const t=this.editor.getShapeGeometry(e),r=t.center.x*2,i=t.center.y*2;return{width:r,height:i}}shouldConvexify(e){return!(e.type==="geo"&&e.props.geo==="rectangle")}createRigidbody(e,t=1){const r=this.getShapeDimensions(e),i=By({x:e.x,y:e.y,width:r.width,height:r.height,rotation:e.rotation}),o=Si.RigidBodyDesc.dynamic().setTranslation(i.x,i.y).setRotation(e.rotation).setGravityScale(t),s=this.world.createRigidBody(o);return this.rigidbodyLookup[e.id]=s,s.userData={id:e.id,type:e.type,w:r.width,h:r.height},s}createColliderAtPoint(e,t,r=null){const i=this.editor.getShapeGeometry(t),o=By({x:e.x,y:e.y,width:5,height:5,rotation:0,parent:i});let s=null;if(s=Si.ColliderDesc.ball(5),!s){console.error("Failed to create collider description.");return}r?(s.setTranslation(o.x,o.y),this.world.createCollider(s,r)):(s.setTranslation(t.x+o.x,t.y+o.y),this.world.createCollider(s))}createCollider(e,t=null,r=null){const i=this.getShapeDimensions(e),o=By({x:e.x,y:e.y,width:i.width,height:i.height,rotation:e.rotation,parent:r||void 0}),s="color"in e.props?sge(e.props.color):rO.defaultRestitution,a="color"in e.props?age(e.props.color):rO.defaultFriction;let l=null;if(this.shouldConvexify(e)){const c=this.editor.getShapeGeometry(e).vertices,d=oO(c,i.width,i.height);l=Si.ColliderDesc.convexHull(d)}else l=Si.ColliderDesc.cuboid(i.width/2,i.height/2);if(!l){console.error("Failed to create collider description.");return}l.setRestitution(s).setRestitutionCombineRule(Si.CoefficientCombineRule.Max).setFriction(a).setFrictionCombineRule(Si.CoefficientCombineRule.Min),t?(r&&(l.setTranslation(o.x,o.y),l.setRotation(e.rotation)),this.world.createCollider(l,t)):(l.setTranslation(o.x,o.y).setRotation(e.rotation),this.world.createCollider(l))}setEditor(e){this.editor=e}}function uge(n,e){const t=S.useRef(new dge(n));return S.useEffect(()=>{if(e)return t.current.start(),n.selectNone(),()=>t.current.stop()},[e,t]),S.useEffect(()=>{t.current.setEditor(n)},[n,t]),{addShapes:r=>t.current.addShapes(r)}}const hge=$e(()=>{const n=G(),[e,t]=S.useState(!1);S.useEffect(()=>{const i=()=>{t(o=>!o)};return window.addEventListener("togglePhysicsEvent",i),()=>{window.removeEventListener("togglePhysicsEvent",i)}},[]);const{addShapes:r}=uge(n,e);return m.jsx("div",{className:"custom-layout",children:m.jsxs("div",{className:"custom-toolbar",children:[m.jsx("button",{type:"button",className:"custom-button","data-isactive":e,title:"Toggle physics (P)",onClick:()=>t(!e),children:"Physics"}),m.jsx("button",{type:"button",className:"custom-button",title:"Add to physics simulation",onClick:()=>r(n.getSelectedShapes()),children:"+"})]})})}),xi=()=>new Map,C_=n=>{const e=xi();return n.forEach((t,r)=>{e.set(r,t)}),e},Gs=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},pge=(n,e)=>{const t=[];for(const[r,i]of n)t.push(e(i,r));return t},fge=(n,e)=>{for(const[t,r]of n)if(e(r,t))return!0;return!1},Hc=()=>new Set,E_=n=>n[n.length-1],gge=(n,e)=>{for(let t=0;t<e.length;t++)n.push(e[t])},Ys=Array.from,mge=Array.isArray;let yge=class{constructor(){this._observers=xi()}on(n,e){Gs(this._observers,n,Hc).add(e)}once(n,e){const t=(...r)=>{this.off(n,t),e(...r)};this.on(n,t)}off(n,e){const t=this._observers.get(n);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(n))}emit(n,e){return Ys((this._observers.get(n)||xi()).values()).forEach(t=>t(...e))}destroy(){this._observers=xi()}};const Xs=Math.floor,Uy=Math.abs,sO=(n,e)=>n<e?n:e,Wa=(n,e)=>n>e?n:e,aO=n=>n!==0?n<0:1/n<0,wge=n=>n.toLowerCase(),bge=/^\s*/g,vge=n=>n.replace(bge,""),Sge=/([A-Z])/g,lO=(n,e)=>vge(n.replace(Sge,t=>`${e}${wge(t)}`)),xge=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},zh=typeof TextEncoder<"u"?new TextEncoder:null,_ge=n=>zh.encode(n),kge=zh?_ge:xge;let Nh=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Nh&&Nh.decode(new Uint8Array).length===1&&(Nh=null);const Cge=n=>n===void 0?null:n;let Ege=class{constructor(){this.map=new Map}setItem(n,e){this.map.set(n,e)}getItem(n){return this.map.get(n)}},cO=new Ege,Pge=!0;try{typeof localStorage<"u"&&(cO=localStorage,Pge=!1)}catch{}const Ige=cO,Mge=Object.assign,Age=Object.keys,Tge=(n,e)=>{for(const t in n)e(n[t],t)},dO=n=>Age(n).length,jge=n=>{for(const e in n)return!1;return!0},Rge=(n,e)=>{for(const t in n)if(!e(n[t],t))return!1;return!0},Dge=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),Oge=(n,e)=>n===e||dO(n)===dO(e)&&Rge(n,(t,r)=>(t!==void 0||Dge(e,r))&&e[r]===t),P_=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&P_(n,e,t+1)}},Lge=n=>n,zge=(n,e)=>e.includes(n),Fh=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name);let eo;const Nge=()=>{if(eo===void 0)if(Fh){eo=xi();const n=process.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&eo.set(e,""),e=r):e!==null&&(eo.set(e,r),e=null)}e!==null&&eo.set(e,"")}else typeof location=="object"?(eo=xi(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");eo.set(`--${lO(e,"-")}`,t),eo.set(`-${lO(e,"-")}`,t)}})):eo=xi();return eo},I_=n=>Nge().has(n),M_=n=>Cge(Fh?process.env[n.toUpperCase()]:Ige.getItem(n));(n=>I_("--"+n)||M_(n)!==null)("production");const uO=Fh&&zge({}.FORCE_COLOR,["true","1","2"]),Fge=!I_("no-colors")&&(!Fh||process.stdout.isTTY||uO)&&(!Fh||I_("color")||uO||M_("COLORTERM")!==null||(M_("TERM")||"").includes("color")),hO=1,pO=2,A_=4,T_=8,$h=32,Wo=64,Er=128,Vy=31,j_=63,Ka=127,$ge=2147483647,fO=Number.MAX_SAFE_INTEGER,Bge=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Xs(n)===n),qs=n=>new Error(n),to=()=>{throw qs("Method unimplemented")},no=()=>{throw qs("Unexpected case")},gO=qs("Unexpected end of array"),mO=qs("Integer out of Range");let Hy=class{constructor(n){this.arr=n,this.pos=0}};const Wc=n=>new Hy(n),Uge=n=>n.pos!==n.arr.length,Vge=(n,e)=>{const t=L_(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},Pr=n=>Vge(n,Ce(n)),Kc=n=>n.arr[n.pos++],Ce=n=>{let e=0,t=1;const r=n.arr.length;for(;n.pos<r;){const i=n.arr[n.pos++];if(e=e+(i&Ka)*t,t*=128,i<Er)return e;if(e>fO)throw mO}throw gO},R_=n=>{let e=n.arr[n.pos++],t=e&j_,r=64;const i=(e&Wo)>0?-1:1;if(!(e&Er))return i*t;const o=n.arr.length;for(;n.pos<o;){if(e=n.arr[n.pos++],t=t+(e&Ka)*r,r*=128,e<Er)return i*t;if(t>fO)throw mO}throw gO},Hge=n=>{let e=Ce(n);if(e===0)return"";{let t=String.fromCodePoint(Kc(n));if(--e<100)for(;e--;)t+=String.fromCodePoint(Kc(n));else for(;e>0;){const r=e<1e4?e:1e4,i=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,t+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(t))}},Wge=n=>Nh.decode(Pr(n)),Gc=Nh?Wge:Hge,D_=(n,e)=>{const t=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,e);return n.pos+=e,t},Kge=n=>D_(n,4).getFloat32(0,!1),Gge=n=>D_(n,8).getFloat64(0,!1),Yge=n=>D_(n,8).getBigInt64(0,!1),Xge=[n=>{},n=>null,R_,Kge,Gge,Yge,n=>!1,n=>!0,Gc,n=>{const e=Ce(n),t={};for(let r=0;r<e;r++){const i=Gc(n);t[i]=Bh(n)}return t},n=>{const e=Ce(n),t=[];for(let r=0;r<e;r++)t.push(Bh(n));return t},Pr],Bh=n=>Xge[127-Kc(n)](n);class yO extends Hy{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Uge(this)?this.count=Ce(this)+1:this.count=-1),this.count--,this.s}}class Wy extends Hy{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=R_(this);const e=aO(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ce(this)+2)}return this.count--,this.s}}class O_ extends Hy{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=R_(this),t=e&1;this.diff=Xs(e/2),this.count=1,t&&(this.count=Ce(this)+2)}return this.s+=this.diff,this.count--,this.s}}class qge{constructor(e){this.decoder=new Wy(e),this.str=Gc(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}const Jge=n=>new Uint8Array(n),L_=(n,e,t)=>new Uint8Array(n,e,t),Zge=n=>{const e=Jge(n.byteLength);return e.set(n),e};let Uh=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}};const Ky=()=>new Uh,Qge=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},ro=n=>{const e=new Uint8Array(Qge(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(L_(n.cbuf.buffer,0,n.cpos),t),e},eme=(n,e)=>{const t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(L_(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(Wa(t,e)*2),n.cpos=0)},qt=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},z_=qt,Me=(n,e)=>{for(;e>Ka;)qt(n,Er|Ka&e),e=Xs(e/128);qt(n,Ka&e)},N_=(n,e)=>{const t=aO(e);for(t&&(e=-e),qt(n,(e>j_?Er:0)|(t?Wo:0)|j_&e),e=Xs(e/64);e>0;)qt(n,(e>Ka?Er:0)|Ka&e),e=Xs(e/128)},F_=new Uint8Array(3e4),tme=F_.length/3,nme=(n,e)=>{if(e.length<tme){const t=zh.encodeInto(e,F_).written||0;Me(n,t);for(let r=0;r<t;r++)qt(n,F_[r])}else Ir(n,kge(e))},rme=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;Me(n,r);for(let i=0;i<r;i++)qt(n,t.codePointAt(i))},Yc=zh&&zh.encodeInto?nme:rme,Gy=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=sO(t-r,e.length),o=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,o>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(Wa(t*2,o)),n.cbuf.set(e.subarray(i)),n.cpos=o)},Ir=(n,e)=>{Me(n,e.byteLength),Gy(n,e)},$_=(n,e)=>{eme(n,e);const t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},ime=(n,e)=>$_(n,4).setFloat32(0,e,!1),ome=(n,e)=>$_(n,8).setFloat64(0,e,!1),sme=(n,e)=>$_(n,8).setBigInt64(0,e,!1),wO=new DataView(new ArrayBuffer(4)),ame=n=>(wO.setFloat32(0,n),wO.getFloat32(0)===n),Vh=(n,e)=>{switch(typeof e){case"string":qt(n,119),Yc(n,e);break;case"number":Bge(e)&&Uy(e)<=$ge?(qt(n,125),N_(n,e)):ame(e)?(qt(n,124),ime(n,e)):(qt(n,123),ome(n,e));break;case"bigint":qt(n,122),sme(n,e);break;case"object":if(e===null)qt(n,126);else if(mge(e)){qt(n,117),Me(n,e.length);for(let t=0;t<e.length;t++)Vh(n,e[t])}else if(e instanceof Uint8Array)qt(n,116),Ir(n,e);else{qt(n,118);const t=Object.keys(e);Me(n,t.length);for(let r=0;r<t.length;r++){const i=t[r];Yc(n,i),Vh(n,e[i])}}break;case"boolean":qt(n,e?120:121);break;default:qt(n,127)}};class bO extends Uh{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Me(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const vO=n=>{n.count>0&&(N_(n.encoder,n.count===1?n.s:-n.s),n.count>1&&Me(n.encoder,n.count-2))};class Yy{constructor(){this.encoder=new Uh,this.s=0,this.count=0}write(e){this.s===e?this.count++:(vO(this),this.count=1,this.s=e)}toUint8Array(){return vO(this),ro(this.encoder)}}const SO=n=>{if(n.count>0){const e=n.diff*2+(n.count===1?0:1);N_(n.encoder,e),n.count>1&&Me(n.encoder,n.count-2)}};class B_{constructor(){this.encoder=new Uh,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(SO(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return SO(this),ro(this.encoder)}}class lme{constructor(){this.sarr=[],this.s="",this.lensE=new Yy}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Uh;return this.sarr.push(this.s),this.s="",Yc(e,this.sarr.join("")),Gy(e,this.lensE.toUint8Array()),ro(e)}}const cme=crypto.getRandomValues.bind(crypto),xO=()=>cme(new Uint32Array(1))[0],dme=[1e7]+-1e3+-4e3+-8e3+-1e11,ume=()=>dme.replace(/[018]/g,n=>(n^xO()&15>>n/4).toString(16)),_O=n=>new Promise(n);Promise.all.bind(Promise);class hme{constructor(e,t){this.left=e,this.right=t}}const Ko=(n,e)=>new hme(n,e);typeof DOMParser<"u"&&new DOMParser;const pme=n=>pge(n,(e,t)=>`${t}:${e};`).join(""),Go=Symbol,kO=Go(),CO=Go(),fme=Go(),gme=Go(),mme=Go(),EO=Go(),yme=Go(),PO=Go(),wme=Go(),bme=n=>{const e=[];let t=0;for(;t<n.length;t++){const r=n[t];r.constructor===String||r.constructor===Number||r.constructor===Object&&e.push(JSON.stringify(r))}return e},vme={[kO]:Ko("font-weight","bold"),[CO]:Ko("font-weight","normal"),[fme]:Ko("color","blue"),[mme]:Ko("color","green"),[gme]:Ko("color","grey"),[EO]:Ko("color","red"),[yme]:Ko("color","purple"),[PO]:Ko("color","orange"),[wme]:Ko("color","black")},Sme=n=>{const e=[],t=[],r=xi();let i=[],o=0;for(;o<n.length;o++){const s=n[o],a=vme[s];if(a!==void 0)r.set(a.left,a.right);else if(s.constructor===String||s.constructor===Number){const l=pme(r);o>0||l.length>0?(e.push("%c"+s),t.push(l)):e.push(s)}else break}for(o>0&&(i=t,i.unshift(e.join("")));o<n.length;o++){const s=n[o];s instanceof Symbol||i.push(s)}return i},xme=Fge?Sme:bme,_me=(...n)=>{console.log(...xme(n)),kme.forEach(e=>e.print(n))},kme=Hc(),IO=n=>({[Symbol.iterator](){return this},next:n}),Cme=(n,e)=>IO(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),U_=(n,e)=>IO(()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});class V_{constructor(e,t){this.clock=e,this.len=t}}class Hh{constructor(){this.clients=new Map}}const MO=(n,e,t)=>e.clients.forEach((r,i)=>{const o=n.doc.store.clients.get(i);for(let s=0;s<r.length;s++){const a=r[s];GO(n,o,a.clock,a.len,t)}}),Eme=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){const i=Xs((t+r)/2),o=n[i],s=o.clock;if(s<=e){if(e<s+o.len)return i;t=i+1}else r=i-1}return null},AO=(n,e)=>{const t=n.clients.get(e.client);return t!==void 0&&Eme(t,e.clock)!==null},H_=n=>{n.clients.forEach(e=>{e.sort((i,o)=>i.clock-o.clock);let t,r;for(t=1,r=1;t<e.length;t++){const i=e[r-1],o=e[t];i.clock+i.len>=o.clock?i.len=Wa(i.len,o.clock+o.len-i.clock):(r<t&&(e[r]=o),r++)}e.length=r})},Pme=n=>{const e=new Hh;for(let t=0;t<n.length;t++)n[t].clients.forEach((r,i)=>{if(!e.clients.has(i)){const o=r.slice();for(let s=t+1;s<n.length;s++)gge(o,n[s].clients.get(i)||[]);e.clients.set(i,o)}});return H_(e),e},Xy=(n,e,t,r)=>{Gs(n.clients,e,()=>[]).push(new V_(t,r))},Ime=()=>new Hh,Mme=n=>{const e=Ime();return n.clients.forEach((t,r)=>{const i=[];for(let o=0;o<t.length;o++){const s=t[o];if(s.deleted){const a=s.id.clock;let l=s.length;if(o+1<t.length)for(let c=t[o+1];o+1<t.length&&c.deleted;c=t[++o+1])l+=c.length;i.push(new V_(a,l))}}i.length>0&&e.clients.set(r,i)}),e},Xc=(n,e)=>{Me(n.restEncoder,e.clients.size),Ys(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),Me(n.restEncoder,t);const i=r.length;Me(n.restEncoder,i);for(let o=0;o<i;o++){const s=r[o];n.writeDsClock(s.clock),n.writeDsLen(s.len)}})},W_=n=>{const e=new Hh,t=Ce(n.restDecoder);for(let r=0;r<t;r++){n.resetDsCurVal();const i=Ce(n.restDecoder),o=Ce(n.restDecoder);if(o>0){const s=Gs(e.clients,i,()=>[]);for(let a=0;a<o;a++)s.push(new V_(n.readDsClock(),n.readDsLen()))}}return e},TO=(n,e,t)=>{const r=new Hh,i=Ce(n.restDecoder);for(let o=0;o<i;o++){n.resetDsCurVal();const s=Ce(n.restDecoder),a=Ce(n.restDecoder),l=t.clients.get(s)||[],c=Jt(t,s);for(let d=0;d<a;d++){const u=n.readDsClock(),h=u+n.readDsLen();if(u<c){c<h&&Xy(r,s,c,h-c);let p=io(l,u),g=l[p];for(!g.deleted&&g.id.clock<u&&(l.splice(p+1,0,d0(e,g,u-g.id.clock)),p++);p<l.length&&(g=l[p++],g.id.clock<h);)g.deleted||(h<g.id.clock+g.length&&l.splice(p,0,d0(e,g,h-g.id.clock)),g.delete(e))}else Xy(r,s,u,h-u)}}if(r.clients.size>0){const o=new Ya;return Me(o.restEncoder,0),Xc(o,r),o.toUint8Array()}return null},jO=xO;class Ga extends yge{constructor({guid:e=ume(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:o=null,autoLoad:s=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=jO(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new HO,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=s,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=_O(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});const l=()=>_O(c=>{const d=u=>{(u===void 0||u===!0)&&(this.off("sync",d),c())};this.on("sync",d)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isLoaded||this.emit("load",[])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&dt(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ys(this.subdocs).map(e=>e.guid))}transact(e,t=null){return dt(this,e,t)}get(e,t=hn){const r=Gs(this.share,e,()=>{const o=new t;return o._integrate(this,null),o}),i=r.constructor;if(t!==hn&&i!==t)if(i===hn){const o=new t;o._map=r._map,r._map.forEach(s=>{for(;s!==null;s=s.left)s.parent=o}),o._start=r._start;for(let s=o._start;s!==null;s=s.right)s.parent=o;return o._length=r._length,this.share.set(e,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Zc)}getText(e=""){return this.get(e,td)}getMap(e=""){return this.get(e,Qc)}getXmlFragment(e=""){return this.get(e,Xa)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){Ys(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new Ga({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,dt(e.parent.doc,r=>{const i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(e,t){super.on(e,t)}off(e,t){super.off(e,t)}}class RO{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ce(this.restDecoder)}readDsLen(){return Ce(this.restDecoder)}}class DO extends RO{readLeftID(){return Te(Ce(this.restDecoder),Ce(this.restDecoder))}readRightID(){return Te(Ce(this.restDecoder),Ce(this.restDecoder))}readClient(){return Ce(this.restDecoder)}readInfo(){return Kc(this.restDecoder)}readString(){return Gc(this.restDecoder)}readParentInfo(){return Ce(this.restDecoder)===1}readTypeRef(){return Ce(this.restDecoder)}readLen(){return Ce(this.restDecoder)}readAny(){return Bh(this.restDecoder)}readBuf(){return Zge(Pr(this.restDecoder))}readJSON(){return JSON.parse(Gc(this.restDecoder))}readKey(){return Gc(this.restDecoder)}}class Ame{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ce(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ce(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class qc extends Ame{constructor(e){super(e),this.keys=[],Ce(e),this.keyClockDecoder=new O_(Pr(e)),this.clientDecoder=new Wy(Pr(e)),this.leftClockDecoder=new O_(Pr(e)),this.rightClockDecoder=new O_(Pr(e)),this.infoDecoder=new yO(Pr(e),Kc),this.stringDecoder=new qge(Pr(e)),this.parentInfoDecoder=new yO(Pr(e),Kc),this.typeRefDecoder=new Wy(Pr(e)),this.lenDecoder=new Wy(Pr(e))}readLeftID(){return new Jc(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Jc(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Bh(this.restDecoder)}readBuf(){return Pr(this.restDecoder)}readJSON(){return Bh(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class OO{constructor(){this.restEncoder=Ky()}toUint8Array(){return ro(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Me(this.restEncoder,e)}writeDsLen(e){Me(this.restEncoder,e)}}class Wh extends OO{writeLeftID(e){Me(this.restEncoder,e.client),Me(this.restEncoder,e.clock)}writeRightID(e){Me(this.restEncoder,e.client),Me(this.restEncoder,e.clock)}writeClient(e){Me(this.restEncoder,e)}writeInfo(e){z_(this.restEncoder,e)}writeString(e){Yc(this.restEncoder,e)}writeParentInfo(e){Me(this.restEncoder,e?1:0)}writeTypeRef(e){Me(this.restEncoder,e)}writeLen(e){Me(this.restEncoder,e)}writeAny(e){Vh(this.restEncoder,e)}writeBuf(e){Ir(this.restEncoder,e)}writeJSON(e){Yc(this.restEncoder,JSON.stringify(e))}writeKey(e){Yc(this.restEncoder,e)}}class LO{constructor(){this.restEncoder=Ky(),this.dsCurrVal=0}toUint8Array(){return ro(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,Me(this.restEncoder,t)}writeDsLen(e){e===0&&no(),Me(this.restEncoder,e-1),this.dsCurrVal+=e}}class Ya extends LO{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new B_,this.clientEncoder=new Yy,this.leftClockEncoder=new B_,this.rightClockEncoder=new B_,this.infoEncoder=new bO(z_),this.stringEncoder=new lme,this.parentInfoEncoder=new bO(z_),this.typeRefEncoder=new Yy,this.lenEncoder=new Yy}toUint8Array(){const e=Ky();return Me(e,0),Ir(e,this.keyClockEncoder.toUint8Array()),Ir(e,this.clientEncoder.toUint8Array()),Ir(e,this.leftClockEncoder.toUint8Array()),Ir(e,this.rightClockEncoder.toUint8Array()),Ir(e,ro(this.infoEncoder)),Ir(e,this.stringEncoder.toUint8Array()),Ir(e,ro(this.parentInfoEncoder)),Ir(e,this.typeRefEncoder.toUint8Array()),Ir(e,this.lenEncoder.toUint8Array()),Gy(e,ro(this.restEncoder)),ro(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Vh(this.restEncoder,e)}writeBuf(e){Ir(this.restEncoder,e)}writeJSON(e){Vh(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const Tme=(n,e,t,r)=>{r=Wa(r,e[0].id.clock);const i=io(e,r);Me(n.restEncoder,e.length-i),n.writeClient(t),Me(n.restEncoder,r);const o=e[i];o.write(n,r-o.id.clock);for(let s=i+1;s<e.length;s++)e[s].write(n,0)},K_=(n,e,t)=>{const r=new Map;t.forEach((i,o)=>{Jt(e,o)>i&&r.set(o,i)}),Jy(e).forEach((i,o)=>{t.has(o)||r.set(o,0)}),Me(n.restEncoder,r.size),Ys(r.entries()).sort((i,o)=>o[0]-i[0]).forEach(([i,o])=>{Tme(n,e.clients.get(i),i,o)})},jme=(n,e)=>{const t=xi(),r=Ce(n.restDecoder);for(let i=0;i<r;i++){const o=Ce(n.restDecoder),s=new Array(o),a=n.readClient();let l=Ce(n.restDecoder);t.set(a,{i:0,refs:s});for(let c=0;c<o;c++){const d=n.readInfo();switch(Vy&d){case 0:{const u=n.readLen();s[c]=new Kr(Te(a,l),u),l+=u;break}case 10:{const u=Ce(n.restDecoder);s[c]=new Gr(Te(a,l),u),l+=u;break}default:{const u=(d&(Wo|Er))===0,h=new Ut(Te(a,l),null,(d&Er)===Er?n.readLeftID():null,null,(d&Wo)===Wo?n.readRightID():null,u?n.readParentInfo()?e.get(n.readString()):n.readLeftID():null,u&&(d&$h)===$h?n.readString():null,wL(n,d));s[c]=h,l+=h.length}}}}return t},Rme=(n,e,t)=>{const r=[];let i=Ys(t.keys()).sort((p,g)=>p-g);if(i.length===0)return null;const o=()=>{if(i.length===0)return null;let p=t.get(i[i.length-1]);for(;p.refs.length===p.i;)if(i.pop(),i.length>0)p=t.get(i[i.length-1]);else return null;return p};let s=o();if(s===null&&r.length===0)return null;const a=new HO,l=new Map,c=(p,g)=>{const f=l.get(p);(f==null||f>g)&&l.set(p,g)};let d=s.refs[s.i++];const u=new Map,h=()=>{for(const p of r){const g=p.id.client,f=t.get(g);f?(f.i--,a.clients.set(g,f.refs.slice(f.i)),t.delete(g),f.i=0,f.refs=[]):a.clients.set(g,[p]),i=i.filter(w=>w!==g)}r.length=0};for(;;){if(d.constructor!==Gr){const p=Gs(u,d.id.client,()=>Jt(e,d.id.client))-d.id.clock;if(p<0)r.push(d),c(d.id.client,d.id.clock-1),h();else{const g=d.getMissing(n,e);if(g!==null){r.push(d);const f=t.get(g)||{refs:[],i:0};if(f.refs.length===f.i)c(g,Jt(e,g)),h();else{d=f.refs[f.i++];continue}}else(p===0||p<d.length)&&(d.integrate(n,p),u.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(s!==null&&s.i<s.refs.length)d=s.refs[s.i++];else{if(s=o(),s===null)break;d=s.refs[s.i++]}}if(a.clients.size>0){const p=new Ya;return K_(p,a,new Map),Me(p.restEncoder,0),{missing:l,update:p.toUint8Array()}}return null},Dme=(n,e)=>K_(n,e.doc.store,e.beforeState),Ome=(n,e,t,r=new qc(n))=>dt(e,i=>{i.local=!1;let o=!1;const s=i.doc,a=s.store,l=jme(r,s),c=Rme(i,a,l),d=a.pendingStructs;if(d){for(const[h,p]of d.missing)if(p<Jt(a,h)){o=!0;break}if(c){for(const[h,p]of c.missing){const g=d.missing.get(h);(g==null||g>p)&&d.missing.set(h,p)}d.update=Qy([d.update,c.update])}}else a.pendingStructs=c;const u=TO(r,i,a);if(a.pendingDs){const h=new qc(Wc(a.pendingDs));Ce(h.restDecoder);const p=TO(h,i,a);u&&p?a.pendingDs=Qy([u,p]):a.pendingDs=u||p}else a.pendingDs=u;if(o){const h=a.pendingStructs.update;a.pendingStructs=null,zO(i.doc,h)}},t,!1),zO=(n,e,t,r=qc)=>{const i=Wc(e);Ome(i,n,t,new r(i))},Lme=(n,e,t)=>zO(n,e,t,DO),zme=(n,e,t=new Map)=>{K_(n,e.store,t),Xc(n,Mme(e.store))},Nme=(n,e=new Uint8Array([0]),t=new Ya)=>{const r=NO(e);zme(t,n,r);const i=[t.toUint8Array()];if(n.store.pendingDs&&i.push(n.store.pendingDs),n.store.pendingStructs&&i.push(eye(n.store.pendingStructs.update,e)),i.length>1){if(t.constructor===Wh)return Zme(i.map((o,s)=>s===0?o:nye(o)));if(t.constructor===Ya)return Qy(i)}return i[0]},Fme=(n,e)=>Nme(n,e,new Wh),$me=n=>{const e=new Map,t=Ce(n.restDecoder);for(let r=0;r<t;r++){const i=Ce(n.restDecoder),o=Ce(n.restDecoder);e.set(i,o)}return e},NO=n=>$me(new RO(Wc(n))),FO=(n,e)=>(Me(n.restEncoder,e.size),Ys(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{Me(n.restEncoder,t),Me(n.restEncoder,r)}),n),Bme=(n,e)=>FO(n,Jy(e.store)),Ume=(n,e=new LO)=>(n instanceof Map?FO(e,n):Bme(e,n),e.toUint8Array()),Vme=n=>Ume(n,new OO);class Hme{constructor(){this.l=[]}}const $O=()=>new Hme,BO=(n,e)=>n.l.push(e),UO=(n,e)=>{const t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},VO=(n,e,t)=>P_(n.l,[e,t]);class Jc{constructor(e,t){this.client=e,this.clock=t}}const qy=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,Te=(n,e)=>new Jc(n,e),Wme=n=>{for(const[e,t]of n.doc.share.entries())if(t===n)return e;throw no()},Kh=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!AO(e.ds,n.id),G_=(n,e)=>{const t=Gs(n.meta,G_,Hc),r=n.doc.store;t.has(e)||(e.sv.forEach((i,o)=>{i<Jt(r,o)&&Js(n,Te(o,i))}),MO(n,e.ds,i=>{}),t.add(e))};class HO{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Jy=n=>{const e=new Map;return n.clients.forEach((t,r)=>{const i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},Jt=(n,e)=>{const t=n.clients.get(e);if(t===void 0)return 0;const r=t[t.length-1];return r.id.clock+r.length},WO=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{const r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw no()}t.push(e)},io=(n,e)=>{let t=0,r=n.length-1,i=n[r],o=i.id.clock;if(o===e)return r;let s=Xs(e/(o+i.length-1)*r);for(;t<=r;){if(i=n[s],o=i.id.clock,o<=e){if(e<o+i.length)return s;t=s+1}else r=s-1;s=Xs((t+r)/2)}throw no()},Kme=(n,e)=>{const t=n.clients.get(e.client);return t[io(t,e.clock)]},Y_=Kme,X_=(n,e,t)=>{const r=io(e,t),i=e[r];return i.id.clock<t&&i instanceof Ut?(e.splice(r+1,0,d0(n,i,t-i.id.clock)),r+1):r},Js=(n,e)=>{const t=n.doc.store.clients.get(e.client);return t[X_(n,t,e.clock)]},KO=(n,e,t)=>{const r=e.clients.get(t.client),i=io(r,t.clock),o=r[i];return t.clock!==o.id.clock+o.length-1&&o.constructor!==Kr&&r.splice(i+1,0,d0(n,o,t.clock-o.id.clock+1)),o},Gme=(n,e,t)=>{const r=n.clients.get(e.id.client);r[io(r,e.id.clock)]=t},GO=(n,e,t,r,i)=>{if(r===0)return;const o=t+r;let s=X_(n,e,t),a;do a=e[s++],o<a.id.clock+a.length&&X_(n,e,o),i(a);while(s<e.length&&e[s].id.clock<o)};class Yme{constructor(e,t,r){this.doc=e,this.deleteSet=new Hh,this.beforeState=Jy(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const YO=(n,e)=>e.deleteSet.clients.size===0&&!fge(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(H_(e.deleteSet),Dme(n,e),Xc(n,e.deleteSet),!0),XO=(n,e,t)=>{const r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&Gs(n.changed,e,Hc).add(t)},Zy=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof Ut&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}const o=e-i;return o&&n.splice(e+1-o,o),o},Xme=(n,e,t)=>{for(const[r,i]of n.clients.entries()){const o=e.clients.get(r);for(let s=i.length-1;s>=0;s--){const a=i[s],l=a.clock+a.len;for(let c=io(o,a.clock),d=o[c];c<o.length&&d.id.clock<l;d=o[++c]){const u=o[c];if(a.clock+a.len<=u.id.clock)break;u instanceof Ut&&u.deleted&&!u.keep&&t(u)&&u.gc(e,!1)}}}},qme=(n,e)=>{n.clients.forEach((t,r)=>{const i=e.clients.get(r);for(let o=t.length-1;o>=0;o--){const s=t[o],a=sO(i.length-1,1+io(i,s.clock+s.len-1));for(let l=a,c=i[l];l>0&&c.id.clock>=s.clock;c=i[l])l-=1+Zy(i,l)}})},qO=(n,e)=>{if(e<n.length){const t=n[e],r=t.doc,i=r.store,o=t.deleteSet,s=t._mergeStructs;try{H_(o),t.afterState=Jy(t.doc.store),r.emit("beforeObserverCalls",[t,r]);const a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(d=>d.target._item===null||!d.target._item.deleted),l.forEach(d=>{d.currentTarget=c,d._path=null}),l.sort((d,u)=>d.path.length-u.path.length),VO(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),P_(a,[]),t._needFormattingCleanup&&gye(t)}finally{r.gc&&Xme(o,i,r.gcFilter),qme(o,i),t.afterState.forEach((d,u)=>{const h=t.beforeState.get(u)||0;if(h!==d){const p=i.clients.get(u),g=Wa(io(p,h),1);for(let f=p.length-1;f>=g;)f-=1+Zy(p,f)}});for(let d=s.length-1;d>=0;d--){const{client:u,clock:h}=s[d].id,p=i.clients.get(u),g=io(p,h);g+1<p.length&&Zy(p,g+1)>1||g>0&&Zy(p,g)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(_me(PO,kO,"[yjs] ",CO,EO,"Changed the client-id because another client seems to be using it."),r.clientID=jO()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){const d=new Wh;YO(d,t)&&r.emit("update",[d.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){const d=new Ya;YO(d,t)&&r.emit("updateV2",[d.toUint8Array(),t.origin,r,t])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),c.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(d=>d.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):qO(n,e+1)}}},dt=(n,e,t=null,r=!0)=>{const i=n._transactionCleanups;let o=!1,s=null;n._transaction===null&&(o=!0,n._transaction=new Yme(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{s=e(n._transaction)}finally{if(o){const a=n._transaction===i[0];n._transaction=null,a&&qO(i,0)}}return s};function*Jme(n){const e=Ce(n.restDecoder);for(let t=0;t<e;t++){const r=Ce(n.restDecoder),i=n.readClient();let o=Ce(n.restDecoder);for(let s=0;s<r;s++){const a=n.readInfo();if(a===10){const l=Ce(n.restDecoder);yield new Gr(Te(i,o),l),o+=l}else if(Vy&a){const l=(a&(Wo|Er))===0,c=new Ut(Te(i,o),null,(a&Er)===Er?n.readLeftID():null,null,(a&Wo)===Wo?n.readRightID():null,l?n.readParentInfo()?n.readString():n.readLeftID():null,l&&(a&$h)===$h?n.readString():null,wL(n,a));yield c,o+=c.length}else{const l=n.readLen();yield new Kr(Te(i,o),l),o+=l}}}}class q_{constructor(e,t){this.gen=Jme(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Gr);return this.curr}}class J_{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const Zme=n=>Qy(n,DO,Wh),Qme=(n,e)=>{if(n.constructor===Kr){const{client:t,clock:r}=n.id;return new Kr(Te(t,r+e),n.length-e)}else if(n.constructor===Gr){const{client:t,clock:r}=n.id;return new Gr(Te(t,r+e),n.length-e)}else{const t=n,{client:r,clock:i}=t.id;return new Ut(Te(r,i+e),null,Te(r,i+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},Qy=(n,e=qc,t=Ya)=>{if(n.length===1)return n[0];const r=n.map(d=>new e(Wc(d)));let i=r.map(d=>new q_(d,!0)),o=null;const s=new t,a=new J_(s);for(;i=i.filter(d=>d.curr!==null),i.sort((d,u)=>{if(d.curr.id.client===u.curr.id.client){const h=d.curr.id.clock-u.curr.id.clock;return h===0?d.curr.constructor===u.curr.constructor?0:d.curr.constructor===Gr?1:-1:h}else return u.curr.id.client-d.curr.id.client}),i.length!==0;){const d=i[0],u=d.curr.id.client;if(o!==null){let h=d.curr,p=!1;for(;h!==null&&h.id.clock+h.length<=o.struct.id.clock+o.struct.length&&h.id.client>=o.struct.id.client;)h=d.next(),p=!0;if(h===null||h.id.client!==u||p&&h.id.clock>o.struct.id.clock+o.struct.length)continue;if(u!==o.struct.id.client)Zs(a,o.struct,o.offset),o={struct:h,offset:0},d.next();else if(o.struct.id.clock+o.struct.length<h.id.clock)if(o.struct.constructor===Gr)o.struct.length=h.id.clock+h.length-o.struct.id.clock;else{Zs(a,o.struct,o.offset);const g=h.id.clock-o.struct.id.clock-o.struct.length;o={struct:new Gr(Te(u,o.struct.id.clock+o.struct.length),g),offset:0}}else{const g=o.struct.id.clock+o.struct.length-h.id.clock;g>0&&(o.struct.constructor===Gr?o.struct.length-=g:h=Qme(h,g)),o.struct.mergeWith(h)||(Zs(a,o.struct,o.offset),o={struct:h,offset:0},d.next())}}else o={struct:d.curr,offset:0},d.next();for(let h=d.curr;h!==null&&h.id.client===u&&h.id.clock===o.struct.id.clock+o.struct.length&&h.constructor!==Gr;h=d.next())Zs(a,o.struct,o.offset),o={struct:h,offset:0}}o!==null&&(Zs(a,o.struct,o.offset),o=null),Z_(a);const l=r.map(d=>W_(d)),c=Pme(l);return Xc(s,c),s.toUint8Array()},eye=(n,e,t=qc,r=Ya)=>{const i=NO(e),o=new r,s=new J_(o),a=new t(Wc(n)),l=new q_(a,!1);for(;l.curr;){const d=l.curr,u=d.id.client,h=i.get(u)||0;if(l.curr.constructor===Gr){l.next();continue}if(d.id.clock+d.length>h)for(Zs(s,d,Wa(h-d.id.clock,0)),l.next();l.curr&&l.curr.id.client===u;)Zs(s,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===u&&l.curr.id.clock+l.curr.length<=h;)l.next()}Z_(s);const c=W_(a);return Xc(o,c),o.toUint8Array()},JO=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:ro(n.encoder.restEncoder)}),n.encoder.restEncoder=Ky(),n.written=0)},Zs=(n,e,t)=>{n.written>0&&n.currClient!==e.id.client&&JO(n),n.written===0&&(n.currClient=e.id.client,n.encoder.writeClient(e.id.client),Me(n.encoder.restEncoder,e.id.clock+t)),e.write(n.encoder,t),n.written++},Z_=n=>{JO(n);const e=n.encoder.restEncoder;Me(e,n.clientStructs.length);for(let t=0;t<n.clientStructs.length;t++){const r=n.clientStructs[t];Me(e,r.written),Gy(e,r.restEncoder)}},tye=(n,e,t,r)=>{const i=new t(Wc(n)),o=new q_(i,!1),s=new r,a=new J_(s);for(let c=o.curr;c!==null;c=o.next())Zs(a,e(c),0);Z_(a);const l=W_(i);return Xc(s,l),s.toUint8Array()},nye=n=>tye(n,Lge,qc,Wh),ZO="You must not compute changes after the event-handler fired.";class e0{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=rye(this.currentTarget,this.target))}deletes(e){return AO(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw qs(ZO);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(r=>{if(r!==null){const i=t._map.get(r);let o,s;if(this.adds(i)){let a=i.left;for(;a!==null&&this.adds(a);)a=a.left;if(this.deletes(i))if(a!==null&&this.deletes(a))o="delete",s=E_(a.content.getContent());else return;else a!==null&&this.deletes(a)?(o="update",s=E_(a.content.getContent())):(o="add",s=void 0)}else if(this.deletes(i))o="delete",s=E_(i.content.getContent());else return;e.set(r,{action:o,oldValue:s})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw qs(ZO);const t=this.target,r=Hc(),i=Hc(),o=[];if(e={added:r,deleted:i,delta:o,keys:this.keys},this.transaction.changed.get(t).has(null)){let s=null;const a=()=>{s&&o.push(s)};for(let l=t._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((s===null||s.delete===void 0)&&(a(),s={delete:0}),s.delete+=l.length,i.add(l)):this.adds(l)?((s===null||s.insert===void 0)&&(a(),s={insert:[]}),s.insert=s.insert.concat(l.content.getContent()),r.add(l)):((s===null||s.retain===void 0)&&(a(),s={retain:0}),s.retain+=l.length);s!==null&&s.retain===void 0&&a()}this._changes=e}return e}}const rye=(n,e)=>{const t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)i.deleted||r++,i=i.right;t.unshift(r)}e=e._item.parent}return t},QO=80;let Q_=0;class iye{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Q_++}}const oye=n=>{n.timestamp=Q_++},eL=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=Q_++},sye=(n,e,t)=>{if(n.length>=QO){const r=n.reduce((i,o)=>i.timestamp<o.timestamp?i:o);return eL(r,e,t),r}else{const r=new iye(e,t);return n.push(r),r}},t0=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;const t=n._searchMarker.length===0?null:n._searchMarker.reduce((o,s)=>Uy(e-o.index)<Uy(e-s.index)?o:s);let r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,oye(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&Uy(t.index-i)<r.parent.length/QO?(eL(t,r,i),t):sye(n._searchMarker,r,i)},Gh=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){const i=n[r];if(t>0){let o=i.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(i.index-=o.length);if(o===null||o.marker===!0){n.splice(r,1);continue}i.p=o,o.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=Wa(e,i.index+t))}},n0=(n,e,t)=>{const r=n,i=e.changedParentTypes;for(;Gs(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;VO(r._eH,t,e)};class hn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=$O(),this._dEH=$O(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw to()}clone(){throw to()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){BO(this._eH,e)}observeDeep(e){BO(this._dEH,e)}unobserve(e){UO(this._eH,e)}unobserveDeep(e){UO(this._dEH,e)}toJSON(){}}const tL=(n,e,t)=>{e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e;const i=[];let o=n._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){const s=o.content.getContent();if(s.length<=e)e-=s.length;else{for(let a=e;a<s.length&&r>0;a++)i.push(s[a]),r--;e=0}}o=o.right}return i},nL=n=>{const e=[];let t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){const r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e},Yh=(n,e)=>{let t=0,r=n._start;for(;r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let o=0;o<i.length;o++)e(i[o],t++,n)}r=r.right}},rL=(n,e)=>{const t=[];return Yh(n,(r,i)=>{t.push(e(r,i,n))}),t},aye=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}const i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},iL=(n,e)=>{const t=t0(n,e);let r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},r0=(n,e,t,r)=>{let i=t;const o=n.doc,s=o.clientID,a=o.store,l=t===null?e._start:t.right;let c=[];const d=()=>{c.length>0&&(i=new Ut(Te(s,Jt(a,s)),i,i&&i.lastId,l,l&&l.id,e,null,new Ja(c)),i.integrate(n,0),c=[])};r.forEach(u=>{if(u===null)c.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(u);break;default:switch(d(),u.constructor){case Uint8Array:case ArrayBuffer:i=new Ut(Te(s,Jt(a,s)),i,i&&i.lastId,l,l&&l.id,e,null,new qh(new Uint8Array(u))),i.integrate(n,0);break;case Ga:i=new Ut(Te(s,Jt(a,s)),i,i&&i.lastId,l,l&&l.id,e,null,new Zh(u)),i.integrate(n,0);break;default:if(u instanceof hn)i=new Ut(Te(s,Jt(a,s)),i,i&&i.lastId,l,l&&l.id,e,null,new Yo(u)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},oL=()=>qs("Length exceeded!"),sL=(n,e,t,r)=>{if(t>e._length)throw oL();if(t===0)return e._searchMarker&&Gh(e._searchMarker,t,r.length),r0(n,e,null,r);const i=t,o=t0(e,t);let s=e._start;for(o!==null&&(s=o.p,t-=o.index,t===0&&(s=s.prev,t+=s&&s.countable&&!s.deleted?s.length:0));s!==null;s=s.right)if(!s.deleted&&s.countable){if(t<=s.length){t<s.length&&Js(n,Te(s.id.client,s.id.clock+t));break}t-=s.length}return e._searchMarker&&Gh(e._searchMarker,i,r.length),r0(n,e,s,r)},lye=(n,e,t)=>{let r=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(r)for(;r.right;)r=r.right;return r0(n,e,r,t)},aL=(n,e,t,r)=>{if(r===0)return;const i=t,o=r,s=t0(e,t);let a=e._start;for(s!==null&&(a=s.p,t-=s.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&Js(n,Te(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Js(n,Te(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw oL();e._searchMarker&&Gh(e._searchMarker,i,-o+r)},i0=(n,e,t)=>{const r=e._map.get(t);r!==void 0&&r.delete(n)},ek=(n,e,t,r)=>{const i=e._map.get(t)||null,o=n.doc,s=o.clientID;let a;if(r==null)a=new Ja([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Ja([r]);break;case Uint8Array:a=new qh(r);break;case Ga:a=new Zh(r);break;default:if(r instanceof hn)a=new Yo(r);else throw new Error("Unexpected content type")}new Ut(Te(s,Jt(o.store,s)),i,i&&i.lastId,null,null,e,t,a).integrate(n,0)},tk=(n,e)=>{const t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},lL=n=>{const e={};return n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},cL=(n,e)=>{const t=n._map.get(e);return t!==void 0&&!t.deleted},o0=n=>Cme(n.entries(),e=>!e[1].deleted);class cye extends e0{constructor(e,t){super(e,t),this._transaction=t}}class Zc extends hn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new Zc;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Zc}clone(){const e=new Zc;return e.insert(0,this.toArray().map(t=>t instanceof hn?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),n0(this,e,new cye(this,e))}insert(e,t){this.doc!==null?dt(this.doc,r=>{sL(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?dt(this.doc,t=>{lye(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?dt(this.doc,r=>{aL(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return iL(this,e)}toArray(){return nL(this)}slice(e=0,t=this.length){return tL(this,e,t)}toJSON(){return this.map(e=>e instanceof hn?e.toJSON():e)}map(e){return rL(this,e)}forEach(e){Yh(this,e)}[Symbol.iterator](){return aye(this)}_write(e){e.writeTypeRef(Rye)}}const dye=n=>new Zc;class uye extends e0{constructor(e,t,r){super(e,t),this.keysChanged=r}}class Qc extends hn{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Qc}clone(){const e=new Qc;return this.forEach((t,r)=>{e.set(r,t instanceof hn?t.clone():t)}),e}_callObserver(e,t){n0(this,e,new uye(this,e,t))}toJSON(){const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[r]=i instanceof hn?i.toJSON():i}}),e}get size(){return[...o0(this._map)].length}keys(){return U_(o0(this._map),e=>e[0])}values(){return U_(o0(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return U_(o0(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?dt(this.doc,t=>{i0(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?dt(this.doc,r=>{ek(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return tk(this,e)}has(e){return cL(this,e)}clear(){this.doc!==null?dt(this.doc,e=>{this.forEach(function(t,r,i){i0(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Dye)}}const hye=n=>new Qc,Qs=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&Oge(n,e);class nk{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&no(),this.right.content.constructor){case Bt:this.right.deleted||ed(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const dL=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case Bt:e.right.deleted||ed(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&Js(n,Te(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},s0=(n,e,t)=>{const r=new Map,i=t0(e,t);if(i){const o=new nk(i.p.left,i.p,i.index,r);return dL(n,o,t-i.index)}else{const o=new nk(null,e._start,0,r);return dL(n,o,t)}},uL=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===Bt&&Qs(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();const i=n.doc,o=i.clientID;r.forEach((s,a)=>{const l=t.left,c=t.right,d=new Ut(Te(o,Jt(i.store,o)),l,l&&l.lastId,c,c&&c.id,e,null,new Bt(a,s));d.integrate(n,0),t.right=d,t.forward()})},ed=(n,e)=>{const{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},hL=(n,e)=>{for(;n.right!==null&&(n.right.deleted||n.right.content.constructor===Bt&&Qs(e[n.right.content.key]||null,n.right.content.value));)n.forward()},pL=(n,e,t,r)=>{const i=n.doc,o=i.clientID,s=new Map;for(const a in r){const l=r[a],c=t.currentAttributes.get(a)||null;if(!Qs(c,l)){s.set(a,c);const{left:d,right:u}=t;t.right=new Ut(Te(o,Jt(i.store,o)),d,d&&d.lastId,u,u&&u.id,e,null,new Bt(a,l)),t.right.integrate(n,0),t.forward()}}return s},rk=(n,e,t,r,i)=>{t.currentAttributes.forEach((h,p)=>{i[p]===void 0&&(i[p]=null)});const o=n.doc,s=o.clientID;hL(t,i);const a=pL(n,e,t,i),l=r.constructor===String?new oo(r):r instanceof hn?new Yo(r):new qa(r);let{left:c,right:d,index:u}=t;e._searchMarker&&Gh(e._searchMarker,t.index,l.getLength()),d=new Ut(Te(s,Jt(o.store,s)),c,c&&c.lastId,d,d&&d.id,e,null,l),d.integrate(n,0),t.right=d,t.index=u,t.forward(),uL(n,e,t,a)},fL=(n,e,t,r,i)=>{const o=n.doc,s=o.clientID;hL(t,i);const a=pL(n,e,t,i);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===Bt));){if(!t.right.deleted)switch(t.right.content.constructor){case Bt:{const{key:l,value:c}=t.right.content,d=i[l];if(d!==void 0){if(Qs(d,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(n)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&Js(n,Te(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new Ut(Te(s,Jt(o.store,s)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new oo(l)),t.right.integrate(n,0),t.forward()}uL(n,e,t,a)},gL=(n,e,t,r,i)=>{let o=e;const s=xi();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===Bt){const c=o.content;s.set(c.key,c)}o=o.right}let a=0,l=!1;for(;e!==o;){if(t===e&&(l=!0),!e.deleted){const c=e.content;switch(c.constructor){case Bt:{const{key:d,value:u}=c,h=r.get(d)||null;(s.get(d)!==c||h===u)&&(e.delete(n),a++,!l&&(i.get(d)||null)===u&&h!==u&&(h===null?i.delete(d):i.set(d,h))),!l&&!e.deleted&&ed(i,c);break}}}e=e.right}return a},pye=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Bt){const r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},fye=n=>{let e=0;return dt(n.doc,t=>{let r=n._start,i=n._start,o=xi();const s=C_(o);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Bt:ed(s,i.content);break;default:e+=gL(t,r,i,o,s),o=C_(s),r=i;break}i=i.right}}),e},gye=n=>{const e=new Set,t=n.doc;for(const[r,i]of n.afterState.entries()){const o=n.beforeState.get(r)||0;i!==o&&GO(n,t.store.clients.get(r),o,i,s=>{!s.deleted&&s.content.constructor===Bt&&s.constructor!==Kr&&e.add(s.parent)})}dt(t,r=>{MO(n,n.deleteSet,i=>{if(i instanceof Kr||!i.parent._hasFormatting||e.has(i.parent))return;const o=i.parent;i.content.constructor===Bt?e.add(o):pye(r,i)});for(const i of e)fye(i)})},mL=(n,e,t)=>{const r=t,i=C_(e.currentAttributes),o=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Yo:case qa:case oo:t<e.right.length&&Js(n,Te(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}o&&gL(n,o,e.right,i,e.currentAttributes);const s=(e.left||e.right).parent;return s._searchMarker&&Gh(s._searchMarker,e.index,-r+t),e};class mye extends e0{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];dt(e,r=>{const i=new Map,o=new Map;let s=this.target._start,a=null;const l={};let c="",d=0,u=0;const h=()=>{if(a!==null){let p=null;switch(a){case"delete":u>0&&(p={delete:u}),u=0;break;case"insert":(typeof c=="object"||c.length>0)&&(p={insert:c},i.size>0&&(p.attributes={},i.forEach((g,f)=>{g!==null&&(p.attributes[f]=g)}))),c="";break;case"retain":d>0&&(p={retain:d},jge(l)||(p.attributes=Mge({},l))),d=0;break}p&&t.push(p),a=null}};for(;s!==null;){switch(s.content.constructor){case Yo:case qa:this.adds(s)?this.deletes(s)||(h(),a="insert",c=s.content.getContent()[0],h()):this.deletes(s)?(a!=="delete"&&(h(),a="delete"),u+=1):s.deleted||(a!=="retain"&&(h(),a="retain"),d+=1);break;case oo:this.adds(s)?this.deletes(s)||(a!=="insert"&&(h(),a="insert"),c+=s.content.str):this.deletes(s)?(a!=="delete"&&(h(),a="delete"),u+=s.length):s.deleted||(a!=="retain"&&(h(),a="retain"),d+=s.length);break;case Bt:{const{key:p,value:g}=s.content;if(this.adds(s)){if(!this.deletes(s)){const f=i.get(p)||null;Qs(f,g)?g!==null&&s.delete(r):(a==="retain"&&h(),Qs(g,o.get(p)||null)?delete l[p]:l[p]=g)}}else if(this.deletes(s)){o.set(p,g);const f=i.get(p)||null;Qs(f,g)||(a==="retain"&&h(),l[p]=f)}else if(!s.deleted){o.set(p,g);const f=l[p];f!==void 0&&(Qs(f,g)?f!==null&&s.delete(r):(a==="retain"&&h(),g===null?delete l[p]:l[p]=g))}s.deleted||(a==="insert"&&h(),ed(i,s.content));break}}s=s.right}for(h();t.length>0;){const p=t[t.length-1];if(p.retain!==void 0&&p.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class td extends hn{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new td}clone(){const e=new td;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new mye(this,e,t);n0(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===oo&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?dt(this.doc,r=>{const i=new nk(null,this._start,0,new Map);for(let o=0;o<e.length;o++){const s=e[o];if(s.insert!==void 0){const a=!t&&typeof s.insert=="string"&&o===e.length-1&&i.right===null&&s.insert.slice(-1)===`
`?s.insert.slice(0,-1):s.insert;(typeof a!="string"||a.length>0)&&rk(r,this,i,a,s.attributes||{})}else s.retain!==void 0?fL(r,this,i,s.retain,s.attributes||{}):s.delete!==void 0&&mL(r,i,s.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){const i=[],o=new Map,s=this.doc;let a="",l=this._start;function c(){if(a.length>0){const u={};let h=!1;o.forEach((g,f)=>{h=!0,u[f]=g});const p={insert:a};h&&(p.attributes=u),i.push(p),a=""}}const d=()=>{for(;l!==null;){if(Kh(l,e)||t!==void 0&&Kh(l,t))switch(l.content.constructor){case oo:{const u=o.get("ychange");e!==void 0&&!Kh(l,e)?(u===void 0||u.user!==l.id.client||u.type!=="removed")&&(c(),o.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!Kh(l,t)?(u===void 0||u.user!==l.id.client||u.type!=="added")&&(c(),o.set("ychange",r?r("added",l.id):{type:"added"})):u!==void 0&&(c(),o.delete("ychange")),a+=l.content.str;break}case Yo:case qa:{c();const u={insert:l.content.getContent()[0]};if(o.size>0){const h={};u.attributes=h,o.forEach((p,g)=>{h[g]=p})}i.push(u);break}case Bt:Kh(l,e)&&(c(),ed(o,l.content));break}l=l.right}c()};return e||t?dt(s,u=>{e&&G_(u,e),t&&G_(u,t),d()},"cleanup"):d(),i}insert(e,t,r){if(t.length<=0)return;const i=this.doc;i!==null?dt(i,o=>{const s=s0(o,this,e);r||(r={},s.currentAttributes.forEach((a,l)=>{r[l]=a})),rk(o,this,s,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r={}){const i=this.doc;i!==null?dt(i,o=>{const s=s0(o,this,e);rk(o,this,s,t,r)}):this._pending.push(()=>this.insertEmbed(e,t,r))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?dt(r,i=>{mL(i,s0(i,this,e),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const i=this.doc;i!==null?dt(i,o=>{const s=s0(o,this,e);s.right!==null&&fL(o,this,s,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?dt(this.doc,t=>{i0(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?dt(this.doc,r=>{ek(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return tk(this,e)}getAttributes(){return lL(this)}_write(e){e.writeTypeRef(Oye)}}const yye=n=>new td;class ik{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===Xh||t.constructor===Xa)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Xa extends hn{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Xa}clone(){const e=new Xa;return e.insert(0,this.toArray().map(t=>t instanceof hn?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new ik(this,e)}querySelector(e){e=e.toUpperCase();const t=new ik(this,r=>r.nodeName&&r.nodeName.toUpperCase()===e).next();return t.done?null:t.value}querySelectorAll(e){return e=e.toUpperCase(),Ys(new ik(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){n0(this,e,new vye(this,t,e))}toString(){return rL(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Yh(this,o=>{i.insertBefore(o.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?dt(this.doc,r=>{sL(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)dt(this.doc,r=>{const i=e&&e instanceof hn?e._item:e;r0(r,this,i,t)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(o=>o===e)+1;if(i===0&&e!==null)throw qs("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?dt(this.doc,r=>{aL(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return nL(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return iL(this,e)}slice(e=0,t=this.length){return tL(this,e,t)}forEach(e){Yh(this,e)}_write(e){e.writeTypeRef(zye)}}const wye=n=>new Xa;class Xh extends Xa{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Xh(this.nodeName)}clone(){const e=new Xh(this.nodeName),t=this.getAttributes();return Tge(t,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof hn?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const l=r[a];t.push(l+'="'+e[l]+'"')}const o=this.nodeName.toLocaleLowerCase(),s=t.length>0?" "+t.join(" "):"";return`<${o}${s}>${super.toString()}</${o}>`}removeAttribute(e){this.doc!==null?dt(this.doc,t=>{i0(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?dt(this.doc,r=>{ek(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return tk(this,e)}hasAttribute(e){return cL(this,e)}getAttributes(){return lL(this)}toDOM(e=document,t={},r){const i=e.createElement(this.nodeName),o=this.getAttributes();for(const s in o){const a=o[s];typeof a=="string"&&i.setAttribute(s,a)}return Yh(this,s=>{i.appendChild(s.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(Lye),e.writeKey(this.nodeName)}}const bye=n=>new Xh(n.readKey());class vye extends e0{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class a0 extends Qc{constructor(e){super(),this.hookName=e}_copy(){return new a0(this.hookName)}clone(){const e=new a0(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){const i=t[this.hookName];let o;return i!==void 0?o=i.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(e){e.writeTypeRef(Nye),e.writeKey(this.hookName)}}const Sye=n=>new a0(n.readKey());class l0 extends td{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new l0}clone(){const e=new l0;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const t=[];for(const i in e.attributes){const o=[];for(const s in e.attributes[i])o.push({key:s,value:e.attributes[i][s]});o.sort((s,a)=>s.key<a.key?-1:1),t.push({nodeName:i,attrs:o})}t.sort((i,o)=>i.nodeName<o.nodeName?-1:1);let r="";for(let i=0;i<t.length;i++){const o=t[i];r+=`<${o.nodeName}`;for(let s=0;s<o.attrs.length;s++){const a=o.attrs[s];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=t.length-1;i>=0;i--)r+=`</${t[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(Fye)}}const xye=n=>new l0;class ok{constructor(e,t){this.id=e,this.length=t}get deleted(){throw to()}mergeWith(e){return!1}write(e,t,r){throw to()}integrate(e,t){throw to()}}const _ye=0;class Kr extends ok{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),WO(e.doc.store,this)}write(e,t){e.writeInfo(_ye),e.writeLen(this.length-t)}getMissing(e,t){return null}}class qh{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new qh(this.content)}splice(e){throw to()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}const kye=n=>new qh(n.readBuf());class Jh{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Jh(this.len)}splice(e){const t=new Jh(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){Xy(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const Cye=n=>new Jh(n.readLen()),yL=(n,e)=>new Ga({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Zh{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Zh(yL(this.doc.guid,this.opts))}splice(e){throw to()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const Eye=n=>new Zh(yL(n.readString(),n.readAny()));class qa{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new qa(this.embed)}splice(e){throw to()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}const Pye=n=>new qa(n.readJSON());class Bt{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Bt(this.key,this.value)}splice(e){throw to()}mergeWith(e){return!1}integrate(e,t){const r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Iye=n=>new Bt(n.readKey(),n.readJSON());class c0{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new c0(this.arr)}splice(e){const t=new c0(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const o=this.arr[i];e.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const Mye=n=>{const e=n.readLen(),t=[];for(let r=0;r<e;r++){const i=n.readString();i==="undefined"?t.push(void 0):t.push(JSON.parse(i))}return new c0(t)};class Ja{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ja(this.arr)}splice(e){const t=new Ja(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const o=this.arr[i];e.writeAny(o)}}getRef(){return 8}}const Aye=n=>{const e=n.readLen(),t=[];for(let r=0;r<e;r++)t.push(n.readAny());return new Ja(t)};class oo{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new oo(this.str)}splice(e){const t=new oo(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const Tye=n=>new oo(n.readString()),jye=[dye,hye,yye,bye,wye,Sye,xye],Rye=0,Dye=1,Oye=2,Lye=3,zye=4,Nye=5,Fye=6;class Yo{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Yo(this.type._copy())}splice(e){throw to()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const $ye=n=>new Yo(jye[n.readTypeRef()](n)),d0=(n,e,t)=>{const{client:r,clock:i}=e.id,o=new Ut(Te(r,i+t),e,Te(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&o.markDeleted(),e.keep&&(o.keep=!0),e.redone!==null&&(o.redone=Te(e.redone.client,e.redone.clock+t)),e.right=o,o.right!==null&&(o.right.left=o),n._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),e.length=t,o};class Ut extends ok{constructor(e,t,r,i,o,s,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=o,this.parent=s,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?pO:0}set marker(e){(this.info&T_)>0!==e&&(this.info^=T_)}get marker(){return(this.info&T_)>0}get keep(){return(this.info&hO)>0}set keep(e){this.keep!==e&&(this.info^=hO)}get countable(){return(this.info&pO)>0}get deleted(){return(this.info&A_)>0}set deleted(e){this.deleted!==e&&(this.info^=A_)}markDeleted(){this.info|=A_}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Jt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Jt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Jc&&this.id.client!==this.parent.client&&this.parent.clock>=Jt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=KO(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Js(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Kr||this.right&&this.right.constructor===Kr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ut&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Ut&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Jc){const r=Y_(t,this.parent);r.constructor===Kr?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=KO(e,e.doc.store,Te(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const o=new Set,s=new Set;for(;i!==null&&i!==this.right;){if(s.add(i),o.add(i),qy(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,o.clear();else if(qy(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&s.has(Y_(e.doc.store,i.origin)))o.has(Y_(e.doc.store,i.origin))||(r=i,o.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),WO(e.doc.store,this),this.content.integrate(e,this),XO(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Kr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Te(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&qy(e.origin,this.lastId)&&this.right===e&&qy(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),Xy(e.deleteSet,this.id.client,this.id.clock,this.length),XO(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw no();this.content.gc(e),t?Gme(e,this,new Kr(this.id,this.length)):this.content=new Jh(this.length)}write(e,t){const r=t>0?Te(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,o=this.parentSub,s=this.content.getRef()&Vy|(r===null?0:Er)|(i===null?0:Wo)|(o===null?0:$h);if(e.writeInfo(s),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const c=Wme(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Jc?(e.writeParentInfo(!1),e.writeLeftID(a)):no();o!==null&&e.writeString(o)}this.content.write(e,t)}}const wL=(n,e)=>Bye[e&Vy](n),Bye=[()=>{no()},Cye,Mye,kye,Tye,Pye,Iye,$ye,Aye,Eye,()=>{no()}],Uye=10;class Gr extends ok{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){no()}write(e,t){e.writeInfo(Uye),Me(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const bL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},vL="__ $YJS$ __";bL[vL]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),bL[vL]=!0;const nd=()=>new Map,SL=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},xL=()=>new Set,Vye=Array.from,Hye=String.fromCharCode,Wye=n=>n.toLowerCase(),Kye=/^\s*/g,Gye=n=>n.replace(Kye,""),Yye=/([A-Z])/g,_L=(n,e)=>Gye(n.replace(Yye,t=>`${e}${Wye(t)}`)),Xye=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},Qh=typeof TextEncoder<"u"?new TextEncoder:null,qye=n=>Qh.encode(n),Jye=Qh?qye:Xye;let sk=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});sk&&sk.decode(new Uint8Array).length===1&&(sk=null);const Zye=n=>n===void 0?null:n;class Qye{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let kL=new Qye,ak=!0;try{typeof localStorage<"u"&&localStorage&&(kL=localStorage,ak=!1)}catch{}const CL=kL,e0e=n=>ak||addEventListener("storage",n),t0e=n=>ak||removeEventListener("storage",n),n0e=(n,e)=>{const t=[];for(const r in n)t.push(e(n[r],r));return t},r0e=(n,e)=>e.includes(n),rd=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",EL=typeof window<"u"&&typeof document<"u"&&!rd;let so;const i0e=()=>{if(so===void 0)if(rd){so=nd();const n=process.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&so.set(e,""),e=r):e!==null&&(so.set(e,r),e=null)}e!==null&&so.set(e,"")}else typeof location=="object"?(so=nd(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");so.set(`--${_L(e,"-")}`,t),so.set(`-${_L(e,"-")}`,t)}})):so=nd();return so},lk=n=>i0e().has(n),ck=n=>Zye(rd?process.env[n.toUpperCase()]:CL.getItem(n));(n=>lk("--"+n)||ck(n)!==null)("production");const PL=rd&&r0e({}.FORCE_COLOR,["true","1","2"]);!lk("no-colors")&&(!rd||process.stdout.isTTY||PL)&&(!rd||lk("color")||PL||ck("COLORTERM")!==null||(ck("TERM")||"").includes("color"));const o0e=Math.floor,IL=(n,e)=>n<e?n:e,s0e=(n,e)=>n>e?n:e,a0e=Math.pow,ML=128,u0=127,l0e=Number.MAX_SAFE_INTEGER;let c0e=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}};const _i=()=>new c0e,dk=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},Yr=n=>{const e=new Uint8Array(dk(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},h0=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},Un=(n,e)=>{for(;e>u0;)h0(n,ML|u0&e),e=o0e(e/128);h0(n,u0&e)},uk=new Uint8Array(3e4),d0e=uk.length/3,Qbe=(n,e)=>{if(e.length<d0e){const t=Qh.encodeInto(e,uk).written||0;Un(n,t);for(let r=0;r<t;r++)h0(n,uk[r])}else id(n,Jye(e))},eve=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;Un(n,r);for(let i=0;i<r;i++)h0(n,t.codePointAt(i))};Qh&&Qh.encodeInto;const u0e=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=IL(t-r,e.length),o=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,o>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(s0e(t*2,o)),n.cbuf.set(e.subarray(i)),n.cpos=o)},id=(n,e)=>{Un(n,e.byteLength),u0e(n,e)},AL=n=>new Error(n),h0e=AL("Unexpected end of array"),p0e=AL("Integer out of Range");let f0e=class{constructor(n){this.arr=n,this.pos=0}};const g0e=n=>new f0e(n),m0e=(n,e)=>{const t=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},y0e=n=>m0e(n,TL(n)),TL=n=>{let e=0,t=1;const r=n.arr.length;for(;n.pos<r;){const i=n.arr[n.pos++];if(e=e+(i&u0)*t,t*=128,i<ML)return e;if(e>l0e)throw p0e}throw h0e},w0e=n=>new Uint8Array(n),b0e=(n,e,t)=>new Uint8Array(n,e,t),v0e=n=>new Uint8Array(n),S0e=n=>{let e="";for(let t=0;t<n.byteLength;t++)e+=Hye(n[t]);return btoa(e)},x0e=n=>Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("base64"),_0e=n=>{const e=atob(n),t=w0e(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},k0e=n=>{const e=Buffer.from(n,"base64");return b0e(e.buffer,e.byteOffset,e.byteLength)},C0e=EL?S0e:x0e,E0e=EL?_0e:k0e,jL=new Map;class P0e{constructor(e){this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&this.onmessage!==null&&this.onmessage({data:E0e(t.newValue||"")}),e0e(this._onChange)}postMessage(e){CL.setItem(this.room,C0e(v0e(e)))}close(){t0e(this._onChange)}}const I0e=typeof BroadcastChannel>"u"?P0e:BroadcastChannel,hk=n=>SL(jL,n,()=>{const e=xL(),t=new I0e(n);return t.onmessage=r=>e.forEach(i=>i(r.data,"broadcastchannel")),{bc:t,subs:e}}),M0e=(n,e)=>(hk(n).subs.add(e),e),A0e=(n,e)=>{const t=hk(n),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),jL.delete(n)),r},od=(n,e,t=null)=>{const r=hk(n);r.bc.postMessage(e),r.subs.forEach(i=>i(e,t))},pk=Date.now,RL=Math.floor,T0e=(n,e)=>n<e?n:e,j0e=(n,e)=>n>e?n:e,DL=128,p0=127,R0e=Number.MAX_SAFE_INTEGER,D0e=()=>new Set,O0e=Array.from,L0e=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},ep=typeof TextEncoder<"u"?new TextEncoder:null,z0e=n=>ep.encode(n),N0e=ep?z0e:L0e;let tp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});tp&&tp.decode(new Uint8Array).length===1&&(tp=null);class F0e{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const $0e=()=>new F0e,B0e=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},U0e=n=>{const e=new Uint8Array(B0e(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},f0=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},Xo=(n,e)=>{for(;e>p0;)f0(n,DL|p0&e),e=RL(e/128);f0(n,p0&e)},fk=new Uint8Array(3e4),V0e=fk.length/3,H0e=(n,e)=>{if(e.length<V0e){const t=ep.encodeInto(e,fk).written||0;Xo(n,t);for(let r=0;r<t;r++)f0(n,fk[r])}else g0(n,N0e(e))},W0e=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;Xo(n,r);for(let i=0;i<r;i++)f0(n,t.codePointAt(i))},K0e=ep&&ep.encodeInto?H0e:W0e,G0e=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=T0e(t-r,e.length),o=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,o>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(j0e(t*2,o)),n.cbuf.set(e.subarray(i)),n.cpos=o)},g0=(n,e)=>{Xo(n,e.byteLength),G0e(n,e)},OL=n=>new Error(n),Y0e=OL("Unexpected end of array"),X0e=OL("Integer out of Range");class q0e{constructor(e){this.arr=e,this.pos=0}}const J0e=n=>new q0e(n),Z0e=(n,e)=>{const t=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},gk=n=>Z0e(n,Za(n)),LL=n=>n.arr[n.pos++],Za=n=>{let e=0,t=1;const r=n.arr.length;for(;n.pos<r;){const i=n.arr[n.pos++];if(e=e+(i&p0)*t,t*=128,i<DL)return e;if(e>R0e)throw X0e}throw Y0e},Q0e=n=>{let e=Za(n);if(e===0)return"";{let t=String.fromCodePoint(LL(n));if(--e<100)for(;e--;)t+=String.fromCodePoint(LL(n));else for(;e>0;){const r=e<1e4?e:1e4,i=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,t+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(t))}},ewe=n=>tp.decode(gk(n)),zL=tp?ewe:Q0e,NL=0,mk=1,FL=2,yk=(n,e)=>{Xo(n,NL);const t=Vme(e);g0(n,t)},$L=(n,e,t)=>{Xo(n,mk),g0(n,Fme(e,t))},twe=(n,e,t)=>$L(e,t,gk(n)),BL=(n,e,t)=>{try{Lme(e,gk(n),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},nwe=(n,e)=>{Xo(n,FL),g0(n,e)},rwe=BL,iwe=(n,e,t,r)=>{const i=Za(n);switch(i){case NL:twe(n,e,t);break;case mk:BL(n,t,r);break;case FL:rwe(n,t,r);break;default:throw new Error("Unknown message type")}return i},owe=0,swe=(n,e,t)=>{switch(Za(n)){case owe:t(e,zL(n))}},m0=Date.now,wk=()=>new Map,awe=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r};let lwe=class{constructor(){this._observers=wk()}on(n,e){awe(this._observers,n,D0e).add(e)}once(n,e){const t=(...r)=>{this.off(n,t),e(...r)};this.on(n,t)}off(n,e){const t=this._observers.get(n);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(n))}emit(n,e){return O0e((this._observers.get(n)||wk()).values()).forEach(t=>t(...e))}destroy(){this._observers=wk()}};const cwe=Object.keys,UL=n=>cwe(n).length,dwe=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),uwe=(n,e)=>n===e,np=(n,e)=>{if(n==null||e==null)return uwe(n,e);if(n.constructor!==e.constructor)return!1;if(n===e)return!0;switch(n.constructor){case ArrayBuffer:n=new Uint8Array(n),e=new Uint8Array(e);case Uint8Array:{if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;break}case Set:{if(n.size!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;break}case Map:{if(n.size!==e.size)return!1;for(const t of n.keys())if(!e.has(t)||!np(n.get(t),e.get(t)))return!1;break}case Object:if(UL(n)!==UL(e))return!1;for(const t in n)if(!dwe(n,t)||!np(n[t],e[t]))return!1;break;case Array:if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!np(n[t],e[t]))return!1;break;default:return!1}return!0},bk=3e4;class hwe extends lwe{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const t=m0();this.getLocalState()!==null&&bk/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,o)=>{o!==this.clientID&&bk<=t-i.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&vk(this,r,"timeout")},RL(bk/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,r=this.meta.get(t),i=r===void 0?0:r.clock+1,o=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:i,lastUpdated:m0()});const s=[],a=[],l=[],c=[];e===null?c.push(t):o==null?e!=null&&s.push(t):(a.push(t),np(o,e)||l.push(t)),(s.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:s,updated:l,removed:c},"local"]),this.emit("update",[{added:s,updated:a,removed:c},"local"])}setLocalStateField(e,t){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}}const vk=(n,e,t)=>{const r=[];for(let i=0;i<e.length;i++){const o=e[i];if(n.states.has(o)){if(n.states.delete(o),o===n.clientID){const s=n.meta.get(o);n.meta.set(o,{clock:s.clock+1,lastUpdated:m0()})}r.push(o)}}r.length>0&&(n.emit("change",[{added:[],updated:[],removed:r},t]),n.emit("update",[{added:[],updated:[],removed:r},t]))},rp=(n,e,t=n.states)=>{const r=e.length,i=$0e();Xo(i,r);for(let o=0;o<r;o++){const s=e[o],a=t.get(s)||null,l=n.meta.get(s).clock;Xo(i,s),Xo(i,l),K0e(i,JSON.stringify(a))}return U0e(i)},pwe=(n,e,t)=>{const r=J0e(e),i=m0(),o=[],s=[],a=[],l=[],c=Za(r);for(let d=0;d<c;d++){const u=Za(r);let h=Za(r);const p=JSON.parse(zL(r)),g=n.meta.get(u),f=n.states.get(u),w=g===void 0?0:g.clock;(w<h||w===h&&p===null&&n.states.has(u))&&(p===null?u===n.clientID&&n.getLocalState()!=null?h++:n.states.delete(u):n.states.set(u,p),n.meta.set(u,{clock:h,lastUpdated:i}),g===void 0&&p!==null?o.push(u):g!==void 0&&p===null?l.push(u):p!==null&&(np(p,f)||a.push(u),s.push(u)))}(o.length>0||a.length>0||l.length>0)&&n.emit("change",[{added:o,updated:a,removed:l},t]),(o.length>0||s.length>0||l.length>0)&&n.emit("update",[{added:o,updated:s,removed:l},t])};let fwe=class{constructor(){this._observers=nd()}on(n,e){SL(this._observers,n,xL).add(e)}once(n,e){const t=(...r)=>{this.off(n,t),e(...r)};this.on(n,t)}off(n,e){const t=this._observers.get(n);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(n))}emit(n,e){return Vye((this._observers.get(n)||nd()).values()).forEach(t=>t(...e))}destroy(){this._observers=nd()}};const gwe=n=>n0e(n,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&");var Qa=0,VL=3,sd=1,mwe=2,ywe=typeof window>"u";function wwe(n,e){if(!n)throw new Error(e)}var ip=[];ip[Qa]=(n,e,t,r,i)=>{Un(n,Qa);const o=iwe(e,n,t.doc,t);r&&o===mk&&!t.synced&&(t.synced=!0)},ip[VL]=(n,e,t,r,i)=>{Un(n,sd),id(n,rp(t.awareness,Array.from(t.awareness.getStates().keys())))},ip[sd]=(n,e,t,r,i)=>{pwe(t.awareness,y0e(e),t)},ip[mwe]=(n,e,t,r,i)=>{swe(e,t.doc,(o,s)=>bwe(t,s))};var HL=3e4;function bwe(n,e){console.warn(`Permission denied to access ${n.url}.
${e}`)}function WL(n,e,t){const r=g0e(e),i=_i(),o=TL(r),s=n.messageHandlers[o];return s?s(i,r,n,t,o):console.error("Unable to compute message"),i}function KL(n){if(n.shouldConnect&&n.ws===null){const e=new n._WS(n.url);e.binaryType="arraybuffer",n.ws=e,n.wsconnecting=!0,n.wsconnected=!1,n.synced=!1,e.onmessage=t=>{if(typeof t.data=="string")return;n.wsLastMessageReceived=pk();const r=WL(n,new Uint8Array(t.data),!0);dk(r)>1&&e.send(Yr(r))},e.onerror=t=>{n.emit("connection-error",[t,n])},e.onclose=t=>{n.emit("connection-close",[t,n]),n.ws=null,n.wsconnecting=!1,n.wsconnected?(n.wsconnected=!1,n.synced=!1,vk(n.awareness,Array.from(n.awareness.getStates().keys()).filter(r=>r!==n.doc.clientID),n),n.emit("status",[{status:"disconnected"}])):n.wsUnsuccessfulReconnects++,setTimeout(KL,IL(a0e(2,n.wsUnsuccessfulReconnects)*100,n.maxBackoffTime),n)},e.onopen=()=>{n.wsLastMessageReceived=pk(),n.wsconnecting=!1,n.wsconnected=!0,n.wsUnsuccessfulReconnects=0,n.emit("status",[{status:"connected"}]);const t=_i();if(Un(t,Qa),yk(t,n.doc),e.send(Yr(t)),n.awareness.getLocalState()!==null){const r=_i();Un(r,sd),id(r,rp(n.awareness,[n.doc.clientID])),e.send(Yr(r))}},n.emit("status",[{status:"connecting"}])}}function Sk(n,e){const t=n.ws;n.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),n.bcconnected&&od(n.bcChannel,e,n)}var vwe=class extends fwe{constructor(e,t,r,{connect:i=!0,awareness:o=new hwe(r),params:s={},WebSocketPolyfill:a=WebSocket,resyncInterval:l=-1,maxBackoffTime:c=2500,disableBc:d=ywe}={}){super();y(this,"maxBackoffTime");y(this,"bcChannel");y(this,"url");y(this,"roomname");y(this,"doc");y(this,"_WS");y(this,"awareness");y(this,"wsconnected");y(this,"wsconnecting");y(this,"bcconnected");y(this,"disableBc");y(this,"wsUnsuccessfulReconnects");y(this,"messageHandlers");y(this,"_synced");y(this,"ws");y(this,"wsLastMessageReceived");y(this,"shouldConnect");y(this,"_resyncInterval");y(this,"_bcSubscriber");y(this,"_updateHandler");y(this,"_awarenessUpdateHandler");y(this,"_unloadHandler");y(this,"_checkInterval");for(;e[e.length-1]==="/";)e=e.slice(0,e.length-1);const u=gwe(s);this.maxBackoffTime=c,this.bcChannel=e+"/"+t,this.url=e+"/"+t+(u.length===0?"":"?"+u),this.roomname=t,this.doc=r,this._WS=a,this.awareness=o,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=d,this.wsUnsuccessfulReconnects=0,this.messageHandlers=ip.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=i,this._resyncInterval=0,l>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const h=_i();Un(h,Qa),yk(h,r),this.ws.send(Yr(h))}},l)),this._bcSubscriber=(h,p)=>{if(p!==this){const g=WL(this,new Uint8Array(h),!1);dk(g)>1&&od(this.bcChannel,Yr(g),this)}},this._updateHandler=(h,p)=>{if(p!==this){const g=_i();Un(g,Qa),nwe(g,h),Sk(this,Yr(g))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:h,updated:p,removed:g},f)=>{const w=h.concat(p).concat(g),v=_i();Un(v,sd),id(v,rp(o,w)),Sk(this,Yr(v))},this._unloadHandler=()=>{vk(this.awareness,[r.clientID],"window unload")},typeof window<"u"?window.addEventListener("unload",this._unloadHandler):typeof process<"u"&&process.on("exit",this._unloadHandler),o.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&HL<pk()-this.wsLastMessageReceived&&(wwe(this.ws!==null,"ws must not be null"),this.ws.close())},HL/10),i&&this.connect()}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window<"u"?window.removeEventListener("unload",this._unloadHandler):typeof process<"u"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(M0e(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);const e=_i();Un(e,Qa),yk(e,this.doc),od(this.bcChannel,Yr(e),this);const t=_i();Un(t,Qa),$L(t,this.doc),od(this.bcChannel,Yr(t),this);const r=_i();Un(r,VL),od(this.bcChannel,Yr(r),this);const i=_i();Un(i,sd),id(i,rp(this.awareness,[this.doc.clientID])),od(this.bcChannel,Yr(i),this)}disconnectBc(){const e=_i();Un(e,sd),id(e,rp(this.awareness,[this.doc.clientID],new Map)),Sk(this,Yr(e)),this.bcconnected&&(A0e(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(KL(this),this.connectBc())}};function Swe(){if(crypto.randomUUID)return crypto.randomUUID();let n=new Date().getTime(),e=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let r=Math.random()*16;return n>0?(r=(n+r)%16|0,n=Math.floor(n/16)):(r=(e+r)%16|0,e=Math.floor(e/16)),(t==="x"?r:r&3|8).toString(16)})}function GL(n,e,t){if(typeof n!==t)throw new Error(`Invalid "${e}" parameter provided to YPartyKitProvider. Expected: ${t}, received: ${n}`)}var xwe=class extends vwe{constructor(e,t,r,i={}){GL(e,"host","string"),GL(t,"room","string"),e=e.replace(/^(http|https|ws|wss):\/\//,"");const o=`${e.startsWith("localhost:")||e.startsWith("127.0.0.1:")?"ws":"wss"}://${e}${i.party?`/parties/${i.party}`:"/party"}`,s=Swe();i.params===void 0?i.params={_pk:s}:i.params._pk=s;super(o,t,r??new Ga,i);y(this,"id");this.id=s}};const xk=()=>new Map,_we=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},kwe=()=>new Set,Cwe=Array.from;class Ewe{constructor(){this._observers=xk()}on(e,t){_we(this._observers,e,kwe).add(t)}once(e,t){const r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Cwe((this._observers.get(e)||xk()).values()).forEach(r=>r(...t))}destroy(){this._observers=xk()}}class Pwe extends Ewe{constructor(e){super(),this.yarray=e,this.doc=e.doc,this.map=new Map;{const t=e.toArray();this.doc.transact(()=>{for(let r=t.length-1;r>=0;r--){const i=t[r];this.map.has(i.key)?e.delete(r):this.map.set(i.key,i)}})}e.observe((t,r)=>{const i=new Map,o=Array.from(t.changes.added);t.changes.deleted.forEach(c=>{c.content.getContent().forEach(d=>{this.map.get(d.key)===d&&(this.map.delete(d.key),i.set(d.key,{action:"delete",oldValue:d.val}))})});const s=new Map;o.map(c=>c.content.getContent()).flat().forEach(c=>{s.set(c.key,c)});const a=new Set,l=e.toArray();this.doc.transact(c=>{for(let d=l.length-1;d>=0&&(s.size>0||a.size>0);d--){const u=l[d];if(a.has(u.key))a.delete(u.key),e.delete(d,1);else if(s.get(u.key)===u){const h=this.map.get(u.key);if(h)a.add(u.key),i.set(u.key,{action:"update",oldValue:h.val,newValue:u.val});else{const p=i.get(u.key);p&&p.action==="delete"?i.set(u.key,{action:"update",newValue:u.val,oldValue:p.oldValue}):i.set(u.key,{action:"add",newValue:u.val})}s.delete(u.key),this.map.set(u.key,u)}else s.has(u.key)&&(a.add(u.key),s.delete(u.key))}}),i.size>0&&this.emit("change",[i,r])})}set(e,t){this.doc.transact(r=>{this.map.has(e)&&this.delete(e),this.yarray.push([{key:e,val:t}])})}delete(e){let t=0;for(const r of this.yarray){if(r.key===e){this.yarray.delete(t);break}t++}}get(e){const t=this.map.get(e);return t&&t.val}has(e){return this.map.has(e)}}const Iwe={store:{"document:document":{gridSize:10,name:"",meta:{},id:"document:document",typeName:"document"},"pointer:pointer":{id:"pointer:pointer",typeName:"pointer",x:0,y:0,lastActivityTimestamp:0,meta:{}},"page:page":{meta:{},id:"page:page",name:"Page 1",index:"a1",typeName:"page"},"camera:page:page":{x:0,y:0,z:1,meta:{},id:"camera:page:page",typeName:"camera"},"instance_page_state:page:page":{editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{},id:"instance_page_state:page:page",pageId:"page:page",typeName:"instance_page_state"},"instance:instance":{followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribble:null,cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!0,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:720,h:400},zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!0,devicePixelRatio:2,isCoarsePointer:!1,isHoveringCanvas:!1,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},id:"instance:instance",currentPageId:"page:page",typeName:"instance"}},schema:{schemaVersion:1,storeVersion:4,recordVersions:{asset:{version:1,subTypeKey:"type",subTypeVersions:{image:2,video:2,bookmark:0}},camera:{version:1},document:{version:2},instance:{version:21},instance_page_state:{version:5},page:{version:1},shape:{version:3,subTypeKey:"type",subTypeVersions:{group:0,text:1,bookmark:1,draw:1,geo:7,note:4,line:1,frame:0,arrow:1,highlight:0,embed:4,image:2,video:1}},instance_presence:{version:5},pointer:{version:1}}}};function Mwe({hostUrl:n,version:e=1,roomId:t="example",shapeUtils:r=[]}){const[i]=S.useState(()=>{const d=sA({shapeUtils:[...pj,...r]});return d.loadSnapshot(Iwe),d}),[o,s]=S.useState({status:"loading"}),{yDoc:a,yStore:l,room:c}=S.useMemo(()=>{const d=new Ga({gc:!0}),u=d.getArray(`tl_${t}`),h=new Pwe(u);return{yDoc:d,yStore:h,room:new xwe(n,`${t}_${e}`,d,{connect:!0})}},[n,t,e]);return S.useEffect(()=>{s({status:"loading"});const d=[];function u(){d.push(i.listen(function({changes:x}){a.transact(()=>{Object.values(x.added).forEach(E=>{l.set(E.id,E)}),Object.values(x.updated).forEach(([E,k])=>{l.set(k.id,k)}),Object.values(x.removed).forEach(E=>{l.delete(E.id)})})},{source:"user",scope:"document"}));const g=(x,E)=>{if(E.local)return;const k=[],P=[];x.forEach((I,A)=>{switch(I.action){case"add":case"update":{const T=l.get(A);T&&P.push(T);break}case"delete":{k.push(A);break}}}),i.mergeRemoteChanges(()=>{k.length&&i.remove(k),P.length&&i.put(P)})};l.on("change",g),d.push(()=>l.off("change",g));const f=Q("userPreferences",()=>{const x=CM();return{id:x.id,color:x.color??nr.color,name:x.name??nr.name}}),w=c.awareness.clientID.toString(),v=ou.createId(w),b=Y6(f)(i);c.awareness.setLocalStateField("presence",b.get()),d.push(Ll("when presence changes",()=>{const x=b.get();requestAnimationFrame(()=>{c.awareness.setLocalStateField("presence",x)})}));const _=x=>{const E=c.awareness.getStates(),k=[],P=[];for(const I of x.added){const A=E.get(I);A!=null&&A.presence&&A.presence.id!==v&&P.push(A.presence)}for(const I of x.updated){const A=E.get(I);A!=null&&A.presence&&A.presence.id!==v&&P.push(A.presence)}for(const I of x.removed)k.push(ou.createId(I.toString()));i.mergeRemoteChanges(()=>{k.length&&i.remove(k),P.length&&i.put(P)})};c.awareness.on("update",_),d.push(()=>c.awareness.off("update",_)),l.yarray.length?zr(()=>{i.clear();const x=l.yarray.toJSON().map(({val:E})=>E);i.put(x)}):a.transact(()=>{for(const x of i.allRecords())l.set(x.id,x)}),s({store:i,status:"synced-remote",connectionStatus:"online"})}let h=!1;function p({status:g}){if(g==="disconnected"){s({store:i,status:"synced-remote",connectionStatus:"offline"});return}if(c.off("synced",u),g==="connected"){if(h)return;h=!0,c.on("synced",u),d.push(()=>c.off("synced",u))}}return c.on("status",p),d.push(()=>c.off("status",p)),()=>{d.forEach(g=>g()),d.length=0}},[c,a,i,l]),o}const Awe={actions(n,e){return e["toggle-physics"]={id:"toggle-physics",label:"Toggle Physics",readonlyOk:!0,kbd:"p",onSelect(t){const r=new CustomEvent("togglePhysicsEvent");window.dispatchEvent(r)}},e},keyboardShortcutsMenu(n,e,{actions:t}){return e.find(r=>r.id==="shortcuts-dialog.tools").children.push($(t["toggle-physics"])),e}},Twe={}.VITE_PRODUCTION_URL.replace("https://","ws://");function jwe(){const n=new URLSearchParams(window.location.search).get("room")||"42";return Mwe({roomId:n,hostUrl:Twe}),m.jsx("div",{className:"tldraw__editor",children:m.jsx($ae,{autoFocus:!0,shareZone:m.jsx(Rwe,{}),overrides:Awe,children:m.jsx(hge,{})})})}const Rwe=$e(()=>{const n=G(),{color:e,name:t}=n.user.getUserPreferences();return m.jsxs("div",{style:{pointerEvents:"all",display:"flex",width:"148px",margin:"4px 8px",border:"none"},children:[m.jsx("input",{style:{borderRadius:"9px 0px 0px 9px",border:"none",backgroundColor:"white",boxShadow:"0px 0px 4px rgba(0, 0, 0, 0.25)"},type:"color",value:e,onChange:r=>{n.user.updateUserPreferences({color:r.currentTarget.value})}}),m.jsx("input",{style:{width:"100%",borderRadius:"0px 9px 9px 0px",border:"none",backgroundColor:"white",boxShadow:"0px 0px 4px rgba(0, 0, 0, 0.25)"},value:t,onChange:r=>{n.user.updateUserPreferences({name:r.currentTarget.value})}})]})});A0.createRoot(document.getElementById("root")).render(m.jsx(re.StrictMode,{children:m.jsx(jwe,{})}))})()});export default $be();
