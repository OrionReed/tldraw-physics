var Aue=Object.defineProperty;var Tue=(bs,dt,qn)=>dt in bs?Aue(bs,dt,{enumerable:!0,configurable:!0,writable:!0,value:qn}):bs[dt]=qn;var y=(bs,dt,qn)=>(Tue(bs,typeof dt!="symbol"?dt+"":dt,qn),qn);(async()=>{var wS,bS,vS,SS,xS,_S,kS,CS,PS,ES,IS,MS,AS,TS,jS,RS,OS,DS,LS,zS;function bs(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();var dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var YS={exports:{}},ju={},XS={exports:{}},Pe={},Ql=Symbol.for("react.element"),y4=Symbol.for("react.portal"),w4=Symbol.for("react.fragment"),b4=Symbol.for("react.strict_mode"),v4=Symbol.for("react.profiler"),S4=Symbol.for("react.provider"),x4=Symbol.for("react.context"),_4=Symbol.for("react.forward_ref"),k4=Symbol.for("react.suspense"),C4=Symbol.for("react.memo"),P4=Symbol.for("react.lazy"),qS=Symbol.iterator;function E4(n){return n===null||typeof n!="object"?null:(n=qS&&n[qS]||n["@@iterator"],typeof n=="function"?n:null)}var JS={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ZS=Object.assign,QS={};function pa(n,e,t){this.props=n,this.context=e,this.refs=QS,this.updater=t||JS}pa.prototype.isReactComponent={},pa.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")},pa.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function ex(){}ex.prototype=pa.prototype;function wm(n,e,t){this.props=n,this.context=e,this.refs=QS,this.updater=t||JS}var bm=wm.prototype=new ex;bm.constructor=wm,ZS(bm,pa.prototype),bm.isPureReactComponent=!0;var tx=Array.isArray,nx=Object.prototype.hasOwnProperty,vm={current:null},rx={key:!0,ref:!0,__self:!0,__source:!0};function ix(n,e,t){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)nx.call(e,r)&&!rx.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ql,type:n,key:o,ref:s,props:i,_owner:vm.current}}function I4(n,e){return{$$typeof:Ql,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Sm(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ql}function M4(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var ox=/\/+/g;function xm(n,e){return typeof n=="object"&&n!==null&&n.key!=null?M4(""+n.key):e.toString(36)}function Ru(n,e,t,r,i){var o=typeof n;(o==="undefined"||o==="boolean")&&(n=null);var s=!1;if(n===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(n.$$typeof){case Ql:case y4:s=!0}}if(s)return s=n,i=i(s),n=r===""?"."+xm(s,0):r,tx(i)?(t="",n!=null&&(t=n.replace(ox,"$&/")+"/"),Ru(i,e,t,"",function(c){return c})):i!=null&&(Sm(i)&&(i=I4(i,t+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(ox,"$&/")+"/")+n)),e.push(i)),1;if(s=0,r=r===""?".":r+":",tx(n))for(var a=0;a<n.length;a++){o=n[a];var l=r+xm(o,a);s+=Ru(o,e,t,l,i)}else if(l=E4(n),typeof l=="function")for(n=l.call(n),a=0;!(o=n.next()).done;)o=o.value,l=r+xm(o,a++),s+=Ru(o,e,t,l,i);else if(o==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function Ou(n,e,t){if(n==null)return n;var r=[],i=0;return Ru(n,r,"","",function(o){return e.call(t,o,i++)}),r}function A4(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Sn={current:null},Du={transition:null},T4={ReactCurrentDispatcher:Sn,ReactCurrentBatchConfig:Du,ReactCurrentOwner:vm};Pe.Children={map:Ou,forEach:function(n,e,t){Ou(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Ou(n,function(){e++}),e},toArray:function(n){return Ou(n,function(e){return e})||[]},only:function(n){if(!Sm(n))throw Error("React.Children.only expected to receive a single React element child.");return n}},Pe.Component=pa,Pe.Fragment=w4,Pe.Profiler=v4,Pe.PureComponent=wm,Pe.StrictMode=b4,Pe.Suspense=k4,Pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=T4,Pe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=ZS({},n.props),i=n.key,o=n.ref,s=n._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=vm.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)nx.call(e,l)&&!rx.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Ql,type:n.type,key:i,ref:o,props:r,_owner:s}},Pe.createContext=function(n){return n={$$typeof:x4,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:S4,_context:n},n.Consumer=n},Pe.createElement=ix,Pe.createFactory=function(n){var e=ix.bind(null,n);return e.type=n,e},Pe.createRef=function(){return{current:null}},Pe.forwardRef=function(n){return{$$typeof:_4,render:n}},Pe.isValidElement=Sm,Pe.lazy=function(n){return{$$typeof:P4,_payload:{_status:-1,_result:n},_init:A4}},Pe.memo=function(n,e){return{$$typeof:C4,type:n,compare:e===void 0?null:e}},Pe.startTransition=function(n){var e=Du.transition;Du.transition={};try{n()}finally{Du.transition=e}},Pe.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},Pe.useCallback=function(n,e){return Sn.current.useCallback(n,e)},Pe.useContext=function(n){return Sn.current.useContext(n)},Pe.useDebugValue=function(){},Pe.useDeferredValue=function(n){return Sn.current.useDeferredValue(n)},Pe.useEffect=function(n,e){return Sn.current.useEffect(n,e)},Pe.useId=function(){return Sn.current.useId()},Pe.useImperativeHandle=function(n,e,t){return Sn.current.useImperativeHandle(n,e,t)},Pe.useInsertionEffect=function(n,e){return Sn.current.useInsertionEffect(n,e)},Pe.useLayoutEffect=function(n,e){return Sn.current.useLayoutEffect(n,e)},Pe.useMemo=function(n,e){return Sn.current.useMemo(n,e)},Pe.useReducer=function(n,e,t){return Sn.current.useReducer(n,e,t)},Pe.useRef=function(n){return Sn.current.useRef(n)},Pe.useState=function(n){return Sn.current.useState(n)},Pe.useSyncExternalStore=function(n,e,t){return Sn.current.useSyncExternalStore(n,e,t)},Pe.useTransition=function(){return Sn.current.useTransition()},Pe.version="18.2.0",XS.exports=Pe;var v=XS.exports;const re=qn(v),j4=bs({__proto__:null,default:re},[v]);var R4=v,O4=Symbol.for("react.element"),D4=Symbol.for("react.fragment"),L4=Object.prototype.hasOwnProperty,z4=R4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,N4={key:!0,ref:!0,__self:!0,__source:!0};function sx(n,e,t){var r,i={},o=null,s=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)L4.call(e,r)&&!N4.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:O4,type:n,key:o,ref:s,props:i,_owner:z4.current}}ju.Fragment=D4,ju.jsx=sx,ju.jsxs=sx,YS.exports=ju;var g=YS.exports,_m={},ax={exports:{}},Jn={},lx={exports:{}},cx={};(function(n){function e(W,N){var Y=W.length;W.push(N);e:for(;0<Y;){var ee=Y-1>>>1,pe=W[ee];if(0<i(pe,N))W[ee]=N,W[Y]=pe,Y=ee;else break e}}function t(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var N=W[0],Y=W.pop();if(Y!==N){W[0]=Y;e:for(var ee=0,pe=W.length,ve=pe>>>1;ee<ve;){var be=2*(ee+1)-1,fe=W[be],Ce=be+1,Rt=W[Ce];if(0>i(fe,Y))Ce<pe&&0>i(Rt,fe)?(W[ee]=Rt,W[Ce]=Y,ee=Ce):(W[ee]=fe,W[be]=Y,ee=be);else if(Ce<pe&&0>i(Rt,Y))W[ee]=Rt,W[Ce]=Y,ee=Ce;else break e}}return N}function i(W,N){var Y=W.sortIndex-N.sortIndex;return Y!==0?Y:W.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();n.unstable_now=function(){return s.now()-a}}var l=[],c=[],d=1,u=null,h=3,p=!1,m=!1,f=!1,w=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(W){for(var N=t(c);N!==null;){if(N.callback===null)r(c);else if(N.startTime<=W)r(c),N.sortIndex=N.expirationTime,e(l,N);else break;N=t(c)}}function x(W){if(f=!1,_(W),!m)if(t(l)!==null)m=!0,B(P);else{var N=t(c);N!==null&&te(x,N.startTime-W)}}function P(W,N){m=!1,f&&(f=!1,S(I),I=-1),p=!0;var Y=h;try{for(_(N),u=t(l);u!==null&&(!(u.expirationTime>N)||W&&!D());){var ee=u.callback;if(typeof ee=="function"){u.callback=null,h=u.priorityLevel;var pe=ee(u.expirationTime<=N);N=n.unstable_now(),typeof pe=="function"?u.callback=pe:u===t(l)&&r(l),_(N)}else r(l);u=t(l)}if(u!==null)var ve=!0;else{var be=t(c);be!==null&&te(x,be.startTime-N),ve=!1}return ve}finally{u=null,h=Y,p=!1}}var C=!1,E=null,I=-1,A=5,T=-1;function D(){return!(n.unstable_now()-T<A)}function F(){if(E!==null){var W=n.unstable_now();T=W;var N=!0;try{N=E(!0,W)}finally{N?H():(C=!1,E=null)}}else C=!1}var H;if(typeof b=="function")H=function(){b(F)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,K=O.port2;O.port1.onmessage=F,H=function(){K.postMessage(null)}}else H=function(){w(F,0)};function B(W){E=W,C||(C=!0,H())}function te(W,N){I=w(function(){W(n.unstable_now())},N)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(W){W.callback=null},n.unstable_continueExecution=function(){m||p||(m=!0,B(P))},n.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<W?Math.floor(1e3/W):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(W){switch(h){case 1:case 2:case 3:var N=3;break;default:N=h}var Y=h;h=N;try{return W()}finally{h=Y}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(W,N){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Y=h;h=W;try{return N()}finally{h=Y}},n.unstable_scheduleCallback=function(W,N,Y){var ee=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?ee+Y:ee):Y=ee,W){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=Y+pe,W={id:d++,callback:N,priorityLevel:W,startTime:Y,expirationTime:pe,sortIndex:-1},Y>ee?(W.sortIndex=Y,e(c,W),t(l)===null&&W===t(c)&&(f?(S(I),I=-1):f=!0,te(x,Y-ee))):(W.sortIndex=pe,e(l,W),m||p||(m=!0,B(P))),W},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(W){var N=h;return function(){var Y=h;h=N;try{return W.apply(this,arguments)}finally{h=Y}}}})(cx),lx.exports=cx;var F4=lx.exports,dx=v,Zn=F4;function Z(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ux=new Set,ec={};function vs(n,e){fa(n,e),fa(n+"Capture",e)}function fa(n,e){for(ec[n]=e,n=0;n<e.length;n++)ux.add(e[n])}var zi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),km=Object.prototype.hasOwnProperty,$4=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,hx={},px={};function B4(n){return km.call(px,n)?!0:km.call(hx,n)?!1:$4.test(n)?px[n]=!0:(hx[n]=!0,!1)}function U4(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function V4(n,e,t,r){if(e===null||typeof e>"u"||U4(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function xn(n,e,t,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var Wt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Wt[n]=new xn(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Wt[e]=new xn(e,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){Wt[n]=new xn(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Wt[n]=new xn(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Wt[n]=new xn(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){Wt[n]=new xn(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){Wt[n]=new xn(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){Wt[n]=new xn(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){Wt[n]=new xn(n,5,!1,n.toLowerCase(),null,!1,!1)});var Cm=/[\-:]([a-z])/g;function Pm(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Cm,Pm);Wt[e]=new xn(e,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Cm,Pm);Wt[e]=new xn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Cm,Pm);Wt[e]=new xn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){Wt[n]=new xn(n,1,!1,n.toLowerCase(),null,!1,!1)}),Wt.xlinkHref=new xn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){Wt[n]=new xn(n,1,!1,n.toLowerCase(),null,!0,!0)});function Em(n,e,t,r){var i=Wt.hasOwnProperty(e)?Wt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(V4(e,t,i,r)&&(t=null),r||i===null?B4(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Ni=dx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Lu=Symbol.for("react.element"),ga=Symbol.for("react.portal"),ma=Symbol.for("react.fragment"),Im=Symbol.for("react.strict_mode"),Mm=Symbol.for("react.profiler"),fx=Symbol.for("react.provider"),gx=Symbol.for("react.context"),Am=Symbol.for("react.forward_ref"),Tm=Symbol.for("react.suspense"),jm=Symbol.for("react.suspense_list"),Rm=Symbol.for("react.memo"),xo=Symbol.for("react.lazy"),mx=Symbol.for("react.offscreen"),yx=Symbol.iterator;function tc(n){return n===null||typeof n!="object"?null:(n=yx&&n[yx]||n["@@iterator"],typeof n=="function"?n:null)}var ft=Object.assign,Om;function nc(n){if(Om===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Om=e&&e[1]||""}return`
`+Om+n}var Dm=!1;function Lm(n,e){if(!n||Dm)return"";Dm=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var l=`
`+i[s].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=s&&0<=a);break}}}finally{Dm=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?nc(n):""}function H4(n){switch(n.tag){case 5:return nc(n.type);case 16:return nc("Lazy");case 13:return nc("Suspense");case 19:return nc("SuspenseList");case 0:case 2:case 15:return n=Lm(n.type,!1),n;case 11:return n=Lm(n.type.render,!1),n;case 1:return n=Lm(n.type,!0),n;default:return""}}function zm(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case ma:return"Fragment";case ga:return"Portal";case Mm:return"Profiler";case Im:return"StrictMode";case Tm:return"Suspense";case jm:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case gx:return(n.displayName||"Context")+".Consumer";case fx:return(n._context.displayName||"Context")+".Provider";case Am:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Rm:return e=n.displayName||null,e!==null?e:zm(n.type)||"Memo";case xo:e=n._payload,n=n._init;try{return zm(n(e))}catch{}}return null}function W4(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zm(e);case 8:return e===Im?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function _o(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function wx(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function K4(n){var e=wx(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,o=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function zu(n){n._valueTracker||(n._valueTracker=K4(n))}function bx(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=wx(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Nu(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Nm(n,e){var t=e.checked;return ft({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function vx(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=_o(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Sx(n,e){e=e.checked,e!=null&&Em(n,"checked",e,!1)}function Fm(n,e){Sx(n,e);var t=_o(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?$m(n,e.type,t):e.hasOwnProperty("defaultValue")&&$m(n,e.type,_o(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function xx(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function $m(n,e,t){(e!=="number"||Nu(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var rc=Array.isArray;function ya(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+_o(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Bm(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Z(91));return ft({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function _x(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Z(92));if(rc(t)){if(1<t.length)throw Error(Z(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:_o(t)}}function kx(n,e){var t=_o(e.value),r=_o(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function Cx(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Px(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Um(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Px(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Fu,Ex=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Fu=Fu||document.createElement("div"),Fu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Fu.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function ic(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var oc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},G4=["Webkit","ms","Moz","O"];Object.keys(oc).forEach(function(n){G4.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),oc[e]=oc[n]})});function Ix(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||oc.hasOwnProperty(n)&&oc[n]?(""+e).trim():e+"px"}function Mx(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=Ix(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var Y4=ft({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vm(n,e){if(e){if(Y4[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Z(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Z(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Z(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Z(62))}}function Hm(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wm=null;function Km(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Gm=null,wa=null,ba=null;function Ax(n){if(n=Ec(n)){if(typeof Gm!="function")throw Error(Z(280));var e=n.stateNode;e&&(e=lh(e),Gm(n.stateNode,n.type,e))}}function Tx(n){wa?ba?ba.push(n):ba=[n]:wa=n}function jx(){if(wa){var n=wa,e=ba;if(ba=wa=null,Ax(n),e)for(n=0;n<e.length;n++)Ax(e[n])}}function Rx(n,e){return n(e)}function Ox(){}var Ym=!1;function Dx(n,e,t){if(Ym)return n(e,t);Ym=!0;try{return Rx(n,e,t)}finally{Ym=!1,(wa!==null||ba!==null)&&(Ox(),jx())}}function sc(n,e){var t=n.stateNode;if(t===null)return null;var r=lh(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Z(231,e,typeof t));return t}var Xm=!1;if(zi)try{var ac={};Object.defineProperty(ac,"passive",{get:function(){Xm=!0}}),window.addEventListener("test",ac,ac),window.removeEventListener("test",ac,ac)}catch{Xm=!1}function X4(n,e,t,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(d){this.onError(d)}}var lc=!1,$u=null,Bu=!1,qm=null,q4={onError:function(n){lc=!0,$u=n}};function J4(n,e,t,r,i,o,s,a,l){lc=!1,$u=null,X4.apply(q4,arguments)}function Z4(n,e,t,r,i,o,s,a,l){if(J4.apply(this,arguments),lc){if(lc){var c=$u;lc=!1,$u=null}else throw Error(Z(198));Bu||(Bu=!0,qm=c)}}function Ss(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Lx(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function zx(n){if(Ss(n)!==n)throw Error(Z(188))}function Q4(n){var e=n.alternate;if(!e){if(e=Ss(n),e===null)throw Error(Z(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return zx(i),n;if(o===r)return zx(i),e;o=o.sibling}throw Error(Z(188))}if(t.return!==r.return)t=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===t){s=!0,t=i,r=o;break}if(a===r){s=!0,r=i,t=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===t){s=!0,t=o,r=i;break}if(a===r){s=!0,r=o,t=i;break}a=a.sibling}if(!s)throw Error(Z(189))}}if(t.alternate!==r)throw Error(Z(190))}if(t.tag!==3)throw Error(Z(188));return t.stateNode.current===t?n:e}function Nx(n){return n=Q4(n),n!==null?Fx(n):null}function Fx(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Fx(n);if(e!==null)return e;n=n.sibling}return null}var $x=Zn.unstable_scheduleCallback,Bx=Zn.unstable_cancelCallback,e5=Zn.unstable_shouldYield,t5=Zn.unstable_requestPaint,Mt=Zn.unstable_now,n5=Zn.unstable_getCurrentPriorityLevel,Jm=Zn.unstable_ImmediatePriority,Ux=Zn.unstable_UserBlockingPriority,Uu=Zn.unstable_NormalPriority,r5=Zn.unstable_LowPriority,Vx=Zn.unstable_IdlePriority,Vu=null,li=null;function i5(n){if(li&&typeof li.onCommitFiberRoot=="function")try{li.onCommitFiberRoot(Vu,n,void 0,(n.current.flags&128)===128)}catch{}}var Dr=Math.clz32?Math.clz32:a5,o5=Math.log,s5=Math.LN2;function a5(n){return n>>>=0,n===0?32:31-(o5(n)/s5|0)|0}var Hu=64,Wu=4194304;function cc(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Ku(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,o=n.pingedLanes,s=t&268435455;if(s!==0){var a=s&~i;a!==0?r=cc(a):(o&=s,o!==0&&(r=cc(o)))}else s=t&~i,s!==0?r=cc(s):o!==0&&(r=cc(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Dr(e),i=1<<t,r|=n[t],e&=~i;return r}function l5(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function c5(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,o=n.pendingLanes;0<o;){var s=31-Dr(o),a=1<<s,l=i[s];l===-1?(!(a&t)||a&r)&&(i[s]=l5(a,e)):l<=e&&(n.expiredLanes|=a),o&=~a}}function Zm(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Hx(){var n=Hu;return Hu<<=1,!(Hu&4194240)&&(Hu=64),n}function Qm(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function dc(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Dr(e),n[e]=t}function d5(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Dr(t),o=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~o}}function ey(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Dr(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var He=0;function Wx(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Kx,ty,Gx,Yx,Xx,ny=!1,Gu=[],ko=null,Co=null,Po=null,uc=new Map,hc=new Map,Eo=[],u5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qx(n,e){switch(n){case"focusin":case"focusout":ko=null;break;case"dragenter":case"dragleave":Co=null;break;case"mouseover":case"mouseout":Po=null;break;case"pointerover":case"pointerout":uc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":hc.delete(e.pointerId)}}function pc(n,e,t,r,i,o){return n===null||n.nativeEvent!==o?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=Ec(e),e!==null&&ty(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function h5(n,e,t,r,i){switch(e){case"focusin":return ko=pc(ko,n,e,t,r,i),!0;case"dragenter":return Co=pc(Co,n,e,t,r,i),!0;case"mouseover":return Po=pc(Po,n,e,t,r,i),!0;case"pointerover":var o=i.pointerId;return uc.set(o,pc(uc.get(o)||null,n,e,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,hc.set(o,pc(hc.get(o)||null,n,e,t,r,i)),!0}return!1}function Jx(n){var e=xs(n.target);if(e!==null){var t=Ss(e);if(t!==null){if(e=t.tag,e===13){if(e=Lx(t),e!==null){n.blockedOn=e,Xx(n.priority,function(){Gx(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Yu(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=iy(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Wm=r,t.target.dispatchEvent(r),Wm=null}else return e=Ec(t),e!==null&&ty(e),n.blockedOn=t,!1;e.shift()}return!0}function Zx(n,e,t){Yu(n)&&t.delete(e)}function p5(){ny=!1,ko!==null&&Yu(ko)&&(ko=null),Co!==null&&Yu(Co)&&(Co=null),Po!==null&&Yu(Po)&&(Po=null),uc.forEach(Zx),hc.forEach(Zx)}function fc(n,e){n.blockedOn===e&&(n.blockedOn=null,ny||(ny=!0,Zn.unstable_scheduleCallback(Zn.unstable_NormalPriority,p5)))}function gc(n){function e(i){return fc(i,n)}if(0<Gu.length){fc(Gu[0],n);for(var t=1;t<Gu.length;t++){var r=Gu[t];r.blockedOn===n&&(r.blockedOn=null)}}for(ko!==null&&fc(ko,n),Co!==null&&fc(Co,n),Po!==null&&fc(Po,n),uc.forEach(e),hc.forEach(e),t=0;t<Eo.length;t++)r=Eo[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Eo.length&&(t=Eo[0],t.blockedOn===null);)Jx(t),t.blockedOn===null&&Eo.shift()}var va=Ni.ReactCurrentBatchConfig,Xu=!0;function f5(n,e,t,r){var i=He,o=va.transition;va.transition=null;try{He=1,ry(n,e,t,r)}finally{He=i,va.transition=o}}function g5(n,e,t,r){var i=He,o=va.transition;va.transition=null;try{He=4,ry(n,e,t,r)}finally{He=i,va.transition=o}}function ry(n,e,t,r){if(Xu){var i=iy(n,e,t,r);if(i===null)Sy(n,e,r,qu,t),qx(n,r);else if(h5(i,n,e,t,r))r.stopPropagation();else if(qx(n,r),e&4&&-1<u5.indexOf(n)){for(;i!==null;){var o=Ec(i);if(o!==null&&Kx(o),o=iy(n,e,t,r),o===null&&Sy(n,e,r,qu,t),o===i)break;i=o}i!==null&&r.stopPropagation()}else Sy(n,e,r,null,t)}}var qu=null;function iy(n,e,t,r){if(qu=null,n=Km(r),n=xs(n),n!==null)if(e=Ss(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Lx(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return qu=n,null}function Qx(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(n5()){case Jm:return 1;case Ux:return 4;case Uu:case r5:return 16;case Vx:return 536870912;default:return 16}default:return 16}}var Io=null,oy=null,Ju=null;function e_(){if(Ju)return Ju;var n,e=oy,t=e.length,r,i="value"in Io?Io.value:Io.textContent,o=i.length;for(n=0;n<t&&e[n]===i[n];n++);var s=t-n;for(r=1;r<=s&&e[t-r]===i[o-r];r++);return Ju=i.slice(n,1<r?1-r:void 0)}function Zu(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Qu(){return!0}function t_(){return!1}function Qn(n){function e(t,r,i,o,s){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Qu:t_,this.isPropagationStopped=t_,this}return ft(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Qu)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Qu)},persist:function(){},isPersistent:Qu}),e}var Sa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sy=Qn(Sa),mc=ft({},Sa,{view:0,detail:0}),m5=Qn(mc),ay,ly,yc,eh=ft({},mc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dy,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==yc&&(yc&&n.type==="mousemove"?(ay=n.screenX-yc.screenX,ly=n.screenY-yc.screenY):ly=ay=0,yc=n),ay)},movementY:function(n){return"movementY"in n?n.movementY:ly}}),n_=Qn(eh),y5=ft({},eh,{dataTransfer:0}),w5=Qn(y5),b5=ft({},mc,{relatedTarget:0}),cy=Qn(b5),v5=ft({},Sa,{animationName:0,elapsedTime:0,pseudoElement:0}),S5=Qn(v5),x5=ft({},Sa,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),_5=Qn(x5),k5=ft({},Sa,{data:0}),r_=Qn(k5),C5={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},P5={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},E5={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function I5(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=E5[n])?!!e[n]:!1}function dy(){return I5}var M5=ft({},mc,{key:function(n){if(n.key){var e=C5[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Zu(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?P5[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dy,charCode:function(n){return n.type==="keypress"?Zu(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Zu(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),A5=Qn(M5),T5=ft({},eh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),i_=Qn(T5),j5=ft({},mc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dy}),R5=Qn(j5),O5=ft({},Sa,{propertyName:0,elapsedTime:0,pseudoElement:0}),D5=Qn(O5),L5=ft({},eh,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),z5=Qn(L5),N5=[9,13,27,32],uy=zi&&"CompositionEvent"in window,wc=null;zi&&"documentMode"in document&&(wc=document.documentMode);var F5=zi&&"TextEvent"in window&&!wc,o_=zi&&(!uy||wc&&8<wc&&11>=wc),s_=String.fromCharCode(32),a_=!1;function l_(n,e){switch(n){case"keyup":return N5.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function c_(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var xa=!1;function $5(n,e){switch(n){case"compositionend":return c_(e);case"keypress":return e.which!==32?null:(a_=!0,s_);case"textInput":return n=e.data,n===s_&&a_?null:n;default:return null}}function B5(n,e){if(xa)return n==="compositionend"||!uy&&l_(n,e)?(n=e_(),Ju=oy=Io=null,xa=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return o_&&e.locale!=="ko"?null:e.data;default:return null}}var U5={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function d_(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!U5[n.type]:e==="textarea"}function u_(n,e,t,r){Tx(r),e=oh(e,"onChange"),0<e.length&&(t=new sy("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var bc=null,vc=null;function V5(n){M_(n,0)}function th(n){var e=Ea(n);if(bx(e))return n}function H5(n,e){if(n==="change")return e}var h_=!1;if(zi){var hy;if(zi){var py="oninput"in document;if(!py){var p_=document.createElement("div");p_.setAttribute("oninput","return;"),py=typeof p_.oninput=="function"}hy=py}else hy=!1;h_=hy&&(!document.documentMode||9<document.documentMode)}function f_(){bc&&(bc.detachEvent("onpropertychange",g_),vc=bc=null)}function g_(n){if(n.propertyName==="value"&&th(vc)){var e=[];u_(e,vc,n,Km(n)),Dx(V5,e)}}function W5(n,e,t){n==="focusin"?(f_(),bc=e,vc=t,bc.attachEvent("onpropertychange",g_)):n==="focusout"&&f_()}function K5(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return th(vc)}function G5(n,e){if(n==="click")return th(e)}function Y5(n,e){if(n==="input"||n==="change")return th(e)}function X5(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Lr=typeof Object.is=="function"?Object.is:X5;function Sc(n,e){if(Lr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!km.call(e,i)||!Lr(n[i],e[i]))return!1}return!0}function m_(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function y_(n,e){var t=m_(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=m_(t)}}function w_(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?w_(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function b_(){for(var n=window,e=Nu();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Nu(n.document)}return e}function fy(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function q5(n){var e=b_(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&w_(t.ownerDocument.documentElement,t)){if(r!==null&&fy(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=y_(t,o);var s=y_(t,r);i&&s&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var J5=zi&&"documentMode"in document&&11>=document.documentMode,_a=null,gy=null,xc=null,my=!1;function v_(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;my||_a==null||_a!==Nu(r)||(r=_a,"selectionStart"in r&&fy(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),xc&&Sc(xc,r)||(xc=r,r=oh(gy,"onSelect"),0<r.length&&(e=new sy("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=_a)))}function nh(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ka={animationend:nh("Animation","AnimationEnd"),animationiteration:nh("Animation","AnimationIteration"),animationstart:nh("Animation","AnimationStart"),transitionend:nh("Transition","TransitionEnd")},yy={},S_={};zi&&(S_=document.createElement("div").style,"AnimationEvent"in window||(delete ka.animationend.animation,delete ka.animationiteration.animation,delete ka.animationstart.animation),"TransitionEvent"in window||delete ka.transitionend.transition);function rh(n){if(yy[n])return yy[n];if(!ka[n])return n;var e=ka[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in S_)return yy[n]=e[t];return n}var x_=rh("animationend"),__=rh("animationiteration"),k_=rh("animationstart"),C_=rh("transitionend"),P_=new Map,E_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Mo(n,e){P_.set(n,e),vs(e,[n])}for(var wy=0;wy<E_.length;wy++){var by=E_[wy],Z5=by.toLowerCase(),Q5=by[0].toUpperCase()+by.slice(1);Mo(Z5,"on"+Q5)}Mo(x_,"onAnimationEnd"),Mo(__,"onAnimationIteration"),Mo(k_,"onAnimationStart"),Mo("dblclick","onDoubleClick"),Mo("focusin","onFocus"),Mo("focusout","onBlur"),Mo(C_,"onTransitionEnd"),fa("onMouseEnter",["mouseout","mouseover"]),fa("onMouseLeave",["mouseout","mouseover"]),fa("onPointerEnter",["pointerout","pointerover"]),fa("onPointerLeave",["pointerout","pointerover"]),vs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vs("onBeforeInput",["compositionend","keypress","textInput","paste"]),vs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _c="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eO=new Set("cancel close invalid load scroll toggle".split(" ").concat(_c));function I_(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,Z4(r,e,void 0,n),n.currentTarget=null}function M_(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;I_(i,a,c),o=l}else for(s=0;s<r.length;s++){if(a=r[s],l=a.instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;I_(i,a,c),o=l}}}if(Bu)throw n=qm,Bu=!1,qm=null,n}function st(n,e){var t=e[Ey];t===void 0&&(t=e[Ey]=new Set);var r=n+"__bubble";t.has(r)||(A_(e,n,2,!1),t.add(r))}function vy(n,e,t){var r=0;e&&(r|=4),A_(t,n,r,e)}var ih="_reactListening"+Math.random().toString(36).slice(2);function kc(n){if(!n[ih]){n[ih]=!0,ux.forEach(function(t){t!=="selectionchange"&&(eO.has(t)||vy(t,!1,n),vy(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[ih]||(e[ih]=!0,vy("selectionchange",!1,e))}}function A_(n,e,t,r){switch(Qx(e)){case 1:var i=f5;break;case 4:i=g5;break;default:i=ry}t=i.bind(null,e,t,n),i=void 0,!Xm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Sy(n,e,t,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;s=s.return}for(;a!==null;){if(s=xs(a),s===null)return;if(l=s.tag,l===5||l===6){r=o=s;continue e}a=a.parentNode}}r=r.return}Dx(function(){var c=o,d=Km(t),u=[];e:{var h=P_.get(n);if(h!==void 0){var p=sy,m=n;switch(n){case"keypress":if(Zu(t)===0)break e;case"keydown":case"keyup":p=A5;break;case"focusin":m="focus",p=cy;break;case"focusout":m="blur",p=cy;break;case"beforeblur":case"afterblur":p=cy;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=n_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=w5;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=R5;break;case x_:case __:case k_:p=S5;break;case C_:p=D5;break;case"scroll":p=m5;break;case"wheel":p=z5;break;case"copy":case"cut":case"paste":p=_5;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=i_}var f=(e&4)!==0,w=!f&&n==="scroll",S=f?h!==null?h+"Capture":null:h;f=[];for(var b=c,_;b!==null;){_=b;var x=_.stateNode;if(_.tag===5&&x!==null&&(_=x,S!==null&&(x=sc(b,S),x!=null&&f.push(Cc(b,x,_)))),w)break;b=b.return}0<f.length&&(h=new p(h,m,null,t,d),u.push({event:h,listeners:f}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",h&&t!==Wm&&(m=t.relatedTarget||t.fromElement)&&(xs(m)||m[Fi]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(m=t.relatedTarget||t.toElement,p=c,m=m?xs(m):null,m!==null&&(w=Ss(m),m!==w||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=c),p!==m)){if(f=n_,x="onMouseLeave",S="onMouseEnter",b="mouse",(n==="pointerout"||n==="pointerover")&&(f=i_,x="onPointerLeave",S="onPointerEnter",b="pointer"),w=p==null?h:Ea(p),_=m==null?h:Ea(m),h=new f(x,b+"leave",p,t,d),h.target=w,h.relatedTarget=_,x=null,xs(d)===c&&(f=new f(S,b+"enter",m,t,d),f.target=_,f.relatedTarget=w,x=f),w=x,p&&m)t:{for(f=p,S=m,b=0,_=f;_;_=Ca(_))b++;for(_=0,x=S;x;x=Ca(x))_++;for(;0<b-_;)f=Ca(f),b--;for(;0<_-b;)S=Ca(S),_--;for(;b--;){if(f===S||S!==null&&f===S.alternate)break t;f=Ca(f),S=Ca(S)}f=null}else f=null;p!==null&&T_(u,h,p,f,!1),m!==null&&w!==null&&T_(u,w,m,f,!0)}}e:{if(h=c?Ea(c):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var P=H5;else if(d_(h))if(h_)P=Y5;else{P=K5;var C=W5}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(P=G5);if(P&&(P=P(n,c))){u_(u,P,t,d);break e}C&&C(n,h,c),n==="focusout"&&(C=h._wrapperState)&&C.controlled&&h.type==="number"&&$m(h,"number",h.value)}switch(C=c?Ea(c):window,n){case"focusin":(d_(C)||C.contentEditable==="true")&&(_a=C,gy=c,xc=null);break;case"focusout":xc=gy=_a=null;break;case"mousedown":my=!0;break;case"contextmenu":case"mouseup":case"dragend":my=!1,v_(u,t,d);break;case"selectionchange":if(J5)break;case"keydown":case"keyup":v_(u,t,d)}var E;if(uy)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else xa?l_(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(o_&&t.locale!=="ko"&&(xa||I!=="onCompositionStart"?I==="onCompositionEnd"&&xa&&(E=e_()):(Io=d,oy="value"in Io?Io.value:Io.textContent,xa=!0)),C=oh(c,I),0<C.length&&(I=new r_(I,n,null,t,d),u.push({event:I,listeners:C}),E?I.data=E:(E=c_(t),E!==null&&(I.data=E)))),(E=F5?$5(n,t):B5(n,t))&&(c=oh(c,"onBeforeInput"),0<c.length&&(d=new r_("onBeforeInput","beforeinput",null,t,d),u.push({event:d,listeners:c}),d.data=E))}M_(u,e)})}function Cc(n,e,t){return{instance:n,listener:e,currentTarget:t}}function oh(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=sc(n,t),o!=null&&r.unshift(Cc(n,o,i)),o=sc(n,e),o!=null&&r.push(Cc(n,o,i))),n=n.return}return r}function Ca(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function T_(n,e,t,r,i){for(var o=e._reactName,s=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=sc(t,o),l!=null&&s.unshift(Cc(t,l,a))):i||(l=sc(t,o),l!=null&&s.push(Cc(t,l,a)))),t=t.return}s.length!==0&&n.push({event:e,listeners:s})}var tO=/\r\n?/g,nO=/\u0000|\uFFFD/g;function j_(n){return(typeof n=="string"?n:""+n).replace(tO,`
`).replace(nO,"")}function sh(n,e,t){if(e=j_(e),j_(n)!==e&&t)throw Error(Z(425))}function ah(){}var xy=null,_y=null;function ky(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Cy=typeof setTimeout=="function"?setTimeout:void 0,rO=typeof clearTimeout=="function"?clearTimeout:void 0,R_=typeof Promise=="function"?Promise:void 0,iO=typeof queueMicrotask=="function"?queueMicrotask:typeof R_<"u"?function(n){return R_.resolve(null).then(n).catch(oO)}:Cy;function oO(n){setTimeout(function(){throw n})}function Py(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),gc(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);gc(e)}function Ao(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function O_(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Pa=Math.random().toString(36).slice(2),ci="__reactFiber$"+Pa,Pc="__reactProps$"+Pa,Fi="__reactContainer$"+Pa,Ey="__reactEvents$"+Pa,sO="__reactListeners$"+Pa,aO="__reactHandles$"+Pa;function xs(n){var e=n[ci];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Fi]||t[ci]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=O_(n);n!==null;){if(t=n[ci])return t;n=O_(n)}return e}n=t,t=n.parentNode}return null}function Ec(n){return n=n[ci]||n[Fi],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ea(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Z(33))}function lh(n){return n[Pc]||null}var Iy=[],Ia=-1;function To(n){return{current:n}}function at(n){0>Ia||(n.current=Iy[Ia],Iy[Ia]=null,Ia--)}function et(n,e){Ia++,Iy[Ia]=n.current,n.current=e}var jo={},nn=To(jo),On=To(!1),_s=jo;function Ma(n,e){var t=n.type.contextTypes;if(!t)return jo;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in t)i[o]=e[o];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function Dn(n){return n=n.childContextTypes,n!=null}function ch(){at(On),at(nn)}function D_(n,e,t){if(nn.current!==jo)throw Error(Z(168));et(nn,e),et(On,t)}function L_(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Z(108,W4(n)||"Unknown",i));return ft({},t,r)}function dh(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||jo,_s=nn.current,et(nn,n),et(On,On.current),!0}function z_(n,e,t){var r=n.stateNode;if(!r)throw Error(Z(169));t?(n=L_(n,e,_s),r.__reactInternalMemoizedMergedChildContext=n,at(On),at(nn),et(nn,n)):at(On),et(On,t)}var $i=null,uh=!1,My=!1;function N_(n){$i===null?$i=[n]:$i.push(n)}function lO(n){uh=!0,N_(n)}function Ro(){if(!My&&$i!==null){My=!0;var n=0,e=He;try{var t=$i;for(He=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}$i=null,uh=!1}catch(i){throw $i!==null&&($i=$i.slice(n+1)),$x(Jm,Ro),i}finally{He=e,My=!1}}return null}var Aa=[],Ta=0,hh=null,ph=0,wr=[],br=0,ks=null,Bi=1,Ui="";function Cs(n,e){Aa[Ta++]=ph,Aa[Ta++]=hh,hh=n,ph=e}function F_(n,e,t){wr[br++]=Bi,wr[br++]=Ui,wr[br++]=ks,ks=n;var r=Bi;n=Ui;var i=32-Dr(r)-1;r&=~(1<<i),t+=1;var o=32-Dr(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Bi=1<<32-Dr(e)+i|t<<i|r,Ui=o+n}else Bi=1<<o|t<<i|r,Ui=n}function Ay(n){n.return!==null&&(Cs(n,1),F_(n,1,0))}function Ty(n){for(;n===hh;)hh=Aa[--Ta],Aa[Ta]=null,ph=Aa[--Ta],Aa[Ta]=null;for(;n===ks;)ks=wr[--br],wr[br]=null,Ui=wr[--br],wr[br]=null,Bi=wr[--br],wr[br]=null}var er=null,tr=null,ut=!1,zr=null;function $_(n,e){var t=_r(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function B_(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,er=n,tr=Ao(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,er=n,tr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=ks!==null?{id:Bi,overflow:Ui}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=_r(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,er=n,tr=null,!0):!1;default:return!1}}function jy(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Ry(n){if(ut){var e=tr;if(e){var t=e;if(!B_(n,e)){if(jy(n))throw Error(Z(418));e=Ao(t.nextSibling);var r=er;e&&B_(n,e)?$_(r,t):(n.flags=n.flags&-4097|2,ut=!1,er=n)}}else{if(jy(n))throw Error(Z(418));n.flags=n.flags&-4097|2,ut=!1,er=n}}}function U_(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;er=n}function fh(n){if(n!==er)return!1;if(!ut)return U_(n),ut=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!ky(n.type,n.memoizedProps)),e&&(e=tr)){if(jy(n))throw V_(),Error(Z(418));for(;e;)$_(n,e),e=Ao(e.nextSibling)}if(U_(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Z(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){tr=Ao(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}tr=null}}else tr=er?Ao(n.stateNode.nextSibling):null;return!0}function V_(){for(var n=tr;n;)n=Ao(n.nextSibling)}function ja(){tr=er=null,ut=!1}function Oy(n){zr===null?zr=[n]:zr.push(n)}var cO=Ni.ReactCurrentBatchConfig;function Nr(n,e){if(n&&n.defaultProps){e=ft({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var gh=To(null),mh=null,Ra=null,Dy=null;function Ly(){Dy=Ra=mh=null}function zy(n){var e=gh.current;at(gh),n._currentValue=e}function Ny(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Oa(n,e){mh=n,Dy=Ra=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Ln=!0),n.firstContext=null)}function vr(n){var e=n._currentValue;if(Dy!==n)if(n={context:n,memoizedValue:e,next:null},Ra===null){if(mh===null)throw Error(Z(308));Ra=n,mh.dependencies={lanes:0,firstContext:n}}else Ra=Ra.next=n;return e}var Ps=null;function Fy(n){Ps===null?Ps=[n]:Ps.push(n)}function H_(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,Fy(e)):(t.next=i.next,i.next=t),e.interleaved=t,Vi(n,r)}function Vi(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Oo=!1;function $y(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function W_(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Hi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Do(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Te&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Vi(n,t)}return i=r.interleaved,i===null?(e.next=e,Fy(r)):(e.next=i.next,i.next=e),r.interleaved=e,Vi(n,t)}function yh(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,ey(n,t)}}function K_(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var s={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?i=o=s:o=o.next=s,t=t.next}while(t!==null);o===null?i=o=e:o=o.next=e}else i=o=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function wh(n,e,t,r){var i=n.updateQueue;Oo=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,s===null?o=c:s.next=c,s=l;var d=n.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==s&&(a===null?d.firstBaseUpdate=c:a.next=c,d.lastBaseUpdate=l))}if(o!==null){var u=i.baseState;s=0,d=c=l=null,a=o;do{var h=a.lane,p=a.eventTime;if((r&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=n,f=a;switch(h=e,p=t,f.tag){case 1:if(m=f.payload,typeof m=="function"){u=m.call(p,u,h);break e}u=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=f.payload,h=typeof m=="function"?m.call(p,u,h):m,h==null)break e;u=ft({},u,h);break e;case 2:Oo=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(c=d=p,l=u):d=d.next=p,s|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(1);if(d===null&&(l=u),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=d,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Ms|=s,n.lanes=s,n.memoizedState=u}}function G_(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Z(191,i));i.call(r)}}}var Y_=new dx.Component().refs;function By(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:ft({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var bh={isMounted:function(n){return(n=n._reactInternals)?Ss(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=kn(),i=Fo(n),o=Hi(r,i);o.payload=e,t!=null&&(o.callback=t),e=Do(n,o,i),e!==null&&(Br(e,n,i,r),yh(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=kn(),i=Fo(n),o=Hi(r,i);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=Do(n,o,i),e!==null&&(Br(e,n,i,r),yh(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=kn(),r=Fo(n),i=Hi(t,r);i.tag=2,e!=null&&(i.callback=e),e=Do(n,i,r),e!==null&&(Br(e,n,r,t),yh(e,n,r))}};function X_(n,e,t,r,i,o,s){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!Sc(t,r)||!Sc(i,o):!0}function q_(n,e,t){var r=!1,i=jo,o=e.contextType;return typeof o=="object"&&o!==null?o=vr(o):(i=Dn(e)?_s:nn.current,r=e.contextTypes,o=(r=r!=null)?Ma(n,i):jo),e=new e(t,o),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=bh,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=o),e}function J_(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&bh.enqueueReplaceState(e,e.state,null)}function Uy(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs=Y_,$y(n);var o=e.contextType;typeof o=="object"&&o!==null?i.context=vr(o):(o=Dn(e)?_s:nn.current,i.context=Ma(n,o)),i.state=n.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(By(n,e,o,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&bh.enqueueReplaceState(i,i.state,null),wh(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Ic(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Z(309));var r=t.stateNode}if(!r)throw Error(Z(147,n));var i=r,o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=i.refs;a===Y_&&(a=i.refs={}),s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof n!="string")throw Error(Z(284));if(!t._owner)throw Error(Z(290,n))}return n}function vh(n,e){throw n=Object.prototype.toString.call(e),Error(Z(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Z_(n){var e=n._init;return e(n._payload)}function Q_(n){function e(S,b){if(n){var _=S.deletions;_===null?(S.deletions=[b],S.flags|=16):_.push(b)}}function t(S,b){if(!n)return null;for(;b!==null;)e(S,b),b=b.sibling;return null}function r(S,b){for(S=new Map;b!==null;)b.key!==null?S.set(b.key,b):S.set(b.index,b),b=b.sibling;return S}function i(S,b){return S=Bo(S,b),S.index=0,S.sibling=null,S}function o(S,b,_){return S.index=_,n?(_=S.alternate,_!==null?(_=_.index,_<b?(S.flags|=2,b):_):(S.flags|=2,b)):(S.flags|=1048576,b)}function s(S){return n&&S.alternate===null&&(S.flags|=2),S}function a(S,b,_,x){return b===null||b.tag!==6?(b=k0(_,S.mode,x),b.return=S,b):(b=i(b,_),b.return=S,b)}function l(S,b,_,x){var P=_.type;return P===ma?d(S,b,_.props.children,x,_.key):b!==null&&(b.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===xo&&Z_(P)===b.type)?(x=i(b,_.props),x.ref=Ic(S,b,_),x.return=S,x):(x=Fh(_.type,_.key,_.props,null,S.mode,x),x.ref=Ic(S,b,_),x.return=S,x)}function c(S,b,_,x){return b===null||b.tag!==4||b.stateNode.containerInfo!==_.containerInfo||b.stateNode.implementation!==_.implementation?(b=C0(_,S.mode,x),b.return=S,b):(b=i(b,_.children||[]),b.return=S,b)}function d(S,b,_,x,P){return b===null||b.tag!==7?(b=Rs(_,S.mode,x,P),b.return=S,b):(b=i(b,_),b.return=S,b)}function u(S,b,_){if(typeof b=="string"&&b!==""||typeof b=="number")return b=k0(""+b,S.mode,_),b.return=S,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Lu:return _=Fh(b.type,b.key,b.props,null,S.mode,_),_.ref=Ic(S,null,b),_.return=S,_;case ga:return b=C0(b,S.mode,_),b.return=S,b;case xo:var x=b._init;return u(S,x(b._payload),_)}if(rc(b)||tc(b))return b=Rs(b,S.mode,_,null),b.return=S,b;vh(S,b)}return null}function h(S,b,_,x){var P=b!==null?b.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return P!==null?null:a(S,b,""+_,x);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Lu:return _.key===P?l(S,b,_,x):null;case ga:return _.key===P?c(S,b,_,x):null;case xo:return P=_._init,h(S,b,P(_._payload),x)}if(rc(_)||tc(_))return P!==null?null:d(S,b,_,x,null);vh(S,_)}return null}function p(S,b,_,x,P){if(typeof x=="string"&&x!==""||typeof x=="number")return S=S.get(_)||null,a(b,S,""+x,P);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Lu:return S=S.get(x.key===null?_:x.key)||null,l(b,S,x,P);case ga:return S=S.get(x.key===null?_:x.key)||null,c(b,S,x,P);case xo:var C=x._init;return p(S,b,_,C(x._payload),P)}if(rc(x)||tc(x))return S=S.get(_)||null,d(b,S,x,P,null);vh(b,x)}return null}function m(S,b,_,x){for(var P=null,C=null,E=b,I=b=0,A=null;E!==null&&I<_.length;I++){E.index>I?(A=E,E=null):A=E.sibling;var T=h(S,E,_[I],x);if(T===null){E===null&&(E=A);break}n&&E&&T.alternate===null&&e(S,E),b=o(T,b,I),C===null?P=T:C.sibling=T,C=T,E=A}if(I===_.length)return t(S,E),ut&&Cs(S,I),P;if(E===null){for(;I<_.length;I++)E=u(S,_[I],x),E!==null&&(b=o(E,b,I),C===null?P=E:C.sibling=E,C=E);return ut&&Cs(S,I),P}for(E=r(S,E);I<_.length;I++)A=p(E,S,I,_[I],x),A!==null&&(n&&A.alternate!==null&&E.delete(A.key===null?I:A.key),b=o(A,b,I),C===null?P=A:C.sibling=A,C=A);return n&&E.forEach(function(D){return e(S,D)}),ut&&Cs(S,I),P}function f(S,b,_,x){var P=tc(_);if(typeof P!="function")throw Error(Z(150));if(_=P.call(_),_==null)throw Error(Z(151));for(var C=P=null,E=b,I=b=0,A=null,T=_.next();E!==null&&!T.done;I++,T=_.next()){E.index>I?(A=E,E=null):A=E.sibling;var D=h(S,E,T.value,x);if(D===null){E===null&&(E=A);break}n&&E&&D.alternate===null&&e(S,E),b=o(D,b,I),C===null?P=D:C.sibling=D,C=D,E=A}if(T.done)return t(S,E),ut&&Cs(S,I),P;if(E===null){for(;!T.done;I++,T=_.next())T=u(S,T.value,x),T!==null&&(b=o(T,b,I),C===null?P=T:C.sibling=T,C=T);return ut&&Cs(S,I),P}for(E=r(S,E);!T.done;I++,T=_.next())T=p(E,S,I,T.value,x),T!==null&&(n&&T.alternate!==null&&E.delete(T.key===null?I:T.key),b=o(T,b,I),C===null?P=T:C.sibling=T,C=T);return n&&E.forEach(function(F){return e(S,F)}),ut&&Cs(S,I),P}function w(S,b,_,x){if(typeof _=="object"&&_!==null&&_.type===ma&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case Lu:e:{for(var P=_.key,C=b;C!==null;){if(C.key===P){if(P=_.type,P===ma){if(C.tag===7){t(S,C.sibling),b=i(C,_.props.children),b.return=S,S=b;break e}}else if(C.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===xo&&Z_(P)===C.type){t(S,C.sibling),b=i(C,_.props),b.ref=Ic(S,C,_),b.return=S,S=b;break e}t(S,C);break}else e(S,C);C=C.sibling}_.type===ma?(b=Rs(_.props.children,S.mode,x,_.key),b.return=S,S=b):(x=Fh(_.type,_.key,_.props,null,S.mode,x),x.ref=Ic(S,b,_),x.return=S,S=x)}return s(S);case ga:e:{for(C=_.key;b!==null;){if(b.key===C)if(b.tag===4&&b.stateNode.containerInfo===_.containerInfo&&b.stateNode.implementation===_.implementation){t(S,b.sibling),b=i(b,_.children||[]),b.return=S,S=b;break e}else{t(S,b);break}else e(S,b);b=b.sibling}b=C0(_,S.mode,x),b.return=S,S=b}return s(S);case xo:return C=_._init,w(S,b,C(_._payload),x)}if(rc(_))return m(S,b,_,x);if(tc(_))return f(S,b,_,x);vh(S,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,b!==null&&b.tag===6?(t(S,b.sibling),b=i(b,_),b.return=S,S=b):(t(S,b),b=k0(_,S.mode,x),b.return=S,S=b),s(S)):t(S,b)}return w}var Da=Q_(!0),ek=Q_(!1),Mc={},di=To(Mc),Ac=To(Mc),Tc=To(Mc);function Es(n){if(n===Mc)throw Error(Z(174));return n}function Vy(n,e){switch(et(Tc,e),et(Ac,n),et(di,Mc),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Um(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Um(e,n)}at(di),et(di,e)}function La(){at(di),at(Ac),at(Tc)}function tk(n){Es(Tc.current);var e=Es(di.current),t=Um(e,n.type);e!==t&&(et(Ac,n),et(di,t))}function Hy(n){Ac.current===n&&(at(di),at(Ac))}var gt=To(0);function Sh(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Wy=[];function Ky(){for(var n=0;n<Wy.length;n++)Wy[n]._workInProgressVersionPrimary=null;Wy.length=0}var xh=Ni.ReactCurrentDispatcher,Gy=Ni.ReactCurrentBatchConfig,Is=0,mt=null,Dt=null,zt=null,_h=!1,jc=!1,Rc=0,dO=0;function rn(){throw Error(Z(321))}function Yy(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Lr(n[t],e[t]))return!1;return!0}function Xy(n,e,t,r,i,o){if(Is=o,mt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,xh.current=n===null||n.memoizedState===null?fO:gO,n=t(r,i),jc){o=0;do{if(jc=!1,Rc=0,25<=o)throw Error(Z(301));o+=1,zt=Dt=null,e.updateQueue=null,xh.current=mO,n=t(r,i)}while(jc)}if(xh.current=Ph,e=Dt!==null&&Dt.next!==null,Is=0,zt=Dt=mt=null,_h=!1,e)throw Error(Z(300));return n}function qy(){var n=Rc!==0;return Rc=0,n}function ui(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zt===null?mt.memoizedState=zt=n:zt=zt.next=n,zt}function Sr(){if(Dt===null){var n=mt.alternate;n=n!==null?n.memoizedState:null}else n=Dt.next;var e=zt===null?mt.memoizedState:zt.next;if(e!==null)zt=e,Dt=n;else{if(n===null)throw Error(Z(310));Dt=n,n={memoizedState:Dt.memoizedState,baseState:Dt.baseState,baseQueue:Dt.baseQueue,queue:Dt.queue,next:null},zt===null?mt.memoizedState=zt=n:zt=zt.next=n}return zt}function Oc(n,e){return typeof e=="function"?e(n):e}function Jy(n){var e=Sr(),t=e.queue;if(t===null)throw Error(Z(311));t.lastRenderedReducer=n;var r=Dt,i=r.baseQueue,o=t.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,t.pending=null}if(i!==null){o=i.next,r=r.baseState;var a=s=null,l=null,c=o;do{var d=c.lane;if((Is&d)===d)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var u={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=u,s=r):l=l.next=u,mt.lanes|=d,Ms|=d}c=c.next}while(c!==null&&c!==o);l===null?s=r:l.next=a,Lr(r,e.memoizedState)||(Ln=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do o=i.lane,mt.lanes|=o,Ms|=o,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Zy(n){var e=Sr(),t=e.queue;if(t===null)throw Error(Z(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,o=e.memoizedState;if(i!==null){t.pending=null;var s=i=i.next;do o=n(o,s.action),s=s.next;while(s!==i);Lr(o,e.memoizedState)||(Ln=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,r]}function nk(){}function rk(n,e){var t=mt,r=Sr(),i=e(),o=!Lr(r.memoizedState,i);if(o&&(r.memoizedState=i,Ln=!0),r=r.queue,Qy(sk.bind(null,t,r,n),[n]),r.getSnapshot!==e||o||zt!==null&&zt.memoizedState.tag&1){if(t.flags|=2048,Dc(9,ok.bind(null,t,r,i,e),void 0,null),Nt===null)throw Error(Z(349));Is&30||ik(t,e,i)}return i}function ik(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function ok(n,e,t,r){e.value=t,e.getSnapshot=r,ak(e)&&lk(n)}function sk(n,e,t){return t(function(){ak(e)&&lk(n)})}function ak(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Lr(n,t)}catch{return!0}}function lk(n){var e=Vi(n,1);e!==null&&Br(e,n,1,-1)}function ck(n){var e=ui();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Oc,lastRenderedState:n},e.queue=n,n=n.dispatch=pO.bind(null,mt,n),[e.memoizedState,n]}function Dc(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function dk(){return Sr().memoizedState}function kh(n,e,t,r){var i=ui();mt.flags|=n,i.memoizedState=Dc(1|e,t,void 0,r===void 0?null:r)}function Ch(n,e,t,r){var i=Sr();r=r===void 0?null:r;var o=void 0;if(Dt!==null){var s=Dt.memoizedState;if(o=s.destroy,r!==null&&Yy(r,s.deps)){i.memoizedState=Dc(e,t,o,r);return}}mt.flags|=n,i.memoizedState=Dc(1|e,t,o,r)}function uk(n,e){return kh(8390656,8,n,e)}function Qy(n,e){return Ch(2048,8,n,e)}function hk(n,e){return Ch(4,2,n,e)}function pk(n,e){return Ch(4,4,n,e)}function fk(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function gk(n,e,t){return t=t!=null?t.concat([n]):null,Ch(4,4,fk.bind(null,e,n),t)}function e0(){}function mk(n,e){var t=Sr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Yy(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function yk(n,e){var t=Sr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Yy(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function wk(n,e,t){return Is&21?(Lr(t,e)||(t=Hx(),mt.lanes|=t,Ms|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Ln=!0),n.memoizedState=t)}function uO(n,e){var t=He;He=t!==0&&4>t?t:4,n(!0);var r=Gy.transition;Gy.transition={};try{n(!1),e()}finally{He=t,Gy.transition=r}}function bk(){return Sr().memoizedState}function hO(n,e,t){var r=Fo(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},vk(n))Sk(e,t);else if(t=H_(n,e,t,r),t!==null){var i=kn();Br(t,n,r,i),xk(t,e,r)}}function pO(n,e,t){var r=Fo(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(vk(n))Sk(e,i);else{var o=n.alternate;if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,t);if(i.hasEagerState=!0,i.eagerState=a,Lr(a,s)){var l=e.interleaved;l===null?(i.next=i,Fy(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=H_(n,e,i,r),t!==null&&(i=kn(),Br(t,n,r,i),xk(t,e,r))}}function vk(n){var e=n.alternate;return n===mt||e!==null&&e===mt}function Sk(n,e){jc=_h=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function xk(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,ey(n,t)}}var Ph={readContext:vr,useCallback:rn,useContext:rn,useEffect:rn,useImperativeHandle:rn,useInsertionEffect:rn,useLayoutEffect:rn,useMemo:rn,useReducer:rn,useRef:rn,useState:rn,useDebugValue:rn,useDeferredValue:rn,useTransition:rn,useMutableSource:rn,useSyncExternalStore:rn,useId:rn,unstable_isNewReconciler:!1},fO={readContext:vr,useCallback:function(n,e){return ui().memoizedState=[n,e===void 0?null:e],n},useContext:vr,useEffect:uk,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,kh(4194308,4,fk.bind(null,e,n),t)},useLayoutEffect:function(n,e){return kh(4194308,4,n,e)},useInsertionEffect:function(n,e){return kh(4,2,n,e)},useMemo:function(n,e){var t=ui();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=ui();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=hO.bind(null,mt,n),[r.memoizedState,n]},useRef:function(n){var e=ui();return n={current:n},e.memoizedState=n},useState:ck,useDebugValue:e0,useDeferredValue:function(n){return ui().memoizedState=n},useTransition:function(){var n=ck(!1),e=n[0];return n=uO.bind(null,n[1]),ui().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=mt,i=ui();if(ut){if(t===void 0)throw Error(Z(407));t=t()}else{if(t=e(),Nt===null)throw Error(Z(349));Is&30||ik(r,e,t)}i.memoizedState=t;var o={value:t,getSnapshot:e};return i.queue=o,uk(sk.bind(null,r,o,n),[n]),r.flags|=2048,Dc(9,ok.bind(null,r,o,t,e),void 0,null),t},useId:function(){var n=ui(),e=Nt.identifierPrefix;if(ut){var t=Ui,r=Bi;t=(r&~(1<<32-Dr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Rc++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=dO++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},gO={readContext:vr,useCallback:mk,useContext:vr,useEffect:Qy,useImperativeHandle:gk,useInsertionEffect:hk,useLayoutEffect:pk,useMemo:yk,useReducer:Jy,useRef:dk,useState:function(){return Jy(Oc)},useDebugValue:e0,useDeferredValue:function(n){var e=Sr();return wk(e,Dt.memoizedState,n)},useTransition:function(){var n=Jy(Oc)[0],e=Sr().memoizedState;return[n,e]},useMutableSource:nk,useSyncExternalStore:rk,useId:bk,unstable_isNewReconciler:!1},mO={readContext:vr,useCallback:mk,useContext:vr,useEffect:Qy,useImperativeHandle:gk,useInsertionEffect:hk,useLayoutEffect:pk,useMemo:yk,useReducer:Zy,useRef:dk,useState:function(){return Zy(Oc)},useDebugValue:e0,useDeferredValue:function(n){var e=Sr();return Dt===null?e.memoizedState=n:wk(e,Dt.memoizedState,n)},useTransition:function(){var n=Zy(Oc)[0],e=Sr().memoizedState;return[n,e]},useMutableSource:nk,useSyncExternalStore:rk,useId:bk,unstable_isNewReconciler:!1};function za(n,e){try{var t="",r=e;do t+=H4(r),r=r.return;while(r);var i=t}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:n,source:e,stack:i,digest:null}}function t0(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function n0(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var yO=typeof WeakMap=="function"?WeakMap:Map;function _k(n,e,t){t=Hi(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Rh||(Rh=!0,m0=r),n0(n,e)},t}function kk(n,e,t){t=Hi(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){n0(n,e)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){n0(n,e),typeof r!="function"&&(zo===null?zo=new Set([this]):zo.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),t}function Ck(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new yO;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=TO.bind(null,n,e,t),e.then(n,n))}function Pk(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Ek(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Hi(-1,1),e.tag=2,Do(t,e,1))),t.lanes|=1),n)}var wO=Ni.ReactCurrentOwner,Ln=!1;function _n(n,e,t,r){e.child=n===null?ek(e,null,t,r):Da(e,n.child,t,r)}function Ik(n,e,t,r,i){t=t.render;var o=e.ref;return Oa(e,i),r=Xy(n,e,t,r,o,i),t=qy(),n!==null&&!Ln?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Wi(n,e,i)):(ut&&t&&Ay(e),e.flags|=1,_n(n,e,r,i),e.child)}function Mk(n,e,t,r,i){if(n===null){var o=t.type;return typeof o=="function"&&!_0(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,Ak(n,e,o,r,i)):(n=Fh(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(o=n.child,!(n.lanes&i)){var s=o.memoizedProps;if(t=t.compare,t=t!==null?t:Sc,t(s,r)&&n.ref===e.ref)return Wi(n,e,i)}return e.flags|=1,n=Bo(o,r),n.ref=e.ref,n.return=e,e.child=n}function Ak(n,e,t,r,i){if(n!==null){var o=n.memoizedProps;if(Sc(o,r)&&n.ref===e.ref)if(Ln=!1,e.pendingProps=r=o,(n.lanes&i)!==0)n.flags&131072&&(Ln=!0);else return e.lanes=n.lanes,Wi(n,e,i)}return r0(n,e,t,r,i)}function Tk(n,e,t){var r=e.pendingProps,i=r.children,o=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},et(Fa,nr),nr|=t;else{if(!(t&1073741824))return n=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,et(Fa,nr),nr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:t,et(Fa,nr),nr|=r}else o!==null?(r=o.baseLanes|t,e.memoizedState=null):r=t,et(Fa,nr),nr|=r;return _n(n,e,i,t),e.child}function jk(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function r0(n,e,t,r,i){var o=Dn(t)?_s:nn.current;return o=Ma(e,o),Oa(e,i),t=Xy(n,e,t,r,o,i),r=qy(),n!==null&&!Ln?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Wi(n,e,i)):(ut&&r&&Ay(e),e.flags|=1,_n(n,e,t,i),e.child)}function Rk(n,e,t,r,i){if(Dn(t)){var o=!0;dh(e)}else o=!1;if(Oa(e,i),e.stateNode===null)Ih(n,e),q_(e,t,r),Uy(e,t,r,i),r=!0;else if(n===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var l=s.context,c=t.contextType;typeof c=="object"&&c!==null?c=vr(c):(c=Dn(t)?_s:nn.current,c=Ma(e,c));var d=t.getDerivedStateFromProps,u=typeof d=="function"||typeof s.getSnapshotBeforeUpdate=="function";u||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||l!==c)&&J_(e,s,r,c),Oo=!1;var h=e.memoizedState;s.state=h,wh(e,r,s,i),l=e.memoizedState,a!==r||h!==l||On.current||Oo?(typeof d=="function"&&(By(e,t,d,r),l=e.memoizedState),(a=Oo||X_(e,t,a,r,h,l,c))?(u||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,W_(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:Nr(e.type,a),s.props=c,u=e.pendingProps,h=s.context,l=t.contextType,typeof l=="object"&&l!==null?l=vr(l):(l=Dn(t)?_s:nn.current,l=Ma(e,l));var p=t.getDerivedStateFromProps;(d=typeof p=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==u||h!==l)&&J_(e,s,r,l),Oo=!1,h=e.memoizedState,s.state=h,wh(e,r,s,i);var m=e.memoizedState;a!==u||h!==m||On.current||Oo?(typeof p=="function"&&(By(e,t,p,r),m=e.memoizedState),(c=Oo||X_(e,t,c,r,h,m,l)||!1)?(d||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,m,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,m,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),s.props=r,s.state=m,s.context=l,r=c):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),r=!1)}return i0(n,e,t,r,o,i)}function i0(n,e,t,r,i,o){jk(n,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&z_(e,t,!1),Wi(n,e,o);r=e.stateNode,wO.current=e;var a=s&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&s?(e.child=Da(e,n.child,null,o),e.child=Da(e,null,a,o)):_n(n,e,a,o),e.memoizedState=r.state,i&&z_(e,t,!0),e.child}function Ok(n){var e=n.stateNode;e.pendingContext?D_(n,e.pendingContext,e.pendingContext!==e.context):e.context&&D_(n,e.context,!1),Vy(n,e.containerInfo)}function Dk(n,e,t,r,i){return ja(),Oy(i),e.flags|=256,_n(n,e,t,r),e.child}var o0={dehydrated:null,treeContext:null,retryLane:0};function s0(n){return{baseLanes:n,cachePool:null,transitions:null}}function Lk(n,e,t){var r=e.pendingProps,i=gt.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(o=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),et(gt,i&1),n===null)return Ry(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,n=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=$h(s,r,0,null),n=Rs(n,r,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,e.child.memoizedState=s0(t),e.memoizedState=o0,n):a0(e,s));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return bO(n,e,s,r,a,i,t);if(o){o=r.fallback,s=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Bo(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=Bo(a,o):(o=Rs(o,s,t,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=n.child.memoizedState,s=s===null?s0(t):{baseLanes:s.baseLanes|t,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=n.childLanes&~t,e.memoizedState=o0,r}return o=n.child,n=o.sibling,r=Bo(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function a0(n,e){return e=$h({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Eh(n,e,t,r){return r!==null&&Oy(r),Da(e,n.child,null,t),n=a0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function bO(n,e,t,r,i,o,s){if(t)return e.flags&256?(e.flags&=-257,r=t0(Error(Z(422))),Eh(n,e,s,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=$h({mode:"visible",children:r.children},i,0,null),o=Rs(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&Da(e,n.child,null,s),e.child.memoizedState=s0(s),e.memoizedState=o0,o);if(!(e.mode&1))return Eh(n,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(Z(419)),r=t0(o,r,void 0),Eh(n,e,s,r)}if(a=(s&n.childLanes)!==0,Ln||a){if(r=Nt,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Vi(n,i),Br(r,n,i,-1))}return x0(),r=t0(Error(Z(421))),Eh(n,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=jO.bind(null,n),i._reactRetry=e,null):(n=o.treeContext,tr=Ao(i.nextSibling),er=e,ut=!0,zr=null,n!==null&&(wr[br++]=Bi,wr[br++]=Ui,wr[br++]=ks,Bi=n.id,Ui=n.overflow,ks=e),e=a0(e,r.children),e.flags|=4096,e)}function zk(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Ny(n.return,e,t)}function l0(n,e,t,r,i){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function Nk(n,e,t){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(_n(n,e,r.children,t),r=gt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&zk(n,t,e);else if(n.tag===19)zk(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(et(gt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Sh(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),l0(e,!1,i,t,o);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Sh(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}l0(e,!0,t,null,o);break;case"together":l0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ih(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Wi(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Ms|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Z(153));if(e.child!==null){for(n=e.child,t=Bo(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Bo(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function vO(n,e,t){switch(e.tag){case 3:Ok(e),ja();break;case 5:tk(e);break;case 1:Dn(e.type)&&dh(e);break;case 4:Vy(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;et(gh,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(et(gt,gt.current&1),e.flags|=128,null):t&e.child.childLanes?Lk(n,e,t):(et(gt,gt.current&1),n=Wi(n,e,t),n!==null?n.sibling:null);et(gt,gt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Nk(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),et(gt,gt.current),r)break;return null;case 22:case 23:return e.lanes=0,Tk(n,e,t)}return Wi(n,e,t)}var Fk,c0,$k,Bk;Fk=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},c0=function(){},$k=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Es(di.current);var o=null;switch(t){case"input":i=Nm(n,i),r=Nm(n,r),o=[];break;case"select":i=ft({},i,{value:void 0}),r=ft({},r,{value:void 0}),o=[];break;case"textarea":i=Bm(n,i),r=Bm(n,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=ah)}Vm(t,r);var s;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(s in a)a.hasOwnProperty(s)&&(t||(t={}),t[s]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(ec.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var l=r[c];if(a=i==null?void 0:i[c],r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(s in a)!a.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(t||(t={}),t[s]="");for(s in l)l.hasOwnProperty(s)&&a[s]!==l[s]&&(t||(t={}),t[s]=l[s])}else t||(o||(o=[]),o.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(ec.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&st("scroll",n),o||a===l||(o=[])):(o=o||[]).push(c,l))}t&&(o=o||[]).push("style",t);var c=o;(e.updateQueue=c)&&(e.flags|=4)}},Bk=function(n,e,t,r){t!==r&&(e.flags|=4)};function Lc(n,e){if(!ut)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function on(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function SO(n,e,t){var r=e.pendingProps;switch(Ty(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return on(e),null;case 1:return Dn(e.type)&&ch(),on(e),null;case 3:return r=e.stateNode,La(),at(On),at(nn),Ky(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(fh(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,zr!==null&&(b0(zr),zr=null))),c0(n,e),on(e),null;case 5:Hy(e);var i=Es(Tc.current);if(t=e.type,n!==null&&e.stateNode!=null)$k(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Z(166));return on(e),null}if(n=Es(di.current),fh(e)){r=e.stateNode,t=e.type;var o=e.memoizedProps;switch(r[ci]=e,r[Pc]=o,n=(e.mode&1)!==0,t){case"dialog":st("cancel",r),st("close",r);break;case"iframe":case"object":case"embed":st("load",r);break;case"video":case"audio":for(i=0;i<_c.length;i++)st(_c[i],r);break;case"source":st("error",r);break;case"img":case"image":case"link":st("error",r),st("load",r);break;case"details":st("toggle",r);break;case"input":vx(r,o),st("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},st("invalid",r);break;case"textarea":_x(r,o),st("invalid",r)}Vm(t,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&sh(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&sh(r.textContent,a,n),i=["children",""+a]):ec.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&st("scroll",r)}switch(t){case"input":zu(r),xx(r,o,!0);break;case"textarea":zu(r),Cx(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=ah)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Px(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=s.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=s.createElement(t,{is:r.is}):(n=s.createElement(t),t==="select"&&(s=n,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):n=s.createElementNS(n,t),n[ci]=e,n[Pc]=r,Fk(n,e,!1,!1),e.stateNode=n;e:{switch(s=Hm(t,r),t){case"dialog":st("cancel",n),st("close",n),i=r;break;case"iframe":case"object":case"embed":st("load",n),i=r;break;case"video":case"audio":for(i=0;i<_c.length;i++)st(_c[i],n);i=r;break;case"source":st("error",n),i=r;break;case"img":case"image":case"link":st("error",n),st("load",n),i=r;break;case"details":st("toggle",n),i=r;break;case"input":vx(n,r),i=Nm(n,r),st("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=ft({},r,{value:void 0}),st("invalid",n);break;case"textarea":_x(n,r),i=Bm(n,r),st("invalid",n);break;default:i=r}Vm(t,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?Mx(n,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Ex(n,l)):o==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&ic(n,l):typeof l=="number"&&ic(n,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(ec.hasOwnProperty(o)?l!=null&&o==="onScroll"&&st("scroll",n):l!=null&&Em(n,o,l,s))}switch(t){case"input":zu(n),xx(n,r,!1);break;case"textarea":zu(n),Cx(n);break;case"option":r.value!=null&&n.setAttribute("value",""+_o(r.value));break;case"select":n.multiple=!!r.multiple,o=r.value,o!=null?ya(n,!!r.multiple,o,!1):r.defaultValue!=null&&ya(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=ah)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return on(e),null;case 6:if(n&&e.stateNode!=null)Bk(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Z(166));if(t=Es(Tc.current),Es(di.current),fh(e)){if(r=e.stateNode,t=e.memoizedProps,r[ci]=e,(o=r.nodeValue!==t)&&(n=er,n!==null))switch(n.tag){case 3:sh(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&sh(r.nodeValue,t,(n.mode&1)!==0)}o&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[ci]=e,e.stateNode=r}return on(e),null;case 13:if(at(gt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(ut&&tr!==null&&e.mode&1&&!(e.flags&128))V_(),ja(),e.flags|=98560,o=!1;else if(o=fh(e),r!==null&&r.dehydrated!==null){if(n===null){if(!o)throw Error(Z(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Z(317));o[ci]=e}else ja(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;on(e),o=!1}else zr!==null&&(b0(zr),zr=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||gt.current&1?Lt===0&&(Lt=3):x0())),e.updateQueue!==null&&(e.flags|=4),on(e),null);case 4:return La(),c0(n,e),n===null&&kc(e.stateNode.containerInfo),on(e),null;case 10:return zy(e.type._context),on(e),null;case 17:return Dn(e.type)&&ch(),on(e),null;case 19:if(at(gt),o=e.memoizedState,o===null)return on(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)Lc(o,!1);else{if(Lt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(s=Sh(n),s!==null){for(e.flags|=128,Lc(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)o=t,n=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=n,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,n=s.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return et(gt,gt.current&1|2),e.child}n=n.sibling}o.tail!==null&&Mt()>$a&&(e.flags|=128,r=!0,Lc(o,!1),e.lanes=4194304)}else{if(!r)if(n=Sh(s),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Lc(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!ut)return on(e),null}else 2*Mt()-o.renderingStartTime>$a&&t!==1073741824&&(e.flags|=128,r=!0,Lc(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(t=o.last,t!==null?t.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Mt(),e.sibling=null,t=gt.current,et(gt,r?t&1|2:t&1),e):(on(e),null);case 22:case 23:return S0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?nr&1073741824&&(on(e),e.subtreeFlags&6&&(e.flags|=8192)):on(e),null;case 24:return null;case 25:return null}throw Error(Z(156,e.tag))}function xO(n,e){switch(Ty(e),e.tag){case 1:return Dn(e.type)&&ch(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return La(),at(On),at(nn),Ky(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Hy(e),null;case 13:if(at(gt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Z(340));ja()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return at(gt),null;case 4:return La(),null;case 10:return zy(e.type._context),null;case 22:case 23:return S0(),null;case 24:return null;default:return null}}var Mh=!1,sn=!1,_O=typeof WeakSet=="function"?WeakSet:Set,ie=null;function Na(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){xt(n,e,r)}else t.current=null}function Uk(n,e,t){try{t()}catch(r){xt(n,e,r)}}var Vk=!1;function kO(n,e){if(xy=Xu,n=b_(),fy(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var s=0,a=-1,l=-1,c=0,d=0,u=n,h=null;t:for(;;){for(var p;u!==t||i!==0&&u.nodeType!==3||(a=s+i),u!==o||r!==0&&u.nodeType!==3||(l=s+r),u.nodeType===3&&(s+=u.nodeValue.length),(p=u.firstChild)!==null;)h=u,u=p;for(;;){if(u===n)break t;if(h===t&&++c===i&&(a=s),h===o&&++d===r&&(l=s),(p=u.nextSibling)!==null)break;u=h,h=u.parentNode}u=p}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(_y={focusedElem:n,selectionRange:t},Xu=!1,ie=e;ie!==null;)if(e=ie,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ie=n;else for(;ie!==null;){e=ie;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var f=m.memoizedProps,w=m.memoizedState,S=e.stateNode,b=S.getSnapshotBeforeUpdate(e.elementType===e.type?f:Nr(e.type,f),w);S.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Z(163))}}catch(x){xt(e,e.return,x)}if(n=e.sibling,n!==null){n.return=e.return,ie=n;break}ie=e.return}return m=Vk,Vk=!1,m}function zc(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var o=i.destroy;i.destroy=void 0,o!==void 0&&Uk(e,t,o)}i=i.next}while(i!==r)}}function Ah(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function d0(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Hk(n){var e=n.alternate;e!==null&&(n.alternate=null,Hk(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[ci],delete e[Pc],delete e[Ey],delete e[sO],delete e[aO])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Wk(n){return n.tag===5||n.tag===3||n.tag===4}function Kk(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Wk(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function u0(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=ah));else if(r!==4&&(n=n.child,n!==null))for(u0(n,e,t),n=n.sibling;n!==null;)u0(n,e,t),n=n.sibling}function h0(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(h0(n,e,t),n=n.sibling;n!==null;)h0(n,e,t),n=n.sibling}var Kt=null,Fr=!1;function Lo(n,e,t){for(t=t.child;t!==null;)Gk(n,e,t),t=t.sibling}function Gk(n,e,t){if(li&&typeof li.onCommitFiberUnmount=="function")try{li.onCommitFiberUnmount(Vu,t)}catch{}switch(t.tag){case 5:sn||Na(t,e);case 6:var r=Kt,i=Fr;Kt=null,Lo(n,e,t),Kt=r,Fr=i,Kt!==null&&(Fr?(n=Kt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Kt.removeChild(t.stateNode));break;case 18:Kt!==null&&(Fr?(n=Kt,t=t.stateNode,n.nodeType===8?Py(n.parentNode,t):n.nodeType===1&&Py(n,t),gc(n)):Py(Kt,t.stateNode));break;case 4:r=Kt,i=Fr,Kt=t.stateNode.containerInfo,Fr=!0,Lo(n,e,t),Kt=r,Fr=i;break;case 0:case 11:case 14:case 15:if(!sn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&Uk(t,e,s),i=i.next}while(i!==r)}Lo(n,e,t);break;case 1:if(!sn&&(Na(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){xt(t,e,a)}Lo(n,e,t);break;case 21:Lo(n,e,t);break;case 22:t.mode&1?(sn=(r=sn)||t.memoizedState!==null,Lo(n,e,t),sn=r):Lo(n,e,t);break;default:Lo(n,e,t)}}function Yk(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new _O),e.forEach(function(r){var i=RO.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function $r(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var o=n,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:Kt=a.stateNode,Fr=!1;break e;case 3:Kt=a.stateNode.containerInfo,Fr=!0;break e;case 4:Kt=a.stateNode.containerInfo,Fr=!0;break e}a=a.return}if(Kt===null)throw Error(Z(160));Gk(o,s,i),Kt=null,Fr=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){xt(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Xk(e,n),e=e.sibling}function Xk(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if($r(e,n),hi(n),r&4){try{zc(3,n,n.return),Ah(3,n)}catch(f){xt(n,n.return,f)}try{zc(5,n,n.return)}catch(f){xt(n,n.return,f)}}break;case 1:$r(e,n),hi(n),r&512&&t!==null&&Na(t,t.return);break;case 5:if($r(e,n),hi(n),r&512&&t!==null&&Na(t,t.return),n.flags&32){var i=n.stateNode;try{ic(i,"")}catch(f){xt(n,n.return,f)}}if(r&4&&(i=n.stateNode,i!=null)){var o=n.memoizedProps,s=t!==null?t.memoizedProps:o,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&Sx(i,o),Hm(a,s);var c=Hm(a,o);for(s=0;s<l.length;s+=2){var d=l[s],u=l[s+1];d==="style"?Mx(i,u):d==="dangerouslySetInnerHTML"?Ex(i,u):d==="children"?ic(i,u):Em(i,d,u,c)}switch(a){case"input":Fm(i,o);break;case"textarea":kx(i,o);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?ya(i,!!o.multiple,p,!1):h!==!!o.multiple&&(o.defaultValue!=null?ya(i,!!o.multiple,o.defaultValue,!0):ya(i,!!o.multiple,o.multiple?[]:"",!1))}i[Pc]=o}catch(f){xt(n,n.return,f)}}break;case 6:if($r(e,n),hi(n),r&4){if(n.stateNode===null)throw Error(Z(162));i=n.stateNode,o=n.memoizedProps;try{i.nodeValue=o}catch(f){xt(n,n.return,f)}}break;case 3:if($r(e,n),hi(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{gc(e.containerInfo)}catch(f){xt(n,n.return,f)}break;case 4:$r(e,n),hi(n);break;case 13:$r(e,n),hi(n),i=n.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(g0=Mt())),r&4&&Yk(n);break;case 22:if(d=t!==null&&t.memoizedState!==null,n.mode&1?(sn=(c=sn)||d,$r(e,n),sn=c):$r(e,n),hi(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!d&&n.mode&1)for(ie=n,d=n.child;d!==null;){for(u=ie=d;ie!==null;){switch(h=ie,p=h.child,h.tag){case 0:case 11:case 14:case 15:zc(4,h,h.return);break;case 1:Na(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){r=h,t=h.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(f){xt(r,t,f)}}break;case 5:Na(h,h.return);break;case 22:if(h.memoizedState!==null){Zk(u);continue}}p!==null?(p.return=h,ie=p):Zk(u)}d=d.sibling}e:for(d=null,u=n;;){if(u.tag===5){if(d===null){d=u;try{i=u.stateNode,c?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=u.stateNode,l=u.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Ix("display",s))}catch(f){xt(n,n.return,f)}}}else if(u.tag===6){if(d===null)try{u.stateNode.nodeValue=c?"":u.memoizedProps}catch(f){xt(n,n.return,f)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===n)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===n)break e;for(;u.sibling===null;){if(u.return===null||u.return===n)break e;d===u&&(d=null),u=u.return}d===u&&(d=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:$r(e,n),hi(n),r&4&&Yk(n);break;case 21:break;default:$r(e,n),hi(n)}}function hi(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Wk(t)){var r=t;break e}t=t.return}throw Error(Z(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(ic(i,""),r.flags&=-33);var o=Kk(n);h0(n,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,a=Kk(n);u0(n,a,s);break;default:throw Error(Z(161))}}catch(l){xt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function CO(n,e,t){ie=n,qk(n)}function qk(n,e,t){for(var r=(n.mode&1)!==0;ie!==null;){var i=ie,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||Mh;if(!s){var a=i.alternate,l=a!==null&&a.memoizedState!==null||sn;a=Mh;var c=sn;if(Mh=s,(sn=l)&&!c)for(ie=i;ie!==null;)s=ie,l=s.child,s.tag===22&&s.memoizedState!==null?Qk(i):l!==null?(l.return=s,ie=l):Qk(i);for(;o!==null;)ie=o,qk(o),o=o.sibling;ie=i,Mh=a,sn=c}Jk(n)}else i.subtreeFlags&8772&&o!==null?(o.return=i,ie=o):Jk(n)}}function Jk(n){for(;ie!==null;){var e=ie;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:sn||Ah(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!sn)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Nr(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&G_(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}G_(e,s,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var d=c.memoizedState;if(d!==null){var u=d.dehydrated;u!==null&&gc(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Z(163))}sn||e.flags&512&&d0(e)}catch(h){xt(e,e.return,h)}}if(e===n){ie=null;break}if(t=e.sibling,t!==null){t.return=e.return,ie=t;break}ie=e.return}}function Zk(n){for(;ie!==null;){var e=ie;if(e===n){ie=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ie=t;break}ie=e.return}}function Qk(n){for(;ie!==null;){var e=ie;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Ah(4,e)}catch(l){xt(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){xt(e,i,l)}}var o=e.return;try{d0(e)}catch(l){xt(e,o,l)}break;case 5:var s=e.return;try{d0(e)}catch(l){xt(e,s,l)}}}catch(l){xt(e,e.return,l)}if(e===n){ie=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ie=a;break}ie=e.return}}var PO=Math.ceil,Th=Ni.ReactCurrentDispatcher,p0=Ni.ReactCurrentOwner,xr=Ni.ReactCurrentBatchConfig,Te=0,Nt=null,Tt=null,Gt=0,nr=0,Fa=To(0),Lt=0,Nc=null,Ms=0,jh=0,f0=0,Fc=null,zn=null,g0=0,$a=1/0,Ki=null,Rh=!1,m0=null,zo=null,Oh=!1,No=null,Dh=0,$c=0,y0=null,Lh=-1,zh=0;function kn(){return Te&6?Mt():Lh!==-1?Lh:Lh=Mt()}function Fo(n){return n.mode&1?Te&2&&Gt!==0?Gt&-Gt:cO.transition!==null?(zh===0&&(zh=Hx()),zh):(n=He,n!==0||(n=window.event,n=n===void 0?16:Qx(n.type)),n):1}function Br(n,e,t,r){if(50<$c)throw $c=0,y0=null,Error(Z(185));dc(n,t,r),(!(Te&2)||n!==Nt)&&(n===Nt&&(!(Te&2)&&(jh|=t),Lt===4&&$o(n,Gt)),Nn(n,r),t===1&&Te===0&&!(e.mode&1)&&($a=Mt()+500,uh&&Ro()))}function Nn(n,e){var t=n.callbackNode;c5(n,e);var r=Ku(n,n===Nt?Gt:0);if(r===0)t!==null&&Bx(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Bx(t),e===1)n.tag===0?lO(tC.bind(null,n)):N_(tC.bind(null,n)),iO(function(){!(Te&6)&&Ro()}),t=null;else{switch(Wx(r)){case 1:t=Jm;break;case 4:t=Ux;break;case 16:t=Uu;break;case 536870912:t=Vx;break;default:t=Uu}t=cC(t,eC.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function eC(n,e){if(Lh=-1,zh=0,Te&6)throw Error(Z(327));var t=n.callbackNode;if(Ba()&&n.callbackNode!==t)return null;var r=Ku(n,n===Nt?Gt:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Nh(n,r);else{e=r;var i=Te;Te|=2;var o=rC();(Nt!==n||Gt!==e)&&(Ki=null,$a=Mt()+500,Ts(n,e));do try{MO();break}catch(a){nC(n,a)}while(1);Ly(),Th.current=o,Te=i,Tt!==null?e=0:(Nt=null,Gt=0,e=Lt)}if(e!==0){if(e===2&&(i=Zm(n),i!==0&&(r=i,e=w0(n,i))),e===1)throw t=Nc,Ts(n,0),$o(n,r),Nn(n,Mt()),t;if(e===6)$o(n,r);else{if(i=n.current.alternate,!(r&30)&&!EO(i)&&(e=Nh(n,r),e===2&&(o=Zm(n),o!==0&&(r=o,e=w0(n,o))),e===1))throw t=Nc,Ts(n,0),$o(n,r),Nn(n,Mt()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(Z(345));case 2:js(n,zn,Ki);break;case 3:if($o(n,r),(r&130023424)===r&&(e=g0+500-Mt(),10<e)){if(Ku(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){kn(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=Cy(js.bind(null,n,zn,Ki),e);break}js(n,zn,Ki);break;case 4:if($o(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var s=31-Dr(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=Mt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*PO(r/1960))-r,10<r){n.timeoutHandle=Cy(js.bind(null,n,zn,Ki),r);break}js(n,zn,Ki);break;case 5:js(n,zn,Ki);break;default:throw Error(Z(329))}}}return Nn(n,Mt()),n.callbackNode===t?eC.bind(null,n):null}function w0(n,e){var t=Fc;return n.current.memoizedState.isDehydrated&&(Ts(n,e).flags|=256),n=Nh(n,e),n!==2&&(e=zn,zn=t,e!==null&&b0(e)),n}function b0(n){zn===null?zn=n:zn.push.apply(zn,n)}function EO(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!Lr(o(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function $o(n,e){for(e&=~f0,e&=~jh,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Dr(e),r=1<<t;n[t]=-1,e&=~r}}function tC(n){if(Te&6)throw Error(Z(327));Ba();var e=Ku(n,0);if(!(e&1))return Nn(n,Mt()),null;var t=Nh(n,e);if(n.tag!==0&&t===2){var r=Zm(n);r!==0&&(e=r,t=w0(n,r))}if(t===1)throw t=Nc,Ts(n,0),$o(n,e),Nn(n,Mt()),t;if(t===6)throw Error(Z(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,js(n,zn,Ki),Nn(n,Mt()),null}function v0(n,e){var t=Te;Te|=1;try{return n(e)}finally{Te=t,Te===0&&($a=Mt()+500,uh&&Ro())}}function As(n){No!==null&&No.tag===0&&!(Te&6)&&Ba();var e=Te;Te|=1;var t=xr.transition,r=He;try{if(xr.transition=null,He=1,n)return n()}finally{He=r,xr.transition=t,Te=e,!(Te&6)&&Ro()}}function S0(){nr=Fa.current,at(Fa)}function Ts(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,rO(t)),Tt!==null)for(t=Tt.return;t!==null;){var r=t;switch(Ty(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ch();break;case 3:La(),at(On),at(nn),Ky();break;case 5:Hy(r);break;case 4:La();break;case 13:at(gt);break;case 19:at(gt);break;case 10:zy(r.type._context);break;case 22:case 23:S0()}t=t.return}if(Nt=n,Tt=n=Bo(n.current,null),Gt=nr=e,Lt=0,Nc=null,f0=jh=Ms=0,zn=Fc=null,Ps!==null){for(e=0;e<Ps.length;e++)if(t=Ps[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,o=t.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}t.pending=r}Ps=null}return n}function nC(n,e){do{var t=Tt;try{if(Ly(),xh.current=Ph,_h){for(var r=mt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}_h=!1}if(Is=0,zt=Dt=mt=null,jc=!1,Rc=0,p0.current=null,t===null||t.return===null){Lt=1,Nc=e,Tt=null;break}e:{var o=n,s=t.return,a=t,l=e;if(e=Gt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,d=a,u=d.tag;if(!(d.mode&1)&&(u===0||u===11||u===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=Pk(s);if(p!==null){p.flags&=-257,Ek(p,s,a,o,e),p.mode&1&&Ck(o,c,e),e=p,l=c;var m=e.updateQueue;if(m===null){var f=new Set;f.add(l),e.updateQueue=f}else m.add(l);break e}else{if(!(e&1)){Ck(o,c,e),x0();break e}l=Error(Z(426))}}else if(ut&&a.mode&1){var w=Pk(s);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Ek(w,s,a,o,e),Oy(za(l,a));break e}}o=l=za(l,a),Lt!==4&&(Lt=2),Fc===null?Fc=[o]:Fc.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var S=_k(o,l,e);K_(o,S);break e;case 1:a=l;var b=o.type,_=o.stateNode;if(!(o.flags&128)&&(typeof b.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(zo===null||!zo.has(_)))){o.flags|=65536,e&=-e,o.lanes|=e;var x=kk(o,a,e);K_(o,x);break e}}o=o.return}while(o!==null)}oC(t)}catch(P){e=P,Tt===t&&t!==null&&(Tt=t=t.return);continue}break}while(1)}function rC(){var n=Th.current;return Th.current=Ph,n===null?Ph:n}function x0(){(Lt===0||Lt===3||Lt===2)&&(Lt=4),Nt===null||!(Ms&268435455)&&!(jh&268435455)||$o(Nt,Gt)}function Nh(n,e){var t=Te;Te|=2;var r=rC();(Nt!==n||Gt!==e)&&(Ki=null,Ts(n,e));do try{IO();break}catch(i){nC(n,i)}while(1);if(Ly(),Te=t,Th.current=r,Tt!==null)throw Error(Z(261));return Nt=null,Gt=0,Lt}function IO(){for(;Tt!==null;)iC(Tt)}function MO(){for(;Tt!==null&&!e5();)iC(Tt)}function iC(n){var e=lC(n.alternate,n,nr);n.memoizedProps=n.pendingProps,e===null?oC(n):Tt=e,p0.current=null}function oC(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=xO(t,e),t!==null){t.flags&=32767,Tt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Lt=6,Tt=null;return}}else if(t=SO(t,e,nr),t!==null){Tt=t;return}if(e=e.sibling,e!==null){Tt=e;return}Tt=e=n}while(e!==null);Lt===0&&(Lt=5)}function js(n,e,t){var r=He,i=xr.transition;try{xr.transition=null,He=1,AO(n,e,t,r)}finally{xr.transition=i,He=r}return null}function AO(n,e,t,r){do Ba();while(No!==null);if(Te&6)throw Error(Z(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Z(177));n.callbackNode=null,n.callbackPriority=0;var o=t.lanes|t.childLanes;if(d5(n,o),n===Nt&&(Tt=Nt=null,Gt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Oh||(Oh=!0,cC(Uu,function(){return Ba(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=xr.transition,xr.transition=null;var s=He;He=1;var a=Te;Te|=4,p0.current=null,kO(n,t),Xk(t,n),q5(_y),Xu=!!xy,_y=xy=null,n.current=t,CO(t),t5(),Te=a,He=s,xr.transition=o}else n.current=t;if(Oh&&(Oh=!1,No=n,Dh=i),o=n.pendingLanes,o===0&&(zo=null),i5(t.stateNode),Nn(n,Mt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Rh)throw Rh=!1,n=m0,m0=null,n;return Dh&1&&n.tag!==0&&Ba(),o=n.pendingLanes,o&1?n===y0?$c++:($c=0,y0=n):$c=0,Ro(),null}function Ba(){if(No!==null){var n=Wx(Dh),e=xr.transition,t=He;try{if(xr.transition=null,He=16>n?16:n,No===null)var r=!1;else{if(n=No,No=null,Dh=0,Te&6)throw Error(Z(331));var i=Te;for(Te|=4,ie=n.current;ie!==null;){var o=ie,s=o.child;if(ie.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(ie=c;ie!==null;){var d=ie;switch(d.tag){case 0:case 11:case 15:zc(8,d,o)}var u=d.child;if(u!==null)u.return=d,ie=u;else for(;ie!==null;){d=ie;var h=d.sibling,p=d.return;if(Hk(d),d===c){ie=null;break}if(h!==null){h.return=p,ie=h;break}ie=p}}}var m=o.alternate;if(m!==null){var f=m.child;if(f!==null){m.child=null;do{var w=f.sibling;f.sibling=null,f=w}while(f!==null)}}ie=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,ie=s;else e:for(;ie!==null;){if(o=ie,o.flags&2048)switch(o.tag){case 0:case 11:case 15:zc(9,o,o.return)}var S=o.sibling;if(S!==null){S.return=o.return,ie=S;break e}ie=o.return}}var b=n.current;for(ie=b;ie!==null;){s=ie;var _=s.child;if(s.subtreeFlags&2064&&_!==null)_.return=s,ie=_;else e:for(s=b;ie!==null;){if(a=ie,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ah(9,a)}}catch(P){xt(a,a.return,P)}if(a===s){ie=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,ie=x;break e}ie=a.return}}if(Te=i,Ro(),li&&typeof li.onPostCommitFiberRoot=="function")try{li.onPostCommitFiberRoot(Vu,n)}catch{}r=!0}return r}finally{He=t,xr.transition=e}}return!1}function sC(n,e,t){e=za(t,e),e=_k(n,e,1),n=Do(n,e,1),e=kn(),n!==null&&(dc(n,1,e),Nn(n,e))}function xt(n,e,t){if(n.tag===3)sC(n,n,t);else for(;e!==null;){if(e.tag===3){sC(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(zo===null||!zo.has(r))){n=za(t,n),n=kk(e,n,1),e=Do(e,n,1),n=kn(),e!==null&&(dc(e,1,n),Nn(e,n));break}}e=e.return}}function TO(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=kn(),n.pingedLanes|=n.suspendedLanes&t,Nt===n&&(Gt&t)===t&&(Lt===4||Lt===3&&(Gt&130023424)===Gt&&500>Mt()-g0?Ts(n,0):f0|=t),Nn(n,e)}function aC(n,e){e===0&&(n.mode&1?(e=Wu,Wu<<=1,!(Wu&130023424)&&(Wu=4194304)):e=1);var t=kn();n=Vi(n,e),n!==null&&(dc(n,e,t),Nn(n,t))}function jO(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),aC(n,t)}function RO(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Z(314))}r!==null&&r.delete(e),aC(n,t)}var lC;lC=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||On.current)Ln=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Ln=!1,vO(n,e,t);Ln=!!(n.flags&131072)}else Ln=!1,ut&&e.flags&1048576&&F_(e,ph,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Ih(n,e),n=e.pendingProps;var i=Ma(e,nn.current);Oa(e,t),i=Xy(null,e,r,n,i,t);var o=qy();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Dn(r)?(o=!0,dh(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,$y(e),i.updater=bh,e.stateNode=i,i._reactInternals=e,Uy(e,r,n,t),e=i0(null,e,r,!0,o,t)):(e.tag=0,ut&&o&&Ay(e),_n(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Ih(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=DO(r),n=Nr(r,n),i){case 0:e=r0(null,e,r,n,t);break e;case 1:e=Rk(null,e,r,n,t);break e;case 11:e=Ik(null,e,r,n,t);break e;case 14:e=Mk(null,e,r,Nr(r.type,n),t);break e}throw Error(Z(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nr(r,i),r0(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nr(r,i),Rk(n,e,r,i,t);case 3:e:{if(Ok(e),n===null)throw Error(Z(387));r=e.pendingProps,o=e.memoizedState,i=o.element,W_(n,e),wh(e,r,null,t);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=za(Error(Z(423)),e),e=Dk(n,e,r,t,i);break e}else if(r!==i){i=za(Error(Z(424)),e),e=Dk(n,e,r,t,i);break e}else for(tr=Ao(e.stateNode.containerInfo.firstChild),er=e,ut=!0,zr=null,t=ek(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ja(),r===i){e=Wi(n,e,t);break e}_n(n,e,r,t)}e=e.child}return e;case 5:return tk(e),n===null&&Ry(e),r=e.type,i=e.pendingProps,o=n!==null?n.memoizedProps:null,s=i.children,ky(r,i)?s=null:o!==null&&ky(r,o)&&(e.flags|=32),jk(n,e),_n(n,e,s,t),e.child;case 6:return n===null&&Ry(e),null;case 13:return Lk(n,e,t);case 4:return Vy(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Da(e,null,r,t):_n(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nr(r,i),Ik(n,e,r,i,t);case 7:return _n(n,e,e.pendingProps,t),e.child;case 8:return _n(n,e,e.pendingProps.children,t),e.child;case 12:return _n(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,et(gh,r._currentValue),r._currentValue=s,o!==null)if(Lr(o.value,s)){if(o.children===i.children&&!On.current){e=Wi(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(o.tag===1){l=Hi(-1,t&-t),l.tag=2;var c=o.updateQueue;if(c!==null){c=c.shared;var d=c.pending;d===null?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),Ny(o.return,t,e),a.lanes|=t;break}l=l.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Z(341));s.lanes|=t,a=s.alternate,a!==null&&(a.lanes|=t),Ny(s,t,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}_n(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Oa(e,t),i=vr(i),r=r(i),e.flags|=1,_n(n,e,r,t),e.child;case 14:return r=e.type,i=Nr(r,e.pendingProps),i=Nr(r.type,i),Mk(n,e,r,i,t);case 15:return Ak(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nr(r,i),Ih(n,e),e.tag=1,Dn(r)?(n=!0,dh(e)):n=!1,Oa(e,t),q_(e,r,i),Uy(e,r,i,t),i0(null,e,r,!0,n,t);case 19:return Nk(n,e,t);case 22:return Tk(n,e,t)}throw Error(Z(156,e.tag))};function cC(n,e){return $x(n,e)}function OO(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _r(n,e,t,r){return new OO(n,e,t,r)}function _0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function DO(n){if(typeof n=="function")return _0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Am)return 11;if(n===Rm)return 14}return 2}function Bo(n,e){var t=n.alternate;return t===null?(t=_r(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Fh(n,e,t,r,i,o){var s=2;if(r=n,typeof n=="function")_0(n)&&(s=1);else if(typeof n=="string")s=5;else e:switch(n){case ma:return Rs(t.children,i,o,e);case Im:s=8,i|=8;break;case Mm:return n=_r(12,t,e,i|2),n.elementType=Mm,n.lanes=o,n;case Tm:return n=_r(13,t,e,i),n.elementType=Tm,n.lanes=o,n;case jm:return n=_r(19,t,e,i),n.elementType=jm,n.lanes=o,n;case mx:return $h(t,i,o,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case fx:s=10;break e;case gx:s=9;break e;case Am:s=11;break e;case Rm:s=14;break e;case xo:s=16,r=null;break e}throw Error(Z(130,n==null?n:typeof n,""))}return e=_r(s,t,e,i),e.elementType=n,e.type=r,e.lanes=o,e}function Rs(n,e,t,r){return n=_r(7,n,r,e),n.lanes=t,n}function $h(n,e,t,r){return n=_r(22,n,r,e),n.elementType=mx,n.lanes=t,n.stateNode={isHidden:!1},n}function k0(n,e,t){return n=_r(6,n,null,e),n.lanes=t,n}function C0(n,e,t){return e=_r(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function LO(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Qm(0),this.expirationTimes=Qm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qm(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function P0(n,e,t,r,i,o,s,a,l){return n=new LO(n,e,t,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=_r(3,null,null,e),n.current=o,o.stateNode=n,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},$y(o),n}function zO(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ga,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function dC(n){if(!n)return jo;n=n._reactInternals;e:{if(Ss(n)!==n||n.tag!==1)throw Error(Z(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Dn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Z(171))}if(n.tag===1){var t=n.type;if(Dn(t))return L_(n,t,e)}return e}function uC(n,e,t,r,i,o,s,a,l){return n=P0(t,r,!0,n,i,o,s,a,l),n.context=dC(null),t=n.current,r=kn(),i=Fo(t),o=Hi(r,i),o.callback=e??null,Do(t,o,i),n.current.lanes=i,dc(n,i,r),Nn(n,r),n}function Bh(n,e,t,r){var i=e.current,o=kn(),s=Fo(i);return t=dC(t),e.context===null?e.context=t:e.pendingContext=t,e=Hi(o,s),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Do(i,e,s),n!==null&&(Br(n,i,s,o),yh(n,i,s)),s}function Uh(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function hC(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function E0(n,e){hC(n,e),(n=n.alternate)&&hC(n,e)}function NO(){return null}var pC=typeof reportError=="function"?reportError:function(n){console.error(n)};function I0(n){this._internalRoot=n}Vh.prototype.render=I0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Z(409));Bh(n,e,null,null)},Vh.prototype.unmount=I0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;As(function(){Bh(null,n,null,null)}),e[Fi]=null}};function Vh(n){this._internalRoot=n}Vh.prototype.unstable_scheduleHydration=function(n){if(n){var e=Yx();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Eo.length&&e!==0&&e<Eo[t].priority;t++);Eo.splice(t,0,n),t===0&&Jx(n)}};function M0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Hh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function fC(){}function FO(n,e,t,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var c=Uh(s);o.call(c)}}var s=uC(e,r,n,0,null,!1,!1,"",fC);return n._reactRootContainer=s,n[Fi]=s.current,kc(n.nodeType===8?n.parentNode:n),As(),s}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=Uh(l);a.call(c)}}var l=P0(n,0,!1,null,null,!1,!1,"",fC);return n._reactRootContainer=l,n[Fi]=l.current,kc(n.nodeType===8?n.parentNode:n),As(function(){Bh(e,l,t,r)}),l}function Wh(n,e,t,r,i){var o=t._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var l=Uh(s);a.call(l)}}Bh(e,s,n,i)}else s=FO(t,e,n,i,r);return Uh(s)}Kx=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=cc(e.pendingLanes);t!==0&&(ey(e,t|1),Nn(e,Mt()),!(Te&6)&&($a=Mt()+500,Ro()))}break;case 13:As(function(){var r=Vi(n,1);if(r!==null){var i=kn();Br(r,n,1,i)}}),E0(n,1)}},ty=function(n){if(n.tag===13){var e=Vi(n,134217728);if(e!==null){var t=kn();Br(e,n,134217728,t)}E0(n,134217728)}},Gx=function(n){if(n.tag===13){var e=Fo(n),t=Vi(n,e);if(t!==null){var r=kn();Br(t,n,e,r)}E0(n,e)}},Yx=function(){return He},Xx=function(n,e){var t=He;try{return He=n,e()}finally{He=t}},Gm=function(n,e,t){switch(e){case"input":if(Fm(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=lh(r);if(!i)throw Error(Z(90));bx(r),Fm(r,i)}}}break;case"textarea":kx(n,t);break;case"select":e=t.value,e!=null&&ya(n,!!t.multiple,e,!1)}},Rx=v0,Ox=As;var $O={usingClientEntryPoint:!1,Events:[Ec,Ea,lh,Tx,jx,v0]},Bc={findFiberByHostInstance:xs,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},BO={bundleType:Bc.bundleType,version:Bc.version,rendererPackageName:Bc.rendererPackageName,rendererConfig:Bc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ni.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Nx(n),n===null?null:n.stateNode},findFiberByHostInstance:Bc.findFiberByHostInstance||NO,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Kh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Kh.isDisabled&&Kh.supportsFiber)try{Vu=Kh.inject(BO),li=Kh}catch{}}Jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$O,Jn.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!M0(e))throw Error(Z(200));return zO(n,e,null,t)},Jn.createRoot=function(n,e){if(!M0(n))throw Error(Z(299));var t=!1,r="",i=pC;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=P0(n,1,!1,null,null,t,!1,r,i),n[Fi]=e.current,kc(n.nodeType===8?n.parentNode:n),new I0(e)},Jn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Z(188)):(n=Object.keys(n).join(","),Error(Z(268,n)));return n=Nx(e),n=n===null?null:n.stateNode,n},Jn.flushSync=function(n){return As(n)},Jn.hydrate=function(n,e,t){if(!Hh(e))throw Error(Z(200));return Wh(null,n,e,!0,t)},Jn.hydrateRoot=function(n,e,t){if(!M0(n))throw Error(Z(405));var r=t!=null&&t.hydratedSources||null,i=!1,o="",s=pC;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),e=uC(e,null,n,1,t??null,i,!1,o,s),n[Fi]=e.current,kc(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new Vh(e)},Jn.render=function(n,e,t){if(!Hh(e))throw Error(Z(200));return Wh(null,n,e,!1,t)},Jn.unmountComponentAtNode=function(n){if(!Hh(n))throw Error(Z(40));return n._reactRootContainer?(As(function(){Wh(null,null,n,!1,function(){n._reactRootContainer=null,n[Fi]=null})}),!0):!1},Jn.unstable_batchedUpdates=v0,Jn.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Hh(t))throw Error(Z(200));if(n==null||n._reactInternals===void 0)throw Error(Z(38));return Wh(n,e,t,!1,r)},Jn.version="18.2.0-next-9e3b772b8-20220608";function gC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(gC)}catch(n){console.error(n)}}gC(),ax.exports=Jn;var Ua=ax.exports;const Gh=qn(Ua);var mC=Ua;_m.createRoot=mC.createRoot,_m.hydrateRoot=mC.hydrateRoot;function yC(n){return n&&typeof n=="object"&&"parents"in n}function wC(n){for(let e=0,t=n.parents.length;e<t;e++)if(n.parents[e].__unsafe__getWithoutCapture(),n.parents[e].lastChangedEpoch!==n.parentEpochs[e])return!0;return!1}const Yh=(n,e)=>{if(n.children.remove(e)&&n.children.isEmpty&&yC(n))for(let t=0,r=n.parents.length;t<r;t++)Yh(n.parents[t],n)},A0=(n,e)=>{if(n.children.add(e)&&yC(n))for(let t=0,r=n.parents.length;t<r;t++)A0(n.parents[t],n)};function bC(n,e){return n===e||Object.is(n,e)||!!(n&&e&&typeof n.equals=="function"&&n.equals(e))}function Uo(n,e){const t=Symbol.for(`com.tldraw.state/${n}`),r=globalThis;return r[t]??(r[t]=e()),r[t]}const Gi=Uo("empty_array",()=>Object.freeze([])),vC=8;class SC{constructor(){y(this,"arraySize",0);y(this,"array",Array(vC));y(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<vC?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const r=this.array[t];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}}const rr=Symbol.for("com.tldraw.state/RESET_VALUE");class xC{constructor(e){y(this,"index",0);y(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,r){if(r!==void 0){if(r===rr){this.clear();return}this.buffer[this.index]=[e,t,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:r,buffer:i}=this;for(let o=0;o<r;o++){const s=(t-1+r-o)%r,a=i[s];if(!a)return rr;const[l,c]=a;if(o===0&&e>=c)return[];if(l<=e&&e<c){const d=o+1,u=new Array(d);for(let h=0;h<d;h++)u[h]=i[(s+h)%r][2];return u}}return rr}}class UO{constructor(e,t){y(this,"offset",0);y(this,"numNewParents",0);y(this,"maybeRemoved");this.below=e,this.child=t}}const lt=Uo("capture",()=>({stack:null}));function _C(n){lt.stack=new UO(lt.stack,n)}function kC(){var e;const n=lt.stack;if(lt.stack=n.below,n.numNewParents>0||n.offset!==n.child.parents.length){for(let t=n.offset;t<n.child.parents.length;t++){const r=n.child.parents[t];n.child.parents.indexOf(r)>=n.offset&&Yh(r,n.child)}if(n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset,(e=lt.stack)==null?void 0:e.maybeRemoved)for(let t=0;t<lt.stack.maybeRemoved.length;t++){const r=lt.stack.maybeRemoved[t];n.child.parents.indexOf(r)===-1&&Yh(r,n.child)}}}function T0(n){if(lt.stack){const e=lt.stack.child.parents.indexOf(n);if(e<0&&(lt.stack.numNewParents++,lt.stack.child.isActivelyListening&&A0(n,lt.stack.child)),e<0||e>=lt.stack.offset){if(e!==lt.stack.offset&&e>0){const t=lt.stack.child.parents[lt.stack.offset];lt.stack.maybeRemoved?lt.stack.maybeRemoved.indexOf(t)===-1&&lt.stack.maybeRemoved.push(t):lt.stack.maybeRemoved=[t]}lt.stack.child.parents[lt.stack.offset]=n,lt.stack.child.parentEpochs[lt.stack.offset]=n.lastChangedEpoch,lt.stack.offset++}}}const Os=-1;class VO{constructor(e,t,r){y(this,"_isActivelyListening",!1);y(this,"lastTraversedEpoch",Os);y(this,"lastReactedEpoch",Os);y(this,"_scheduleCount",0);y(this,"parentEpochs",[]);y(this,"parents",[]);y(this,"_scheduleEffect");y(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=t,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==ir()){if(this.parents.length&&!wC(this)){this.lastReactedEpoch=ir();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)A0(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)Yh(this.parents[e],this)}execute(){try{_C(this);const e=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=ir(),e}finally{kC()}}}const Va=Uo("EffectScheduler",()=>VO);function Uc(n,e,t){const r=new Va(n,e,t);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function HO(n,e,t){const r=new Va(n,e,t);return{scheduler:r,start:i=>{const o=(i==null?void 0:i.force)??!1;r.attach(),o?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}class WO{constructor(e){y(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){if(this.isRoot){const e=this.initialAtomValues;this.initialAtomValues=new Map,CC(e.keys())}else this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){an.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{var r;t.set(e),(r=t.historyBuffer)==null||r.clear()}),this.commit()}}const an=Uo("transactions",()=>({globalEpoch:Os+1,globalIsReacting:!1,currentTransaction:null}));function ir(){return an.globalEpoch}function CC(n){if(an.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{an.globalIsReacting=!0;const e=new Set,t=r=>{r.lastTraversedEpoch!==an.globalEpoch&&(r.lastTraversedEpoch=an.globalEpoch,r instanceof Va?e.add(r):r.children.visit(t))};for(const r of n)r.children.visit(t);for(const r of e)r.maybeScheduleEffect()}finally{an.globalIsReacting=!1}}function KO(n,e){an.currentTransaction?an.currentTransaction.initialAtomValues.has(n)||an.currentTransaction.initialAtomValues.set(n,e):CC([n])}function GO(){an.globalEpoch++}function YO(n){const e=new WO(an.currentTransaction);an.currentTransaction=e;try{let t=!1;const r=n(()=>t=!0);return t?e.abort():e.commit(),r}catch(t){throw e.abort(),t}finally{an.currentTransaction=an.currentTransaction.parent}}function Ur(n){return an.currentTransaction?n():YO(n)}class XO{constructor(e,t,r){y(this,"isEqual");y(this,"computeDiff");y(this,"lastChangedEpoch",ir());y(this,"children",new SC);y(this,"historyBuffer");this.name=e,this.current=t,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new xC(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(){return this.current}get(){return T0(this),this.current}set(e,t){var i,o;if(((i=this.isEqual)==null?void 0:i.call(this,this.current,e))??bC(this.current,e))return this.current;GO(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,ir(),t??((o=this.computeDiff)==null?void 0:o.call(this,this.current,e,this.lastChangedEpoch,ir()))??rr),this.lastChangedEpoch=ir();const r=this.current;return this.current=e,KO(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return T0(this),e>=this.lastChangedEpoch?Gi:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??rr}}const qO=Uo("Atom",()=>XO);function Cn(n,e,t){return new qO(n,e,t)}let PC=!1;function JO(){PC||(PC=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const j0=Symbol.for("com.tldraw.state/UNINITIALIZED"),Ha=n=>n===j0,R0=Uo("WithDiff",()=>class{constructor(n,e){this.value=n,this.diff=e}});function Vc(n,e){return new R0(n,e)}class ZO{constructor(e,t,r){y(this,"lastChangedEpoch",Os);y(this,"lastTraversedEpoch",Os);y(this,"lastCheckedEpoch",Os);y(this,"parents",[]);y(this,"parentEpochs",[]);y(this,"children",new SC);y(this,"historyBuffer");y(this,"state",j0);y(this,"computeDiff");y(this,"isEqual");this.name=e,this.derive=t,r!=null&&r.historyLength&&(this.historyBuffer=new xC(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??bC}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(){var t;const e=this.lastChangedEpoch===Os;if(!e&&(this.lastCheckedEpoch===ir()||!wC(this)))return this.lastCheckedEpoch=ir(),this.state;try{_C(this);const r=this.derive(this.state,this.lastCheckedEpoch),i=r instanceof R0?r.value:r;if(this.state===j0||!this.isEqual(i,this.state)){if(this.historyBuffer&&!e){const o=r instanceof R0?r.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,ir(),o??((t=this.computeDiff)==null?void 0:t.call(this,this.state,i,this.lastCheckedEpoch,ir()))??rr)}this.lastChangedEpoch=ir(),this.state=i}return this.lastCheckedEpoch=ir(),this.state}finally{kC()}}get(){const e=this.__unsafe__getWithoutCapture();return T0(this),e}getDiffSince(e){var t;return this.get(),e>=this.lastChangedEpoch?Gi:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??rr}}const O0=Uo("Computed",()=>ZO);function QO(n={},e,t,r){const i=r.value,o=Symbol.for("__@tldraw/state__computed__"+t);return r.value=function(){let s=this[o];return s||(s=new O0(t,i.bind(this),n),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r.value[tD]=!0,r}function EC(n={},e,t,r){return r.get?(JO(),eD(n,e,t,r)):QO(n,e,t,r)}function eD(n={},e,t,r){const i=r.get,o=Symbol.for("__@tldraw/state__computed__"+t);return r.get=function(){let s=this[o];return s||(s=new O0(t,i.bind(this),n),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r}const tD="@@__isComputedMethod__@@";function Q(){if(arguments.length===1){const n=arguments[0];return(e,t,r)=>EC(n,e,t,r)}else return typeof arguments[0]=="string"?new O0(arguments[0],arguments[1],arguments[2]):EC(void 0,arguments[0],arguments[1],arguments[2])}const IC=1;if(Uo("apiVersion",()=>IC)!==IC)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");function Xh(n,e){const t=re.useRef(e);t.current=e;const[r,i,o]=re.useMemo(()=>{let s=null;const a=c=>(s=c,()=>{s=null}),l=new Va(`useStateTracking(${n})`,()=>{var c;return(c=t.current)==null?void 0:c.call(t)},{scheduleEffect(){s==null||s()}});return[l,a,()=>l.scheduleCount]},[n]);return re.useSyncExternalStore(i,o,o),re.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const MC={apply(n,e,t){return Xh(n.displayName??n.name??"tracked(???)",()=>n.apply(e,t))}},nD=Symbol.for("react.memo"),rD=Symbol.for("react.forward_ref");function ze(n){let e=null;const t=n.$$typeof;return t===nD&&(n=n.type,e=n.compare),t===rD?v.memo(v.forwardRef(new Proxy(n.render,MC))):v.memo(new Proxy(n,MC),e)}function AC(){const n=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return v.useMemo(()=>Q(`useComputed(${n})`,e,t),r)}function Ds(n,e,t=Gi){v.useEffect(()=>{const r=new Va(n,e);return r.attach(),r.execute(),()=>{r.detach()}},t)}function q(){const n=arguments,e=n.length===3?n[2]:[n[0]],t=n.length===3?n[0]:`useValue(${n[0].name})`,r=v.useRef(!0);r.current=!0;const i=v.useMemo(()=>n.length===1?n[0]:Q(t,()=>{if(r.current)return n[1]();try{return n[1]()}catch{return{}}}),e);try{const{subscribe:o,getSnapshot:s}=v.useMemo(()=>({subscribe:a=>Uc(`useValue(${t})`,()=>{i.get(),a()}),getSnapshot:()=>i.get()}),[i]);return v.useSyncExternalStore(o,s,s)}finally{r.current=!1}}class qh{constructor(e){y(this,"nextValue");y(this,"diff");this.previousValue=e}get(){var r,i,o,s;const e=((i=(r=this.diff)==null?void 0:r.removed)==null?void 0:i.size)??0,t=((s=(o=this.diff)==null?void 0:o.added)==null?void 0:s.size)??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?(r=this.diff.removed)==null||r.delete(e):((i=this.diff).added??(i.added=new Set),this.diff.added.add(e))}add(e){var r,i,o;const t=this.previousValue.has(e);if(t)return(i=(r=this.diff)==null?void 0:r.removed)!=null&&i.has(e)?this._add(e,t):void 0;(o=this.nextValue)!=null&&o.has(e)||this._add(e,t)}_remove(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(i=this.diff.added)==null||i.delete(e)}remove(e){var r,i,o,s;const t=this.previousValue.has(e);if(!t)return(i=(r=this.diff)==null?void 0:r.added)!=null&&i.has(e)?this._remove(e,t):void 0;(s=(o=this.diff)==null?void 0:o.removed)!=null&&s.has(e)||this._remove(e,t)}}function Jh(n,e){const t=[];e:for(const r of n){for(const i of t)if(e?e(r,i):r===i)continue e;t.push(r)}return t}function me(n){return n.filter(e=>e!=null)}function Fn(n){return n[n.length-1]}function iD(n,e){let t,r=1/0;for(const i of n){const o=e(i);o<r&&(t=i,r=o)}return t}function oD(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Object.is(n[t],e[t]))return!1;return!0}function TC(n){const e=(...t)=>{try{return n(...t)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}function Wa(n,e){const t=e&&n&&typeof n=="object"&&e in n?n[e]:n;throw new Error(`Unknown switch case ${t}`)}const Ls=TC((n,e)=>{if(!n)throw new Error(e||"Assertion Error")}),sD=TC((n,e)=>{if(n==null)throw new Error(e??"value must be defined");return n});function jC(n,e){let t;const r=(...i)=>(t||(t={},t.promise=new Promise((o,s)=>{t.resolve=o,t.reject=s})),clearTimeout(t.timeout),t.latestArgs=i,t.timeout=setTimeout(()=>{const o=t;t=void 0;try{o.resolve(n(...o.latestArgs))}catch(s){o.reject(s)}},e),t.promise);return r.cancel=()=>{t&&clearTimeout(t.timeout)},r}const RC=new WeakMap;function D0(n,e){if(typeof n!="object"||n===null)return;let t=RC.get(n);t||(t={tags:{},extras:{}},RC.set(n,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}class aD{static async base64ToFile(e){return fetch(e).then(function(t){return t.arrayBuffer()})}static async fileToBase64(e){return await new Promise((t,r)=>{if(e){const i=new FileReader;i.readAsDataURL(e),i.onload=()=>t(i.result),i.onerror=o=>r(o),i.onabort=o=>r(o)}})}}function Zh(n){let e=0;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e+""}let L0=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(L0=new Int32Array(L0));const lD=(n,e)=>{let t=e===0?0:~~e^-1;for(let r=0;r<n.length;r++)t=L0[(t^n[r])&255]^t>>>8;return t^-1},OC=4,DC=4;class pi{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const r={};if(!pi.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const i=t,o=e.getInt32(t);t+=4;const s=pi.getChunkType(e,t);if(s==="IDAT"&&r[s]){t+=o+OC+DC;continue}if(s==="IEND")break;r[s]={start:i,dataOffset:t+4,size:o},t+=o+OC+DC}return r}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return pi.readChunks(e)[t]}static setPhysChunk(e,t=1,r){let i=46,o=0;const s=pi.findChunk(e,"pHYs");s&&(i=s.start,o=s.size);const a=pi.findChunk(e,"IDAT");a&&(i=a.start,o=0);const l=new ArrayBuffer(21),c=new DataView(l);c.setUint32(0,9),c.setUint8(4,"p".charCodeAt(0)),c.setUint8(5,"H".charCodeAt(0)),c.setUint8(6,"Y".charCodeAt(0)),c.setUint8(7,"s".charCodeAt(0));const d=2835.5;c.setInt32(8,d*t),c.setInt32(12,d*t),c.setInt8(16,1);const u=new Uint8Array(l.slice(4,17));c.setInt32(17,lD(u));const h=e.buffer.slice(0,i),p=e.buffer.slice(i+o);return new Blob([h,l,p],r)}}class LC{static async getVideoSizeFromSrc(e){return await new Promise((t,r)=>{const i=document.createElement("video");i.onloadeddata=()=>t({w:i.videoWidth,h:i.videoHeight}),i.onerror=o=>{console.error(o),r(new Error("Could not get video size"))},i.crossOrigin="anonymous",i.src=e})}static async getImageSizeFromSrc(e){return await new Promise((t,r)=>{const i=new Image;i.onload=async()=>{try{const o=await aD.base64ToFile(e),s=new DataView(o);if(pi.isPng(s,0)){const a=pi.findChunk(s,"pHYs");if(a){const l=pi.parsePhys(s,a.dataOffset);if(l.unit===0&&l.ppux===l.ppuy){const c=Math.max(l.ppux/2834.5,1);t({w:Math.round(i.width/c),h:Math.round(i.height/c)});return}}}t({w:i.width,h:i.height})}catch(o){console.error(o),t({w:i.width,h:i.height})}},i.onerror=o=>{console.error(o),r(new Error("Could not get image size"))},i.crossOrigin="anonymous",i.src=e})}}function Vo(n=""){let e=0,t=0,r=0,i=0;function o(){const s=e^e<<11;return e=t,t=r,r=i,i^=(i>>>19^s^s>>>8)>>>0,i/4294967296*2}for(let s=0;s<n.length+64;s++)e^=n.charCodeAt(s)|0,o();return o}function Qh(n,e,t,r=!1){const[i,o]=e,[s,a]=t,l=s+(n-i)/(o-i)*(a-s);return r?s<a?Math.max(Math.min(l,a),s):Math.max(Math.min(l,s),a):l}function ep(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function zs(n,e){if(ep(n,e))return n[e]}function ln(n){if(!n)return n;if(Array.isArray(n)){const e=[],t=n.length;for(let r=0;r<t;r++)e.push(ln(n[r]));return e}else if(typeof n=="object"){const e=Object.keys(n),t=e.length,r={};for(let i=0;i<t;i++){const o=e[i];r[o]=ln(n[o])}return r}return n}function zC(n){return Object.keys(n)}function _t(n){return Object.values(n)}function Yi(n){return Object.entries(n)}function NC(n){return Object.fromEntries(n)}function z0(n,e){const t={};let r=!1;for(const[i,o]of Yi(n))e(i,o)?t[i]=o:r=!0;return r?t:n}function FC(n,e){const t={};for(const[r,i]of Yi(n)){const o=e(r,i);t[r]=o}return t}function $C(n,e){if(n===e)return!0;const t=new Set(Object.keys(n)),r=new Set(Object.keys(e));if(t.size!==r.size)return!1;for(const i of t)if(!r.has(i)||!Object.is(n[i],e[i]))return!1;return!0}const cD=()=>typeof process<"u"&&!1,tp=[],dD=()=>{const n=tp.splice(0,tp.length);for(const e of n)e()};let N0;function uD(){N0||(N0=requestAnimationFrame(()=>{N0=void 0,dD()}))}function hD(n){if(cD())return n();tp.includes(n)||(tp.push(n),uD())}function pD(n,e){return n.id>e.id?1:-1}function fD(n){return n!==null}const Ho=typeof window<"u"&&window.structuredClone?window.structuredClone:n=>n&&JSON.parse(JSON.stringify(n));let np=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");class F0{constructor(e,t){y(this,"createDefaultProperties");y(this,"migrations");y(this,"validator");y(this,"scope");y(this,"isInstance",e=>(e==null?void 0:e.typeName)===this.typeName);this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.migrations=t.migrations,this.validator=t.validator??{validate:r=>r},this.scope=t.scope??"document"}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[r,i]of Object.entries(e))i!==void 0&&(t[r]=i);return t.typeName=this.typeName,t}clone(e){return{...Ho(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??np())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new F0(this.typeName,{createDefaultProperties:e,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(e){return this.validator.validate(e)}}function Xi(n,e){return new F0(n,{createDefaultProperties:()=>({}),migrations:e.migrations??{currentVersion:0,firstVersion:0,migrators:{}},validator:e.validator,scope:e.scope})}class BC{constructor(){y(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}var rp={exports:{}};rp.exports,function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,o=2,s=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",d="[object Boolean]",u="[object Date]",h="[object Error]",p="[object Function]",m="[object GeneratorFunction]",f="[object Map]",w="[object Number]",S="[object Null]",b="[object Object]",_="[object Promise]",x="[object Proxy]",P="[object RegExp]",C="[object Set]",E="[object String]",I="[object Symbol]",A="[object Undefined]",T="[object WeakMap]",D="[object ArrayBuffer]",F="[object DataView]",H="[object Float32Array]",O="[object Float64Array]",K="[object Int8Array]",B="[object Int16Array]",te="[object Int32Array]",W="[object Uint8Array]",N="[object Uint8ClampedArray]",Y="[object Uint16Array]",ee="[object Uint32Array]",pe=/[\\^$.*+?()[\]{}|]/g,ve=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,fe={};fe[H]=fe[O]=fe[K]=fe[B]=fe[te]=fe[W]=fe[N]=fe[Y]=fe[ee]=!0,fe[a]=fe[l]=fe[D]=fe[d]=fe[F]=fe[u]=fe[h]=fe[p]=fe[f]=fe[w]=fe[b]=fe[P]=fe[C]=fe[E]=fe[T]=!1;var Ce=typeof dt=="object"&&dt&&dt.Object===Object&&dt,Rt=typeof self=="object"&&self&&self.Object===Object&&self,Ue=Ce||Rt||Function("return this")(),Le=e&&!e.nodeType&&e,Ve=Le&&!0&&n&&!n.nodeType&&n,si=Ve&&Ve.exports===Le,Xn=si&&Ce.process,mr=function(){try{return Xn&&Xn.binding&&Xn.binding("util")}catch{}}(),Ot=mr&&mr.isTypedArray;function Et(j,z){for(var X=-1,se=j==null?0:j.length,ct=0,ke=[];++X<se;){var It=j[X];z(It,X,j)&&(ke[ct++]=It)}return ke}function bo(j,z){for(var X=-1,se=z.length,ct=j.length;++X<se;)j[ct+X]=z[X];return j}function Eu(j,z){for(var X=-1,se=j==null?0:j.length;++X<se;)if(z(j[X],X,j))return!0;return!1}function NS(j,z){for(var X=-1,se=Array(j);++X<j;)se[X]=z(X);return se}function FS(j){return function(z){return j(z)}}function $S(j,z){return j.has(z)}function Jl(j,z){return j==null?void 0:j[z]}function Ede(j){var z=-1,X=Array(j.size);return j.forEach(function(se,ct){X[++z]=[ct,se]}),X}function Ide(j,z){return function(X){return j(z(X))}}function Mde(j){var z=-1,X=Array(j.size);return j.forEach(function(se){X[++z]=se}),X}var Ade=Array.prototype,Tde=Function.prototype,dm=Object.prototype,BS=Ue["__core-js_shared__"],QR=Tde.toString,Li=dm.hasOwnProperty,e4=function(){var j=/[^.]+$/.exec(BS&&BS.keys&&BS.keys.IE_PROTO||"");return j?"Symbol(src)_1."+j:""}(),t4=dm.toString,jde=RegExp("^"+QR.call(Li).replace(pe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),n4=si?Ue.Buffer:void 0,um=Ue.Symbol,r4=Ue.Uint8Array,i4=dm.propertyIsEnumerable,Rde=Ade.splice,la=um?um.toStringTag:void 0,o4=Object.getOwnPropertySymbols,Ode=n4?n4.isBuffer:void 0,Dde=Ide(Object.keys,Object),US=Zl(Ue,"DataView"),Iu=Zl(Ue,"Map"),VS=Zl(Ue,"Promise"),HS=Zl(Ue,"Set"),WS=Zl(Ue,"WeakMap"),Mu=Zl(Object,"create"),Lde=ua(US),zde=ua(Iu),Nde=ua(VS),Fde=ua(HS),$de=ua(WS),s4=um?um.prototype:void 0,KS=s4?s4.valueOf:void 0;function ca(j){var z=-1,X=j==null?0:j.length;for(this.clear();++z<X;){var se=j[z];this.set(se[0],se[1])}}function Bde(){this.__data__=Mu?Mu(null):{},this.size=0}function Ude(j){var z=this.has(j)&&delete this.__data__[j];return this.size-=z?1:0,z}function Vde(j){var z=this.__data__;if(Mu){var X=z[j];return X===r?void 0:X}return Li.call(z,j)?z[j]:void 0}function Hde(j){var z=this.__data__;return Mu?z[j]!==void 0:Li.call(z,j)}function Wde(j,z){var X=this.__data__;return this.size+=this.has(j)?0:1,X[j]=Mu&&z===void 0?r:z,this}ca.prototype.clear=Bde,ca.prototype.delete=Ude,ca.prototype.get=Vde,ca.prototype.has=Hde,ca.prototype.set=Wde;function vo(j){var z=-1,X=j==null?0:j.length;for(this.clear();++z<X;){var se=j[z];this.set(se[0],se[1])}}function Kde(){this.__data__=[],this.size=0}function Gde(j){var z=this.__data__,X=pm(z,j);if(X<0)return!1;var se=z.length-1;return X==se?z.pop():Rde.call(z,X,1),--this.size,!0}function Yde(j){var z=this.__data__,X=pm(z,j);return X<0?void 0:z[X][1]}function Xde(j){return pm(this.__data__,j)>-1}function qde(j,z){var X=this.__data__,se=pm(X,j);return se<0?(++this.size,X.push([j,z])):X[se][1]=z,this}vo.prototype.clear=Kde,vo.prototype.delete=Gde,vo.prototype.get=Yde,vo.prototype.has=Xde,vo.prototype.set=qde;function da(j){var z=-1,X=j==null?0:j.length;for(this.clear();++z<X;){var se=j[z];this.set(se[0],se[1])}}function Jde(){this.size=0,this.__data__={hash:new ca,map:new(Iu||vo),string:new ca}}function Zde(j){var z=fm(this,j).delete(j);return this.size-=z?1:0,z}function Qde(j){return fm(this,j).get(j)}function eue(j){return fm(this,j).has(j)}function tue(j,z){var X=fm(this,j),se=X.size;return X.set(j,z),this.size+=X.size==se?0:1,this}da.prototype.clear=Jde,da.prototype.delete=Zde,da.prototype.get=Qde,da.prototype.has=eue,da.prototype.set=tue;function hm(j){var z=-1,X=j==null?0:j.length;for(this.__data__=new da;++z<X;)this.add(j[z])}function nue(j){return this.__data__.set(j,r),this}function rue(j){return this.__data__.has(j)}hm.prototype.add=hm.prototype.push=nue,hm.prototype.has=rue;function ms(j){var z=this.__data__=new vo(j);this.size=z.size}function iue(){this.__data__=new vo,this.size=0}function oue(j){var z=this.__data__,X=z.delete(j);return this.size=z.size,X}function sue(j){return this.__data__.get(j)}function aue(j){return this.__data__.has(j)}function lue(j,z){var X=this.__data__;if(X instanceof vo){var se=X.__data__;if(!Iu||se.length<t-1)return se.push([j,z]),this.size=++X.size,this;X=this.__data__=new da(se)}return X.set(j,z),this.size=X.size,this}ms.prototype.clear=iue,ms.prototype.delete=oue,ms.prototype.get=sue,ms.prototype.has=aue,ms.prototype.set=lue;function cue(j,z){var X=gm(j),se=!X&&kue(j),ct=!X&&!se&&GS(j),ke=!X&&!se&&!ct&&g4(j),It=X||se||ct||ke,Ht=It?NS(j.length,String):[],tn=Ht.length;for(var St in j)(z||Li.call(j,St))&&!(It&&(St=="length"||ct&&(St=="offset"||St=="parent")||ke&&(St=="buffer"||St=="byteLength"||St=="byteOffset")||bue(St,tn)))&&Ht.push(St);return Ht}function pm(j,z){for(var X=j.length;X--;)if(u4(j[X][0],z))return X;return-1}function due(j,z,X){var se=z(j);return gm(j)?se:bo(se,X(j))}function Au(j){return j==null?j===void 0?A:S:la&&la in Object(j)?yue(j):_ue(j)}function a4(j){return Tu(j)&&Au(j)==a}function l4(j,z,X,se,ct){return j===z?!0:j==null||z==null||!Tu(j)&&!Tu(z)?j!==j&&z!==z:uue(j,z,X,se,l4,ct)}function uue(j,z,X,se,ct,ke){var It=gm(j),Ht=gm(z),tn=It?l:ys(j),St=Ht?l:ys(z);tn=tn==a?b:tn,St=St==a?b:St;var yr=tn==b,ai=St==b,vn=tn==St;if(vn&&GS(j)){if(!GS(z))return!1;It=!0,yr=!1}if(vn&&!yr)return ke||(ke=new ms),It||g4(j)?c4(j,z,X,se,ct,ke):gue(j,z,tn,X,se,ct,ke);if(!(X&i)){var Rr=yr&&Li.call(j,"__wrapped__"),Or=ai&&Li.call(z,"__wrapped__");if(Rr||Or){var ws=Rr?j.value():j,So=Or?z.value():z;return ke||(ke=new ms),ct(ws,So,X,se,ke)}}return vn?(ke||(ke=new ms),mue(j,z,X,se,ct,ke)):!1}function hue(j){if(!f4(j)||Sue(j))return!1;var z=h4(j)?jde:ve;return z.test(ua(j))}function pue(j){return Tu(j)&&p4(j.length)&&!!fe[Au(j)]}function fue(j){if(!xue(j))return Dde(j);var z=[];for(var X in Object(j))Li.call(j,X)&&X!="constructor"&&z.push(X);return z}function c4(j,z,X,se,ct,ke){var It=X&i,Ht=j.length,tn=z.length;if(Ht!=tn&&!(It&&tn>Ht))return!1;var St=ke.get(j);if(St&&ke.get(z))return St==z;var yr=-1,ai=!0,vn=X&o?new hm:void 0;for(ke.set(j,z),ke.set(z,j);++yr<Ht;){var Rr=j[yr],Or=z[yr];if(se)var ws=It?se(Or,Rr,yr,z,j,ke):se(Rr,Or,yr,j,z,ke);if(ws!==void 0){if(ws)continue;ai=!1;break}if(vn){if(!Eu(z,function(So,ha){if(!$S(vn,ha)&&(Rr===So||ct(Rr,So,X,se,ke)))return vn.push(ha)})){ai=!1;break}}else if(!(Rr===Or||ct(Rr,Or,X,se,ke))){ai=!1;break}}return ke.delete(j),ke.delete(z),ai}function gue(j,z,X,se,ct,ke,It){switch(X){case F:if(j.byteLength!=z.byteLength||j.byteOffset!=z.byteOffset)return!1;j=j.buffer,z=z.buffer;case D:return!(j.byteLength!=z.byteLength||!ke(new r4(j),new r4(z)));case d:case u:case w:return u4(+j,+z);case h:return j.name==z.name&&j.message==z.message;case P:case E:return j==z+"";case f:var Ht=Ede;case C:var tn=se&i;if(Ht||(Ht=Mde),j.size!=z.size&&!tn)return!1;var St=It.get(j);if(St)return St==z;se|=o,It.set(j,z);var yr=c4(Ht(j),Ht(z),se,ct,ke,It);return It.delete(j),yr;case I:if(KS)return KS.call(j)==KS.call(z)}return!1}function mue(j,z,X,se,ct,ke){var It=X&i,Ht=d4(j),tn=Ht.length,St=d4(z),yr=St.length;if(tn!=yr&&!It)return!1;for(var ai=tn;ai--;){var vn=Ht[ai];if(!(It?vn in z:Li.call(z,vn)))return!1}var Rr=ke.get(j);if(Rr&&ke.get(z))return Rr==z;var Or=!0;ke.set(j,z),ke.set(z,j);for(var ws=It;++ai<tn;){vn=Ht[ai];var So=j[vn],ha=z[vn];if(se)var m4=It?se(ha,So,vn,z,j,ke):se(So,ha,vn,j,z,ke);if(!(m4===void 0?So===ha||ct(So,ha,X,se,ke):m4)){Or=!1;break}ws||(ws=vn=="constructor")}if(Or&&!ws){var mm=j.constructor,ym=z.constructor;mm!=ym&&"constructor"in j&&"constructor"in z&&!(typeof mm=="function"&&mm instanceof mm&&typeof ym=="function"&&ym instanceof ym)&&(Or=!1)}return ke.delete(j),ke.delete(z),Or}function d4(j){return due(j,Eue,wue)}function fm(j,z){var X=j.__data__;return vue(z)?X[typeof z=="string"?"string":"hash"]:X.map}function Zl(j,z){var X=Jl(j,z);return hue(X)?X:void 0}function yue(j){var z=Li.call(j,la),X=j[la];try{j[la]=void 0;var se=!0}catch{}var ct=t4.call(j);return se&&(z?j[la]=X:delete j[la]),ct}var wue=o4?function(j){return j==null?[]:(j=Object(j),Et(o4(j),function(z){return i4.call(j,z)}))}:Iue,ys=Au;(US&&ys(new US(new ArrayBuffer(1)))!=F||Iu&&ys(new Iu)!=f||VS&&ys(VS.resolve())!=_||HS&&ys(new HS)!=C||WS&&ys(new WS)!=T)&&(ys=function(j){var z=Au(j),X=z==b?j.constructor:void 0,se=X?ua(X):"";if(se)switch(se){case Lde:return F;case zde:return f;case Nde:return _;case Fde:return C;case $de:return T}return z});function bue(j,z){return z=z??s,!!z&&(typeof j=="number"||be.test(j))&&j>-1&&j%1==0&&j<z}function vue(j){var z=typeof j;return z=="string"||z=="number"||z=="symbol"||z=="boolean"?j!=="__proto__":j===null}function Sue(j){return!!e4&&e4 in j}function xue(j){var z=j&&j.constructor,X=typeof z=="function"&&z.prototype||dm;return j===X}function _ue(j){return t4.call(j)}function ua(j){if(j!=null){try{return QR.call(j)}catch{}try{return j+""}catch{}}return""}function u4(j,z){return j===z||j!==j&&z!==z}var kue=a4(function(){return arguments}())?a4:function(j){return Tu(j)&&Li.call(j,"callee")&&!i4.call(j,"callee")},gm=Array.isArray;function Cue(j){return j!=null&&p4(j.length)&&!h4(j)}var GS=Ode||Mue;function Pue(j,z){return l4(j,z)}function h4(j){if(!f4(j))return!1;var z=Au(j);return z==p||z==m||z==c||z==x}function p4(j){return typeof j=="number"&&j>-1&&j%1==0&&j<=s}function f4(j){var z=typeof j;return j!=null&&(z=="object"||z=="function")}function Tu(j){return j!=null&&typeof j=="object"}var g4=Ot?FS(Ot):pue;function Eue(j){return Cue(j)?cue(j):fue(j)}function Iue(){return[]}function Mue(){return!1}n.exports=Pue}(rp,rp.exports);var gD=rp.exports;const mD=qn(gD);function yD(n){if(n.length===0)return new Set;const e=n[0],t=n.slice(1),r=new Set;for(const i of e)t.every(o=>o.has(i))&&r.add(i);return r}function wD(n,e){const t={};for(const r of e)n.has(r)||(t.added??(t.added=new Set),t.added.add(r));for(const r of n)e.has(r)||(t.removed??(t.removed=new Set),t.removed.add(r));return t.added||t.removed?t:void 0}function UC(n,e){for(const[t,r]of Object.entries(n)){const i=r,o=e[t];if("eq"in i&&o!==i.eq||"neq"in i&&o===i.neq||"gt"in i&&(typeof o!="number"||o<=i.gt))return!1}return!0}function VC(n,e,t){const r=Object.fromEntries(Object.keys(t).map(i=>[i,new Set]));for(const[i,o]of Object.entries(t))if("eq"in o){const s=n.index(e,i).get().get(o.eq);if(s)for(const a of s)r[i].add(a)}else if("neq"in o){const s=n.index(e,i);for(const[a,l]of s.get())if(a!==o.neq)for(const c of l)r[i].add(c)}else if("gt"in o){const s=n.index(e,i);for(const[a,l]of s.get())if(a>o.gt)for(const c of l)r[i].add(c)}return yD(Object.values(r))}class bD{constructor(e,t){y(this,"indexCache",new Map);y(this,"historyCache",new Map);this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=Q("filterHistory:"+e,(r,i)=>{if(Ha(r))return this.history.get();const o=this.history.getDiffSince(i);if(o===rr)return this.history.get();const s={added:{},removed:{},updated:{}};let a=0,l=0,c=0;for(const d of o){for(const u of _t(d.added))if(u.typeName===e)if(s.removed[u.id]){const h=s.removed[u.id];delete s.removed[u.id],l--,h!==u&&(s.updated[u.id]=[h,u],c++)}else s.added[u.id]=u,a++;for(const[u,h]of _t(d.updated))h.typeName===e&&(s.added[h.id]?s.added[h.id]=h:s.updated[h.id]?s.updated[h.id]=[s.updated[h.id][0],h]:(s.updated[h.id]=[u,h],c++));for(const u of _t(d.removed))u.typeName===e&&(s.added[u.id]?(delete s.added[u.id],a--):s.updated[u.id]?(s.removed[u.id]=s.updated[u.id][0],delete s.updated[u.id],c--,l++):(s.removed[u.id]=u,l++))}return a||l||c?Vc(this.history.get(),s):r},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const r=e+":"+t;if(this.indexCache.has(r))return this.indexCache.get(r);const i=this.__uncached_createIndex(e,t);return this.indexCache.set(r,i),i}__uncached_createIndex(e,t){const r=this.filterHistory(e),i=()=>{r.get();const o=new Map;for(const s of _t(this.atoms.get())){const a=s.get();if(a.typeName===e){const l=a[t];o.has(l)||o.set(l,new Set),o.get(l).add(a.id)}}return o};return Q("index:"+e+":"+t,(o,s)=>{if(Ha(o))return i();const a=r.getDiffSince(s);if(a===rr)return i();const l=new Map,c=(p,m)=>{let f=l.get(p);f||(f=new qh(o.get(p)??new Set)),f.add(m),l.set(p,f)},d=(p,m)=>{let f=l.get(p);f||(f=new qh(o.get(p)??new Set)),f.remove(m),l.set(p,f)};for(const p of a){for(const m of _t(p.added))if(m.typeName===e){const f=m[t];c(f,m.id)}for(const[m,f]of _t(p.updated))if(f.typeName===e){const w=m[t],S=f[t];w!==S&&(d(w,f.id),c(S,f.id))}for(const m of _t(p.removed))if(m.typeName===e){const f=m[t];d(f,m.id)}}let u,h;for(const[p,m]of l){const f=m.get();f&&(u||(u=new Map(o)),h||(h=new Map),f.value.size===0?u.delete(p):u.set(p,f.value),h.set(p,f.diff))}return u&&h?Vc(u,h):o},{historyLength:100})}record(e,t=()=>({}),r="record:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,r);return Q(r,()=>{var o;for(const s of i.get())return(o=this.atoms.get()[s])==null?void 0:o.get()})}records(e,t=()=>({}),r="records:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,"ids:"+r);return Q(r,()=>[...i.get()].map(o=>{const s=this.atoms.get()[o];if(!s)throw new Error("no atom found for record id: "+o);return s.get()}))}ids(e,t=()=>({}),r="ids:"+e+(t?":"+t.toString():"")){const i=this.filterHistory(e),o=()=>{i.get();const l=t();return Object.keys(l).length===0?new Set(_t(this.atoms.get()).flatMap(c=>{const d=c.get();return d.typeName===e?d.id:[]})):VC(this,e,l)},s=l=>{const c=o(),d=wD(l,c);return d?Vc(c,d):l},a=Q("ids_query:"+r,t,{isEqual:mD});return Q("query:"+r,(l,c)=>{const d=a.get();if(Ha(l))return o();if(c<a.lastChangedEpoch)return s(l);const u=i.getDiffSince(c);if(u===rr)return s(l);const h=new qh(l);for(const m of u){for(const f of _t(m.added))f.typeName===e&&UC(d,f)&&h.add(f.id);for(const[f,w]of _t(m.updated))w.typeName===e&&(UC(d,w)?h.add(w.id):h.remove(w.id));for(const f of _t(m.removed))f.typeName===e&&h.remove(f.id)}const p=h.get();return p?Vc(p.value,p.diff):l},{historyLength:50})}exec(e,t){const r=VC(this,e,t);if(r.size===0)return Gi;const i=this.atoms.get();return[...r].map(o=>i[o].get())}}class HC{constructor(e){y(this,"id",np());y(this,"atoms",Cn("store_atoms",{}));y(this,"history",Cn("history",0,{historyLength:1e3}));y(this,"query",new bD(this.atoms,this.history));y(this,"listeners",new Set);y(this,"historyAccumulator",new SD);y(this,"historyReactor");y(this,"schema");y(this,"props");y(this,"scopedTypes");y(this,"onBeforeCreate");y(this,"onAfterCreate");y(this,"onBeforeChange");y(this,"onAfterChange");y(this,"onBeforeDelete");y(this,"onAfterDelete");y(this,"_runCallbacks",!0);y(this,"put",(e,t)=>{Ur(()=>{const r={},i={},o=this.atoms.__unsafe__getWithoutCapture();let s=null,a,l=!1;const c=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,d=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,u=this.isMergingRemoteChanges?"remote":"user";for(let h=0,p=e.length;h<p;h++){a=e[h];const m=(s??o)[a.id];if(m){const f=m.__unsafe__getWithoutCapture();d&&(a=d(f,a,u)),a=this.schema.validateRecord(this,a,t??"updateRecord",f),m.set(a);const w=m.__unsafe__getWithoutCapture();f!==w&&(l=!0,r[a.id]=[f,w])}else c&&(a=c(a,u)),l=!0,a=this.schema.validateRecord(this,a,t??"createRecord",null),i[a.id]=a,s||(s={...o}),s[a.id]=Cn("atom:"+a.id,a)}if(s&&this.atoms.set(s),!!l&&(this.updateHistory({added:i,updated:r,removed:{}}),this._runCallbacks)){const{onAfterCreate:h,onAfterChange:p}=this;h&&Object.values(i).forEach(m=>{h(m,u)}),p&&Object.values(r).forEach(([m,f])=>{p(m,f,u)})}})});y(this,"remove",e=>{Ur(()=>{const t=[],r=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(const o of e){const s=this.atoms.__unsafe__getWithoutCapture()[o];s&&this.onBeforeDelete(s.get(),r)===!1&&t.push(o)}let i;if(this.atoms.update(o=>{let s;for(const a of e)t.includes(a)||a in o&&(s||(s={...o}),i||(i={}),delete s[a],i[a]=o[a].get());return s??o}),!!i&&(this.updateHistory({added:{},updated:{},removed:i}),this.onAfterDelete&&this._runCallbacks)){let o;for(let s=0,a=e.length;s<a;s++)o=i[e[s]],o&&this.onAfterDelete(o,r)}})});y(this,"get",e=>{var t;return(t=this.atoms.get()[e])==null?void 0:t.get()});y(this,"unsafeGetWithoutCapture",e=>{var t;return(t=this.atoms.get()[e])==null?void 0:t.__unsafe__getWithoutCapture()});y(this,"serialize",(e="document")=>{const t={};for(const[r,i]of Yi(this.atoms.get())){const o=i.get();(e==="all"||this.scopedTypes[e].has(o.typeName))&&(t[r]=o)}return t});y(this,"allRecords",()=>_t(this.atoms.get()).map(e=>e.get()));y(this,"clear",()=>{this.remove(zC(this.atoms.get()))});y(this,"update",(e,t)=>{const r=this.atoms.get()[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(r.__unsafe__getWithoutCapture())])});y(this,"has",e=>!!this.atoms.get()[e]);y(this,"listen",(e,t)=>{this._flushHistory();const r={onHistory:e,filters:{source:(t==null?void 0:t.source)??"all",scope:(t==null?void 0:t.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}});y(this,"isMergingRemoteChanges",!1);y(this,"mergeRemoteChanges",e=>{if(this.isMergingRemoteChanges)return e();try{this.isMergingRemoteChanges=!0,Ur(e)}finally{this.isMergingRemoteChanges=!1}});y(this,"createComputedCache",(e,t,r)=>{const i=new BC;return{get:o=>{const s=this.atoms.get()[o];if(s)return i.get(s,()=>{const a=r?Q(s.name+":equals",()=>s.get(),{isEqual:r}):s;return Q(e+":"+o,()=>t(a.get()))}).get()}}});y(this,"createSelectedComputedCache",(e,t,r)=>{const i=new BC;return{get:o=>{const s=this.atoms.get()[o];if(!s)return;const a=Q(e+":"+o+":selector",()=>t(s.get()));return i.get(s,()=>Q(e+":"+o,()=>r(a.get()))).get()}}});y(this,"getRecordType",e=>{const t=this.schema.types[e.typeName];if(!t)throw new Error(`Record type ${e.typeName} not found`);return t});y(this,"_integrityChecker");y(this,"_isPossiblyCorrupted",!1);const{initialData:t,schema:r}=e;this.schema=r,this.props=e.props,t&&this.atoms.set(NC(Yi(t).map(([i,o])=>[i,Cn("atom:"+i,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=HO("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:i=>hD(i)}),this.scopedTypes={document:new Set(_t(this.schema.types).filter(i=>i.scope==="document").map(i=>i.typeName)),session:new Set(_t(this.schema.types).filter(i=>i.scope==="session").map(i=>i.typeName)),presence:new Set(_t(this.schema.types).filter(i=>i.scope==="presence").map(i=>i.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:r}of e){let i=null,o=null,s=null;for(const{onHistory:a,filters:l}of this.listeners)if(!(l.source!=="all"&&l.source!==r))if(l.scope!=="all")if(l.scope==="document"){if(o??(o=this.filterChangesByScope(t,"document")),!o)continue;a({changes:o,source:r})}else if(l.scope==="session"){if(i??(i=this.filterChangesByScope(t,"session")),!i)continue;a({changes:i,source:r})}else{if(s??(s=this.filterChangesByScope(t,"presence")),!s)continue;a({changes:s,source:r})}else a({changes:t,source:r})}}}filterChangesByScope(e,t){const r={added:z0(e.added,(i,o)=>this.scopedTypes[t].has(o.typeName)),updated:z0(e.updated,(i,o)=>this.scopedTypes[t].has(o[1].typeName)),removed:z0(e.removed,(i,o)=>this.scopedTypes[t].has(o.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}getSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);Ur(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}extractingChanges(e){const t=[],r=this.historyAccumulator.intercepting(i=>t.push(i.changes));try{return Ur(e),ip(t)}finally{r()}}applyDiff(e,t=!0){const r=this._runCallbacks;try{this._runCallbacks=t,Ur(()=>{const i=_t(e.added).concat(_t(e.updated).map(([s,a])=>a)),o=zC(e.removed);i.length&&this.put(i),o.length&&this.remove(o)})}finally{this._runCallbacks=r}}ensureStoreIsUsable(){var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}}function ip(n){const e={added:{},removed:{},updated:{}};for(const t of n){for(const[r,i]of Yi(t.added))if(e.removed[r]){const o=e.removed[r];delete e.removed[r],o!==i&&(e.updated[r]=[o,i])}else e.added[r]=i;for(const[r,[i,o]]of Yi(t.updated)){if(e.added[r]){e.added[r]=o,delete e.updated[r],delete e.removed[r];continue}if(e.updated[r]){e.updated[r]=[e.updated[r][0],o],delete e.removed[r];continue}e.updated[r]=t.updated[r],delete e.removed[r]}for(const[r,i]of Yi(t.removed))e.added[r]?delete e.added[r]:e.updated[r]?(e.removed[r]=e.updated[r][0],delete e.updated[r]):e.removed[r]=i}return e}function vD(n){const e=[];let t=n[0],r;for(let i=1,o=n.length;i<o;i++)r=n[i],t.source!==r.source?(e.push(t),t=r):t={source:t.source,changes:ip([t.changes,r.changes])};return e.push(t),e}class SD{constructor(){y(this,"_history",[]);y(this,"_interceptors",new Set)}intercepting(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=vD(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function xD(n){return typeof n=="object"&&n!==null&&"id"in n&&"typeName"in n}function Ne(n){const{currentVersion:e,firstVersion:t,migrators:r={},subTypeKey:i,subTypeMigrations:o}=n;if(typeof e=="number"&&typeof t=="number"){if(e===t)throw Error("Current version is equal to initial version.");if(e<t)throw Error("Current version is lower than initial version.")}return{firstVersion:t??0,currentVersion:e??0,migrators:r,subTypeKey:i,subTypeMigrations:o}}var Hc=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(Hc||{});function WC({record:n,migrations:e,fromVersion:t,toVersion:r}){let i=t;if(!xD(n))throw new Error("[migrateRecord] object is not a record");const{typeName:o,id:s,...a}=n;let l=a;for(;i<r;){const c=i+1,d=e.migrators[c];if(!d)return{type:"error",reason:"target-version-too-new"};l=d.up(l),i=c}for(;i>r;){const c=i-1,d=e.migrators[i];if(!d)return{type:"error",reason:"target-version-too-old"};l=d.down(l),i=c}return{type:"success",value:{...l,id:s,typeName:o}}}function $0({value:n,migrations:e,fromVersion:t,toVersion:r}){let i=t;for(;i<r;){const o=i+1,s=e.migrators[o];if(!s)return{type:"error",reason:"target-version-too-new"};n=s.up(n),i=o}for(;i>r;){const o=i-1,s=e.migrators[i];if(!s)return{type:"error",reason:"target-version-too-old"};n=s.down(n),i=o}return{type:"success",value:n}}class B0{constructor(e,t){this.types=e,this.options=t}static create(e,t){return new B0(e,t??{})}get currentStoreVersion(){var e;return((e=this.options.snapshotMigrations)==null?void 0:e.currentVersion)??0}validateRecord(e,t,r,i){try{const o=zs(this.types,t.typeName);if(!o)throw new Error(`Missing definition for record type ${t.typeName}`);return o.validate(t)}catch(o){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:r,recordBefore:i,error:o});throw o}}migratePersistedRecord(e,t,r="up"){var u;const i=zs(this.types,e.typeName),o=t.recordVersions[e.typeName];if(!o||!i)return{type:"error",reason:Hc.UnknownType};const s=i.migrations.currentVersion,a=o.version;if(s!==a){const h=WC(r==="up"?{record:e,migrations:i.migrations,fromVersion:a,toVersion:s}:{record:e,migrations:i.migrations,fromVersion:s,toVersion:a});if(h.type==="error")return h;e=h.value}if(!i.migrations.subTypeKey)return{type:"success",value:e};const l=(u=i.migrations.subTypeMigrations)==null?void 0:u[e[i.migrations.subTypeKey]],c="subTypeVersions"in o?o.subTypeVersions[e[i.migrations.subTypeKey]]:void 0;if(l===void 0)return{type:"error",reason:Hc.UnrecognizedSubtype};if(c===void 0)return{type:"error",reason:Hc.IncompatibleSubtype};const d=WC(r==="up"?{record:e,migrations:l,fromVersion:c,toVersion:l.currentVersion}:{record:e,migrations:l,fromVersion:l.currentVersion,toVersion:c});return d.type==="error"?d:{type:"success",value:d.value}}migrateStoreSnapshot(e){let{store:t}=e;const r=this.options.snapshotMigrations;if(!r)return{type:"success",value:t};const i=r.currentVersion,o=e.schema.storeVersion??0;if(i<o)return{type:"error",reason:Hc.TargetVersionTooOld};if(i>o){const a=$0({value:t,migrations:r,fromVersion:o,toVersion:i});if(a.type==="error")return a;t=a.value}const s=[];for(const a of _t(t)){const l=this.migratePersistedRecord(a,e.schema);if(l.type==="error")return l;l.value&&l.value!==a&&s.push(l.value)}if(s.length){t={...t};for(const a of s)t[a.id]=a}return{type:"success",value:t}}createIntegrityChecker(e){var t,r;return((r=(t=this.options).createIntegrityChecker)==null?void 0:r.call(t,e))??void 0}serialize(){var e;return{schemaVersion:1,storeVersion:((e=this.options.snapshotMigrations)==null?void 0:e.currentVersion)??0,recordVersions:Object.fromEntries(_t(this.types).map(t=>[t.typeName,t.migrations.subTypeKey&&t.migrations.subTypeMigrations?{version:t.migrations.currentVersion,subTypeKey:t.migrations.subTypeKey,subTypeVersions:t.migrations.subTypeMigrations?Object.fromEntries(Object.entries(t.migrations.subTypeMigrations).map(([r,i])=>[r,i.currentVersion])):void 0}:{version:t.migrations.currentVersion}]))}}serializeEarliestVersion(){var e;return{schemaVersion:1,storeVersion:((e=this.options.snapshotMigrations)==null?void 0:e.firstVersion)??0,recordVersions:Object.fromEntries(_t(this.types).map(t=>[t.typeName,t.migrations.subTypeKey&&t.migrations.subTypeMigrations?{version:t.migrations.firstVersion,subTypeKey:t.migrations.subTypeKey,subTypeVersions:t.migrations.subTypeMigrations?Object.fromEntries(Object.entries(t.migrations.subTypeMigrations).map(([r,i])=>[r,i.firstVersion])):void 0}:{version:t.migrations.firstVersion}]))}}}const _D=(n,e)=>{if(n.schemaVersion>e.schemaVersion)return 1;if(n.schemaVersion<e.schemaVersion)return-1;if(n.storeVersion>e.storeVersion)return 1;if(n.storeVersion<e.storeVersion)return-1;for(const t of Object.keys(n.recordVersions)){const r=n.recordVersions[t],i=e.recordVersions[t];if(r.version>i.version)return 1;if(r.version<i.version)return-1;if("subTypeVersions"in r&&!("subTypeVersions"in i))return 1;if(!("subTypeVersions"in r)&&"subTypeVersions"in i)return-1;if(!(!("subTypeVersions"in r)||!("subTypeVersions"in i)))for(const o of Object.keys(r.subTypeVersions)){const s=r.subTypeVersions[o],a=i.subTypeVersions[o];if(s>a)return 1;if(s<a)return-1}}return 0};function kD(n){if(!n.length)return null;let e="";for(const t of n)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e.startsWith(".")?e.slice(1):e}class Ze extends Error{constructor(t,r=[]){const i=kD(r),o=t.split(`
`).map((s,a)=>a===0?s:`  ${s}`).join(`
`);super(r?`At ${i}: ${o}`:o);y(this,"name","ValidationError");this.rawMessage=t,this.path=r}}function Ka(n,e){try{return e()}catch(t){throw t instanceof Ze?new Ze(t.rawMessage,[n,...t.path]):new Ze(t.toString(),[n])}}function Ga(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const e=typeof n;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:Wa(e)}}class Pn{constructor(e){this.validationFn=e}validate(e){return this.validationFn(e)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return AD(this)}optional(){return GC(this)}refine(e){return new Pn(t=>e(this.validate(t)))}check(e,t){return typeof e=="string"?this.refine(r=>(Ka(`(check ${e})`,()=>t(r)),r)):this.refine(r=>(e(r),r))}}class CD extends Pn{constructor(e){super(t=>{const r=MD.validate(t);for(let i=0;i<r.length;i++)Ka(i,()=>e.validate(r[i]));return r}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Ze("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Ze("Expected an array with length greater than 1")})}}class op extends Pn{constructor(e,t=!1){super(r=>{if(typeof r!="object"||r===null)throw new Ze(`Expected object, got ${Ga(r)}`);for(const[i,o]of Object.entries(e))Ka(i,()=>{o.validate(zs(r,i))});if(!t){for(const i of Object.keys(r))if(!ep(e,i))throw new Ze("Unexpected property",[i])}return r}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new op(this.config,!0)}extend(e){return new op({...this.config,...e})}}class U0 extends Pn{constructor(e,t,r){super(i=>{if(typeof i!="object"||i===null)throw new Ze(`Expected an object, got ${Ga(i)}`,[]);const o=zs(i,e);if(typeof o!="string")throw new Ze(`Expected a string for key "${e}", got ${Ga(o)}`);const s=ep(t,o)?t[o]:void 0;return s===void 0?this.unknownValueValidation(i,o):Ka(`(${e} = ${o})`,()=>s.validate(i))}),this.key=e,this.config=t,this.unknownValueValidation=r}validateUnknownVariants(e){return new U0(this.key,this.config,e)}}class PD extends Pn{constructor(e,t){super(r=>{if(typeof r!="object"||r===null)throw new Ze(`Expected object, got ${Ga(r)}`);for(const[i,o]of Object.entries(r))Ka(i,()=>{e.validate(i),t.validate(o)});return r}),this.keyValidator=e,this.valueValidator=t}}function V0(n){return new Pn(e=>{if(typeof e!==n)throw new Ze(`Expected ${n}, got ${Ga(e)}`);return e})}const ED=new Pn(n=>n),Se=V0("string"),we=V0("number").check(n=>{if(Number.isNaN(n))throw new Ze("Expected a number, got NaN");if(!Number.isFinite(n))throw new Ze(`Expected a finite number, got ${n}`)}),H0=we.check(n=>{if(n<0)throw new Ze(`Expected a positive number, got ${n}`)}),$n=we.check(n=>{if(n<=0)throw new Ze(`Expected a non-zero positive number, got ${n}`)}),KC=we.check(n=>{if(!Number.isInteger(n))throw new Ze(`Expected an integer, got ${n}`)}),sp=KC.check(n=>{if(n<0)throw new Ze(`Expected a positive integer, got ${n}`)}),ID=KC.check(n=>{if(n<=0)throw new Ze(`Expected a non-zero positive integer, got ${n}`)}),Ee=V0("boolean");function Bn(n){return new Pn(e=>{if(e!==n)throw new Ze(`Expected ${n}, got ${JSON.stringify(e)}`);return n})}const MD=new Pn(n=>{if(!Array.isArray(n))throw new Ze(`Expected an array, got ${Ga(n)}`);return n});function En(n){return new CD(n)}function Me(n){return new op(n)}function W0(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(W0):typeof n=="object"?Object.values(n).every(W0):!1}const fi=new Pn(n=>{if(W0(n))return n;throw new Ze(`Expected json serializable value, got ${typeof n}`)});function K0(n,e){return new PD(n,e)}function G0(n,e){return new U0(n,e,(t,r)=>{throw new Ze(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[n])})}function qi(n,e){return new Pn(t=>{const r=t&&typeof t=="object"&&"id"in t&&typeof t.id=="string"?`${n}(id = ${t.id})`:n;return Ka(r,()=>e.validate(t))})}function Wc(n){return new Pn(e=>{if(!n.has(e)){const t=Array.from(n,r=>JSON.stringify(r)).join(" or ");throw new Ze(`Expected ${t}, got ${e}`)}return e})}function GC(n){return new Pn(e=>{if(e!==void 0)return n.validate(e)})}function AD(n){return new Pn(e=>e===null?null:n.validate(e))}function YC(...n){return Wc(new Set(n))}function XC(n){try{return new URL(n)}catch{throw new Ze(`Expected a valid url, got ${JSON.stringify(n)}`)}}const TD=new Set(["http:","https:","mailto:"]),or=Se.check(n=>{if(n==="")return;const e=XC(n);if(!TD.has(e.protocol.toLowerCase()))throw new Ze(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),jD=new Set(["http:","https:","data:"]),Ya=Se.check(n=>{if(n==="")return;const e=XC(n);if(!jD.has(e.protocol.toLowerCase()))throw new Ze(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});function Vr(n){return Se.refine(e=>{if(!e.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return e})}const ap=Vr("asset");function Y0(n,e){return Me({id:ap,typeName:Bn("asset"),type:Bn(n),props:e,meta:fi})}const RD=qi("camera",Me({typeName:Bn("camera"),id:Vr("camera"),x:we,y:we,z:we,meta:fi})),qC={AddMeta:1},OD=Ne({currentVersion:qC.AddMeta,migrators:{[qC.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),cn=Xi("camera",{validator:RD,migrations:OD,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),Kc=Me({x:we,y:we,z:we.optional()}),Gc=Me({x:we,y:we,w:we,h:we}),DD=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),JC=Wc(DD),LD=Me({type:JC,rotation:we}),ZC=we.check(n=>{if(n<0||n>1)throw new Ze("Opacity must be between 0 and 1")}),zD=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),ND=Wc(zD),FD=new Set(["starting","paused","active","stopping"]),QC=Me({id:Se,points:En(Kc),size:H0,color:ND,opacity:we,state:Wc(FD),delay:we,shrink:we,taper:Ee}),Yc=Vr("page"),$D=qi("page",Me({typeName:Bn("page"),id:Yc,name:Se,index:Se,meta:fi})),e2={AddMeta:1},BD=Ne({currentVersion:e2.AddMeta,migrators:{[e2.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),Ji=Xi("page",{validator:$D,migrations:BD,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Un(n){return Ji.isId(n)}Vr("instance");function UD(n){const e={};for(const[r,i]of n)e[r]=GC(i);const t=qi("instance",Me({typeName:Bn("instance"),id:Vr("instance"),currentPageId:Yc,followingUserId:Se.nullable(),brush:Gc.nullable(),opacityForNextShape:ZC,stylesForNextShape:Me(e),cursor:LD,scribbles:En(QC),isFocusMode:Ee,isDebugMode:Ee,isToolLocked:Ee,exportBackground:Ee,screenBounds:Gc,zoomBrush:Gc.nullable(),isPenMode:Ee,isGridMode:Ee,chatMessage:Se,isChatting:Ee,highlightedUserIds:En(Se),canMoveCamera:Ee,isFocused:Ee,devicePixelRatio:we,isCoarsePointer:Ee,isHoveringCanvas:Ee.nullable(),openMenus:En(Se),isChangingStyle:Ee,isReadonly:Ee,meta:fi}));return Xi("instance",{migrations:VD,validator:t,scope:"session"}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{}}))}const yt={AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22},VD=Ne({currentVersion:yt.AddScribbles,migrators:{[yt.AddTransparentExportBgs]:{up:n=>({...n,exportBackground:!0}),down:({exportBackground:n,...e})=>e},[yt.RemoveDialog]:{up:({dialog:n,...e})=>e,down:n=>({...n,dialog:null})},[yt.AddToolLockMode]:{up:n=>({...n,isToolLocked:!1}),down:({isToolLocked:n,...e})=>e},[yt.RemoveExtraPropsForNextShape]:{up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))}),down:n=>n},[yt.AddLabelColor]:{up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:{...n,labelColor:"black"}}),down:n=>{const{labelColor:e,...t}=n.propsForNextShape;return{...n,propsForNextShape:{...t}}}},[yt.AddFollowingUserId]:{up:n=>({...n,followingUserId:null}),down:({followingUserId:n,...e})=>e},[yt.RemoveAlignJustify]:{up:n=>{let e=n.propsForNextShape.align;return e==="justify"&&(e="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:e}}},down:n=>({...n})},[yt.AddZoom]:{up:n=>({...n,zoomBrush:null}),down:({zoomBrush:n,...e})=>e},[yt.AddVerticalAlign]:{up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}}),down:n=>{const{verticalAlign:e,...t}=n.propsForNextShape;return{...n,propsForNextShape:t}}},[yt.AddScribbleDelay]:{up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n},down:n=>{if(n.scribble!==null){const{delay:e,...t}=n.scribble;return{...n,scribble:t}}return{...n}}},[yt.RemoveUserId]:{up:({userId:n,...e})=>e,down:n=>({...n,userId:"user:none"})},[yt.AddIsPenModeAndIsGridMode]:{up:n=>({...n,isPenMode:!1,isGridMode:!1}),down:({isPenMode:n,isGridMode:e,...t})=>t},[yt.HoistOpacity]:{up:({propsForNextShape:{opacity:n,...e},...t})=>({...t,opacityForNextShape:Number(n??"1"),propsForNextShape:e}),down:({opacityForNextShape:n,...e})=>({...e,propsForNextShape:{...e.propsForNextShape,opacity:n<.175?"0.1":n<.375?"0.25":n<.625?"0.5":n<.875?"0.75":"1"}})},[yt.AddChat]:{up:n=>({...n,chatMessage:"",isChatting:!1}),down:({chatMessage:n,isChatting:e,...t})=>t},[yt.AddHighlightedUserIds]:{up:n=>({...n,highlightedUserIds:[]}),down:({highlightedUserIds:n,...e})=>e},[yt.ReplacePropsForNextShapeWithStylesForNextShape]:{up:({propsForNextShape:n,...e})=>({...e,stylesForNextShape:{}}),down:({stylesForNextShape:n,...e})=>({...e,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}})},[yt.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})},[yt.RemoveCursorColor]:{up:n=>{const{color:e,...t}=n.cursor;return{...n,cursor:t}},down:n=>({...n,cursor:{...n.cursor,color:"black"}})},[yt.AddLonelyProperties]:{up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:({canMoveCamera:n,isFocused:e,devicePixelRatio:t,isCoarsePointer:r,openMenus:i,isChangingStyle:o,isReadOnly:s,...a})=>({...a})},[yt.ReadOnlyReadonly]:{up:({isReadOnly:n,...e})=>({...e,isReadonly:n}),down:({isReadonly:n,...e})=>({...e,isReadOnly:n})},[yt.AddHoveringCanvas]:{up:n=>({...n,isHoveringCanvas:null}),down:({isHoveringCanvas:n,...e})=>({...e})},[yt.AddScribbles]:{up:({scribble:n,...e})=>({...e,scribbles:[]}),down:({scribbles:n,...e})=>({...e,scribble:null})}}}),In="instance:instance",HD=Se.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),Hr=Vr("shape");function WD(n,e,t){return Me({id:Hr,typeName:Bn("shape"),x:we,y:we,rotation:we,index:Se,parentId:HD,type:Bn(n),isLocked:Ee,opacity:ZC,props:e?Me(e):fi,meta:t?Me(t):fi})}const KD=qi("instance_page_state",Me({typeName:Bn("instance_page_state"),id:Vr("instance_page_state"),pageId:Yc,selectedShapeIds:En(Hr),hintingShapeIds:En(Hr),erasingShapeIds:En(Hr),hoveredShapeId:Hr.nullable(),editingShapeId:Hr.nullable(),croppingShapeId:Hr.nullable(),focusedGroupId:Hr.nullable(),meta:fi})),Xa={AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5},GD=Ne({currentVersion:Xa.RenamePropertiesAgain,migrators:{[Xa.AddCroppingId]:{up(n){return{...n,croppingShapeId:null}},down({croppingShapeId:n,...e}){return e}},[Xa.RemoveInstanceIdAndCameraId]:{up({instanceId:n,cameraId:e,...t}){return t},down(n){return{...n,instanceId:In,cameraId:cn.createId("void")}}},[Xa.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})},[Xa.RenameProperties]:{up:n=>{const{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=n;return{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}},down:n=>{const{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=n;return{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}}},[Xa.RenamePropertiesAgain]:{up:n=>{const{selectedIds:e,hintingIds:t,erasingIds:r,hoveredId:i,editingId:o,croppingShapeId:s,croppingId:a,focusLayerId:l,...c}=n;return{...c,selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s??a??null,focusedGroupId:l}},down:n=>{const{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=n;return{...l,selectedIds:e,hintingIds:t,erasingIds:r,hoveredId:i,editingId:o,croppingId:s,focusLayerId:a}}}}}),dn=Xi("instance_page_state",{migrations:GD,validator:KD,scope:"session"}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),YD=qi("pointer",Me({typeName:Bn("pointer"),id:Vr("pointer"),x:we,y:we,lastActivityTimestamp:we,meta:fi})),t2={AddMeta:1},XD=Ne({currentVersion:t2.AddMeta,migrators:{[t2.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),X0=Xi("pointer",{validator:YD,migrations:XD,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),lp=X0.createId("pointer"),qD=qi("instance_presence",Me({typeName:Bn("instance_presence"),id:Vr("instance_presence"),userId:Se,userName:Se,lastActivityTimestamp:we,followingUserId:Se.nullable(),cursor:Me({x:we,y:we,type:JC,rotation:we}),color:Se,camera:Me({x:we,y:we,z:we}),screenBounds:Gc,selectedShapeIds:En(Vr("shape")),currentPageId:Vr("page"),brush:Gc.nullable(),scribbles:En(QC),chatMessage:Se,meta:fi})),qa={AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5},JD=Ne({currentVersion:qa.RenameSelectedShapeIds,migrators:{[qa.AddScribbleDelay]:{up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n},down:n=>{if(n.scribble!==null){const{delay:e,...t}=n.scribble;return{...n,scribble:t}}return{...n}}},[qa.RemoveInstanceId]:{up:({instanceId:n,...e})=>e,down:n=>({...n,instanceId:In})},[qa.AddChatMessage]:{up:n=>({...n,chatMessage:""}),down:({chatMessage:n,...e})=>e},[qa.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})},[qa.RenameSelectedShapeIds]:{up:n=>{const{selectedShapeIds:e,...t}=n;return{selectedShapeIds:e,...t}},down:n=>{const{selectedShapeIds:e,...t}=n;return{selectedShapeIds:e,...t}}}}}),ZD=Xi("instance_presence",{migrations:JD,validator:qD,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),QD=qi("document",Me({typeName:Bn("document"),id:Bn("document:document"),gridSize:we,name:Se,meta:fi})),q0={AddName:1,AddMeta:2},eL=Ne({currentVersion:q0.AddMeta,migrators:{[q0.AddName]:{up:n=>({...n,name:""}),down:({name:n,...e})=>e},[q0.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),J0=Xi("document",{migrations:eL,validator:QD,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),Z0=J0.createId("document");function tL(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function n2(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}const nL=({error:n,phase:e,record:t,recordBefore:r})=>{throw D0(n,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?n2(Ho(r)):void 0,recordAfter:n2(Ho(t))}}),n};function rL(){return[Ji.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function iL(n){const e=n.query.ids("page"),t=()=>{if(!n.has(Z0))return n.put([J0.create({id:Z0,name:n.props.defaultName})]),t();if(!n.has(lp))return n.put([X0.create({id:lp})]),t();const r=e.get();if(r.size===0)return n.put(rL()),t();const i=()=>[...r].map(l=>n.get(l)).sort(tL)[0].id,o=n.get(In);if(o){if(!r.has(o.currentPageId))return n.put([{...o,currentPageId:i()}]),t()}else return n.put([n.schema.types.instance.create({id:In,currentPageId:i(),exportBackground:!0})]),t();const s=new Set,a=new Set;for(const l of r){const c=dn.createId(l);n.has(c)||s.add(c);const d=cn.createId(l);n.has(d)||a.add(d)}s.size>0&&n.put([...s].map(l=>dn.create({id:l,pageId:dn.parseId(l)}))),a.size>0&&n.put([...a].map(l=>cn.create({id:l})))};return t}const oL=Y0("bookmark",Me({title:Se,description:Se,image:Se,src:Ya.nullable()})),r2={MakeUrlsValid:1},sL=Ne({currentVersion:r2.MakeUrlsValid,migrators:{[r2.MakeUrlsValid]:{up:n=>{const e=n.props.src;return e&&!Ya.isValid(e)?{...n,props:{...n.props,src:""}}:n},down:n=>n}}}),aL=Y0("image",Me({w:we,h:we,name:Se,isAnimated:Ee,mimeType:Se.nullable(),src:Ya.nullable()})),cp={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},lL=Ne({currentVersion:cp.MakeUrlsValid,migrators:{[cp.AddIsAnimated]:{up:n=>({...n,props:{...n.props,isAnimated:!1}}),down:n=>{const{isAnimated:e,...t}=n.props;return{...n,props:t}}},[cp.RenameWidthHeight]:{up:n=>{const{width:e,height:t,...r}=n.props;return{...n,props:{w:e,h:t,...r}}},down:n=>{const{w:e,h:t,...r}=n.props;return{...n,props:{width:e,height:t,...r}}}},[cp.MakeUrlsValid]:{up:n=>{const e=n.props.src;return e&&!Ya.isValid(e)?{...n,props:{...n.props,src:""}}:n},down:n=>n}}}),cL=Y0("video",Me({w:we,h:we,name:Se,isAnimated:Ee,mimeType:Se.nullable(),src:Ya.nullable()})),dp={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},dL=Ne({currentVersion:dp.MakeUrlsValid,migrators:{[dp.AddIsAnimated]:{up:n=>({...n,props:{...n.props,isAnimated:!1}}),down:n=>{const{isAnimated:e,...t}=n.props;return{...n,props:t}}},[dp.RenameWidthHeight]:{up:n=>{const{width:e,height:t,...r}=n.props;return{...n,props:{w:e,h:t,...r}}},down:n=>{const{w:e,h:t,...r}=n.props;return{...n,props:{width:e,height:t,...r}}}},[dp.MakeUrlsValid]:{up:n=>{const e=n.props.src;return e&&!Ya.isValid(e)?{...n,props:{...n.props,src:""}}:n},down:n=>n}}}),uL=qi("asset",G0("type",{image:aL,video:cL,bookmark:oL})),i2={AddMeta:1},hL=Ne({subTypeKey:"type",subTypeMigrations:{image:lL,video:dL,bookmark:sL},currentVersion:i2.AddMeta,migrators:{[i2.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),Ns=Xi("asset",{migrations:hL,validator:uL,scope:"document"}).withDefaultProperties(()=>({meta:{}}));class un{constructor(e,t,r){this.id=e,this.defaultValue=t,this.type=r}static define(e,t){const{defaultValue:r,type:i=ED}=t;return new un(e,r,i)}static defineEnum(e,t){const{defaultValue:r,values:i}=t;return new pL(e,r,i)}validate(e){return this.type.validate(e)}}class pL extends un{constructor(e,t,r){super(e,t,YC(...r)),this.values=r}}const up={AddIsLocked:1,HoistOpacity:2,AddMeta:3},Q0=Ne({currentVersion:up.AddMeta,migrators:{[up.AddIsLocked]:{up:n=>({...n,isLocked:!1}),down:n=>{const{isLocked:e,...t}=n;return{...t}}},[up.HoistOpacity]:{up:({props:{opacity:n,...e},...t})=>({...t,opacity:Number(n??"1"),props:e}),down:({opacity:n,...e})=>({...e,props:{...e.props,opacity:n<.175?"0.1":n<.375?"0.25":n<.625?"0.5":n<.875?"0.75":"1"}})},[up.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}});function Fs(n){return n?n.typeName==="shape":!1}function kr(n){return n?n.startsWith("shape:"):!1}function tt(n){return`shape:${n??np()}`}function o2(n){const e=new Map;for(const[t,r]of Object.entries(n))if(r instanceof un){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,t)}return e}function fL(n){return Xi("shape",{migrations:Ne({currentVersion:Q0.currentVersion,firstVersion:Q0.firstVersion,migrators:Q0.migrators,subTypeKey:"type",subTypeMigrations:FC(n,(e,t)=>t.migrations??Ne({}))}),scope:"document",validator:qi("shape",G0("type",FC(n,(e,{props:t,meta:r})=>WD(e,t,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}const Xc={RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4},gL=Ne({currentVersion:Xc.RemoveUserDocument,migrators:{[Xc.RemoveCodeAndIconShapeTypes]:{up:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>t.typeName!=="shape"||t.type!=="icon"&&t.type!=="code")),down:n=>n},[Xc.AddInstancePresenceType]:{up:n=>n,down:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>t.typeName!=="instance_presence"))},[Xc.RemoveTLUserAndPresenceAndAddPointer]:{up:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>!t.typeName.match(/^(user|user_presence)$/))),down:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>t.typeName!=="pointer"))},[Xc.RemoveUserDocument]:{up:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>!t.typeName.match("user_document"))),down:n=>n}}});function mL({shapes:n}){const e=new Map;for(const i of _t(n))for(const o of o2(i.props??{}).keys()){if(e.has(o.id)&&e.get(o.id)!==o)throw new Error(`Multiple StyleProp instances with the same id: ${o.id}`);e.set(o.id,o)}const t=fL(n),r=UD(e);return B0.create({asset:Ns,camera:cn,document:J0,instance:r,instance_page_state:dn,page:Ji,shape:t,instance_presence:ZD,pointer:X0},{snapshotMigrations:gL,onValidationFailure:nL,createIntegrityChecker:iL})}const s2=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],hp={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"#f8f9fa",background:"#212529",solid:"#28292e",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4156be",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#3b7b5e",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#93989f",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#588fc9",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#599f57",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#c67877",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#b583c9",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#bf612e",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#aa3c37",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#873fa3",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#cba371",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function Vn(n){return n.isDarkMode?hp.darkMode:hp.lightMode}const Cr=un.defineEnum("tldraw:color",{defaultValue:"black",values:s2}),a2=un.defineEnum("tldraw:labelColor",{defaultValue:"black",values:s2}),$s=un.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Ja=un.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),gi=un.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),qc={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},mi=un.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),l2=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],pp=un.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:l2}),fp=un.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:l2}),c2=G0("type",{binding:Me({type:Bn("binding"),boundShapeId:Hr,normalizedAnchor:Kc,isExact:Ee,isPrecise:Ee}),point:Me({type:Bn("point"),x:we,y:we})}),yL={labelColor:a2,color:Cr,fill:Ja,dash:$s,size:mi,arrowheadStart:pp,arrowheadEnd:fp,font:gi,start:c2,end:c2,bend:we,text:Se},ew={AddLabelColor:1,AddIsPrecise:2},wL=Ne({currentVersion:ew.AddIsPrecise,migrators:{[ew.AddLabelColor]:{up:n=>({...n,props:{...n.props,labelColor:"black"}}),down:n=>{const{labelColor:e,...t}=n.props;return{...n,props:t}}},[ew.AddIsPrecise]:{up:n=>{const{start:e,end:t}=n.props;return{...n,props:{...n.props,start:e.type==="binding"?{...e,isPrecise:!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5)}:e,end:t.type==="binding"?{...t,isPrecise:!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5)}:t}}},down:n=>{const{start:e,end:t}=n.props,r={...e},i={...t};return r.type==="binding"&&(r.isPrecise||(r.normalizedAnchor={x:.5,y:.5}),delete r.isPrecise),i.type==="binding"&&(i.isPrecise||(i.normalizedAnchor={x:.5,y:.5}),delete i.isPrecise),{...n,props:{...n.props,start:r,end:i}}}}}}),bL={w:$n,h:$n,assetId:ap.nullable(),url:or},tw={NullAssetId:1,MakeUrlsValid:2},vL=Ne({currentVersion:tw.MakeUrlsValid,migrators:{[tw.NullAssetId]:{up:n=>n.props.assetId===void 0?{...n,props:{...n.props,assetId:null}}:n,down:n=>{if(n.props.assetId===null){const{assetId:e,...t}=n.props;return{...n,props:t}}return n}},[tw.MakeUrlsValid]:{up:n=>n.props.url!==""&&!or.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),d2=Me({type:YC("free","straight"),points:En(Kc)}),SL={color:Cr,fill:Ja,dash:$s,size:mi,segments:En(d2),isComplete:Ee,isClosed:Ee,isPen:Ee},u2={AddInPen:1},xL=Ne({currentVersion:u2.AddInPen,migrators:{[u2.AddInPen]:{up:n=>{const{points:e}=n.props.segments[0];if(e.length===0)return{...n,props:{...n.props,isPen:!1}};let t=!(e[0].z===0||e[0].z===.5);return e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),{...n,props:{...n.props,isPen:t}}},down:n=>{const{isPen:e,...t}=n.props;return{...n,props:{...t}}}}}}),h2=/(^\/r\/[^/]+\/?$)/,Xe=n=>{try{return new URL(n)}catch{return}},Za=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(h2))return n},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(h2))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{if(n.includes("/maps/")){const e=n.match(/@(.*),(.*),(.*)z/);let t;if(e){const[,r,i,o]=e;t=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${{}.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${o}`}else t="";return t}},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const t=e.searchParams.get("zoom"),[r,i]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${r},${i},${t}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Xe(n),t=e&&e.pathname.match(/\/v\/([^/]+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Xe(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Xe(n),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Xe(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=n.match(e);if(t){const[r,i,o]=t;return`https://codepen.io/${i}/embed/${o}`}},fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i,o]=t;return`https://codepen.io/${i}/pen/${o}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:n=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Xe(n);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.hostname.replace(/^www./,"")==="youtube.com"){const t=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(t)return`https://www.youtube.com/watch?v=${t[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:n=>{const e=Xe(n),t=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:n=>{const e=Xe(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Xe(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}},fromEmbedUrl:n=>{const e=Xe(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Xe(n);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Xe(n);if(e&&e.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:n=>{const e=Xe(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}}],_L={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},kL={w:$n,h:$n,url:Se},Jc={GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4},CL=Ne({currentVersion:Jc.RemovePermissionOverrides,migrators:{[Jc.GenOriginalUrlInEmbed]:{up:n=>{const e=n.props.url,t=new URL(e).host.replace("www.","");let r;for(const i of Za)if(i.hostnames.includes(t))try{r=i.fromEmbedUrl(e)}catch(o){console.warn(o)}return{...n,props:{...n.props,tmpOldUrl:n.props.url,url:r??""}}},down:n=>{let e=n.props.tmpOldUrl;if(!e||e===""){const i=n.props.url,o=new URL(i).host.replace("www.","");for(const s of Za)if(s.hostnames.includes(o))try{e=s.toEmbedUrl(i)}catch(a){console.warn(a)}}const{tmpOldUrl:t,...r}=n.props;return{...n,props:{...r,url:e??""}}}},[Jc.RemoveDoesResize]:{up:n=>{const{doesResize:e,...t}=n.props;return{...n,props:{...t}}},down:n=>({...n,props:{...n.props,doesResize:!0}})},[Jc.RemoveTmpOldUrl]:{up:n=>{const{tmpOldUrl:e,...t}=n.props;return{...n,props:{...t}}},down:n=>({...n,props:{...n.props}})},[Jc.RemovePermissionOverrides]:{up:n=>{const{overridePermissions:e,...t}=n.props;return{...n,props:{...t}}},down:n=>({...n,props:{...n.props}})}}}),PL={w:$n,h:$n,name:Se},EL=Ne({}),Zc=un.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),gp=un.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),yi=un.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),IL={geo:yi,labelColor:a2,color:Cr,fill:Ja,dash:$s,size:mi,font:gi,align:Zc,verticalAlign:gp,url:or,w:$n,h:$n,growY:H0,text:Se},Zi={AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8},ML=Ne({currentVersion:Zi.MakeUrlsValid,migrators:{[Zi.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[Zi.AddLabelColor]:{up:n=>({...n,props:{...n.props,labelColor:"black"}}),down:n=>{const{labelColor:e,...t}=n.props;return{...n,props:t}}},[Zi.RemoveJustify]:{up:n=>{let e=n.props.align;return e==="justify"&&(e="start"),{...n,props:{...n.props,align:e}}},down:n=>({...n})},[Zi.AddCheckBox]:{up:n=>({...n}),down:n=>({...n,props:{...n.props,geo:n.props.geo==="check-box"?"rectangle":n.props.geo}})},[Zi.AddVerticalAlign]:{up:n=>({...n,props:{...n.props,verticalAlign:"middle"}}),down:n=>{const{verticalAlign:e,...t}=n.props;return{...n,props:t}}},[Zi.MigrateLegacyAlign]:{up:n=>{let e;switch(n.props.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}return{...n,props:{...n.props,align:e}}},down:n=>{let e;switch(n.props.align){case"start-legacy":e="start";break;case"end-legacy":e="end";break;case"middle-legacy":e="middle";break;default:e=n.props.align}return{...n,props:{...n.props,align:e}}}},[Zi.AddCloud]:{up:n=>n,down:n=>{if(n.props.geo==="cloud")return{...n,props:{...n.props,geo:"rectangle"}}}},[Zi.MakeUrlsValid]:{up:n=>n.props.url!==""&&!or.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),AL={},TL=Ne({}),jL={color:Cr,size:mi,segments:En(d2),isComplete:Ee,isPen:Ee},RL=Ne({}),OL=Me({topLeft:Kc,bottomRight:Kc}),DL={w:$n,h:$n,playing:Ee,url:or,assetId:ap.nullable(),crop:OL.nullable()},mp={AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3},LL=Ne({currentVersion:mp.MakeUrlsValid,migrators:{[mp.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[mp.AddCropProp]:{up:n=>({...n,props:{...n.props,crop:null}}),down:n=>{const{crop:e,...t}=n.props;return{...n,props:t}}},[mp.MakeUrlsValid]:{up:n=>n.props.url!==""&&!or.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),zL=new Set(["vertex","virtual","create"]),NL=Me({id:Se,type:Wc(zL),canBind:Ee.optional(),canSnap:Ee.optional(),index:Se,x:we,y:we}),yp=un.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),FL={color:Cr,dash:$s,size:mi,spline:yp,handles:K0(Se,NL)},p2={AddSnapHandles:1},$L=Ne({currentVersion:p2.AddSnapHandles,migrators:{[p2.AddSnapHandles]:{up:n=>{const e=ln(n.props.handles);for(const t in e)e[t].canSnap=!0;return{...n,props:{...n.props,handles:e}}},down:n=>{const e=ln(n.props.handles);for(const t in e)delete e[t].canSnap;return{...n,props:{...n.props,handles:e}}}}}}),BL={color:Cr,size:mi,font:gi,align:Zc,verticalAlign:gp,growY:H0,url:or,text:Se},Qa={AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5},UL=Ne({currentVersion:Qa.MakeUrlsValid,migrators:{[Qa.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[Qa.RemoveJustify]:{up:n=>{let e=n.props.align;return e==="justify"&&(e="start"),{...n,props:{...n.props,align:e}}},down:n=>({...n})},[Qa.MigrateLegacyAlign]:{up:n=>{let e;switch(n.props.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}return{...n,props:{...n.props,align:e}}},down:n=>{let e;switch(n.props.align){case"start-legacy":e="start";break;case"end-legacy":e="end";break;case"middle-legacy":e="middle";break;default:e=n.props.align}return{...n,props:{...n.props,align:e}}}},[Qa.AddVerticalAlign]:{up:n=>({...n,props:{...n.props,verticalAlign:"middle"}}),down:n=>{const{verticalAlign:e,...t}=n.props;return{...n,props:t}}},[Qa.MakeUrlsValid]:{up:n=>n.props.url!==""&&!or.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),VL={color:Cr,size:mi,font:gi,align:Zc,w:$n,text:Se,scale:$n,autoSize:Ee},f2={RemoveJustify:1},HL=Ne({currentVersion:f2.RemoveJustify,migrators:{[f2.RemoveJustify]:{up:n=>{let e=n.props.align;return e==="justify"&&(e="start"),{...n,props:{...n.props,align:e}}},down:n=>({...n})}}}),WL={w:$n,h:$n,time:we,playing:Ee,url:or,assetId:ap.nullable()},nw={AddUrlProp:1,MakeUrlsValid:2},KL=Ne({currentVersion:nw.MakeUrlsValid,migrators:{[nw.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[nw.MakeUrlsValid]:{up:n=>n.props.url!==""&&!or.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),Qc=[{locale:"ar",label:"\u0639\u0631\u0628\u064A"},{locale:"ca",label:"Catal\xE0"},{locale:"cs",label:"\u010Ce\u0161tina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xF1ol"},{locale:"fa",label:"\u0641\u0627\u0631\u0633\u06CC"},{locale:"fi",label:"Suomi"},{locale:"fr",label:"Fran\xE7ais"},{locale:"gl",label:"Galego"},{locale:"he",label:"\u05E2\u05D1\u05E8\u05D9\u05EA"},{locale:"it",label:"Italiano"},{locale:"ja",label:"\u65E5\u672C\u8A9E"},{locale:"ko-kr",label:"\uD55C\uAD6D\uC5B4"},{locale:"ku",label:"\u06A9\u0648\u0631\u062F\u06CC"},{locale:"hi-in",label:"\u0939\u093F\u0928\u094D\u0926\u0940"},{locale:"hu",label:"Magyar"},{locale:"my",label:"\u1019\u103C\u1014\u103A\u1019\u102C\u1005\u102C"},{locale:"ne",label:"\u0928\u0947\u092A\u093E\u0932\u0940"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xEAs - Brasil"},{locale:"pt-pt",label:"Portugu\xEAs - Europeu"},{locale:"ro",label:"Rom\xE2n\u0103"},{locale:"ru",label:"Russian"},{locale:"sv",label:"Svenska"},{locale:"te",label:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41"},{locale:"th",label:"\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22"},{locale:"tr",label:"T\xFCrk\xE7e"},{locale:"uk",label:"Ukrainian"},{locale:"vi",label:"Ti\u1EBFng Vi\u1EC7t"},{locale:"zh-cn",label:"Chinese - Simplified"},{locale:"zh-tw",label:"\u7E41\u9AD4\u4E2D\u6587 (\u53F0\u7063)"}];function GL(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return YL(n)}function YL(n){for(const e of n){const t=XL(e);if(t)return t}return"en"}const g2={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function XL(n){const e=Qc.find(i=>i.locale===n.toLowerCase());if(e)return e.locale;const[t,r]=n.split(/[-_]/).map(i=>i.toLowerCase());if(r){const i=Qc.find(o=>o.locale===t);if(i)return i.locale}return t in g2?g2[t]:null}var m2={exports:{}};(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var r=[],i=0;i<arguments.length;i++){var o=arguments[i];if(o){var s=typeof o;if(s==="string"||s==="number")r.push(o);else if(Array.isArray(o)){if(o.length){var a=t.apply(null,o);a&&r.push(a)}}else if(s==="object"){if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]")){r.push(o.toString());continue}for(var l in o)e.call(o,l)&&o[l]&&r.push(l)}}}return r.join(" ")}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(m2);var qL=m2.exports;const ye=qn(qL),JL={},nt={preventDefaultLogging:sr("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureLogging:sr("pointerCaptureLogging",{defaults:{all:!1}}),pointerCaptureTracking:sr("pointerCaptureTracking",{defaults:{all:!1}}),pointerCaptureTrackingObject:sr("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),elementRemovalLogging:sr("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:sr("debugSvg",{defaults:{all:!1}}),throwToBlob:sr("throwToBlob",{defaults:{all:!1}}),logMessages:sr("uiLog",{defaults:{all:[]}}),resetConnectionEveryPing:sr("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:sr("debugCursors",{defaults:{all:!1}}),forceSrgb:sr("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:sr("debugGeometry",{defaults:{all:!1}}),hideShapes:sr("hideShapes",{defaults:{all:!1}})};if(typeof window<"u"&&(window.tldrawLog=n=>{nt.logMessages.set(nt.logMessages.get().concat(n))}),typeof Element<"u"){const n=Element.prototype.removeChild;Uc("element removal logging",()=>{nt.elementRemovalLogging.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),n.call(this,e)}:Element.prototype.removeChild=n})}function sr(n,{defaults:e,shouldStoreForSession:t=!0}){return ZL({name:n,defaults:e,shouldStoreForSession:t})}function ZL(n){const e=ez(n),t=n.shouldStoreForSession?QL(n.name):null,r=Cn(`debug:${n.name}`,t??e);return typeof window<"u"&&(n.shouldStoreForSession&&Uc(`debug:${n.name}`,()=>{const i=r.get();try{i===e?window.sessionStorage.removeItem(`tldraw_debug:${n.name}`):window.sessionStorage.setItem(`tldraw_debug:${n.name}`,JSON.stringify(i))}catch{}}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return r.get()},set(i){r.set(i)},configurable:!0})),Object.assign(r,n)}function QL(n){try{return JSON.parse((window==null?void 0:window.sessionStorage.getItem(`tldraw_debug:${n}`))??"null")}catch{return null}}function rw(n){try{return n()}catch{return null}}function ez(n){switch(rw(()=>({}).TLDRAW_ENV)??rw(()=>({}).VERCEL_PUBLIC_TLDRAW_ENV)??rw(()=>({}).NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}function wp(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return wp(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Oe(n){n.preventDefault(),nt.preventDefaultLogging.get()&&console.warn("preventDefault called on event:",n)}function ed(n,e){if(n.setPointerCapture(e.pointerId),nt.pointerCaptureTracking.get()){const t=nt.pointerCaptureTrackingObject.get();t.set(n,(t.get(n)??0)+1)}nt.pointerCaptureLogging.get()&&console.warn("setPointerCapture called on element:",n,e)}function td(n,e){if(n.hasPointerCapture(e.pointerId)){if(n.releasePointerCapture(e.pointerId),nt.pointerCaptureTracking.get()){const t=nt.pointerCaptureTrackingObject.get();t.get(n)===1?t.delete(n):t.has(n)?t.set(n,t.get(n)-1):console.warn("Release without capture")}nt.pointerCaptureLogging.get()&&console.warn("releasePointerCapture called on element:",n,e)}}const Ft=n=>n.stopPropagation();function Hn(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}const iw=re.createContext({});function G(){return re.useContext(iw)}function tz(){const n=G();return v.useMemo(function(){let e,t;function r(p){if(!p.isKilled){if(p.button===2){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...Hn(p)});return}p.button!==0&&p.button!==1&&p.button!==5||(ed(p.currentTarget,p),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Hn(p)}),n.getOpenMenus().length>0&&(n.updateInstanceState({openMenus:[]}),document.body.click(),n.getContainer().focus()))}}function i(p){p.isKilled||p.clientX===e&&p.clientY===t||(e=p.clientX,t=p.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Hn(p)}))}function o(p){p.isKilled||p.button!==0&&p.button!==1&&p.button!==2&&p.button!==5||(e=p.clientX,t=p.clientY,td(p.currentTarget,p),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Hn(p)}))}function s(p){if(p.isKilled||n.getInstanceState().isPenMode&&p.pointerType!=="pen")return;const m=p.pointerType==="mouse"||p.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:m?!0:null})}function a(p){if(p.isKilled||n.getInstanceState().isPenMode&&p.pointerType!=="pen")return;const m=p.pointerType==="mouse"||p.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:m?!1:null})}function l(p){p.isKilled=!0,document.body.click(),Oe(p)}function c(p){p.isKilled=!0,p.target.tagName!=="A"&&p.target.tagName!=="TEXTAREA"&&Oe(p)}function d(p){Oe(p)}async function u(p){var f,w;if(Oe(p),!((w=(f=p.dataTransfer)==null?void 0:f.files)!=null&&w.length))return;const m=Array.from(p.dataTransfer.files);await n.putExternalContent({type:"files",files:m,point:n.screenToPage({x:p.clientX,y:p.clientY}),ignoreParent:!1})}function h(p){Ft(p)}return{onPointerDown:r,onPointerMove:i,onPointerUp:o,onPointerEnter:s,onPointerLeave:a,onDragOver:d,onDrop:u,onTouchStart:l,onTouchEnd:c,onClick:h}},[n])}function nz(){const n=G();v.useEffect(()=>{if(n.environment.isFirefox&&!n.environment.isAndroid&&!n.environment.isIos){n.updateInstanceState({isCoarsePointer:!1});return}if(window.matchMedia){const e=window.matchMedia("(pointer: coarse)"),t=()=>{n.updateInstanceState({isCoarsePointer:!!e.matches})};if(t(),e)return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}},[n])}const y2=v.createContext(null);function rz({container:n,children:e}){return g.jsx(y2.Provider,{value:n,children:e})}function hn(){return sD(v.useContext(y2),"useContainer used outside of <Tldraw />")}function iz(){const n=G(),e=hn(),t=q("isFocused",()=>n.getInstanceState().isFocused,[n]);v.useEffect(()=>{if(typeof matchMedia===void 0)return;let r=null;const i=()=>{r==null||r();const o=`(resolution: ${window.devicePixelRatio}dppx)`,s=matchMedia(o),a=l=>{l.type==="change"&&i()};s.addEventListener?s.addEventListener("change",i):s.addListener&&s.addListener(a),r=()=>{s.removeEventListener?s.removeEventListener("change",i):s.removeListener&&s.removeListener(a)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return i(),()=>{r==null||r()}},[n]),v.useEffect(()=>{if(!t)return;const r=a=>{if(a.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!nd()&&Oe(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){Oe(a);return}break}case"Tab":{if(nd()||n.getIsMenuOpen())return;break}case",":{if(!nd()&&(Oe(a),!n.inputs.keys.has("Comma"))){const{x:c,y:d,z:u}=n.inputs.currentScreenPoint;n.inputs.keys.add("Comma");const h={type:"pointer",name:"pointer_down",point:{x:c,y:d,z:u},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(h);return}break}case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&a.preventDefault(),n.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),e.focus());return}default:if(nd()||n.getIsMenuOpen())return}const l={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};n.dispatch(l)},i=a=>{var c;if(a.isKilled||(a.isKilled=!0,nd()||n.getIsMenuOpen()))return;if(a.key===","&&((c=document.activeElement)!=null&&c.ELEMENT_NODE&&Oe(a),n.inputs.keys.has(a.code))){const{x:d,y:u,z:h}=n.inputs.currentScreenPoint;n.inputs.keys.delete(a.code);const p={type:"pointer",name:"pointer_up",point:{x:d,y:u,z:h},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(p);return}const l={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};n.dispatch(l)};function o(a){var l,c;if(e.contains(a.target)){const d=a.touches[0].pageX,u=a.touches[0].radiusX||0;(d-u<10||d+u>n.getViewportScreenBounds().width-10)&&(((l=a.target)==null?void 0:l.tagName)==="BUTTON"&&((c=a.target)==null||c.click()),Oe(a))}}const s=a=>{e.contains(a.target)&&(a.ctrlKey||a.metaKey)&&Oe(a)};return e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("wheel",s,{passive:!1}),document.addEventListener("gesturestart",Oe),document.addEventListener("gesturechange",Oe),document.addEventListener("gestureend",Oe),e.addEventListener("keydown",r),e.addEventListener("keyup",i),()=>{e.removeEventListener("touchstart",o),e.removeEventListener("wheel",s),document.removeEventListener("gesturestart",Oe),document.removeEventListener("gesturechange",Oe),document.removeEventListener("gestureend",Oe),e.removeEventListener("keydown",r),e.removeEventListener("keyup",i)}},[n,e,t])}const oz=["input","select","button","textarea"];function nd(){const{activeElement:n}=document;return!!(n&&(n.getAttribute("contenteditable")||oz.indexOf(n.tagName.toLowerCase())>-1))}const sz={error:null};class w2 extends v.Component{constructor(){super(...arguments);y(this,"state",sz)}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t){var r,i;(i=(r=this.props).onError)==null||i.call(r,t)}render(){const{error:t}=this.state;if(t!==null){const{fallback:r}=this.props;return g.jsx(r,{error:t})}return this.props.children}}function rd({children:n,fallback:e,...t}){return e===null?g.jsx(g.Fragment,{children:n}):g.jsx(w2,{fallback:e,...t,children:n})}class az{constructor(e){this.shape=e}equals(e){var t,r,i,o,s,a;return((t=this.shape)==null?void 0:t.isLocked)===((r=e==null?void 0:e.shape)==null?void 0:r.isLocked)&&((i=this.shape)==null?void 0:i.props)===((o=e==null?void 0:e.shape)==null?void 0:o.props)&&((s=this.shape)==null?void 0:s.meta)===((a=e==null?void 0:e.shape)==null?void 0:a.meta)}}const lz=({shape:n,util:e})=>Xh("Indicator:"+n.type,()=>e.indicator(n)),cz=({editor:n,id:e})=>{const t=q("shape",()=>new az(n.store.get(e)),[n,e]),{ShapeIndicatorErrorFallback:r}=$t();return!t.shape||t.shape.isLocked?null:g.jsx(rd,{fallback:r,onError:i=>n.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:g.jsx(lz,{shape:t.shape,util:n.getShapeUtil(t.shape)},t.shape.id)})},dz=({id:n,className:e,color:t,opacity:r})=>{const i=G(),o=q("transform",()=>{const s=i.getShapePageTransform(n);return s?s.toCssString():""},[i,n]);return g.jsx("svg",{className:ye("tl-overlays__item",e),children:g.jsx("g",{className:"tl-shape-indicator",transform:o,stroke:t??"var(--color-selected)",opacity:r,children:g.jsx(cz,{editor:i,id:n})})})},id=v.memo(dz);function uz(){return g.jsx("div",{className:"tl-background"})}function el(n,e,t,r,i,o){v.useLayoutEffect(()=>{const s=n.current;if(!s||e===void 0)return;let a=`translate(${e}px, ${t}px)`;r!==void 0&&(a+=` scale(${r})`),i!==void 0&&(a+=` rotate(${i}rad)`),o&&(a+=` translate(${o.x}px, ${o.y}px)`),s.style.transform=a})}const pn={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class k{constructor(e=0,t=0,r=1){this.x=e,this.y=t,this.z=r}get pressure(){return this.z}set(e=this.x,t=this.y,r=this.z){return this.x=e,this.y=t,this.z=r,this}setTo({x:e=0,y:t=0,z:r=1}){return this.x=e,this.y=t,this.z=r,this}rot(e){if(e===0)return this;const{x:t,y:r}=this,i=Math.sin(e),o=Math.cos(e);return this.x=t*o-r*i,this.y=t*i+r*o,this}rotWith(e,t){if(t===0)return this;const r=this.x-e.x,i=this.y-e.y,o=Math.sin(t),s=Math.cos(t);return this.x=e.x+(r*s-i*o),this.y=e.y+(r*o+i*s),this}clone(){const{x:e,y:t,z:r}=this;return new k(e,t,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const r=k.Tan(e,this);return this.add(r.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return k.Dpr(this,e)}cpr(e){return k.Cpr(this,e)}len2(){return k.Len2(this)}len(){return k.Len(this)}pry(e){return k.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return k.Uni(this)}tan(e){return k.Tan(this,e)}dist(e){return k.Dist(this,e)}distanceToLineSegment(e,t){return k.DistanceToLineSegment(e,t,this)}slope(e){return k.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return k.Angle(this,e)}toAngle(){return k.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return k.Equals(this,e)}equalsXY(e,t){return k.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return k.ToFixed(this)}toString(){return k.ToString(k.ToFixed(this))}toJson(){return k.ToJson(this)}toArray(){return k.ToArray(this)}static Add(e,t){return new k(e.x+t.x,e.y+t.y)}static AddXY(e,t,r){return new k(e.x+t,e.y+r)}static Sub(e,t){return new k(e.x-t.x,e.y-t.y)}static SubXY(e,t,r){return new k(e.x-t,e.y-r)}static AddScalar(e,t){return new k(e.x+t,e.y+t)}static SubScalar(e,t){return new k(e.x-t,e.y-t)}static Div(e,t){return new k(e.x/t,e.y/t)}static Mul(e,t){return new k(e.x*t,e.y*t)}static DivV(e,t){return new k(e.x/t.x,e.y/t.y)}static MulV(e,t){return new k(e.x*t.x,e.y*t.y)}static Neg(e){return new k(-e.x,-e.y)}static Per(e){return new k(e.y,-e.x)}static Dist2(e,t){return k.Sub(e,t).len2()}static Abs(e){return new k(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return Math.hypot(e.y-t.y,e.x-t.x)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new k(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return Math.hypot(e.x,e.y)}static Pry(e,t){return k.Dpr(e,t)/k.Len(t)}static Uni(e){return k.Div(e,k.Len(e))}static Tan(e,t){return k.Uni(k.Sub(e,t))}static Min(e,t){return new k(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new k(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:r=1}){return new k(e,t,r)}static FromArray(e){return new k(e[0],e[1])}static Rot(e,t=0){const r=Math.sin(t),i=Math.cos(t);return new k(e.x*i-e.y*r,e.x*r+e.y*i)}static RotWith(e,t,r){const i=e.x-t.x,o=e.y-t.y,s=Math.sin(r),a=Math.cos(r);return new k(t.x+(i*a-o*s),t.y+(i*s+o*a))}static NearestPointOnLineThroughPoint(e,t,r){return k.Mul(t,k.Sub(r,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,r,i=!0){const o=k.Tan(t,e),s=k.Add(e,k.Mul(o,k.Sub(r,e).pry(o)));if(i){if(s.x<Math.min(e.x,t.x))return k.Cast(e.x<t.x?e:t);if(s.x>Math.max(e.x,t.x))return k.Cast(e.x>t.x?e:t);if(s.y<Math.min(e.y,t.y))return k.Cast(e.y<t.y?e:t);if(s.y>Math.max(e.y,t.y))return k.Cast(e.y>t.y?e:t)}return s}static DistanceToLineThroughPoint(e,t,r){return k.Dist(r,k.NearestPointOnLineThroughPoint(e,t,r))}static DistanceToLineSegment(e,t,r,i=!0){return k.Dist(r,k.NearestPointOnLineSegment(e,t,r,i))}static Snap(e,t=1){return new k(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof k?e:k.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,r){return k.Sub(t,e).mul(r).add(e)}static Med(e,t){return new k((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,r){return e.x===t&&e.y===r}static Clockwise(e,t,r){return(r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y)<0}static Rescale(e,t){const r=k.Len(e);return new k(t*e.x/r,t*e.y/r)}static ScaleWithOrigin(e,t,r){return k.Sub(e,r).mul(t).add(r)}static ToFixed(e,t=2){return new k(+e.x.toFixed(t),+e.y.toFixed(t),+e.z.toFixed(t))}static Nudge(e,t,r){return k.Add(e,k.Tan(t,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new k(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:r,z:i}=e;return{x:t,y:r,z:i}}static Average(e){const t=e.length,r=new k(0,0);for(let i=0;i<t;i++)r.add(e[i]);return r.div(t)}static Clamp(e,t,r){return r===void 0?new k(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new k(Math.min(Math.max(e.x,t),r),Math.min(Math.max(e.y,t),r))}static PointsBetween(e,t,r=6){const i=[];for(let o=0;o<r;o++){const s=pn.easeInQuad(o/(r-1)),a=k.Lrp(e,t,s);a.z=Math.min(1,.5+Math.abs(.5-hz(s))*.65),i.push(a)}return i}static SnapToGrid(e,t=8){return new k(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const hz=n=>n<.5?2*n*n:-1+(4-2*n)*n;function Yt(n){return`${R(n.x)},${R(n.y)} `}function Wn(n,e){return`${R((n.x+e.x)/2)},${R((n.y+e.y)/2)} `}const Fe=Math.PI,rt=Fe/2,We=Fe*2,pz=Math.sin;function wi(n,e,t){return Math.max(e,typeof t<"u"?Math.min(n,t):n)}function bp(n,e=1e10){return n?Math.round(n*e)/e:0}function od(n,e,t=1e-6){return Math.abs(n-e)<=t}function sd(n,e){const t=Math.pow(n-e,2)/Math.pow(n+e,2);return Fe*(n+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function Wr(n){return n=n%We,n<0?n=n+We:n===0&&(n=0),n}function vp(n,e){return n=Wr(n),e=Wr(e),n>e&&(e+=We),e-n}function fz(n,e){return We-vp(n,e)}function ad(n,e){const t=(e-n)%We;return 2*t%We-t}function ow(n){return(We+n)%We}function Sp(n,e){const t=We/e;let r=Math.floor((ow(n)+t/2)/t)*t%We;return r<Fe&&(r+=We),r>Fe&&(r-=We),r}function b2(n,e){return n===e||od(n%(Math.PI/2)-e%(Math.PI/2),0)}function gz(n){return n*Fe/180}function mz(n){return n*180/Fe}function v2(n,e,t,r){return new k(n+t*Math.cos(r),e+t*Math.sin(r))}function sw(n,e,t){const r=n/2,i=e/2,o=[];let s=1/0,a=-1/0,l=1/0,c=-1/0;for(let m=0;m<t;m++){const f=We/t,w=-rt+m*f,S=r+r*Math.cos(w),b=i+i*Math.sin(w);S<s&&(s=S),b<l&&(l=b),S>a&&(a=S),b>c&&(c=b),o.push(new k(S,b))}const d=a-s,u=c-l,h=n-d,p=e-u;if(h!==0||p!==0)for(let m=0;m<o.length;m++){const f=o[m];f.x=(f.x-s)/d*n,f.y=(f.y-l)/u*e}return o}function ld(n,e,t,r){return n<r&&t<e}function Kr(n,e,t,r){const i=Math.max(n,t),o=Math.min(e,r);return i<=o?[i,o]:null}function S2(n,e,t){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}function bi(n,e){let t=0,r,i;for(let o=0;o<e.length;o++){if(r=e[o],r.x===n.x&&r.y===n.y||(i=e[(o+1)%e.length],k.Dist(n,r)+k.Dist(n,i)===k.Dist(r,i)))return!0;r.y<=n.y?i.y>n.y&&S2(r,i,n)>0&&(t+=1):i.y<=n.y&&S2(r,i,n)<0&&(t-=1)}return t!==0}function R(n){return+n.toFixed(4)}function xp(n){return+n.toFixed(2)}const x2=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER,_p=({brush:n,color:e,opacity:t,className:r})=>{const i=v.useRef(null);el(i,n.x,n.y);const o=R(Math.max(1,n.w)),s=R(Math.max(1,n.h));return g.jsx("svg",{className:"tl-overlays__item",ref:i,children:e?g.jsxs("g",{className:"tl-brush",opacity:t,children:[g.jsx("rect",{width:o,height:s,fill:e,opacity:.75}),g.jsx("rect",{width:o,height:s,fill:"none",stroke:e,opacity:.1})]}):g.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:o,height:s})})},yz=({className:n,zoom:e,point:t,color:r,viewport:i,opacity:o=1})=>{const s=v.useRef(null);return el(s,wi(t.x,i.minX+5/e,i.maxX-5/e),wi(t.y,i.minY+5/e,i.maxY-5/e),1/e,k.Angle(i.center,t)),g.jsxs("svg",{ref:s,className:ye("tl-overlays__item",n),children:[g.jsx("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),g.jsx("use",{href:"#cursor_hint",color:r,opacity:o})]})},wz=({className:n,zoom:e,point:t,color:r,name:i,chatMessage:o})=>{const s=v.useRef(null);return el(s,t==null?void 0:t.x,t==null?void 0:t.y,1/e),t?g.jsxs("div",{ref:s,className:ye("tl-overlays__item",n),children:[g.jsx("svg",{className:"tl-cursor",children:g.jsx("use",{href:"#cursor",color:r})}),o?g.jsxs(g.Fragment,{children:[i&&g.jsx("div",{className:"tl-nametag-title",style:{color:r},children:i}),g.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:o})]}):i&&g.jsx("div",{className:"tl-nametag",style:{backgroundColor:r},children:i})]}):null},_2=v.memo(wz),aw={openWindow:(n,e)=>window.open(n,e,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var n;return await((n=window.__tldraw__hardReset)==null?void 0:n.call(window))}};function k2(){aw.hardReset()}function bz(){aw.refreshPage()}const vz="https://github.com/tldraw/tldraw/issues/new";function Sz(){}const C2=({error:n,editor:e})=>{const t=v.useRef(null),[r,i]=v.useState(!1),[o,s]=v.useState(!1),[a,l]=v.useState(!1),c=n instanceof Error?n.message:String(n),d=n instanceof Error?n.stack:null,u=q("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[h,p]=v.useState(null);v.useLayoutEffect(()=>{var x;u!==null&&p(u);let b=(x=t.current)==null?void 0:x.parentElement,_=!1;for(;b;){if(b.classList.contains("tl-theme__dark")||b.classList.contains("tl-theme__light")){_=!0;break}b=b.parentElement}if(_){p(null);return}p(window.matchMedia("(prefers-color-scheme: dark)").matches)},[u]),v.useEffect(()=>{if(o){const b=setTimeout(()=>{s(!1)},2e3);return()=>clearTimeout(b)}},[o]);const m=()=>{const b=document.createElement("textarea");b.value=d??c,document.body.appendChild(b),b.select(),document.execCommand("copy"),b.remove(),s(!0)},f=()=>{bz()},w=async()=>{k2()},S=new URL(vz);return S.searchParams.set("title",c),S.searchParams.set("labels","bug"),S.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${d??c}
\`\`\`

My browser: ${navigator.userAgent}`),g.jsxs("div",{ref:t,className:ye("tl-container tl-error-boundary",h===null?"":h?"tl-theme__dark":"tl-theme__light"),children:[g.jsx("div",{className:"tl-error-boundary__overlay"}),e&&g.jsx(w2,{onError:Sz,fallback:()=>null,children:g.jsx(iw.Provider,{value:e,children:g.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:g.jsx(vw,{})})})}),g.jsx("div",{className:ye("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?g.jsxs(g.Fragment,{children:[g.jsx("h2",{children:"Are you sure?"}),g.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),g.jsxs("div",{className:"tl-error-boundary__content__actions",children:[g.jsx("button",{onClick:()=>l(!1),children:"Cancel"}),g.jsx("button",{className:"tl-error-boundary__reset",onClick:w,children:"Reset data"})]})]}):g.jsxs(g.Fragment,{children:[g.jsx("h2",{children:"Something's gone wrong."}),g.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",g.jsx("a",{href:S.toString(),children:"create a GitHub issue"})," or"," ",g.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&g.jsxs("div",{className:"tl-error-boundary__content__error",children:[g.jsx("pre",{children:g.jsx("code",{children:d??c})}),g.jsx("button",{onClick:m,children:o?"Copied!":"Copy"})]}),g.jsxs("div",{className:"tl-error-boundary__content__actions",children:[g.jsx("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),g.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[g.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),g.jsx("button",{className:"tl-error-boundary__refresh",onClick:f,children:"Refresh Page"})]})]})]})})]})},Qi=2e3,kp=40,eo=320,tl=[.1,.25,.5,1,2,4,8],cd=.1,Wo=8,xz=.5,_z=.1,kz=.2,Cz=.005,Pz=.05,Ez=450,Iz=200,lw=6,dd=4,Mz=32,Cp={};for(let n=1;n<=Math.ceil(Wo);n++)Cp[n+"_dark"]=`hash_pattern_zoom_${n}_dark`,Cp[n+"_light"]=`hash_pattern_zoom_${n}_light`;const Az={duration:0,easing:pn.easeInOutCubic},Pp=.09,P2=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],Tz=6e4,E2=3e3,jz=1200,I2={CAMERA_MOVE:-10},Rz=64,Oz=620,Gr=8,Dz=20,nl=32,Lz=({x:n,y:e,z:t,size:r})=>g.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[g.jsx("defs",{children:P2.map(({min:i,mid:o,step:s},a)=>{const l=s*r*t,c=.5+n*t,d=.5+e*t,u=c>0?c%l:l+c%l,h=d>0?d%l:l+d%l,p=t<o?Qh(t,[i,o],[0,1]):1;return g.jsx("pattern",{id:`grid-${s}`,width:l,height:l,patternUnits:"userSpaceOnUse",children:g.jsx("circle",{className:"tl-grid-dot",cx:u,cy:h,r:1,opacity:p})},`grid-pattern-${a}`)})}),P2.map(({step:i},o)=>g.jsx("rect",{width:"100%",height:"100%",fill:`url(#grid-${i})`},`grid-rect-${o}`))]}),zz=({handle:n,isCoarse:e,className:t,zoom:r})=>{const i=(e?20:12)/r,o=(n.type==="create"&&e?3:4)/r;return g.jsxs("g",{className:ye("tl-handle",{"tl-handle__virtual":n.type==="virtual","tl-handle__create":n.type==="create"},t),children:[g.jsx("circle",{className:"tl-handle__bg",r:i}),g.jsx("circle",{className:"tl-handle__fg",r:o})]})},Nz=({children:n})=>g.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),Fz=({shapeId:n})=>g.jsx(id,{className:"tl-user-indicator__hovered",id:n});function ud(n,e=!0){const t=n.length;if(t<2)return"";let r=n[0],i=n[1];if(t===2)return`M${Yt(r)}L${Yt(i)}`;let o="";for(let s=2,a=t-1;s<a;s++)r=n[s],i=n[s+1],o+=Wn(r,i);return e?`M${Wn(n[0],n[1])}Q${Yt(n[1])}${Wn(n[1],n[2])}T${o}${Wn(n[t-1],n[0])}${Wn(n[0],n[1])}Z`:`M${Yt(n[0])}Q${Yt(n[1])}${Wn(n[1],n[2])}${n.length>3?"T":""}${o}L${Yt(n[t-1])}`}const M2=({scribble:n,zoom:e,color:t,opacity:r,className:i})=>n.points.length?g.jsx("svg",{className:i&&ye("tl-overlays__item",i),children:g.jsx("path",{className:"tl-scribble",d:ud(n.points,!1),stroke:t??`var(--color-${n.color})`,fill:"none",strokeWidth:8/e,opacity:r??n.opacity})}):null,A2=({bounds:n,rotation:e})=>{const t=v.useRef(null);return el(t,n.x,n.y,1,e),v.useLayoutEffect(()=>{const r=t.current;r&&(r.style.width=R(Math.max(1,n.width))+"px",r.style.height=R(Math.max(1,n.height))+"px")},[n.width,n.height]),g.jsx("div",{ref:t,className:"tl-selection__bg",draggable:!1})},$z=({bounds:n,rotation:e})=>{const t=G(),r=v.useRef(null),i=q("only selected shape",()=>t.getOnlySelectedShape(),[t]),o=i?t.getShapeUtil(i).expandSelectionOutlinePx(i):0;return el(r,n==null?void 0:n.x,n==null?void 0:n.y,1,e,{x:-o,y:-o}),n=n.clone().expandBy(o).zeroFix(),g.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:g.jsx("rect",{className:ye("tl-selection__fg__outline"),width:R(n.width),height:R(n.height)})})},Bz=()=>g.jsx("div",{className:"tl-shape-error-boundary"}),Uz=()=>g.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function Vz({points:n,zoom:e}){const t=2.5/e,r=n.reduce((h,p)=>Math.min(h,p.x),1/0),i=n.reduce((h,p)=>Math.max(h,p.x),-1/0),o=n.reduce((h,p)=>Math.min(h,p.y),1/0),s=n.reduce((h,p)=>Math.max(h,p.y),-1/0),a=n.some(h=>h.x===r&&h.y===o);let l,c,d,u;return a?(l=r,c=o,d=i,u=s):(l=r,c=s,d=i,u=o),g.jsxs("g",{className:"tl-snap-line",children:[g.jsx("line",{x1:l,y1:c,x2:d,y2:u}),n.map((h,p)=>g.jsx("g",{transform:`translate(${h.x},${h.y})`,children:g.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},p))]})}function Hz({gaps:n,direction:e,zoom:t}){const r=3.5/t;let i=[-1/0,1/0],o=null;const s=e==="horizontal";for(const l of n){if(o=Kr(i[0],i[1],s?l.startEdge[0].y:l.startEdge[0].x,s?l.startEdge[1].y:l.startEdge[1].x),o)i=o;else continue;if(o=Kr(i[0],i[1],s?l.endEdge[0].y:l.endEdge[0].x,s?l.endEdge[1].y:l.endEdge[1].x),o)i=o;else continue}if(i===null)return null;const a=(i[0]+i[1])/2;return g.jsx("g",{className:"tl-snap-line",children:n.map(({startEdge:l,endEdge:c},d)=>g.jsx(v.Fragment,{children:s?g.jsxs(g.Fragment,{children:[g.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),g.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),g.jsx("line",{x1:l[0].x,y1:a,x2:c[0].x,y2:a}),g.jsx("line",{x1:(l[0].x+c[0].x)/2,y1:a-r,x2:(l[0].x+c[0].x)/2,y2:a+r})]}):g.jsxs(g.Fragment,{children:[g.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),g.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),g.jsx("line",{x1:a,y1:l[0].y,x2:a,y2:c[0].y}),g.jsx("line",{x1:a-r,y1:(l[0].y+c[0].y)/2,x2:a+r,y2:(l[0].y+c[0].y)/2})]})},d))})}const Wz=({className:n,line:e,zoom:t})=>g.jsx("svg",{className:ye("tl-overlays__item",n),children:e.type==="points"?g.jsx(Vz,{...e,zoom:t}):e.type==="gaps"?g.jsx(Hz,{...e,zoom:t}):null}),Kz=()=>g.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:g.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[g.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),g.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:g.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}),Gz=()=>null,T2=v.createContext({});function Yz({overrides:n,children:e}){return g.jsx(T2.Provider,{value:v.useMemo(()=>({Background:uz,SvgDefs:Gz,Brush:_p,ZoomBrush:_p,ScreenshotBrush:_p,CollaboratorBrush:_p,Cursor:_2,CollaboratorCursor:_2,CollaboratorHint:yz,CollaboratorShapeIndicator:id,Grid:Lz,Scribble:M2,SnapLine:Wz,Handles:Nz,Handle:zz,CollaboratorScribble:M2,ErrorFallback:C2,ShapeErrorFallback:Bz,ShapeIndicatorErrorFallback:Uz,Spinner:Kz,SelectionBackground:A2,SelectionForeground:$z,HoveredShapeIndicator:Fz,OnTheCanvas:null,InFrontOfTheCanvas:null,...n}),[n]),children:e})}function $t(){return v.useContext(T2)}const Xz=["textarea","input"];function qz(n){const e=G();v.useEffect(()=>{const t=n.current;if(!t)return;const r=i=>{var o;if(i instanceof PointerEvent&&i.pointerType==="pen"){i.isKilled=!0;const{target:s}=i;if(Xz.includes((o=s.tagName)==null?void 0:o.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;Oe(i)}};return t.addEventListener("touchstart",r),t.addEventListener("touchend",r),()=>{t.removeEventListener("touchstart",r),t.removeEventListener("touchend",r)}},[e,n])}function Jz(n,e,t){return Math.max(e,Math.min(n,t))}const Xt={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function j2(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function R2(n,e,t,r=.15){return r===0?Jz(n,e,t):n<e?-j2(e-n,t-e,r)+e:n>t?+j2(n-t,t-e,r)+t:n}function Zz(n,[e,t],[r,i]){const[[o,s],[a,l]]=n;return[R2(e,o,s,r),R2(t,a,l,i)]}function Qz(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function e6(n){var e=Qz(n,"string");return typeof e=="symbol"?e:String(e)}function fn(n,e,t){return e=e6(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function O2(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function wt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?O2(Object(t),!0).forEach(function(r){fn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):O2(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const D2={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function L2(n){return n?n[0].toUpperCase()+n.slice(1):""}const t6=["enter","leave"];function n6(n=!1,e){return n&&!t6.includes(e)}function r6(n,e="",t=!1){const r=D2[n],i=r&&r[e]||e;return"on"+L2(n)+L2(i)+(n6(t,i)?"Capture":"")}const i6=["gotpointercapture","lostpointercapture"];function o6(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const r=i6.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:t}}function s6(n,e=""){const t=D2[n],r=t&&t[e]||e;return n+r}function z2(n){return"touches"in n}function a6(n){return z2(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function l6(n){return Array.from(n.touches).filter(e=>{var t,r;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(r=t.contains)===null||r===void 0?void 0:r.call(t,e.target))})}function cw(n,e){try{const t=e.clientX-n.clientX,r=e.clientY-n.clientY,i=(e.clientX+n.clientX)/2,o=(e.clientY+n.clientY)/2,s=Math.hypot(t,r);return{angle:-(Math.atan2(t,r)*180)/Math.PI,distance:s,origin:[i,o]}}catch{}return null}function c6(n){return l6(n).map(e=>e.identifier)}function N2(n,e){const[t,r]=Array.from(n.touches).filter(i=>e.includes(i.identifier));return cw(t,r)}const F2=40,$2=800;function B2(n){let{deltaX:e,deltaY:t,deltaMode:r}=n;return r===1?(e*=F2,t*=F2):r===2&&(e*=$2,t*=$2),[e,t]}function d6(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:r,metaKey:i,ctrlKey:o}=n;Object.assign(e,{shiftKey:t,altKey:r,metaKey:i,ctrlKey:o})}return e}function Ep(n,...e){return typeof n=="function"?n(...e):n}function u6(){}function h6(...n){return n.length===0?u6:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function U2(n,e){return Object.assign({},e,n||{})}const p6=32;class V2{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?Ep(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:i}=this;t.args=this.args;let o=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,d6(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,o=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const C=t._delta.map(Math.abs);Xt.addTo(t._distance,C)}this.axisIntent&&this.axisIntent(e);const[s,a]=t._movement,[l,c]=r.threshold,{_step:d,values:u}=t;if(r.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(s)>=l&&u[0]),d[1]===!1&&(d[1]=Math.abs(a)>=c&&u[1])):(d[0]===!1&&(d[0]=Math.abs(s)>=l&&Math.sign(s)*l),d[1]===!1&&(d[1]=Math.abs(a)>=c&&Math.sign(a)*c)),t.intentional=d[0]!==!1||d[1]!==!1,!t.intentional)return;const h=[0,0];if(r.hasCustomTransform){const[C,E]=u;h[0]=d[0]!==!1?C-d[0]:0,h[1]=d[1]!==!1?E-d[1]:0}else h[0]=d[0]!==!1?s-d[0]:0,h[1]=d[1]!==!1?a-d[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);const p=t.offset,m=t._active&&!t._blocked||t.active;m&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=Ep(r.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));const[f,w]=t.offset,[[S,b],[_,x]]=t._bounds;t.overflow=[f<S?-1:f>b?1:0,w<_?-1:w>x?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const P=t._active?r.rubberband||[0,0]:[0,0];if(t.offset=Zz(t._bounds,t.offset,P),t.delta=Xt.sub(t.offset,p),this.computeMovement(),m&&(!t.last||o>p6)){t.delta=Xt.sub(t.offset,p);const C=t.delta.map(Math.abs);Xt.addTo(t.distance,C),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&o>0&&(t.velocity=[C[0]/o,C[1]/o],t.timeDelta=o)}}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(wt(wt(wt({},t),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function f6([n,e],t){const r=Math.abs(n),i=Math.abs(e);if(r>i&&r>t)return"x";if(i>r&&i>t)return"y"}class g6 extends V2{constructor(...e){super(...e),fn(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Xt.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Xt.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,r=this.config;if(!t.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[a6(e)]:r.axisThreshold;t.axis=f6(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const m6=n=>n,H2=.15,W2={enabled(n=!0){return n},eventOptions(n,e,t){return wt(wt({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[H2,H2];case!1:return[0,0];default:return Xt.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return Xt.toVector(n)},transform(n,e,t){const r=n||t.shared.transform;return this.hasCustomTransform=!!r,r||m6},threshold(n){return Xt.toVector(n,0)}},y6=0,hd=wt(wt({},W2),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=y6){return n},bounds(n={}){if(typeof n=="function")return o=>hd.bounds(n(o));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:r=-1/0,bottom:i=1/0}=n;return[[e,t],[r,i]]}}),pd=typeof window<"u"&&window.document&&window.document.createElement;function w6(){return pd&&"ontouchstart"in window}function K2(){return w6()||pd&&window.navigator.maxTouchPoints>1}function b6(){return pd&&"onpointerdown"in window}function v6(){return pd&&"exitPointerLock"in window.document}function S6(){try{return"constructor"in GestureEvent}catch{return!1}}const Pr={isBrowser:pd,gesture:S6(),touch:K2(),touchscreen:K2(),pointer:b6(),pointerLock:v6()},x6=250,_6=180,k6=.5,C6=50,P6=250,E6=10,G2={mouse:0,touch:0,pen:8};wt(wt({},hd),{},{device(n,e,{pointer:{touch:t=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Pr.pointerLock,Pr.touch&&t?"touch":this.pointerLock?"mouse":Pr.pointer&&!i?"pointer":Pr.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?x6:void 0,!(!Pr.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:r=3,axis:i=void 0}){const o=Xt.toVector(n,t?r:i?1:0);return this.filterTaps=t,this.tapsThreshold=r,o},swipe({velocity:n=k6,distance:e=C6,duration:t=P6}={}){return{velocity:this.transform(Xt.toVector(n)),distance:this.transform(Xt.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return _6;case!1:return 0;default:return n}},axisThreshold(n){return n?wt(wt({},G2),n):G2},keyboardDisplacement(n=E6){return n}});function Y2(n){const[e,t]=n.overflow,[r,i]=n._delta,[o,s]=n._direction;(e<0&&r>0&&o<0||e>0&&r<0&&o>0)&&(n._movement[0]=n._movementBound[0]),(t<0&&i>0&&s<0||t>0&&i<0&&s>0)&&(n._movement[1]=n._movementBound[1])}const I6=30,M6=100;class A6 extends V2{constructor(...e){super(...e),fn(this,"ingKey","pinching"),fn(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:r}=this.state;e==="wheel"?this.state.offset=Xt.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,r]=e._movement;if(!e.axis){const i=Math.abs(t)*I6-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(o=>r.has(o))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);const i=N2(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,r=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(s=>i.has(s))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const o=cw(...Array.from(r.values()));o&&this.pinchStart(e,o)}pinchStart(e,t){const r=this.state;r.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=N2(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const r=cw(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){const r=this.state,i=r._values[1],o=t.angle-i;let s=0;Math.abs(o)>270&&(s+=Math.sign(o)),this.computeValues([t.distance,t.angle-360*s]),r.origin=t.origin,r.turns=s,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=Xt.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&!e[t]||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const t=this.state;t._delta=[-B2(e)[1]/M6*t.offset[0],0],Xt.addTo(t._movement,t._delta),Y2(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const T6=wt(wt({},W2),{},{device(n,e,{shared:t,pointer:{touch:r=!1}={}}){if(t.target&&!Pr.touch&&Pr.gesture)return"gesture";if(Pr.touch&&r)return"touch";if(Pr.touchscreen){if(Pr.pointer)return"pointer";if(Pr.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:r={}}){const i=s=>{const a=U2(Ep(t,s),{min:-1/0,max:1/0});return[a.min,a.max]},o=s=>{const a=U2(Ep(r,s),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof r!="function"?[i(),o()]:s=>[i(s),o(s)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",Xt.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});wt(wt({},hd),{},{mouseOnly:(n=!0)=>n});class j6 extends g6{constructor(...e){super(...e),fn(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=B2(e),Xt.addTo(t._movement,t._delta),Y2(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const R6=hd;wt(wt({},hd),{},{mouseOnly:(n=!0)=>n});const dw=new Map,uw=new Map;function O6(n){dw.set(n.key,n.engine),uw.set(n.key,n.resolver)}const D6={key:"pinch",engine:A6,resolver:T6},L6={key:"wheel",engine:j6,resolver:R6};function z6(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function N6(n,e){if(n==null)return{};var t=z6(n,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}const F6={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=Pr.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},$6=["target","eventOptions","window","enabled","transform"];function Ip(n={},e){const t={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":t[r]=i.call(t,n[r],r,n);break;case"object":t[r]=Ip(n[r],i);break;case"boolean":i&&(t[r]=n[r]);break}return t}function B6(n,e,t={}){const r=n,{target:i,eventOptions:o,window:s,enabled:a,transform:l}=r,c=N6(r,$6);if(t.shared=Ip({target:i,eventOptions:o,window:s,enabled:a,transform:l},F6),e){const d=uw.get(e);t[e]=Ip(wt({shared:t.shared},c),d)}else for(const d in c){const u=uw.get(d);u&&(t[d]=Ip(wt({shared:t.shared},c[d]),u))}return t}class X2{constructor(e,t){fn(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,o){const s=this._listeners,a=s6(t,r),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=wt(wt({},l),o);e.addEventListener(a,i,c);const d=()=>{e.removeEventListener(a,i,c),s.delete(d)};return s.add(d),d}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class U6{constructor(){fn(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class V6{constructor(e){fn(this,"gestures",new Set),fn(this,"_targetEventStore",new X2(this)),fn(this,"gestureEventStores",{}),fn(this,"gestureTimeoutStores",{}),fn(this,"handlers",{}),fn(this,"config",{}),fn(this,"pointerIds",new Set),fn(this,"touchIds",new Set),fn(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),H6(this,e)}setEventIds(e){if(z2(e))return this.touchIds=new Set(c6(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=B6(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r={};let i;if(!(t.target&&(i=t.target(),!i))){if(t.enabled){for(const s of this.gestures){const a=this.config[s],l=q2(r,a.eventOptions,!!i);if(a.enabled){const c=dw.get(s);new c(this,e,s).bind(l)}}const o=q2(r,t.eventOptions,!!i);for(const s in this.nativeHandlers)o(s,"",a=>this.nativeHandlers[s](wt(wt({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const o in r)r[o]=h6(...r[o]);if(!i)return r;for(const o in r){const{device:s,capture:a,passive:l}=o6(o);this._targetEventStore.add(i,s,"",r[o],{capture:a,passive:l})}}}}function rl(n,e){n.gestures.add(e),n.gestureEventStores[e]=new X2(n,e),n.gestureTimeoutStores[e]=new U6}function H6(n,e){e.drag&&rl(n,"drag"),e.wheel&&rl(n,"wheel"),e.scroll&&rl(n,"scroll"),e.move&&rl(n,"move"),e.pinch&&rl(n,"pinch"),e.hover&&rl(n,"hover")}const q2=(n,e,t)=>(r,i,o,s={},a=!1)=>{var l,c;const d=(l=s.capture)!==null&&l!==void 0?l:e.capture,u=(c=s.passive)!==null&&c!==void 0?c:e.passive;let h=a?r:r6(r,i,d);t&&u&&(h+="Passive"),n[h]=n[h]||[],n[h].push(o)},W6=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function K6(n){const e={},t={},r=new Set;for(let i in n)W6.test(i)?(r.add(RegExp.lastMatch),t[i]=n[i]):e[i]=n[i];return[t,e,r]}function il(n,e,t,r,i,o){if(!n.has(t)||!dw.has(r))return;const s=t+"Start",a=t+"End",l=c=>{let d;return c.first&&s in e&&e[s](c),t in e&&(d=e[t](c)),c.last&&a in e&&e[a](c),d};i[r]=l,o[r]=o[r]||{}}function G6(n,e){const[t,r,i]=K6(n),o={};return il(i,t,"onDrag","drag",o,e),il(i,t,"onWheel","wheel",o,e),il(i,t,"onScroll","scroll",o,e),il(i,t,"onPinch","pinch",o,e),il(i,t,"onMove","move",o,e),il(i,t,"onHover","hover",o,e),{handlers:o,config:e,nativeHandlers:r}}function Y6(n,e={},t,r){const i=re.useMemo(()=>new V6(n),[]);if(i.applyHandlers(n,r),i.applyConfig(e,t),re.useEffect(i.effect.bind(i)),re.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function X6(n){return n.forEach(O6),function(e,t){const{handlers:r,nativeHandlers:i,config:o}=G6(e,t||{});return Y6(r,o,void 0,i)}}const J2=10,q6=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function Z2(n){let{deltaY:e,deltaX:t}=n,r=0;if(n.ctrlKey||n.altKey||n.metaKey){const i=Math.sign(n.deltaY),o=Math.abs(n.deltaY);let s=e;o>J2&&(s=J2*i),r=s/100}else n.shiftKey&&!q6&&(t=e,e=0);return{x:-t,y:-e,z:-r}}const J6=X6([L6,D6]);let ol;const Z6=n=>ol===void 0?(ol=n,!1):n-ol>120&&n-ol<160?(ol=n,!0):(ol=n,!1);function Q6(n){const e=G(),t=v.useMemo(()=>{let r="not sure";const i=({event:p})=>{var b;if(!e.getInstanceState().isFocused||(r="not sure",Z6(Date.now())))return;const m=e.getEditingShapeId();if(m){const _=e.getShape(m);if(_&&e.getShapeUtil(_).canScroll(_)&&((b=e.getShapePageBounds(m))!=null&&b.containsPoint(e.inputs.currentPagePoint)))return}Oe(p);const f=Z2(p);if(f.x===0&&f.y===0)return;const w=e.getContainer().getBoundingClientRect(),S={type:"wheel",name:"wheel",delta:f,point:new k(p.clientX,p.clientY).sub({x:w.left,y:w.top}),shiftKey:p.shiftKey,altKey:p.altKey,ctrlKey:p.metaKey||p.ctrlKey};e.dispatch(S)};let o=1,s=1,a=1,l=0;const c=new k,d=new k,u=p=>{const m=n.current;r="not sure";const{event:f,origin:w,da:S}=p;f instanceof WheelEvent||(f.target===m||m!=null&&m.contains(f.target))&&(d.x=w[0],d.y=w[1],c.x=w[0],c.y=w[1],o=S[0],s=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:w[0],y:w[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey}))},h=p=>{if(p&&(r="zooming"),r==="zooming")return;const m=Math.abs(l-o),f=k.Dist(c,d);switch(r){case"not sure":{m>24?r="zooming":f>16&&(r="panning");break}case"panning":{m>64&&(r="zooming");break}}};return{onWheel:i,onPinchStart:u,onPinchEnd:p=>{const m=n.current,{event:f,origin:w,offset:S}=p;if(f instanceof WheelEvent||!(f.target===m||m!=null&&m.contains(f.target)))return;const b=S[0];r="not sure",requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:w[0],y:w[1],z:b},delta:{x:w[0],y:w[1]},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey})})},onPinch:p=>{const m=n.current,{event:f,origin:w,offset:S,da:b}=p;if(f instanceof WheelEvent||!(f.target===m||m!=null&&m.contains(f.target)))return;const _=p.type==="gesturechange"||p.type==="gestureend";l=b[0];const x=w[0]-d.x,P=w[1]-d.y;switch(d.x=w[0],d.y=w[1],h(_),r){case"zooming":{a=S[0],e.dispatch({type:"pinch",name:"pinch",point:{x:w[0],y:w[1],z:a},delta:{x,y:P},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:w[0],y:w[1],z:s},delta:{x,y:P},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey});break}}}}},[e,n]);J6(t,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>({from:e.getZoomLevel(),max:8,min:.05})}})}function hw(n,e,t){const r=n.getShape(e),i=n.getShapeHandles(r);return{shape:r,handle:i.find(o=>o.id===t)}}function e8(n,e){const t=G();return v.useMemo(()=>{const r=s=>{if(s.isKilled)return;const a=wp(s.currentTarget);ed(a,s);const{shape:l,handle:c}=hw(t,n,e);c&&t.dispatch({type:"pointer",target:"handle",handle:c,shape:l,name:"pointer_down",...Hn(s)})};let i,o;return{onPointerDown:r,onPointerMove:s=>{if(s.isKilled||s.clientX===i&&s.clientY===o)return;i=s.clientX,o=s.clientY;const{shape:a,handle:l}=hw(t,n,e);l&&t.dispatch({type:"pointer",target:"handle",handle:l,shape:a,name:"pointer_move",...Hn(s)})},onPointerUp:s=>{if(s.isKilled)return;const a=wp(s.currentTarget);td(a,s);const{shape:l,handle:c}=hw(t,n,e);c&&t.dispatch({type:"pointer",target:"handle",handle:c,shape:l,name:"pointer_up",...Hn(s)})}}},[t,n,e])}var Q2="Expected a function",eP=0/0,t8="[object Symbol]",n8=/^\s+|\s+$/g,r8=/^[-+]0x[0-9a-f]+$/i,i8=/^0b[01]+$/i,o8=/^0o[0-7]+$/i,s8=parseInt,a8=typeof dt=="object"&&dt&&dt.Object===Object&&dt,l8=typeof self=="object"&&self&&self.Object===Object&&self,c8=a8||l8||Function("return this")(),d8=Object.prototype,u8=d8.toString,h8=Math.max,p8=Math.min,pw=function(){return c8.Date.now()};function f8(n,e,t){var r,i,o,s,a,l,c=0,d=!1,u=!1,h=!0;if(typeof n!="function")throw new TypeError(Q2);e=tP(e)||0,Mp(t)&&(d=!!t.leading,u="maxWait"in t,o=u?h8(tP(t.maxWait)||0,e):o,h="trailing"in t?!!t.trailing:h);function p(C){var E=r,I=i;return r=i=void 0,c=C,s=n.apply(I,E),s}function m(C){return c=C,a=setTimeout(S,e),d?p(C):s}function f(C){var E=C-l,I=C-c,A=e-E;return u?p8(A,o-I):A}function w(C){var E=C-l,I=C-c;return l===void 0||E>=e||E<0||u&&I>=o}function S(){var C=pw();if(w(C))return b(C);a=setTimeout(S,f(C))}function b(C){return a=void 0,h&&r?p(C):(r=i=void 0,s)}function _(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function x(){return a===void 0?s:b(pw())}function P(){var C=pw(),E=w(C);if(r=arguments,i=this,l=C,E){if(a===void 0)return m(l);if(u)return a=setTimeout(S,e),p(l)}return a===void 0&&(a=setTimeout(S,e)),s}return P.cancel=_,P.flush=x,P}function g8(n,e,t){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(Q2);return Mp(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),f8(n,e,{leading:r,maxWait:e,trailing:i})}function Mp(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function m8(n){return!!n&&typeof n=="object"}function y8(n){return typeof n=="symbol"||m8(n)&&u8.call(n)==t8}function tP(n){if(typeof n=="number")return n;if(y8(n))return eP;if(Mp(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Mp(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(n8,"");var t=i8.test(n);return t||o8.test(n)?s8(n.slice(2),t?2:8):r8.test(n)?eP:+n}var w8=g8;const b8=qn(w8);function v8(){const n=G();v.useLayoutEffect(()=>{const e=b8(()=>{n.updateViewportScreenBounds()},200,{trailing:!0});n.updateViewportScreenBounds();const t=setInterval(e,1e3);return window.addEventListener("resize",e),window.addEventListener("scroll",e),()=>{clearInterval(t),window.removeEventListener("resize",e),window.removeEventListener("scroll",e)}},[n])}const pt=class pt{constructor(e=0,t=0,r=0,i=0){y(this,"x",0);y(this,"y",0);y(this,"w",0);y(this,"h",0);this.x=e,this.y=t,this.w=r,this.h=i}get point(){return new k(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new k(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new k(this.minX,this.minY),new k(this.maxX,this.minY),new k(this.maxX,this.maxY),new k(this.minX,this.maxY)]}get snapPoints(){return[new k(this.minX,this.minY),new k(this.maxX,this.minY),new k(this.maxX,this.maxY),new k(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new k(this.w,this.h)}toFixed(){return this.x=bp(this.x),this.y=bp(this.y),this.w=bp(this.w),this.h=bp(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,r=0,i=0){return this.x=e,this.y=t,this.w=r,this.h=i,this}expand(e){const t=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),i=Math.max(this.maxX,e.maxX),o=Math.max(this.maxY,e.maxY);return this.x=t,this.y=r,this.w=i-t,this.h=o-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:r,h:i}=this;return new pt(e,t,r,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,i=Math.round(this.maxX/e)*e,o=Math.round(this.maxY/e)*e;this.minX=t,this.minY=r,this.width=Math.max(1,i-t),this.height=Math.max(1,o-r)}collides(e){return pt.Collides(this,e)}contains(e){return pt.Contains(this,e)}includes(e){return pt.Includes(this,e)}containsPoint(e,t=0){return pt.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new k(this.minX,this.minY);case"top_right":return new k(this.maxX,this.minY);case"bottom_left":return new k(this.minX,this.maxY);case"bottom_right":return new k(this.maxX,this.maxY);case"top":return new k(this.midX,this.minY);case"right":return new k(this.maxX,this.midY);case"bottom":return new k(this.midX,this.maxY);case"left":return new k(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,r){const{minX:i,minY:o,maxX:s,maxY:a}=this;let{minX:l,minY:c,maxX:d,maxY:u}=this;switch(e){case"left":case"top_left":case"bottom_left":{l+=t;break}case"right":case"top_right":case"bottom_right":{d+=t;break}}switch(e){case"top":case"top_left":case"top_right":{c+=r;break}case"bottom":case"bottom_left":case"bottom_right":{u+=r;break}}const h=(d-l)/(s-i),p=(u-c)/(a-o),m=h<0,f=p<0;if(m){const w=d;d=l,l=w}if(f){const w=u;u=c,c=w}this.minX=l,this.minY=c,this.width=Math.abs(d-l),this.height=Math.abs(u-c)}union(e){const t=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),i=Math.max(this.maxX,e.w+e.x),o=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=r,this.width=i-t,this.height=o-r,this}static From(e){return new pt(e.x,e.y,e.w,e.h)}static FromPoints(e){if(e.length===0)return new pt;let t=1/0,r=1/0,i=-1/0,o=-1/0,s;for(let a=0,l=e.length;a<l;a++)s=e[a],t=Math.min(s.x,t),r=Math.min(s.y,r),i=Math.max(s.x,i),o=Math.max(s.y,o);return new pt(t,r,i-t,o-r)}static Expand(e,t){const r=Math.min(t.minX,e.minX),i=Math.min(t.minY,e.minY),o=Math.max(t.maxX,e.maxX),s=Math.max(t.maxY,e.maxY);return new pt(r,i,o-r,s-i)}static ExpandBy(e,t){return new pt(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Resize(e,t,r,i,o=!1){const{minX:s,minY:a,maxX:l,maxY:c}=e;let{minX:d,minY:u,maxX:h,maxY:p}=e;switch(t){case"left":case"top_left":case"bottom_left":{d+=r;break}case"right":case"top_right":case"bottom_right":{h+=r;break}}switch(t){case"top":case"top_left":case"top_right":{u+=i;break}case"bottom":case"bottom_left":case"bottom_right":{p+=i;break}}const m=(h-d)/(l-s),f=(p-u)/(c-a),w=m<0,S=f<0;if(o){const _=(l-s)/(c-a),x=Math.abs(h-d),P=Math.abs(p-u),C=x*(f<0?1:-1)*(1/_),E=P*(m<0?1:-1)*_,I=_<x/P;switch(t){case"top_left":{I?u=p+C:d=h+E;break}case"top_right":{I?u=p+C:h=d-E;break}case"bottom_right":{I?p=u-C:h=d-E;break}case"bottom_left":{I?p=u-C:d=h+E;break}case"bottom":case"top":{const A=(d+h)/2,T=P*_;d=A-T/2,h=A+T/2;break}case"left":case"right":{const A=(u+p)/2,T=x/_;u=A-T/2,p=A+T/2;break}}}if(w){const _=h;h=d,d=_}if(S){const _=p;p=u,u=_}const b=new pt(d,u,Math.abs(h-d),Math.abs(p-u));return{box:b,scaleX:+(b.width/e.width*(m>0?1:-1)).toFixed(5),scaleY:+(b.height/e.height*(f>0?1:-1)).toFixed(5)}}equals(e){return pt.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new pt(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}};y(pt,"Collides",(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)),y(pt,"Contains",(e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX),y(pt,"Includes",(e,t)=>pt.Collides(e,t)||pt.Contains(e,t)),y(pt,"ContainsPoint",(e,t,r=0)=>!(t.x<e.minX-r||t.y<e.minY-r||t.x>e.maxX+r||t.y>e.maxY+r)),y(pt,"Common",e=>{let t=1/0,r=1/0,i=-1/0,o=-1/0;for(let s=0;s<e.length;s++){const a=e[s];t=Math.min(t,a.minX),r=Math.min(r,a.minY),i=Math.max(i,a.maxX),o=Math.max(o,a.maxY)}return new pt(t,r,i-t,o-r)}),y(pt,"Sides",(e,t=0)=>{const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]});let de=pt;function S8(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function x8(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function _8(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}const Be=class Be{constructor(e,t,r,i,o,s){y(this,"a",1);y(this,"b",0);y(this,"c",0);y(this,"d",1);y(this,"e",0);y(this,"f",0);this.a=e,this.b=t,this.c=r,this.d=i,this.e=o,this.f=s}equals(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:r,b:i,c:o,d:s,e:a,f:l}=this;return this.a=r*t.a+o*t.b,this.c=r*t.c+o*t.d,this.e=r*t.e+o*t.f+a,this.b=i*t.a+s*t.b,this.d=i*t.c+s*t.d,this.f=i*t.e+s*t.f+l,this}rotate(e,t,r){return e===0?this:t===void 0?this.multiply(Be.Rotate(e)):this.translate(t,r).multiply(Be.Rotate(e)).translate(-t,-r)}translate(e,t){return this.multiply(Be.Translate(e,t))}scale(e,t){return this.multiply(Be.Scale(e,t))}invert(){const{a:e,b:t,c:r,d:i,e:o,f:s}=this,a=e*i-t*r;return this.a=i/a,this.b=t/-a,this.c=r/-a,this.d=e/a,this.e=(i*o-r*s)/-a,this.f=(t*o-e*s)/a,this}applyToPoint(e){return Be.applyToPoint(this,e)}applyToPoints(e){return Be.applyToPoints(this,e)}rotation(){return Be.Rotation(this)}point(){return Be.Point(this)}decomposed(){return Be.Decompose(this)}toCssString(){return Be.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return Be.Decompose(this)}clone(){return new Be(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Be(1,0,0,1,0,0)}static Translate(e,t){return new Be(1,0,0,1,e,t)}static Rotate(e,t,r){if(e===0)return Be.Identity();const i=Math.cos(e),o=Math.sin(e),s=new Be(i,o,-o,i,0,0);return t===void 0?s:Be.Compose(Be.Translate(t,r),s,Be.Translate(-t,-r))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=Be.Identity();for(let r=0,i=e.length;r<i;r++)t.multiply(e[r]);return t}static Point(e){return new k(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const r=Math.hypot(e.a,e.c);t=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=Math.hypot(e.b,e.d);t=rt+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0;return ow(t)}static Decompose(e){let t,r,i;if(e.a!==0||e.c!==0){const o=Math.hypot(e.a,e.c);t=o,r=(e.a*e.d-e.b*e.c)/o,i=Math.acos(e.a/o)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const o=Math.hypot(e.b,e.d);t=(e.a*e.d-e.b*e.c)/o,r=o,i=rt+Math.acos(e.b/o)*(e.d>0?-1:1)}else t=0,r=0,i=0;return{x:e.e,y:e.f,scaleX:t,scaleY:r,rotation:ow(i)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${R(e.a)}, ${R(e.b)}, ${R(e.c)}, ${R(e.d)}, ${R(e.e)}, ${R(e.f)})`}static applyToPoint(e,t){return new k(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,r){return[e.a*t+e.c*r+e.e,e.b*t+e.d*r+e.f]}static applyToPoints(e,t){return t.map(r=>new k(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,t){return new de(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new Be(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof Be?e:Be.From(e)}};y(Be,"Scale",(e,t,r,i)=>{const o=new Be(e,0,0,t,0,0);return r===void 0?o:Be.Compose(Be.Translate(r,i),o,Be.Translate(-r,-i))});let oe=Be;function k8(n=!0){const[e,t]=v.useState(0),r=G();v.useEffect(()=>{if(!n)return;const i=()=>t(o=>o+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,n])}const C8=ze(function({showStroke:n=!0,showVertices:e=!0,showClosestPointOnOutline:t=!0}){const r=G();k8(t);const i=r.getZoomLevel(),o=r.getRenderingShapes(),{inputs:{currentPagePoint:s}}=r;return g.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(a=>{const l=r.getShape(a.id);if(l.type==="group")return null;const c=r.getShapeGeometry(l),d=r.getShapePageTransform(l),u=r.getPointInShapeSpace(l,s),h=c.nearestPoint(u),p=c.distanceToPoint(u,!0),m=Math.abs(p)*i,f=p<0,{vertices:w}=c;return g.jsxs("g",{transform:d.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[n&&g.jsx("path",{stroke:"red",strokeWidth:"2",fill:"none",opacity:"1",d:c.toSimpleSvgPath()}),e&&w.map((S,b)=>g.jsx("circle",{cx:S.x,cy:S.y,r:"2",fill:`hsl(${Qh(b,[0,w.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:"1"},`v${b}`)),t&&m<150&&g.jsx("line",{x1:h.x,y1:h.y,x2:u.x,y2:u.y,opacity:1-m/150,stroke:f?"goldenrod":"dodgerblue",strokeWidth:"2"})]},a.id+"_outline")})})});var P8=200,fw="__lodash_hash_undefined__",E8=1/0,I8="[object Function]",M8="[object GeneratorFunction]",A8=/[\\^$.*+?()[\]{}|]/g,T8=/^\[object .+?Constructor\]$/,j8=typeof dt=="object"&&dt&&dt.Object===Object&&dt,R8=typeof self=="object"&&self&&self.Object===Object&&self,gw=j8||R8||Function("return this")();function O8(n,e){var t=n?n.length:0;return!!t&&z8(n,e,0)>-1}function D8(n,e,t){for(var r=-1,i=n?n.length:0;++r<i;)if(t(e,n[r]))return!0;return!1}function L8(n,e,t,r){for(var i=n.length,o=t+(r?1:-1);r?o--:++o<i;)if(e(n[o],o,n))return o;return-1}function z8(n,e,t){if(e!==e)return L8(n,N8,t);for(var r=t-1,i=n.length;++r<i;)if(n[r]===e)return r;return-1}function N8(n){return n!==n}function F8(n,e){return n.has(e)}function $8(n,e){return n==null?void 0:n[e]}function B8(n){var e=!1;if(n!=null&&typeof n.toString!="function")try{e=!!(n+"")}catch{}return e}function nP(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var U8=Array.prototype,V8=Function.prototype,rP=Object.prototype,mw=gw["__core-js_shared__"],iP=function(){var n=/[^.]+$/.exec(mw&&mw.keys&&mw.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),oP=V8.toString,yw=rP.hasOwnProperty,H8=rP.toString,W8=RegExp("^"+oP.call(yw).replace(A8,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),K8=U8.splice,G8=bw(gw,"Map"),ww=bw(gw,"Set"),fd=bw(Object,"create");function Bs(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function Y8(){this.__data__=fd?fd(null):{}}function X8(n){return this.has(n)&&delete this.__data__[n]}function q8(n){var e=this.__data__;if(fd){var t=e[n];return t===fw?void 0:t}return yw.call(e,n)?e[n]:void 0}function J8(n){var e=this.__data__;return fd?e[n]!==void 0:yw.call(e,n)}function Z8(n,e){var t=this.__data__;return t[n]=fd&&e===void 0?fw:e,this}Bs.prototype.clear=Y8,Bs.prototype.delete=X8,Bs.prototype.get=q8,Bs.prototype.has=J8,Bs.prototype.set=Z8;function sl(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function Q8(){this.__data__=[]}function eN(n){var e=this.__data__,t=Tp(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():K8.call(e,t,1),!0}function tN(n){var e=this.__data__,t=Tp(e,n);return t<0?void 0:e[t][1]}function nN(n){return Tp(this.__data__,n)>-1}function rN(n,e){var t=this.__data__,r=Tp(t,n);return r<0?t.push([n,e]):t[r][1]=e,this}sl.prototype.clear=Q8,sl.prototype.delete=eN,sl.prototype.get=tN,sl.prototype.has=nN,sl.prototype.set=rN;function al(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function iN(){this.__data__={hash:new Bs,map:new(G8||sl),string:new Bs}}function oN(n){return jp(this,n).delete(n)}function sN(n){return jp(this,n).get(n)}function aN(n){return jp(this,n).has(n)}function lN(n,e){return jp(this,n).set(n,e),this}al.prototype.clear=iN,al.prototype.delete=oN,al.prototype.get=sN,al.prototype.has=aN,al.prototype.set=lN;function Ap(n){var e=-1,t=n?n.length:0;for(this.__data__=new al;++e<t;)this.add(n[e])}function cN(n){return this.__data__.set(n,fw),this}function dN(n){return this.__data__.has(n)}Ap.prototype.add=Ap.prototype.push=cN,Ap.prototype.has=dN;function Tp(n,e){for(var t=n.length;t--;)if(wN(n[t][0],e))return t;return-1}function uN(n){if(!sP(n)||gN(n))return!1;var e=bN(n)||B8(n)?W8:T8;return e.test(mN(n))}function hN(n,e,t){var r=-1,i=O8,o=n.length,s=!0,a=[],l=a;if(t)s=!1,i=D8;else if(o>=P8){var c=e?null:pN(n);if(c)return nP(c);s=!1,i=F8,l=new Ap}else l=e?[]:a;e:for(;++r<o;){var d=n[r],u=e?e(d):d;if(d=t||d!==0?d:0,s&&u===u){for(var h=l.length;h--;)if(l[h]===u)continue e;e&&l.push(u),a.push(d)}else i(l,u,t)||(l!==a&&l.push(u),a.push(d))}return a}var pN=ww&&1/nP(new ww([,-0]))[1]==E8?function(n){return new ww(n)}:vN;function jp(n,e){var t=n.__data__;return fN(e)?t[typeof e=="string"?"string":"hash"]:t.map}function bw(n,e){var t=$8(n,e);return uN(t)?t:void 0}function fN(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function gN(n){return!!iP&&iP in n}function mN(n){if(n!=null){try{return oP.call(n)}catch{}try{return n+""}catch{}}return""}function yN(n){return n&&n.length?hN(n):[]}function wN(n,e){return n===e||n!==n&&e!==e}function bN(n){var e=sP(n)?H8.call(n):"";return e==I8||e==M8}function sP(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function vN(){}var SN=yN;const xN=qn(SN);function aP(n){return xN(n)}function _N(){const n=G(),e=v.useMemo(()=>n.store.query.records("instance_presence",()=>({userId:{neq:n.user.getId()}})),[n]),t=AC("userIds",()=>aP(e.get().map(r=>r.userId)).sort(),{isEqual:(r,i)=>{var o;return r.join(",")===((o=i.join)==null?void 0:o.call(i,","))}},[e]);return q(t)}function lP(n){const e=G(),t=v.useMemo(()=>e.store.query.records("instance_presence",()=>({userId:{eq:n}})),[e,n]);return q(`latestPresence:${n}`,()=>t.get().slice().sort((r,i)=>i.lastActivityTimestamp-r.lastActivityTimestamp)[0],[])??null}const kN=ze(function(){const n=_N();return g.jsx(g.Fragment,{children:n.map(e=>g.jsx(CN,{collaboratorId:e},e))})}),CN=ze(function({collaboratorId:n}){const e=G(),t=lP(n),r=EN(t);if(!(t&&t.currentPageId===e.getCurrentPageId()))return null;switch(r){case"inactive":{const{followingUserId:i,highlightedUserIds:o}=e.getInstanceState();if(!(i===t.userId||o.includes(t.userId)))return null;break}case"idle":{const{highlightedUserIds:i}=e.getInstanceState();if(t.followingUserId===e.user.getId()&&!(t.chatMessage||i.includes(t.userId)))return null;break}}return g.jsx(PN,{latestPresence:t})}),PN=ze(function({latestPresence:n}){const e=G(),{CollaboratorBrush:t,CollaboratorScribble:r,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:s}=$t(),a=e.getZoomLevel(),l=e.getViewportPageBounds(),{userId:c,chatMessage:d,brush:u,scribbles:h,selectedShapeIds:p,userName:m,cursor:f,color:w}=n,S=!(f.x<l.minX-12/a||f.y<l.minY-16/a||f.x>l.maxX-12/a||f.y>l.maxY-16/a);return g.jsxs(g.Fragment,{children:[u&&t?g.jsx(t,{className:"tl-collaborator__brush",brush:u,color:w,opacity:.1},c+"_brush"):null,S&&i?g.jsx(i,{className:"tl-collaborator__cursor",point:f,color:w,zoom:a,name:m!=="New User"?m:null,chatMessage:d},c+"_cursor"):o?g.jsx(o,{className:"tl-collaborator__cursor-hint",point:f,color:w,zoom:a,viewport:l},c+"_cursor_hint"):null,r&&h.length?g.jsx(g.Fragment,{children:h.map(b=>g.jsx(r,{className:"tl-collaborator__scribble",scribble:b,color:w,zoom:a,opacity:b.color==="laser"?.5:.1},c+"_scribble_"+b.id))}):null,s&&p.map(b=>g.jsx(s,{className:"tl-collaborator__shape-indicator",id:b,color:w,opacity:.5},c+"_"+b))]})});function cP(n){return n>Tz?"inactive":n>E2?"idle":"active"}function EN(n){const e=v.useRef((n==null?void 0:n.lastActivityTimestamp)??-1),[t,r]=v.useState(()=>cP(Date.now()-e.current));return v.useEffect(()=>{const i=setInterval(()=>{r(cP(Date.now()-e.current))},jz);return()=>clearInterval(i)},[]),n&&(e.current=n.lastActivityTimestamp),t}function dP(n,e){return e===0?n:dP(e,n%e)}function uP(n){const e=n.toString().split(".")[1];if(!e)return 1;const t=Math.pow(10,e.length),r=parseInt(e,10);return t/dP(r,t)}function IN(){const n=G(),e=hn();v.useEffect(()=>Uc("useDPRMultiple",()=>{const t=n.getInstanceState().devicePixelRatio;e.style.setProperty("--tl-dpr-multiple",uP(t).toString())}),[n,e])}const hP=ze(function({id:n,shape:e,util:t,index:r,backgroundIndex:i,opacity:o,isCulled:s}){const a=G(),{ShapeErrorFallback:l}=$t(),c=v.useRef(null),d=v.useRef(null),u=v.useCallback((p,m)=>{var f,w;(f=c.current)==null||f.style.setProperty(p,m),(w=d.current)==null||w.style.setProperty(p,m)},[]);Ds("set shape container transform position",()=>{if(!a.getShape(n))return;const p=a.getShapePageTransform(n),m=oe.toCssString(p);u("transform",m)},[a,u]),Ds("set shape container clip path",()=>{if(!a.getShape(n))return null;const p=a.getShapeClipPath(n);u("clip-path",p??"none")},[a,u]),Ds("set shape height and width",()=>{const p=a.getShape(n);if(!p)return null;const m=a.getShapeGeometry(p).bounds,f=Math.floor(a.getInstanceState().devicePixelRatio*100)/100,w=uP(f),S=m.w%w,b=S===0?m.w:m.w+(w-S),_=m.h%w,x=_===0?m.h:m.h+(w-_);u("width",Math.max(b,w)+"px"),u("height",Math.max(x,w)+"px")},[a]),v.useLayoutEffect(()=>{var p,m;u("opacity",o+""),(p=c.current)==null||p.style.setProperty("z-index",r+""),(m=d.current)==null||m.style.setProperty("z-index",i+"")},[o,r,i,u]);const h=v.useCallback(p=>{a.annotateError(p,{origin:"react.shape",willCrashApp:!1})},[a]);return e?g.jsxs(g.Fragment,{children:[t.backgroundComponent&&g.jsx("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":e.type,draggable:!1,children:!s&&g.jsx(rd,{fallback:l,onError:h,children:g.jsx(AN,{shape:e,util:t})})}),g.jsx("div",{ref:c,className:"tl-shape","data-shape-type":e.type,draggable:!1,children:s?g.jsx(TN,{shape:e}):g.jsx(rd,{fallback:l,onError:h,children:g.jsx(MN,{shape:e,util:t})})})]}):null}),MN=v.memo(function({shape:n,util:e}){return Xh("InnerShape:"+n.type,()=>e.component(n))},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta&&n.util===e.util),AN=v.memo(function({shape:n,util:e}){return Xh("InnerShape:"+n.type,()=>{var t;return(t=e.backgroundComponent)==null?void 0:t.call(e,n)})},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta),TN=v.memo(function({shape:n}){const e=G().getShapeGeometry(n).bounds;return g.jsx("div",{className:"tl-shape__culled",style:{transform:`translate(${R(e.minX)}px, ${R(e.minY)}px)`,width:Math.max(1,R(e.width)),height:Math.max(1,R(e.height))}})},()=>!0);function vw({className:n}){const e=G(),{Background:t,SvgDefs:r}=$t(),i=re.useRef(null),o=re.useRef(null),s=re.useRef(null);v8(),iz(),nz(),Q6(i),qz(i),Ds("position layers",()=>{const h=o.current;if(!h)return;const p=s.current;if(!p)return;const{x:m,y:f,z:w}=e.getCamera(),S=w>=1?Qh(w,[1,8],[.125,.5],!0):Qh(w,[.1,1],[-2,.125],!0),b=`scale(${R(w)}) translate(${R(m+S)}px,${R(f+S)}px)`;h.style.setProperty("transform",b),p.style.setProperty("transform",b)},[e]);const a=tz(),l=q("shapeSvgDefs",()=>{const h=new Map;for(const p of _t(e.shapeUtils)){if(!p)return;const m=p.getCanvasSvgDefs();for(const{key:f,component:w}of m)h.has(f)||h.set(f,g.jsx(w,{},f))}return[...h.values()]},[e]),c=q("debug_shapes",()=>nt.hideShapes.get(),[nt]),d=q("debug_svg",()=>nt.debugSvg.get(),[nt]),u=q("debug_geometry",()=>nt.debugGeometry.get(),[nt]);return g.jsxs("div",{ref:i,draggable:!1,className:ye("tl-canvas",n),"data-testid":"canvas",...a,children:[t&&g.jsx(t,{}),g.jsx(jN,{}),g.jsx(XN,{}),g.jsx("svg",{className:"tl-svg-context",children:g.jsxs("defs",{children:[l,pP&&g.jsx(pP,{}),g.jsx(WN,{}),g.jsx(KN,{}),g.jsx(GN,{}),r&&g.jsx(r,{})]})}),g.jsxs("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[g.jsx(ZN,{}),g.jsx(JN,{}),c?null:d?g.jsx($N,{}):g.jsx(BN,{})]}),g.jsxs("div",{className:"tl-fixed-layer tl-overlays",children:[g.jsxs("div",{ref:s,className:"tl-html-layer",children:[u?g.jsx(C8,{}):null,g.jsx(NN,{}),g.jsx(ON,{}),g.jsx(RN,{}),g.jsx(DN,{}),g.jsx(UN,{}),g.jsx(VN,{}),g.jsx(HN,{}),g.jsx(LN,{}),g.jsx(qN,{}),g.jsx(kN,{})]}),g.jsx(QN,{})]})]})}function jN(){const n=G(),e=q("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:t,y:r,z:i}=q("camera",()=>n.getCamera(),[n]),o=q("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:s}=$t();return s&&o?g.jsx(s,{x:t,y:r,z:i,size:e}):null}function RN(){const n=G(),e=q("scribbles",()=>n.getInstanceState().scribbles,[n]),t=q("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:r}=$t();return r&&e.length?g.jsx(g.Fragment,{children:e.map(i=>g.jsx(r,{className:"tl-user-scribble",scribble:i,zoom:t},i.id))}):null}function ON(){const n=G(),e=q("brush",()=>n.getInstanceState().brush,[n]),{Brush:t}=$t();return t&&e?g.jsx(t,{className:"tl-user-brush",brush:e}):null}function DN(){const n=G(),e=q("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:t}=$t();return t&&e?g.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function LN(){const n=G(),e=q("snapLines",()=>n.snaps.getLines(),[n]),t=q("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapLine:r}=$t();return r&&e.length>0?g.jsx(g.Fragment,{children:e.map(i=>g.jsx(r,{className:"tl-user-snapline",line:i,zoom:t},i.id))}):null}const zN=48;function NN(){const n=G(),{Handles:e}=$t(),t=q("zoomLevel",()=>n.getZoomLevel(),[n]),r=q("coarse pointer",()=>n.getInstanceState().isCoarsePointer,[n]),i=q("onlySelectedShape",()=>n.getOnlySelectedShape(),[n]),o=q("isChangingStyle",()=>n.getInstanceState().isChangingStyle,[n]),s=q("isChangingStyle",()=>n.getInstanceState().isReadonly,[n]),a=q("handles",()=>{const d=n.getOnlySelectedShape();if(d)return n.getShapeHandles(d)},[n]),l=q("transform",()=>{const d=n.getOnlySelectedShape();if(d)return n.getShapePageTransform(d)},[n]);if(!e||!i||o||s||!a||!l)return null;const c=[];for(let d=0,u=a[d];d<a.length;d++,u=a[d]){if(u.type!=="vertex"){const h=a[d-1],p=a[d+1];if(h&&p&&Math.hypot(h.y-p.y,h.x-p.x)<zN/t)continue}c.push(u)}return c.sort(d=>d.type==="vertex"?1:-1),g.jsx(e,{children:g.jsx("g",{transform:oe.toCssString(l),children:c.map(d=>g.jsx(FN,{shapeId:i.id,handle:d,zoom:t,isCoarse:r},d.id))})})}function FN({shapeId:n,handle:e,zoom:t,isCoarse:r}){const i=e8(n,e.id),{Handle:o}=$t();return o?g.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:g.jsx(o,{shapeId:n,handle:e,zoom:t,isCoarse:r})}):null}function $N(){const n=G(),e=q("rendering shapes",()=>n.getRenderingShapes(),[n]);return g.jsx(g.Fragment,{children:e.map(t=>g.jsxs(re.Fragment,{children:[g.jsx(hP,{...t}),g.jsx(YN,{id:t.id})]},t.id+"_fragment"))})}function BN(){const n=G(),e=q("rendering shapes",()=>n.getRenderingShapes(),[n]);return g.jsx(g.Fragment,{children:e.map(t=>g.jsx(hP,{...t},t.id+"_shape"))})}function UN(){const n=G(),e=q("selectedShapeIds",()=>n.getCurrentPageState().selectedShapeIds,[n]);return q("should display selected ids",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!n.getInstanceState().isChangingStyle,[n])?g.jsx(g.Fragment,{children:e.map(t=>g.jsx(id,{className:"tl-user-indicator__selected",id:t},t+"_indicator"))}):null}const VN=function(){const n=G(),{HoveredShapeIndicator:e}=$t(),t=q("coarse pointer",()=>n.getInstanceState().isCoarsePointer,[n]),r=q("hovering canvas",()=>n.getInstanceState().isHoveringCanvas,[n]),i=q("hovered id",()=>n.getCurrentPageState().hoveredShapeId,[n]);return t||!r||!i||!e?null:g.jsx(e,{shapeId:i})},HN=ze(function(){const n=G(),e=Jh(n.getHintingShapeIds());return e.length?g.jsx(g.Fragment,{children:e.map(t=>g.jsx(id,{className:"tl-user-indicator__hint",id:t},t+"_hinting"))}):null});function pP(){return g.jsxs("g",{id:"cursor",children:[g.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[g.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),g.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),g.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[g.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),g.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),g.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[g.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),g.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function WN(){return g.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function KN(){return g.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:g.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function GN(){return g.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[g.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),g.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const YN=ze(function({id:n}){const e=G(),t=e.getShape(n),[r,i]=re.useState(""),o=(t==null?void 0:t.parentId)===e.getCurrentPageId();return re.useEffect(()=>{if(!o)return;let s=null;const a=Uc("shape to svg",async()=>{const l=Math.random();s=l;const c=e.getShapePageBounds(n),d=await e.getSvg([n],{padding:0});d&&c&&s===l&&(d.style.setProperty("overflow","visible"),d.setAttribute("preserveAspectRatio","xMidYMin slice"),d.style.setProperty("transform",`translate(${c.x}px, ${c.y+c.h+12}px)`),d.style.setProperty("border","1px solid black"),i(d==null?void 0:d.outerHTML))});return()=>{s=null,a()}},[e,n,o]),o?g.jsx("div",{style:{paddingTop:12,position:"absolute"},children:g.jsx("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:r}})}):null});function XN(){const n=q("debugging ui log",()=>nt.logMessages.get(),[nt]);return n.length?g.jsx("div",{className:"debug__ui-logger",children:n.map((e,t)=>{const r=typeof e=="string"?e:JSON.stringify(e);return g.jsx("div",{className:"debug__ui-logger__line",children:r},t)})}):null}function qN(){const n=G(),e=q("selection rotation",()=>n.getSelectionRotation(),[n]),t=q("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:r}=$t();return!t||!r?null:g.jsx(r,{bounds:t,rotation:e})}function JN(){const n=G(),e=q("selection rotation",()=>n.getSelectionRotation(),[n]),t=q("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:r}=$t();return!t||!r?null:g.jsx(r,{bounds:t,rotation:e})}function ZN(){const{OnTheCanvas:n}=$t();return n?g.jsx(n,{}):null}function QN(){const{InFrontOfTheCanvas:n}=$t();return n?g.jsx(n,{}):null}const eF=()=>g.jsx(iE,{children:"Connecting..."});function qe(){return np()}const fP="TLDRAW_USER_DATA_v3",gP=Me({id:Se,name:Se.nullable().optional(),locale:Se.nullable().optional(),color:Se.nullable().optional(),isDarkMode:Ee.nullable().optional(),animationSpeed:we.nullable().optional(),edgeScrollSpeed:we.nullable().optional(),isSnapMode:Ee.nullable().optional()}),gd={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4},Rp=Ne({currentVersion:gd.AddEdgeScrollSpeed,migrators:{[gd.AddAnimationSpeed]:{up:n=>({...n,animationSpeed:1}),down:({animationSpeed:n,...e})=>e},[gd.AddIsSnapMode]:{up:n=>({...n,isSnapMode:!1}),down:({isSnapMode:n,...e})=>e},[gd.MakeFieldsNullable]:{up:n=>n,down:n=>({id:n.id,name:n.name??Er.name,locale:n.locale??Er.locale,color:n.color??Er.color,isDarkMode:n.isDarkMode??Er.isDarkMode,animationSpeed:n.animationSpeed??Er.animationSpeed,isSnapMode:n.isSnapMode??Er.isSnapMode})},[gd.AddEdgeScrollSpeed]:{up:n=>({...n,edgeScrollSpeed:1}),down:({edgeScrollSpeed:n,...e})=>e}}}),mP=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function tF(){return mP[Math.floor(Math.random()*mP.length)]}function nF(){var n,e;return typeof window>"u"?!1:((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-color-scheme: dark)"))==null?void 0:e.matches)??!1}function rF(){var n,e;return typeof window>"u"?!1:((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1}const Er=Object.freeze({name:"New User",locale:GL(),color:tF(),isDarkMode:!1,edgeScrollSpeed:1,animationSpeed:rF()?0:1,isSnapMode:!1});function Sw(){return{id:qe()}}function yP(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return Sw();const e=$0({value:n.user,fromVersion:n.version,toVersion:Rp.currentVersion??0,migrations:Rp});if(e.type==="error")return Sw();try{gP.validate(e.value)}catch{return Sw()}return e.value}function iF(){var e;const n=typeof window>"u"?null:JSON.parse(((e=window==null?void 0:window.localStorage)==null?void 0:e.getItem(fP))||"null")??null;return yP(n)}const md=Cn("globalUserData",iF());function oF(){typeof window<"u"&&window.localStorage&&window.localStorage.setItem(fP,JSON.stringify({version:Rp.currentVersion,user:md.get()}))}function sF(n){gP.validate(n),md.set(n),oF(),lF()}const aF=typeof process<"u"&&!1,ll=typeof BroadcastChannel<"u"&&!aF?new BroadcastChannel("tldraw-user-sync"):null;ll==null||ll.addEventListener("message",n=>{const e=n.data;(e==null?void 0:e.type)===bP&&(e==null?void 0:e.origin)!==wP&&md.set(yP(e.data))});const wP=qe(),bP="tldraw-user-preferences-change";function lF(){ll==null||ll.postMessage({type:bP,origin:wP,data:{user:md.get(),version:Rp.currentVersion}})}function cF(){return md.get()}function vP(n={}){return{derivePresenceState:n.derivePresenceState??(()=>Q("presence",()=>null)),userPreferences:n.userPreferences??Q("userPreferences",()=>cF()),setUserPreferences:n.setUserPreferences??sF}}var SP={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,c,d){this.fn=l,this.context=c,this.once=d||!1}function o(l,c,d,u,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new i(d,u||l,h),m=t?t+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],p]:l._events[m].push(p):(l._events[m]=p,l._eventsCount++),l}function s(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=t?t+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,h=d.length,p=new Array(h);u<h;u++)p[u]=d[u].fn;return p},a.prototype.listenerCount=function(l){var c=t?t+l:l,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,c,d,u,h,p){var m=t?t+l:l;if(!this._events[m])return!1;var f=this._events[m],w=arguments.length,S,b;if(f.fn){switch(f.once&&this.removeListener(l,f.fn,void 0,!0),w){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,c),!0;case 3:return f.fn.call(f.context,c,d),!0;case 4:return f.fn.call(f.context,c,d,u),!0;case 5:return f.fn.call(f.context,c,d,u,h),!0;case 6:return f.fn.call(f.context,c,d,u,h,p),!0}for(b=1,S=new Array(w-1);b<w;b++)S[b-1]=arguments[b];f.fn.apply(f.context,S)}else{var _=f.length,x;for(b=0;b<_;b++)switch(f[b].once&&this.removeListener(l,f[b].fn,void 0,!0),w){case 1:f[b].fn.call(f[b].context);break;case 2:f[b].fn.call(f[b].context,c);break;case 3:f[b].fn.call(f[b].context,c,d);break;case 4:f[b].fn.call(f[b].context,c,d,u);break;default:if(!S)for(x=1,S=new Array(w-1);x<w;x++)S[x-1]=arguments[x];f[b].fn.apply(f[b].context,S)}}return!0},a.prototype.on=function(l,c,d){return o(this,l,c,d,!1)},a.prototype.once=function(l,c,d){return o(this,l,c,d,!0)},a.prototype.removeListener=function(l,c,d,u){var h=t?t+l:l;if(!this._events[h])return this;if(!c)return s(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!u||p.once)&&(!d||p.context===d)&&s(this,h);else{for(var m=0,f=[],w=p.length;m<w;m++)(p[m].fn!==c||u&&!p[m].once||d&&p[m].context!==d)&&f.push(p[m]);f.length?this._events[h]=f.length===1?f[0]:f:s(this,h)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=t?t+l:l,this._events[c]&&s(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(SP);var dF=SP.exports;function ar({children:n,className:e="",...t}){return g.jsx("svg",{...t,className:`tl-svg-container ${e}`,children:n})}class Us{constructor(e){y(this,"isFilled",!1);y(this,"isClosed",!0);y(this,"isLabel",!1);y(this,"isSnappable",!0);y(this,"_vertices");y(this,"_bounds");y(this,"_snapPoints");y(this,"_area");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isSnappable=e.isSnappable??!1,this.isLabel=e.isLabel??!1}hitTestPoint(e,t=0,r=!1){return this.distanceToPoint(e,r)<=t}distanceToPoint(e,t=!1){const r=e.dist(this.nearestPoint(e));return this.isClosed&&(this.isFilled||t)&&bi(e,this.vertices)?-r:r}distanceToLineSegment(e,t){const r=this.nearestPointOnLineSegment(e,t),i=k.DistanceToLineSegment(e,t,r);return this.isClosed&&this.isFilled&&bi(r,this.vertices)?-i:i}hitTestLineSegment(e,t,r=0){return this.distanceToLineSegment(e,t)<=r}nearestPointOnLineSegment(e,t){let r=1/0,i;for(let o=0;o<this.vertices.length;o++){const s=this.vertices[o],a=k.DistanceToLineSegment(e,t,s);a<r&&(r=a,i=s)}if(!i)throw Error("nearest point not found");return i}isPointInBounds(e,t=0){const{bounds:r}=this;return!(e.x<r.minX-t||e.y<r.minY-t||e.x>r.maxX+t||e.y>r.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return de.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get snapPoints(){return this._snapPoints||(this._snapPoints=this.bounds.snapPoints),this._snapPoints}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let r=0,i=e.length;r<i;r++){const o=e[r],s=e[(r+1)%i];t+=o.x*s.y-s.x*o.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,r=t.length;if(r===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let i=1;i<r;i++)e+=`L${t[i].x},${t[i].y}`;return this.isClosed&&(e+="Z"),e}}class Ko extends Us{constructor(t){super({...t,isClosed:!0,isFilled:!1});y(this,"children");const{children:r}=t;if(r.length===0)throw Error("Group2d must have at least one child");this.children=r}getVertices(){return this.children.filter(t=>!t.isLabel).flatMap(t=>t.vertices)}nearestPoint(t){let r=1/0,i;const{children:o}=this;if(o.length===0)throw Error("no children");for(const s of o){const a=s.nearestPoint(t),l=a.dist(t);l<r&&(r=l,i=a)}if(!i)throw Error("nearest point not found");return i}distanceToPoint(t,r=!1){return Math.min(...this.children.map((i,o)=>i.distanceToPoint(t,r||o>0)))}hitTestPoint(t,r,i){return!!this.children.filter(o=>!o.isLabel).find(o=>o.hitTestPoint(t,r,i))}hitTestLineSegment(t,r,i){return!!this.children.filter(o=>!o.isLabel).find(o=>o.hitTestLineSegment(t,r,i))}getArea(){return this.children[0].area}toSimpleSvgPath(){let t="";for(const i of this.children)t+=i.toSimpleSvgPath();const r=de.FromPoints(this.vertices).corners;for(let i=0,o=r.length;i<o;i++){const s=r[i],a=r[(i-1+o)%o],l=s.dist(a),c=r[(i+1)%o],d=s.dist(c),u=s.clone().lrp(a,4/l),h=s,p=s.clone().lrp(c,4/d);t+=`M${u.x},${u.y} L${h.x},${h.y} L${p.x},${p.y} `}return t}}function xw(n,e,t,r){const i=n.x-t.x,o=n.y-t.y,s=r.x-t.x,a=r.y-t.y,l=e.x-n.x,c=e.y-n.y,d=s*o-a*i,u=l*o-c*i,h=a*l-s*c;if(d===0||u===0||h===0)return null;if(h!==0){const p=d/h,m=u/h;if(0<=p&&p<=1&&0<=m&&m<=1)return k.AddXY(n,p*l,p*c)}return null}function Op(n,e,t,r){const i=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),o=2*((e.x-n.x)*(n.x-t.x)+(e.y-n.y)*(n.y-t.y)),s=t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-r*r,a=o*o-4*i*s;if(a<0||a===0)return null;const l=Math.sqrt(a),c=(-o+l)/(2*i),d=(-o-l)/(2*i);if((c<0||c>1)&&(d<0||d>1))return null;const u=[];return 0<=c&&c<=1&&u.push(k.Lrp(n,e,c)),0<=d&&d<=1&&u.push(k.Lrp(n,e,d)),u.length===0?null:u}function xP(n,e,t){const r=[];let i;for(let o=0,s=t.length-1;o<s;o++)i=xw(n,e,t[o],t[o+1]),i&&r.push(i);return r.length===0?null:r}function uF(n,e,t){const r=[];let i;for(let o=1,s=t.length;o<s+1;o++)i=xw(n,e,t[o-1],t[o%t.length]),i&&r.push(i);return r.length===0?null:r}function hF(n,e,t,r){let i=t.x-n.x,o=t.y-n.y;const s=Math.sqrt(i*i+o*o),a=(s*s-r*r+e*e)/(2*s),l=Math.sqrt(e*e-a*a);return i/=s,o/=s,[new k(n.x+i*a-o*l,n.y+o*a+i*l),new k(n.x+i*a+o*l,n.y+o*a-i*l)]}function _P(n,e,t){const r=[];let i,o,s;for(let a=0,l=t.length;a<l;a++)i=t[a],o=t[(a+1)%t.length],s=Op(i,o,n,e),s&&r.push(...s);return r.length===0?null:r}function kP(n,e,t){const r=[];let i,o,s;for(let a=1,l=t.length;a<l;a++)i=t[a-1],o=t[a],s=Op(i,o,n,e),s&&r.push(...s);return r.length===0?null:r}function Dp(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function CP(n,e,t,r){return Dp(n,t,r)!==Dp(e,t,r)&&Dp(n,e,t)!==Dp(n,e,r)}function _w(n,e){const t=new Map;let r,i,o,s;for(let a=0,l=n.length;a<l;a++)if(r=n[a],bi(r,e)){const c=kw(r);t.has(c)||t.set(c,r)}for(let a=0,l=e.length;a<l;a++)if(r=e[a],bi(r,n)){const c=kw(r);t.has(c)||t.set(c,r)}for(let a=0,l=n.length;a<l;a++){r=n[a],i=n[(a+1)%n.length];for(let c=0,d=e.length;c<d;c++){o=e[c],s=e[(c+1)%e.length];const u=xw(r,i,o,s);if(u!==null){const h=kw(u);t.has(h)||t.set(h,u)}}}return t.size===0?null:pF([...t.values()])}function kw(n){return`${n.x},${n.y}`}function pF(n){const e=k.Average(n);return n.sort((t,r)=>k.Angle(e,t)-k.Angle(e,r))}function fF(n,e){let t,r,i,o;for(let s=0,a=n.length;s<a;s++){t=n[s],r=n[(s+1)%a];for(let l=0,c=e.length;l<c;l++)if(i=e[l],o=e[(l+1)%c],CP(t,r,i,o))return!0}return!1}class Lp extends Us{constructor(t){super({...t,isClosed:!1,isFilled:!1});y(this,"start");y(this,"end");y(this,"d");y(this,"u");y(this,"ul");y(this,"_length");const{start:r,end:i}=t;this.start=r,this.end=i,this.d=r.clone().sub(i),this.u=this.d.clone().uni(),this.ul=this.u.len()}get length(){return this._length?this._length:this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(t){const{start:r,end:i,u:o,ul:s}=this;if(s===0)return r;const a=k.Sub(t,r).dpr(o)/s,l=r.x+o.x*a;if(l<Math.min(r.x,i.x))return r.x<i.x?r:i;if(l>Math.max(r.x,i.x))return r.x>i.x?r:i;const c=r.y+o.y*a;return c<Math.min(r.y,i.y)?r.y<i.y?r:i:c>Math.max(r.y,i.y)?r.y>i.y?r:i:new k(l,c)}hitTestLineSegment(t,r,i){return CP(t,r,this.start,this.end)}}class Vs extends Us{constructor(t){super({isClosed:!1,isFilled:!1,...t});y(this,"points");y(this,"_segments");y(this,"_length");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:t}=this;for(let r=0,i=t.length-1;r<i;r++){const o=t[r],s=t[r+1];this._segments.push(new Lp({start:o,end:s}))}this.isClosed&&this._segments.push(new Lp({start:t[t.length-1],end:t[0]}))}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((t,r)=>t+r.length,0)),this._length}getVertices(){return this.points}nearestPoint(t){const{segments:r}=this;let i=this.points[0],o=1/0,s,a;for(let l=0;l<r.length;l++)s=r[l].nearestPoint(t),a=s.dist(t),a<o&&(i=s,o=a);return i}hitTestLineSegment(t,r,i){return this.segments.some(o=>o.hitTestLineSegment(t,r,i))}}class Bt extends Vs{constructor(e){super({...e}),this.isClosed=!0}}class Go extends Bt{constructor(t){const{x:r=0,y:i=0,width:o,height:s}=t;super({...t,points:[new k(r,i),new k(r+o,i),new k(r+o,i+s),new k(r,i+s)]});y(this,"x");y(this,"y");y(this,"w");y(this,"h");this.x=r,this.y=i,this.w=o,this.h=s}getBounds(){return new de(this.x,this.y,this.w,this.h)}}class Yr{constructor(e){y(this,"canSnap",()=>!0);y(this,"canScroll",()=>!1);y(this,"canUnmount",()=>!0);y(this,"canBind",(e,t)=>!0);y(this,"canEdit",()=>!1);y(this,"canResize",()=>!0);y(this,"canEditInReadOnly",()=>!1);y(this,"canCrop",()=>!1);y(this,"hideResizeHandles",()=>!1);y(this,"hideRotateHandle",()=>!1);y(this,"hideSelectionBoundsBg",()=>!1);y(this,"hideSelectionBoundsFg",()=>!1);y(this,"isAspectRatioLocked",()=>!1);y(this,"onBeforeCreate");y(this,"onBeforeUpdate");y(this,"onDragShapesOver");y(this,"onDragShapesOut");y(this,"onDropShapesOver");y(this,"onResizeStart");y(this,"onResize");y(this,"onResizeEnd");y(this,"onTranslateStart");y(this,"onTranslate");y(this,"onTranslateEnd");y(this,"onRotateStart");y(this,"onRotate");y(this,"onRotateEnd");y(this,"onHandleChange");y(this,"onBindingChange");y(this,"onChildrenChange");y(this,"onDoubleClickHandle");y(this,"onDoubleClickEdge");y(this,"onDoubleClick");y(this,"onClick");y(this,"onEditEnd");this.editor=e}providesBackgroundForChildren(e){return!1}getOutlineSegments(e){return[this.editor.getShapeGeometry(e).vertices]}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}}y(Yr,"props"),y(Yr,"migrations"),y(Yr,"type");function gF(n,e,t={}){const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=t;let c=0,d=0,u=1,h=0,p=0;switch(l){case"dashed":{u=1,c=Math.min(e*a,n/4);break}case"dotted":{u=100,c=e/u;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(n+=c/2,p+=c/2):o==="skip"&&(n-=c,p-=c),s==="outset"?n+=c/2:s==="skip"&&(n-=c)),d=Math.floor(n/c/(2*u)),d-=d%i,d<3&&l==="dashed"?n/e<5?(c=n,d=1,h=0):(c=n*.333,h=n*.333):(d=Math.max(d,3),c=n/d/(2*u),r?(p=c/2,h=(n-d*c)/d):h=(n-d*c)/Math.max(1,d-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}function PP({bounds:n,className:e}){const t=G(),r=q("zoom level",()=>t.getZoomLevel(),[t]);return g.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((i,o)=>{const{strokeDasharray:s,strokeDashoffset:a}=gF(i[0].dist(i[1]),1/r,{style:"dashed",lengthRatio:4});return g.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:s,strokeDashoffset:a},o)})})}class zp extends Yr{constructor(){super(...arguments);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"canBind",()=>!1);y(this,"onChildrenChange",t=>{const r=this.editor.getSortedChildIdsForParent(t.id);if(r.length===0){this.editor.getCurrentPageState().focusedGroupId===t.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([t.id]);return}else if(r.length===1){this.editor.getCurrentPageState().focusedGroupId===t.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(r,t.parentId),this.editor.deleteShapes([t.id]);return}})}getDefaultProps(){return{}}getGeometry(t){const r=this.editor.getSortedChildIdsForParent(t.id);return r.length===0?new Go({width:1,height:1,isFilled:!1}):new Ko({children:r.map(i=>{const o=this.editor.getShape(i),s=this.editor.getShapeGeometry(i),a=this.editor.getShapeLocalTransform(o).applyToPoints(s.vertices);return s.isClosed?new Bt({points:a,isFilled:!0}):new Vs({points:a})})})}component(t){const r=this.editor.getErasingShapeIds().includes(t.id),{hintingShapeIds:i}=this.editor.getCurrentPageState(),o=i.length>0&&i.some(l=>l!==t.id&&this.editor.isShapeOfType(this.editor.getShape(l),"group")),s=this.editor.getCurrentPageState().focusedGroupId!==t.id;if(!r&&(s||o))return null;const a=this.editor.getShapeGeometry(t).bounds;return g.jsx(ar,{id:t.id,children:g.jsx(PP,{className:"tl-group",bounds:a})})}indicator(t){const r=this.editor.getShapeGeometry(t).bounds;return g.jsx(PP,{className:"",bounds:r})}}y(zp,"type","group"),y(zp,"props",AL),y(zp,"migrations",TL);const EP=[zp],mF=new Set(EP.map(n=>n.type));function IP(n){const e=[...EP],t=new Set;for(const r of n){if(mF.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(t.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}function MP(n,e){if(!e)return!1;switch(n.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&n.value===e.value;default:throw Wa(n)}}class yF{constructor(e){y(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[r,i]of this){if(!MP(i,e.get(r)))return!1;t.add(r)}for(const[r,i]of e)if(!t.has(r)&&!MP(i,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class Cw extends yF{set(e,t){this.map.set(e,t)}applyValue(e,t){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:t});return}switch(r.type){case"mixed":return;case"shared":r.value!==t&&this.set(e,{type:"mixed"});return;default:Wa(r,"type")}}}class Pw{constructor(){y(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}access(e){return this.items.get(e)}set(e,t){this.items.set(e,t)}has(e){return this.items.has(e)}invalidate(e){this.items.delete(e)}bust(){this.items=new WeakMap}}function wF(n,e,t){return fetch(n).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:t})})}function bF(n,e){var i;let t=n;const r=new Set(e);for(;r.has(t);)t=(i=/^.*(\d+)$/.exec(t))!=null&&i[1]?t.replace(/(\d+)(?=\D?)$/,o=>(+o+1).toString()):`${t} 1`;return t}const lr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",vF="a0",AP="A00000000000000000000000000";function TP(n){if(n>="a"&&n<="z")return n.charCodeAt(0)-"a".charCodeAt(0)+2;if(n>="A"&&n<="Z")return"Z".charCodeAt(0)-n.charCodeAt(0)+2;throw new Error("Invalid index key head: "+n)}function jP(n){if(n.length!==TP(n.charAt(0)))throw new Error("invalid integer part of index key: "+n)}function RP(n){if(n===void 0)throw Error("n is undefined")}function OP(n){jP(n);const[e,...t]=n.split("");let r=!0;for(let i=t.length-1;r&&i>=0;i--){const o=lr.indexOf(t[i])+1;o===lr.length?t[i]="0":(t[i]=lr.charAt(o),r=!1)}if(r){if(e==="Z")return"a0";if(e==="z")return;const i=String.fromCharCode(e.charCodeAt(0)+1);return i>"a"?t.push("0"):t.pop(),i+t.join("")}else return e+t.join("")}function SF(n){jP(n);const[e,...t]=n.split("");let r=!0;for(let i=t.length-1;r&&i>=0;i--){const o=lr.indexOf(t[i])-1;o===-1?t[i]=lr.slice(-1):(t[i]=lr.charAt(o),r=!1)}if(r){if(e==="a")return"Z"+lr.slice(-1);if(e==="A")return;const i=String.fromCharCode(e.charCodeAt(0)-1);return i<"Z"?t.push(lr.slice(-1)):t.pop(),i+t.join("")}else return e+t.join("")}function cl(n,e){if(e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n.slice(-1)==="0"||e&&e.slice(-1)==="0")throw new Error("trailing zero");if(e){let i=0;for(;(n.charAt(i)||"0")===e.charAt(i);)i++;if(i>0)return e.slice(0,i)+cl(n.slice(i),e.slice(i))}const t=n?lr.indexOf(n.charAt(0)):0,r=e!==void 0?lr.indexOf(e.charAt(0)):lr.length;if(r-t>1){const i=Math.round(.5*(t+r));return lr.charAt(i)}else return e&&e.length>1?e.slice(0,1):lr.charAt(t)+cl(n.slice(1),void 0)}function yd(n){const e=TP(n.charAt(0));if(e>n.length)throw new Error("invalid index: "+n);return n.slice(0,e)}function DP(n){if(n===AP)throw new Error("invalid index: "+n);const e=yd(n);if(n.slice(e.length).slice(-1)==="0")throw new Error("invalid index: "+n)}function dl(n,e){if(n!==void 0&&DP(n),e!==void 0&&DP(e),n!==void 0&&e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n===void 0&&e===void 0)return vF;if(n===void 0){if(e===void 0)throw Error("b is undefined");const a=yd(e),l=e.slice(a.length);if(a===AP)return a+cl("",l);if(a<e)return a;const c=SF(a);return RP(c),c}if(e===void 0){const a=yd(n),l=n.slice(a.length),c=OP(a);return c===void 0?a+cl(l,void 0):c}const t=yd(n),r=n.slice(t.length),i=yd(e),o=e.slice(i.length);if(t===i)return t+cl(r,o);const s=OP(t);return RP(s),s<e?s:t+cl(r,void 0)}function Yo(n,e,t){if(t===0)return[];if(t===1)return[dl(n,e)];if(e===void 0){let o=dl(n,e);const s=[o];for(let a=0;a<t-1;a++)o=dl(o,e),s.push(o);return s}if(n===void 0){let o=dl(n,e);const s=[o];for(let a=0;a<t-1;a++)o=dl(n,o),s.push(o);return s.reverse(),s}const r=Math.floor(t/2),i=dl(n,e);return[...Yo(n,i,r),i,...Yo(i,e,t-r-1)]}function ul(n,e,t){return Yo(n,e,t)}function Ew(n,e){return Yo(n,void 0,e)}function wd(n,e){return Yo(n,e,1)[0]}function to(n){return Yo(n,void 0,1)[0]}function xF(n){return Yo(void 0,n,1)[0]}function LP(n,e="a1"){return[e,...Yo(e,void 0,n)]}function gn(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function Np(n,e,t){if(t.length===0)return[];const r=new Map;for(const o of me(t.map(s=>n.getShape(s)))){const{parentId:s}=o;r.has(s)||r.set(s,{children:me(n.getSortedChildIdsForParent(s).map(a=>n.getShape(a))),moving:new Set}),r.get(s).moving.add(o)}const i=[];switch(e){case"toBack":{r.forEach(({moving:o,children:s})=>_F(o,s,i));break}case"toFront":{r.forEach(({moving:o,children:s})=>kF(o,s,i));break}case"forward":{r.forEach(({moving:o,children:s})=>CF(o,s,i));break}case"backward":{r.forEach(({moving:o,children:s})=>PF(o,s,i));break}}return i}function _F(n,e,t){const r=e.length;if(n.size===r)return;let i,o;for(let s=0;s<r;s++){const a=e[s];if(n.has(a))i=a.index,n.delete(a);else{o=a.index;break}}if(n.size!==0){const s=ul(i,o,n.size);t.push(...Array.from(n.values()).sort(gn).map((a,l)=>({...a,index:s[l]})))}}function kF(n,e,t){const r=e.length;if(n.size===r)return;let i,o;for(let s=r-1;s>-1;s--){const a=e[s];if(n.has(a))o=a.index,n.delete(a);else{i=a.index;break}}if(n.size!==0){const s=ul(i,o,n.size);t.push(...Array.from(n.values()).sort(gn).map((a,l)=>({...a,index:s[l]})))}}function CF(n,e,t){var o;const r=e.length;if(n.size===r)return;let i={name:"skipping"};for(let s=0;s<r;s++){const a=n.has(e[s]);switch(i.name){case"skipping":{if(!a)continue;i={name:"selecting",selectIndex:s};break}case"selecting":{if(a)continue;const{selectIndex:l}=i;ul(e[s].index,(o=e[s+1])==null?void 0:o.index,s-l).forEach((c,d)=>t.push({...e[l+d],index:c})),i={name:"skipping"};break}}}}function PF(n,e,t){var o;const r=e.length;if(n.size===r)return;let i={name:"skipping"};for(let s=r-1;s>-1;s--){const a=n.has(e[s]);switch(i.name){case"skipping":{if(!a)continue;i={name:"selecting",selectIndex:s};break}case"selecting":{if(a)continue;ul((o=e[s-1])==null?void 0:o.index,e[s].index,i.selectIndex-s).forEach((l,c)=>{t.push({...e[s+c+1],index:l})}),i={name:"skipping"};break}}}}function zP({editor:n}){const e=n.getSelectedShapes(),t=n.getSelectionRotation(),r=n.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:i}}=n;if(!r)return null;const o=r.center.clone().rotWith(r.point,t);return{selectionPageCenter:o,initialCursorAngle:o.angle(i),initialSelectionRotation:t,shapeSnapshots:e.map(s=>({shape:Ho(s),initialPagePoint:n.getShapePageTransform(s.id).point()}))}}function Fp({delta:n,editor:e,snapshot:t,stage:r}){const{selectionPageCenter:i,shapeSnapshots:o}=t;e.updateShapes(o.map(({shape:a,initialPagePoint:l})=>{const c=kr(a.parentId)?e.getShapePageTransform(a.parentId):oe.Identity(),d=k.RotWith(l,i,n),u=oe.applyToPoint(oe.Inverse(c),d),h=Wr(a.rotation+n);return{id:a.id,type:a.type,x:u.x,y:u.y,rotation:h}}));const s=[];o.forEach(({shape:a})=>{var u,h,p;const l=e.getShape(a.id);if(!l)return;const c=e.getShapeUtil(a);if(r==="start"||r==="one-off"){const m=(u=c.onRotateStart)==null?void 0:u.call(c,a);m&&s.push(m)}const d=(h=c.onRotate)==null?void 0:h.call(c,a,l);if(d&&s.push(d),r==="end"||r==="one-off"){const m=(p=c.onRotateEnd)==null?void 0:p.call(c,a,l);m&&s.push(m)}}),s.length>0&&e.updateShapes(s)}const EF=n=>{const{store:e}=n,t=e.query.filterHistory("shape"),r=e.query.records("shape",()=>({type:{eq:"arrow"}}));function i(){const o=r.get(),s={};for(const a of o){const{start:l,end:c}=a.props;if(l.type==="binding"){const d=s[l.boundShapeId];d?d.push({arrowId:a.id,handleId:"start"}):s[l.boundShapeId]=[{arrowId:a.id,handleId:"start"}]}if(c.type==="binding"){const d=s[c.boundShapeId];d?d.push({arrowId:a.id,handleId:"end"}):s[c.boundShapeId]=[{arrowId:a.id,handleId:"end"}]}}return s}return Q("arrowBindingsIndex",(o,s)=>{if(Ha(o))return i();const a=o,l=t.getDiffSince(s);if(l===rr)return i();let c;function d(p){c||(c={...a}),c[p]?c[p]===a[p]&&(c[p]=[...c[p]]):c[p]=[]}function u(p,m,f){d(p),c[p]=c[p].filter(w=>w.arrowId!==m||w.handleId!==f),c[p].length===0&&delete c[p]}function h(p,m,f){d(p),c[p].push({arrowId:m,handleId:f})}for(const p of l){for(const m of Object.values(p.added))if(n.isShapeOfType(m,"arrow")){const{start:f,end:w}=m.props;f.type==="binding"&&h(f.boundShapeId,m.id,"start"),w.type==="binding"&&h(w.boundShapeId,m.id,"end")}for(const[m,f]of Object.values(p.updated))if(!(!n.isShapeOfType(m,"arrow")||!n.isShapeOfType(f,"arrow")))for(const w of["start","end"]){const S=m.props[w],b=f.props[w];S.type==="binding"&&b.type==="point"?u(S.boundShapeId,m.id,w):S.type==="point"&&b.type==="binding"?h(b.boundShapeId,f.id,w):S.type==="binding"&&b.type==="binding"&&S.boundShapeId!==b.boundShapeId&&(u(S.boundShapeId,m.id,w),h(b.boundShapeId,f.id,w))}for(const m of Object.values(p.removed))if(n.isShapeOfType(m,"arrow")){const{start:f,end:w}=m.props;f.type==="binding"&&u(f.boundShapeId,m.id,"start"),w.type==="binding"&&u(w.boundShapeId,m.id,"end")}}return c??a})},IF=n=>{const e=n.query.ids("shape");function t(){const r={},i=e.get(),o=Array(i.size);return i.forEach(s=>o.push(n.get(s))),o.sort(gn),o.forEach(s=>{r[s.parentId]||(r[s.parentId]=[]),r[s.parentId].push(s.id)}),r}return Q("parentsToChildrenWithIndexes",(r,i)=>{if(Ha(r))return t();const o=n.history.getDiffSince(i);if(o===rr)return t();if(o.length===0)return r;let s=null;const a=d=>{s||(s={...r}),s[d]?s[d]===r[d]&&(s[d]=[...s[d]]):s[d]=[]},l=new Set;let c;for(let d=0,u=o.length;d<u;d++){c=o[d];for(const h of Object.values(c.added))Fs(h)&&(a(h.parentId),s[h.parentId].push(h.id),l.add(s[h.parentId]));for(const[h,p]of Object.values(c.updated))if(Fs(p)&&Fs(h)){if(h.parentId!==p.parentId)a(h.parentId),a(p.parentId),s[h.parentId].splice(s[h.parentId].indexOf(p.id),1),s[p.parentId].push(p.id),l.add(s[p.parentId]);else if(h.index!==p.index){a(p.parentId);const m=s[p.parentId].indexOf(p.id);s[p.parentId][m]=p.id,l.add(s[p.parentId])}}for(const h of Object.values(c.removed))Fs(h)&&(a(h.parentId),s[h.parentId].splice(s[h.parentId].indexOf(h.id),1))}for(const d of l){const u=me(d.map(h=>n.get(h)));u.sort(gn),d.splice(0,d.length,...u.map(h=>h.id))}return s??r})},Iw=(n,e,t)=>{for(;!Un(t.parentId);){const r=n.get(t.parentId);if(!r)return!1;t=r}return t.parentId===e},MF=(n,e)=>{const t=n.query.ids("shape");let r=null;function i(){const o=e();return r=o,new Set([...t.get()].filter(s=>Iw(n,o,n.get(s))))}return Q("_shapeIdsInCurrentPage",(o,s)=>{if(Ha(o))return i();const a=e();if(a!==r)return i();const l=n.history.getDiffSince(s);if(l===rr)return i();const c=new qh(o);for(const u of l){for(const h of Object.values(u.added))Fs(h)&&Iw(n,a,h)&&c.add(h.id);for(const[h,p]of Object.values(u.updated))Fs(p)&&(Iw(n,a,p)?c.add(p.id):c.remove(p.id));for(const h of Object.keys(u.removed))kr(h)&&c.remove(h)}const d=c.get();return d?Vc(d.value,d.diff):o})},AF=40;class TF{constructor(e){y(this,"_clickId","");y(this,"_clickTimeout");y(this,"_clickScreenPoint");y(this,"_previousScreenPoint");y(this,"_getClickTimeout",(e,t=qe())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?Ez:Iz)});y(this,"_clickState","idle");y(this,"lastPointerInfo",{});y(this,"transformPointerDownEvent",e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=k.From(e.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>AF&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),e;default:return this._clickTimeout=this._getClickTimeout(this._clickState),e}});y(this,"transformPointerUpEvent",e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=k.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return e}});y(this,"cancelDoubleClickTimeout",()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"});y(this,"handleMove",()=>{this._clickState!=="idle"&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?lw:dd)&&this.cancelDoubleClickTimeout()});this.editor=e}get clickState(){return this._clickState}}class jF{constructor(e){y(this,"isSafari");y(this,"isIos");y(this,"isChromeForIos");y(this,"isFirefox");y(this,"isAndroid");this.editor=e,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}function Hs(n){if(n){let e=NP;for(;n.length;)e=e.push(n.pop());return e}return NP}class RF{constructor(){y(this,"length",0);y(this,"head",null);y(this,"tail",this)}push(e){return new Mw(e,this)}toArray(){return Gi}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const NP=new RF;class Mw{constructor(e,t){y(this,"length");this.head=e,this.tail=t,this.length=t.length+1}push(e){return new Mw(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}class OF{constructor(e,t){y(this,"_undos",Cn("HistoryManager.undos",Hs()));y(this,"_redos",Cn("HistoryManager.redos",Hs()));y(this,"_batchDepth",0);y(this,"onBatchComplete",()=>{});y(this,"_commands",{});y(this,"createCommand",(e,t,r)=>{if(this._commands[e])throw new Error(`Duplicate command: ${e}`);this._commands[e]=r;const i=(...o)=>{if(!this._batchDepth)return this.batch(()=>i(...o)),this.ctx;const s=t(...o);if(!s)return this.ctx;const{data:a,ephemeral:l,squashing:c,preservesRedoStack:d}=s;if(this.ignoringUpdates((u,h)=>(r.do(a),{undos:u,redos:h})),!l){const u=this._undos.get().head;c&&u&&u.type==="command"&&u.name===e&&u.preservesRedoStack===d?this._undos.update(h=>h.tail.push({...u,id:qe(),data:r.squash(u.data,a)})):this._undos.update(h=>h.push({type:"command",name:e,data:a,id:qe(),preservesRedoStack:d})),s.preservesRedoStack||this._redos.set(Hs()),this.ctx.emit("change-history",{reason:"push"})}return this.ctx};return i});y(this,"batch",e=>{try{this._batchDepth++,this._batchDepth===1?Ur(()=>{var r,i;const t=(r=this._undos.get().head)==null?void 0:r.id;e(),t!==((i=this._undos.get().head)==null?void 0:i.id)&&this.onBatchComplete()}):e()}catch(t){throw this.annotateError(t),t}finally{this._batchDepth--}return this});y(this,"ignoringUpdates",e=>{let t=this._undos.get(),r=this._redos.get();this._undos.set(Hs()),this._redos.set(Hs());try{({undos:t,redos:r}=Ur(()=>e(t,r)))}finally{this._undos.set(t),this._redos.set(r)}});y(this,"_undo",({pushToRedoStack:e,toMark:t=void 0})=>(this.ignoringUpdates((r,i)=>{var o;if(r.length===0)return{undos:r,redos:i};for(;((o=r.head)==null?void 0:o.type)==="STOP";){const s=r.head;if(r=r.tail,e&&(i=i.push(s)),s.id===t)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i}}if(r.length===0)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i};for(;r.head;){const s=r.head;if(r=r.tail,e&&(i=i.push(s)),s.type==="STOP"){if(s.onUndo&&(!t||s.id===t))return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i}}else this._commands[s.name].undo(s.data)}return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i}}),this));y(this,"undo",()=>(this._undo({pushToRedoStack:!0}),this));y(this,"redo",()=>(this.ignoringUpdates((e,t)=>{var r;if(t.length===0)return{undos:e,redos:t};for(;((r=t.head)==null?void 0:r.type)==="STOP";)e=e.push(t.head),t=t.tail;if(t.length===0)return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t};for(;t.head;){const i=t.head;if(e=e.push(t.head),t=t.tail,i.type==="STOP"){if(i.onRedo)break}else{const o=this._commands[i.name];o.redo?o.redo(i.data):o.do(i.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t}}),this));y(this,"bail",()=>(this._undo({pushToRedoStack:!1}),this));y(this,"bailToMark",e=>(this._undo({pushToRedoStack:!1,toMark:e}),this));y(this,"mark",(e=qe(),t=!0,r=!0)=>{const i=this._undos.get().head;return i&&i.type==="STOP"&&i.id===e&&i.onUndo===t&&i.onRedo===r?i.id:(this._undos.update(o=>o.push({type:"STOP",id:e,onUndo:t,onRedo:r})),this.ctx.emit("mark-history",{id:e}),e)});this.ctx=e,this.annotateError=t}getNumUndos(){return this._undos.get().length}getNumRedos(){return this._redos.get().length}clear(){this._undos.set(Hs()),this._redos.set(Hs())}}class DF{constructor(e){y(this,"scribbleItems",new Map);y(this,"state","paused");y(this,"addScribble",(e,t=qe())=>{const r={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,r),this.state==="paused"&&this.resume(),r});y(this,"stop",e=>{const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t});y(this,"addPoint",(e,t,r)=>{const i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);const{prev:o}=i,s={x:t,y:r,z:.5};return(!o||k.Dist(o,s)>=1)&&(i.next=s),i});y(this,"tick",e=>{this.editor.batch(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:l,prev:c}=t;l&&l!==c&&(t.prev=l,t.scribble.points.push(l)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:r,timeoutMs:i,prev:o,next:s,scribble:a}=t;switch(a.state){case"active":{s&&s!==o?(t.prev=s,a.points.push(s),r===0&&a.points.length>8&&a.points.shift()):i===0&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break}case"stopping":{if(t.delayRemaining===0&&i===0){if(a.points.length===1){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)}),this.scribbleItems.size===0&&this.pause()})});this.editor=e}resume(){this.state="running",this.editor.addListener("tick",this.tick)}pause(){this.editor.removeListener("tick",this.tick),this.state="paused"}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear(),this.pause()}}class LF{constructor(e){y(this,"_beforeCreateHandlers",{});y(this,"_afterCreateHandlers",{});y(this,"_beforeChangeHandlers",{});y(this,"_afterChangeHandlers",{});y(this,"_beforeDeleteHandlers",{});y(this,"_afterDeleteHandlers",{});y(this,"_batchCompleteHandlers",[]);this.editor=e,e.store.onBeforeCreate=(r,i)=>{const o=this._beforeCreateHandlers[r.typeName];if(o){let s=r;for(const a of o)s=a(s,i);return s}return r},e.store.onAfterCreate=(r,i)=>{const o=this._afterCreateHandlers[r.typeName];if(o)for(const s of o)s(r,i)},e.store.onBeforeChange=(r,i,o)=>{const s=this._beforeChangeHandlers[i.typeName];if(s){let a=i;for(const l of s)a=l(r,a,o);return a}return i};let t=0;e.store.onAfterChange=(r,i,o)=>{if(t++,t>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{const s=this._afterChangeHandlers[i.typeName];if(s)for(const a of s)a(r,i,o)}t--},e.store.onBeforeDelete=(r,i)=>{const o=this._beforeDeleteHandlers[r.typeName];if(o){for(const s of o)if(s(r,i)===!1)return!1}},e.store.onAfterDelete=(r,i)=>{const o=this._afterDeleteHandlers[r.typeName];if(o)for(const s of o)s(r,i)},e.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach(r=>r())}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>Ws(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>Ws(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>Ws(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>Ws(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>Ws(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>Ws(this._afterDeleteHandlers[e],t)}registerBatchCompleteHandler(e){return this._batchCompleteHandlers.push(e),()=>Ws(this._batchCompleteHandlers,e)}}function Ws(n,e){const t=n.indexOf(e);t>=0&&n.splice(t,1)}var zF=Object.defineProperty,NF=Object.getOwnPropertyDescriptor,Ks=(n,e,t,r)=>{for(var i=r>1?void 0:r?NF(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&zF(e,t,i),i};const ge=n=>Math.round(n*10**8)/10**8;function no(n,e,t,r,i){const o=n.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&ge(a.length)===ge(t)&&Kr(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));if(o.length===0)return[];const s=new Set;return o.forEach(a=>{const l=r==="forward"?a.endNode.id:a.startNode.id;if(!s.has(l)){s.add(l);const c=no(n,l,t,r,Kr(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));o.push(...c)}}),o}function FF(n){n.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=n.length-1;e>0;e--){const t=n[e];for(let r=e-1;r>=0;r--){const i=n[r];if(i.direction===t.direction&&t.gaps.every(o=>i.gaps.some(s=>ge(o.startEdge[0].x)===ge(s.startEdge[0].x)&&ge(o.startEdge[0].y)===ge(s.startEdge[0].y)&&ge(o.startEdge[1].x)===ge(s.startEdge[1].x)&&ge(o.startEdge[1].y)===ge(s.startEdge[1].y))&&i.gaps.some(s=>ge(o.endEdge[0].x)===ge(s.endEdge[0].x)&&ge(o.endEdge[0].y)===ge(s.endEdge[0].y)&&ge(o.endEdge[1].x)===ge(s.endEdge[1].x)&&ge(o.endEdge[1].y)===ge(s.endEdge[1].y)))){n.splice(e,1);break}}}}class Xo{constructor(e){y(this,"_snapLines",Cn("snapLines",void 0));this.editor=e}getLines(){return this._snapLines.get()??Gi}clear(){this.getLines().length&&this._snapLines.set(void 0)}setLines(e){this._snapLines.set(e)}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const r=e.getShapePageTransform(t.id);return r?this.editor.getShapeGeometry(t).snapPoints.map((i,o)=>{const{x:s,y:a}=oe.applyToPoint(r,i);return{x:s,y:a,id:`${t.id}:${o}`}}):void 0})}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getRenderingBounds(),r=e.getSelectedShapeIds(),i=[],o=s=>{const a=e.getSortedChildIdsForParent(s);for(const l of a){if(r.includes(l))continue;const c=e.getShape(l);if(!c||!e.getShapeUtil(c).canSnap(c))continue;const d=e.getShapePageBounds(l);if(d&&t.includes(d)){if(e.isShapeOfType(c,"group")){o(l);continue}i.push({id:l,pageBounds:d,isClosed:e.getShapeGeometry(c).isClosed})}}};return o(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.getSnappableShapes(),r=[];return t.forEach(i=>{const o=e.get(i.id);o&&r.push(...o)}),r}getVisibleGaps(){const e=[],t=[];let r,i;const o=this.getSnappableShapes().sort((a,l)=>a.pageBounds.minX-l.pageBounds.minX);for(let a=0;a<o.length;a++){r=o[a];for(let l=a+1;l<o.length;l++)i=o[l],r.pageBounds.maxX<i.pageBounds.minX&&ld(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:r,endNode:i,startEdge:[new k(r.pageBounds.maxX,r.pageBounds.minY),new k(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new k(i.pageBounds.minX,i.pageBounds.minY),new k(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:Kr(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const s=o.sort((a,l)=>a.pageBounds.minY-l.pageBounds.minY);for(let a=0;a<s.length;a++){r=s[a];for(let l=a+1;l<s.length;l++)i=s[l],r.pageBounds.maxY<i.pageBounds.minY&&ld(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&t.push({startNode:r,endNode:i,startEdge:[new k(r.pageBounds.minX,r.pageBounds.maxY),new k(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new k(i.pageBounds.minX,i.pageBounds.minY),new k(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:Kr(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslate({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:r,dragDelta:i}){var w,S;const o=this.getSnapThreshold(),s=this.getSnappablePoints(),a=t.clone().translate(i),l=r.map(({x:b,y:_},x)=>({id:"selection:"+x,x:b+i.x,y:_+i.y})),c=s,d=[],u=[],h=new k(o,o);this.collectPointSnaps({minOffset:h,nearestSnapsX:d,nearestSnapsY:u,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u,minOffset:h});const p=new k(e==="x"?0:((w=d[0])==null?void 0:w.nudge)??0,e==="y"?0:((S=u[0])==null?void 0:S.nudge)??0);h.x=0,h.y=0,d.length=0,u.length=0,l.forEach(b=>{b.x+=p.x,b.y+=p.y}),a.translate(p),this.collectPointSnaps({minOffset:h,nearestSnapsX:d,nearestSnapsY:u,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u,minOffset:h});const m=this.getPointSnapLines({nearestSnapsX:d,nearestSnapsY:u}),f=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u});return this._snapLines.set([...f,...m]),{nudge:p}}getOutlinesInPageSpace(){return this.getSnappableShapes().map(({id:e,isClosed:t})=>{const r=ln(this.editor.getShapeGeometry(e).vertices);t&&r.push(r[0]);const i=this.editor.getShapePageTransform(e);if(!i)throw Error("No page transform");return oe.applyToPoints(i,r)})}getSnappingHandleDelta({handlePoint:e,additionalSegments:t}){const r=this.getSnapThreshold(),i=this.getOutlinesInPageSpace();let o=r,s=null,a,l,c,d;const u=[...i,...t];for(const h of u)for(let p=0;p<h.length-1;p++)a=h[p],l=h[p+1],c=k.NearestPointOnLineSegment(a,l,e),d=k.Dist(e,c),!isNaN(d)&&d<o&&(o=d,s=c);return s?(this._snapLines.set([{id:qe(),type:"points",points:[s]}]),k.Sub(s,e)):null}snapResize({initialSelectionPageBounds:e,dragDelta:t,handle:r,isAspectRatioLocked:i,isResizingFromCenter:o}){var E,I;const s=this.getSnapThreshold(),{box:a,scaleX:l,scaleY:c}=de.Resize(e,r,o?t.x*2:t.x,o?t.y*2:t.y,i);let d=r;l<0&&(d=x8(d)),c<0&&(d=S8(d)),o&&(a.center=e.center);const u=d==="top"||d==="bottom",h=d==="left"||d==="right",p=FP(d,a),m=this.getSnappablePoints(),f=[],w=[],S=new k(s,s);this.collectPointSnaps({minOffset:S,nearestSnapsX:f,nearestSnapsY:w,otherNodeSnapPoints:m,selectionSnapPoints:p});const b=new k(u?0:((E=f[0])==null?void 0:E.nudge)??0,h?0:((I=w[0])==null?void 0:I.nudge)??0);if(i&&_8(d)&&b.len()!==0){const A=f.length&&w.length?Math.abs(b.x)<Math.abs(b.y)?"x":"y":f.length?"x":"y",T=e.aspectRatio;A==="x"?(w.length=0,b.y=b.x/T,(d==="bottom_left"||d==="top_right")&&(b.y=-b.y)):(f.length=0,b.x=b.y*T,(d==="bottom_left"||d==="top_right")&&(b.x=-b.x))}const _=k.Add(t,b),{box:x}=de.Resize(e,r,o?_.x*2:_.x,o?_.y*2:_.y,i);o&&(x.center=e.center);const P=FP("any",x);f.length=0,w.length=0,S.x=0,S.y=0,this.collectPointSnaps({minOffset:S,nearestSnapsX:f,nearestSnapsY:w,otherNodeSnapPoints:m,selectionSnapPoints:P});const C=this.getPointSnapLines({nearestSnapsX:f,nearestSnapsY:w});return this._snapLines.set([...C]),{nudge:b}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:r,nearestSnapsX:i,nearestSnapsY:o}){for(const s of e)for(const a of t){const l=k.Sub(s,a),c=Math.abs(l.x),d=Math.abs(l.y);ge(c)<=ge(r.x)&&(ge(c)<ge(r.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.x-s.x}),r.x=c),ge(d)<=ge(r.y)&&(ge(d)<ge(r.y)&&(o.length=0),o.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.y-s.y}),r.y=d)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:r,nearestSnapsY:i}){const{horizontal:o,vertical:s}=this.getVisibleGaps();for(const a of o){if(!ld(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const l=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&ge(Math.abs(l))<=ge(t.x)){ge(Math.abs(l))<ge(t.x)&&(r.length=0),t.x=Math.abs(l);const f={type:"gap_center",gap:a,nudge:l},w=r.find(({type:b})=>b==="gap_center"),S=w&&Kr(a.breadthIntersection[0],a.breadthIntersection[1],w.gap.breadthIntersection[0],w.gap.breadthIntersection[1]);w&&w.gap.length>a.length&&S?r[r.indexOf(w)]=f:(!w||!S)&&r.push(f)}const c=a.startNode.pageBounds.minX-a.length,d=e.maxX,u=c-d;ge(Math.abs(u))<=ge(t.x)&&(ge(Math.abs(u))<ge(t.x)&&(r.length=0),t.x=Math.abs(u),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:u}));const h=a.endNode.pageBounds.maxX+a.length,p=e.minX,m=h-p;ge(Math.abs(m))<=ge(t.x)&&(ge(Math.abs(m))<ge(t.x)&&(r.length=0),t.x=Math.abs(m),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:m}))}for(const a of s){if(!ld(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const l=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&ge(Math.abs(l))<=ge(t.y)){ge(Math.abs(l))<ge(t.y)&&(i.length=0),t.y=Math.abs(l);const f={type:"gap_center",gap:a,nudge:l},w=i.find(({type:b})=>b==="gap_center"),S=w&&ld(w.gap.breadthIntersection[0],w.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);w&&w.gap.length>a.length&&S?i[i.indexOf(w)]=f:(!w||!S)&&i.push(f);continue}const c=a.startNode.pageBounds.minY-a.length,d=e.maxY,u=c-d;ge(Math.abs(u))<=ge(t.y)&&(ge(Math.abs(u))<ge(t.y)&&(i.length=0),t.y=Math.abs(u),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:u}));const h=a.endNode.pageBounds.maxY+a.length,p=e.minY,m=h-p;ge(Math.abs(m))<=ge(t.y)&&(ge(Math.abs(m))<ge(t.y)&&(i.length=0),t.y=Math.abs(m),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:m}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const r={},i={};if(e.length>0){for(const o of e)if(o.type==="points"){const s=ge(o.points.otherPoint.x);r[s]||(r[s]=[]),r[s].push(o.points)}}if(t.length>0){for(const o of t)if(o.type==="points"){const s=ge(o.points.otherPoint.y);i[s]||(i[s]=[]),i[s].push(o.points)}}return Object.values(r).concat(Object.values(i)).map(o=>({id:qe(),type:"points",points:Jh(o.map(s=>k.From(s.otherPoint)).concat(o.map(s=>k.From(s.thisPoint))),(s,a)=>s.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:r}){const{vertical:i,horizontal:o}=this.getVisibleGaps(),s={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(const l of t){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:d,startNode:u,endNode:h,length:p,endEdge:m}}=l;switch(l.type){case"gap_center":{const f=(p-e.width)/2,w=Kr(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:qe(),gaps:[...no(o,u.id,f,"backward",w),{startEdge:d,endEdge:s.left},{startEdge:s.right,endEdge:m},...no(o,h.id,f,"forward",w)]});break}case"gap_duplicate":{const f=Kr(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:qe(),gaps:l.protrusionDirection==="left"?[{startEdge:s.right,endEdge:d.map(w=>w.clone().addXY(-u.pageBounds.width,0))},{startEdge:d,endEdge:m},...no(o,h.id,p,"forward",f)]:[...no(o,u.id,p,"backward",f),{startEdge:d,endEdge:m},{startEdge:m.map(w=>w.clone().addXY(l.gap.endNode.pageBounds.width,0)),endEdge:s.left}]});break}}}if(r.length>0)for(const l of r){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:d,startNode:u,endNode:h,length:p,endEdge:m}}=l;switch(l.type){case"gap_center":{const f=(p-e.height)/2,w=Kr(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:qe(),gaps:[...no(i,u.id,f,"backward",w),{startEdge:d,endEdge:s.top},{startEdge:s.bottom,endEdge:m},...no(i,l.gap.endNode.id,f,"forward",w)]});break}case"gap_duplicate":{const f=Kr(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:qe(),gaps:l.protrusionDirection==="top"?[{startEdge:s.bottom,endEdge:d.map(w=>w.clone().addXY(0,-u.pageBounds.height))},{startEdge:d,endEdge:m},...no(i,h.id,p,"forward",f)]:[...no(i,u.id,p,"backward",f),{startEdge:d,endEdge:m},{startEdge:m.map(w=>w.clone().addXY(0,h.pageBounds.height)),endEdge:s.top}]})}break}}return FF(a),a}}Ks([Q],Xo.prototype,"getSnapPointsCache",1),Ks([Q],Xo.prototype,"getSnapThreshold",1),Ks([Q],Xo.prototype,"getSnappableShapes",1),Ks([Q],Xo.prototype,"getCurrentCommonAncestor",1),Ks([Q],Xo.prototype,"getSnappablePoints",1),Ks([Q],Xo.prototype,"getVisibleGaps",1),Ks([Q],Xo.prototype,"getOutlinesInPageSpace",1);function FP(n,e){const{minX:t,maxX:r,minY:i,maxY:o}=e,s=[];switch(n){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:t,y:i})}switch(n){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(n){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(n){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:t,y:o})}return s}const $F=/\r?\n|\r/g;function $P(n){return n.replace($F,`
`).split(`
`).map(e=>e||" ").join(`
`)}const BF={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},UF=/\s/;class VF{constructor(e){y(this,"measureText",(e,t)=>{const r=this.getTextElement();r.setAttribute("dir","ltr"),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-style",t.fontStyle),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("font-size",t.fontSize+"px"),r.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),r.style.setProperty("max-width",t.maxWidth===null?null:t.maxWidth+"px"),r.style.setProperty("min-width",t.minWidth??null),r.style.setProperty("padding",t.padding),r.textContent=$P(e);const i=r.getBoundingClientRect();return{x:0,y:0,w:i.width,h:i.height}});this.editor=e}getTextElement(){var t;(t=document.querySelector(".tl-text-measure"))==null||t.remove();const e=document.createElement("div");return this.editor.getContainer().appendChild(e),e.id=`__textMeasure_${qe()}`,e.classList.add("tl-text"),e.classList.add("tl-text-measure"),e.tabIndex=-1,e}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const r=[],i=e.getBoundingClientRect(),o=-i.left,s=-i.top,a=new Range,l=e.childNodes[0];let c=0,d=null,u=null,h=0,p=!1;for(const m of e.childNodes)if(m.nodeType===Node.TEXT_NODE)for(const f of m.textContent??""){a.setStart(l,c),a.setEnd(l,c+f.length);const w=a.getClientRects(),S=w[w.length-1],b=S.top+s,_=S.left+o,x=S.right+o,P=UF.test(f);if(P!==u||b!==h||!d){if(d){if(t&&b!==h){p=!0;break}r.push(d)}d={box:{x:_,y:b,w:S.width,h:S.height},text:f}}else d.box.w=x-d.box.x,d.text+=f;u=P,h=b,c+=f.length}return d&&r.push(d),{spans:r,didTruncate:p}}measureTextSpans(e,t){if(e==="")return[];const r=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip",i=this.getTextElement(),o=Math.ceil(t.width-t.padding*2);i.style.setProperty("width",`${o}px`),i.style.setProperty("height","min-content"),i.style.setProperty("dir","ltr"),i.style.setProperty("font-size",`${t.fontSize}px`),i.style.setProperty("font-family",t.fontFamily),i.style.setProperty("font-weight",t.fontWeight),i.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),i.style.setProperty("text-align",BF[t.textAlign]),r&&(i.style.setProperty("overflow-wrap","anywhere"),i.style.setProperty("word-break","break-all")),e=$P(e),i.textContent=e;const{spans:s,didTruncate:a}=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:r});if(t.overflow==="truncate-ellipsis"&&a){i.textContent="\u2026";const l=Math.ceil(this.measureElementTextNodeSpans(i).spans[0].box.w);i.style.setProperty("width",`${o-l}px`),i.textContent=e;const c=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:!0}).spans,d=c[c.length-1];return c.push({text:"\u2026",box:{x:Math.min(d.box.x+d.box.w,t.width-t.padding-l),y:d.box.y,w:l,h:d.box.h}}),c}return i.remove(),s}}class HF{constructor(e){y(this,"raf");y(this,"isPaused",!0);y(this,"last",0);y(this,"t",0);y(this,"start",()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()});y(this,"tick",()=>{if(this.isPaused)return;const e=Date.now(),t=e-this.last;if(this.last=e,this.t+=t,this.editor.emit("frame",t),this.t<16){this.raf=requestAnimationFrame(this.tick);return}this.t-=16,this.updatePointerVelocity(t),this.editor.emit("tick",t),this.raf=requestAnimationFrame(this.tick)});y(this,"dispose",()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)});y(this,"prevPoint",new k);y(this,"updatePointerVelocity",e=>{const{prevPoint:t,editor:{inputs:{currentScreenPoint:r,pointerVelocity:i}}}=this;if(e===0)return;const o=k.Sub(r,t);this.prevPoint=r.clone();const s=o.len(),a=s?o.div(s):new k(0,0),l=i.clone().lrp(a.mul(s/e),.5);Math.abs(l.x)<.01&&(l.x=0),Math.abs(l.y)<.01&&(l.y=0),i.equals(l)||(this.editor.inputs.pointerVelocity=l)});this.editor=e,this.editor.disposables.add(this.dispose),this.start()}}var WF=Object.defineProperty,KF=Object.getOwnPropertyDescriptor,ro=(n,e,t,r)=>{for(var i=r>1?void 0:r?KF(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&WF(e,t,i),i};class vi{constructor(e,t){y(this,"updateUserPreferences",e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})});this.user=e,this.inferDarkMode=t}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),isDarkMode:this.getIsDarkMode(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode()}}getIsDarkMode(){return this.user.userPreferences.get().isDarkMode??(this.inferDarkMode?nF():!1)}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??Er.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??Er.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??Er.name}getLocale(){return this.user.userPreferences.get().locale??Er.locale}getColor(){return this.user.userPreferences.get().color??Er.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??Er.isSnapMode}}ro([Q],vi.prototype,"getUserPreferences",1),ro([Q],vi.prototype,"getIsDarkMode",1),ro([Q],vi.prototype,"getEdgeScrollSpeed",1),ro([Q],vi.prototype,"getAnimationSpeed",1),ro([Q],vi.prototype,"getId",1),ro([Q],vi.prototype,"getName",1),ro([Q],vi.prototype,"getLocale",1),ro([Q],vi.prototype,"getColor",1),ro([Q],vi.prototype,"getIsSnapMode",1);function bd(n){return Math.abs(n.props.bend)<8}function $p(n,e){if(e.type==="point")return;const t=n.getShape(e.boundShapeId),r=n.getShapePageTransform(t),i=n.getShapeGeometry(t),o=i instanceof Ko?i.children[0].vertices:i.vertices;return{shape:t,transform:r,isClosed:i.isClosed,isExact:e.isExact,didIntersect:!1,outline:o}}function BP(n,e,t,r){if(t.type==="point")return k.From(t);const i=n.getShape(t.boundShapeId);if(i){const{point:o,size:s}=n.getShapeGeometry(i).bounds,a=k.Add(o,k.MulV(t.isPrecise||r?t.normalizedAnchor:{x:.5,y:.5},s)),l=oe.applyToPoint(n.getShapePageTransform(i),a);return oe.applyToPoint(oe.Inverse(e),l)}else return new k(0,0)}function Xr(n,e){const t=n.getShapePageTransform(e);let r,i;e.props.start.type==="binding"&&e.props.end.type==="binding"&&(r=e.props.start.boundShapeId,i=e.props.end.boundShapeId);const o=Aw(n,r,i),s=BP(n,t,e.props.start,o==="double-bound"||o==="start-contains-end"),a=BP(n,t,e.props.end,o==="double-bound"||o==="end-contains-start");return{start:s,end:a}}const hl=10,Bp=10,GF=10,qo={s:2,m:3.5,l:5,xl:10};function Aw(n,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const r=n.getShapePageBounds(e),i=n.getShapePageBounds(t);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}function vd(n,e){const{start:t,end:r,arrowheadStart:i,arrowheadEnd:o}=e.props,s=Xr(n,e),a=s.start.clone(),l=s.end.clone(),c=k.Med(a,l);if(k.Equals(a,l))return{isStraight:!0,start:{handle:a,point:a,arrowhead:e.props.arrowheadStart},end:{handle:l,point:l,arrowhead:e.props.arrowheadEnd},middle:c,isValid:!1,length:0};const d=k.Sub(l,a).uni(),u=$p(n,t),h=$p(n,r),p=n.getShapePageTransform(e);UP(l,s.start,p,h),UP(a,s.end,p,u);let m=0,f=0,w=0,S=0,b=hl;const _=u&&h&&u.shape===h.shape,x=u&&h?Aw(n,u.shape.id,h.shape.id):"safe";x==="safe"&&u&&h&&!_&&!u.isExact&&!h.isExact&&(h.didIntersect&&!u.didIntersect?u.isClosed&&a.setTo(l.clone().add(d.clone().mul(hl))):h.didIntersect||h.isClosed&&l.setTo(a.clone().sub(d.clone().mul(hl))));const P=k.Sub(l,a).uni(),C=!k.Equals(P,d);_||(x!=="start-contains-end"&&u&&i!=="none"&&!u.isExact&&(w=qo[e.props.size]/2+("size"in u.shape.props?qo[u.shape.props.size]/2:0),m=Bp+w,b+=w),x!=="end-contains-start"&&h&&o!=="none"&&!h.isExact&&(S=qo[e.props.size]/2+("size"in h.shape.props?qo[h.shape.props.size]/2:0),f=Bp+S,b+=S));const E=a.clone().add(P.clone().mul(m*(C?-1:1))),I=l.clone().sub(P.clone().mul(f*(C?-1:1)));k.Dist(E,I)<b&&(m!==0&&f!==0?(m*=-1.5,f*=-1.5):m!==0?m*=-1:f!==0&&(f*=-1)),a.add(P.clone().mul(m*(C?-1:1))),l.sub(P.clone().mul(f*(C?-1:1))),C?(u&&h&&l.setTo(k.Add(a,P.clone().mul(-hl))),c.setTo(k.Med(s.start,s.end))):c.setTo(k.Med(a,l));const A=k.Dist(a,l);return{isStraight:!0,start:{handle:s.start,point:a,arrowhead:e.props.arrowheadStart},end:{handle:s.end,point:l,arrowhead:e.props.arrowheadEnd},middle:c,isValid:A>0,length:A}}function UP(n,e,t,r){if(r===void 0||r.isExact)return;const i=oe.applyToPoint(t,e),o=oe.applyToPoint(t,n),s=oe.applyToPoint(oe.Inverse(r.transform),i),a=oe.applyToPoint(oe.Inverse(r.transform),o),l=r.isClosed,c=(l?uF:xP)(s,a,r.outline);let d;if(c!==null&&(d=c.sort((p,m)=>k.Dist(p,s)-k.Dist(m,s))[0]??(l?void 0:a)),d===void 0)return;const u=oe.applyToPoint(r.transform,d),h=oe.applyToPoint(oe.Inverse(t),u);n.setTo(h),r.didIntersect=!0}function Tw(n,e,t=0){const{arrowheadEnd:r,arrowheadStart:i}=e.props,o=e.props.bend+t;if(Math.abs(o)>Math.abs(e.props.bend*GF))return vd(n,e);const s=Xr(n,e),a=k.Med(s.start,s.end),l=k.Sub(s.end,s.start).uni(),c=k.Add(a,l.per().mul(-o)),d=$p(n,e.props.start),u=$p(n,e.props.end),h=s.start.clone(),p=s.end.clone(),m=c.clone();if(k.Equals(h,p))return{isStraight:!0,start:{handle:h,point:h,arrowhead:e.props.arrowheadStart},end:{handle:p,point:p,arrowhead:e.props.arrowheadEnd},middle:m,isValid:!1,length:0};const f=e.props.bend<0,w=f?vp:fz,S=VP(h,p,m),b=k.Angle(S.center,h),_=k.Angle(S.center,p),x=w(b,_);if(S.length===0||S.size===0||!x2(S.length)||!x2(S.size))return vd(n,e);const P=h.clone(),C=p.clone(),E=m.clone(),I=n.getShapePageTransform(e);let A=0,T=0,D=hl;if(d&&!d.isExact){const N=oe.applyToPoint(I,P),Y=oe.applyToPoint(I,S.center),ee=oe.applyToPoint(I,C),pe=oe.Inverse(d.transform),ve=oe.applyToPoint(pe,N),be=oe.applyToPoint(pe,Y),fe=oe.applyToPoint(pe,ee),{isClosed:Ce}=d,Rt=Ce?_P:kP;let Ue,Le=Rt(be,S.radius,d.outline);if(Le){const Ve=be.angle(ve),si=be.angle(fe),Xn=w(Ve,si);Le=Le.filter(Ot=>w(Ve,be.angle(Ot))<=Xn);const mr=Xn*.25;Le.sort(Ce?(Ot,Et)=>Math.abs(w(Ve,be.angle(Ot))-mr)<Math.abs(w(Ve,be.angle(Et))-mr)?-1:1:(Ot,Et)=>w(Ve,be.angle(Ot))<w(Ve,be.angle(Et))?-1:1),Ue=Le[0]??(Ce?void 0:ve)}else Ue=Ce?void 0:ve;if(Ue&&(P.setTo(n.getPointInShapeSpace(e,oe.applyToPoint(d.transform,Ue))),d.didIntersect=!0,i!=="none")){const Ve=qo[e.props.size]/2+("size"in d.shape.props?qo[d.shape.props.size]/2:0);A=Bp+Ve,D+=Ve}}if(u&&!u.isExact){const N=oe.applyToPoint(I,P),Y=oe.applyToPoint(I,C),ee=oe.applyToPoint(I,S.center),pe=oe.Inverse(u.transform),ve=oe.applyToPoint(pe,N),be=oe.applyToPoint(pe,ee),fe=oe.applyToPoint(pe,Y),Ce=u.isClosed,Rt=Ce?_P:kP;let Ue,Le=Rt(be,S.radius,u.outline);if(Le){const Ve=be.angle(ve),si=be.angle(fe),Xn=w(Ve,si),mr=Xn*.75;Le=Le.filter(Ot=>w(Ve,be.angle(Ot))<=Xn),Le.sort(Ce?(Ot,Et)=>Math.abs(w(Ve,be.angle(Ot))-mr)<Math.abs(w(Ve,be.angle(Et))-mr)?-1:1:(Ot,Et)=>w(Ve,be.angle(Ot))<w(Ve,be.angle(Et))?-1:1),Le[0]?Ue=Le[0]:Ue=Ce?void 0:fe}else Ue=Ce?void 0:fe;if(Ue&&(C.setTo(n.getPointInShapeSpace(e,oe.applyToPoint(u.transform,Ue))),u.didIntersect=!0,r!=="none")){const Ve=qo[e.props.size]/2+("size"in u.shape.props?qo[u.shape.props.size]/2:0);T=Bp+Ve,D+=Ve}}let F=k.Angle(S.center,P),H=k.Angle(S.center,C),O=w(F,H),K=O*S.radius;const B=P.clone(),te=C.clone();if(A!==0){const N=A/K*(f?1:-1),Y=k.FromAngle(F+O*N);B.setTo(S.center).add(Y.mul(S.radius))}if(T!==0){const N=T/K*(f?-1:1),Y=k.FromAngle(H+O*N);te.setTo(S.center).add(Y.mul(S.radius))}if(k.Dist(B,te)<D&&(A!==0&&T!==0?(A*=-1.5,T*=-1.5):A!==0?A*=-2:T!==0&&(T*=-2)),A!==0){const N=A/K*(f?1:-1),Y=k.FromAngle(F+O*N);P.setTo(S.center).add(Y.mul(S.radius))}if(T!==0){const N=T/K*(f?-1:1),Y=k.FromAngle(H+O*N);C.setTo(S.center).add(Y.mul(S.radius))}if(d&&u&&!d.isExact&&!u.isExact){F=k.Angle(S.center,P),H=k.Angle(S.center,C),O=w(F,H),K=O*S.radius;const N=Aw(n,d.shape.id,u.shape.id);if(N==="double-bound"&&K<30)P.setTo(h),C.setTo(p),E.setTo(m);else if(N==="safe"&&(d&&!d.didIntersect&&P.setTo(h),u&&!u.didIntersect||w(b,F)>w(b,H))){const Y=Math.min(.9,hl/K)*(f?1:-1),ee=k.FromAngle(F+O*Y);C.setTo(S.center).add(ee.mul(S.radius))}}YF(S.center,S.radius,P,C,E,x,f),P.equals(C)&&(P.setTo(E.clone().addXY(1,1)),C.setTo(E.clone().subXY(1,1))),h.setTo(P),p.setTo(C),m.setTo(E);const W=VP(h,p,m);return{isStraight:!1,start:{point:h,handle:s.start,arrowhead:e.props.arrowheadStart},end:{point:p,handle:s.end,arrowhead:e.props.arrowheadEnd},middle:m,handleArc:S,bodyArc:W,isValid:W.length!==0&&isFinite(W.center.x)&&isFinite(W.center.y)}}function VP(n,e,t){const r=-2*(n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y),i={x:((n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y))/r,y:((n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x))/r},o=k.Dist(i,n),s=+k.Clockwise(n,t,e),a=Math.hypot(n.y-e.y,n.x-e.x),l=Math.hypot(e.y-t.y,e.x-t.x),c=Math.hypot(t.y-n.y,t.x-n.x),d=Math.acos((l*l+c*c-a*a)/(2*l*c))*2,u=+(Fe>d),h=(We-d)*(s?1:-1),p=h*o;return{center:i,radius:o,size:h,length:p,largeArcFlag:u,sweepFlag:s}}function YF(n,e,t,r,i,o,s){const a=k.Angle(n,t),l=k.Angle(n,r);let c=vp(a,l);s||(c=We-c);const d=.5*(s?1:-1),u=k.FromAngle(a+c*d);if(i.setTo(n).add(u.mul(e)),c>o){i.rotWith(n,Fe);const h=r.clone();r.setTo(t),t.setTo(h)}}const XF={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"};class ae{constructor(e,t){y(this,"id");y(this,"type");y(this,"shapeType");y(this,"initial");y(this,"children");y(this,"parent");y(this,"_path");y(this,"_current");y(this,"_isActive");y(this,"transition",(e,t={})=>{var o;const r=e.split(".");let i=this;for(let s=0;s<r.length;s++){const a=r[s],l=i.getCurrent(),c=(o=i.children)==null?void 0:o[a];if(!c)throw Error(`${i.id} - no child state exists with the id ${a}.`);if((l==null?void 0:l.id)!==c.id&&(l==null||l.exit(t,a),i._current.set(c),c.enter(t,(l==null?void 0:l.id)||"initial"),!c.getIsActive()))break;i=c}return this});y(this,"handleEvent",e=>{var i;const t=XF[e.name],r=this.getCurrent();(i=this[t])==null||i.call(this,e),this.getCurrent()===r&&this.getIsActive()&&(r==null||r.handleEvent(e))});y(this,"enter",(e,t)=>{var r;if(this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,e,t),this.onTick&&this.editor.on("tick",this.onTick),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(e,t)}});y(this,"exit",(e,t)=>{var r,i;this._isActive.set(!1),this.onTick&&this.editor.off("tick",this.onTick),(r=this.onExit)==null||r.call(this,e,t),this.getIsActive()||((i=this.getCurrent())==null||i.exit(e,t))});y(this,"_currentToolIdMask",Cn("curent tool id mask",void 0));y(this,"onWheel");y(this,"onPointerDown");y(this,"onPointerMove");y(this,"onPointerUp");y(this,"onDoubleClick");y(this,"onTripleClick");y(this,"onQuadrupleClick");y(this,"onRightClick");y(this,"onMiddleClick");y(this,"onKeyDown");y(this,"onKeyUp");y(this,"onKeyRepeat");y(this,"onCancel");y(this,"onComplete");y(this,"onInterrupt");y(this,"onEnter");y(this,"onExit");y(this,"onTick");this.editor=e;const{id:r,children:i,initial:o}=this.constructor;this.id=r,this._isActive=Cn("toolIsActive"+this.id,!1),this._current=Cn("toolState"+this.id,void 0),this._path=Q("toolPath"+this.id,()=>{const s=this.getCurrent();return this.id+(s?`.${s.getPath()}`:"")}),this.parent=t??{},this.parent?i&&o?(this.type="branch",this.initial=o,this.children=Object.fromEntries(i().map(s=>[s.id,new s(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&o&&(this.initial=o,this.children=Object.fromEntries(i().map(s=>[s.id,new s(this.editor,this)])),this._current.set(this.children[this.initial])))}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}y(ae,"id"),y(ae,"initial"),y(ae,"children");class Up extends ae{constructor(){super(...arguments);y(this,"onKeyDown",t=>{var r;switch(t.code){case"KeyZ":{if(!(t.shiftKey||t.ctrlKey)){const i=this.getCurrent();i&&((r=i.getCurrent())==null?void 0:r.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...t,onInteractionEnd:i.id})}break}}})}}y(Up,"id","root"),y(Up,"initial",""),y(Up,"children",()=>[]);var qF=Object.defineProperty,JF=Object.getOwnPropertyDescriptor,he=(n,e,t,r)=>{for(var i=r>1?void 0:r?JF(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&qF(e,t,i),i};class ue extends dF.EventEmitter{constructor({store:t,user:r,shapeUtils:i,tools:o,getContainer:s,initialState:a,inferDarkMode:l}){super();y(this,"store");y(this,"root");y(this,"disposables",new Set);y(this,"_tickManager",new HF(this));y(this,"snaps");y(this,"user");y(this,"textMeasure");y(this,"environment");y(this,"scribbles");y(this,"getContainer");y(this,"sideEffects");y(this,"shapeUtils");y(this,"styleProps");y(this,"history",new OF(this,t=>{this.annotateError(t,{origin:"history.batch",willCrashApp:!0}),this.crash(t)}));y(this,"_crashingError",null);y(this,"_updateInstanceState",this.history.createCommand("updateInstanceState",(t,r)=>{const i=this.store.get(this.getInstanceState().id),o={...i,...t};return{data:{prev:i,next:o},ephemeral:!1,squashing:!1,...r}},{do:({next:t})=>{this.store.put([t])},undo:({prev:t})=>{this.store.put([t])},squash({prev:t},{next:r}){return{prev:t,next:r}}}));y(this,"_isChangingStyleTimeout",-1);y(this,"setCursor",t=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...t}},{ephemeral:!0}),this));y(this,"_setInstancePageState",this.history.createCommand("setInstancePageState",(t,r)=>({data:{prev:this.store.get(t.id??this.getCurrentPageState().id),partial:t},...r}),{do:({prev:t,partial:r})=>{this.store.update(t.id,i=>({...i,...r}))},undo:({prev:t})=>{this.store.update(t.id,()=>t)}}));y(this,"_setSelectedShapes",this.history.createCommand("setSelectedShapes",(t,r)=>{const{selectedShapeIds:i}=this.getCurrentPageState(),o=new Set(i);return t.length===o.size&&t.every(s=>o.has(s))?null:{data:{selectedShapeIds:t,prevSelectedShapeIds:i},preservesRedoStack:!0,...r}},{do:({selectedShapeIds:t})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},undo:({prevSelectedShapeIds:t})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},squash({prevSelectedShapeIds:t},{selectedShapeIds:r}){return{selectedShapeIds:r,prevSelectedShapeIds:t}}}));y(this,"_setFocusedGroupId",this.history.createCommand("setFocusedGroupId",t=>{const r=this.getCurrentPageState().focusedGroupId;if(r!==t)return{data:{prev:r,next:t},preservesRedoStack:!0,squashing:!0}},{do:({next:t})=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:t}))},undo:({prev:t})=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:t}))},squash({prev:t},{next:r}){return{prev:t,next:r}}}));y(this,"_viewportAnimation",null);y(this,"_willSetInitialBounds",!0);y(this,"_cameraState",Cn("camera state","idle"));y(this,"_cameraStateTimeoutRemaining",0);y(this,"_lastUpdateRenderingBoundsTimestamp",Date.now());y(this,"_decayCameraStateTimeout",t=>{this._cameraStateTimeoutRemaining-=t,this._cameraStateTimeoutRemaining<=0&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"),this.updateRenderingBounds())});y(this,"_tickCameraState",()=>{this._cameraStateTimeoutRemaining=Rz;const t=Date.now();this._cameraState.__unsafe__getWithoutCapture()==="idle"?(this._lastUpdateRenderingBoundsTimestamp=t,this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout)):t-this._lastUpdateRenderingBoundsTimestamp>Oz&&this.updateRenderingBounds()});y(this,"_renderingBounds",Cn("rendering viewport",new de));y(this,"_renderingBoundsExpanded",Cn("rendering viewport expanded",new de));y(this,"renderingBoundsMargin",100);y(this,"_currentPageShapeIds");y(this,"_setCurrentPageId",this.history.createCommand("setCurrentPage",(t,r)=>{if(!this.store.has(t)){console.error("Tried to set the current page id to a page that doesn't exist.");return}return this.stopFollowingUser(),{data:{toId:t,fromId:this.getCurrentPageId()},squashing:!0,preservesRedoStack:!0,...r}},{do:({toId:t})=>{if(this.store.has(t)){if(!this.getPageStates().find(r=>r.pageId===t)){const r=cn.create({id:cn.createId(t)});this.store.put([r,dn.create({id:dn.createId(t),pageId:t})])}this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.updateRenderingBounds()}},undo:({fromId:t})=>{this.store.has(t)&&(this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.updateRenderingBounds())},squash:({fromId:t},{toId:r})=>({toId:r,fromId:t})}));y(this,"_updatePage",this.history.createCommand("updatePage",(t,r)=>{if(this.getInstanceState().isReadonly)return null;const i=this.getPage(t.id);return i?{data:{prev:i,partial:t},...r}:null},{do:({partial:t})=>{this.store.update(t.id,r=>({...r,...t}))},undo:({prev:t,partial:r})=>{this.store.update(r.id,()=>t)},squash(t,r){return{prev:{...t.prev,...r.prev},partial:r.partial}}}));y(this,"_createPage",this.history.createCommand("createPage",t=>{if(this.getInstanceState().isReadonly||this.getPages().length>=kp)return null;const r=this.getPages(),i=bF(t.name??"Page 1",r.map(c=>c.name));let o=t.index;(!o||r.some(c=>c.index===o))&&(o=to(r[r.length-1].index));const s=Ji.create({meta:{},...t,name:i,index:o}),a=cn.create({id:cn.createId(s.id)}),l=dn.create({id:dn.createId(s.id),pageId:s.id});return{data:{newPage:s,newTabPageState:l,newCamera:a}}},{do:({newPage:t,newTabPageState:r,newCamera:i})=>{this.store.put([t,i,r])},undo:({newPage:t,newTabPageState:r,newCamera:i})=>{this.getPages().length!==1&&this.store.remove([r.id,t.id,i.id])}}));y(this,"_deletePage",this.history.createCommand("delete_page",t=>{if(this.getInstanceState().isReadonly)return null;const r=this.getPages();if(r.length===1)return null;const i=this.getPage(t),o=this.getPageStates().filter(s=>s.pageId===t);if(!i)return null;if(t===this.getCurrentPageId()){const s=r.findIndex(l=>l.id===t),a=r[s-1]??r[s+1];this.setCurrentPage(a.id)}return{data:{id:t,deletedPage:i,deletedPageStates:o}}},{do:({deletedPage:t,deletedPageStates:r})=>{const i=this.getPages();if(i.length!==1){if(t.id===this.getCurrentPageId()){const o=i.findIndex(a=>a.id===t.id),s=i[o-1]??i[o+1];this.setCurrentPage(s.id)}this.store.remove(r.map(o=>o.id)),this.store.remove([t.id]),this.updateRenderingBounds()}},undo:({deletedPage:t,deletedPageStates:r})=>{this.store.put([t]),this.store.put(r),this.updateRenderingBounds()}}));y(this,"_createAssets",this.history.createCommand("createAssets",t=>this.getInstanceState().isReadonly||t.length<=0?null:{data:{assets:t}},{do:({assets:t})=>{this.store.put(t)},undo:({assets:t})=>{this.store.remove(t.map(r=>r.id))}}));y(this,"_updateAssets",this.history.createCommand("updateAssets",t=>this.getInstanceState().isReadonly||t.length<=0?void 0:{data:{snapshots:{},assets:t}},{do:({assets:t,snapshots:r})=>{this.store.put(t.map(i=>{const o=this.store.get(i.id);return r[i.id]=o,{...o,...i}}))},undo:({snapshots:t})=>{this.store.put(Object.values(t))}}));y(this,"_deleteAssets",this.history.createCommand("deleteAssets",t=>{if(this.getInstanceState().isReadonly||t.length<=0)return;const r=me(t.map(i=>this.store.get(i)));return{data:{ids:t,prev:r}}},{do:({ids:t})=>{this.store.remove(t)},undo:({prev:t})=>{this.store.put(t)}}));y(this,"_parentIdsToChildIds");y(this,"_childIdsCache",new Pw);y(this,"_createShapes",this.history.createCommand("createShapes",t=>{if(this.getInstanceState().isReadonly||t.length<=0)return null;const r=this.getCurrentPageShapeIds();if(t.length+r.size>Qi){Vp(this);return}return t.length===0?null:{data:{currentPageId:this.getCurrentPageId(),partials:t.map(i=>i.id?i:{...i,id:tt()})}}},{do:({partials:t})=>{var a,l;const r=this.getFocusedGroupId(),i=this.getCurrentPageShapesSorted();t=t.map(c=>{if(!c.parentId||!(this.store.has(c.parentId)||t.some(d=>d.id===c.parentId))){let d=this.getFocusedGroupId();for(let h=i.length-1;h>=0;h--){const p=i[h];if(this.getShapeUtil(p).canReceiveNewChildrenOfType(p,c.type)&&this.isPointInShape(p,{x:c.x??0,y:c.y??0},{margin:0,hitInside:!0})){d=p.id;break}}const u=c.parentId;if(d===c.id&&(d=r),d!==u&&(c={...c},c.parentId=d,kr(d))){const h=this.getPointInShapeSpace(this.getShape(d),{x:c.x??0,y:c.y??0});c.x=h.x,c.y=h.y,c.rotation=-this.getShapePageTransform(d).rotation()+(c.rotation??0)}}return c});const o=new Map,s=[];for(const c of t){const d=this.getShapeUtil(c);let u=c.index;if(!u){const f=c.parentId??r;o.has(f)||o.set(f,this.getHighestIndexForParent(f)),u=o.get(f),o.set(f,to(u))}const h=d.getDefaultProps();for(const[f,w]of this.styleProps[c.type])h[w]=this.getStyleForNextShape(f);let p=this.store.schema.types.shape.create({...c,index:u,opacity:c.opacity??this.getInstanceState().opacityForNextShape,parentId:c.parentId??r,props:"props"in c?{...h,...c.props}:h});if(p.index===void 0)throw Error("no index!");const m=(l=(a=this.getShapeUtil(p)).onBeforeCreate)==null?void 0:l.call(a,p);m&&(p=m),s.push(p)}s.forEach(c=>{c.meta={...this.getInitialMetaForShape(c),...c.meta}}),this.store.put(s)},undo:({partials:t})=>{this.store.remove(t.map(r=>r.id))}}));y(this,"animatingShapes",new Map);y(this,"_updateShapes",this.history.createCommand("updateShapes",(t,r)=>{if(this.getInstanceState().isReadonly)return null;const i=me(t),o=Object.fromEntries(me(i.map(({id:l})=>this.getShape(l))).map(l=>[l.id,l]));if(i.length<=0)return null;const s=me(i.map(l=>{const c=o[l.id];if(!c)return null;let d=null;for(const[u,h]of Object.entries(l))if(h!==void 0)switch(u){case"id":case"type":continue;default:if(h!==c[u])if(d||(d={...c}),u==="props"){const p={...c.props};for(const[m,f]of Object.entries(h))f!==void 0&&(p[m]=f);d.props=p}else if(u==="meta"){const p={...c.meta};for(const[m,f]of Object.entries(h))f!==void 0&&(p[m]=f);d.meta=p}else d[u]=h}return d??c})),a=Object.fromEntries(s.map(l=>[l.id,l]));return{data:{snapshots:o,updates:a},...r}},{do:({updates:t})=>{var i,o;const r=Object.values(t);for(let s=0;s<r.length;s++){const a=r[s],l=this.store.get(a.id);if(!l)continue;const c=(o=(i=this.getShapeUtil(a)).onBeforeUpdate)==null?void 0:o.call(i,l,a);c&&(r[s]=c)}this.store.put(r)},undo:({snapshots:t})=>{this.store.put(Object.values(t))},squash(t,r){return{snapshots:{...r.snapshots,...t.snapshots},updates:{...t.updates,...r.updates}}}}));y(this,"_deleteShapes",this.history.createCommand("delete_shapes",t=>{if(this.getInstanceState().isReadonly||t.length===0)return null;const r=[...this.getCurrentPageState().selectedShapeIds],i=new Set(t);for(const c of t)this.visitDescendants(c,d=>{i.add(d)});const o=[...i],s=this._getArrowBindingsIndex().get(),a=me(o.flatMap(c=>{const d=this.getShape(c),u=s[c];return u&&u.length>0?u.map(({arrowId:h})=>this.getShape(h)).concat(d):d})),l=r.filter(c=>!i.has(c));return{data:{deletedIds:o,snapshots:a,prevSelectedShapeIds:r,postSelectedShapeIds:l}}},{do:({deletedIds:t,postSelectedShapeIds:r})=>{this.store.remove(t),this.store.update(this.getCurrentPageState().id,i=>({...i,selectedShapeIds:r}))},undo:({snapshots:t,prevSelectedShapeIds:r})=>{this.store.put(t),this.store.update(this.getCurrentPageState().id,i=>({...i,selectedShapeIds:r}))}}));y(this,"_selectionSharedStyles",Q("_selectionSharedStyles",()=>{const t=this.getSelectedShapes(),r=new Cw;for(const i of t)this._extractSharedStyles(i,r);return r}));y(this,"externalAssetContentHandlers",{file:null,url:null});y(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null});y(this,"inputs",{originPagePoint:new k,originScreenPoint:new k,previousPagePoint:new k,previousScreenPoint:new k,currentPagePoint:new k,currentScreenPoint:new k,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new k});y(this,"_clickManager",new TF(this));y(this,"_prevCursor","default");y(this,"_shiftKeyTimeout",-1);y(this,"_setShiftKeyTimeout",()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})});y(this,"_altKeyTimeout",-1);y(this,"_setAltKeyTimeout",()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})});y(this,"_ctrlKeyTimeout",-1);y(this,"_setCtrlKeyTimeout",()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})});y(this,"_restoreToolId","select");y(this,"_pinchStart",1);y(this,"_didPinch",!1);y(this,"_selectedShapeIdsAtPointerDown",[]);y(this,"capturedPointerId",null);y(this,"dispatch",t=>{if(this.getCrashingError())return this;const{inputs:r}=this,{type:i}=t;return this.batch(()=>{if(t.type==="misc"){(t.name==="cancel"||t.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))),this.root.handleEvent(t);return}t.shiftKey?(clearInterval(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,r.shiftKey=!0):!t.shiftKey&&r.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=setTimeout(this._setShiftKeyTimeout,150)),t.altKey?(clearInterval(this._altKeyTimeout),this._altKeyTimeout=-1,r.altKey=!0):!t.altKey&&r.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=setTimeout(this._setAltKeyTimeout,150)),t.ctrlKey?(clearInterval(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,r.ctrlKey=!0):!t.ctrlKey&&r.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:o,originScreenPoint:s,currentPagePoint:a,currentScreenPoint:l}=r;switch(r.isPointing||(r.isDragging=!1),i){case"pinch":{if(!this.getInstanceState().canMoveCamera)return;switch(this._updateInputsFromEvent(t),t.name){case"pinch_start":{if(r.isPinching)return;r.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds()),this._didPinch=!0,r.isPinching=!0,this.interrupt());return}case"pinch":{if(!r.isPinching)return;const{point:{x:c,y:d,z:u=1},delta:{x:h,y:p}}=t,{x:m,y:f,z:w}=this.getCamera(),S=Math.min(Wo,Math.max(cd,u));this.setCamera({x:m+h/w-c/w+c/S,y:f+p/w-d/w+d/S,z:S});return}case"pinch_end":{if(!r.isPinching)return this;r.isPinching=!1;const{_selectedShapeIdsAtPointerDown:c}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown,{squashing:!0}),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,requestAnimationFrame(()=>{this._didPinch||this.setSelectedShapes(c,{squashing:!0})}));return}}}case"wheel":{if(!this.getInstanceState().canMoveCamera)return;if(this._updateInputsFromEvent(t),!this.getIsMenuOpen()){if(r.ctrlKey){const{x:c,y:d}=this.inputs.currentScreenPoint,{x:u,y:h,z:p}=this.getCamera(),m=Math.min(Wo,Math.max(cd,p+(t.delta.z??0)*p));this.setCamera({x:u+(c/m-c)-(c/p-c),y:h+(d/m-d)-(d/p-d),z:m});return}this.pan(t.delta),!r.isDragging&&r.isPointing&&o.dist(a)>(this.getInstanceState().isCoarsePointer?lw:dd)/this.getZoomLevel()&&(r.isDragging=!0)}break}case"pointer":{if(r.isPinching)return;this._updateInputsFromEvent(t);const{isPen:c}=t;switch(t.name){case"pointer_down":{if(this.clearOpenMenus(),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),t.button===0&&(this.capturedPointerId=t.pointerId),r.buttons.add(t.button),r.isPointing=!0,r.isDragging=!1,this.getInstanceState().isPenMode){if(!c)return}else c&&this.updateInstanceState({isPenMode:!0});if(t.button===5?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):t.button===1&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0),this.inputs.isPanning)return this.stopCameraAnimation(),this.updateInstanceState({cursor:{type:"grabbing",rotation:0}}),this;s.setTo(l),o.setTo(a);break}case"pointer_move":{if(!c&&this.getInstanceState().isPenMode)return;if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:d,previousScreenPoint:u}=this.inputs;this.pan(k.Sub(d,u));return}!r.isDragging&&r.isPointing&&o.dist(a)>(this.getInstanceState().isCoarsePointer?lw:dd)/this.getZoomLevel()&&(r.isDragging=!0);break}case"pointer_up":{if(r.buttons.delete(t.button),r.isPointing=!1,r.isDragging=!1,this.getIsMenuOpen()||!c&&this.getInstanceState().isPenMode)return;this.capturedPointerId===t.pointerId&&(this.capturedPointerId=null,t.button=0),r.isPanning?t.button===1?this.inputs.keys.has(" ")?(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:Pp}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):(r.isPanning=!1,this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:Pp}),this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}})):t.button===0&&(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:Pp}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):t.button===5&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(t.key==="ShiftRight"&&(t.key="ShiftLeft"),t.key==="AltRight"&&(t.key="AltLeft"),t.code==="ControlRight"&&(t.code="ControlLeft"),t.name){case"key_down":{r.keys.add(t.code),!t.ctrlKey&&t.code==="Space"&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,this.updateInstanceState({cursor:{type:this.inputs.isPointing?"grabbing":"grab",rotation:0}}));break}case"key_up":{r.keys.delete(t.code),t.code==="Space"&&!this.inputs.buttons.has(1)&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}));break}}break}}if(t.type==="pointer"&&(t.button===1?t.name="middle_click":t.button===2&&(t.name="right_click"),t.isPen===this.getInstanceState().isPenMode))switch(t.name){case"pointer_down":{const c=this._clickManager.transformPointerDownEvent(t);if(t.name!==c.name){this.root.handleEvent(t),this.emit("event",t),this.root.handleEvent(c),this.emit("event",c);return}break}case"pointer_up":{const c=this._clickManager.transformPointerUpEvent(t);if(t.name!==c.name){this.root.handleEvent(t),this.emit("event",t),this.root.handleEvent(c),this.emit("event",c);return}break}case"pointer_move":{this._clickManager.handleMove();break}}this.root.handleEvent(t),this.emit("event",t)}),this});this.store=t,this.snaps=new Xo(this),this.user=new vi(r??vP(),l??!1),this.getContainer=s??(()=>document.body),this.textMeasure=new VF(this);class c extends Up{}y(c,"initial",a??""),this.root=new c(this),this.root.children={};const d=IP(i),u=new Set(Object.keys(t.schema.types.shape.migrations.subTypeMigrations));for(const x of d){if(!u.has(x.type))throw Error(`Editor and store have different shapes: "${x.type}" was passed into the editor but not the schema`);u.delete(x.type)}if(u.size>0)throw Error(`Editor and store have different shapes: "${[...u][0]}" is present in the store schema but not provided to the editor`);const h={},p={},m=new Map;for(const x of d){const P=new x(this);h[x.type]=P;const C=o2(x.props??{});p[x.type]=C;for(const E of C.keys())if(!m.has(E.id))m.set(E.id,E);else if(m.get(E.id)!==E)throw Error(`Multiple style props with id "${E.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=h,this.styleProps=p;for(const x of[...o]){if(ep(this.root.children,x.id))throw Error(`Can't override tool with id "${x.id}"`);this.root.children[x.id]=new x(this,this.root)}this.environment=new jF(this),this.scribbles=new DF(this);const f=new Set,w=x=>{var W;const P=this.getShape(x);if(!P)return;const{start:C,end:E}=P.props,I=C.type==="binding"?this.getShape(C.boundShapeId):void 0,A=E.type==="binding"?this.getShape(E.boundShapeId):void 0,T=this.getAncestorPageId(P);if(!T)return;let D;if(I&&A)D=this.findCommonAncestor([I,A])??T;else if(I||A){const N=(W=I||A)==null?void 0:W.parentId;N&&N===P.parentId?D=P.parentId:D=T}else return;D&&D!==P.parentId&&this.reparentShapes([x],D);const F=this.getShape(x);if(!F)throw Error("no reparented arrow");const H=this.getShapeNearestSibling(F,I),O=this.getShapeNearestSibling(F,A);let K;if(H&&O)K=H.index>O.index?H:O;else if(H&&!O)K=H;else if(O&&!H)K=O;else return;let B;const te=this.getSortedChildIdsForParent(K.parentId).map(N=>this.getShape(N)).filter(N=>N.index>K.index);if(te.length){const N=te.find(Y=>Y.type!=="arrow");if(F.index>K.index&&(!N||F.index<N.index))return;B=wd(K.index,te[0].index)}else B=to(K.index);B!==F.index&&this.updateShapes([{id:x,type:"arrow",index:B}])},S=(x,P)=>{const{x:C,y:E}=Xr(this,x)[P];this.store.put([{...x,props:{...x.props,[P]:{type:"point",x:C,y:E}}}])},b=x=>{for(const P of["start","end"]){const C=x.props[P];if(C.type!=="binding")continue;const E=this.getShape(C.boundShapeId),I=this.getAncestorPageId(x)===this.getAncestorPageId(E);(!E||!I)&&S(x,P)}w(x.id)},_=(x,P)=>{let C=null;const E=x.selectedShapeIds.filter(T=>!P.has(T));E.length!==x.selectedShapeIds.length&&(C||(C={...x}),C.selectedShapeIds=E);const I=x.erasingShapeIds.filter(T=>!P.has(T));I.length!==x.erasingShapeIds.length&&(C||(C={...x}),C.erasingShapeIds=I),x.hoveredShapeId&&P.has(x.hoveredShapeId)&&(C||(C={...x}),C.hoveredShapeId=null),x.editingShapeId&&P.has(x.editingShapeId)&&(C||(C={...x}),C.editingShapeId=null);const A=x.hintingShapeIds.filter(T=>!P.has(T));return A.length!==x.hintingShapeIds.length&&(C||(C={...x}),C.hintingShapeIds=A),x.focusedGroupId&&P.has(x.focusedGroupId)&&(C||(C={...x}),C.focusedGroupId=null),C};if(this.sideEffects=new LF(this),this.sideEffects.registerBatchCompleteHandler(()=>{var x,P;for(const C of f){f.delete(C);const E=this.getShape(C);if(!E)continue;const I=(P=(x=this.getShapeUtil(E)).onChildrenChange)==null?void 0:P.call(x,E);I!=null&&I.length&&this.updateShapes(I,{squashing:!0})}this.emit("update")}),this.sideEffects.registerBeforeDeleteHandler("shape",x=>{x.parentId&&kr(x.parentId)&&f.add(x.parentId);const P=this._getArrowBindingsIndex().get()[x.id];if(P!=null&&P.length)for(const{arrowId:I,handleId:A}of P){const T=this.getShape(I);T&&S(T,A)}const C=new Set([x.id]),E=me(this.getPageStates().map(I=>_(I,C)));E.length&&this.store.put(E)}),this.sideEffects.registerBeforeDeleteHandler("page",x=>{var I;if(this.getInstanceState().currentPageId!==x.id)return;const P=(I=this.getPages().find(A=>A.id!==x.id))==null?void 0:I.id;if(!P)return;this.store.put([{...this.getInstanceState(),currentPageId:P}]);const C=cn.createId(x.id),E=dn.createId(x.id);this.store.remove([C,E])}),this.sideEffects.registerAfterChangeHandler("shape",(x,P)=>{if(this.isShapeOfType(P,"arrow")&&b(P),x.parentId!==P.parentId){const C=E=>{const I=this._getArrowBindingsIndex().get()[E];if(I!=null&&I.length)for(const A of I)w(A.arrowId)};C(P.id),this.visitDescendants(P.id,C)}if(x.parentId!==P.parentId&&Un(P.parentId)){const C=new Set([x.id]);this.visitDescendants(x.id,E=>{C.add(E)});for(const E of this.getPageStates()){if(E.pageId===P.parentId)continue;const I=_(E,C);I&&this.store.put([I])}}x.parentId&&kr(x.parentId)&&f.add(x.parentId),P.parentId!==x.parentId&&kr(P.parentId)&&f.add(P.parentId)}),this.sideEffects.registerAfterChangeHandler("instance_page_state",(x,P)=>{if((x==null?void 0:x.selectedShapeIds)!==(P==null?void 0:P.selectedShapeIds)){const C=P.selectedShapeIds.filter(I=>{var T,D;let A=(T=this.getShape(I))==null?void 0:T.parentId;for(;kr(A);){if(P.selectedShapeIds.includes(A))return!1;A=(D=this.getShape(A))==null?void 0:D.parentId}return!0});let E=null;if(C.length>0){const I=this.findCommonAncestor(me(C.map(A=>this.getShape(A))),A=>this.isShapeOfType(A,"group"));I&&(E=I)}else P!=null&&P.focusedGroupId&&(E=P.focusedGroupId);(C.length!==P.selectedShapeIds.length||E!==P.focusedGroupId)&&this.store.put([{...P,selectedShapeIds:C,focusedGroupId:E??null}])}}),this.sideEffects.registerAfterCreateHandler("shape",x=>{this.isShapeOfType(x,"arrow")&&b(x)}),this.sideEffects.registerAfterCreateHandler("page",x=>{const P=cn.createId(x.id),C=dn.createId(x.id);this.store.has(P)||this.store.put([cn.create({id:P})]),this.store.has(C)||this.store.put([dn.create({id:C,pageId:x.id})])}),this._currentPageShapeIds=MF(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=IF(this.store),this.disposables.add(this.store.listen(x=>{this.emit("change",x)})),this.store.ensureStoreIsUsable(),this._setInstancePageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]},{ephemeral:!0}),a&&this.root.children[a]===void 0)throw Error(`No state found for initialState "${a}".`);this.root.enter(void 0,"initial"),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.updateRenderingBounds(),requestAnimationFrame(()=>{this._tickManager.start()})}dispose(){this.disposables.forEach(t=>t()),this.disposables.clear()}getShapeUtil(t){const r=typeof t=="string"?t:t.type,i=zs(this.shapeUtils,r);return Ls(i,`No shape util found for type "${r}"`),i}undo(){return this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this.history.redo(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(t,r,i){return this.history.mark(t,r,i),this}bail(){return this.history.bail(),this}bailToMark(t){return this.history.bailToMark(t),this}batch(t){return this.history.batch(t),this}_getArrowBindingsIndex(){return EF(this)}getArrowsBoundTo(t){return this._getArrowBindingsIndex().get()[t]||Gi}getArrowInfoCache(){return this.store.createComputedCache("arrow infoCache",t=>bd(t)?vd(this,t):Tw(this,t))}getArrowInfo(t){const r=typeof t=="string"?t:t.id;return this.getArrowInfoCache().get(r)}annotateError(t,{origin:r,willCrashApp:i,tags:o,extras:s}){const a=this.createErrorAnnotations(r,i);return D0(t,{tags:{...a.tags,...o},extras:{...a.extras,...s}}),i&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(t,r){try{const i=this.getEditingShapeId();return{tags:{origin:t,willCrashApp:r},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:i?this.getShape(i):void 0,inputs:this.inputs}}}catch{return{tags:{origin:t,willCrashApp:r},extras:{}}}}getCrashingError(){return this._crashingError}crash(t){return this._crashingError=t,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:t}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(t){const r=t.split(".").reverse();let i=this.root;for(;r.length>0;){const o=r.pop();if(!o)return!0;const s=i.getCurrent();if((s==null?void 0:s.id)===o){if(r.length===0)return!0;i=s;continue}else return!1}return!1}isInAny(...t){return t.some(r=>this.isIn(r))}setCurrentTool(t,r={}){return this.root.transition(t,r),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const t=this.getCurrentTool();return t?t.getCurrentToolIdMask()??t.id:""}getStateDescendant(t){var o;const r=t.split(".").reverse();let i=this.root;for(;r.length>0;){const s=r.pop();if(!s)return i;const a=(o=i.children)==null?void 0:o[s];if(!a)return;i=a}return i}getDocumentSettings(){return this.store.get(Z0)}updateDocumentSettings(t){return this.store.put([{...this.getDocumentSettings(),...t}]),this}getInstanceState(){return this.store.get(In)}updateInstanceState(t,r){return this._updateInstanceState(t,{ephemeral:!0,squashing:!0,...r}),t.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),t.isChangingStyle===!0&&(this._isChangingStyleTimeout=setTimeout(()=>{this.updateInstanceState({isChangingStyle:!1})},2e3))),this}getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(t){const r=new Set(this.getOpenMenus());return r.has(t)||(r.add(t),this.updateInstanceState({openMenus:[...r]})),this}deleteOpenMenu(t){const r=new Set(this.getOpenMenus());return r.has(t)&&(r.delete(t),this.updateInstanceState({openMenus:[...r]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return dn.createId(this.getCurrentPageId())}updateCurrentPageState(t,r){return this._setInstancePageState(t,r),this}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:t}=this.getCurrentPageState();return me(t.map(r=>this.store.get(r)))}setSelectedShapes(t,r){const i=t.map(o=>typeof o=="string"?o:o.id);return this._setSelectedShapes(i,r),this}isAncestorSelected(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null,i=this.getShape(r);if(!i)return!1;const o=this.getSelectedShapeIds();return!!this.findShapeAncestor(i,s=>o.includes(s.id))}select(...t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this.setSelectedShapes(r),this}deselect(...t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=this.getSelectedShapeIds();return i.length>0&&r.length>0&&this.setSelectedShapes(i.filter(o=>!r.includes(o))),this}selectAll(){const t=this.getSortedChildIdsForParent(this.getCurrentPageId());return t.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(t)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShape(){const t=this.getSelectedShapes();return t.length===1?t[0]:null}getSelectionPageBounds(){const t=this.getCurrentPageState().selectedShapeIds;return t.length===0?null:de.Common(me(t.map(r=>this.getShapePageBounds(r))))}getSelectionRotation(){const t=this.getSelectedShapeIds();if(t.length===0)return 0;if(t.length===1)return this.getShapePageTransform(this.getSelectedShapeIds()[0]).rotation();const r=t.map(i=>this.getShapePageTransform(i).rotation());return r.every(i=>Math.abs(i-r[0])<Math.PI/180)?this.getShapePageTransform(t[0]).rotation():0}getSelectionRotatedPageBounds(){const t=this.getSelectedShapeIds();if(t.length===0)return;const r=this.getSelectionRotation();if(r===0)return this.getSelectionPageBounds();if(t.length===1){const o=this.getShapeGeometry(t[0]).bounds.clone(),s=this.getShapePageTransform(t[0]);return o.point=s.applyToPoint(o.point),o}const i=de.FromPoints(this.getSelectedShapeIds().flatMap(o=>{const s=this.getShapePageTransform(o);return s?s.applyToPoints(this.getShapeGeometry(o).vertices):[]}).map(o=>k.Rot(o,-r)));return i.point=i.point.rot(r),i}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const t=this.getFocusedGroupId();return t?this.getShape(t):void 0}setFocusedGroup(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==null){const i=this.getShape(r);if(!i)throw Error(`Editor.setFocusedGroup: Shape with id ${r} does not exist`);if(!this.isShapeOfType(i,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${i.type}`)}return r===this.getFocusedGroupId()?this:(this._setFocusedGroupId(r),this)}popFocusedGroupId(){const t=this.getFocusedGroup();if(t){const r=this.findShapeAncestor(t,i=>this.isShapeOfType(i,"group"));this.setFocusedGroup((r==null?void 0:r.id)??null),this.select(t.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const t=this.getEditingShapeId();return t?this.getShape(t):void 0}setEditingShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==this.getEditingShapeId()){if(r){const i=this.getShape(r);if(i&&this.getShapeUtil(i).canEdit(i))return this._setInstancePageState({editingShapeId:r}),this}this._setInstancePageState({editingShapeId:null})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const t=this.getHoveredShapeId();return t?this.getShape(t):void 0}setHoveredShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;return r===this.getHoveredShapeId()?this:(this.updateCurrentPageState({hoveredShapeId:r},{ephemeral:!0}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const t=this.getHintingShapeIds();return me(t.map(r=>this.getShape(r)))}setHintingShapes(t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this.updateCurrentPageState({hintingShapeIds:Jh(r)},{ephemeral:!0}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const t=this.getErasingShapeIds();return me(t.map(r=>this.getShape(r)))}setErasingShapes(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id);r.sort();const i=this.getErasingShapeIds();if(r.length===i.length){for(let o=0;o<r.length;o++)if(r[o]!==i[o]){this._setInstancePageState({erasingShapeIds:r},{ephemeral:!0});break}}else this._setInstancePageState({erasingShapeIds:r},{ephemeral:!0});return this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==this.getCroppingShapeId())if(!r)this.updateCurrentPageState({croppingShapeId:null});else{const i=this.getShape(r),o=this.getShapeUtil(i);i&&o.canCrop(i)&&this.updateCurrentPageState({croppingShapeId:r})}return this}getCameraId(){return cn.createId(this.getCurrentPageId())}getCamera(){return this.store.get(this.getCameraId())}getZoomLevel(){return this.getCamera().z}_setCamera(t){const r=this.getCamera();return r.x===t.x&&r.y===t.y&&r.z===t.z?this:(this.batch(()=>{this.store.put([{...r,...t}]);const{currentScreenPoint:i}=this.inputs;this.dispatch({type:"pointer",target:"canvas",name:"pointer_move",point:i,pointerId:I2.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1}),this._tickCameraState()}),this)}setCamera(t,r){const i=Number.isFinite(t.x)?t.x:0,o=Number.isFinite(t.y)?t.y:0,s=Number.isFinite(t.z)?t.z:this.getZoomLevel();if(this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),r){const{width:a,height:l}=this.getViewportScreenBounds();return this._animateToViewport(new de(-i,-o,a/s,l/s),r)}else this._setCamera({x:i,y:o,z:s});return this}centerOnPoint(t,r){if(!this.getInstanceState().canMoveCamera)return this;const{width:i,height:o}=this.getViewportPageBounds();return this.setCamera({x:-(t.x-i/2),y:-(t.y-o/2),z:this.getCamera().z},r),this}zoomToContent(){const t=this.getSelectionPageBounds()??this.getCurrentPageBounds();return t&&this.zoomToBounds(t,Math.min(1,this.getZoomLevel()),{duration:220}),this}zoomToFit(t){if(!this.getInstanceState().canMoveCamera)return this;const r=[...this.getCurrentPageShapeIds()];if(r.length<=0)return this;const i=de.Common(me(r.map(o=>this.getShapePageBounds(o))));return this.zoomToBounds(i,void 0,t),this}resetZoom(t=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera(),{x:a,y:l}=t;return this.setCamera({x:i+(a/1-a)-(a/s-a),y:o+(l/1-l)-(l/s-l),z:1},r),this}zoomIn(t=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();let a=Wo;for(let d=1;d<tl.length;d++){const u=tl[d-1],h=tl[d];if(!(h-s<=(h-u)/2)){a=h;break}}const{x:l,y:c}=t;return this.setCamera({x:i+(l/a-l)-(l/s-l),y:o+(c/a-c)-(c/s-c),z:a},r),this}zoomOut(t=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();let a=cd;for(let d=tl.length-1;d>0;d--){const u=tl[d-1],h=tl[d];if(!(h-s>=(h-u)/2)){a=u;break}}const{x:l,y:c}=t;return this.setCamera({x:i+(l/a-l)-(l/s-l),y:o+(c/a-c)-(c/s-c),z:a},r),this}zoomToSelection(t){if(!this.getInstanceState().canMoveCamera)return this;const r=this.getSelectionPageBounds();return r?(this.zoomToBounds(r,Math.max(1,this.getZoomLevel()),t),this):this}panZoomIntoView(t,r){if(!this.getInstanceState().canMoveCamera)return this;if(t.length<=0)return this;const i=de.Common(me(t.map(s=>this.getShapePageBounds(s)))),o=this.getViewportPageBounds();if(o.h<i.h||o.w<i.w)return this.zoomToBounds(i,this.getCamera().z,r),this;{const s=this.getViewportPageBounds().clone().expandBy(-32/this.getZoomLevel());let a=0,l=0;s.maxY<i.maxY?l=s.maxY-i.maxY:s.minY>i.minY&&(l=s.minY-i.minY),s.maxX<i.maxX?a=s.maxX-i.maxX:s.minX>i.minX&&(a=s.minX-i.minX);const c=this.getCamera();this.setCamera({x:c.x+a,y:c.y+l,z:c.z},r)}return this}zoomToBounds(t,r,i){if(!this.getInstanceState().canMoveCamera)return this;const o=this.getViewportScreenBounds(),s=Math.min(256,o.width*.28);let a=wi(Math.min((o.width-s)/t.width,(o.height-s)/t.height),cd,Wo);return r!==void 0&&(a=Math.min(r,a)),this.setCamera({x:-t.minX+(o.width-t.width*a)/2/a,y:-t.minY+(o.height-t.height*a)/2/a,z:a},i),this}pan(t,r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();return this.setCamera({x:i+t.x/s,y:o+t.y/s,z:s},r),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(t){if(!this._viewportAnimation)return;const r=()=>{this.removeListener("tick",this._animateViewport),this.removeListener("stop-camera-animation",r),this._viewportAnimation=null};this.once("stop-camera-animation",r),this._viewportAnimation.elapsed+=t;const{elapsed:i,easing:o,duration:s,start:a,end:l}=this._viewportAnimation;if(i>s){this._setCamera({x:-l.x,y:-l.y,z:this.getViewportScreenBounds().width/l.width}),r();return}const c=s-i,d=o(1-c/s),u=a.minX+(l.minX-a.minX)*d,h=a.minY+(l.minY-a.minY)*d,p=a.maxX+(l.maxX-a.maxX)*d;this._setCamera({x:-u,y:-h,z:this.getViewportScreenBounds().width/(p-u)})}_animateToViewport(t,r={}){const{duration:i=0,easing:o=pn.easeInOutCubic}=r,s=this.user.getAnimationSpeed(),a=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),i===0||s===0?this._setCamera({x:-t.x,y:-t.y,z:this.getViewportScreenBounds().width/t.width}):(this._viewportAnimation={elapsed:0,duration:i/s,easing:o,start:a.clone(),end:t.clone()},this.addListener("tick",this._animateViewport),this)}slideCamera(t={}){if(!this.getInstanceState().canMoveCamera)return this;if(this.stopCameraAnimation(),this.user.getAnimationSpeed()===0)return this;const{speed:r,friction:i,direction:o,speedThreshold:s=.01}=t;let a=Math.min(r,1);const l=()=>{this.removeListener("tick",c),this.removeListener("stop-camera-animation",l)};this.once("stop-camera-animation",l);const c=d=>{const{x:u,y:h,z:p}=this.getCamera(),m=k.Mul(o,a*d/p);a*=1-i,a<s?l():this._setCamera({x:u+m.x,y:h+m.y,z:p})};return this.addListener("tick",c),this}animateToUser(t){const r=[...this.store.query.records("instance_presence",()=>({userId:{eq:t}})).get()].sort((i,o)=>i.lastActivityTimestamp-o.lastActivityTimestamp).pop();return r?(this.batch(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const i=r.currentPageId===this.getCurrentPageId();i||this.setCurrentPage(r.currentPageId);const o=i?{duration:500}:void 0;this.centerOnPoint(r.cursor,o);const{highlightedUserIds:s}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...s,t]}),setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],l=a.indexOf(t);l<0||(a.splice(l,1),this.updateInstanceState({highlightedUserIds:a}))},E2)}),this):this}animateToShape(t,r=Az){if(!this.getInstanceState().canMoveCamera)return this;const i=this.getViewportScreenBounds().clone().expandBy(-32),o=i.width/i.height,s=this.getShapePageBounds(t);if(!s)return this;const a=s.width/s.height,l=s.clone(),c=s.width/i.width;return l.width+=(i.minX+i.maxX)*c,l.height+=(i.minY+i.maxY)*c,l.x-=i.minX*c,l.y-=i.minY*c,a>o?(l.height=s.width/o,l.y-=(l.height-s.height)/2):(l.width=s.height*o,l.x-=(l.width-s.width)/2),this._animateToViewport(l,r)}updateViewportScreenBounds(t=!1){const r=this.getContainer();if(!r)return this;const i=r.getBoundingClientRect(),o=new de(i.left||i.x,i.top||i.y,Math.max(i.width,1),Math.max(i.height,1)),s=o.equals(this.getViewportScreenBounds()),{_willSetInitialBounds:a}=this;if(s)this._willSetInitialBounds=!1;else if(a)this._willSetInitialBounds=!1,this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0});else if(t&&!this.getInstanceState().followingUserId){const l=this.getViewportPageCenter();this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0}),this.centerOnPoint(l)}else this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0});return this._tickCameraState(),this.updateRenderingBounds(),this}getViewportScreenBounds(){const{x:t,y:r,w:i,h:o}=this.getInstanceState().screenBounds;return new de(t,r,i,o)}getViewportScreenCenter(){return this.getViewportScreenBounds().center}getViewportPageBounds(){const{w:t,h:r}=this.getViewportScreenBounds(),{x:i,y:o,z:s}=this.getCamera();return new de(-i,-o,t/s,r/s)}getViewportPageCenter(){return this.getViewportPageBounds().center}screenToPage(t){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(In),{x:i,y:o,z:s=1}=this.getCamera();return{x:(t.x-r.x)/s-i,y:(t.y-r.y)/s-o,z:t.z??.5}}pageToScreen(t){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(In),{x:i,y:o,z:s=1}=this.getCamera();return{x:(t.x+i)*s+r.x,y:(t.y+o)*s+r.y,z:t.z??.5}}startFollowingUser(t){const r=this.store.query.records("instance_presence",()=>({userId:{eq:t}})),i=this.user.getId();if(i||console.warn("You should set the userId for the current instance before following a user"),r.get().some(l=>l.followingUserId===i))return this;Ur(()=>{this.stopFollowingUser(),this.updateInstanceState({followingUserId:t},{ephemeral:!0})});const o=()=>{this.removeListener("frame",a),this.removeListener("stop-following",o)};let s=!1;const a=()=>{const l=[...r.get()].sort((H,O)=>H.lastActivityTimestamp-O.lastActivityTimestamp).pop();if(!l){this.stopFollowingUser();return}const c=l.currentPageId===this.getCurrentPageId(),d=c?xz:1;if(!c){this.stopFollowingUser(),this.setCurrentPage(l.currentPageId),this.startFollowingUser(t);return}const{center:u,width:h,height:p}=this.getViewportPageBounds(),m=de.From(l.screenBounds),f=m.width/l.camera.z,w=m.height/l.camera.z,S=new k(f/2-l.camera.x,w/2-l.camera.y),b=l.followingUserId===i,_=h+(f-h)*d,x=p+(w-p)*d,P=b?p/x:Math.min(h/_,p/x),C=wi(this.getCamera().z*P,cd,Wo),E=this.getViewportScreenBounds().w/C,I=this.getViewportScreenBounds().h/C,A=S.sub(u),T=k.Add(u,k.Mul(A,d)),D=k.Sub(T,u).len(),F=Math.abs(C-this.getCamera().z);if(D<_z&&F<Cz){s=!0;return}s&&D<kz&&F<Pz||(s=!1,this.stopCameraAnimation(),this._setCamera({x:-(T.x-E/2),y:-(T.y-I/2),z:C}))};return this.once("stop-following",o),this.addListener("frame",a),this}stopFollowingUser(){return this.updateInstanceState({followingUserId:null},{ephemeral:!0}),this.emit("stop-following"),this}getCameraState(){return this._cameraState.get()}getUnorderedRenderingShapes(t){const r=[];let i=Qi*2,o=Qi;const s=this.getEditingShapeId(),a=this.getSelectedShapeIds(),l=this.getErasingShapeIds(),c=this.getRenderingBoundsExpanded(),d=Number.isFinite(this.renderingBoundsMargin),u=(h,p,m)=>{const f=this.getShape(h);if(!f)return;p*=f.opacity;let w=!1,S=!1;const b=this.getShapeUtil(f),_=this.getShapeMaskedPageBounds(h);t&&(S=!m&&l.includes(h),S&&(p*=.32),w=d&&b.canUnmount(f)&&s!==h&&(_===void 0||!c.includes(_)&&!a.includes(h))),r.push({id:h,shape:f,util:b,index:i,backgroundIndex:o,opacity:p,isCulled:w,maskedPageBounds:_}),i+=1,o+=1;const x=this.getSortedChildIdsForParent(h);if(!x.length)return;let P=null;b.providesBackgroundForChildren(f)&&(P=o,o=i,i+=Qi);for(const C of x)u(C,p,m||S);P!==null&&(o=P)};for(const h of this.getSortedChildIdsForParent(this.getCurrentPageId()))u(h,1,!1);return r}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(pD)}getRenderingBounds(){return this._renderingBounds.get()}getRenderingBoundsExpanded(){return this._renderingBoundsExpanded.get()}updateRenderingBounds(){const t=this.getViewportPageBounds();return t.equals(this._renderingBounds.__unsafe__getWithoutCapture())?this:(this._renderingBounds.set(t.clone()),Number.isFinite(this.renderingBoundsMargin)?this._renderingBoundsExpanded.set(t.clone().expandBy(this.renderingBoundsMargin/this.getZoomLevel())):this._renderingBoundsExpanded.set(t),this)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(gn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(t){return this.store.get(typeof t=="string"?t:t.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getPageShapeIds(t){const r=typeof t=="string"?t:t.id,i=this.store.query.exec("shape",{parentId:{eq:r}});return this.getShapeAndDescendantIds(i.map(o=>o.id))}setCurrentPage(t,r){const i=typeof t=="string"?t:t.id;return this._setCurrentPageId(i,r),this}updatePage(t,r){return this._updatePage(t,r),this}createPage(t){return this._createPage(t),this}deletePage(t){const r=typeof t=="string"?t:t.id;return this._deletePage(r),this}duplicatePage(t,r=Ji.createId()){if(this.getPages().length>=kp)return this;const i=typeof t=="string"?t:t.id,o=this.getPage(i);if(!o)return this;const s={...this.getCamera()},a=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(o.id));return this.batch(()=>{var d;const l=this.getPages(),c=wd(o.index,(d=l[l.indexOf(o)+1])==null?void 0:d.index);if(this.createPage({name:o.name+" Copy",id:r,index:c}),this.setCurrentPage(r),this.setCamera(s),a)return this.putContentOntoCurrentPage(a)}),this}renamePage(t,r,i){const o=typeof t=="string"?t:t.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:o,name:r},i),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(t){return this._createAssets(t),this}updateAssets(t){return this._updateAssets(t),this}deleteAssets(t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this._deleteAssets(r),this}getAsset(t){return this.store.get(typeof t=="string"?t:t.id)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",t=>this.getShapeUtil(t).getGeometry(t),(t,r)=>t.props===r.props)}getShapeGeometry(t){return this._getShapeGeometryCache().get(typeof t=="string"?t:t.id)}_getShapeOutlineSegmentsCache(){return this.store.createComputedCache("outline-segments",t=>this.getShapeUtil(t).getOutlineSegments(t))}getShapeOutlineSegments(t){return this._getShapeOutlineSegmentsCache().get(typeof t=="string"?t:t.id)??Gi}_getShapeHandlesCache(){return this.store.createComputedCache("handles",t=>{var r,i;return(i=(r=this.getShapeUtil(t)).getHandles)==null?void 0:i.call(r,t)})}getShapeHandles(t){return this._getShapeHandlesCache().get(typeof t=="string"?t:t.id)}getShapeLocalTransform(t){const r=typeof t=="string"?t:t.id,i=this.getShape(r);if(!i)throw Error("Editor.getTransform: shape not found");return oe.Identity().translate(i.x,i.y).rotate(i.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",t=>{if(Un(t.parentId))return this.getShapeLocalTransform(t);const r=this._getShapePageTransformCache().get(t.parentId)??oe.Identity();return oe.Compose(r,this.getShapeLocalTransform(t))})}getShapeParentTransform(t){const r=typeof t=="string"?t:t.id,i=this.getShape(r);return!i||Un(i.parentId)?oe.Identity():this._getShapePageTransformCache().get(i.parentId)??oe.Identity()}getShapePageTransform(t){const r=typeof t=="string"?t:this.getShape(t).id;return this._getShapePageTransformCache().get(r)??oe.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",t=>{const r=this._getShapePageTransformCache().get(t.id);return r?de.FromPoints(oe.applyToPoints(r,this.getShapeGeometry(t).vertices)):new de})}getShapePageBounds(t){return this._getShapePageBoundsCache().get(typeof t=="string"?t:t.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",t=>{const r=this._getShapeMaskCache().get(t.id);if(!r)return;if(r.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const i=this._getShapePageTransformCache().get(t.id);return i?`polygon(${oe.applyToPoints(oe.Inverse(i),r).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(t){return this._getShapeClipPathCache().get(typeof t=="string"?t:t.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",t=>{if(Un(t.parentId))return;const r=this.getShapeAncestors(t.id).filter(i=>this.isShapeOfType(i,"frame"));return r.length===0?void 0:r.map(i=>this._getShapePageTransformCache().get(i.id).applyToPoints(this.getShapeGeometry(i).vertices)).reduce((i,o)=>{if(!(o&&i))return;const s=_w(i,o);return s?s.map(k.Cast):[]})})}getShapeMask(t){return this._getShapeMaskCache().get(typeof t=="string"?t:t.id)}getShapeMaskedPageBounds(t){typeof t!="string"&&(t=t.id);const r=this._getShapePageBoundsCache().get(t);if(!r)return;const i=this._getShapeMaskCache().get(t);if(i){if(i.length===0)return;const{corners:o}=r;if(o.every((a,l)=>a&&k.Equals(a,i[l])))return r.clone();const s=_w(i,o);return s?de.FromPoints(s):void 0}return r}getShapeAncestors(t,r=[]){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return r;const s=o.parentId;if(Un(s))return r.reverse(),r;const a=this.store.get(s);return a?(r.push(a),this.getShapeAncestors(a,r)):r}findShapeAncestor(t,r){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return;const s=o.parentId;if(Un(s))return;const a=this.getShape(s);if(a)return r(a)?a:this.findShapeAncestor(a,r)}hasAncestor(t,r){const i=typeof t=="string"?t:t==null?void 0:t.id,o=i&&this.getShape(i);return o?o.parentId===r?!0:this.hasAncestor(this.getShapeParent(o),r):!1}findCommonAncestor(t,r){var c;if(t.length===0)return;const i=typeof t[0]=="string"?t:t.map(d=>d.id),o=me(i.map(d=>this.getShape(d)));if(o.length===1){const d=o[0].parentId;return Un(d)?void 0:r?(c=this.findShapeAncestor(o[0],r))==null?void 0:c.id:d}const[s,...a]=o;let l=this.getShapeParent(s);for(;l;){if(r&&!r(l)){l=this.getShapeParent(l);continue}if(a.every(d=>this.hasAncestor(d,l.id)))return l.id;l=this.getShapeParent(l)}}isShapeOrAncestorLocked(t){const r=typeof t=="string"?this.getShape(t):t;return r===void 0?!1:r.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(r))}getCurrentPageBounds(){let t;return this.getCurrentPageShapeIds().forEach(r=>{const i=this.getShapeMaskedPageBounds(r);i&&(t?t=t.expand(i):t=i.clone())}),t}getSelectedShapeAtPoint(t){const r=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(i=>i.type!=="group"&&r.includes(i.id)).reverse().find(i=>this.isPointInShape(i,t,{hitInside:!0,margin:0}))}getShapeAtPoint(t,r={}){const i=this.getZoomLevel(),o=this.getViewportPageBounds(),{filter:s,margin:a=0,hitLabels:l=!1,hitInside:c=!1,hitFrameInside:d=!1}=r;let u=1/0,h=null,p=1/0,m=null;const f=(r.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(w=>{if(this.isShapeOfType(w,"group"))return!1;const S=this.getShapeMask(w);return S&&!bi(t,S)?!1:s?s(w):!0});for(let w=f.length-1;w>=0;w--){const S=f[w],b=this.getShapeGeometry(S),_=b instanceof Ko,x=this.getPointInShapeSpace(S,t);if((this.isShapeOfType(S,"arrow")||this.isShapeOfType(S,"geo")&&S.props.fill==="none")&&S.props.text.trim()){for(const C of b.children)if(C.isLabel&&C.isPointInBounds(x))return S}if(this.isShapeOfType(S,"frame")){const C=b.distanceToPoint(x,c);if(Math.abs(C)<=a)return m||S;if(b.hitTestPoint(x,0,!0))return m||h||(d?S:void 0);continue}let P;if(_){let C=1/0;for(const E of b.children){if(E.isLabel&&!l)continue;const I=E.distanceToPoint(x,c);I<C&&(C=I)}P=C}else a===0&&(b.bounds.w<1||b.bounds.h<1)||b.bounds.containsPoint(x,a)?P=b.distanceToPoint(x,c):P=1/0;if(b.isClosed){if(P<=a){if(b.isFilled||_&&b.children[0].isFilled)return m||S;if(this.getShapePageBounds(S).contains(o))continue;if(Math.abs(P)<a)Math.abs(P)<p&&(p=Math.abs(P),m=S);else if(!m){const{area:C}=b;C<u&&(u=C,h=S)}}}else if(P<Gr/i)return S}return m||h||void 0}getShapesAtPoint(t,r={}){return this.getCurrentPageShapes().filter(i=>this.isPointInShape(i,t,r))}isPointInShape(t,r,i={}){const{hitInside:o=!1,margin:s=0}=i,a=typeof t=="string"?t:t.id,l=this.getShapeMask(a);return l&&!bi(r,l)?!1:this.getShapeGeometry(a).hitTestPoint(this.getPointInShapeSpace(t,r),s,o)}getPointInShapeSpace(t,r){const i=typeof t=="string"?t:t.id;return this._getShapePageTransformCache().get(i).clone().invert().applyToPoint(r)}getPointInParentSpace(t,r){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return new k(0,0);if(Un(o.parentId))return k.From(r);const s=this.getShapePageTransform(o.parentId);return s?s.clone().invert().applyToPoint(r):k.From(r)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),t=>this.store.get(t))}getCurrentPageShapesSorted(){const t=new Set(this.getCurrentPageShapes().sort(gn)),r=[];function i(o){r.push(o),t.delete(o),t.forEach(s=>{s.parentId===o.id&&i(s)})}return t.forEach(o=>{const s=this.getShape(o.parentId);Fs(s)||i(o)}),r}getCurrentPageRenderingShapesSorted(){return this.getRenderingShapes().filter(({isCulled:t})=>!t).sort((t,r)=>t.index-r.index).map(({shape:t})=>t)}isShapeOfType(t,r){return(typeof t=="string"?this.getShape(t):t).type===r}getShape(t){const r=typeof t=="string"?t:t.id;if(kr(r))return this.store.get(r)}getShapeParent(t){const r=typeof t=="string"?t:t==null?void 0:t.id;if(!r)return;const i=this.getShape(r);if(!(i===void 0||!kr(i.parentId)))return this.store.get(i.parentId)}getShapeNearestSibling(t,r){return r?r.parentId===t.parentId?r:this.findShapeAncestor(r,i=>i.parentId===t.parentId):void 0}isShapeInPage(t,r=this.getCurrentPageId()){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return!1;let s=!1;if(o.parentId===r)s=!0;else{let a=this.getShape(o.parentId);e:for(;a;){if(a.parentId===r){s=!0;break e}a=this.getShape(a.parentId)}}return s}getAncestorPageId(t){const r=typeof t=="string"?t:t==null?void 0:t.id,i=r&&this.getShape(r);if(i)return Un(i.parentId)?i.parentId:this.getAncestorPageId(this.getShape(i.parentId))}reparentShapes(t,r,i){const o=typeof t[0]=="string"?t:t.map(m=>m.id);if(o.length===0)return this;const s=[],a=Un(r)?oe.Identity():this.getShapePageTransform(r),l=a.rotation();let c=[];const d=me(this.getSortedChildIdsForParent(r).map(m=>this.getShape(m)));if(i){const m=d.find(f=>f.index===i);if(m){const f=d[d.indexOf(m)+1];f?c=ul(i,f.index,o.length):c=Ew(i,o.length)}else{const f=d.sort(gn).find(w=>w.index>i);f?c=ul(i,f.index,o.length):c=Ew(i,o.length)}}else{const m=d.length&&d[d.length-1];c=m?Ew(m.index,o.length):LP(o.length)}const u=a.clone().invert(),h=me(o.map(m=>this.getShape(m))),p=h.filter(m=>m.isLocked);p.length&&this.updateShapes(p.map(({id:m,type:f})=>({id:m,type:f,isLocked:!1})));for(let m=0;m<h.length;m++){const f=h[m],w=this.getShapePageTransform(f);if(!w)continue;const S=w.point();if(!S)continue;const b=u.applyToPoint(S),_=w.rotation()-l;s.push({id:f.id,type:f.type,parentId:r,x:b.x,y:b.y,rotation:_,index:c[m],isLocked:f.isLocked})}return this.updateShapes(s),this}getHighestIndexForParent(t){const r=typeof t=="string"?t:t.id,i=this._parentIdsToChildIds.get()[r];if(!i||i.length===0)return"a1";const o=this.getShape(i[i.length-1]);return to(o.index)}getSortedChildIdsForParent(t){const r=typeof t=="string"?t:t.id,i=this._parentIdsToChildIds.get()[r];return i?this._childIdsCache.get(i,()=>i):Gi}visitDescendants(t,r){const i=typeof t=="string"?t:t.id,o=this.getSortedChildIdsForParent(i);for(const s of o)r(s)!==!1&&this.visitDescendants(s,r);return this}getShapeAndDescendantIds(t){const r=new Set,i=[...t];for(;i.length>0;){const o=i.pop();if(!o)break;if(!r.has(o)){r.add(o);for(const s of this.getSortedChildIdsForParent(o))i.push(s)}}return r}getDroppingOverShape(t,r=[]){const i=this.getCurrentPageShapesSorted();for(let o=i.length-1;o>=0;o--){const s=i[o];if(!this.getShapeUtil(s).canDropShapes(s,r)||r.find(l=>l.id===s.id||this.hasAncestor(s,l.id)))continue;const a=this.getShapeMaskedPageBounds(s.id);if(a&&a.containsPoint(t)&&this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(s,t),0,!0))return s}}getOutermostSelectableShape(t,r){const i=typeof t=="string"?t:t.id,o=this.getShape(i);let s=o,a=o;const l=this.getFocusedGroup();for(;a;){if(this.isShapeOfType(a,"group")&&(l==null?void 0:l.id)!==a.id&&!this.hasAncestor(l,a.id)&&((r==null?void 0:r(a))??!0))s=a;else if((l==null?void 0:l.id)===a.id)break;a=this.getShapeParent(a)}return s}rotateShapesBy(t,r){if((typeof t[0]=="string"?t:t.map(o=>o.id)).length<=0)return this;const i=zP({editor:this});return i?(Fp({delta:r,snapshot:i,editor:this,stage:"one-off"}),this):this}nudgeShapes(t,r,i){var a,l;const o=typeof t[0]=="string"?t:t.map(c=>c.id);if(o.length<=0)return this;const s=[];for(const c of o){const d=this.getShape(c);if(!d)throw Error(`Could not find a shape with the id ${c}.`);const u=k.Cast(r),h=this.getShapeParentTransform(d);h&&u.rot(-h.rotation());const p=(l=(a=this.getShapeUtil(d)).onTranslateStart)==null?void 0:l.call(a,d);s.push(p?{...p,x:d.x+u.x,y:d.y+u.y}:{id:c,x:d.x+u.x,y:d.y+u.y,type:d.type})}return this.updateShapes(s,{squashing:!0,...i}),this}duplicateShapes(t,r){const i=typeof t[0]=="string"?t:t.map(d=>d.id);if(i.length<=0)return this;const o=new Set(i),s=[],a=[...i];for(;a.length>0;){const d=a.pop();if(!d)break;s.push(d),this.getSortedChildIdsForParent(d).forEach(u=>a.push(u))}s.reverse();const l=new Map(s.map(d=>[d,tt()])),c=me(s.map(d=>{const u=this.getShape(d);if(!u)return null;const h=l.get(d);let p=0,m=0;if(r&&o.has(d)){const C=this.getShapeParentTransform(u),E=new k(r.x,r.y).rot(-C.rotation());p=E.x,m=E.y}const f=u.parentId??this.getCurrentPageId(),w=this.getSortedChildIdsForParent(f),S=w.indexOf(u.id),b=w[S+1],_=b?this.getShape(b):null,x=_?wd(u.index,_.index):to(u.index);let P=ln(u);if(this.isShapeOfType(u,"arrow")&&this.isShapeOfType(P,"arrow")){const C=this.getArrowInfo(u);let E,I;if(u.props.start.type==="binding"&&(E=l.get(u.props.start.boundShapeId),!E))if(C!=null&&C.isValid){const{x:T,y:D}=C.start.point;P.props.start={type:"point",x:T,y:D}}else{const{start:T}=Xr(this,u);P.props.start={type:"point",x:T.x,y:T.y}}if(u.props.end.type==="binding"&&(I=l.get(u.props.end.boundShapeId),!I))if(C!=null&&C.isValid){const{x:T,y:D}=C.end.point;P.props.end={type:"point",x:T,y:D}}else{const{end:T}=Xr(this,u);P.props.start={type:"point",x:T.x,y:T.y}}const A=bd(P)?vd(this,P):Tw(this,P);if(C!=null&&C.isValid&&(A!=null&&A.isValid)&&!bd(u)){const T=k.Med(C.start.handle,C.end.handle),D=k.Dist(C.middle,T),F=k.Dist(A.middle,T);P.props.bend<0?P.props.bend+=F-D:P.props.bend-=F-D}P.props.start.type==="binding"&&E&&(P.props.start.boundShapeId=E),P.props.end.type==="binding"&&I&&(P.props.end.boundShapeId=I)}return P={...P,id:h,x:u.x+p,y:u.y+m,index:x},P}));return c.forEach(d=>{kr(d.parentId)&&l.has(d.parentId)&&(d.parentId=l.get(d.parentId))}),this.history.batch(()=>{const d=c.length+this.getCurrentPageShapeIds().size>Qi;d&&Vp(this);const u=d?c.slice(0,Qi-this.getCurrentPageShapeIds().size):c,h=u.map(p=>p.id);if(this.createShapes(u),this.setSelectedShapes(h),r!==void 0){const p=this.getSelectionPageBounds(),m=this.getViewportPageBounds();p&&!m.contains(p)&&this.centerOnPoint(p.center,{duration:eo})}}),this}moveShapesToPage(t,r){const i=typeof t[0]=="string"?t:t.map(l=>l.id);if(i.length===0)return this;if(this.getInstanceState().isReadonly)return this;const o=this.getCurrentPageId();if(r===o)return this;if(!this.store.has(r))return this;const s=this.getContentFromCurrentPage(i);if(!s)return this;if(this.getPageShapeIds(r).size+s.shapes.length>Qi)return Vp(this,r),this;const a=this.getCamera().z;return this.history.batch(()=>{this.deleteShapes(i),this.setCurrentPage(r),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(s,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:a}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(t){const r=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly||r.length===0)return this;let i=!0,o=!0;const s=[];for(const a of r){const l=this.getShape(a);l&&(s.push(l),l.isLocked?o=!1:i=!1)}return this.batch(()=>{o?(this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):i?this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=Np(this,"toBack",r);return i&&this.updateShapes(i),this}sendBackward(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=Np(this,"backward",r);return i&&this.updateShapes(i),this}bringForward(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=Np(this,"forward",r);return i&&this.updateShapes(i),this}bringToFront(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=Np(this,"toFront",r);return i&&this.updateShapes(i),this}flipShapes(t,r){const i=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;let o=me(i.map(a=>this.getShape(a)));if(!o.length)return this;o=me(o.map(a=>this.isShapeOfType(a,"group")?this.getSortedChildIdsForParent(a.id).map(l=>this.getShape(l)):a).flat());const s=de.Common(me(o.map(a=>this.getShapePageBounds(a)))).center;return this.batch(()=>{for(const a of o){const l=this.getShapeGeometry(a).bounds,c=this.getShapePageTransform(a.id);c&&this.resizeShape(a.id,{x:r==="horizontal"?-1:1,y:r==="vertical"?-1:1},{initialBounds:l,initialPageTransform:c,initialShape:a,mode:"scale_shape",scaleOrigin:s,scaleAxisRotation:0})}}),this}stackShapes(t,r,i){const o=typeof t[0]=="string"?t:t.map(w=>w.id);if(this.getInstanceState().isReadonly)return this;const s=me(o.map(w=>this.getShape(w)).filter(w=>!(!w||this.isShapeOfType(w,"arrow")&&(w.props.start.type==="binding"||w.props.end.type==="binding")))),a=s.length;if(i===0&&a<3||a<2)return this;const l=Object.fromEntries(s.map(w=>[w.id,this.getShapePageBounds(w)]));let c,d,u,h;r==="horizontal"?(c="x",d="minX",u="maxX",h="width"):(c="y",d="minY",u="maxY",h="height");let p;if(i===0){const w=[];s.sort((b,_)=>l[b.id][d]-l[_.id][d]);for(let b=0;b<a-1;b++){const _=s[b],x=s[b+1],P=l[_.id],C=l[x.id][d]-P[u],E=w.find(I=>I.gap===C);E?E.count++:w.push({gap:C,count:1})}let S=0;w.forEach(b=>{b.count>S&&(S=b.count,p=b.gap)}),S===1&&(p=Math.max(0,w.reduce((b,_)=>b+_.gap*_.count,0)/(a-1)))}else p=i;const m=[];let f=l[s[0].id][u];return s.forEach((w,S)=>{var C,E;if(S===0)return;const b={x:0,y:0};b[c]=f+p-l[w.id][c];const _=this.getShapeParent(w),x=_?k.Rot(b,-this.getShapePageTransform(_).decompose().rotation):b,P=(E=(C=this.getShapeUtil(w)).onTranslateStart)==null?void 0:E.call(C,w);m.push(P?{...P,[c]:w[c]+x[c]}:{id:w.id,type:w.type,[c]:w[c]+x[c]}),f+=l[w.id][h]+p}),this.updateShapes(m),this}packShapes(t,r){var E,I;const i=typeof t[0]=="string"?t:t.map(A=>A.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=me(i.map(A=>this.getShape(A)).filter(A=>!(!A||this.isShapeOfType(A,"arrow")&&(A.props.start.type==="binding"||A.props.end.type==="binding")))),s={},a={};let l,c,d=0;for(let A=0;A<o.length;A++)l=o[A],c=this.getShapePageBounds(l),s[l.id]=c,a[l.id]=c.clone(),d+=c.width*c.height;const u=de.Common(me(Object.values(s))),h=u.width;o.sort((A,T)=>s[T.id].height-s[A.id].height);const p=Math.max(Math.ceil(Math.sqrt(d/.95)),h),m=[new de(u.x,u.y,p,1/0)];let f=0,w=0,S,b;for(let A=0;A<o.length;A++){l=o[A],c=a[l.id];for(let T=m.length-1;T>=0;T--)if(S=m[T],!(c.width>S.width||c.height>S.height)){c.x=S.x,c.y=S.y,w=Math.max(w,c.maxY),f=Math.max(f,c.maxX),c.width===S.width&&c.height===S.height?(b=m.pop(),T<m.length&&(m[T]=b)):c.height===S.height?(S.x+=c.width+r,S.width-=c.width+r):c.width===S.width?(S.y+=c.height+r,S.height-=c.height+r):(m.push(new de(S.x+(c.width+r),S.y,S.width-(c.width+r),c.height)),S.y+=c.height+r,S.height-=c.height+r);break}}const _=de.Common(Object.values(a)),x=k.Sub(u.center,_.center);let P;const C=[];for(let A=0;A<o.length;A++){l=o[A],c=s[l.id],P=a[l.id];const T=k.Sub(P.point,c.point).add(x),D=this.getShapeParentTransform(l);D&&T.rot(-D.rotation());const F={id:l.id,type:l.type,x:l.x+T.x,y:l.y+T.y},H=(I=(E=this.getShapeUtil(l)).onTranslateStart)==null?void 0:I.call(E,{...l,...F});H?C.push({...F,...H}):C.push(F)}return C.length&&this.updateShapes(C),this}alignShapes(t,r){const i=typeof t[0]=="string"?t:t.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=me(i.map(c=>this.getShape(c))),s=Object.fromEntries(o.map(c=>[c.id,this.getShapePageBounds(c)])),a=de.Common(me(Object.values(s))),l=[];return o.forEach(c=>{var f,w;const d=s[c.id];if(!d)return;const u={x:0,y:0};switch(r){case"top":{u.y=a.minY-d.minY;break}case"center-vertical":{u.y=a.midY-d.minY-d.height/2;break}case"bottom":{u.y=a.maxY-d.minY-d.height;break}case"left":{u.x=a.minX-d.minX;break}case"center-horizontal":{u.x=a.midX-d.minX-d.width/2;break}case"right":{u.x=a.maxX-d.minX-d.width;break}}const h=this.getShapeParent(c),p=h?k.Rot(u,-this.getShapePageTransform(h).decompose().rotation):u,m=(w=(f=this.getShapeUtil(c)).onTranslateStart)==null?void 0:w.call(f,c);l.push(m?{...m,x:c.x+p.x,y:c.y+p.y}:{id:c.id,type:c.type,x:c.x+p.x,y:c.y+p.y})}),this.updateShapes(l),this}distributeShapes(t,r){const i=typeof t[0]=="string"?t:t.map(_=>_.id);if(this.getInstanceState().isReadonly)return this;if(i.length<3)return this;const o=i.length,s=me(i.map(_=>this.getShape(_))),a=Object.fromEntries(s.map(_=>[_.id,this.getShapePageBounds(_)]));let l,c,d,u,h;r==="horizontal"?(l="x",c="minX",d="maxX",u="midX",h="width"):(l="y",c="minY",d="maxY",u="midY",h="height");const p=[],m=s.sort((_,x)=>a[_.id][c]-a[x.id][c])[0],f=s.sort((_,x)=>a[x.id][d]-a[_.id][d])[0],w=a[m.id][u],S=(a[f.id][u]-w)/(o-1),b=w+S;return s.filter(_=>_!==m&&_!==f).sort((_,x)=>a[_.id][u]-a[x.id][u]).forEach((_,x)=>{var A,T;const P={x:0,y:0};P[l]=b+S*x-a[_.id][h]/2-a[_.id][l];const C=this.getShapeParent(_),E=C?k.Rot(P,-this.getShapePageTransform(C).rotation()):P,I=(T=(A=this.getShapeUtil(_)).onTranslateStart)==null?void 0:T.call(A,_);p.push(I?{...I,[l]:_[l]+E[l]}:{id:_.id,type:_.type,[l]:_[l]+E[l]})}),this.updateShapes(p),this}stretchShapes(t,r){const i=typeof t[0]=="string"?t:t.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=me(i.map(c=>this.getShape(c))),s=Object.fromEntries(i.map(c=>[c,this.getShapeGeometry(c).bounds])),a=Object.fromEntries(i.map(c=>[c,this.getShapePageBounds(c)])),l=de.Common(me(Object.values(a)));switch(r){case"vertical":{this.batch(()=>{for(const c of o){if(this.getShapePageTransform(c).rotation()%We)continue;const d=s[c.id],u=a[c.id],h=new k(0,l.minY-u.minY),p=this.getShapeParentTransform(c);p&&h.rot(-p.rotation());const{x:m,y:f}=k.Add(h,c);this.updateShapes([{id:c.id,type:c.type,x:m,y:f}],{squashing:!0});const w=new k(1,l.height/u.height);this.resizeShape(c.id,w,{initialBounds:d,scaleOrigin:new k(u.center.x,l.minY),scaleAxisRotation:0})}});break}case"horizontal":{this.batch(()=>{for(const c of o){const d=s[c.id],u=a[c.id];if(this.getShapePageTransform(c).rotation()%We)continue;const h=new k(l.minX-u.minX,0),p=this.getShapeParentTransform(c);p&&h.rot(-p.rotation());const{x:m,y:f}=k.Add(h,c);this.updateShapes([{id:c.id,type:c.type,x:m,y:f}],{squashing:!0});const w=new k(l.width/u.width,1);this.resizeShape(c.id,w,{initialBounds:d,scaleOrigin:new k(l.minX,u.center.y),scaleAxisRotation:0})}});break}}return this}resizeShape(t,r,i={}){var p;const o=typeof t=="string"?t:t.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(r.x)||(r=new k(1,r.y)),Number.isFinite(r.y)||(r=new k(r.x,1));const s=i.initialShape??this.getShape(o);if(!s)return this;const a=i.scaleOrigin??((p=this.getShapePageBounds(o))==null?void 0:p.center);if(!a)return this;const l=i.initialPageTransform?oe.Cast(i.initialPageTransform):this.getShapePageTransform(o);if(!l)return this;const c=l.rotation();if(c==null)return this;const d=i.scaleAxisRotation??c,u=i.initialBounds??this.getShapeGeometry(o).bounds;if(!u)return this;if(!b2(c,d))return this._resizeUnalignedShape(o,r,{...i,initialBounds:u,scaleOrigin:a,scaleAxisRotation:d,initialPageTransform:l,initialShape:s});const h=this.getShapeUtil(s);if(h.isAspectRatioLocked(s)&&(Math.abs(r.x)>Math.abs(r.y)?r=new k(r.x,Math.sign(r.y)*Math.abs(r.x)):r=new k(Math.sign(r.x)*Math.abs(r.y),r.y)),h.onResize&&h.canResize(s)){const m=this._scalePagePoint(oe.applyToPoint(l,new k(0,0)),a,r,d),f=this.getPointInParentSpace(s.id,m),w=new k(r.x,r.y),S=od((c-d)%Math.PI,0);w.x=S?r.x:r.y,w.y=S?r.y:r.x;const b=oe.applyToPoint(l,new k),{x:_,y:x}=this.getPointInParentSpace(s.id,b);this.updateShapes([{id:o,type:s.type,x:f.x,y:f.y,...h.onResize({...s,x:_,y:x},{newPoint:f,handle:i.dragHandle??"bottom_right",mode:i.mode??"scale_shape",scaleX:w.x,scaleY:w.y,initialBounds:u,initialShape:s})}],{squashing:!0})}else{const m=oe.applyToPoint(l,u.center),f=this._scalePagePoint(m,a,r,d),w=this.getPointInParentSpace(s.id,m),S=this.getPointInParentSpace(s.id,f),b=k.Sub(S,w);this.updateShapes([{id:o,type:s.type,x:s.x+b.x,y:s.y+b.y}],{squashing:!0})}return this}_scalePagePoint(t,r,i,o){const s=k.RotWith(t,r,-o).sub(r),a=k.MulV(s,i);return k.Add(a,r).rotWith(r,o)}_resizeUnalignedShape(t,r,i){const{type:o}=i.initialShape,s=new k(r.x,r.y);if(Math.abs(r.x)>Math.abs(r.y)?s.x=Math.sign(r.x)*Math.abs(r.y):s.y=Math.sign(r.y)*Math.abs(r.x),this.resizeShape(t,s,{initialShape:i.initialShape,initialBounds:i.initialBounds}),Math.sign(r.x)*Math.sign(r.y)<0){let{rotation:S}=oe.Decompose(i.initialPageTransform);S-=2*S,this.updateShapes([{id:t,type:o,rotation:S}],{squashing:!0})}const a=oe.applyToPoint(i.initialPageTransform,i.initialBounds.center),l=this._scalePagePoint(a,i.scaleOrigin,r,i.scaleAxisRotation),c=this.getShapePageBounds(t),d=this.getShapePageTransform(t),u=c.center,h=d.point();if(!u||!h)return this;const p=k.Sub(l,u),m=k.Add(h,p),{x:f,y:w}=this.getPointInParentSpace(t,m);return this.updateShapes([{id:t,type:o,x:f,y:w}],{squashing:!0}),this}getInitialMetaForShape(t){return{}}createShape(t){return this._createShapes([t]),this}createShapes(t){if(!Array.isArray(t))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");return this._createShapes(t),this}animateShape(t,r){return this.animateShapes([t],r)}animateShapes(t,r={}){const{duration:i=500,easing:o=pn.linear}=r,s=qe();let a=i,l;const c=[];t.forEach(h=>{if(!h)return;const p={partial:h,values:[]},m=this.getShape(h.id);if(m){for(const f of["x","y","rotation"])h[f]!==void 0&&m[f]!==h[f]&&p.values.push({prop:f,from:m[f],to:h[f]});c.push(p),this.animatingShapes.set(m.id,s)}});let d;const u=h=>{if(a-=h,a<0){const{animatingShapes:m}=this,f=t.filter(w=>w&&m.get(w.id)===s);f.length&&this.updateShapes(f,{squashing:!1}),this.removeListener("tick",u);return}l=o(1-a/i);const{animatingShapes:p}=this;try{const m=[];for(let f=0;f<c.length;f++)d=c[f],p.get(d.partial.id)===s&&m.push({id:d.partial.id,type:d.partial.type,...d.values.reduce((w,{prop:S,from:b,to:_})=>(w[S]=b+(_-b)*l,w),{})});this._updateShapes(m,{squashing:!0})}catch{}};return this.addListener("tick",u),this}groupShapes(t,r=tt()){var p;if(!Array.isArray(t))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const i=typeof t[0]=="string"?t:t.map(m=>m.id);if(i.length<=1)return this;const o=me(this._getUnlockedShapeIds(i).map(m=>this.getShape(m))),s=o.sort(gn).map(m=>m.id),a=de.Common(me(o.map(m=>this.getShapePageBounds(m)))),{x:l,y:c}=a.point,d=this.findCommonAncestor(o)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const u=o.filter(m=>m.parentId===d).sort(gn),h=(p=u[u.length-1])==null?void 0:p.index;return this.batch(()=>{this.createShapes([{id:r,type:"group",parentId:d,index:h,x:l,y:c,opacity:1,props:{}}]),this.reparentShapes(s,r),this.select(r)}),this}ungroupShapes(t){const r=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;if(r.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const i=new Set,o=me(r.map(a=>this.getShape(a))),s=[];return o.forEach(a=>{this.isShapeOfType(a,"group")?s.push(a):i.add(a.id)}),s.length===0?this:(this.batch(()=>{let a;for(let l=0,c=s.length;l<c;l++){a=s[l];const d=this.getSortedChildIdsForParent(a.id);for(let u=0,h=d.length;u<h;u++)i.add(d[u]);this.reparentShapes(d,a.parentId,a.index)}this.deleteShapes(s.map(l=>l.id)),this.select(...i)}),this)}updateShape(t,r){return this.updateShapes([t],r),this}updateShapes(t,r){let i=me(t);return this.animatingShapes.size>0&&i.forEach(o=>this.animatingShapes.delete(o.id)),i=i.filter(o=>{const s=this.getShape(o.id);return!(!s||this.isShapeOrAncestorLocked(s)&&!Object.hasOwn(o,"isLocked"))}),this._updateShapes(i,r),this}_getUnlockedShapeIds(t){return t.filter(r=>{var i;return!((i=this.getShape(r))!=null&&i.isLocked)})}deleteShapes(t){if(!Array.isArray(t))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");return this._deleteShapes(this._getUnlockedShapeIds(typeof t[0]=="string"?t:t.map(r=>r.id))),this}deleteShape(t){return this.deleteShapes([typeof t=="string"?t:t.id]),this}_extractSharedStyles(t,r){if(this.isShapeOfType(t,"group")){const i=this._parentIdsToChildIds.get()[t.id];if(!i)return;for(let o=0,s=i.length;o<s;o++)this._extractSharedStyles(this.getShape(i[o]),r)}else for(const[i,o]of this.styleProps[t.type])r.applyValue(i,zs(t.props,o))}getStyleForNextShape(t){const r=this.getInstanceState().stylesForNextShape[t.id];return r===void 0?t.defaultValue:r}getShapeStyleIfExists(t,r){const i=this.styleProps[t.type].get(r);if(i!==void 0)return zs(t.props,i)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._selectionSharedStyles.get();const t=this.root.getCurrent(),r=new Cw;if(!t)return r;if(t.shapeType)for(const i of this.styleProps[t.shapeType].keys())r.applyValue(i,this.getStyleForNextShape(i));return r}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const t=[],r=o=>{const s=this.getShape(o);if(s)if(this.isShapeOfType(s,"group"))for(const a of this.getSortedChildIdsForParent(s.id))r(a);else t.push(s)};for(const o of this.getSelectedShapeIds())r(o);let i=null;for(const o of t)if(i===null)i=o.opacity;else if(i!==o.opacity)return{type:"mixed"};if(i!==null)return{type:"shared",value:i}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(t,r){return this.updateInstanceState({opacityForNextShape:t},r),this}setOpacityForSelectedShapes(t,r){const i=this.getSelectedShapes();if(i.length>0){const o=[],s=a=>{if(this.isShapeOfType(a,"group")){const l=this.getSortedChildIdsForParent(a);for(const c of l)s(this.getShape(c))}else o.push(a)};for(const a of i)s(a);this.updateShapes(o.map(a=>({id:a.id,type:a.type,opacity:t})),r)}return this}setStyleForNextShapes(t,r,i){const o=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...o,[t.id]:r}},i),this}setStyleForSelectedShapes(t,r,i){const o=this.getSelectedShapes();if(o.length>0){const s=[],a=l=>{if(this.isShapeOfType(l,"group")){const c=this.getSortedChildIdsForParent(l.id);for(const d of c)a(this.getShape(d))}else{const c=this.getShapeUtil(l),d=this.styleProps[l.type].get(t);if(d){const u={id:l.id,type:l.type,props:{[d]:r}};s.push({util:c,originalShape:l,updatePartial:u})}}};for(const l of o)a(l);this.updateShapes(s.map(({updatePartial:l})=>l),i)}return this}registerExternalAssetHandler(t,r){return this.externalAssetContentHandlers[t]=r,this}async getAssetForExternalContent(t){var r,i;return await((i=(r=this.externalAssetContentHandlers)[t.type])==null?void 0:i.call(r,t))}registerExternalContentHandler(t,r){return this.externalContentHandlers[t]=r,this}async putExternalContent(t){var r,i;return(i=(r=this.externalContentHandlers)[t.type])==null?void 0:i.call(r,t)}getContentFromCurrentPage(t){const r=typeof t[0]=="string"?t:t.map(l=>l.id);if(!r||r.length===0)return;const i={};let o=Jh(r.map(l=>this.getShape(l)).sort(gn).flatMap(l=>{const c=[l];return this.visitDescendants(l.id,d=>{c.push(this.getShape(d))}),c}));o=o.map(l=>{if(i[l.id]=this.getShapePageTransform(l.id),l=Ho(l),this.isShapeOfType(l,"arrow")){const c=l.props.start.type==="binding"?l.props.start.boundShapeId:void 0,d=l.props.end.type==="binding"?l.props.end.boundShapeId:void 0,u=this.getArrowInfo(l);if(l.props.start.type==="binding"&&!o.some(p=>p.id===c))if(u!=null&&u.isValid){const{x:p,y:m}=u.start.point;l.props.start={type:"point",x:p,y:m}}else{const{start:p}=Xr(this,l);l.props.start={type:"point",x:p.x,y:p.y}}if(l.props.end.type==="binding"&&!o.some(p=>p.id===d))if(u!=null&&u.isValid){const{x:p,y:m}=u.end.point;l.props.end={type:"point",x:p,y:m}}else{const{end:p}=Xr(this,l);l.props.end={type:"point",x:p.x,y:p.y}}const h=bd(l)?vd(this,l):Tw(this,l);if(u!=null&&u.isValid&&(h!=null&&h.isValid)&&!bd(l)){const p=k.Med(u.start.handle,u.end.handle),m=k.Dist(u.middle,p),f=k.Dist(h.middle,p);l.props.bend<0?l.props.bend+=f-m:l.props.bend-=f-m}return l}return l});const s=[];o.forEach(l=>{if(o.find(c=>c.id===l.parentId)===void 0){const c=this.getShapePageTransform(l.id),d=c.point(),u=c.rotation();l.x=d.x,l.y=d.y,l.rotation=u,l.parentId=this.getCurrentPageId(),s.push(l.id)}});const a=new Set;return o.forEach(l=>{"assetId"in l.props&&l.props.assetId!==null&&a.add(l.props.assetId)}),{shapes:o,rootShapeIds:s,schema:this.store.schema.serialize(),assets:me(Array.from(a).map(l=>this.getAsset(l)))}}putContentOntoCurrentPage(t,r={}){if(this.getInstanceState().isReadonly)return this;if(!t.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:i=!1,preserveIds:o=!1,preservePosition:s=!1}=r;let{point:a=void 0}=r;const l=this.getCurrentPageId(),{assets:c,shapes:d,rootShapeIds:u}=t,h=new Map(d.map(P=>[P.id,tt()]));let p=this.getCurrentPageId(),m=1/0,f=[];for(const P of this.getSelectedShapes()){if(m===0)break;const C=this.isShapeOfType(P,"frame"),E=this.getShapeAncestors(P);C&&E.push(P);const I=C?E.length+1:E.length;if(I<m)m=I,f=E,p=C?P.id:P.parentId;else if(I===m){if(f.length!==E.length)throw Error(`Ancestors: ${f.length} !== ${E.length}`);if(f.length===0){p=l;break}else{p=l;for(let A=0;A<f.length&&E[A]===f[A];A++)p=E[A].id}}}let w=!1;if(!Un(p)){const P=this.getShape(p);if(P){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(P)))p=l;else if(u.length===1){const C=d.find(E=>E.id===u[0]);this.isShapeOfType(P,"frame")&&this.isShapeOfType(C,"frame")&&C.props.w===(P==null?void 0:P.props.w)&&C.props.h===(P==null?void 0:P.props.h)&&(w=!0)}}else p=l}w||(w=h.has(p)),w&&(p=this.getShape(p).parentId);let S=this.getHighestIndexForParent(p);const b=[],_=d.map(P=>{let C;if(o)C=ln(P),h.set(P.id,P.id);else{const E=h.get(P.id);C=ln({...P,id:E})}if(u.includes(P.id)&&(C.parentId=l,b.push(C)),h.has(C.parentId)?C.parentId=h.get(P.parentId):(u.push(C.id),C.index=S,S=to(S)),this.isShapeOfType(C,"arrow")){if(C.props.start.type==="binding"){const E=h.get(C.props.start.boundShapeId);C.props.start=E?{...C.props.start,boundShapeId:E}:{type:"point",x:0,y:0}}if(C.props.end.type==="binding"){const E=h.get(C.props.end.boundShapeId);C.props.end=E?{...C.props.end,boundShapeId:E}:{type:"point",x:0,y:0}}}return C});if(_.length+this.getCurrentPageShapeIds().size>Qi)return Vp(this),this;let x=[];if(c){for(let C=0;C<c.length;C++){const E=c[C],I=this.store.schema.migratePersistedRecord(E,t.schema);if(I.type==="success")c[C]=I.value;else throw Error(`Could not put content:
could not migrate content for asset:
${E.id}
${E.type}
reason:${I.reason}`)}const P=[];x=c.filter(C=>!this.store.has(C.id)).map(C=>{var E;return(C.type==="image"||C.type==="video")&&(C.props.src&&((E=C.props.src)!=null&&E.startsWith("data:image"))?(P.push(Ho(C)),C.props.src=null):P.push(Ho(C))),C}),Promise.allSettled(P.map(async C=>{const E=await wF(C.props.src,C.props.name,C.props.mimeType??"image/png"),I=await this.getAssetForExternalContent({type:"file",file:E});return I?[C,I]:null})).then(C=>{this.updateAssets(me(C.map(E=>E.status==="fulfilled"&&E.value?{...E.value[1],id:E.value[0].id}:void 0)))})}for(let P=0;P<_.length;P++){const C=_[P],E=this.store.schema.migratePersistedRecord(C,t.schema);if(E.type==="success")_[P]=E.value;else throw Error(`Could not put content:
could not migrate content for shape:
${C.id}, ${C.type}
reason:${E.reason}`)}return this.batch(()=>{x.length>0&&this.createAssets(x),this.createShapes(_),i&&this.select(...b.map(A=>A.id)),p!==l&&this.reparentShapes(b.map(A=>A.id),p);const P=_.map(A=>this.getShape(A.id)),C=de.Common(P.map(A=>this.getShapePageBounds(A)));if(a===void 0)if(Un(p)){const A=this.getViewportPageBounds();s||A.includes(de.From(C))?a=C.center:a=A.center}else{const A=this.getShape(p);a=oe.applyToPoint(this.getShapePageTransform(A),this.getShapeGeometry(A).bounds.center)}if(b.length===1){const A=b[0];if(this.isShapeOfType(A,"frame"))for(;this.getShapesAtPoint(a).some(T=>this.isShapeOfType(T,"frame")&&T.props.w===A.props.w&&T.props.h===A.props.h);)a.x+=C.w+16}const E=de.Common(me(b.map(({id:A})=>this.getShapePageBounds(A)))).center,I=k.Sub(a,E);this.updateShapes(b.map(({id:A})=>{const T=this.getShape(A),D=this.getShapeParentTransform(A).decompose().rotation,F=k.Rot(I,-D);return{id:T.id,type:T.type,x:T.x+F.x,y:T.y+F.y}}))}),this}async getSvg(t,r={}){var P,C;const i=typeof t[0]=="string"?t:t.map(E=>E.id);if(i.length===0)return;if(!window.document)throw Error("No document");const{scale:o=1,background:s=!1,padding:a=Mz,preserveAspectRatio:l=!1}=r,c=Vn({isDarkMode:this.user.getIsDarkMode()}),d=this.getShapeAndDescendantIds(i),u=this.getUnorderedRenderingShapes(!1).filter(({id:E})=>d.has(E));let h=null;if(r.bounds)h=r.bounds;else for(const{maskedPageBounds:E}of u)E&&(h?h.union(E):h=E.clone());if(!h)return;const p=i.length===1&&this.isShapeOfType(this.getShape(i[0]),"frame")?i[0]:null;p||h.expandBy(a);const m=h.width*o,f=h.height*o,w=window.document.createElementNS("http://www.w3.org/2000/svg","svg");l&&w.setAttribute("preserveAspectRatio",l),w.setAttribute("direction","ltr"),w.setAttribute("width",m+""),w.setAttribute("height",f+""),w.setAttribute("viewBox",`${h.minX} ${h.minY} ${h.width} ${h.height}`),w.setAttribute("stroke-linecap","round"),w.setAttribute("stroke-linejoin","round"),s?p?w.style.setProperty("background",c.solid):w.style.setProperty("background-color",c.background):w.style.setProperty("background-color","transparent");try{(C=(P=document.body).focus)==null||C.call(P)}catch{}const S=window.document.createElementNS("http://www.w3.org/2000/svg","defs");w.append(S);const b=new Map,_={addExportDef:E=>{if(b.has(E.key))return;const I=(async()=>{const A=await E.getElement();if(!A)return;const T=document.createComment(`def: ${E.key}`);S.appendChild(T);for(const D of Array.isArray(A)?A:[A])S.appendChild(D)})();b.set(E.key,I)}},x=(await Promise.all(u.map(async({id:E,opacity:I,index:A,backgroundIndex:T})=>{var W,N;if(E===p)return[];const D=this.getShape(E);if(this.isShapeOfType(D,"group"))return[];const F=this.getShapeUtil(D);let H=await((W=F.toSvg)==null?void 0:W.call(F,D,_)),O=await((N=F.toBackgroundSvg)==null?void 0:N.call(F,D,_));if(H){const Y=document.createElementNS("http://www.w3.org/2000/svg","g");Y.appendChild(H),H=Y}if(O){const Y=document.createElementNS("http://www.w3.org/2000/svg","g");Y.appendChild(O),O=Y}if(!H&&!O){const Y=this.getShapePageBounds(D),ee=window.document.createElementNS("http://www.w3.org/2000/svg","rect");ee.setAttribute("width",Y.width+""),ee.setAttribute("height",Y.height+""),ee.setAttribute("fill",c.solid),ee.setAttribute("stroke",c.grey.pattern),ee.setAttribute("stroke-width","1"),H=ee}let K=this.getShapePageTransform(D).toCssString();"scale"in D.props&&D.props.scale!==1&&(K=`${K} scale(${D.props.scale}, ${D.props.scale})`),H==null||H.setAttribute("transform",K),O==null||O.setAttribute("transform",K),H==null||H.setAttribute("opacity",I+""),O==null||O.setAttribute("opacity",I+"");const B=this.getShapeMask(D.id);if(B){const Y=document.createElementNS("http://www.w3.org/2000/svg","clipPath");S.appendChild(Y);const ee=qe();Y.id=ee;const pe=document.createElementNS("http://www.w3.org/2000/svg","path");if(pe.setAttribute("d",`M${B.map(({x:ve,y:be})=>`${ve},${be}`).join("L")}Z`),Y.appendChild(pe),H){const ve=document.createElementNS("http://www.w3.org/2000/svg","g");ve.setAttribute("clip-path",`url(#${ee})`),ve.appendChild(H),H=ve}if(O){const ve=document.createElementNS("http://www.w3.org/2000/svg","g");ve.setAttribute("clip-path",`url(#${ee})`),ve.appendChild(O),O=ve}}const te=[];return H&&te.push({zIndex:A,element:H}),O&&te.push({zIndex:T,element:O}),te}))).flat();await Promise.all(b.values());for(const{element:E}of x.sort((I,A)=>I.zIndex-A.zIndex))w.appendChild(E);return w}_updateInputsFromEvent(t){var m;const{previousScreenPoint:r,previousPagePoint:i,currentScreenPoint:o,currentPagePoint:s}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(In),{x:l,y:c,z:d}=t.point,{x:u,y:h,z:p}=this.getCamera();r.setTo(o),i.setTo(s),o.set(l,c),s.set((l-a.x)/p-u,(c-a.y)/p-h,d??.5),this.inputs.isPen=t.type==="pointer"&&t.isPen,t.name==="pointer_down"&&this.inputs.pointerVelocity.set(0,0),this.store.put([{id:lp,typeName:"pointer",x:s.x,y:s.y,lastActivityTimestamp:t.type==="pointer"&&t.pointerId===I2.CAMERA_MOVE?((m=this.store.get(lp))==null?void 0:m.lastActivityTimestamp)??Date.now():Date.now(),meta:{}}])}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}}he([Q],ue.prototype,"getCanUndo",1),he([Q],ue.prototype,"getCanRedo",1),he([Q],ue.prototype,"_getArrowBindingsIndex",1),he([Q],ue.prototype,"getArrowInfoCache",1),he([Q],ue.prototype,"getPath",1),he([Q],ue.prototype,"getCurrentTool",1),he([Q],ue.prototype,"getCurrentToolId",1),he([Q],ue.prototype,"getDocumentSettings",1),he([Q],ue.prototype,"getInstanceState",1),he([Q],ue.prototype,"getOpenMenus",1),he([Q],ue.prototype,"getIsMenuOpen",1),he([Q],ue.prototype,"getPageStates",1),he([Q],ue.prototype,"_getPageStatesQuery",1),he([Q],ue.prototype,"getCurrentPageState",1),he([Q],ue.prototype,"_getCurrentPageStateId",1),he([Q],ue.prototype,"getSelectedShapeIds",1),he([Q],ue.prototype,"getSelectedShapes",1),he([Q],ue.prototype,"getOnlySelectedShape",1),he([Q],ue.prototype,"getSelectionPageBounds",1),he([Q],ue.prototype,"getSelectionRotation",1),he([Q],ue.prototype,"getSelectionRotatedPageBounds",1),he([Q],ue.prototype,"getFocusedGroupId",1),he([Q],ue.prototype,"getFocusedGroup",1),he([Q],ue.prototype,"getEditingShapeId",1),he([Q],ue.prototype,"getEditingShape",1),he([Q],ue.prototype,"getHoveredShapeId",1),he([Q],ue.prototype,"getHoveredShape",1),he([Q],ue.prototype,"getHintingShapeIds",1),he([Q],ue.prototype,"getHintingShape",1),he([Q],ue.prototype,"getErasingShapeIds",1),he([Q],ue.prototype,"getErasingShapes",1),he([Q],ue.prototype,"getCameraId",1),he([Q],ue.prototype,"getCamera",1),he([Q],ue.prototype,"getZoomLevel",1),he([Q],ue.prototype,"getViewportScreenBounds",1),he([Q],ue.prototype,"getViewportScreenCenter",1),he([Q],ue.prototype,"getViewportPageBounds",1),he([Q],ue.prototype,"getViewportPageCenter",1),he([Q],ue.prototype,"getRenderingShapes",1),he([Q],ue.prototype,"_getAllPagesQuery",1),he([Q],ue.prototype,"getPages",1),he([Q],ue.prototype,"_getAllAssetsQuery",1),he([Q],ue.prototype,"_getShapeGeometryCache",1),he([Q],ue.prototype,"_getShapeOutlineSegmentsCache",1),he([Q],ue.prototype,"_getShapeHandlesCache",1),he([Q],ue.prototype,"_getShapePageTransformCache",1),he([Q],ue.prototype,"_getShapePageBoundsCache",1),he([Q],ue.prototype,"_getShapeClipPathCache",1),he([Q],ue.prototype,"_getShapeMaskCache",1),he([Q],ue.prototype,"getCurrentPageBounds",1),he([Q],ue.prototype,"getCurrentPageShapes",1),he([Q],ue.prototype,"getCurrentPageShapesSorted",1),he([Q],ue.prototype,"getCurrentPageRenderingShapesSorted",1),he([Q({isEqual:(n,e)=>n.equals(e)})],ue.prototype,"getSharedStyles",1),he([Q],ue.prototype,"getSharedOpacity",1);function Vp(n,e=n.getCurrentPageId()){const t=n.getPage(e).name;n.emit("max-shapes",{name:t,pageId:e,count:Qi})}function Hp(){const n=G();return q("isDarkMode",()=>n.user.getIsDarkMode(),[n])}const ZF='<path d="m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z" fill="white"/><path d="m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z" fill="white"/><path d="m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z" fill="black"/><path d="m13 10.814v11.188l2.969-2.866.428-.139h4.768z" fill="black"/>',QF='<path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" stroke-linejoin="round"/><path d="m21.5664 21.7344v-3.459"/><path d="m19.5508 21.7461-.016-3.473"/><path d="m17.5547 18.3047.021 3.426"/></g>',e9='<path d="m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z" fill="white"/><path d="m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z" fill="%23231f1f"/>',t9='<path d="m19 14h1v1h-1zm1 6h-1v-1h1zm-5-5h-1v-1h1zm0 5h-1v-1h1zm2-10.987-7.985 7.988 5.222 5.221 2.763 2.763 7.984-7.985z" fill="white"/><g fill="black"><path d="m23.5664 16.9971-2.557-2.809v1.829h-4.009-4.001v-1.829l-2.571 2.809 2.572 2.808-.001-1.808h4.001 4.009l-.001 1.808z"/><path d="m17.9873 17h.013v-4.001l1.807.001-2.807-2.571-2.809 2.57h1.809v4.001h.008v4.002l-1.828-.001 2.807 2.577 2.805-2.576h-1.805z"/></g>',HP="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",WP="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",Wp='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>',n9='<path fill="white" d="M7.94 0a5.25 5.25 0 0 0-3.47 1.17A5.27 5.27 0 0 0 1 0H0v3h1c1.41 0 1.85.7 2 1v3.94H2v3h1v3c-.13.3-.57 1-2 1H0v3h1a5.27 5.27 0 0 0 3.47-1.17c.98.8 2.21 1.21 3.47 1.17h1v-3h-1c-1.41 0-1.85-.7-2-1v-3H7v-3H6V4c.13-.3.57-1 2-1h1V0H7.94z"/><path fill="black" d="M7.94 2V1a4 4 0 0 0-3.47 1.64A4 4 0 0 0 1 1v1c1.3-.17 2.56.6 3 1.84v5.1H3v1h1v4.16c-.45 1.24-1.7 2-3 1.84v1a4.05 4.05 0 0 0 3.47-1.63 4.05 4.05 0 0 0 3.47 1.63v-1A2.82 2.82 0 0 1 5 14.1V9.93h1v-1H5V3.85A2.81 2.81 0 0 1 7.94 2z"/>',r9="<path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042' fill='white'/><g stroke='black' stroke-width='.75'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042z' stroke-linejoin='round'/><path d='m20.5664 19.7344v-3.459' stroke-linecap='round'/><path d='m18.5508 19.7461-.016-3.473' stroke-linecap='round'/><path d='m16.5547 16.3047.021 3.426' stroke-linecap='round'/></g>",i9='<path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" stroke-linejoin="round"/><path d="m20.5664 21.7344v-3.459"/><path d="m18.5508 21.7461-.016-3.473"/><path d="m16.5547 18.3047.021 3.426"/></g>',o9='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 14h-2v-2h-2v2h-2v1.98h2v2.02h2v-2.02h2z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>',s9='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 16h-5.98v-1.98h5.98z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>';function qt(n,e,t,r,i,o=16,s=16){const a=(-t-e)*(Fe/180),l=Math.sin(a),c=Math.cos(a),d=1*c-1*l,u=1*l+1*c;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${d}' dy='${u}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${o} ${s}, pointer`}const a9={none:()=>"none",default:(n,e,t)=>qt(ZF,n,0,e,t,12,8),pointer:(n,e,t)=>qt(QF,n,0,e,t,14,10),cross:(n,e,t)=>qt(e9,n,0,e,t),move:(n,e,t)=>qt(t9,n,0,e,t),grab:(n,e,t)=>qt(i9,n,0,e,t),grabbing:(n,e,t)=>qt(r9,n,0,e,t),text:(n,e,t)=>qt(n9,n,0,e,t,4,10),"ew-resize":(n,e,t)=>qt(WP,n,0,e,t),"ns-resize":(n,e,t)=>qt(WP,n,90,e,t),"nesw-resize":(n,e,t)=>qt(HP,n,0,e,t),"nwse-resize":(n,e,t)=>qt(HP,n,90,e,t),"nwse-rotate":(n,e,t)=>qt(Wp,n,0,e,t),"nesw-rotate":(n,e,t)=>qt(Wp,n,90,e,t),"senw-rotate":(n,e,t)=>qt(Wp,n,180,e,t),"swne-rotate":(n,e,t)=>qt(Wp,n,270,e,t),"zoom-in":(n,e,t)=>qt(o9,n,0,e,t),"zoom-out":(n,e,t)=>qt(s9,n,0,e,t)};function cr(n,e=0,t="black"){return a9[n](mz(e),!1,t)}const l9=["default","pointer","cross","move","grab","grabbing","text"];function c9(){const n=G(),e=hn(),t=Hp();Ds("useCursor",()=>{const{type:r,rotation:i}=n.getInstanceState().cursor;if(l9.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",cr(r,i,t?"white":"black"))},[n,e,t])}function d9(){const n=G(),e=hn(),t=Hp(),r=q(nt.forceSrgb);re.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[n,e,r,t])}function u9(n){const e=v.useRef();return v.useLayoutEffect(()=>{e.current=n}),v.useDebugValue(n),v.useCallback((...t)=>{const r=e.current;return Ls(r,"fn does not exist"),r(...t)},[])}function h9(n){const e=G(),t=hn();v.useLayoutEffect(()=>{n?(e.getInstanceState().isFocused||e.updateInstanceState({isFocused:!0}),e.getContainer().focus()):e.getInstanceState().isFocused&&e.updateInstanceState({isFocused:!1})},[e,t,n])}function p9(){const[n,e]=v.useState(0);v.useEffect(()=>e(t=>t+1),[])}const pl="TLDRAW_TAB_ID_v2",Jt=globalThis.window;function f9(){return Jt?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Jt.navigator.platform)||Jt.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const Kp=(Jt==null?void 0:Jt[pl])??(Jt==null?void 0:Jt.sessionStorage[pl])??"TLDRAW_INSTANCE_STATE_V1_"+qe();Jt&&(Jt[pl]=Kp,f9()?Jt.sessionStorage[pl]=Kp:delete Jt.sessionStorage[pl]),Jt==null||Jt.addEventListener("beforeunload",()=>{Jt.sessionStorage[pl]=Kp});const g9={Initial:0},Sd=g9.Initial,KP=Me({version:we,currentPageId:Yc,isFocusMode:Ee,exportBackground:Ee,isDebugMode:Ee,isToolLocked:Ee,isGridMode:Ee,pageStates:En(Me({pageId:Yc,camera:Me({x:we,y:we,z:we}),selectedShapeIds:En(Hr),focusedGroupId:Hr.nullable()}))}),m9=Ne({currentVersion:Sd});function y9(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;const e=$0({value:n,fromVersion:n.version,toVersion:Sd,migrations:m9});if(e.type==="error")return console.warn(e.reason),null;const t={...e.value,version:Sd};try{KP.validate(t)}catch(r){return console.warn(r),null}return t}function w9(n){const e=n.query.ids("page");return Q("sessionStateSnapshot",()=>{const t=n.get(In);if(!t)return null;const r=[...e.get()];return{version:Sd,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:r.map(i=>{const o=n.get(dn.createId(i)),s=n.get(cn.createId(i));return{pageId:i,camera:{x:(s==null?void 0:s.x)??0,y:(s==null?void 0:s.y)??0,z:(s==null?void 0:s.z)??1},selectedShapeIds:(o==null?void 0:o.selectedShapeIds)??[],focusedGroupId:(o==null?void 0:o.focusedGroupId)??null}})}})}function b9(n,e){const t=y9(e);if(!t)return;const r=n.allRecords().filter(s=>s.typeName==="instance_page_state"||s.typeName==="camera"),i={added:{},updated:{},removed:{...NC(r.map(s=>[s.id,s]))}};n.has(In)&&(i.removed[In]=n.get(In));const o={removed:{},updated:{},added:{[In]:n.schema.types.instance.create({id:In,currentPageId:t.currentPageId,isDebugMode:t.isDebugMode,isFocusMode:t.isFocusMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,exportBackground:t.exportBackground})}};for(const s of t.pageStates){const a=cn.createId(s.pageId),l=dn.createId(s.pageId);o.added[a]=cn.create({id:cn.createId(s.pageId),x:s.camera.x,y:s.camera.y,z:s.camera.z}),o.added[l]=dn.create({id:dn.createId(s.pageId),pageId:s.pageId,selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId})}Ur(()=>{n.applyDiff(ip([i,o])),n.ensureStoreIsUsable()})}function v9(n){var i;const e=[];for(const o of Object.values(n))(i=o.typeName)!=null&&i.match(/^(instance.*|pointer|camera)$/)&&e.push(o);const t=e.filter(o=>o.typeName==="instance"&&o.id!==In)[0];if(!t)return null;const r={version:Sd,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(o=>o.typeName==="instance_page_state"&&o.instanceId===t.id).map(o=>{const s=n[o.cameraId]??{x:0,y:0,z:1};return{pageId:o.pageId,camera:{x:s.x,y:s.y,z:s.z},selectedShapeIds:o.selectedShapeIds,focusedGroupId:o.focusedGroupId}})};try{return KP.validate(r),r}catch{return null}}function S9(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`)}function x9(){window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const _9=(n,e)=>e.some(t=>n instanceof t);let GP,YP;function k9(){return GP||(GP=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function C9(){return YP||(YP=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const XP=new WeakMap,jw=new WeakMap,qP=new WeakMap,Rw=new WeakMap,Ow=new WeakMap;function P9(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",s)},o=()=>{t(io(n.result)),i()},s=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",s)});return e.then(t=>{t instanceof IDBCursor&&XP.set(t,n)}).catch(()=>{}),Ow.set(e,n),e}function E9(n){if(jw.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",s),n.removeEventListener("abort",s)},o=()=>{t(),i()},s=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",s),n.addEventListener("abort",s)});jw.set(n,e)}let Dw={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return jw.get(n);if(e==="objectStoreNames")return n.objectStoreNames||qP.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return io(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function I9(n){Dw=n(Dw)}function M9(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Lw(this),e,...t);return qP.set(r,e.sort?e.sort():[e]),io(r)}:C9().includes(n)?function(...e){return n.apply(Lw(this),e),io(XP.get(this))}:function(...e){return io(n.apply(Lw(this),e))}}function A9(n){return typeof n=="function"?M9(n):(n instanceof IDBTransaction&&E9(n),_9(n,k9())?new Proxy(n,Dw):n)}function io(n){if(n instanceof IDBRequest)return P9(n);if(Rw.has(n))return Rw.get(n);const e=A9(n);return e!==n&&(Rw.set(n,e),Ow.set(e,n)),e}const Lw=n=>Ow.get(n);function T9(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){const s=indexedDB.open(n,e),a=io(s);return r&&s.addEventListener("upgradeneeded",l=>{r(io(s.result),l.oldVersion,l.newVersion,io(s.transaction),l)}),t&&s.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function j9(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),io(t).then(()=>{})}const R9=["get","getKey","getAll","getAllKeys","count"],O9=["put","add","delete","clear"],zw=new Map;function JP(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(zw.get(e))return zw.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=O9.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||R9.includes(t)))return;const o=async function(s,...a){const l=this.transaction(s,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),i&&l.done]))[0]};return zw.set(e,o),o}I9(n=>({...n,get:(e,t,r)=>JP(e,t)||n.get(e,t,r),has:(e,t)=>!!JP(e,t)||n.has(e,t)}));const Gp="TLDRAW_DOCUMENT_v2",ZP="TLDRAW_DB_NAME_INDEX_v2",Ke={Records:"records",Schema:"schema",SessionState:"session_state"};async function Yp(n,e){F9(n);const t=await T9(n,3,{upgrade(r){r.objectStoreNames.contains(Ke.Records)||r.createObjectStore(Ke.Records),r.objectStoreNames.contains(Ke.Schema)||r.createObjectStore(Ke.Schema),r.objectStoreNames.contains(Ke.SessionState)||r.createObjectStore(Ke.SessionState)}});try{return await e(t)}finally{t.close()}}async function D9({persistenceKey:n,sessionId:e,didCancel:t}){const r=Gp+n;if(Nw().includes(r))return await N9({persistenceKey:n,didCancel:t}),await Yp(r,async i=>{var u,h;if(t!=null&&t())return;const o=i.transaction([Ke.Records,Ke.Schema,Ke.SessionState],"readonly"),s=o.objectStore(Ke.Records),a=o.objectStore(Ke.Schema),l=o.objectStore(Ke.SessionState);let c=e?(u=await l.get(e))==null?void 0:u.snapshot:null;c||(c=(h=(await l.getAll()).sort((p,m)=>p.updatedAt-m.updatedAt).pop())==null?void 0:h.snapshot);const d={records:await s.getAll(),schema:await a.get(Ke.Schema),sessionStateSnapshot:c};if(t!=null&&t()){o.abort();return}return await o.done,d})}async function L9({persistenceKey:n,schema:e,changes:t,sessionId:r,sessionStateSnapshot:i,didCancel:o}){const s=Gp+n;await Yp(s,async a=>{const l=a.transaction([Ke.Records,Ke.Schema,Ke.SessionState],"readwrite"),c=l.objectStore(Ke.Records),d=l.objectStore(Ke.Schema),u=l.objectStore(Ke.SessionState);for(const[h,p]of Object.entries(t.added))await c.put(p,h);for(const[h,p]of Object.values(t.updated))await c.put(p,p.id);for(const h of Object.keys(t.removed))await c.delete(h);if(d.put(e.serialize(),Ke.Schema),i&&r?u.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o==null?void 0:o())return l.abort();await l.done})}async function z9({persistenceKey:n,schema:e,snapshot:t,sessionId:r,sessionStateSnapshot:i,didCancel:o}){const s=Gp+n;await Yp(s,async a=>{const l=a.transaction([Ke.Records,Ke.Schema,Ke.SessionState],"readwrite"),c=l.objectStore(Ke.Records),d=l.objectStore(Ke.Schema),u=l.objectStore(Ke.SessionState);await c.clear();for(const[h,p]of Object.entries(t))await c.put(p,h);if(d.put(e.serialize(),Ke.Schema),i&&r?u.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o==null?void 0:o())return l.abort();await l.done})}async function N9({persistenceKey:n,didCancel:e}){await Yp(Gp+n,async t=>{const r=t.transaction([Ke.SessionState],"readwrite"),i=r.objectStore(Ke.SessionState),o=(await i.getAll()).sort((a,l)=>a.updatedAt-l.updatedAt);if(o.length<10){await r.done;return}const s=o.slice(0,o.length-10);for(const{id:a}of s)await i.delete(a);if(e!=null&&e())return r.abort();await r.done})}function Nw(){const n=JSON.parse((window==null?void 0:window.localStorage.getItem(ZP))||"[]")??[];return Array.isArray(n)?n:[]}function F9(n){const e=new Set(Nw());e.add(n),window==null||window.localStorage.setItem(ZP,JSON.stringify([...e]))}const $9=350,B9=1e4,QP=Symbol("UPDATE_INSTANCE_STATE"),U9=n=>n;class V9{constructor(e){y(this,"onmessage")}postMessage(e){}close(){}}const H9=typeof BroadcastChannel>"u"?V9:BroadcastChannel;class W9{constructor(e,{persistenceKey:t,sessionId:r=Kp,onLoad:i,onLoadError:o},s=new H9(`tldraw-tab-sync-${t}`)){y(this,"disposables",new Set);y(this,"diffQueue",[]);y(this,"didDispose",!1);y(this,"shouldDoFullDBWrite",!0);y(this,"isReloading",!1);y(this,"persistenceKey");y(this,"sessionId");y(this,"serializedSchema");y(this,"isDebugging",!1);y(this,"documentTypes");y(this,"$sessionStateSnapshot");y(this,"initTime",Date.now());y(this,"isPersisting",!1);y(this,"didLastWriteError",!1);y(this,"scheduledPersistTimeout",null);this.store=e,this.channel=s,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=r,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=w9(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(U9({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(QP),this.schedulePersist()},{scope:"session"})),this.connect(i,o),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let r;try{r=await D9({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(i){t(i),x9(),typeof window<"u"&&window.location.reload();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const i=Object.fromEntries(r.records.map(a=>[a.id,a])),o=r.sessionStateSnapshot??v9(i),s=this.store.schema.migrateStoreSnapshot({store:i,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(s.type==="error"){console.error("failed to migrate store",s),t(new Error(`Failed to migrate store: ${s.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(s.value).filter(a=>this.documentTypes.has(a.typeName)),"initialize")}),o&&b9(this.store,o)}this.channel.onmessage=({data:i})=>{var a,l;this.debug("got message",i);const o=i,s=_D(this.serializedSchema,o.schema??this.store.schema.serializeEarliestVersion());if(s===-1){if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(l=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||l.call(a);return}else if(s===1){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}o.type==="diff"&&(this.debug("applying diff"),Ur(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(o.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;t(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?B9:$9))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){Ls(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await z9({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=ip(e.filter(r=>r!==QP));await L9({persistenceKey:this.persistenceKey,changes:t,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),S9(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function K9({initialData:n,defaultName:e="",...t}){const r="schema"in t&&t.schema?t.schema:mL({shapes:G9(IP("shapeUtils"in t&&t.shapeUtils?t.shapeUtils:[]))});return new HC({schema:r,initialData:n,props:{defaultName:e}})}function G9(n){return Object.fromEntries(n.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}function eE(n){const e=K9(n);return n.snapshot&&e.loadSnapshot(n.snapshot),{store:e,opts:n}}function Y9(n){const[e,t]=v.useState(()=>eE(n));if(!$C(e.opts,n)){const r=eE(n);return t(r),r.store}return e.store}function X9({persistenceKey:n,sessionId:e,...t}){const[r,i]=v.useState(null),o=Y9(t);return v.useEffect(()=>{const s=qe();if(!n){i({id:s,storeWithStatus:{status:"not-synced",store:o}});return}i({id:s,storeWithStatus:{status:"loading"}});const a=c=>{i(d=>(d==null?void 0:d.id)===s?{id:s,storeWithStatus:c}:d)},l=new W9(o,{sessionId:e,persistenceKey:n,onLoad(){a({store:o,status:"synced-local"})},onLoadError(c){a({status:"error",error:c})}});return()=>{i(c=>(c==null?void 0:c.id)===s?null:c),l.close()}},[n,o,e]),(r==null?void 0:r.storeWithStatus)??{status:"loading"}}let tE=!1;if(typeof window<"u"){const n=window.navigator.userAgent,e=!!n.match(/iPad/i)||!!n.match(/iPhone/i),t=!!n.match(/WebKit/i);tE=e&&t&&!n.match(/CriOS/i)}function q9(){const n=G();v.useEffect(()=>{if(!tE)return;function e(t){(t.target instanceof HTMLInputElement&&t.target.type==="text"||t.target instanceof HTMLTextAreaElement)&&n.complete()}return document.addEventListener("focusout",e),()=>document.removeEventListener("focusout",e)},[n])}function J9(){const n=G(),e=hn();v.useEffect(()=>{const t=o=>e.style.setProperty("--tl-zoom",o.toString()),r=jC(t,100),i=new Va("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?t(n.getZoomLevel()):r(n.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach()}},[n,e])}const Z9=[],Q9=[],e7=v.memo(function({store:n,components:e,className:t,user:r,...i}){const[o,s]=re.useState(null),a=v.useMemo(()=>r??vP(),[r]),l=(e==null?void 0:e.ErrorFallback)===void 0?C2:e==null?void 0:e.ErrorFallback,c={...i,shapeUtils:i.shapeUtils??Z9,tools:i.tools??Q9,components:e};return g.jsx("div",{ref:s,draggable:!1,className:ye("tl-container tl-theme__light",t),onPointerDown:Ft,tabIndex:-1,children:g.jsx(rd,{fallback:l,onError:d=>D0(d,{tags:{origin:"react.tldraw-before-app"}}),children:o&&g.jsx(rz,{container:o,children:g.jsx(Yz,{overrides:e,children:n?n instanceof HC?g.jsx(rE,{...c,store:n,user:a}):g.jsx(nE,{...c,store:n,user:a}):g.jsx(t7,{...c,store:n,user:a})})})})})});function t7(n){const{defaultName:e,snapshot:t,initialData:r,shapeUtils:i,persistenceKey:o,sessionId:s,user:a}=n,l=X9({shapeUtils:i,initialData:r,persistenceKey:o,sessionId:s,defaultName:e,snapshot:t});return g.jsx(nE,{...n,store:l,user:a})}const nE=v.memo(function({store:n,user:e,...t}){var i;const r=hn();switch(v.useLayoutEffect(()=>{e.userPreferences.get().isDarkMode&&(r.classList.remove("tl-theme__light"),r.classList.add("tl-theme__dark"))},[r,e]),n.status){case"error":throw n.error;case"loading":{const o=((i=t.components)==null?void 0:i.LoadingScreen)??eF;return g.jsx(o,{})}}return g.jsx(rE,{...t,store:n.store,user:e})});function rE({onMount:n,children:e,store:t,tools:r,shapeUtils:i,user:o,initialState:s,autoFocus:a=!0,inferDarkMode:l}){const{ErrorFallback:c}=$t(),d=hn(),[u,h]=v.useState(null);v.useLayoutEffect(()=>{const m=new ue({store:t,shapeUtils:i,tools:r,getContainer:()=>d,user:o,initialState:s,inferDarkMode:l});return window.app=m,window.editor=m,h(m),()=>{m.dispose()}},[d,i,r,t,o,s,l]);const p=v.useSyncExternalStore(v.useCallback(m=>u?(u.on("crash",m),()=>u.off("crash",m)):()=>{},[u]),()=>(u==null?void 0:u.getCrashingError())??null);return u?g.jsx(rd,{fallback:c,onError:m=>u.annotateError(m,{origin:"react.tldraw",willCrashApp:!0}),children:p?g.jsx(r7,{crashingError:p}):g.jsx(iw.Provider,{value:u,children:g.jsx(n7,{autoFocus:a,onMount:n,children:e})})}):null}function n7({children:n,onMount:e,autoFocus:t}){return J9(),c9(),d9(),q9(),p9(),h9(t),o7(e),IN(),G().updateViewportScreenBounds(),n??g.jsx(vw,{})}function r7({crashingError:n}){throw n}function iE({children:n}){const{Spinner:e}=$t();return g.jsxs("div",{className:"tl-loading",children:[e?g.jsx(e,{}):null,n]})}function i7({children:n}){return g.jsx("div",{className:"tl-loading",children:n})}function o7(n){const e=G(),t=u9(r=>{const i=n==null?void 0:n(r);return r.emit("mount"),window.tldrawReady=!0,i});re.useLayoutEffect(()=>{if(e)return t==null?void 0:t(e)},[e,t])}function Gs({children:n,className:e="",...t}){return g.jsx("div",{...t,className:`tl-html-container ${e}`,children:n})}ze(function({x:n=0,y:e=0,rotation:t=0,...r}){const i=G(),o=v.useRef(null),s=i.getCamera();return v.useLayoutEffect(()=>{const{x:a,y:l,z:c}=i.getCamera(),d=o.current;d&&a!==void 0&&(d.style.transform=`translate(${a}px, ${l}px) scale(${c}) rotate(${t}rad) translate(${n}px, ${e}px)`)},[s,i,n,e,t]),g.jsx("div",{ref:o,...r,className:ye("tl-positioned",r.className)})});function oE(n,e,t={}){const{newPoint:r,handle:i,scaleX:o,scaleY:s}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:d=1/0}=t;let u=n.props.w*o,h=n.props.h*s;const p=new k(0,0);if(u>0){if(u<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=u-a;break}case"top":case"bottom":{p.x=(u-a)/2;break}default:p.x=0}u=a}}else if(p.x=u,u=-u,u<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=-u;break}default:p.x=-a}u=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=h-c;break}case"right":case"left":{p.y=(h-c)/2;break}default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=-h;break}default:p.y=-c}h=c}const{x:m,y:f}=p.rot(n.rotation).add(r);return{x:m,y:f,props:{w:Math.min(l,u),h:Math.min(d,h)}}}class fl extends Yr{constructor(){super(...arguments);y(this,"onResize",(t,r)=>oE(t,r))}getGeometry(t){return new Go({width:t.props.w,height:t.props.h,isFilled:!0})}}let s7=(wS=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(wS,"id","idle"),wS),a7=(bS=class extends ae{constructor(){super(...arguments);y(this,"markId","");y(this,"wasFocusedOnEnter",!1);y(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()});y(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=this.parent.shapeType,i=tt();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:r,x:t.x,y:t.y,props:{w:1,h:1}}]).select(i),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const t=this.parent.shapeType,r=tt();this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:t,x:e.x,y:e.y}]);const i=this.editor.getShape(r),{w:o,h:s}=this.editor.getShapeUtil(i).getDefaultProps(),a=new k(o/2,s/2),l=this.editor.getShapeParentTransform(i);l&&a.rot(-l.rotation()),this.editor.updateShapes([{id:r,type:t,x:i.x-a.x,y:i.y-a.y}]),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},y(bS,"id","pointing"),bS);class Xp extends ae{constructor(){super(...arguments);y(this,"onCreate")}}y(Xp,"id","box"),y(Xp,"initial","idle"),y(Xp,"children",()=>[s7,a7]);function sE(n,e){const t=v.useRef(n);return e(n,t.current)?t.current:(t.current=n,n)}function aE(n){return sE(n,oD)}function l7(n){return sE(n,$C)}function lE(n){const e=G();return q("isCropping",()=>e.getCroppingShapeId()===n,[e,n])}function qp(n){const e=G();return q("isEditing",()=>e.getEditingShapeId()===n,[e,n])}function Si(n){const e=G();return v.useMemo(function(){const t=s=>{if(s.isKilled)return;if(s.button===2){e.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...Hn(s)});return}if(s.button!==0)return;const a=wp(s.currentTarget);function l(){a.removeEventListener("pointerup",l),td(a,s)}ed(a,s),a.addEventListener("pointerup",l),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...Hn(s)}),Ft(s)};let r,i;function o(s){s.isKilled||s.button===0&&(s.clientX===r&&s.clientY===i||(r=s.clientX,i=s.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...Hn(s)})))}return{onPointerDown:t,onPointerMove:o,onPointerUp:s=>{s.isKilled||s.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...Hn(s)})}}},[e,n])}const c7=20,d7=8;function Fw(n,e=c7){return Math.max(d7,Math.ceil(n/e))}class u7 extends Us{constructor(t){super({...t,isFilled:!1,isClosed:!1});y(this,"_center");y(this,"radius");y(this,"start");y(this,"end");y(this,"measure");y(this,"length");y(this,"angleStart");y(this,"angleEnd");const{center:r,radius:i,sweepFlag:o,largeArcFlag:s,start:a,end:l}=t;if(a.equals(l))throw Error("Arc must have different start and end points.");this.angleStart=k.Angle(r,a),this.angleEnd=k.Angle(r,l),this.measure=h7(this.angleStart,this.angleEnd,o,s),this.length=this.measure*i,this.start=a,this.end=l,this._center=r,this.radius=i}nearestPoint(t){const{_center:r,measure:i,radius:o,angleEnd:s,angleStart:a,start:l,end:c}=this,d=cE(i,a,s,r.angle(t));if(d<=0)return l;if(d>=1)return c;const u=r.clone().add(t.clone().sub(r).uni().mul(o));let h=1/0,p;for(const m of[l,c,u])t.dist(m)<h&&(p=m,h=t.dist(m));if(!p)throw Error("nearest point not found");return p}hitTestLineSegment(t,r,i){const{_center:o,radius:s,measure:a,angleStart:l,angleEnd:c}=this,d=Op(t,r,o,s);return d===null?!1:d.some(u=>{const h=cE(a,l,c,o.angle(u));return h>=0&&h<=1})}getVertices(){const{_center:t,measure:r,length:i,radius:o,angleStart:s}=this,a=[];for(let l=0,c=Fw(Math.abs(i));l<c+1;l++){const d=l/c*r,u=s+d;a.push(t.clone().add(new k(Math.cos(u),Math.sin(u)).mul(o)))}return a}}function cE(n,e,t,r){let i;if(Math.abs(n)>Fe){i=ad(e,r);const o=ad(r,t);return Math.abs(i)<Math.abs(o)?i/n:(n-o)/n}else return i=ad(e,r),i/n}function h7(n,e,t,r){const i=2*((e-n)%We)%We-(e-n)%We;return r?(We-Math.abs(i))*(t?1:-1):i}class dE extends Us{constructor(t){super({isClosed:!0,...t});y(this,"_center");y(this,"radius");y(this,"x");y(this,"y");this.config=t;const{x:r=0,y:i=0,radius:o}=t;this.x=r,this.y=i,this._center=new k(o+r,o+i),this.radius=o}getBounds(){return new de(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:t,radius:r}=this,i=We*r,o=[];for(let s=0,a=Fw(i);s<a;s++){const l=s/a*We;o.push(t.clone().add(k.FromAngle(l).mul(r)))}return o}nearestPoint(t){const{_center:r,radius:i}=this;return r.equals(t)?k.AddXY(r,i,0):r.clone().add(t.clone().sub(r).uni().mul(i))}hitTestLineSegment(t,r,i){const{_center:o,radius:s}=this;return Op(t,r,o,s)!==null}}class p7 extends Vs{constructor(t){const{start:r,cp1:i,cp2:o,end:s}=t;super({...t,points:[r,s]});y(this,"a");y(this,"b");y(this,"c");y(this,"d");this.a=r,this.b=i,this.c=o,this.d=s}getVertices(){const t=[],{a:r,b:i,c:o,d:s}=this;for(let a=0,l=10;a<=l;a++){const c=a/l;t.push(new k((1-c)*(1-c)*(1-c)*r.x+3*((1-c)*(1-c))*c*i.x+3*(1-c)*(c*c)*o.x+c*c*c*s.x,(1-c)*(1-c)*(1-c)*r.y+3*((1-c)*(1-c))*c*i.y+3*(1-c)*(c*c)*o.y+c*c*c*s.y))}return t}midPoint(){return f7(this,.5)}nearestPoint(t){let r,i=1/0;for(const o of this.segments){const s=o.nearestPoint(t),a=s.dist(t);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}}function f7(n,e){const{a:t,b:r,c:i,d:o}=n;return new k((1-e)*(1-e)*(1-e)*t.x+3*((1-e)*(1-e))*e*r.x+3*(1-e)*(e*e)*i.x+e*e*e*o.x,(1-e)*(1-e)*(1-e)*t.y+3*((1-e)*(1-e))*e*r.y+3*(1-e)*(e*e)*i.y+e*e*e*o.y)}class Jp extends Us{constructor(t){super({...t,isClosed:!1,isFilled:!1});y(this,"points");y(this,"_segments");y(this,"_length");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:t}=this,r=t.length,i=r-2,o=1.25;for(let s=0;s<r-1;s++){const a=s===0?t[0]:t[s-1],l=t[s],c=t[s+1],d=s===i?c:t[s+2],u=l,h=s===0?a:new k(l.x+(c.x-a.x)/6*o,l.y+(c.y-a.y)/6*o),p=s===i?c:new k(c.x-(d.x-l.x)/6*o,c.y-(d.y-l.y)/6*o),m=c;this._segments.push(new p7({start:u,cp1:h,cp2:p,end:m}))}}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((t,r)=>t+r.length,0)),this._length}getVertices(){const t=this.segments.reduce((r,i)=>r.concat(i.vertices),[]);return t.push(this.points[this.points.length-1]),t}nearestPoint(t){let r,i=1/0;for(const o of this.segments){const s=o.nearestPoint(t),a=s.dist(t);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r,i){return this.segments.some(o=>o.hitTestLineSegment(t,r,i))}}class uE extends Us{constructor(t){super({...t,isClosed:!0});y(this,"w");y(this,"h");y(this,"_edges");this.config=t;const{width:r,height:i}=t;this.w=r,this.h=i}get edges(){if(!this._edges){const{vertices:t}=this;this._edges=[];for(let r=0,i=t.length;r<i;r++){const o=t[r],s=t[(r+1)%i];this._edges.push(new Lp({start:o,end:s}))}}return this._edges}getVertices(){const t=Math.max(1,this.w),r=Math.max(1,this.h),i=t/2,o=r/2,s=Math.pow(i-o,2)/Math.pow(i+o,2),a=Fe*(i+o)*(1+3*s/(10+Math.sqrt(4-3*s))),l=Fw(a),c=We/l,d=Math.cos(c),u=Math.sin(c);let h=0,p=1,m=0,f=1;const w=Array(l);for(let S=0;S<l;S++)w[S]=new k(i+i*p,o+o*h),m=u*p+d*h,f=d*p-u*h,h=m,p=f;return w}nearestPoint(t){let r,i=1/0;for(const o of this.edges){const s=o.nearestPoint(t),a=s.dist(t);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r,i){return this.edges.some(o=>o.hitTestLineSegment(t,r,i))}getBounds(){return new de(0,0,this.w,this.h)}}class g7 extends uE{constructor(e){super({...e}),this.config=e}getVertices(){const e=Math.max(1,this.w),t=Math.max(1,this.h),r=e/2,i=t/2,o=10,s=Array(o*2-2);if(t>e)for(let a=0;a<o-1;a++){const l=-Fe+Fe*a/(o-2),c=Fe*a/(o-2);s[a]=new k(r+r*Math.cos(l),r+r*Math.sin(l)),s[a+(o-1)]=new k(r+r*Math.cos(c),t-r+r*Math.sin(c))}else for(let a=0;a<o-1;a++){const l=-rt+Fe*a/(o-2),c=rt+Fe*-a/(o-2);s[a]=new k(e-i+i*Math.cos(l),t-i+i*Math.sin(l)),s[a+(o-1)]=new k(i-i*Math.cos(c),t-i+i*Math.sin(c))}return s}}function hE(n,e){return n<0?1:n>e?-1:n<nl?(nl-n)/nl:n>e-nl?-(nl-e+n)/nl:0}function $w(n){if(!n.inputs.isDragging||n.inputs.isPanning)return;const{inputs:{currentScreenPoint:{x:e,y:t}}}=n,r=n.getZoomLevel(),i=n.getViewportScreenBounds(),o=i.w<1e3?.612:1,s=i.h<1e3?.612:1,a=hE(e-i.x,i.w),l=hE(t-i.y,i.h);if(a===0&&l===0)return;const c=n.user.getEdgeScrollSpeed()*Dz,d=c*a*o/r,u=c*l*s/r,h=n.getCamera();n.setCamera({x:h.x+d,y:h.y+u})}async function m7({shouldReload:n=!0}={}){sessionStorage.clear(),await Promise.all(Nw().map(e=>j9(e))),localStorage.clear(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=m7);function y7(n,e="_blank"){aw.openWindow(n,e)}var Zp=function(n){return n&&n.Math==Math&&n},Kn=Zp(typeof globalThis=="object"&&globalThis)||Zp(typeof window=="object"&&window)||Zp(typeof self=="object"&&self)||Zp(typeof dt=="object"&&dt)||function(){return this}()||dt||Function("return this")(),Bw={},Mn=function(n){try{return!!n()}catch{return!0}},w7=Mn,Jo=!w7(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),b7=Mn,Qp=!b7(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),v7=Qp,ef=Function.prototype.call,Zo=v7?ef.bind(ef):function(){return ef.apply(ef,arguments)},pE={},fE={}.propertyIsEnumerable,gE=Object.getOwnPropertyDescriptor,S7=gE&&!fE.call({1:2},1);pE.f=S7?function(n){var e=gE(this,n);return!!e&&e.enumerable}:fE;var mE=function(n,e){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:e}},yE=Qp,wE=Function.prototype,Uw=wE.call,x7=yE&&wE.bind.bind(Uw,Uw),Ut=yE?x7:function(n){return function(){return Uw.apply(n,arguments)}},bE=Ut,_7=bE({}.toString),k7=bE("".slice),gl=function(n){return k7(_7(n),8,-1)},C7=Ut,P7=Mn,E7=gl,Vw=Object,I7=C7("".split),M7=P7(function(){return!Vw("z").propertyIsEnumerable(0)})?function(n){return E7(n)=="String"?I7(n,""):Vw(n)}:Vw,tf=function(n){return n==null},A7=tf,T7=TypeError,ml=function(n){if(A7(n))throw T7("Can't call method on "+n);return n},j7=M7,R7=ml,nf=function(n){return j7(R7(n))},Hw=typeof document=="object"&&document.all,O7=typeof Hw>"u"&&Hw!==void 0,vE={all:Hw,IS_HTMLDDA:O7},SE=vE,D7=SE.all,An=SE.IS_HTMLDDA?function(n){return typeof n=="function"||n===D7}:function(n){return typeof n=="function"},xE=An,_E=vE,L7=_E.all,Ys=_E.IS_HTMLDDA?function(n){return typeof n=="object"?n!==null:xE(n)||n===L7}:function(n){return typeof n=="object"?n!==null:xE(n)},Ww=Kn,z7=An,N7=function(n){return z7(n)?n:void 0},rf=function(n,e){return arguments.length<2?N7(Ww[n]):Ww[n]&&Ww[n][e]},F7=Ut,kE=F7({}.isPrototypeOf),$7=typeof navigator<"u"&&String(navigator.userAgent)||"",CE=Kn,Kw=$7,PE=CE.process,EE=CE.Deno,IE=PE&&PE.versions||EE&&EE.version,ME=IE&&IE.v8,qr,of;ME&&(qr=ME.split("."),of=qr[0]>0&&qr[0]<4?1:+(qr[0]+qr[1])),!of&&Kw&&(qr=Kw.match(/Edge\/(\d+)/),(!qr||qr[1]>=74)&&(qr=Kw.match(/Chrome\/(\d+)/),qr&&(of=+qr[1])));var B7=of,AE=B7,U7=Mn,V7=Kn,H7=V7.String,TE=!!Object.getOwnPropertySymbols&&!U7(function(){var n=Symbol();return!H7(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&AE&&AE<41}),W7=TE,jE=W7&&!Symbol.sham&&typeof Symbol.iterator=="symbol",K7=rf,G7=An,Y7=kE,X7=jE,q7=Object,RE=X7?function(n){return typeof n=="symbol"}:function(n){var e=K7("Symbol");return G7(e)&&Y7(e.prototype,q7(n))},J7=String,Z7=function(n){try{return J7(n)}catch{return"Object"}},Q7=An,e$=Z7,t$=TypeError,Gw=function(n){if(Q7(n))return n;throw t$(e$(n)+" is not a function")},n$=Gw,r$=tf,Yw=function(n,e){var t=n[e];return r$(t)?void 0:n$(t)},Xw=Zo,qw=An,Jw=Ys,i$=TypeError,o$=function(n,e){var t,r;if(e==="string"&&qw(t=n.toString)&&!Jw(r=Xw(t,n))||qw(t=n.valueOf)&&!Jw(r=Xw(t,n))||e!=="string"&&qw(t=n.toString)&&!Jw(r=Xw(t,n)))return r;throw i$("Can't convert object to primitive value")},OE={exports:{}},DE=Kn,s$=Object.defineProperty,Zw=function(n,e){try{s$(DE,n,{value:e,configurable:!0,writable:!0})}catch{DE[n]=e}return e},a$=Kn,l$=Zw,LE="__core-js_shared__",c$=a$[LE]||l$(LE,{}),Qw=c$,zE=Qw;(OE.exports=function(n,e){return zE[n]||(zE[n]=e!==void 0?e:{})})("versions",[]).push({version:"3.32.0",mode:"global",copyright:"\xA9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.0/LICENSE",source:"https://github.com/zloirock/core-js"});var eb=OE.exports,d$=ml,u$=Object,xd=function(n){return u$(d$(n))},h$=Ut,p$=xd,f$=h$({}.hasOwnProperty),Qo=Object.hasOwn||function(n,e){return f$(p$(n),e)},g$=Ut,m$=0,y$=Math.random(),w$=g$(1 .toString),NE=function(n){return"Symbol("+(n===void 0?"":n)+")_"+w$(++m$+y$,36)},b$=Kn,v$=eb,FE=Qo,S$=NE,x$=TE,_$=jE,yl=b$.Symbol,tb=v$("wks"),k$=_$?yl.for||yl:yl&&yl.withoutSetter||S$,oo=function(n){return FE(tb,n)||(tb[n]=x$&&FE(yl,n)?yl[n]:k$("Symbol."+n)),tb[n]},C$=Zo,$E=Ys,BE=RE,P$=Yw,E$=o$,I$=oo,M$=TypeError,A$=I$("toPrimitive"),T$=function(n,e){if(!$E(n)||BE(n))return n;var t=P$(n,A$),r;if(t){if(e===void 0&&(e="default"),r=C$(t,n,e),!$E(r)||BE(r))return r;throw M$("Can't convert object to primitive value")}return e===void 0&&(e="number"),E$(n,e)},j$=T$,R$=RE,UE=function(n){var e=j$(n,"string");return R$(e)?e:e+""},O$=Kn,VE=Ys,nb=O$.document,D$=VE(nb)&&VE(nb.createElement),HE=function(n){return D$?nb.createElement(n):{}},L$=Jo,z$=Mn,N$=HE,WE=!L$&&!z$(function(){return Object.defineProperty(N$("div"),"a",{get:function(){return 7}}).a!=7}),F$=Jo,$$=Zo,B$=pE,U$=mE,V$=nf,H$=UE,W$=Qo,K$=WE,KE=Object.getOwnPropertyDescriptor;Bw.f=F$?KE:function(n,e){if(n=V$(n),e=H$(e),K$)try{return KE(n,e)}catch{}if(W$(n,e))return U$(!$$(B$.f,n,e),n[e])};var wl={},G$=Jo,Y$=Mn,GE=G$&&Y$(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),X$=Ys,q$=String,J$=TypeError,Xs=function(n){if(X$(n))return n;throw J$(q$(n)+" is not an object")},Z$=Jo,Q$=WE,eB=GE,sf=Xs,YE=UE,tB=TypeError,rb=Object.defineProperty,nB=Object.getOwnPropertyDescriptor,ib="enumerable",ob="configurable",sb="writable";wl.f=Z$?eB?function(n,e,t){if(sf(n),e=YE(e),sf(t),typeof n=="function"&&e==="prototype"&&"value"in t&&sb in t&&!t[sb]){var r=nB(n,e);r&&r[sb]&&(n[e]=t.value,t={configurable:ob in t?t[ob]:r[ob],enumerable:ib in t?t[ib]:r[ib],writable:!1})}return rb(n,e,t)}:rb:function(n,e,t){if(sf(n),e=YE(e),sf(t),Q$)try{return rb(n,e,t)}catch{}if("get"in t||"set"in t)throw tB("Accessors not supported");return"value"in t&&(n[e]=t.value),n};var rB=Jo,iB=wl,oB=mE,ab=rB?function(n,e,t){return iB.f(n,e,oB(1,t))}:function(n,e,t){return n[e]=t,n},XE={exports:{}},lb=Jo,sB=Qo,qE=Function.prototype,aB=lb&&Object.getOwnPropertyDescriptor,cb=sB(qE,"name"),lB=cb&&(function(){}).name==="something",cB=cb&&(!lb||lb&&aB(qE,"name").configurable),dB={EXISTS:cb,PROPER:lB,CONFIGURABLE:cB},uB=Ut,hB=An,db=Qw,pB=uB(Function.toString);hB(db.inspectSource)||(db.inspectSource=function(n){return pB(n)});var JE=db.inspectSource,fB=Kn,gB=An,ZE=fB.WeakMap,mB=gB(ZE)&&/native code/.test(String(ZE)),yB=eb,wB=NE,QE=yB("keys"),eI=function(n){return QE[n]||(QE[n]=wB(n))},ub={},bB=mB,tI=Kn,vB=Ys,SB=ab,hb=Qo,pb=Qw,xB=eI,_B=ub,nI="Object already initialized",fb=tI.TypeError,kB=tI.WeakMap,af,_d,lf,CB=function(n){return lf(n)?_d(n):af(n,{})},PB=function(n){return function(e){var t;if(!vB(e)||(t=_d(e)).type!==n)throw fb("Incompatible receiver, "+n+" required");return t}};if(bB||pb.state){var xi=pb.state||(pb.state=new kB);xi.get=xi.get,xi.has=xi.has,xi.set=xi.set,af=function(n,e){if(xi.has(n))throw fb(nI);return e.facade=n,xi.set(n,e),e},_d=function(n){return xi.get(n)||{}},lf=function(n){return xi.has(n)}}else{var bl=xB("state");_B[bl]=!0,af=function(n,e){if(hb(n,bl))throw fb(nI);return e.facade=n,SB(n,bl,e),e},_d=function(n){return hb(n,bl)?n[bl]:{}},lf=function(n){return hb(n,bl)}}var rI={set:af,get:_d,has:lf,enforce:CB,getterFor:PB},gb=Ut,EB=Mn,IB=An,cf=Qo,mb=Jo,MB=dB.CONFIGURABLE,AB=JE,iI=rI,TB=iI.enforce,jB=iI.get,oI=String,df=Object.defineProperty,RB=gb("".slice),OB=gb("".replace),DB=gb([].join),LB=mb&&!EB(function(){return df(function(){},"length",{value:8}).length!==8}),zB=String(String).split("String"),NB=XE.exports=function(n,e,t){RB(oI(e),0,7)==="Symbol("&&(e="["+OB(oI(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!cf(n,"name")||MB&&n.name!==e)&&(mb?df(n,"name",{value:e,configurable:!0}):n.name=e),LB&&t&&cf(t,"arity")&&n.length!==t.arity&&df(n,"length",{value:t.arity});try{t&&cf(t,"constructor")&&t.constructor?mb&&df(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch{}var r=TB(n);return cf(r,"source")||(r.source=DB(zB,typeof e=="string"?e:"")),n};Function.prototype.toString=NB(function(){return IB(this)&&jB(this).source||AB(this)},"toString");var FB=XE.exports,$B=An,BB=wl,UB=FB,VB=Zw,sI=function(n,e,t,r){r||(r={});var i=r.enumerable,o=r.name!==void 0?r.name:e;if($B(t)&&UB(t,o,r),r.global)i?n[e]=t:VB(e,t);else{try{r.unsafe?n[e]&&(i=!0):delete n[e]}catch{}i?n[e]=t:BB.f(n,e,{value:t,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return n},aI={},HB=Math.ceil,WB=Math.floor,KB=Math.trunc||function(n){var e=+n;return(e>0?WB:HB)(e)},GB=KB,qs=function(n){var e=+n;return e!==e||e===0?0:GB(e)},YB=qs,XB=Math.max,qB=Math.min,JB=function(n,e){var t=YB(n);return t<0?XB(t+e,0):qB(t,e)},ZB=qs,QB=Math.min,lI=function(n){return n>0?QB(ZB(n),9007199254740991):0},eU=lI,kd=function(n){return eU(n.length)},tU=nf,nU=JB,rU=kd,cI=function(n){return function(e,t,r){var i=tU(e),o=rU(i),s=nU(r,o),a;if(n&&t!=t){for(;o>s;)if(a=i[s++],a!=a)return!0}else for(;o>s;s++)if((n||s in i)&&i[s]===t)return n||s||0;return!n&&-1}},iU={includes:cI(!0),indexOf:cI(!1)},oU=Ut,yb=Qo,sU=nf,aU=iU.indexOf,lU=ub,dI=oU([].push),uI=function(n,e){var t=sU(n),r=0,i=[],o;for(o in t)!yb(lU,o)&&yb(t,o)&&dI(i,o);for(;e.length>r;)yb(t,o=e[r++])&&(~aU(i,o)||dI(i,o));return i},wb=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],cU=uI,dU=wb,uU=dU.concat("length","prototype");aI.f=Object.getOwnPropertyNames||function(n){return cU(n,uU)};var hI={};hI.f=Object.getOwnPropertySymbols;var hU=rf,pU=Ut,fU=aI,gU=hI,mU=Xs,yU=pU([].concat),wU=hU("Reflect","ownKeys")||function(n){var e=fU.f(mU(n)),t=gU.f;return t?yU(e,t(n)):e},pI=Qo,bU=wU,vU=Bw,SU=wl,xU=function(n,e,t){for(var r=bU(e),i=SU.f,o=vU.f,s=0;s<r.length;s++){var a=r[s];!pI(n,a)&&!(t&&pI(t,a))&&i(n,a,o(e,a))}},_U=Mn,kU=An,CU=/#|\.prototype\./,Cd=function(n,e){var t=EU[PU(n)];return t==MU?!0:t==IU?!1:kU(e)?_U(e):!!e},PU=Cd.normalize=function(n){return String(n).replace(CU,".").toLowerCase()},EU=Cd.data={},IU=Cd.NATIVE="N",MU=Cd.POLYFILL="P",AU=Cd,bb=Kn,TU=Bw.f,jU=ab,RU=sI,OU=Zw,DU=xU,LU=AU,vl=function(n,e){var t=n.target,r=n.global,i=n.stat,o,s,a,l,c,d;if(r?s=bb:i?s=bb[t]||OU(t,{}):s=(bb[t]||{}).prototype,s)for(a in e){if(c=e[a],n.dontCallGetSet?(d=TU(s,a),l=d&&d.value):l=s[a],o=LU(r?a:t+(i?".":"#")+a,n.forced),!o&&l!==void 0){if(typeof c==typeof l)continue;DU(c,l)}(n.sham||l&&l.sham)&&jU(c,"sham",!0),RU(s,a,c,n)}},fI={},zU=uI,NU=wb,FU=Object.keys||function(n){return zU(n,NU)},$U=Jo,BU=GE,UU=wl,VU=Xs,HU=nf,WU=FU;fI.f=$U&&!BU?Object.defineProperties:function(n,e){VU(n);for(var t=HU(e),r=WU(e),i=r.length,o=0,s;i>o;)UU.f(n,s=r[o++],t[s]);return n};var KU=rf,GU=KU("document","documentElement"),YU=Xs,XU=fI,gI=wb,qU=ub,JU=GU,ZU=HE,QU=eI,mI=">",yI="<",vb="prototype",Sb="script",wI=QU("IE_PROTO"),xb=function(){},bI=function(n){return yI+Sb+mI+n+yI+"/"+Sb+mI},vI=function(n){n.write(bI("")),n.close();var e=n.parentWindow.Object;return n=null,e},eV=function(){var n=ZU("iframe"),e="java"+Sb+":",t;return n.style.display="none",JU.appendChild(n),n.src=String(e),t=n.contentWindow.document,t.open(),t.write(bI("document.F=Object")),t.close(),t.F},uf,hf=function(){try{uf=new ActiveXObject("htmlfile")}catch{}hf=typeof document<"u"?document.domain&&uf?vI(uf):eV():vI(uf);for(var n=gI.length;n--;)delete hf[vb][gI[n]];return hf()};qU[wI]=!0;var SI=Object.create||function(n,e){var t;return n!==null?(xb[vb]=YU(n),t=new xb,xb[vb]=null,t[wI]=n):t=hf(),e===void 0?t:XU.f(t,e)},tV=oo,nV=SI,rV=wl.f,_b=tV("unscopables"),kb=Array.prototype;kb[_b]==null&&rV(kb,_b,{configurable:!0,value:nV(null)});var Cb=function(n){kb[_b][n]=!0},iV=vl,oV=xd,sV=kd,aV=qs,lV=Cb;iV({target:"Array",proto:!0},{at:function(n){var e=oV(this),t=sV(e),r=aV(n),i=r>=0?r:t+r;return i<0||i>=t?void 0:e[i]}}),lV("at");var cV=Kn,dV=Ut,Pd=function(n,e){return dV(cV[n].prototype[e])},uV=Pd;uV("Array","at");var hV=gl,xI=Array.isArray||function(n){return hV(n)=="Array"},pV=TypeError,fV=9007199254740991,gV=function(n){if(n>fV)throw pV("Maximum allowed index exceeded");return n},mV=gl,yV=Ut,_I=function(n){if(mV(n)==="Function")return yV(n)},kI=_I,wV=Gw,bV=Qp,vV=kI(kI.bind),SV=function(n,e){return wV(n),e===void 0?n:bV?vV(n,e):function(){return n.apply(e,arguments)}},xV=xI,_V=kd,kV=gV,CV=SV,CI=function(n,e,t,r,i,o,s,a){for(var l=i,c=0,d=s?CV(s,a):!1,u,h;c<r;)c in t&&(u=d?d(t[c],c,e):t[c],o>0&&xV(u)?(h=_V(u),l=CI(n,e,u,h,l,o-1)-1):(kV(l+1),n[l]=u),l++),c++;return l},PI=CI,PV=oo,EV=PV("toStringTag"),EI={};EI[EV]="z";var IV=String(EI)==="[object z]",MV=IV,AV=An,pf=gl,TV=oo,jV=TV("toStringTag"),RV=Object,OV=pf(function(){return arguments}())=="Arguments",DV=function(n,e){try{return n[e]}catch{}},II=MV?pf:function(n){var e,t,r;return n===void 0?"Undefined":n===null?"Null":typeof(t=DV(e=RV(n),jV))=="string"?t:OV?pf(e):(r=pf(e))=="Object"&&AV(e.callee)?"Arguments":r},LV=Ut,zV=Mn,MI=An,NV=II,FV=rf,$V=JE,AI=function(){},BV=[],TI=FV("Reflect","construct"),Pb=/^\s*(?:class|function)\b/,UV=LV(Pb.exec),VV=!Pb.exec(AI),Ed=function(n){if(!MI(n))return!1;try{return TI(AI,BV,n),!0}catch{return!1}},jI=function(n){if(!MI(n))return!1;switch(NV(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return VV||!!UV(Pb,$V(n))}catch{return!0}};jI.sham=!0;var HV=!TI||zV(function(){var n;return Ed(Ed.call)||!Ed(Object)||!Ed(function(){n=!0})||n})?jI:Ed,RI=xI,WV=HV,KV=Ys,GV=oo,YV=GV("species"),OI=Array,XV=function(n){var e;return RI(n)&&(e=n.constructor,WV(e)&&(e===OI||RI(e.prototype))?e=void 0:KV(e)&&(e=e[YV],e===null&&(e=void 0))),e===void 0?OI:e},qV=XV,DI=function(n,e){return new(qV(n))(e===0?0:e)},JV=vl,ZV=PI,QV=xd,eH=kd,tH=qs,nH=DI;JV({target:"Array",proto:!0},{flat:function(){var n=arguments.length?arguments[0]:void 0,e=QV(this),t=eH(e),r=nH(e,0);return r.length=ZV(r,e,e,t,0,n===void 0?1:tH(n)),r}});var rH=Cb;rH("flat");var iH=Pd;iH("Array","flat");var oH=vl,sH=PI,aH=Gw,lH=xd,cH=kd,dH=DI;oH({target:"Array",proto:!0},{flatMap:function(n){var e=lH(this),t=cH(e),r;return aH(n),r=dH(e,0),r.length=sH(r,e,e,t,0,1,n,arguments.length>1?arguments[1]:void 0),r}});var uH=Cb;uH("flatMap");var hH=Pd;hH("Array","flatMap");var pH=II,fH=String,Id=function(n){if(pH(n)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return fH(n)},gH=vl,mH=Ut,yH=ml,wH=qs,bH=Id,vH=Mn,SH=mH("".charAt),xH=vH(function(){return"\u{20BB7}".at(-2)!=="\uD842"});gH({target:"String",proto:!0,forced:xH},{at:function(n){var e=bH(yH(this)),t=e.length,r=wH(n),i=r>=0?r:t+r;return i<0||i>=t?void 0:SH(e,i)}});var _H=Pd;_H("String","at");var kH=Xs,LI=function(){var n=kH(this),e="";return n.hasIndices&&(e+="d"),n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.dotAll&&(e+="s"),n.unicode&&(e+="u"),n.unicodeSets&&(e+="v"),n.sticky&&(e+="y"),e},Eb=Mn,CH=Kn,Ib=CH.RegExp,Mb=Eb(function(){var n=Ib("a","y");return n.lastIndex=2,n.exec("abcd")!=null}),PH=Mb||Eb(function(){return!Ib("a","y").sticky}),EH=Mb||Eb(function(){var n=Ib("^r","gy");return n.lastIndex=2,n.exec("str")!=null}),IH={BROKEN_CARET:EH,MISSED_STICKY:PH,UNSUPPORTED_Y:Mb},MH=Mn,AH=Kn,TH=AH.RegExp,jH=MH(function(){var n=TH(".","s");return!(n.dotAll&&n.exec(`
`)&&n.flags==="s")}),RH=Mn,OH=Kn,DH=OH.RegExp,LH=RH(function(){var n=DH("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),Sl=Zo,ff=Ut,zH=Id,NH=LI,FH=IH,$H=eb,BH=SI,UH=rI.get,VH=jH,HH=LH,WH=$H("native-string-replace",String.prototype.replace),gf=RegExp.prototype.exec,Ab=gf,KH=ff("".charAt),GH=ff("".indexOf),YH=ff("".replace),Tb=ff("".slice),jb=function(){var n=/a/,e=/b*/g;return Sl(gf,n,"a"),Sl(gf,e,"a"),n.lastIndex!==0||e.lastIndex!==0}(),zI=FH.BROKEN_CARET,Rb=/()??/.exec("")[1]!==void 0,XH=jb||Rb||zI||VH||HH;XH&&(Ab=function(n){var e=this,t=UH(e),r=zH(n),i=t.raw,o,s,a,l,c,d,u;if(i)return i.lastIndex=e.lastIndex,o=Sl(Ab,i,r),e.lastIndex=i.lastIndex,o;var h=t.groups,p=zI&&e.sticky,m=Sl(NH,e),f=e.source,w=0,S=r;if(p&&(m=YH(m,"y",""),GH(m,"g")===-1&&(m+="g"),S=Tb(r,e.lastIndex),e.lastIndex>0&&(!e.multiline||e.multiline&&KH(r,e.lastIndex-1)!==`
`)&&(f="(?: "+f+")",S=" "+S,w++),s=new RegExp("^(?:"+f+")",m)),Rb&&(s=new RegExp("^"+f+"$(?!\\s)",m)),jb&&(a=e.lastIndex),l=Sl(gf,p?s:e,S),p?l?(l.input=Tb(l.input,w),l[0]=Tb(l[0],w),l.index=e.lastIndex,e.lastIndex+=l[0].length):e.lastIndex=0:jb&&l&&(e.lastIndex=e.global?l.index+l[0].length:a),Rb&&l&&l.length>1&&Sl(WH,l[0],s,function(){for(c=1;c<arguments.length-2;c++)arguments[c]===void 0&&(l[c]=void 0)}),l&&h)for(l.groups=d=BH(null),c=0;c<h.length;c++)u=h[c],d[u[0]]=l[u[1]];return l});var Ob=Ab,qH=vl,NI=Ob;qH({target:"RegExp",proto:!0,forced:/./.exec!==NI},{exec:NI});var JH=Qp,FI=Function.prototype,$I=FI.apply,BI=FI.call,ZH=typeof Reflect=="object"&&Reflect.apply||(JH?BI.bind($I):function(){return BI.apply($I,arguments)}),UI=_I,VI=sI,QH=Ob,HI=Mn,WI=oo,eW=ab,tW=WI("species"),Db=RegExp.prototype,nW=function(n,e,t,r){var i=WI(n),o=!HI(function(){var c={};return c[i]=function(){return 7},""[n](c)!=7}),s=o&&!HI(function(){var c=!1,d=/a/;return n==="split"&&(d={},d.constructor={},d.constructor[tW]=function(){return d},d.flags="",d[i]=/./[i]),d.exec=function(){return c=!0,null},d[i](""),!c});if(!o||!s||t){var a=UI(/./[i]),l=e(i,""[n],function(c,d,u,h,p){var m=UI(c),f=d.exec;return f===QH||f===Db.exec?o&&!p?{done:!0,value:a(d,u,h)}:{done:!0,value:m(u,d,h)}:{done:!1}});VI(String.prototype,n,l[0]),VI(Db,i,l[1])}r&&eW(Db[i],"sham",!0)},Lb=Ut,rW=qs,iW=Id,oW=ml,sW=Lb("".charAt),KI=Lb("".charCodeAt),aW=Lb("".slice),GI=function(n){return function(e,t){var r=iW(oW(e)),i=rW(t),o=r.length,s,a;return i<0||i>=o?n?"":void 0:(s=KI(r,i),s<55296||s>56319||i+1===o||(a=KI(r,i+1))<56320||a>57343?n?sW(r,i):s:n?aW(r,i,i+2):(s-55296<<10)+(a-56320)+65536)}},lW={codeAt:GI(!1),charAt:GI(!0)},cW=lW.charAt,dW=function(n,e,t){return e+(t?cW(n,e).length:1)},zb=Ut,uW=xd,hW=Math.floor,Nb=zb("".charAt),pW=zb("".replace),Fb=zb("".slice),fW=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,gW=/\$([$&'`]|\d{1,2})/g,YI=function(n,e,t,r,i,o){var s=t+n.length,a=r.length,l=gW;return i!==void 0&&(i=uW(i),l=fW),pW(o,l,function(c,d){var u;switch(Nb(d,0)){case"$":return"$";case"&":return n;case"`":return Fb(e,0,t);case"'":return Fb(e,s);case"<":u=i[Fb(d,1,-1)];break;default:var h=+d;if(h===0)return c;if(h>a){var p=hW(h/10);return p===0?c:p<=a?r[p-1]===void 0?Nb(d,1):r[p-1]+Nb(d,1):c}u=r[h-1]}return u===void 0?"":u})},XI=Zo,mW=Xs,yW=An,wW=gl,bW=Ob,vW=TypeError,SW=function(n,e){var t=n.exec;if(yW(t)){var r=XI(t,n,e);return r!==null&&mW(r),r}if(wW(n)==="RegExp")return XI(bW,n,e);throw vW("RegExp#exec called on incompatible receiver")},xW=ZH,qI=Zo,mf=Ut,_W=nW,kW=Mn,CW=Xs,PW=An,EW=tf,IW=qs,MW=lI,xl=Id,AW=ml,TW=dW,jW=Yw,RW=YI,OW=SW,DW=oo,$b=DW("replace"),LW=Math.max,zW=Math.min,NW=mf([].concat),Bb=mf([].push),JI=mf("".indexOf),ZI=mf("".slice),FW=function(n){return n===void 0?n:String(n)},$W=function(){return"a".replace(/./,"$0")==="$0"}(),QI=function(){return/./[$b]?/./[$b]("a","$0")==="":!1}(),BW=!kW(function(){var n=/./;return n.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(n,"$<a>")!=="7"});_W("replace",function(n,e,t){var r=QI?"$":"$0";return[function(i,o){var s=AW(this),a=EW(i)?void 0:jW(i,$b);return a?qI(a,i,s,o):qI(e,xl(s),i,o)},function(i,o){var s=CW(this),a=xl(i);if(typeof o=="string"&&JI(o,r)===-1&&JI(o,"$<")===-1){var l=t(e,s,a,o);if(l.done)return l.value}var c=PW(o);c||(o=xl(o));var d=s.global;if(d){var u=s.unicode;s.lastIndex=0}for(var h=[];;){var p=OW(s,a);if(p===null||(Bb(h,p),!d))break;var m=xl(p[0]);m===""&&(s.lastIndex=TW(a,MW(s.lastIndex),u))}for(var f="",w=0,S=0;S<h.length;S++){p=h[S];for(var b=xl(p[0]),_=LW(zW(IW(p.index),a.length),0),x=[],P=1;P<p.length;P++)Bb(x,FW(p[P]));var C=p.groups;if(c){var E=NW([b],x,_,a);C!==void 0&&Bb(E,C);var I=xl(xW(o,void 0,E))}else I=RW(b,a,_,x,C,o);_>=w&&(f+=ZI(a,w,_)+I,w=_+b.length)}return f+ZI(a,w)}]},!BW||!$W||QI);var UW=Ys,VW=gl,HW=oo,WW=HW("match"),KW=function(n){var e;return UW(n)&&((e=n[WW])!==void 0?!!e:VW(n)=="RegExp")},GW=Zo,YW=Qo,XW=kE,qW=LI,eM=RegExp.prototype,JW=function(n){var e=n.flags;return e===void 0&&!("flags"in eM)&&!YW(n,"flags")&&XW(eM,n)?GW(qW,n):e},ZW=vl,QW=Zo,Ub=Ut,tM=ml,eK=An,tK=tf,nK=KW,Md=Id,rK=Yw,iK=JW,oK=YI,sK=oo,aK=sK("replace"),lK=TypeError,nM=Ub("".indexOf);Ub("".replace);var rM=Ub("".slice),cK=Math.max,iM=function(n,e,t){return t>n.length?-1:e===""?t:nM(n,e,t)};ZW({target:"String",proto:!0},{replaceAll:function(n,e){var t=tM(this),r,i,o,s,a,l,c,d,u,h=0,p=0,m="";if(!tK(n)){if(r=nK(n),r&&(i=Md(tM(iK(n))),!~nM(i,"g")))throw lK("`.replaceAll` does not allow non-global regexes");if(o=rK(n,aK),o)return QW(o,n,t,e)}for(s=Md(t),a=Md(n),l=eK(e),l||(e=Md(e)),c=a.length,d=cK(1,c),h=iM(s,a,0);h!==-1;)u=l?Md(e(a,h,s)):oK(a,s,h,[],void 0,e),m+=rM(s,p,h)+u,p=h+c,h=iM(s,a,h+d);return p<s.length&&(m+=rM(s,p)),m}});var dK=Pd;dK("String","replaceAll");const uK=({children:n})=>{const e=G();return q("shouldDisplayHandles",()=>e.isInAny("select.idle","select.pointing_handle"),[e])?g.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null},hK=({shapeId:n})=>{const e=G();return q("show hovered",()=>e.isIn("select.editing_shape")?e.getHoveredShapeId()!==e.getEditingShapeId():e.isInAny("select.idle"),[e])?g.jsx(id,{className:"tl-user-indicator__hovered",id:n}):null},{PI:pK}=Math,_l=pK+1e-4;function oM(n,e={}){const{size:t=16,smoothing:r=.5}=e;if(n.length===0||t<=0)return{left:[],right:[]};const i=n[0],o=n[n.length-1],s=o.runningLength,a=Math.pow(t*r,2),l=[],c=[];let d=n[0].vector,u=n[0].point,h=u,p=u,m=h,f=!1,w;for(let S=0;S<n.length;S++){w=n[S];const{point:b,vector:_}=n[S],x=w.vector.dpr(d),P=(S<n.length-1?n[S+1]:n[S]).vector,C=S<n.length-1?P.dpr(w.vector):1,E=x<0&&!f,I=C!==null&&C<.2;if(E||I){if(C>-.62&&s-w.runningLength>w.radius){const T=d.clone().mul(w.radius);d.clone().cpr(P)<0?(p=k.Add(b,T),m=k.Sub(b,T)):(p=k.Sub(b,T),m=k.Add(b,T)),l.push(p),c.push(m)}else{const T=d.clone().mul(w.radius).per(),D=k.Sub(w.input,T);for(let F=1/13,H=0;H<1;H+=F)p=k.RotWith(D,w.input,_l*H),l.push(p),m=k.RotWith(D,w.input,_l+_l*-H),c.push(m)}u=p,h=m,I&&(f=!0);continue}if(f=!1,w===i||w===o){const T=k.Per(_).mul(w.radius);l.push(k.Sub(b,T)),c.push(k.Add(b,T));continue}const A=k.Lrp(P,_,C).per().mul(w.radius);p=k.Sub(b,A),(S<=1||k.Dist2(u,p)>a)&&(l.push(p),u=p),m=k.Add(b,A),(S<=1||k.Dist2(h,m)>a)&&(c.push(m),h=m),d=_}return{left:l,right:c}}function Ad(n,e={}){const{size:t=16,start:r={},end:i={},last:o=!1}=e,{cap:s=!0}=r,{cap:a=!0}=i;if(n.length===0||t<=0)return[];const l=n[0],c=n[n.length-1],d=c.runningLength,u=r.taper===!1?0:r.taper===!0?Math.max(t,d):r.taper,h=i.taper===!1?0:i.taper===!0?Math.max(t,d):i.taper,{left:p,right:m}=oM(n,e),f=l.point,w=n.length>1?n[n.length-1].point:k.AddXY(l.point,1,1);if(n.length===1&&(!(u||h)||o)){const x=k.Add(f,k.Sub(f,w).uni().per().mul(-l.radius)),P=[];for(let C=1/13,E=C;E<=1;E+=C)P.push(k.RotWith(x,f,_l*2*E));return P}const S=[];if(!(u||h&&n.length===1))if(s)for(let x=1/8,P=x;P<=1;P+=x){const C=k.RotWith(m[0],f,_l*P);S.push(C)}else{const x=k.Sub(p[0],m[0]),P=k.Mul(x,.5),C=k.Mul(x,.51);S.push(k.Sub(f,P),k.Sub(f,C),k.Add(f,C),k.Add(f,P))}const b=[],_=c.vector.clone().per().neg();if(h||u&&n.length===1)b.push(w);else if(a){const x=k.Add(w,k.Mul(_,c.radius));for(let P=1/29,C=P;C<1;C+=P)b.push(k.RotWith(x,w,_l*3*C))}else b.push(k.Add(w,k.Mul(_,c.radius)),k.Add(w,k.Mul(_,c.radius*.99)),k.Sub(w,k.Mul(_,c.radius*.99)),k.Sub(w,k.Mul(_,c.radius)));return p.concat(b,m.reverse(),S)}const fK=.025,gK=.01;function Jr(n,e={}){var w;const{streamline:t=.5,size:r=16,simulatePressure:i=!1}=e;if(n.length===0)return[];const o=.15+(1-t)*.85;let s=n.map(k.From),a=0;if(!i){let S=s[0];for(;S&&!(S.z>=fK);)s.shift(),S=s[0]}if(!i){let S=s[s.length-1];for(;S&&!(S.z>=gK);)s.pop(),S=s[s.length-1]}if(s.length===0)return[{point:k.From(n[0]),input:k.From(n[0]),pressure:i?.5:.15,vector:new k(1,1),distance:0,runningLength:0,radius:1}];let l=s[1];for(;l&&!(k.Dist(l,s[0])>r/3);)s[0].z=Math.max(s[0].z,l.z),s.splice(1,1),l=s[1];const c=s.pop();for(l=s[s.length-1];l&&!(k.Dist(l,c)>r/3);)s.pop(),l=s[s.length-1],a++;s.push(c);const d=e.last||!e.simulatePressure||s.length>1&&k.Dist(s[s.length-1],s[s.length-2])<r||a>0;if(s.length===2&&e.simulatePressure){const S=s[1];s=s.slice(0,-1);for(let b=1;b<5;b++){const _=k.Lrp(s[0],S,b/4);_.z=(s[0].z+(S.z-s[0].z))*b/4,s.push(_)}}const u=[{point:s[0],input:s[0],pressure:i?.5:s[0].z,vector:new k(1,1),distance:0,runningLength:0,radius:1}];let h=0,p=u[0],m,f;d&&t>0&&s.push(s[s.length-1].clone());for(let S=1,b=s.length;S<b;S++)m=!o||e.last&&S===b-1?s[S].clone():s[S].clone().lrp(p.point,1-o),!p.point.equals(m)&&(f=k.Dist(m,p.point),h+=f,!(S<4&&h<r)&&(p={input:s[S],point:m,pressure:i?.5:s[S].z,vector:k.Sub(p.point,m).uni(),distance:f,runningLength:h,radius:1},u.push(p)));if((w=u[1])!=null&&w.vector&&(u[0].vector=u[1].vector.clone()),h<1){const S=Math.max(.5,...u.map(b=>b.pressure));u.forEach(b=>b.pressure=S)}return u}const{min:es}=Math,Vb=.275;function kl(n,e){const{size:t=16,thinning:r=.5,simulatePressure:i=!0,easing:o=w=>w,start:s={},end:a={}}=e,{easing:l=pn.easeOutQuad}=s,{easing:c=pn.easeOutCubic}=a,d=n[n.length-1].runningLength;let u,h=n[0].pressure,p;if(!i&&d<t){const w=n.reduce((S,b)=>Math.max(S,b.pressure),.5);return n.forEach(S=>{S.pressure=w,S.radius=t*o(.5-r*(.5-S.pressure))}),n}else{let w;for(let S=0,b=n.length;S<b&&(p=n[S],!(p.runningLength>t*5));S++){const _=es(1,p.distance/t);if(i){const x=es(1,1-_);w=es(1,h+(x-h)*(_*Vb))}else w=es(1,h+(p.pressure-h)*.5);h=h+(w-h)*.5}for(let S=0;S<n.length;S++){if(p=n[S],r){let{pressure:b}=p;const _=es(1,p.distance/t);if(i){const x=es(1,1-_);b=es(1,h+(x-h)*(_*Vb))}else b=es(1,h+(b-h)*(_*Vb));p.radius=t*o(.5-r*(.5-b)),h=b}else p.radius=t/2;u===void 0&&(u=p.radius)}}const m=s.taper===!1?0:s.taper===!0?Math.max(t,d):s.taper,f=a.taper===!1?0:a.taper===!0?Math.max(t,d):a.taper;if(m||f)for(let w=0;w<n.length;w++){p=n[w];const{runningLength:S}=p,b=S<m?l(S/m):1,_=d-S<f?c((d-S)/f):1;p.radius=Math.max(.01,p.radius*Math.min(b,_))}return n}function mK(n,e={}){return Ad(kl(Jr(n,e),e),e)}const sM=({scribble:n,zoom:e,color:t,opacity:r,className:i})=>{if(!n.points.length)return null;const o=mK(n.points,{size:n.size/e,start:{taper:n.taper,easing:pn.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let s;if(o.length<4){const a=n.size/e/2,{x:l,y:c}=n.points[n.points.length-1];s=`M ${l-a},${c} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else s=ud(o);return g.jsx("svg",{className:i&&ye("tl-overlays__item",i),children:g.jsx("path",{className:"tl-scribble",d:s,fill:t??`var(--color-${n.color})`,opacity:r??n.opacity})})},yK=({bounds:n,rotation:e})=>{const t=G();return q("should display",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[t])?g.jsx(A2,{bounds:n,rotation:e}):null};function Ir(){const n=G();return q("isReadonlyMode",()=>n.getInstanceState().isReadonly,[n])}function wK({size:n,width:e,height:t,hideAlternateHandles:r}){const i=R(n/3),o=i/2;return g.jsxs("svg",{className:"tl-overlays__item",children:[g.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${R(0-o)},${R(n)} 
						${R(0-o)},${R(0-o)} 
						${R(n)},${R(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),g.jsx("line",{className:ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(e/2-n),y1:R(0-o),x2:R(e/2+n),y2:R(0-o),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),g.jsx("polyline",{className:ye("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${R(e-n)},${R(0-o)} 
						${R(e+o)},${R(0-o)} 
						${R(e+o)},${R(n)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),g.jsx("line",{className:ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(e+o),y1:R(t/2-n),x2:R(e+o),y2:R(t/2+n),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),g.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${R(e+o)},${R(t-n)} 
						${R(e+o)},${R(t+o)}
						${R(e-n)},${R(t+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),g.jsx("line",{className:ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(e/2-n),y1:R(t+o),x2:R(e/2+n),y2:R(t+o),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),g.jsx("polyline",{className:ye("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${R(0+n)},${R(t+o)} 
						${R(0-o)},${R(t+o)}
						${R(0-o)},${R(t-n)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),g.jsx("line",{className:ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(0-o),y1:R(t/2-n),x2:R(0-o),y2:R(t/2+n),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const bK=ze(function({bounds:n,rotation:e}){const t=G(),r=v.useRef(null),i=Ir(),o=Si("top"),s=Si("right"),a=Si("bottom"),l=Si("left"),c=Si("top_left"),d=Si("top_right"),u=Si("bottom_right"),h=Si("bottom_left"),p=!t.getIsMenuOpen()&&t.getInstanceState().cursor.type==="default",m=t.getInstanceState().isCoarsePointer,f=t.getOnlySelectedShape(),w=f&&t.isShapeOrAncestorLocked(f),S=f?t.getShapeUtil(f).expandSelectionOutlinePx(f):0;if(el(r,n==null?void 0:n.x,n==null?void 0:n.y,1,t.getSelectionRotation(),{x:-S,y:-S}),!n)return null;n=n.clone().expandBy(S).zeroFix();const b=t.getZoomLevel(),_=t.getInstanceState().isChangingStyle,x=n.width,P=n.height,C=8/b,E=x<C*2,I=P<C*2,A=x<C*4,T=P<C*4,D=x<C*5,F=P<C*5,H=m?1.75:1,O=6/b*H,K=(A?O/2:O)*(H*.75),B=(T?O/2:O)*(H*.75),te=(f?!t.getShapeUtil(f).hideSelectionBoundsFg(f):!0)&&!_;let W=te&&t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||te&&t.isIn("select.resizing")&&f&&t.isShapeOfType(f,"text");f&&W&&t.environment.isFirefox&&t.isShapeOfType(f,"embed")&&(W=!1);const N=t.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!_&&!i,Y=t.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!_&&!i,ee=!m&&!(E||I)&&(Y||N)&&(f?!t.getShapeUtil(f).hideRotateHandle(f):!0)&&!w,pe=m&&(!A||!T)&&(Y||N)&&(f?!t.getShapeUtil(f).hideRotateHandle(f):!0)&&!w,ve=Y&&(f?t.getShapeUtil(f).canResize(f)&&!t.getShapeUtil(f).hideResizeHandles(f):!0)&&!N&&!w,be=E||I,fe=E&&I,Ce=D||F,Rt=ve||N,Ue=!ee,Le=!Y||!pe,Ve=!Y||!Rt,si=!Y||!Rt||be,Xn=!Y||!Rt||be,mr=!Y||!Rt||fe&&!N;let Ot=m;Ot&&f&&f.type==="text"&&(Ot=!1);let Et=!0;N?Et=Ce:ve&&(Et=be||fe||Ot);const bo=Math.min(24/b,P-B*3),Eu=Y&&m&&f&&t.isShapeOfType(f,"text")&&bo*b>=4;return g.jsx("svg",{className:"tl-overlays__item tl-selection__fg tl-svg-context","data-testid":"selection-foreground",children:g.jsxs("g",{ref:r,children:[W&&g.jsx("rect",{className:ye("tl-selection__fg__outline"),width:R(x),height:R(P)}),g.jsx(yf,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:O,corner:"top_left_rotate",cursor:p?cr("nwse-rotate",e):void 0,isHidden:Ue}),g.jsx(yf,{"data-testid":"selection.rotate.top-right",cx:x+O*3,cy:0,targetSize:O,corner:"top_right_rotate",cursor:p?cr("nesw-rotate",e):void 0,isHidden:Ue}),g.jsx(yf,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:P+O*3,targetSize:O,corner:"bottom_left_rotate",cursor:p?cr("swne-rotate",e):void 0,isHidden:Ue}),g.jsx(yf,{"data-testid":"selection.rotate.bottom-right",cx:x+O*3,cy:P+O*3,targetSize:O,corner:"bottom_right_rotate",cursor:p?cr("senw-rotate",e):void 0,isHidden:Ue}),g.jsx(SK,{"data-testid":"selection.rotate.mobile",cx:A?-O*1.5:x/2,cy:A?P/2:-O*1.5,size:C,isHidden:Le}),g.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Et}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:R(0-(T?B*2:B)),width:R(x),height:R(Math.max(1,B*2)),style:p?{cursor:cr("ns-resize",e)}:void 0,...o}),g.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Et}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:R(x-(A?0:K)),y:0,height:R(P),width:R(Math.max(1,K*2)),style:p?{cursor:cr("ew-resize",e)}:void 0,...s}),g.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Et}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:R(P-(T?0:B)),width:R(x),height:R(Math.max(1,B*2)),style:p?{cursor:cr("ns-resize",e)}:void 0,...a}),g.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Et}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:R(0-(A?K*2:K)),y:0,height:R(P),width:R(Math.max(1,K*2)),style:p?{cursor:cr("ew-resize",e)}:void 0,...l}),g.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Ve}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:R(0-(A?K*2:K*1.5)),y:R(0-(T?B*2:B*1.5)),width:R(K*3),height:R(B*3),style:p?{cursor:cr("nwse-resize",e)}:void 0,...c}),g.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":si}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:R(x-(A?0:K*1.5)),y:R(0-(T?B*2:B*1.5)),width:R(K*3),height:R(B*3),style:p?{cursor:cr("nesw-resize",e)}:void 0,...d}),g.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":mr}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:R(x-(A?K:K*1.5)),y:R(P-(T?B:B*1.5)),width:R(K*3),height:R(B*3),style:p?{cursor:cr("nwse-resize",e)}:void 0,...u}),g.jsx("rect",{className:ye("tl-transparent",{"tl-hidden":Xn}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:R(0-(A?K*3:K*1.5)),y:R(P-(T?0:B*1.5)),width:R(K*3),height:R(B*3),style:p?{cursor:cr("nesw-resize",e)}:void 0,...h}),ve&&g.jsxs(g.Fragment,{children:[g.jsx("rect",{"data-testid":"selection.resize.top-left",className:ye("tl-corner-handle",{"tl-hidden":Ve}),"aria-label":"top_left handle",x:R(0-C/2),y:R(0-C/2),width:R(C),height:R(C)}),g.jsx("rect",{"data-testid":"selection.resize.top-right",className:ye("tl-corner-handle",{"tl-hidden":si}),"aria-label":"top_right handle",x:R(x-C/2),y:R(0-C/2),width:R(C),height:R(C)}),g.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:ye("tl-corner-handle",{"tl-hidden":mr}),"aria-label":"bottom_right handle",x:R(x-C/2),y:R(P-C/2),width:R(C),height:R(C)}),g.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:ye("tl-corner-handle",{"tl-hidden":Xn}),"aria-label":"bottom_left handle",x:R(0-C/2),y:R(P-C/2),width:R(C),height:R(C)})]}),Eu&&g.jsxs(g.Fragment,{children:[g.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:R(0-C/4),y:R(P/2-bo/2),rx:C/4,width:R(C/2),height:R(bo)}),g.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:C/4,x:R(x-C/4),y:R(P/2-bo/2),width:R(C/2),height:R(bo)})]}),N&&g.jsx(wK,{size:C,width:x,height:P,hideAlternateHandles:Ce})]})})}),yf=function({cx:n,cy:e,targetSize:t,corner:r,cursor:i,isHidden:o,"data-testid":s}){const a=Si(r);return g.jsx("rect",{className:ye("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":s,"aria-label":`${r} target`,pointerEvents:"all",x:R(n-t*3),y:R(e-t*3),width:R(Math.max(1,t*3)),height:R(Math.max(1,t*3)),cursor:i,...a})},vK=Math.sqrt(Math.PI),SK=function({cx:n,cy:e,size:t,isHidden:r,"data-testid":i}){const o=Si("mobile_rotate"),s=G(),a=q("zoom level",()=>s.getZoomLevel(),[s]),l=Math.max(14*(1/a),20/Math.max(1,a));return g.jsxs("g",{children:[g.jsx("circle",{"data-testid":i,pointerEvents:"all",className:ye("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:n,cy:e,r:l,...o}),g.jsx("circle",{className:ye("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:n,cy:e,r:t/vK})]})},Zt={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},mn={s:2,m:3.5,l:5,xl:10},ts={s:18,m:24,l:36,xl:44},Cl={s:18,m:22,l:26,xl:32},ns={s:18,m:20,l:24,xl:28},so={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};var aM={exports:{}};(function(n){(function(e,t){n.exports?n.exports=t():e.downscale=t()})(dt,function(){function e(I,S,b,_,x,P,C,E){var I=document.createElement("canvas");I.width=b,I.height=_;var A=I.getContext("2d");return A.mozImageSmoothingEnabled=!0,A.imageSmoothingQuality="high",A.webkitImageSmoothingEnabled=!0,A.msImageSmoothingEnabled=!0,A.imageSmoothingEnabled=!0,A.drawImage(S,x,P,C,E,0,0,b,_),I}function t(w){return w+.49<<0}function r(w,S,b,_,x,P,C){for(var E=new ImageData(S,b),I=new Int32Array(w.data.buffer),A=w.width,T=new Int32Array(E.data.buffer),D=E.width,F=S/P,H=b/C,O=t(1/F),K=t(1/H),B=O*K,te=0;te<E.height;te++)for(var W=0;W<D;W++){for(var N=_+t(W/F)+(x+t(te/H))*A,Y=0,ee=0,pe=0,ve=0,be=0;be<K;be++)for(var fe=0;fe<O;fe++){var Ce=I[N+fe+be*A];Y+=Ce<<24>>>24,ee+=Ce<<16>>>24,pe+=Ce<<8>>>24,ve+=Ce>>>24}Y=t(Y/B),ee=t(ee/B),pe=t(pe/B),ve=t(ve/B),T[W+te*D]=ve<<24|pe<<16|ee<<8|Y}return E}function i(w,S,b,_){var x=new Date,P={},C=x,E="01";return{mark:w?function(I){I=E+". "+(I||"..."),P[I]={"time (ms)":new Date-C},C=new Date,E=("0"+((E>>0)+1)).substr(-2)}:new Function,finish:w?function(){P[E+" TOTAL"]={"time (ms)":new Date-x},console.log("IMAGE SOURCE:",S),console.log("DOWNSCALE TO:",b+"x"+_),console.table(P)}:new Function}}function o(){var w=[],S=[],b=[],_=new Object;return{createSetter:function(x){if(!this.get(x)){var P=w.push(x)-1;return S.push(_),b.push([]),function(C){S[P]=C,b[P]=b[P].reduce(function(E,I){I(C)},[])}}},get:function(x,P){var C=w.indexOf(x);if(~C){if(S[C]===_){b[C].push(P);return}P(S[C])}},has:function(x){return!!~w.indexOf(x)}}}function s(w,S,b,_){w.width=b,w.height=_;var x=w.getContext("2d");return x.drawImage(S,0,0),x.getImageData(0,0,b,_)}function a(w,S){w.width=S.width,w.height=S.height;var b=w.getContext("2d");return b.putImageData(S,0,0),w}function l(w,S,T,D,x,P){var C=x,E=P,I=x/P;w===0&&(w=S*I>>0),S===0&&(S=w/I>>0);var A=w/S;A>I?P=x/A>>0:x=P*A>>0;var T=T||(C-x)/2>>0,D=D||(E-P)/2>>0;return{destWidth:w,destHeight:S,sourceX:T,sourceY:D,sourceWidth:x,sourceHeight:P}}function c(w,S,b){if(S.returnCanvas){b(w);return}if(S.returnBlob){w.toBlob(b,"image/"+(S.imageType||"jpeg"),S.quality||.85);return}var _=w.toDataURL("image/"+(S.imageType||"jpeg"),S.quality||.85);b(_)}function d(w,S){var b=new XMLHttpRequest;b.open("GET",w),b.responseType="arraybuffer",b.addEventListener("load",function(){S(this.response)}),b.send()}function u(w,S){w.complete?S():w.addEventListener("load",S)}function h(w,S){w.readyState>1?S():w.addEventListener("loadeddata",S)}function p(w){if(w instanceof File)return"File";if(w instanceof HTMLImageElement)return"HTMLImageElement";if(w instanceof HTMLVideoElement)return"HTMLVideoElement";if(typeof w=="string")return"URL"}function m(w){if(w.length<3)return new TypeError("3 arguments required, but only "+w.length+" present.");if(!p(w[0]))return new TypeError("First argument should be HTMLImageElement, HTMLVideoElement, File of String");if(typeof w[1]!="number")return new TypeError("Second argument should be a number");if(typeof w[2]!="number")return new TypeError("Third argument should be a number")}function f(w,S,b,_){var x=i(_&&_.debug||!1,w,S,b),P=m(arguments);if(P instanceof TypeError)return Promise.reject(P);_=_||{};var C,E=new Promise(function(H,O){C=H});f.canvas=f.canvas||document.createElement("canvas"),f.cache=f.cache||o();var I=f.canvas,A=f.cache;if(A.has(w))return x.mark(),A.get(w,function(H){x.mark("PENDING CACHE");var O=H[0],K=H[1],B=l(S,b,_.sourceX,_.sourceY,K.width,K.height);if(B.sourceWidth/B.destWidth>=2&&B.sourceHeight/B.destHeight>=2){x.mark();var te=r(K,B.destWidth,B.destHeight,B.sourceX,B.sourceY,B.sourceWidth,B.sourceHeight);x.mark("DOWNSCALE"),I=a(I,te)}else I=e(I,O,B.destWidth,B.destHeight,B.sourceX,B.sourceY,B.sourceWidth,B.sourceHeight),x.mark("RESIZE WITH CANVAS");c(I,_,function(W){x.mark("PRODUCE RESULT"),C(W),x.finish()})}),E;var T=function(H,O,K){var B=l(S,b,_.sourceX,_.sourceY,O,K);if(B.sourceWidth/B.destWidth>=2&&B.sourceHeight/B.destHeight>=2){x.mark();var te=s(I,H,O,K);x.mark("GET IMAGE DATA");var W=r(te,B.destWidth,B.destHeight,B.sourceX,B.sourceY,B.sourceWidth,B.sourceHeight);x.mark("DOWNSCALE"),I=a(I,W),p(H)!=="HTMLVideoElement"&&A.createSetter(H)([H,te])}else I=e(I,H,B.destWidth,B.destHeight,B.sourceX,B.sourceY,B.sourceWidth,B.sourceHeight),x.mark("RESIZE WITH CANVAS");c(I,_,function(N){x.mark("PRODUCE RESULT"),C(N),x.finish()})},D=window.URL||window.webkitURL;switch(p(w)){case"File":var F=document.createElement("img");x.mark(),F.src=D.createObjectURL(w),x.mark("READ FILE"),u(F,function(){x.mark("LOAD IMAGE"),T(F,F.naturalWidth,F.naturalHeight)});break;case"HTMLImageElement":x.mark(),u(w,function(){x.mark("LOAD IMAGE"),T(w,w.naturalWidth,w.naturalHeight)});break;case"HTMLVideoElement":h(w,function(){T(w,w.videoWidth,w.videoHeight)});break;case"URL":x.mark(),setTimeout(function(){d(w,function(H){x.mark("LOAD ARRAY BUFFER");var O=new Uint8Array(H),K=new Blob([O],{type:"image/jpeg"}),B=document.createElement("img");B.src=D.createObjectURL(K),x.mark(),u(B,function(){x.mark("LOAD IMAGE"),T(B,B.naturalWidth,B.naturalHeight)})})});break}return E}return f})})(aM);var xK=aM.exports;const _K=qn(xK);function kK(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,o,s,a=[],l=!0,c=!1;try{if(o=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(r=o.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(d){c=!0,i=d}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}function lM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function dr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?lM(Object(t),!0).forEach(function(r){CK(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):lM(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function CK(n,e,t){return e=OK(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function PK(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function EK(n,e){if(n==null)return{};var t=PK(n,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function cM(n,e){return MK(n)||kK(n,e)||dM(n,e)||jK()}function wf(n){return IK(n)||AK(n)||dM(n)||TK()}function IK(n){if(Array.isArray(n))return Hb(n)}function MK(n){if(Array.isArray(n))return n}function AK(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function dM(n,e){if(n){if(typeof n=="string")return Hb(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Hb(n,e)}}function Hb(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function TK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RK(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function OK(n){var e=RK(n,"string");return typeof e=="symbol"?e:String(e)}function Td(n){var e=n.sizes.shift(),t=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),i=[t-1,r-1,1,1],o=Date.now(),s=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,l;s?(a=new OffscreenCanvas(1,1),l=new OffscreenCanvas(t,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,l=document.createElement("canvas"),l.width=t,l.height=r);var c=a.getContext("2d"),d=l.getContext("2d");d&&(d.fillRect.apply(d,i),c.drawImage(l,t-1,r-1,1,1,0,0,1,1));var u=c&&c.getImageData(0,0,1,1).data[3]!==0,h=Date.now()-o;return[a,l].forEach(function(p){p.height=0,p.width=0}),s?(postMessage({width:t,height:r,benchmark:h,isTestPass:u}),!u&&n.sizes.length&&Td(n)):u?n.onSuccess(t,r,h):(n.onError(t,r,h),n.sizes.length&&Td(n)),u}var Wb={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},DK=["onError","onSuccess"],Pl={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},jd={};function Kb(n){var e=n.width===n.height,t=n.height===1,r=n.width===1,i=[];if(!n.width||!n.height)n.sizes.forEach(function(d){var u=e||t?d:1,h=e||r?d:1;i.push([u,h])});else for(var o=n.min||Pl.min,s=n.step||Pl.step,a=Math.max(n.width,n.height);a>=o;){var l=e||t?a:1,c=e||r?a:1;i.push([l,c]),a-=s}return i}function bf(n){var e=window&&"HTMLCanvasElement"in window,t=window&&"OffscreenCanvas"in window,r=Date.now(),i=n.onError,o=n.onSuccess,s=EK(n,DK),a=null;if(!e)return!1;if(n.useWorker&&t){var l=`
            var canvasTest = `.concat(Td.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),c=new Blob([l],{type:"application/javascript"}),d=URL.createObjectURL(c);a=new Worker(d),URL.revokeObjectURL(d),a.onmessage=function(u){var h=u.data,p=h.width,m=h.height,f=h.benchmark,w=h.isTestPass;w?(jd[r].onSuccess(p,m,f),delete jd[r]):jd[r].onError(p,m,f)}}if(n.usePromise)return new Promise(function(u,h){var p=dr(dr({},n),{},{onError:function(w,S,b){var _;if(n.sizes.length===0)_=!0;else{var x=n.sizes.slice(-1),P=cM(x,1),C=cM(P[0],2),E=C[0],I=C[1];_=w===E&&S===I}i(w,S,b),_&&h({width:w,height:S,benchmark:b})},onSuccess:function(w,S,b){o(w,S,b),u({width:w,height:S,benchmark:b})}});if(a){var m=p.onError,f=p.onSuccess;jd[r]={onError:m,onSuccess:f},a.postMessage(s)}else Td(p)});if(a)jd[r]={onError:i,onSuccess:o},a.postMessage(s);else return Td(n)}var Gb={maxArea:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Kb({width:n.max,height:n.max,min:n.min,step:n.step,sizes:wf(Wb.area)}),t=dr(dr(dr({},Pl),n),{},{sizes:e});return bf(t)},maxHeight:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Kb({width:1,height:n.max,min:n.min,step:n.step,sizes:wf(Wb.height)}),t=dr(dr(dr({},Pl),n),{},{sizes:e});return bf(t)},maxWidth:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Kb({width:n.max,height:1,min:n.min,step:n.step,sizes:wf(Wb.width)}),t=dr(dr(dr({},Pl),n),{},{sizes:e});return bf(t)},test:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=dr(dr({},Pl),n);return e.sizes=wf(e.sizes),e.width&&e.height&&(e.sizes=[[e.width,e.height]]),bf(e)}};let Yb=null;function uM(){return Yb||(Yb=LK()),Yb}async function LK(){const n=await Gb.maxWidth({usePromise:!0}),e=await Gb.maxHeight({usePromise:!0}),t=await Gb.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:e.height,maxArea:t.width*t.height}}function hM(n,e){let t=0;for(;n[e+t];)t+=n[e+t]+1;return t+1}function zK(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function NK(n){const e=new Uint8Array(n);let t,r,i=0,o=0;if(!zK(n))return!1;for(t=e[10]&128,r=e[10]&7,i+=6,i+=7,i+=t?3*Math.pow(2,r+1):0;o<2&&i<e.length;)switch(e[i]){case 44:o+=1,t=e[i+9]&128,r=e[i+9]&7,i+=10,i+=t?3*Math.pow(2,r+1):0,i+=hM(e,i+1)+1;break;case 33:i+=2,i+=hM(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return o>1}function FK(n,e){const t=n.w/e.w,r=n.h/e.h;return t<=1&&r<=1?n:t>r?{w:n.w/t,h:n.h/t}:{w:n.w/r,h:n.h/r}}async function $K(n,e,t,r={}){let i=e*2,o=t*2;const{type:s="image/jpeg",quality:a=.92}=r,l=await uM(),c=e/t;if(i>l.maxWidth&&(i=l.maxWidth,o=i/c),o>l.maxHeight&&(o=l.maxHeight,i=o*c),i*o>l.maxArea){const d=Math.sqrt(l.maxArea/(i*o));i*=d,o*=d}return await _K(n,i,o,{imageType:s.replace("image/",""),quality:a})}async function BK(n){return await new Promise((e,t)=>{const r=new FileReader;r.onerror=()=>t(r.error),r.onload=()=>{e(r.result?NK(r.result):!1)},r.readAsArrayBuffer(n)})}function UK(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function VK(n){const e=new URL(n).host.replace("www.","");for(const t of Za)if(pM(t.hostnames,e)){const r=t.fromEmbedUrl(n);if(r)return{definition:t,url:r,embedUrl:n}}}const HK=n=>n.split("*").map(e=>UK(e)).join(".+"),pM=(n,e)=>!!n.find(t=>{const r=new RegExp(HK(t));return e.match(r)});function WK(n){const e=new URL(n).host.replace("www.","");for(const t of Za)if(pM(t.hostnames,e)){const r=t.toEmbedUrl(n);if(r)return{definition:t,embedUrl:r,url:n}}}function fM(n){return WK(n)??VK(n)}function ao(n){try{return fM(n)}catch(e){console.error(e)}}const El="  ",Rn=class Rn{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const r=e.ownerDocument,i=r.activeElement;i!==e&&e.focus(),r.execCommand("insertText",!1,t)||Rn.insertTextFirefox(e,t),i===r.body?e.blur():i instanceof HTMLElement&&i!==e&&i.focus()}static set(e,t){e.select(),Rn.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:r}=e;return e.value.slice(t||void 0,r||void 0)}static wrapSelection(e,t,r){const{selectionStart:i,selectionEnd:o}=e,s=Rn.getSelection(e);Rn.insert(e,t+s+(r??t)),e.selectionStart=(i||0)+t.length,e.selectionEnd=(o||0)+t.length}static replace(e,t,r){let i=0;e.value.replace(t,(...o)=>{const s=i+o[o.length-2],a=o[0].length;e.selectionStart=s,e.selectionEnd=s+a;const l=typeof r=="string"?r:r(...o);return Rn.insert(e,l),e.selectionStart=s,i+=l.length-a,l})}static findLineEnd(e,t){const r=e.lastIndexOf(`
`,t-1)+1;return e.charAt(r)!=="	"?t:r+1}static indent(e){var a;const{selectionStart:t,selectionEnd:r,value:i}=e,o=i.slice(t,r),s=(a=/\n/g.exec(o))==null?void 0:a.length;if(s&&s>0){const l=i.lastIndexOf(`
`,t-1)+1,c=e.value.slice(l,r-1),d=c.replace(/^|\n/g,`$&${El}`),u=d.length-c.length;e.setSelectionRange(l,r-1),Rn.insert(e,d),e.setSelectionRange(t+1,r+u)}else Rn.insert(e,El)}static unindent(e){const{selectionStart:t,selectionEnd:r,value:i}=e,o=i.lastIndexOf(`
`,t-1)+1,s=Rn.findLineEnd(i,r),a=e.value.slice(o,s),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=a.length-l.length;e.setSelectionRange(o,s),Rn.insert(e,l);const d=/\t| {1,2}/.exec(i.slice(o,t)),u=d?d[0].length:0,h=t-u;e.setSelectionRange(t-u,Math.max(h,r-c))}static indentCE(e){var l;const t=window.getSelection(),r=e.innerText,i=vf(e)??0,o=vf(e)??0,s=r.slice(i,o),a=(l=/\n/g.exec(s))==null?void 0:l.length;if(a&&a>0){const c=r.lastIndexOf(`
`,i-1)+1,d=r.slice(c,o-1),u=d.replace(/^|\n/g,`$&${El}`).length-d.length;t&&t.setBaseAndExtent(e,i+1,e,o+u)}else{const c=window.getSelection();e.innerText=r.slice(0,i)+El+r.slice(i),c==null||c.setBaseAndExtent(e,i+1,e,i+2)}}static unindentCE(e){const t=window.getSelection(),r=e.innerText,i=vf(e)??0,o=vf(e)??0,s=r.lastIndexOf(`
`,i-1)+1,a=Rn.findLineEnd(r,o),l=r.slice(s,a),c=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=l.length-c.length;if(t){t.setBaseAndExtent(e,s,e,a);const u=/\t| {1,2}/.exec(r.slice(s,i)),h=u?u[0].length:0,p=i-h;t.setBaseAndExtent(e,i-h,e,Math.max(p,o-d))}}static normalizeText(e){return e.replace(Rn.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(Rn.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}};y(Rn,"fixNewLines",/\r?\n|\r/g);let rs=Rn;function vf(n){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let t=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(n),i.setEnd(r.endContainer,r.endOffset),t=i.toString().length}return t}const KK=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function GK(n){return KK.test(n)}function YK(n){return n.replace(/\t/g,El)}function XK(n){const e=n.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const r of e)if(r.trim().length>0){const i=r.length-r.trimStart().length;t=Math.min(t,i)}return e.map(r=>r.slice(t)).join(`
`)}function qK(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function JK(n){return qK(XK(YK(n)))}const Rd=(n,e)=>n.length<=e?n:n.substring(0,e-3)+"...";function ZK(n,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i}){n.registerExternalAssetHandler("file",async({file:o})=>await new Promise((s,a)=>{!r.includes(o.type)&&!i.includes(o.type)&&(console.warn(`File type not allowed: ${o.type}`),a()),o.size>t&&(console.warn(`File size too big: ${(o.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`),a());const l=new FileReader;l.onerror=()=>a(l.error),l.onload=async()=>{let c=l.result;o.type==="video/quicktime"&&c.includes("video/quicktime")&&(c=c.replace("video/quicktime","video/mp4"));const d=r.includes(o.type);let u,h;if(d?(u=await LC.getImageSizeFromSrc(c),h=o.type==="image/gif"&&await BK(o)):(h=!0,u=await LC.getVideoSizeFromSrc(c)),isFinite(e)){const f=FK(u,{w:e,h:e});u!==f&&(o.type==="image/jpeg"||o.type==="image/png")&&(u=f)}(o.type==="image/jpeg"||o.type==="image/png")&&(c=await $K(c,u.w,u.h,{type:o.type,quality:.92}));const p=Ns.createId(Zh(c)),m=Ns.create({id:p,type:d?"image":"video",typeName:"asset",props:{name:o.name,src:c,w:u.w,h:u.h,mimeType:o.type,isAnimated:h}});s(m)},l.readAsDataURL(o)})),n.registerExternalAssetHandler("url",async({url:o})=>{var a,l,c;let s;try{const d=await(await fetch(o,{method:"GET",mode:"no-cors"})).text(),u=new DOMParser().parseFromString(d,"text/html");s={image:((a=u.head.querySelector('meta[property="og:image"]'))==null?void 0:a.getAttribute("content"))??"",title:((l=u.head.querySelector('meta[property="og:title"]'))==null?void 0:l.getAttribute("content"))??Rd(o,32),description:((c=u.head.querySelector('meta[property="og:description"]'))==null?void 0:c.getAttribute("content"))??""}}catch(d){console.error(d),s={image:"",title:Rd(o,32),description:""}}return{id:Ns.createId(Zh(o)),typeName:"asset",type:"bookmark",props:{src:o,description:s.description,image:s.image,title:s.title},meta:{}}}),n.registerExternalContentHandler("svg-text",async({point:o,text:s})=>{const a=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),l=new DOMParser().parseFromString(s,"image/svg+xml").querySelector("svg");if(!l)throw new Error("No <svg/> element present");let c=parseFloat(l.getAttribute("width")||"0"),d=parseFloat(l.getAttribute("height")||"0");if(!(c&&d)){document.body.appendChild(l);const h=l.getBoundingClientRect();document.body.removeChild(l),c=h.width,d=h.height}const u=await n.getAssetForExternalContent({type:"file",file:new File([s],"asset.svg",{type:"image/svg+xml"})});if(!u)throw Error("Could not create an asset");gM(n,[u],a)}),n.registerExternalContentHandler("embed",({point:o,url:s,embed:a})=>{const l=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),{width:c,height:d}=a,u=tt(),h={id:u,type:"embed",x:l.x-(c||450)/2,y:l.y-(d||450)/2,props:{w:c,h:d,url:s}};n.createShapes([h]).select(u)}),n.registerExternalContentHandler("files",async({point:o,files:s})=>{const a=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),l=new k(a.x,a.y),c=[];await Promise.all(s.map(async(d,u)=>{if(d.size>t)return console.warn(`File size too big: ${(d.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`),null;if(!d.type)throw new Error("No mime type");if(!r.concat(i).includes(d.type))return console.warn(`${d.name} not loaded - Extension not allowed.`),null;try{const h=await n.getAssetForExternalContent({type:"file",file:d});if(!h)throw Error("Could not create an asset");c[u]=h}catch(h){return console.error(h),null}})),gM(n,me(c),l)}),n.registerExternalContentHandler("text",async({point:o,text:s})=>{const a=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),l=n.getShapeUtil("text").getDefaultProps(),c=JK(s);let d,u,h,p="middle";const m=c.split(`
`).length>1,f=GK(c);m&&(p=m?f?"end":"start":"middle");const w=n.textMeasure.measureText(c,{...Zt,fontFamily:so[l.font],fontSize:ts[l.size],maxWidth:null}),S=Math.min(m?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(w.w>S){const b=n.textMeasure.measureText(c,{...Zt,fontFamily:so[l.font],fontSize:ts[l.size],maxWidth:S});d=b.w,u=b.h,h=!1,p=f?"end":"start"}else d=w.w,u=w.h,h=!0;a.y-u/2<n.getViewportPageBounds().minY+40&&(a.y=n.getViewportPageBounds().minY+40+u/2),n.createShapes([{id:tt(),type:"text",x:a.x-d/2,y:a.y-u/2,props:{text:c,align:p,autoSize:h,w:d}}])}),n.registerExternalContentHandler("url",async({point:o,url:s})=>{const a=ao(s);if(a)return n.putExternalContent({type:"embed",url:a.url,point:o,embed:a.definition});const l=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),c=Ns.createId(Zh(s)),d=QK(n,s,l);let u=n.getAsset(c),h=!1;if(!u){h=!0;const p=await n.getAssetForExternalContent({type:"url",url:s});if(!p)throw Error("Could not create an asset");u=p}n.batch(()=>{h&&n.createAssets([u]),n.updateShapes([{id:d.id,type:d.type,props:{assetId:u.id}}])})})}async function gM(n,e,t){if(!e.length)return[];const r=k.From(t),i=[];for(const o of e)switch(o.type){case"bookmark":{i.push({id:tt(),type:"bookmark",x:r.x-150,y:r.y-160,opacity:1,props:{assetId:o.id,url:o.props.src}}),r.x+=300;break}case"image":{i.push({id:tt(),type:"image",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break}case"video":i.push({id:tt(),type:"video",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}return n.batch(()=>{const o=e.filter(s=>!n.getAsset(s.id));o.length&&n.createAssets(o),n.createShapes(i).select(...i.map(s=>s.id)),mM(n,t)}),i.map(o=>o.id)}function mM(n,e){const t=n.getViewportPageBounds();let r=n.getSelectionPageBounds();if(r){const i=r.center.sub(e);n.updateShapes(n.getSelectedShapes().map(o=>{const s=n.getShapeParentTransform(o).decompose().rotation,a=k.Rot(i,-s);return{id:o.id,type:o.type,x:o.x-a.x,y:o.y-a.y}}))}r=n.getSelectionPageBounds(),r&&!t.contains(r)&&n.zoomToSelection()}function QK(n,e,t){const r={id:tt(),type:"bookmark",x:t.x-150,y:t.y-160,opacity:1,props:{assetId:null,url:e}};return n.batch(()=>{n.createShapes([r]).select(r.id),mM(n,t)}),n.getShape(r.id)}let eG=(vS=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")});y(this,"onKeyUp",e=>{var t;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}})}},y(vS,"id","idle"),vS),tG=(SS=class extends ae{constructor(){super(...arguments);y(this,"shape");y(this,"markId","");y(this,"onEnter",()=>{this.didTimeout=!1;const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:t=>!t.isLocked&&this.editor.getShapeUtil(t).canBind(t),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()});y(this,"onExit",()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()});y(this,"onPointerMove",()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:this.editor.getShapeHandles(this.shape).find(e=>e.id==="end"),isCreating:!0,onInteractionEnd:"arrow"})}});y(this,"onPointerUp",()=>{this.cancel()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()});y(this,"preciseTimeout",-1);y(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var c,d;const{originPagePoint:e}=this.editor.inputs,t=tt();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"arrow",x:e.x,y:e.y}]);const r=this.editor.getShape(t);if(!r)throw Error("expected shape");const i=this.editor.getShapeHandles(r);if(!i)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),s=this.shape,a=i.find(u=>u.id==="start"),l=(c=o.onHandleChange)==null?void 0:c.call(o,r,{handle:{...a,x:0,y:0},isPrecise:!0,initial:s});if(l){const u=(d=l.props)==null?void 0:d.start;(u==null?void 0:u.type)==="binding"&&this.editor.setHintingShapes([u.boundShapeId]),this.editor.updateShapes([l],{squashing:!0})}this.shape=this.editor.getShape(t),this.editor.select(t)}updateArrowShapeEndHandle(){var i,o,s;const e=this.shape;if(!e)throw Error("expected shape");const t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");const r={...e,props:{...e.props,end:{...e.props.end,x:0,y:0}}};{const a=this.editor.getShapeUtil("arrow"),l=this.shape,c=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),d=t.find(h=>h.id==="end"),u=(i=a.onHandleChange)==null?void 0:i.call(a,r,{handle:{...d,x:c.x,y:c.y},isPrecise:!1,initial:l});if(u){const h=(o=u.props)==null?void 0:o.end;(h==null?void 0:h.type)==="binding"&&this.editor.setHintingShapes([h.boundShapeId]),this.editor.updateShapes([u],{squashing:!0})}}{const a=this.editor.getShapeUtil("arrow"),l=this.shape,c=t.find(u=>u.id==="start"),d=(s=a.onHandleChange)==null?void 0:s.call(a,r,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:l});d&&this.editor.updateShapes([d],{squashing:!0})}this.shape=this.editor.getShape(e.id)}startPreciseTimeout(){this.preciseTimeout=window.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},y(SS,"id","pointing"),SS);class Sf extends ae{constructor(){super(...arguments);y(this,"shapeType","arrow")}}y(Sf,"id","arrow"),y(Sf,"initial","idle"),y(Sf,"children",()=>[eG,tG]);class Xb extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"initialShape");y(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");y(this,"util",this.editor.getShapeUtil(this.shapeType));y(this,"isPen",!1);y(this,"segmentMode","free");y(this,"didJustShiftClickToExtendPreviousShapeLine",!1);y(this,"pagePointWhereCurrentSegmentChanged",{});y(this,"pagePointWhereNextSegmentChanged",null);y(this,"lastRecordedPoint",{});y(this,"mergeNextPoint",!1);y(this,"currentLineLength",0);y(this,"canDraw",!1);y(this,"markId",null);y(this,"onEnter",t=>{this.markId=null,this.info=t,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()});y(this,"onPointerMove",()=>{const{editor:{inputs:t}}=this;if(this.isPen!==t.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&t.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(t.isPen?k.Dist(t.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=t.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateShapes())});y(this,"onKeyDown",t=>{if(t.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateShapes()});y(this,"onKeyUp",t=>{if(t.key==="Shift")switch(this.editor.snaps.clear(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateShapes()});y(this,"onExit",()=>{this.editor.snaps.clear(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())})}canClose(){return this.shapeType!=="highlight"}getIsClosed(t,r){if(!this.canClose())return!1;const i=mn[r],o=t[0].points[0],s=t[t.length-1],a=s.points[s.points.length-1];return o!==a&&this.currentLineLength>i*4&&k.Dist(o,a)<i*2}startShape(){const{inputs:{originPagePoint:t,isPen:r}}=this.editor;this.markId="draw start "+qe(),this.editor.mark(this.markId),this.isPen=r;const i=this.isPen?this.info.point.z*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=t.clone(),this.initialShape){const s=this.editor.getShape(this.initialShape.id);if(s&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const a=Fn(s.props.segments);if(!a)throw Error("Expected a previous segment!");const l=Fn(a.points);if(!l)throw Error("Expected a previous point!");const{x:c,y:d}=this.editor.getPointInShapeSpace(s,t).toFixed(),u=this.isPen?this.info.point.z*1.25:.5,h={type:this.segmentMode,points:[{x:l.x,y:l.y,z:+u.toFixed(2)},{x:c,y:d,z:+u.toFixed(2)}]},p=oe.applyToPoint(this.editor.getShapePageTransform(s.id),l);this.pagePointWhereCurrentSegmentChanged=p,this.pagePointWhereNextSegmentChanged=null;const m=[...s.props.segments,h];this.currentLineLength=this.getLineLength(m);const f={id:s.id,type:this.shapeType,props:{segments:m}};this.canClose()&&(f.props.isClosed=this.getIsClosed(m,s.props.size)),this.editor.updateShapes([f]);return}}this.pagePointWhereCurrentSegmentChanged=t.clone();const o=tt();this.editor.createShapes([{id:o,type:this.shapeType,x:t.x,y:t.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+i.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateShapes(){const{inputs:t}=this.editor,{initialShape:r}=this;if(!r)return;const{id:i,props:{size:o}}=r,s=this.editor.getShape(i);if(!s)return;const{segments:a}=s.props,{x:l,y:c,z:d}=this.editor.getPointInShapeSpace(s,t.currentPagePoint).toFixed(),u={x:l,y:c,z:this.isPen?+(d*1.25).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:h}=this;if(h===null)throw Error("We should have a point where the segment changed");if(k.Dist(h,t.currentPagePoint)>dd){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const p=Fn(a);if(!p)throw Error("Expected a previous segment!");const m=Fn(p.points);if(!m)throw Error("Expected a previous last point!");let f;const w=this.editor.getPointInShapeSpace(s,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(p.type==="straight"){this.currentLineLength+=k.Dist(m,w),f={type:"straight",points:[{...m},w]};const b=this.editor.getShapePageTransform(s);this.pagePointWhereCurrentSegmentChanged=oe.applyToPoint(b,m)}else f={type:"straight",points:[w,u]};const S={id:i,type:this.shapeType,props:{segments:[...a,f]}};this.canClose()&&(S.props.isClosed=this.getIsClosed(a,o)),this.editor.updateShapes([S],{squashing:!0})}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:h}=this;if(h===null)throw Error("We should have a point where the segment changed");if(k.Dist(h,t.currentPagePoint)>dd){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const p=a.slice(),m=p[p.length-1],f=Fn(m.points);if(!f)throw Error("No previous point!");const w={type:"free",points:[...k.PointsBetween(f,u,6).map(_=>_.toFixed().toJson())]},S=[...p,w];this.currentLineLength=this.getLineLength(S);const b={id:i,type:this.shapeType,props:{segments:S}};this.canClose()&&(b.props.isClosed=this.getIsClosed(S,o)),this.editor.updateShapes([b],{squashing:!0})}break}case"straight":{const h=a.slice(),p=h[h.length-1],{pagePointWhereCurrentSegmentChanged:m}=this,{currentPagePoint:f,ctrlKey:w}=this.editor.inputs;if(!m)throw Error("We should have a point where the segment changed");let S,b=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(b=!w,this.didJustShiftClickToExtendPreviousShapeLine=!1):b=!w;let _=this.editor.getPointInShapeSpace(s,f).toFixed().toJson(),x=!1,P;if((this.editor.user.getIsSnapMode()?!w:w)&&h.length>2){let E,I=8/this.editor.getZoomLevel();for(let A=0,T=a.length-2;A<T;A++){const D=a[A];if(!D)break;if(D.type==="free")continue;const F=D.points[0],H=Fn(D.points);if(!(F&&H))continue;const O=k.NearestPointOnLineSegment(F,H,_),K=k.Dist(O,_);if(K<I){E=O.toFixed().toJson(),I=K,P=D;break}}E&&(x=!0,_=E)}if(x&&P){const E=this.editor.getShapePageTransform(s),I=P.points[0],A=Fn(P.points);if(!A)throw Error("Expected a last point!");const T=oe.applyToPoint(E,I),D=oe.applyToPoint(E,A),F=oe.applyToPoint(E,_);this.editor.snaps.setLines([{id:qe(),type:"points",points:[T,F,D]}])}else{if(this.editor.snaps.clear(),b){const E=k.Angle(m,f),I=Sp(E,24)-E;S=k.RotWith(f,m,I)}else S=f;_=this.editor.getPointInShapeSpace(s,S).toFixed().toJson()}this.currentLineLength+=k.Dist(p.points[0],_),h[h.length-1]={...p,type:"straight",points:[p.points[0],_]};const C={id:i,type:this.shapeType,props:{segments:h}};this.canClose()&&(C.props.isClosed=this.getIsClosed(a,o)),this.editor.updateShapes([C],{squashing:!0});break}case"free":{const h=a.slice(),p=h[h.length-1],m=[...p.points];if(m.length&&this.mergeNextPoint){const{z:w}=m[m.length-1];m[m.length-1]={x:u.x,y:u.y,z:w?Math.max(w,u.z):u.z}}else this.currentLineLength+=k.Dist(m[m.length-1],u),m.push(u);h[h.length-1]={...p,points:m},this.currentLineLength=this.getLineLength(h);const f={id:i,type:this.shapeType,props:{segments:h}};if(this.canClose()&&(f.props.isClosed=this.getIsClosed(h,o)),this.editor.updateShapes([f],{squashing:!0}),m.length>500){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const{currentPagePoint:w}=this.editor.inputs,S=tt();this.editor.createShapes([{id:S,type:this.shapeType,x:xp(w.x),y:xp(w.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(d*1.25).toFixed():.5}]}]}}]),this.initialShape=structuredClone(this.editor.getShape(S)),this.mergeNextPoint=!1,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(t){let r=0;for(const i of t)for(let o=0;o<i.points.length-1;o++){const s=i.points[o],a=i.points[o+1];r+=k.Sub(a,s).len2()}return Math.sqrt(r)}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:t}=this;t&&(this.editor.updateShapes([{id:t.id,type:t.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}y(Xb,"id","drawing");let yM=(xS=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("drawing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(xS,"id","idle"),xS);class xf extends ae{constructor(){super(...arguments);y(this,"shapeType","draw");y(this,"onExit",()=>{const t=this.children.drawing;t.initialShape=void 0})}}y(xf,"id","draw"),y(xf,"initial","idle"),y(xf,"children",()=>[yM,Xb]);class qb extends Xp{constructor(){super(...arguments);y(this,"shapeType","frame");y(this,"onCreate",t=>{if(!t)return;const r=this.editor.getShapePageBounds(t),i=[],o=this.editor.getShapeAncestors(t).map(s=>s.id);this.editor.getCurrentPageShapes().map(s=>{if(s.id===t.id||s.isLocked)return;const a=this.editor.getShapePageBounds(s);a&&r.contains(a)&&nG(s,o,t)&&i.push(s.id)}),this.editor.reparentShapes(i,t.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")})}}y(qb,"id","frame"),y(qb,"initial","idle");function nG(n,e,t){return e.includes(n.id)?!1:n.parentId===t.parentId}let rG=(_S=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onKeyUp",e=>{var t;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(_S,"id","idle"),_S),iG=(kS=class extends ae{constructor(){super(...arguments);y(this,"markId","");y(this,"onPointerUp",()=>{this.complete()});y(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=tt();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"geo",x:t.x,y:t.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(yi)}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:e}=this.editor.inputs,t=tt();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(yi),w:1,h:1}}]);const r=this.editor.getShape(t);if(!r)return;const i=r.props.geo==="star"?new de(0,0,200,190):r.props.geo==="cloud"?new de(0,0,300,180):new de(0,0,200,200),o=i.center,s=this.editor.getShapeParentTransform(r);s&&o.rot(-s.rotation()),this.editor.select(t),this.editor.updateShapes([{id:r.id,type:"geo",x:r.x-o.x,y:r.y-o.y,props:{geo:this.editor.getStyleForNextShape(yi),w:i.width,h:i.height}}]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},y(kS,"id","pointing"),kS);class _f extends ae{constructor(){super(...arguments);y(this,"shapeType","geo")}}y(_f,"id","geo"),y(_f,"initial","idle"),y(_f,"children",()=>[rG,iG]);class kf extends ae{constructor(){super(...arguments);y(this,"shapeType","highlight");y(this,"onExit",()=>{const t=this.children.drawing;t.initialShape=void 0})}}y(kf,"id","highlight"),y(kf,"initial","idle"),y(kf,"children",()=>[yM,Xb]);let oG=(CS=class extends ae{constructor(){super(...arguments);y(this,"shapeId","");y(this,"onEnter",e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})});y(this,"onPointerDown",()=>{this.parent.transition("pointing",{shapeId:this.shapeId})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(CS,"id","idle"),CS);const wM=2;let sG=(PS=class extends ae{constructor(){super(...arguments);y(this,"shape",{});y(this,"markId");y(this,"onEnter",e=>{const{inputs:t}=this.editor,{currentPagePoint:r}=t;this.markId=void 0;const i=e.shapeId&&this.editor.getShape(e.shapeId);if(i&&t.shiftKey){this.markId=`creating:${i.id}`,this.editor.mark(this.markId),this.shape=i;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const s=o.filter(f=>f.type==="vertex").sort(gn),a=s[s.length-1],l=s[s.length-2],c=oe.applyToPoint(this.editor.getShapeParentTransform(this.shape),new k(this.shape.x,this.shape.y));let d,u,h;const p=k.Sub(r,c);k.Dist(a,l)<wM||k.Dist(p,a)<wM?(d=a.index,u=a.id,h={...a,x:p.x+.1,y:p.y+.1}):(d=to(a.index),u="handle:"+d,h={id:u,type:"vertex",index:d,x:p.x+.1,y:p.y+.1,canBind:!1});const m=Ho(this.shape.props.handles);m[h.id]=h,this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{handles:m}}])}else{const o=tt();this.markId=`creating:${o}`,this.editor.mark(this.markId),this.editor.createShapes([{id:o,type:"line",x:r.x,y:r.y}]),this.editor.select(o),this.shape=this.editor.getShape(o)}});y(this,"onPointerMove",()=>{if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const t=Fn(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clear()})}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}},y(PS,"id","pointing"),PS);class Cf extends ae{constructor(){super(...arguments);y(this,"shapeType","line")}}y(Cf,"id","line"),y(Cf,"initial","idle"),y(Cf,"children",()=>[oG,sG]);let aG=(ES=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(ES,"id","idle"),ES),lG=(IS=class extends ae{constructor(){super(...arguments);y(this,"dragged",!1);y(this,"info",{});y(this,"wasFocusedOnEnter",!1);y(this,"markId","");y(this,"shape",{});y(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen(),this.wasFocusedOnEnter&&(this.shape=this.createShape())});y(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&(this.wasFocusedOnEnter||(this.shape=this.createShape()),this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}}))});y(this,"onPointerUp",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()})}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}createShape(){const{inputs:{originPagePoint:e}}=this.editor,t=tt();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"note",x:e.x,y:e.y}]).select(t);const r=this.editor.getShape(t),i=this.editor.getShapeGeometry(r).bounds;return this.editor.updateShapes([{id:t,type:"note",x:r.x-i.width/2,y:r.y-i.height/2}]),this.editor.getShape(t)}},y(IS,"id","pointing"),IS);class Pf extends ae{constructor(){super(...arguments);y(this,"shapeType","note")}}y(Pf,"id","note"),y(Pf,"initial","idle"),y(Pf,"children",()=>[aG,lG]);function Od(n){const e=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:Gr/n.getZoomLevel(),renderingOnly:!0});if(!e)return n.setHoveredShape(null);let t;const r=n.getOutermostSelectableShape(e);return r===e||r.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(r.id)?t=e:t=r,n.setHoveredShape(t.id)}let cG=(MS=class extends ae{constructor(){super(...arguments);y(this,"onPointerMove",e=>{switch(e.target){case"shape":case"canvas":Od(this.editor)}});y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});y(this,"onKeyDown",e=>{var t;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(MS,"id","idle"),MS),dG=(AS=class extends ae{constructor(){super(...arguments);y(this,"shape");y(this,"markId","");y(this,"onExit",()=>{this.editor.setHintingShapes([])});y(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:t}}=this.editor,r=tt();if(this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"text",x:t.x,y:t.y,props:{text:"",autoSize:!1,w:20}}]),this.editor.select(r),this.shape=this.editor.getShape(r),!this.shape)return;const{shape:i}=this;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(i.id),this.editor.setCurrentTool("select.editing_shape")}})}});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.cancel()});y(this,"onCancel",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){var i;this.editor.mark("creating text shape");const e=tt(),{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:e,type:"text",x:t,y:r,props:{text:"",autoSize:!0}}]).select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),(i=this.editor.root.getCurrent())==null||i.transition("editing_shape")}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}},y(AS,"id","pointing"),AS);class Ef extends ae{constructor(){super(...arguments);y(this,"shapeType","text")}}y(Ef,"id","text"),y(Ef,"initial","idle"),y(Ef,"children",()=>[cG,dG]);const uG=[Ef,xf,_f,Pf,Cf,qb,Sf,kf];function Vt(){return Vn({isDarkMode:Hp()})}const At=re.memo(function({theme:n,d:e,color:t,fill:r}){switch(r){case"none":return null;case"solid":return g.jsx("path",{fill:n[t].semi,d:e});case"semi":return g.jsx("path",{fill:n.solid,d:e});case"pattern":return g.jsx(hG,{theme:n,color:t,fill:r,d:e})}}),hG=function({d:n,color:e,theme:t}){const r=G(),i=q("zoomLevel",()=>r.getZoomLevel(),[r]),o=Math.ceil(i),s=r.getZoomLevel()<=.18;return g.jsxs(g.Fragment,{children:[g.jsx("path",{fill:t[e].pattern,d:n}),g.jsx("path",{fill:s?t[e].semi:`url(#${Cp[`${o}_${t.id}`]})`,d:n})]})};function ur({d:n,color:e,fill:t,theme:r}){if(t==="none")return;if(t==="pattern"){const o=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",n),s.setAttribute("fill",r[e].pattern);const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",n),a.setAttribute("fill","url(#hash_pattern)"),o.appendChild(s),o.appendChild(a),o}const i=document.createElementNS("http://www.w3.org/2000/svg","path");switch(i.setAttribute("d",n),t){case"semi":{i.setAttribute("fill",r.solid);break}case"solid":{i.setAttribute("fill",r[e].semi);break}}return i}function Zr(n,e){if(e){const t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.appendChild(e),t.appendChild(n),t}else return n}function pG(n){return n.replace(/\s/g,"\xA0")}function If(n,e,t){const{padding:r=0}=t,i=document.createElementNS("http://www.w3.org/2000/svg","text");if(i.setAttribute("font-size",t.fontSize+"px"),i.setAttribute("font-family",t.fontFamily),i.setAttribute("font-style",t.fontStyle),i.setAttribute("font-weight",t.fontWeight),i.setAttribute("line-height",t.lineHeight*t.fontSize+"px"),i.setAttribute("dominant-baseline","mathematical"),i.setAttribute("alignment-baseline","mathematical"),e.length===0)return i;const o=de.From(e[0].box);for(const{box:c}of e)o.union(c);const s=r+(t.offsetX??0),a=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?r:t.verticalTextAlign==="end"?t.height-r-o.height:(Math.ceil(t.height)-o.height)/2);let l=null;for(const{text:c,box:d}of e){if(l!==null&&d.y>l){const p=document.createElementNS("http://www.w3.org/2000/svg","tspan");p.setAttribute("alignment-baseline","mathematical"),p.setAttribute("x",s+"px"),p.setAttribute("y",d.y+a+"px"),p.textContent=`
`,i.appendChild(p)}const u=document.createElementNS("http://www.w3.org/2000/svg","tspan");u.setAttribute("alignment-baseline","mathematical"),u.setAttribute("x",d.x+s+"px"),u.setAttribute("y",d.y+a+"px");const h=pG(c);u.textContent=h,i.appendChild(u),l=d.y}return t.stroke&&t.strokeWidth&&(i.setAttribute("stroke",t.stroke),i.setAttribute("stroke-width",t.strokeWidth+"px")),t.fill&&i.setAttribute("fill",t.fill),i}function Mf(n){return{key:`${gi.id}:${n}`,getElement:async()=>{const e=fG(n);if(!e)return null;const t=e.$$_url,r=e.$$_fontface;if(!t||!r)return null;const i=await(await fetch(t)).blob(),o=await new Promise((l,c)=>{const d=new FileReader;d.onload=()=>l(d.result),d.onerror=c,d.readAsDataURL(i)}),s=r.replace(t,o),a=document.createElementNS("http://www.w3.org/2000/svg","style");return a.textContent=s,a}}}function fG(n){const e=qc[n];for(const t of document.fonts)if(e.includes(t.family))return t;return null}function Jb(n,e){return{key:`${gi.id}:${n}`,getElement:async()=>{if(n!=="pattern")return null;const t=8/12,r=document.createElement("div");return r.innerHTML=`
				<svg>
					<defs>
						<mask id="hash_pattern_mask">
							<rect x="0" y="0" width="8" height="8" fill="white" />
							<g
								strokeLinecap="round"
								stroke="black"
							>
								<line x1="${t*1}" y1="${t*3}" x2="${t*3}" y2="${t*1}" />
								<line x1="${t*5}" y1="${t*7}" x2="${t*7}" y2="${t*5}" />
								<line x1="${t*9}" y1="${t*11}" x2="${t*11}" y2="${t*9}" />
							</g>
						</mask>
						<pattern
							id="hash_pattern"
							width="8"
							height="8"
							patternUnits="userSpaceOnUse"
						>
							<rect x="0" y="0" width="8" height="8" fill="${e.solid}" mask="url(#hash_pattern_mask)" />
						</pattern>
					</defs>
				</svg>
			`,Array.from(r.querySelectorAll("defs > *"))}}}function Zb(){return{key:`${gi.id}:pattern`,component:yG}}const Dd=8,bM=(n,e,t)=>new Promise((r,i)=>{const o=Dd*e*n,s=document.createElement("canvas");s.width=o,s.height=o;const a=s.getContext("2d");if(!a)return;a.fillStyle=t?"#212529":"#f8f9fa",a.fillRect(0,0,o,o),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*n;const l=8/12,c=d=>d*e*n;a.beginPath(),a.moveTo(c(l*1),c(l*3)),a.lineTo(c(l*3),c(l*1)),a.moveTo(c(l*5),c(l*7)),a.lineTo(c(l*7),c(l*5)),a.moveTo(c(l*9),c(l*11)),a.lineTo(c(l*11),c(l*9)),a.stroke(),s.toBlob(d=>{!d||nt.throwToBlob.get()?i():r(d)})}),vM=(n,e)=>{const t=document.createElement("canvas");t.width=n[0],t.height=n[1];const r=t.getContext("2d");return r?(e(r),t.toDataURL()):""},gG=()=>{const n=[];for(let e=1;e<=Math.ceil(Wo);e++){const t=vM([1,1],i=>{i.fillStyle=hp.lightMode.black.semi,i.fillRect(0,0,1,1)}),r=vM([1,1],i=>{i.fillStyle=hp.darkMode.black.semi,i.fillRect(0,0,1,1)});n.push({zoom:e,url:t,darkMode:!1}),n.push({zoom:e,url:r,darkMode:!0})}return n};function mG(){const n=G().getInstanceState().devicePixelRatio,[e,t]=v.useState(!1),r=v.useMemo(()=>gG(),[]),[i,o]=v.useState(r);return v.useEffect(()=>{const s=[];for(let l=1;l<=Math.ceil(Wo);l++)s.push(bM(n,l,!1).then(c=>({zoom:l,url:URL.createObjectURL(c),darkMode:!1}))),s.push(bM(n,l,!0).then(c=>({zoom:l,url:URL.createObjectURL(c),darkMode:!0})));let a=!1;return Promise.all(s).then(l=>{a||(o(l),t(!0))}),()=>{a=!0,t(!1)}},[n]),{defs:g.jsx(g.Fragment,{children:i.map(s=>{const a=s.zoom+(s.darkMode?"_dark":"_light");return g.jsx("pattern",{id:Cp[a],width:Dd,height:Dd,patternUnits:"userSpaceOnUse",children:g.jsx("image",{href:s.url,width:Dd,height:Dd})},a)})}),isReady:e}}function yG(){const n=G(),e=v.useRef(null),{defs:t,isReady:r}=mG();return v.useEffect(()=>{if(r&&n.environment.isSafari){const i=SM(e.current);i&&requestAnimationFrame(()=>{i.style.display="none",requestAnimationFrame(()=>{i.style.display=""})})}},[n,r]),g.jsx("g",{ref:e,children:t})}function SM(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?SM(n.parentElement):null}function yn(n,e,t={}){const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=t;let c=0,d=0,u=1,h=0,p=0;switch(l){case"dashed":{u=1,c=Math.min(e*a,n/4);break}case"dotted":{u=100,c=e/u;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(n+=c/2,p+=c/2):o==="skip"&&(n-=c,p-=c),s==="outset"?n+=c/2:s==="skip"&&(n-=c)),d=Math.floor(n/c/(2*u)),d-=d%i,d<3&&l==="dashed"?n/e<5?(c=n,d=1,h=0):(c=n*.333,h=n*.333):(d=Math.max(d,3),c=n/d/(2*u),r?(p=c/2,h=(n-d*c)/d):h=(n-d*c)/Math.max(1,d-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}function wG(n,e,t){const r=e==="end"?n.end.point:n.start.point,i=e==="end"?n.start.point:n.end.point,o=n.isStraight?k.Dist(i,r):Math.abs(n.bodyArc.length),s=Math.max(Math.min(o/5,t*3),t);let a;if(n.isStraight)a=k.Nudge(r,i,s);else{const l=hF(r,s,n.handleArc.center,n.handleArc.radius);a=e==="end"?n.handleArc.sweepFlag?l[0]:l[1]:n.handleArc.sweepFlag?l[1]:l[0]}return{point:r,int:a}}function bG({point:n,int:e}){const t=k.RotWith(e,n,Fe/6),r=k.RotWith(e,n,-Fe/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y}`}function vG({point:n,int:e}){const t=k.RotWith(e,n,Fe/6),r=k.RotWith(e,n,-Fe/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function SG({point:n,int:e}){const t=k.Sub(e,n).div(2),r=k.Add(n,k.Rot(t,rt)),i=k.Sub(n,k.Rot(t,rt));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function xG({point:n,int:e}){const t=k.Lrp(n,e,.45),r=k.Dist(t,n);return`M ${t.x-r},${t.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function _G({point:n,int:e}){const t=k.Lrp(n,e,.75),r=k.RotWith(t,n,Fe/4),i=k.RotWith(t,n,-Fe/4),o=k.Lrp(r,i,.5);return o.add(k.Sub(o,n)),`M ${o.x} ${o.y} L ${r.x} ${r.y} ${n.x} ${n.y} L ${i.x} ${i.y} Z`}function kG({int:n,point:e}){const t=k.Lrp(e,n,.85),r=k.Sub(t,e).div(2),i=k.Add(e,k.Rot(r,rt)),o=k.Sub(e,k.Rot(r,rt)),s=k.Add(t,k.Rot(r,rt)),a=k.Sub(t,k.Rot(r,rt));return`M ${i.x} ${i.y} L ${s.x} ${s.y} L ${a.x} ${a.y} L ${o.x} ${o.y} Z`}function CG({int:n,point:e}){const t=k.Sub(n,e).div(2),r=k.Add(e,k.Rot(t,rt)),i=k.Sub(e,k.Rot(t,rt));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}function Il(n,e,t){const r=e==="end"?n.end.arrowhead:n.start.arrowhead;if(r==="none")return;const i=wG(n,e,t);if(i){switch(r){case"bar":return CG(i);case"square":return kG(i);case"diamond":return _G(i);case"dot":return xG(i);case"inverted":return SG(i);case"arrow":return bG(i);case"triangle":return vG(i)}return""}}function PG(n){const{start:e,end:t,handleArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=n;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${i} ${o} ${t.handle.x},${t.handle.y}`}function Qb(n){const{start:e,end:t,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=n;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${i} ${o} ${t.point.x},${t.point.y}`}function xM(n,e){return`M${n.x},${n.y}L${e.x},${e.y}`}function EG(n){return xM(n.start.handle,n.end.handle)}function ev(n){return xM(n.start.point,n.end.point)}function tv(n,e,t){const r=G(),i=v.useRef(null),o=v.useRef(!1),s=v.useRef(),a=q("isEditing",()=>r.getEditingShapeId()===n,[r,n]);v.useEffect(()=>{const m=i.current;m&&a&&document.activeElement!==m&&m.focus()},[a]);const l=v.useCallback(()=>{const m=o.current;o.current=!1,requestAnimationFrame(()=>{const f=i.current;if(!f)return;const w=r.getShape(n);w&&(f.value=w.props.text,f.value.length&&!m&&f.select())})},[r,n]),c=v.useCallback(()=>{const m=s.current;requestAnimationFrame(()=>{var S;const f=i.current,w=r.getEditingShapeId();if(f&&w){if(w===n)if(m)if(!m.length)f.focus();else{o.current=!0,f.focus();const b=window.getSelection();b&&m.forEach(_=>b.addRange(_))}else f.focus()}else(S=window.getSelection())==null||S.removeAllRanges(),r.complete()})},[r,n]),d=v.useCallback(m=>{if(a)switch((m.ctrlKey||m.metaKey)&&Ft(m),m.key){case"Enter":{(m.ctrlKey||m.metaKey)&&r.complete();break}case"Tab":{Oe(m),m.shiftKey?rs.unindent(m.currentTarget):rs.indent(m.currentTarget);break}}},[r,a]),u=v.useCallback(m=>{if(!a)return;let f=rs.normalizeText(m.currentTarget.value);const w=f.replace(/\t/g,El);if(w!==f){const S=m.currentTarget.selectionStart;m.currentTarget.value=w,m.currentTarget.selectionStart=S+(w.length-f.length),m.currentTarget.selectionEnd=S+(w.length-f.length),f=w}r.updateShapes([{id:n,type:e,props:{text:f}}])},[r,n,e,a]),h=t.trim().length===0;v.useEffect(()=>{if(a&&i.current){let m=function(){var w,S;const f=(w=window.getSelection)==null?void 0:w.call(window);if(f&&f.type!=="None"){const b=[];if(f)for(let _=0;_<f.rangeCount;_++)b.push((S=f.getRangeAt)==null?void 0:S.call(f,_));s.current=b}};return document.addEventListener("selectionchange",m),()=>{document.removeEventListener("selectionchange",m)}}},[a]);const p=v.useCallback(m=>{r.dispatch({...Hn(m),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(n)}),Ft(m)},[r,n]);return{rInput:i,isEditing:a,handleFocus:l,handleBlur:c,handleKeyDown:d,handleChange:u,handleInputPointerDown:p,handleDoubleClick:Ft,isEmpty:h}}const IG=v.memo(function({id:n,text:e,size:t,font:r,position:i,width:o,labelColor:s}){const{rInput:a,isEditing:l,handleFocus:c,handleBlur:d,handleKeyDown:u,handleChange:h,isEmpty:p,handleInputPointerDown:m,handleDoubleClick:f}=tv(n,"arrow",e),w=rs.normalizeTextForDom(e).trim().length>0;return!l&&!w?null:g.jsx("div",{className:"tl-arrow-label","data-font":r,"data-align":"center","data-hastext":!p,"data-isediting":l,style:{textAlign:"center",fontSize:ns[t],lineHeight:ns[t]*Zt.lineHeight+"px",transform:`translate(${i.x}px, ${i.y}px)`,color:s},children:g.jsxs("div",{className:"tl-arrow-label__inner",children:[g.jsx("p",{style:{width:o||"9px"},children:e?rs.normalizeTextForDom(e):" "}),l&&g.jsx("textarea",{ref:a,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:e,onFocus:c,onChange:h,onKeyDown:u,onBlur:d,onContextMenu:Ft,onPointerDown:m,onDoubleClick:f})]})})});let MG=0;class Af extends Yr{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"canBind",()=>!1);y(this,"canSnap",()=>!1);y(this,"hideResizeHandles",()=>!0);y(this,"hideRotateHandle",()=>!0);y(this,"hideSelectionBoundsBg",()=>!0);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"onHandleChange",(t,{handle:r,isPrecise:i})=>{const o=r.id;if(o==="middle"){const{start:f,end:w}=Xr(this.editor,t),S=k.Sub(w,f),b=k.Per(S),_=k.Med(w,f),x=k.Sub(_,b),P=k.Add(_,b),C=k.NearestPointOnLineSegment(x,P,r,!1);let E=k.Dist(C,_);return k.Clockwise(C,w,_)&&(E*=-1),{id:t.id,type:t.type,props:{bend:E}}}const s=ln(t),a=this.editor.getShapePageTransform(s.id).applyToPoint(r);if(this.editor.inputs.ctrlKey)return s.props[o]={type:"point",x:r.x,y:r.y},s;const l=this.editor.getShapePageTransform(t.id).applyToPoint(r),c=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:f=>!f.isLocked&&this.editor.getShapeUtil(f).canBind(f)});if(!c)return s.props[o]={type:"point",x:r.x,y:r.y},s;const d=this.editor.getShapeGeometry(c),u=de.ZeroFix(d.bounds),h=this.editor.getPointInShapeSpace(c,a);let p=i;if(!p){const f=s.props[o];(f.type==="point"||f.type==="binding"&&c.id!==f.boundShapeId)&&(p=this.editor.inputs.pointerVelocity.len()<.5)}if(!i){d.isClosed||(p=!0);const f=s.props[o==="start"?"end":"start"];f.type==="binding"&&c.id===f.boundShapeId&&f.isPrecise&&(p=!0)}const m={x:(h.x-u.minX)/u.width,y:(h.y-u.minY)/u.height};return p&&k.Dist(h,u.center)<Math.max(4,Math.min(Math.min(u.width,u.height)*.15,16))/this.editor.getZoomLevel()&&(m.x=.5,m.y=.5),s.props[o]={type:"binding",boundShapeId:c.id,normalizedAnchor:m,isPrecise:p,isExact:this.editor.inputs.altKey},s.props.start.type==="binding"&&s.props.end.type==="binding"&&s.props.start.boundShapeId===s.props.end.boundShapeId&&k.Equals(s.props.start.normalizedAnchor,s.props.end.normalizedAnchor)&&(s.props.end.normalizedAnchor.x+=.05),s});y(this,"onTranslateStart",t=>{const r=t.props.start.type==="binding"?t.props.start.boundShapeId:null,i=t.props.end.type==="binding"?t.props.end.boundShapeId:null,o=this.editor.getSelectedShapeIds();if(r&&(o.includes(r)||this.editor.isAncestorSelected(r))||i&&(o.includes(i)||this.editor.isAncestorSelected(i)))return;const{start:s,end:a}=Xr(this.editor,t);return{id:t.id,type:t.type,props:{...t.props,start:{type:"point",x:s.x,y:s.y},end:{type:"point",x:a.x,y:a.y}}}});y(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=Xr(this.editor,t),{start:a,end:l}=ln(t.props);let{bend:c}=t.props;a.type==="point"&&(a.x=s.start.x*i,a.y=s.start.y*o),l.type==="point"&&(l.x=s.end.x*i,l.y=s.end.y*o);const d=Math.abs(i),u=Math.abs(o);return i<0&&o>=0?(c!==0&&(c*=-1,c*=Math.max(d,u)),a.type==="binding"&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x),l.type==="binding"&&(l.normalizedAnchor.x=1-l.normalizedAnchor.x)):i>=0&&o<0?(c!==0&&(c*=-1,c*=Math.max(d,u)),a.type==="binding"&&(a.normalizedAnchor.y=1-a.normalizedAnchor.y),l.type==="binding"&&(l.normalizedAnchor.y=1-l.normalizedAnchor.y)):i>=0&&o>=0?c!==0&&(c*=Math.max(d,u)):i<0&&o<0&&(c!==0&&(c*=Math.max(d,u)),a.type==="binding"&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x,a.normalizedAnchor.y=1-a.normalizedAnchor.y),l.type==="binding"&&(l.normalizedAnchor.x=1-l.normalizedAnchor.x,l.normalizedAnchor.y=1-l.normalizedAnchor.y)),{props:{start:a,end:l,bend:c}}});y(this,"onDoubleClickHandle",(t,r)=>{switch(r.id){case"start":return{id:t.id,type:t.type,props:{...t.props,arrowheadStart:t.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:t.id,type:t.type,props:{...t.props,arrowheadEnd:t.props.arrowheadEnd==="none"?"arrow":"none"}}}});y(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t;o.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])})}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{type:"point",x:0,y:0},end:{type:"point",x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",font:"draw"}}getGeometry(t){const r=this.editor.getArrowInfo(t),i=r.isStraight?new Lp({start:k.From(r.start.point),end:k.From(r.end.point)}):new u7({center:k.Cast(r.handleArc.center),radius:r.handleArc.radius,start:k.Cast(r.start.point),end:k.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let o;if(t.props.text.trim()){const s=i.bounds,{w:a,h:l}=this.editor.textMeasure.measureText(t.props.text,{...Zt,fontFamily:so[t.props.font],fontSize:ns[t.props.size],maxWidth:null});let c=a,d=l;if(s.width>s.height){c=Math.max(Math.min(a,64),Math.min(s.width-64,a));const{w:u,h}=this.editor.textMeasure.measureText(t.props.text,{...Zt,fontFamily:so[t.props.font],fontSize:ns[t.props.size],maxWidth:c});c=u,d=h}if(c>16*ns[t.props.size]){c=16*ns[t.props.size];const{w:u,h}=this.editor.textMeasure.measureText(t.props.text,{...Zt,fontFamily:so[t.props.font],fontSize:ns[t.props.size],maxWidth:c});c=u,d=h}o=new Go({x:r.middle.x-c/2-4.25,y:r.middle.y-d/2-4.25,width:c+8.5,height:d+8.5,isFilled:!0,isLabel:!0})}return new Ko({children:o?[i,o]:[i],isSnappable:!1})}getHandles(t){const r=this.editor.getArrowInfo(t);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y,canBind:!0},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y,canBind:!1},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y,canBind:!0}]}component(t){const r=Vt(),i=this.editor.getOnlySelectedShape(),o=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,s=this.editor.getArrowInfo(t),a=de.ZeroFix(this.editor.getShapeGeometry(t).bounds),l=re.useMemo(()=>this.editor.environment.isSafari?MG+=1:0,[t]);if(!(s!=null&&s.isValid))return null;const c=mn[t.props.size],d=s.start.arrowhead&&Il(s,"start",c),u=s.end.arrowhead&&Il(s,"end",c),h=s.isStraight?ev(s):Qb(s);let p=null;if(i===t&&o){const{strokeDasharray:x,strokeDashoffset:P}=yn(s.isStraight?k.Dist(s.start.handle,s.end.handle):Math.abs(s.handleArc.length),2,{end:"skip",start:"skip",lengthRatio:2.5});p=t.props.start.type==="binding"||t.props.end.type==="binding"?g.jsx("path",{className:"tl-arrow-hint",d:s.isStraight?EG(s):PG(s),strokeDasharray:x,strokeDashoffset:P,strokeWidth:2,markerStart:t.props.start.type==="binding"?t.props.start.isExact?"":t.props.start.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:t.props.end.type==="binding"?t.props.end.isExact?"":t.props.end.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:m,strokeDashoffset:f}=yn(s.isStraight?s.length:Math.abs(s.bodyArc.length),c,{style:t.props.dash}),w=t.props.text.trim()?this.editor.getShapeGeometry(t).children[1]:null,S=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),b=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow"),_=(t.id+"_clip_"+l).replace(":","_");return g.jsxs(g.Fragment,{children:[g.jsxs(ar,{id:t.id,style:{minWidth:50,minHeight:50},children:[g.jsx("defs",{children:g.jsxs("mask",{id:_,children:[g.jsx("rect",{x:R(-100+a.minX),y:R(-100+a.minY),width:R(a.width+200),height:R(a.height+200),fill:"white"}),w&&g.jsx("rect",{x:w.x,y:w.y,width:w.w,height:w.h,fill:"black",rx:4,ry:4}),d&&S&&g.jsx("path",{d,fill:s.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),u&&b&&g.jsx("path",{d:u,fill:s.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),g.jsxs("g",{fill:"none",stroke:r[t.props.color].solid,strokeWidth:c,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[p,g.jsxs("g",{mask:`url(#${_})`,children:[g.jsx("rect",{x:R(a.minX-100),y:R(a.minY-100),width:R(a.width+200),height:R(a.height+200),opacity:0}),g.jsx("path",{d:h,strokeDasharray:m,strokeDashoffset:f})]}),d&&S&&t.props.fill!=="none"&&g.jsx(At,{theme:r,d,color:t.props.color,fill:t.props.fill}),u&&b&&t.props.fill!=="none"&&g.jsx(At,{theme:r,d:u,color:t.props.color,fill:t.props.fill}),d&&g.jsx("path",{d}),u&&g.jsx("path",{d:u})]})]}),g.jsx(IG,{id:t.id,text:t.props.text,font:t.props.font,size:t.props.size,position:s.middle,width:(w==null?void 0:w.w)??0,labelColor:r[t.props.labelColor].solid})]})}indicator(t){const{start:r,end:i}=Xr(this.editor,t),o=this.editor.getArrowInfo(t),s=this.editor.getShapeGeometry(t),a=s.bounds,l=t.props.text.trim()?s.children[1]:null,c=qp(t.id);if(!o||k.Equals(r,i))return null;const d=mn[t.props.size],u=o.start.arrowhead&&Il(o,"start",d),h=o.end.arrowhead&&Il(o,"end",d),p=o.isStraight?ev(o):Qb(o),m=u&&o.start.arrowhead!=="arrow"||h&&o.end.arrowhead!=="arrow"||!!l,f=(t.id+"_clip").replace(":","_");return c&&l?g.jsx("rect",{x:R(l.x),y:R(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5}):g.jsxs("g",{children:[m&&g.jsx("defs",{children:g.jsxs("mask",{id:f,children:[g.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.w+200,height:a.h+200,fill:"white"}),l&&g.jsx("rect",{x:R(l.x),y:R(l.y),width:l.w,height:l.h,fill:"black",rx:3.5,ry:3.5}),u&&g.jsx("path",{d:u,fill:o.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),h&&g.jsx("path",{d:h,fill:o.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),g.jsxs("g",{...m?{mask:`url(#${f})`}:void 0,children:[m&&g.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.width+200,height:a.height+200,opacity:0}),g.jsx("path",{d:p})]}),u&&g.jsx("path",{d:u}),h&&g.jsx("path",{d:h}),l&&g.jsx("rect",{x:R(l.x),y:R(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5})]})}toSvg(t,r){const i=Vn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(Jb(t.props.fill,i));const o=i[t.props.color].solid,s=this.editor.getArrowInfo(t),a=mn[t.props.size],l=document.createElementNS("http://www.w3.org/2000/svg","g");if(!s)return l;const c=s.start.arrowhead&&Il(s,"start",a),d=s.end.arrowhead&&Il(s,"end",a),u=this.editor.getShapeGeometry(t),h=u.bounds,p=t.props.text.trim()?u.children[1]:null,m=(t.id+"_clip").replace(":","_");if(c||d||p){const x=document.createElementNS("http://www.w3.org/2000/svg","defs"),P=document.createElementNS("http://www.w3.org/2000/svg","mask");P.id=m;const C=document.createElementNS("http://www.w3.org/2000/svg","rect");if(C.setAttribute("x",h.minX-100+""),C.setAttribute("y",h.minY-100+""),C.setAttribute("width",h.width+200+""),C.setAttribute("height",h.height+200+""),C.setAttribute("fill","white"),P.appendChild(C),c&&P.appendChild(_M(c,s.start.arrowhead)),d&&P.appendChild(_M(d,s.end.arrowhead)),p){const E=document.createElementNS("http://www.w3.org/2000/svg","rect");E.setAttribute("x",p.x+""),E.setAttribute("y",p.y+""),E.setAttribute("width",p.w+""),E.setAttribute("height",p.h+""),E.setAttribute("fill","black"),P.appendChild(E)}x.appendChild(P),l.appendChild(x)}const f=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttribute("mask",`url(#${m})`),l.appendChild(f);const w=document.createElementNS("http://www.w3.org/2000/svg","rect");w.setAttribute("x","-100"),w.setAttribute("y","-100"),w.setAttribute("width",h.width+200+""),w.setAttribute("height",h.height+200+""),w.setAttribute("fill","transparent"),w.setAttribute("stroke","none"),f.appendChild(w);const S=AG(s.isStraight?ev(s):Qb(s),o,a),{strokeDasharray:b,strokeDashoffset:_}=yn(s.isStraight?s.length:Math.abs(s.bodyArc.length),a,{style:t.props.dash});if(S.setAttribute("stroke-dasharray",b),S.setAttribute("stroke-dashoffset",_),f.appendChild(S),c&&l.appendChild(kM(c,t.props.color,a,t.props.arrowheadStart==="arrow"?"none":t.props.fill,i)),d&&l.appendChild(kM(d,t.props.color,a,t.props.arrowheadEnd==="arrow"?"none":t.props.fill,i)),p){r.addExportDef(Mf(t.props.font));const x={fontSize:ns[t.props.size],lineHeight:Zt.lineHeight,fontFamily:qc[t.props.font],padding:0,textAlign:"middle",width:p.w-8,verticalTextAlign:"middle",height:p.h,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},P=If(this.editor,this.editor.textMeasure.measureTextSpans(t.props.text,x),x);P.setAttribute("fill",i[t.props.labelColor].solid),Array.from(P.children).forEach(E=>{const I=parseFloat(E.getAttribute("x")||"0"),A=parseFloat(E.getAttribute("y")||"0");E.setAttribute("x",I+4+p.x+"px"),E.setAttribute("y",A+p.y+"px")});const C=P.cloneNode(!0);C.setAttribute("stroke-width","2"),C.setAttribute("fill",i.background),C.setAttribute("stroke",i.background),l.appendChild(C),l.appendChild(P)}return l}getCanvasSvgDefs(){return[Zb()]}}y(Af,"type","arrow"),y(Af,"props",yL),y(Af,"migrations",wL);function _M(n,e){const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",n),t.setAttribute("fill",e==="arrow"?"none":"black"),t.setAttribute("stroke","none"),t}function AG(n,e,t){const r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",n),r.setAttribute("fill","none"),r.setAttribute("stroke",e),r.setAttribute("stroke-width",t+""),r}function kM(n,e,t,r,i){const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",n),o.setAttribute("fill","none"),o.setAttribute("stroke",i[e].solid),o.setAttribute("stroke-width",t+"");const s=ur({d:n,fill:r,color:e,theme:i});if(s){const a=document.createElementNS("http://www.w3.org/2000/svg","g");return a.appendChild(s),a.appendChild(o),a}else return o}const CM="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Ld({url:n,zoomLevel:e}){return g.jsx("a",{className:ye("tl-hyperlink-button",{"tl-hyperlink-button__hidden":e<.32}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:Ft,onPointerUp:Ft,title:n,draggable:!1,children:g.jsx("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${CM}") center 100% / 100% no-repeat`,WebkitMask:`url("${CM}") center 100% / 100% no-repeat`}})})}const TG=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function nv(n){return TG.map(e=>{const{offsetX:t,offsetY:r,blur:i,spread:o,color:s}=e,a=new k(t,r),{x:l,y:c}=a.rot(-n);return`${l}px ${c}px ${i}px ${o}px ${s}`}).join(", ")}class Tf extends fl{constructor(){super(...arguments);y(this,"canResize",()=>!1);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"onBeforeCreate",t=>{PM(this.editor,t)});y(this,"onBeforeUpdate",(t,r)=>{if(t.props.url!==r.props.url)if(or.isValid(r.props.url))PM(this.editor,r);else return{...r,props:{...r.props,url:t.props.url}}})}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(t){const r=t.props.assetId?this.editor.getAsset(t.props.assetId):null,i=this.editor.getShapePageTransform(t).rotation(),o=jG(t);return g.jsx(Gs,{children:g.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:nv(i)},children:[g.jsxs("div",{className:"tl-bookmark__image_container",children:[r!=null&&r.props.image?g.jsx("img",{className:"tl-bookmark__image",draggable:!1,src:r==null?void 0:r.props.image,alt:(r==null?void 0:r.props.title)||""}):g.jsx("div",{className:"tl-bookmark__placeholder"}),g.jsx(Ld,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]}),g.jsxs("div",{className:"tl-bookmark__copy_container",children:[(r==null?void 0:r.props.title)&&g.jsx("h2",{className:"tl-bookmark__heading",children:Rd((r==null?void 0:r.props.title)||"",54)}),(r==null?void 0:r.props.description)&&g.jsx("p",{className:"tl-bookmark__description",children:Rd((r==null?void 0:r.props.description)||"",128)}),g.jsx("a",{className:"tl-bookmark__link",href:t.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Ft,onPointerUp:Ft,onClick:Ft,children:Rd(o,45)})]})]})})}indicator(t){return g.jsx("rect",{width:R(t.props.w),height:R(t.props.h),rx:"6",ry:"6"})}}y(Tf,"type","bookmark"),y(Tf,"props",bL),y(Tf,"migrations",vL);const jG=n=>{try{const e=new URL(n.props.url),t=e.pathname.replace(/\/*$/,"");return`${e.hostname}${t}`}catch{return n.props.url}};function PM(n,e){const{url:t}=e.props,r=Ns.createId(Zh(t));n.getAsset(r)?e.props.assetId!==r&&n.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(n.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),RG(n,e))}const RG=jC(async(n,e)=>{const{url:t}=e.props,r=await n.getAssetForExternalContent({type:"url",url:t});r&&n.batch(()=>{n.createAssets([r]),n.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function is(n,e=!1){const t=n.length;if(t<2)return"";let r=n[0].point,i=n[1].point;if(t===2)return`M${Yt(r)}L${Yt(i)}`;let o="";for(let s=2,a=t-1;s<a;s++)r=n[s].point,i=n[s+1].point,o+=Wn(r,i);return e?`M${Wn(n[0].point,n[1].point)}Q${Yt(n[1].point)}${Wn(n[1].point,n[2].point)}T${o}${Wn(n[t-1].point,n[0].point)}${Wn(n[0].point,n[1].point)}Z`:`M${Yt(n[0].point)}Q${Yt(n[1].point)}${Wn(n[1].point,n[2].point)}${n.length>3?"T":""}${o}L${Yt(n[t-1].point)}`}function OG(n,e={}){const{start:t={},end:r={}}=e,{cap:i=!0}=t,{cap:o=!0}=r;Ls(!t.taper&&!r.taper,"cap taper not supported here"),Ls(!t.easing&&!r.easing,"cap easing not supported here"),Ls(i&&o,"cap must be true");const s=Jr(n,e);kl(s,e);const a=DG(s);let l="";for(const c of a)l+=zG(c,e);return l}function DG(n){if(n.length<=2)return[n];const e=[];let t=[n[0]];for(let r=1;r<n.length-1;r++){const i=n[r-1],o=n[r],s=n[r+1],a=k.Angle(i.point,o.point),l=k.Angle(o.point,s.point),c=Math.abs(ad(a,l))/Math.PI;if(c>.8){const p={...o,point:o.input};t.push(p),e.push(rv(t)),t=[p];continue}if(t.push(o),c<.25)continue;const d=(i.radius+o.radius+s.radius)/3,u=k.Dist(i.point,o.point)/d,h=k.Dist(o.point,s.point)/d;if(u+h<1.5){t.push(o),e.push(rv(t)),t=[o];continue}}return t.push(n[n.length-1]),e.push(rv(t)),e}function rv(n){const e=n[0];for(;n.length>2;){const r=n[1],i=k.Dist(e.point,r.point),o=(e.radius+r.radius)/2;if(i<o*.5)n.splice(1,1);else break}const t=n[n.length-1];for(;n.length>2;){const r=n[n.length-2],i=k.Dist(t.point,r.point),o=(t.radius+r.radius)/2;if(i<o*.5)n.splice(n.length-2,1);else break}return n.length>1&&(n[0]={...n[0],vector:k.FromAngle(k.Angle(n[1].point,n[0].point))},n[n.length-1]={...n[n.length-1],vector:k.FromAngle(k.Angle(n[n.length-1].point,n[n.length-2].point))}),n}function LG(n,e,t){return"M "+n+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function zG(n,e={}){if(n.length===0)return"";if(n.length===1)return LG(n[0].point.x,n[0].point.y,n[0].radius);const{left:t,right:r}=oM(n,e);r.reverse();let i=`M${Yt(t[0])}T`;for(let o=1;o<t.length;o++)i+=Wn(t[o-1],t[o]);{const o=n[n.length-1],s=o.radius,a=o.vector.clone().per().neg(),l=k.Add(o.point,k.Mul(a,s)),c=k.Add(o.point,k.Mul(a,-s));i+=`${Yt(l)}A${R(s)},${R(s)} 0 0 1 ${Yt(c)}T`}for(let o=1;o<r.length;o++)i+=Wn(r[o-1],r[o]);{const o=n[0],s=o.radius,a=o.vector.clone().per(),l=k.Add(o.point,k.Mul(a,s)),c=k.Add(o.point,k.Mul(a,-s));i+=`${Yt(l)}A${R(s)},${R(s)} 0 0 1 ${Yt(c)}Z`}return i}function jf(){const n=G();return q("zoom",()=>n.getZoomLevel()<.35,[n])}const NG=n=>n*.65+pz(n*Fe/2)*.35,FG=n=>({size:1+n,thinning:.5,streamline:.62+(1+n)/8*.06,smoothing:.62,easing:pn.easeOutSine,simulatePressure:!0}),$G=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:NG}),EM=n=>({size:1+n,thinning:0,streamline:.62+(1+n)/8*.06,smoothing:.62,simulatePressure:!1,easing:pn.linear});function iv({strokeWidth:n,showAsComplete:e}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:pn.easeOutSine,last:e}}function Rf(n,e,t,r){return{...r?EM(e):n.dash==="draw"?n.isPen?$G(e):FG(e):EM(e),last:n.isComplete||t}}function Ml(n){const e=[];for(const t of n)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(k.Cast));else{const r=Math.max(4,Math.floor(k.Dist(t.points[0],t.points[1])/16));e.push(...k.PointsBetween(t.points[0],t.points[1],r))}return e}function IM(n,e){return{draw:"none",solid:"none",dotted:`0.1 ${e*2}`,dashed:`${e*2} ${e*2}`}[n.props.dash]}class Of extends Yr{constructor(){super(...arguments);y(this,"hideResizeHandles",t=>sv(t));y(this,"hideRotateHandle",t=>sv(t));y(this,"hideSelectionBoundsFg",t=>sv(t));y(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=[];for(const a of t.props.segments)s.push({...a,points:a.points.map(({x:l,y:c,z:d})=>({x:xp(i*l),y:xp(o*c),z:d}))});return{props:{segments:s}}})}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1}}getGeometry(t){const r=Ml(t.props.segments),i=mn[t.props.size];if(t.props.segments.length===1){const s=de.FromPoints(r);if(s.width<i*2&&s.height<i*2)return new dE({x:-i,y:-i,radius:i,isFilled:!0})}const o=Jr(r,Rf(t.props,i,!0,!0)).map(s=>s.point);return t.props.isClosed?new Bt({points:o,isFilled:t.props.fill!=="none"}):new Vs({points:o})}component(t){var p;const r=Vt(),i=jf(),o=mn[t.props.size],s=Ml(t.props.segments),a=t.props.isComplete||((p=Fn(t.props.segments))==null?void 0:p.type)==="straight";let l=o;!i&&!t.props.isPen&&t.props.dash==="draw"&&s.length===1&&(l+=Vo(t.id)()*(o/6));const c=Rf(t.props,l,a,i);if(!i&&t.props.dash==="draw")return g.jsxs(ar,{id:t.id,children:[t.props.isClosed&&t.props.fill&&s.length>1?g.jsx(At,{theme:r,fill:t.props.isClosed?t.props.fill:"none",color:t.props.color,d:is(Jr(s,c),t.props.isClosed)}):null,g.jsx("path",{d:OG(s,c),strokeLinecap:"round",fill:r[t.props.color].solid})]});const d=Jr(s,c),u=d.length<2,h=u?ov(s[0],0):is(d,t.props.isClosed);return g.jsxs(ar,{id:t.id,children:[g.jsx(At,{theme:r,color:t.props.color,fill:u||t.props.isClosed?t.props.fill:"none",d:h}),g.jsx("path",{d:h,strokeLinecap:"round",fill:u?r[t.props.color].solid:"none",stroke:r[t.props.color].solid,strokeWidth:o,strokeDasharray:u?"none":IM(t,o),strokeDashoffset:"0"})]})}indicator(t){var u;const r=jf(),i=mn[t.props.size],o=Ml(t.props.segments);let s=i;!r&&!t.props.isPen&&t.props.dash==="draw"&&o.length===1&&(s+=Vo(t.id)()*(i/6));const a=t.props.isComplete||((u=Fn(t.props.segments))==null?void 0:u.type)==="straight",l=Rf(t.props,s,a,!0),c=Jr(o,l),d=c.length>1?is(c,t.props.isClosed):ov(o[0],s);return g.jsx("path",{d})}toSvg(t,r){var f;const i=Vn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(Jb(t.props.fill,i));const{color:o}=t.props,s=mn[t.props.size],a=Ml(t.props.segments),l=t.props.isComplete||((f=Fn(t.props.segments))==null?void 0:f.type)==="straight";let c=s;!t.props.isPen&&t.props.dash==="draw"&&a.length===1&&(c+=Vo(t.id)()*(s/6));const d=Rf(t.props,c,l,!1),u=Jr(a,d),h=u.length>1?is(u,t.props.isClosed):ov(a[0],c);let p;if(t.props.dash==="draw"||u.length<2){kl(u,d);const w=Ad(u,d),S=document.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d",ud(w,!0)),S.setAttribute("fill",i[o].solid),S.setAttribute("stroke-linecap","round"),p=S}else{const w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttribute("d",h),w.setAttribute("stroke",i[o].solid),w.setAttribute("fill","none"),w.setAttribute("stroke-linecap","round"),w.setAttribute("stroke-width",s.toString()),w.setAttribute("stroke-dasharray",IM(t,s)),w.setAttribute("stroke-dashoffset","0"),p=w}const m=ur({fill:t.props.isClosed?t.props.fill:"none",d:h,color:t.props.color,theme:i});if(m){const w=document.createElementNS("http://www.w3.org/2000/svg","g");return w.appendChild(m),w.appendChild(p),w}return p}getCanvasSvgDefs(){return[Zb()]}expandSelectionOutlinePx(t){const r=t.props.dash==="draw"?1.6:1;return mn[t.props.size]*r/2}}y(Of,"type","draw"),y(Of,"props",SL),y(Of,"migrations",xL);function ov(n,e){const t=(e+1)*.5;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function sv(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function BG(n,e,t={}){const{newPoint:r,handle:i,scaleX:o,scaleY:s}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:d=1/0}=t;let u=n.props.w*o,h=n.props.h*s;const p=new k(0,0);if(u>0){if(u<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=u-a;break}case"top":case"bottom":{p.x=(u-a)/2;break}default:p.x=0}u=a}}else if(p.x=u,u=-u,u<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=-u;break}default:p.x=-a}u=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=h-c;break}case"right":case"left":{p.y=(h-c)/2;break}default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=-h;break}default:p.y=-c}h=c}const{x:m,y:f}=p.rot(n.rotation).add(r);return{x:m,y:f,props:{w:Math.min(l,u),h:Math.min(d,h)}}}const UG=n=>Object.entries(n).filter(([e,t])=>t).map(([e])=>e).join(" ");class Df extends fl{constructor(){super(...arguments);y(this,"hideSelectionBoundsFg",t=>!this.canResize(t));y(this,"canEdit",()=>!0);y(this,"canUnmount",t=>{var r,i;return!!((i=(r=ao(t.props.url))==null?void 0:r.definition)!=null&&i.canUnmount)});y(this,"canResize",t=>{var r,i;return!!((i=(r=ao(t.props.url))==null?void 0:r.definition)!=null&&i.doesResize)});y(this,"canEditInReadOnly",()=>!0);y(this,"isAspectRatioLocked",t=>{var r;return((r=ao(t.props.url))==null?void 0:r.definition.isAspectRatioLocked)??!1});y(this,"onResize",(t,r)=>{const i=this.isAspectRatioLocked(t),o=ao(t.props.url);let s=(o==null?void 0:o.definition.minWidth)??200,a=(o==null?void 0:o.definition.minHeight)??200;if(i){const l=t.props.w/t.props.h;l>1?s*=l:a/=l}return BG(t,r,{minWidth:s,minHeight:a})})}getDefaultProps(){return{w:300,h:300,url:""}}component(t){const{w:r,h:i,url:o}=t.props,s=qp(t.id),a=v.useMemo(()=>fM(o),[o]),l=q("is hovering",()=>{const{editingShapeId:h,hoveredShapeId:p}=this.editor.getCurrentPageState();if(h&&p!==h){const m=this.editor.getShape(h);if(m&&this.editor.isShapeOfType(m,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(t).rotation(),d=s||l;if((a==null?void 0:a.definition.type)==="github_gist"){const h=a.url.split("/").pop();if(!h)throw Error("No gist id!");return g.jsx(Gs,{className:"tl-embed-container",id:t.id,children:g.jsx(VG,{id:h,width:R(r),height:R(i),isInteractive:d,pageRotation:c})})}const u=UG({..._L,...(a==null?void 0:a.definition.overridePermissions)??{}});return g.jsx(Gs,{className:"tl-embed-container",id:t.id,children:a!=null&&a.definition?g.jsx("iframe",{className:"tl-embed",sandbox:u,src:a.embedUrl,width:R(r),height:R(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:d?"auto":"none",zIndex:d?"":"-1",boxShadow:nv(c),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:a==null?void 0:a.definition.backgroundColor}}):null})}indicator(t){const r=v.useMemo(()=>ao(t.props.url),[t.props.url]);return g.jsx("rect",{width:R(t.props.w),height:R(t.props.h),rx:(r==null?void 0:r.definition.overrideOutlineRadius)??8,ry:(r==null?void 0:r.definition.overrideOutlineRadius)??8})}}y(Df,"type","embed"),y(Df,"props",kL),y(Df,"migrations",CL);function VG({id:n,file:e,isInteractive:t,width:r,height:i,style:o,pageRotation:s}){return g.jsx("iframe",{className:"tl-embed",draggable:!1,width:R(r),height:R(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...o,pointerEvents:t?"all":"none",zIndex:t?"":"-1",boxShadow:nv(s)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const HG=v.forwardRef(({id:n,name:e,isEditing:t},r)=>{const i=G(),o=v.useCallback(l=>{l.key==="Enter"&&!l.nativeEvent.isComposing&&(Ft(l),l.currentTarget.blur(),i.setEditingShape(null))},[i]),s=v.useCallback(l=>{const c=i.getShape(n);if(!c)return;const d=c.props.name,u=l.currentTarget.value.trim();d!==u&&i.updateShapes([{id:n,type:"frame",props:{name:u}}],{squashing:!0})},[n,i]),a=v.useCallback(l=>{const c=i.getShape(n);if(!c)return;const d=c.props.name,u=l.currentTarget.value;d!==u&&i.updateShapes([{id:n,type:"frame",props:{name:u}}],{squashing:!0})},[n,i]);return g.jsxs("div",{className:`tl-frame-label ${t?"tl-frame-label__editing":""}`,children:[g.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:t?void 0:"none"},value:e,autoFocus:!0,onKeyDown:o,onBlur:s,onChange:a}),MM(e,"Frame")+String.fromCharCode(8203)]})}),WG=function({id:n,name:e,width:t,height:r}){const i=G(),o=q("shape rotation",()=>Wr(i.getShapePageTransform(n).rotation()),[i,n]),s=qp(n),a=v.useRef(null),l=v.useCallback(h=>{const p=Hn(h);i.getEditingShapeId()!==n&&(i.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(n),...p}),h.preventDefault())},[i,n]);v.useEffect(()=>{const h=a.current;h&&s&&(h.focus(),h.select(),requestAnimationFrame(()=>{document.activeElement!==h&&(h.focus(),h.select())}))},[a,s]);const c=((o+Math.PI/4)*(2/Math.PI)+4)%4,d=["top","left","bottom","right"][Math.floor(c)];let u;switch(d){case"top":u="";break;case"right":u=`translate(${R(t)}px, 0px) rotate(90deg)`;break;case"bottom":u=`translate(${R(t)}px, ${R(r)}px) rotate(180deg)`;break;case"left":u=`translate(0px, ${R(r)}px) rotate(270deg)`;break}return g.jsx("div",{className:"tl-frame-heading",style:{overflow:s?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(d==="top"||d==="bottom"?t:r)}px + var(--space-5))`,bottom:"100%",transform:`${u} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:l,children:g.jsx("div",{className:"tl-frame-heading-hit-area",children:g.jsx(HG,{ref:a,id:n,name:e,isEditing:s})})})};function MM(n,e){return n.match(/^\s*$/)?e:n}class Lf extends fl{constructor(){super(...arguments);y(this,"canBind",()=>!0);y(this,"canEdit",()=>!0);y(this,"canReceiveNewChildrenOfType",(t,r)=>!t.isLocked);y(this,"canDropShapes",(t,r)=>!t.isLocked);y(this,"onDragShapesOver",(t,r)=>r.every(i=>i.parentId===t.id)?{shouldHint:!1}:(this.editor.reparentShapes(r.map(i=>i.id),t.id),{shouldHint:!0}));y(this,"onDragShapesOut",(t,r)=>{const i=this.editor.getShape(t.parentId);i&&this.editor.isShapeOfType(i,"group")?this.editor.reparentShapes(r,i.id):this.editor.reparentShapes(r,this.editor.getCurrentPageId())});y(this,"onResizeEnd",t=>{const r=this.editor.getShapePageBounds(t),i=this.editor.getSortedChildIdsForParent(t.id),o=[];for(const s of i){const a=this.editor.getShapePageBounds(s);r.includes(a)||o.push(s)}o.length>0&&this.editor.reparentShapes(o,this.editor.getCurrentPageId())});y(this,"onResize",(t,r)=>oE(t,r))}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(t){return new Go({width:t.props.w,height:t.props.h,isFilled:!1})}component(t){const r=this.editor.getShapeGeometry(t).bounds,i=Vt(),o=q("is creating this shape",()=>{var l;const s=this.editor.getStateDescendant("select.resizing");if(!s||!s.getIsActive())return!1;const a=s==null?void 0:s.info;return a?a.isCreating&&((l=this.editor.getOnlySelectedShape())==null?void 0:l.id)===t.id:!1},[t.id]);return g.jsxs(g.Fragment,{children:[g.jsx(ar,{children:g.jsx("rect",{className:ye("tl-frame__body",{"tl-frame__creating":o}),width:r.width,height:r.height,fill:i.solid,stroke:i.text})}),o?null:g.jsx(WG,{id:t.id,name:t.props.name,width:r.width,height:r.height})]})}toSvg(t){const r=Vn({isDarkMode:this.editor.user.getIsDarkMode()}),i=document.createElementNS("http://www.w3.org/2000/svg","g"),o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("width",t.props.w.toString()),o.setAttribute("height",t.props.h.toString()),o.setAttribute("fill",r.solid),o.setAttribute("stroke",r.black.solid),o.setAttribute("stroke-width","1"),o.setAttribute("rx","1"),o.setAttribute("ry","1"),i.appendChild(o);const s=((Wr(this.editor.getShapePageTransform(t.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,a=["top","left","bottom","right"][Math.floor(s)];let l;switch(a){case"top":l="";break;case"right":l=`translate(${R(t.props.w)}px, 0px) rotate(90deg)`;break;case"bottom":l=`translate(${R(t.props.w)}px, ${R(t.props.h)}px) rotate(180deg)`;break;case"left":l=`translate(0px, ${R(t.props.h)}px) rotate(270deg)`;break;default:l=""}const c={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:t.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},d=this.editor.textMeasure.measureTextSpans(MM(t.props.name,"Frame")+String.fromCharCode(8203),c),u=d[0],h=Fn(d),p=h.box.w+h.box.x-u.box.x,m=If(this.editor,d,{offsetY:-c.height-2,...c});m.style.setProperty("transform",l);const f=document.createElementNS("http://www.w3.org/2000/svg","rect");return f.setAttribute("x","-8px"),f.setAttribute("y",-c.height-4+"px"),f.setAttribute("width",p+16+"px"),f.setAttribute("height",`${c.height}px`),f.setAttribute("rx","4px"),f.setAttribute("ry","4px"),f.setAttribute("fill",r.background),i.appendChild(f),i.appendChild(m),i}indicator(t){const r=this.editor.getShapeGeometry(t).bounds;return g.jsx("rect",{width:R(r.width),height:R(r.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}y(Lf,"type","frame"),y(Lf,"props",PL),y(Lf,"migrations",EL);function KG(n,e,t,r){if((n==="start-legacy"||n==="end-legacy")&&t.length!==0){const i=de.From(t[0].box);for(const{box:o}of t)i.union(o);if(n==="start-legacy")return(r-2*e-i.width)/2;if(n==="end-legacy")return-(r-2*e-i.width)/2}}function GG(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}const AM=re.memo(function({id:n,type:e,text:t,size:r,labelColor:i,font:o,align:s,verticalAlign:a,wrap:l,bounds:c}){const{rInput:d,isEmpty:u,isEditing:h,handleFocus:p,handleChange:m,handleKeyDown:f,handleBlur:w,handleInputPointerDown:S,handleDoubleClick:b}=tv(n,e,t),_=rs.normalizeTextForDom(t),x=_.length>0,P=GG(s),C=Vt();return!h&&!x?null:g.jsx("div",{className:"tl-text-label","data-font":o,"data-align":s,"data-hastext":!u,"data-isediting":h,"data-textwrap":!!l,style:{justifyContent:s==="middle"||P?"center":s,alignItems:a==="middle"?"center":a,...c?{top:c.minY,left:c.minX,width:c.width,height:c.height,position:"absolute"}:{}},children:g.jsxs("div",{className:"tl-text-label__inner",style:{fontSize:Cl[r],lineHeight:Cl[r]*Zt.lineHeight+"px",minHeight:Zt.lineHeight+32,minWidth:0,color:C[i].solid},children:[g.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",children:_}),h&&g.jsx("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:t,onFocus:p,onChange:m,onKeyDown:f,onBlur:w,onContextMenu:Ft,onPointerDown:S,onDoubleClick:b})]})})});function TM({bounds:n,editor:e,font:t,shape:r}){const i={fontSize:Cl[r.props.size],fontFamily:t,textAlign:r.props.align,verticalTextAlign:r.props.verticalAlign,width:Math.ceil(n.width),height:Math.ceil(n.height),padding:16,lineHeight:Zt.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0},o=e.textMeasure.measureTextSpans(r.props.text,i),s=KG(r.props.align,16,o,n.width);return s&&(i.offsetX=s),If(e,o,i)}function wn(n){return`${R(n.x)},${R(n.y)} `}function jM(n=""){let e=0,t=0,r=0,i=0;function o(){const s=e^e<<11;return e=t,t=r,r=i,i^=(i>>>19^s^s>>>8)>>>0,i/4294967296*2}for(let s=0;s<n.length+64;s++)e^=n.charCodeAt(s)|0,o();return o}function zd(n){let e="M";const t=n.length;let r,i,o;for(let s=0,a=t;s<a;s+=3)r=n[s],i=n[s+1],o=n[s+2],e+=`${wn(r)}L${wn(i)}Q${wn(o)}`;return e+=`${wn(n[0])}`,e}function Nd(n,e,t,r,i){const o=[],s=jM(n);let a=e[0],l;const c=e.length;for(let d=0,u=c*i;d<u;d++){l=k.AddXY(e[(d+1)%c],s()*t,s()*t);const h=k.Sub(l,a),p=k.Len(h),m=k.Div(h,p).mul(Math.min(p/4,r));o.push(k.Add(a,m),k.Add(l,m.neg()),l),a=l}return o}function av(n,e,t){let r=`M ${wn(e[0])}L`,i=`M ${wn(e[0])}L`;const o=t/3,s=t*2,a=jM(n);let l=e[0],c,d=e[0],u;const h=e.length;for(let p=0,m=h-1;p<m;p++){c=e[p+1],u=k.AddXY(e[p+1],a()*o,a()*o);const f=k.Sub(c,l),w=k.Len(f),S=k.Div(f,w).mul(Math.min(w/4,s)),b=k.Add(l,S),_=k.Add(c,S.neg()),x=k.Sub(u,d),P=k.Len(x),C=k.Div(x,P).mul(Math.min(P/4,s)),E=k.Add(d,C),I=k.Add(u,C.neg());p===m-1?(r+=`${wn(b)}L ${wn(c)}`,i+=`${wn(E)}L ${wn(u)}`):(r+=`${wn(b)}L ${wn(_)}Q ${wn(c)}`,i+=`${wn(E)}L ${wn(I)}Q ${wn(u)}`,l=c,d=u)}return[r,r+i]}function RM(n,e){const t=Math.min(n,e)/2,r=Math.max(n,e)-t*2;return Math.PI*(t*2)+2*r}function YG(n,e,t){const r=Math.min(n,e)/2,i=Math.max(n,e)-r*2,o=(Math.PI*(r*2)+2*i)/t,s=n>e?[{type:"straight",start:new k(r,0),delta:new k(1,0)},{type:"arc",center:new k(n-r,r),startAngle:-Fe/2},{type:"straight",start:new k(n-r,e),delta:new k(-1,0)},{type:"arc",center:new k(r,r),startAngle:Fe/2}]:[{type:"straight",start:new k(n,r),delta:new k(0,1)},{type:"arc",center:new k(r,e-r),startAngle:0},{type:"straight",start:new k(0,e-r),delta:new k(0,-1)},{type:"arc",center:new k(r,r),startAngle:Fe}];let a=0;const l=[];for(let c=0;c<t;c++){const d=s[0];d.type==="straight"?l.push(k.Add(d.start,k.Mul(d.delta,a))):l.push(v2(d.center.x,d.center.y,r,d.startAngle+a/r)),a+=o;let u=d.type==="straight"?i:Fe*r;for(;a>u;)a-=u,s.push(s.shift()),u=s[0].type==="straight"?i:Fe*r}return l}const XG=(n,e,t,r,i)=>{switch(n){case"s":return e;case"m":return t;case"l":return r;case"xl":return i}};function Fd(n,e,t,r){const i=Vo(t),o=RM(n,e),s=Math.max(Math.ceil(o/XG(r,50,70,100,130)),6,Math.ceil(o/Math.min(n,e))),a=o/s*.2,l=Math.max(n-a*2,1),c=Math.max(e-a*2,1),d=(n-l)/2,u=(e-c)/2,h=RM(l,c)/s,p=YG(l,c,s).map(b=>b.addXY(d,u)),m=n<20?0:a*.3,f=e<20?0:a*.3,w=p.slice(0);for(let b=0;b<Math.floor(s/2);b++)w[b]=k.AddXY(w[b],i()*m,i()*f),w[s-b-1]=k.AddXY(w[s-b-1],i()*m,i()*f);const S=[];for(let b=0;b<w.length;b++){const _=b===w.length-1?0:b+1,x=w[b],P=w[_],C=p[b],E=p[_],I=k.Average([C,E]),A=k.Angle(C,E)-Math.PI/2,T=k.Dist(C,E),D=h-T,F=k.Dist(x,P)/T,H=(Math.max(d,u)+D)*F,O=k.Add(I,k.FromAngle(A,H));O.x<0?O.x=0:O.x>n&&(O.x=n),O.y<0?O.y=0:O.y>e&&(O.y=e);const K=OM(x,P,O),B=k.Dist(K||k.Average([x,P]),x);S.push({leftPoint:x,rightPoint:P,arcPoint:O,center:K,radius:B})}return S}function OM(n,e,t){const r=n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y,i=(n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y),o=(n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x),s=-i/(2*r),a=-o/(2*r);return!Number.isFinite(s)||!Number.isFinite(a)?null:new k(s,a)}function qG(n,e,t,r){const i=[],o=Fd(n,e,t,r);for(const{center:s,radius:a,leftPoint:l,rightPoint:c}of o)i.push(...JG(l,c,s,a,10));return i}function $d(n,e,t,r){const i=Fd(n,e,t,r);let o=`M${R(i[0].leftPoint.x)},${R(i[0].leftPoint.y)}`;for(const{leftPoint:s,rightPoint:a,radius:l,center:c}of i){if(c===null){o+=` L${R(a.x)},${R(a.y)}`;continue}const d=LM(s,a,c)?"0":"1";o+=` A${R(l)},${R(l)} 0 ${d},1 ${R(a.x)},${R(a.y)}`}return o+=" Z",o}function DM(n,e,t,r){const i=Vo(t),o=r==="s"?.5:r==="m"?.7:r==="l"?.9:1.6,s=h=>h+i()*o*2,a=Fd(n,e,t,r),l=a.reduce((h,p)=>h+k.Dist(p.leftPoint,p.rightPoint),0)/a.length>o*15?h=>new k(s(h.x),s(h.y)):h=>h;let c=`M${R(a[0].leftPoint.x)},${R(a[0].leftPoint.y)}`,d=l(a[0].leftPoint),u=`M${R(d.x)},${R(d.y)}`;for(const{leftPoint:h,center:p,rightPoint:m,radius:f,arcPoint:w}of a){if(p===null){c+=` L${R(m.x)},${R(m.y)}`;const C=l(m);u+=` L${R(C.x)},${R(C.y)}`,d=C;continue}const S=LM(h,m,p)?"0":"1";c+=` A${R(f)},${R(f)} 0 ${S},1 ${R(m.x)},${R(m.y)}`;const b=l(m),_=l(w),x=OM(d,b,_);if(!x){u+=` L${R(b.x)},${R(b.y)}`,d=b;continue}const P=Math.abs(k.Dist(x,d));u+=` A${R(P)},${R(P)} 0 ${S},1 ${R(b.x)},${R(b.y)}`,d=b}return c+u+" Z"}function JG(n,e,t,r,i){if(t===null)return[k.From(n),k.From(e)];const o=[],s=k.Angle(t,n),a=k.Angle(t,e),l=vp(s,a);for(let c=0;c<i;c++){const d=c/(i-1),u=s+l*d,h=v2(t.x,t.y,r,u);o.push(h)}return o}function LM(n,e,t){return(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x)>0}const ZG=v.memo(function({dash:n,fill:e,color:t,strokeWidth:r,w:i,h:o,id:s,size:a}){const l=Vt(),c=$d(i,o,s,a),d=Fd(i,o,s,a);return g.jsxs(g.Fragment,{children:[g.jsx(At,{theme:l,d:c,fill:e,color:t}),g.jsx("g",{strokeWidth:r,stroke:l[t].solid,fill:"none",pointerEvents:"all",children:d.map(({leftPoint:u,rightPoint:h,center:p,radius:m},f)=>{const w=p?m*Wr(Wr(k.Angle(p,h))-Wr(k.Angle(p,u))):k.Dist(u,h),{strokeDasharray:S,strokeDashoffset:b}=yn(w,r,{style:n,start:"outset",end:"outset"});return g.jsx("path",{d:p?`M${u.x},${u.y}A${m},${m},0,0,1,${h.x},${h.y}`:`M${u.x},${u.y}L${h.x},${h.y}`,strokeDasharray:S,strokeDashoffset:b},f)})})]})});function QG({dash:n,fill:e,color:t,theme:r,strokeWidth:i,w:o,h:s,id:a,size:l}){const c=$d(o,s,a,l),d=Fd(o,s,a,l),u=document.createElementNS("http://www.w3.org/2000/svg","g");u.setAttribute("stroke-width",i.toString()),u.setAttribute("stroke",r[t].solid),u.setAttribute("fill","none");for(const{leftPoint:p,rightPoint:m,center:f,radius:w}of d){const S=f?w*Wr(Wr(k.Angle(f,m))-Wr(k.Angle(f,p))):k.Dist(p,m),{strokeDasharray:b,strokeDashoffset:_}=yn(S,i,{style:n,start:"outset",end:"outset"}),x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttribute("d",f?`M${p.x},${p.y}A${w},${w},0,0,1,${m.x},${m.y}`:`M${p.x},${p.y}L${m.x},${m.y}`),x.setAttribute("stroke-dasharray",b.toString()),x.setAttribute("stroke-dashoffset",_.toString()),u.appendChild(x)}const h=ur({d:c,fill:e,color:t,theme:r});return Zr(u,h)}const eY=v.memo(function({w:n,h:e,strokeWidth:t,dash:r,color:i,fill:o}){const s=Vt(),a=n/2,l=e/2,c=Math.max(0,a),d=Math.max(0,l),u=sd(c,d),{strokeDasharray:h,strokeDashoffset:p}=yn(u<64?u*2:u,t,{style:r,snap:4,closed:!0}),m=`M${a-c},${l}a${c},${d},0,1,1,${c*2},0a${c},${d},0,1,1,-${c*2},0`;return g.jsxs(g.Fragment,{children:[g.jsx(At,{theme:s,d:m,color:i,fill:o}),g.jsx("path",{d:m,strokeWidth:t,width:R(n),height:R(e),fill:"none",stroke:s[i].solid,strokeDasharray:h,strokeDashoffset:p,pointerEvents:"all"})]})});function tY({w:n,h:e,strokeWidth:t,dash:r,color:i,theme:o,fill:s}){const a=n/2,l=e/2,c=Math.max(0,a-t/2),d=Math.max(0,l-t/2),u=sd(c,d),{strokeDasharray:h,strokeDashoffset:p}=yn(u<64?u*2:u,t,{style:r,snap:4,closed:!0}),m=`M${a-c},${l}a${c},${d},0,1,1,${c*2},0a${c},${d},0,1,1,-${c*2},0`,f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d",m),f.setAttribute("stroke-width",t.toString()),f.setAttribute("width",n.toString()),f.setAttribute("height",e.toString()),f.setAttribute("fill","none"),f.setAttribute("stroke",o[i].solid),f.setAttribute("stroke-dasharray",h),f.setAttribute("stroke-dashoffset",p);const w=ur({d:m,fill:s,color:i,theme:o});return Zr(f,w)}function zM(n,e){if(e>n){const r=n/2;return`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${n},${e-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}const t=e/2;return`
    M${t},0
    L${n-t},0
    a${t},${t},0,1,1,0,${t*2}
    L${t},${e}
    a${t},${t},0,1,1,0,${-t*2}
    Z`}function NM(n,e){if(n>e){const r=e/2;return sd(r,r)+(n-r*2)*2}const t=n/2;return sd(t,t)+(e-t*2)*2}const nY=v.memo(function({w:n,h:e,strokeWidth:t,dash:r,color:i,fill:o}){const s=Vt(),a=zM(n,e),l=NM(n,e),{strokeDasharray:c,strokeDashoffset:d}=yn(l<64?l*2:l,t,{style:r,snap:4,start:"outset",end:"outset",closed:!0});return g.jsxs(g.Fragment,{children:[g.jsx(At,{theme:s,d:a,color:i,fill:o}),g.jsx("path",{d:a,strokeWidth:t,width:R(n),height:R(e),fill:"none",stroke:s[i].solid,strokeDasharray:c,strokeDashoffset:d,pointerEvents:"all"})]})});function FM({w:n,h:e,strokeWidth:t,dash:r,color:i,theme:o,fill:s}){const a=zM(n,e),l=NM(n,e),{strokeDasharray:c,strokeDashoffset:d}=yn(l<64?l*2:l,t,{style:r,snap:4,closed:!0}),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",a),u.setAttribute("stroke-width",t.toString()),u.setAttribute("width",n.toString()),u.setAttribute("height",e.toString()),u.setAttribute("fill","none"),u.setAttribute("stroke",o[i].solid),u.setAttribute("stroke-dasharray",c),u.setAttribute("stroke-dashoffset",d);const h=ur({d:a,fill:s,color:i,theme:o});return Zr(u,h)}const rY=v.memo(function({dash:n,fill:e,color:t,strokeWidth:r,outline:i,lines:o}){const s=Vt(),a="M"+i[0]+"L"+i.slice(1)+"Z";return g.jsxs(g.Fragment,{children:[g.jsx(At,{theme:s,d:a,fill:e,color:t}),g.jsxs("g",{strokeWidth:r,stroke:s[t].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(i.length)).map((l,c)=>{const d=i[c],u=i[(c+1)%i.length],h=k.Dist(d,u),{strokeDasharray:p,strokeDashoffset:m}=yn(h,r,{style:n,start:"outset",end:"outset"});return g.jsx("line",{x1:d.x,y1:d.y,x2:u.x,y2:u.y,strokeDasharray:p,strokeDashoffset:m},c)}),o&&o.map(([l,c],d)=>{const u=k.Dist(l,c),{strokeDasharray:h,strokeDashoffset:p}=yn(u,r,{style:n,start:"skip",end:"outset",snap:n==="dotted"?4:void 0});return g.jsx("path",{d:`M${l.x},${l.y}L${c.x},${c.y}`,stroke:s[t].solid,strokeWidth:r,fill:"none",strokeDasharray:h,strokeDashoffset:p},`line_fg_${d}`)})]})]})});function iY({dash:n,fill:e,color:t,theme:r,strokeWidth:i,outline:o,lines:s}){const a=document.createElementNS("http://www.w3.org/2000/svg","g");if(a.setAttribute("stroke-width",i.toString()),a.setAttribute("stroke",r[t].solid),a.setAttribute("fill","none"),Array.from(Array(o.length)).forEach((c,d)=>{const u=o[d],h=o[(d+1)%o.length],p=k.Dist(u,h),{strokeDasharray:m,strokeDashoffset:f}=yn(p,i,{style:n}),w=document.createElementNS("http://www.w3.org/2000/svg","line");w.setAttribute("x1",u.x.toString()),w.setAttribute("y1",u.y.toString()),w.setAttribute("x2",h.x.toString()),w.setAttribute("y2",h.y.toString()),w.setAttribute("stroke-dasharray",m.toString()),w.setAttribute("stroke-dashoffset",f.toString()),a.appendChild(w)}),s)for(const[c,d]of s){const u=k.Dist(c,d),{strokeDasharray:h,strokeDashoffset:p}=yn(u,i,{style:n,start:"skip",end:"skip",snap:n==="dotted"?4:2}),m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",c.x.toString()),m.setAttribute("y1",c.y.toString()),m.setAttribute("x2",d.x.toString()),m.setAttribute("y2",d.y.toString()),m.setAttribute("stroke-dasharray",h.toString()),m.setAttribute("stroke-dashoffset",p.toString()),a.appendChild(m)}const l=ur({d:"M"+o[0]+"L"+o.slice(1)+"Z",fill:e,color:t,theme:r});return Zr(a,l)}const oY=v.memo(function({fill:n,color:e,strokeWidth:t,w:r,h:i,id:o,size:s}){const a=Vt(),l=DM(r,i,o,s);return g.jsxs(g.Fragment,{children:[g.jsx(At,{theme:a,d:l,fill:n,color:e}),g.jsx("path",{d:l,stroke:a[e].solid,strokeWidth:t,fill:"none"})]})});function sY({fill:n,color:e,strokeWidth:t,theme:r,w:i,h:o,id:s,size:a}){const l=DM(i,o,s,a),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",t.toString()),c.setAttribute("stroke",r[e].solid),c.setAttribute("fill","none");const d=ur({d:l,fill:n,color:e,theme:r});return Zr(c,d)}v.memo(function({id:n,w:e,h:t,strokeWidth:r,fill:i,color:o}){const s=Vt(),a=lv(n,e,t,r),l=UM(n,e,t,r);return g.jsxs(g.Fragment,{children:[g.jsx(At,{theme:s,d:a,color:o,fill:i}),g.jsx("path",{d:l,fill:s[o].solid,strokeWidth:0,pointerEvents:"all"})]})});function aY({id:n,w:e,h:t,strokeWidth:r,fill:i,color:o,theme:s}){const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",UM(n,e,t,r)),a.setAttribute("fill",s[o].solid);const l=ur({d:lv(n,e,t,r),fill:i,color:o,theme:s});return Zr(a,l)}function $M(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function BM(n,e,t,r){const i=Vo(n),o=e/2,s=t/2,a=sd(o,s),l=[],c=We*i(),d=We+rt/2+Math.abs(i())*rt,u=Math.max(16,a/10);for(let h=0;h<u;h++){const p=h/(u-1),m=c+p*d,f=Math.cos(m),w=Math.sin(m);l.push(new k(o*f+e*.5+.05*i(),s*w+t/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?pn.easeInOutSine(p):pn.easeInExpo(p)))/2)))}return Jr(l,$M(r))}function UM(n,e,t,r){const i=$M(r);return ud(Ad(kl(BM(n,e,t,r),i),i))}function lv(n,e,t,r){return is(BM(n,e,t,r))}const lY=v.memo(function({id:n,outline:e,lines:t,fill:r,color:i,strokeWidth:o}){const s=Vt(),a=Nd(n,e,o/3,o*2,2);let l=zd(a);if(t)for(const[u,h]of t)l+=`M${u.x},${u.y}L${h.x},${h.y}`;const c=Nd(n,e,0,o*2,1),d=zd(c);return g.jsxs(g.Fragment,{children:[g.jsx(At,{d,fill:r,color:i,theme:s}),g.jsx("path",{d:l,stroke:s[i].solid,strokeWidth:o,fill:"none"})]})});function cY({id:n,outline:e,lines:t,fill:r,color:i,theme:o,strokeWidth:s}){const a=Nd(n,e,s/3,s*2,2);let l=zd(a);if(t)for(const[p,m]of t)l+=`M${p.x},${p.y}L${m.x},${m.y}`;const c=Nd(n,e,0,s*2,1),d=zd(c),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",l),u.setAttribute("fill","none"),u.setAttribute("stroke",o[i].solid),u.setAttribute("stroke-width",s.toString());const h=ur({d,fill:r,color:i,theme:o});return Zr(u,h)}const dY=v.memo(function({fill:n,color:e,strokeWidth:t,w:r,h:i,id:o,size:s}){const a=Vt(),l=$d(r,i,o,s);return g.jsxs(g.Fragment,{children:[g.jsx(At,{theme:a,d:l,fill:n,color:e}),g.jsx("path",{d:l,stroke:a[e].solid,strokeWidth:t,fill:"none"})]})});function uY({fill:n,color:e,strokeWidth:t,theme:r,w:i,h:o,id:s,size:a}){const l=$d(i,o,s,a),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",t.toString()),c.setAttribute("stroke",r[e].solid),c.setAttribute("fill","none");const d=ur({d:l,fill:n,color:e,theme:r});return Zr(c,d)}const VM=v.memo(function({w:n,h:e,strokeWidth:t,fill:r,color:i}){const o=Vt(),s=n/2,a=e/2,l=Math.max(0,s),c=Math.max(0,a),d=`M${s-l},${a}a${l},${c},0,1,1,${l*2},0a${l},${c},0,1,1,-${l*2},0`;return g.jsxs(g.Fragment,{children:[g.jsx(At,{d,color:i,fill:r,theme:o}),g.jsx("path",{d,stroke:o[i].solid,strokeWidth:t,fill:"none"})]})});function hY({w:n,h:e,strokeWidth:t,fill:r,color:i,theme:o}){const s=n/2,a=e/2,l=Math.max(0,s),c=Math.max(0,a),d=`M${s-l},${a}a${l},${c},0,1,1,${l*2},0a${l},${c},0,1,1,-${l*2},0`,u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",d),u.setAttribute("stroke-width",t.toString()),u.setAttribute("width",n.toString()),u.setAttribute("height",e.toString()),u.setAttribute("fill","none"),u.setAttribute("stroke",o[i].solid);const h=ur({d,fill:r,color:i,theme:o});return Zr(u,h)}const HM=v.memo(function({w:n,h:e,strokeWidth:t,fill:r,color:i}){const o=Vt(),s=cv(n,e);return g.jsxs(g.Fragment,{children:[g.jsx(At,{d:s,color:i,fill:r,theme:o}),g.jsx("path",{d:s,stroke:o[i].solid,strokeWidth:t,fill:"none"})]})});function pY({w:n,h:e,strokeWidth:t,fill:r,color:i,theme:o}){const s=cv(n,e),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",s),a.setAttribute("stroke-width",t.toString()),a.setAttribute("width",n.toString()),a.setAttribute("height",e.toString()),a.setAttribute("fill","none"),a.setAttribute("stroke",o[i].solid);const l=ur({d:s,fill:r,color:i,theme:o});return Zr(a,l)}function cv(n,e){let t;if(e>n){const r=n/2;t=`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${n},${e-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}else{const r=e/2;t=`
    M${r},0
    L${n-r},0
    a${r},${r},0,1,1,0,${r*2}
    L${r},${e}
    a${r},${r},0,1,1,0,${-r*2}
    Z`}return t}const fY=v.memo(function({outline:n,lines:e,fill:t,color:r,strokeWidth:i}){const o=Vt();let s="M"+n[0]+"L"+n.slice(1)+"Z";if(e)for(const[a,l]of e)s+=`M${a.x},${a.y}L${l.x},${l.y}`;return g.jsxs(g.Fragment,{children:[g.jsx(At,{d:s,fill:t,color:r,theme:o}),g.jsx("path",{d:s,stroke:o[r].solid,strokeWidth:i,fill:"none"})]})});function gY({outline:n,lines:e,fill:t,color:r,strokeWidth:i,theme:o}){const s="M"+n[0]+"L"+n.slice(1)+"Z",a=s;let l=s;if(e)for(const[u,h]of e)l+=`M${u.x},${u.y}L${h.x},${h.y}`;const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",i.toString()),c.setAttribute("stroke",o[r].solid),c.setAttribute("fill","none");const d=ur({d:a,fill:t,color:r,theme:o});return Zr(c,d)}const dv=16,Mr=17*3;class zf extends fl{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t;o.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])});y(this,"onResize",(t,{handle:r,newPoint:i,scaleX:o,scaleY:s,initialShape:a})=>{let l=a.props.w*o,c=(a.props.h+a.props.growY)*s,d=0,u=0;if(t.props.text.trim()){let f=Math.max(Math.abs(l),Mr),w=Math.max(Math.abs(c),Mr);f<Mr&&w===Mr&&(f=Mr),f===Mr&&w<Mr&&(w=Mr);const S=Nf(this.editor,{...t,props:{...t.props,w:f,h:w}}),b=Math.max(Math.abs(l),S.w)*Math.sign(l),_=Math.max(Math.abs(c),S.h)*Math.sign(c);d=Math.abs(b)-Math.abs(l),u=Math.abs(_)-Math.abs(c),l=b,c=_}const h=new k(0,0);o<0&&(h.x+=l),(r==="left"||r==="top_left"||r==="bottom_left")&&(h.x+=o<0?d:-d),s<0&&(h.y+=c),(r==="top"||r==="top_left"||r==="top_right")&&(h.y+=s<0?u:-u);const{x:p,y:m}=h.rot(t.rotation).add(i);return{x:p,y:m,props:{w:Math.max(Math.abs(l),1),h:Math.max(Math.abs(c),1),growY:0}}});y(this,"onBeforeCreate",t=>{if(!t.props.text)return t.props.growY?{...t,props:{...t.props,growY:0}}:void 0;const r=t.props.h,i=Nf(this.editor,t).h;let o=null;if(i>r?o=i-r:t.props.growY&&(o=0),o!==null)return{...t,props:{...t.props,growY:o}}});y(this,"onBeforeUpdate",(t,r)=>{const i=t.props.text,o=r.props.text;if(i===o&&t.props.font===r.props.font&&t.props.size===r.props.size)return;if(i&&!o)return{...r,props:{...r.props,growY:0}};const s=t.props.w,a=t.props.h,l=Nf(this.editor,r),c=l.w,d=l.h;if(!i&&o&&o.length===1){let h=Math.max(s,c),p=Math.max(a,d);return t.props.w<Mr&&t.props.h<Mr&&(h=Math.max(h,Mr),p=Math.max(p,Mr),h=Math.max(h,p),p=Math.max(h,p)),{...r,props:{...r.props,w:h,h:p,growY:0}}}let u=null;if(d>a?u=d-a:t.props.growY&&(u=0),u!==null)return{...r,props:{...r.props,growY:u,w:Math.max(r.props.w,c)}};if(c>t.props.w)return{...r,props:{...r.props,w:c}}});y(this,"onDoubleClick",t=>{if(this.editor.inputs.altKey)switch(t.props.geo){case"rectangle":return{...t,props:{geo:"check-box"}};case"check-box":return{...t,props:{geo:"rectangle"}}}})}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:""}}getGeometry(t){const r=Math.max(1,t.props.w),i=Math.max(1,t.props.h+t.props.growY),o=r/2,s=i/2,a=mn[t.props.size],l=t.props.fill!=="none";let c;switch(t.props.geo){case"cloud":{c=new Bt({points:qG(r,i,t.id,t.props.size),isFilled:l});break}case"triangle":{c=new Bt({points:[new k(o,0),new k(r,i),new k(0,i)],isFilled:l});break}case"diamond":{c=new Bt({points:[new k(o,0),new k(r,s),new k(o,i),new k(0,s)],isFilled:l});break}case"pentagon":{c=new Bt({points:sw(r,i,5),isFilled:l});break}case"hexagon":{c=new Bt({points:sw(r,i,6),isFilled:l});break}case"octagon":{c=new Bt({points:sw(r,i,8),isFilled:l});break}case"ellipse":{c=new uE({width:r,height:i,isFilled:l});break}case"oval":{c=new g7({width:r,height:i,isFilled:l});break}case"star":{const f=We/5/2,w=Math.floor(5/4)*2,S=5*2-w,b=0,_=Math.floor(5/2)*2,x=Math.cos(-rt+w*f)*r/2,P=Math.cos(-rt+S*f)*r/2,C=Math.sin(-rt+b*f)*i/2,E=Math.sin(-rt+_*f)*i/2,I=r-Math.abs(x-P),A=i-Math.abs(E-C),T=r/2+P-(r/2-x),D=i/2+C-(i/2-E),F=1,H=(r-T)/2,O=(i-D)/2,K=(r+I)/2,B=(i+A)/2,te=K*F/2,W=B*F/2;c=new Bt({points:Array.from(Array(5*2)).map((N,Y)=>{const ee=-rt+Y*f;return new k(H+(Y%2?te:K)*Math.cos(ee),O+(Y%2?W:B)*Math.sin(ee))}),isFilled:l});break}case"rhombus":{const f=Math.min(r*.38,i*.38);c=new Bt({points:[new k(f,0),new k(r,0),new k(r-f,i),new k(0,i)],isFilled:l});break}case"rhombus-2":{const f=Math.min(r*.38,i*.38);c=new Bt({points:[new k(0,0),new k(r-f,0),new k(r,i),new k(f,i)],isFilled:l});break}case"trapezoid":{const f=Math.min(r*.38,i*.38);c=new Bt({points:[new k(f,0),new k(r-f,0),new k(r,i),new k(0,i)],isFilled:l});break}case"arrow-right":{const f=Math.min(r,i)*.38,w=i*.16;c=new Bt({points:[new k(0,w),new k(r-f,w),new k(r-f,0),new k(r,i/2),new k(r-f,i),new k(r-f,i-w),new k(0,i-w)],isFilled:l});break}case"arrow-left":{const f=Math.min(r,i)*.38,w=i*.16;c=new Bt({points:[new k(f,0),new k(f,w),new k(r,w),new k(r,i-w),new k(f,i-w),new k(f,i),new k(0,i/2)],isFilled:l});break}case"arrow-up":{const f=r*.16,w=Math.min(r,i)*.38;c=new Bt({points:[new k(r/2,0),new k(r,w),new k(r-f,w),new k(r-f,i),new k(f,i),new k(f,w),new k(0,w)],isFilled:l});break}case"arrow-down":{const f=r*.16,w=Math.min(r,i)*.38;c=new Bt({points:[new k(f,0),new k(r-f,0),new k(r-f,i-w),new k(r,i-w),new k(r/2,i),new k(0,i-w),new k(f,i-w)],isFilled:l});break}case"check-box":case"x-box":case"rectangle":{c=new Go({width:r,height:i,isFilled:l,isSnappable:!0});break}}const d=Nf(this.editor,t),u=Math.min(r,Math.max(d.w,Math.min(32,Math.max(1,r-8)))),h=Math.min(i,Math.max(d.h,Math.min(32,Math.max(1,r-8)))),p=Ff(t.props,a),m=p?p.map(f=>new Vs({points:f})):[];return new Ko({children:[c,new Go({x:t.props.align==="start"?0:t.props.align==="end"?r-u:(r-u)/2,y:t.props.verticalAlign==="start"?0:t.props.verticalAlign==="end"?i-h:(i-h)/2,width:u,height:h,isFilled:!0,isSnappable:!1,isLabel:!0}),...m],isSnappable:!1})}component(t){const{id:r,type:i,props:o}=t,s=mn[o.size],{w:a,color:l,labelColor:c,fill:d,dash:u,growY:h,font:p,align:m,verticalAlign:f,size:w,text:S}=o,b=()=>{const _=o.h+h;switch(o.geo){case"cloud":{if(u==="solid")return g.jsx(dY,{color:l,fill:d,strokeWidth:s,w:a,h:_,id:r,size:w});if(u==="dashed"||u==="dotted")return g.jsx(ZG,{color:l,fill:d,strokeWidth:s,w:a,h:_,id:r,size:w,dash:u});if(u==="draw")return g.jsx(oY,{color:l,fill:d,strokeWidth:s,w:a,h:_,id:r,size:w});break}case"ellipse":{if(u==="solid")return g.jsx(VM,{strokeWidth:s,w:a,h:_,color:l,fill:d});if(u==="dashed"||u==="dotted")return g.jsx(eY,{id:r,strokeWidth:s,w:a,h:_,dash:u,color:l,fill:d});if(u==="draw")return g.jsx(VM,{strokeWidth:s,w:a,h:_,color:l,fill:d});break}case"oval":{if(u==="solid")return g.jsx(HM,{strokeWidth:s,w:a,h:_,color:l,fill:d});if(u==="dashed"||u==="dotted")return g.jsx(nY,{id:r,strokeWidth:s,w:a,h:_,dash:u,color:l,fill:d});if(u==="draw")return g.jsx(HM,{strokeWidth:s,w:a,h:_,color:l,fill:d});break}default:{const x=this.editor.getShapeGeometry(t),P=x instanceof Ko?x.children[0].vertices:x.vertices,C=Ff(t.props,s);if(u==="solid")return g.jsx(fY,{fill:d,color:l,strokeWidth:s,outline:P,lines:C});if(u==="dashed"||u==="dotted")return g.jsx(rY,{dash:u,fill:d,color:l,strokeWidth:s,outline:P,lines:C});if(u==="draw")return g.jsx(lY,{id:r,fill:d,color:l,strokeWidth:s,outline:P,lines:C})}}};return g.jsxs(g.Fragment,{children:[g.jsx(ar,{id:r,children:b()}),g.jsxs(Gs,{id:t.id,style:{overflow:"hidden",width:t.props.w,height:t.props.h+o.growY},children:[g.jsx(AM,{id:r,type:i,font:p,fill:d,size:w,align:m,verticalAlign:f,text:S,labelColor:c,wrap:!0,bounds:o.geo==="cloud"?this.getGeometry(t).bounds:void 0}),t.props.url&&g.jsx(Ld,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(t){const{id:r,props:i}=t,{w:o,size:s}=i,a=i.h+i.growY,l=mn[s];switch(i.geo){case"ellipse":return i.dash==="draw"?g.jsx("path",{d:lv(r,o,a,l)}):g.jsx("ellipse",{cx:o/2,cy:a/2,rx:o/2,ry:a/2});case"oval":return g.jsx("path",{d:cv(o,a)});case"cloud":return g.jsx("path",{d:$d(o,a,r,s)});default:{const c=this.editor.getShapeGeometry(t),d=c instanceof Ko?c.children[0].vertices:c.vertices;let u;if(i.dash==="draw"){const p=Nd(r,d,0,l*2,1);u=zd(p)}else u="M"+d[0]+"L"+d.slice(1)+"Z";const h=Ff(t.props,l);if(h)for(const[p,m]of h)u+=`M${p.x},${p.y}L${m.x},${m.y}`;return g.jsx("path",{d:u})}}}toSvg(t,r){const{id:i,props:o}=t,s=mn[o.size],a=Vn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(Jb(t.props.fill,a));let l;switch(o.geo){case"ellipse":{switch(o.dash){case"draw":l=aY({id:i,w:o.w,h:o.h,color:o.color,fill:o.fill,strokeWidth:s,theme:a});break;case"solid":l=hY({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,theme:a});break;default:l=tY({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a});break}break}case"oval":{switch(o.dash){case"draw":l=FM({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a});break;case"solid":l=pY({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,theme:a});break;default:l=FM({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a})}break}case"cloud":{switch(o.dash){case"draw":l=sY({id:i,strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,size:o.size,theme:a});break;case"solid":l=uY({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,size:o.size,id:i,theme:a});break;default:l=QG({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a,size:o.size})}break}default:{const c=this.editor.getShapeGeometry(t),d=c instanceof Ko?c.children[0].vertices:c.vertices,u=Ff(t.props,s);switch(o.dash){case"draw":l=cY({id:i,fill:o.fill,color:o.color,strokeWidth:s,outline:d,lines:u,theme:a});break;case"solid":l=gY({fill:o.fill,color:o.color,strokeWidth:s,outline:d,lines:u,theme:a});break;default:l=iY({dash:o.dash,fill:o.fill,color:o.color,strokeWidth:s,outline:d,lines:u,theme:a});break}break}}if(o.text){const c=this.editor.getShapeGeometry(t).bounds;r.addExportDef(Mf(t.props.font));const d=TM({editor:this.editor,shape:t,font:qc[t.props.font],bounds:c}),u=d.cloneNode(!0);u.setAttribute("fill",a[t.props.labelColor].solid),u.setAttribute("stroke","none");const h=d.cloneNode(!0);h.setAttribute("stroke-width","2"),h.setAttribute("fill",a.background),h.setAttribute("stroke",a.background);const p=document.createElementNS("http://www.w3.org/2000/svg","g");if(p.append(h),p.append(u),l.nodeName==="g")return l.appendChild(p),l;{const m=document.createElementNS("http://www.w3.org/2000/svg","g");return m.appendChild(l),m.appendChild(p),m}}return l}getCanvasSvgDefs(){return[Zb()]}}y(zf,"type","geo"),y(zf,"props",IL),y(zf,"migrations",ML);function Nf(n,e){const t=e.props.text;if(!t)return{w:0,h:0};const r=n.textMeasure.measureText("w",{...Zt,fontFamily:so[e.props.font],fontSize:Cl[e.props.size],maxWidth:100}),i={s:2,m:3.5,l:5,xl:10},o=n.textMeasure.measureText(t,{...Zt,fontFamily:so[e.props.font],fontSize:Cl[e.props.size],minWidth:r.w+"px",maxWidth:Math.max(0,Math.ceil(r.w+i[e.props.size]),Math.ceil(e.props.w-dv*2))});return{w:o.w+dv*2,h:o.h+dv*2}}function Ff(n,e){switch(n.geo){case"x-box":return mY(n.w,n.h,e,n.dash);case"check-box":return yY(n.w,n.h);default:return}}function mY(n,e,t,r){const i=r==="draw"?.62:0;if(r==="dashed")return[[new k(0,0),new k(n/2,e/2)],[new k(n,e),new k(n/2,e/2)],[new k(0,e),new k(n/2,e/2)],[new k(n,0),new k(n/2,e/2)]];const o=a=>Math.max(0,Math.min(n,a)),s=a=>Math.max(0,Math.min(e,a));return[[new k(o(t*i),s(t*i)),new k(o(n-t*i),s(e-t*i))],[new k(o(t*i),s(e-t*i)),new k(o(n-t*i),s(t*i))]]}function yY(n,e){const t=Math.min(n,e)*.82,r=(n-t)/2,i=(e-t)/2,o=a=>Math.max(0,Math.min(n,a)),s=a=>Math.max(0,Math.min(e,a));return[[new k(o(r+t*.25),s(i+t*.52)),new k(o(r+t*.45),s(i+t*.82))],[new k(o(r+t*.45),s(i+t*.82)),new k(o(r+t*.82),s(i+t*.22))]]}function wY(){const[n,e]=v.useState(!1);return v.useEffect(()=>{const t=CSS.supports("color","color(display-p3 1 1 1)"),r=matchMedia("(color-gamut: p3)");e(t&&r.matches);const i=()=>e(t&&r.matches);return r.addEventListener("change",i),()=>r.removeEventListener("change",i)},[]),q(nt.forceSrgb)||!n?"srgb":"p3"}const WM=.35,KM=.82;class $f extends Yr{constructor(){super(...arguments);y(this,"hideResizeHandles",t=>Bf(t));y(this,"hideRotateHandle",t=>Bf(t));y(this,"hideSelectionBoundsFg",t=>Bf(t));y(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=[];for(const a of t.props.segments)s.push({...a,points:a.points.map(({x:l,y:c,z:d})=>({x:i*l,y:o*c,z:d}))});return{props:{segments:s}}})}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1}}getGeometry(t){const r=Al(t);if(Bf(t))return new dE({x:-r/2,y:-r/2,radius:r/2,isFilled:!0});const{strokePoints:i,sw:o}=GM(t,r,!0),s=iv({strokeWidth:o,showAsComplete:!0});return kl(i,s),new Bt({points:Ad(i,s),isFilled:!0})}component(t){return g.jsx(XM,{strokeWidth:Al(t),shape:t,opacity:WM})}backgroundComponent(t){return g.jsx(XM,{strokeWidth:Al(t),shape:t,opacity:KM})}indicator(t){var u;const r=jf(),i=Al(t),o=Ml(t.props.segments);let s=i;!r&&!t.props.isPen&&o.length===1&&(s+=Vo(t.id)()*(i/6));const a=t.props.isComplete||((u=Fn(t.props.segments))==null?void 0:u.type)==="straight",l=iv({strokeWidth:i,showAsComplete:a}),c=Jr(o,l);let d;return c.length<2?d=vY(o[0],s):d=is(c,!1),g.jsx("path",{d})}toSvg(t){const r=Vn({isDarkMode:this.editor.user.getIsDarkMode()});return qM(Al(t),t,WM,r)}toBackgroundSvg(t){const r=Vn({isDarkMode:this.editor.user.getIsDarkMode()});return qM(Al(t),t,KM,r)}}y($f,"type","highlight"),y($f,"props",jL),y($f,"migrations",RL);function bY(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function vY(n,e){const t=e/2;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function GM(n,e,t){var a;const r=Ml(n.props.segments),i=n.props.isComplete||((a=Fn(n.props.segments))==null?void 0:a.type)==="straight";let o=e;!t&&!n.props.isPen&&r.length===1&&(o+=Vo(n.id)()*(e/6));const s=iv({strokeWidth:o,showAsComplete:i});return{strokePoints:Jr(r,s),sw:o}}function YM(n,e,t){const{strokePoints:r,sw:i}=GM(n,e,t);return{solidStrokePath:r.length>1?is(r,!1):bY(n.props.segments[0].points[0]),sw:i}}function XM({strokeWidth:n,shape:e,opacity:t}){const r=Vt(),i=jf(),{solidStrokePath:o,sw:s}=YM(e,n,i),a=wY(),l=r[e.props.color].highlight[a];return g.jsx(ar,{id:e.id,style:{opacity:t},children:g.jsx("path",{d:o,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:l,strokeWidth:s})})}function qM(n,e,t,r){const{solidStrokePath:i,sw:o}=YM(e,n,!1),s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",i),s.setAttribute("fill","none"),s.setAttribute("stroke",r[e.props.color].highlight.srgb),s.setAttribute("stroke-width",`${o}`),s.setAttribute("opacity",`${t}`),s}function Al(n){return ts[n.props.size]*1.12}function Bf(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function JM(){const[n,e]=v.useState(!1);return v.useEffect(()=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(t.matches)};return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[]),n}const SY=async n=>new Promise((e,t)=>{const r=new Image;r.onload=()=>e(r),r.onerror=()=>t(new Error("Failed to load image")),r.crossOrigin="anonymous",r.src=n}),xY=async n=>{const e=await SY(n),t=document.createElement("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");if(r)return r.drawImage(e,0,0),t.toDataURL()};async function _Y(n){const e=await(await fetch(n)).blob();return new Promise((t,r)=>{const i=new FileReader;i.onloadend=()=>t(i.result),i.onerror=r,i.readAsDataURL(e)})}class Uf extends fl{constructor(){super(...arguments);y(this,"isAspectRatioLocked",()=>!0);y(this,"canCrop",()=>!0);y(this,"onDoubleClick",t=>{const r=t.props.assetId?this.editor.getAsset(t.props.assetId):void 0;!r||!(r.props.src&&"mimeType"in r.props&&r.props.mimeType==="image/gif")||this.editor.updateShapes([{type:"image",id:t.id,props:{playing:!t.props.playing}}])});y(this,"onDoubleClickEdge",t=>{const r=t.props;if(!r||this.editor.getCroppingShapeId()!==t.id)return;const i=ln(r.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},o=1/(i.bottomRight.x-i.topLeft.x)*t.props.w,s=1/(i.bottomRight.y-i.topLeft.y)*t.props.h,a=new k(i.topLeft.x*o,i.topLeft.y*s).rot(t.rotation),l={id:t.id,type:t.type,x:t.x-a.x,y:t.y-a.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:o,h:s}};this.editor.updateShapes([l])})}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}component(t){var u,h;const r=ZM(t),i=lE(t.id),o=JM(),[s,a]=v.useState(""),l=t.props.assetId?this.editor.getAsset(t.props.assetId):void 0;if((l==null?void 0:l.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const c=q("onlySelectedShape",()=>{var p;return t.id===((p=this.editor.getOnlySelectedShape())==null?void 0:p.id)},[this.editor])&&i&&this.editor.isInAny("select.crop","select.cropping","select.pointing_crop_handle"),d=o&&(((u=l==null?void 0:l.props.mimeType)==null?void 0:u.includes("video"))||((h=l==null?void 0:l.props.mimeType)==null?void 0:h.includes("gif")));return v.useEffect(()=>{if(l!=null&&l.props.src&&"mimeType"in l.props&&(l==null?void 0:l.props.mimeType)==="image/gif"){let p=!1;return(async()=>{const m=await xY(l.props.src);p||m&&a(m)})(),()=>{p=!0}}},[o,l==null?void 0:l.props]),g.jsxs(g.Fragment,{children:[(l==null?void 0:l.props.src)&&c&&g.jsx("div",{style:r,children:g.jsx("div",{className:"tl-image",style:{opacity:.1,backgroundImage:`url(${!t.props.playing||d?s:l.props.src})`},draggable:!1})}),g.jsxs(Gs,{id:t.id,style:{overflow:"hidden",width:t.props.w,height:t.props.h},children:[g.jsxs("div",{className:"tl-image-container",style:r,children:[l!=null&&l.props.src?g.jsx("div",{className:"tl-image",style:{backgroundImage:`url(${!t.props.playing||d?s:l.props.src})`},draggable:!1}):null,(l==null?void 0:l.props.isAnimated)&&!t.props.playing&&g.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),"url"in t.props&&t.props.url&&g.jsx(Ld,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(t){return lE(t.id)?null:g.jsx("rect",{width:R(t.props.w),height:R(t.props.h)})}async toSvg(t){var l;const r=document.createElementNS("http://www.w3.org/2000/svg","g");let i=((l=t.props.assetId?this.editor.getAsset(t.props.assetId):null)==null?void 0:l.props.src)||"";i&&i.startsWith("http")&&(i=await _Y(i)||"");const o=document.createElementNS("http://www.w3.org/2000/svg","image");o.setAttributeNS("http://www.w3.org/1999/xlink","href",i);const s=ZM(t),a=t.props.crop;if(s.transform&&a){const{transform:c,width:d,height:u}=s,h=(a.bottomRight.x-a.topLeft.x)*d,p=(a.bottomRight.y-a.topLeft.y)*u,m=[new k(0,0),new k(h,0),new k(h,p),new k(0,p)],f=document.createElementNS("http://www.w3.org/2000/svg","polygon");f.setAttribute("points",m.map(_=>`${_.x},${_.y}`).join(" "));const w=document.createElementNS("http://www.w3.org/2000/svg","clipPath");w.setAttribute("id","cropClipPath"),w.appendChild(f);const S=document.createElementNS("http://www.w3.org/2000/svg","defs");S.appendChild(w),r.appendChild(S);const b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttribute("clip-path","url(#cropClipPath)"),o.setAttribute("width",d.toString()),o.setAttribute("height",u.toString()),o.style.transform=c,b.appendChild(o),r.appendChild(b)}else o.setAttribute("width",t.props.w.toString()),o.setAttribute("height",t.props.h.toString()),r.appendChild(o);return r}}y(Uf,"type","image"),y(Uf,"props",DL),y(Uf,"migrations",LL);function ZM(n){const e=n.props.crop,t=e==null?void 0:e.topLeft;if(!t)return{width:n.props.w,height:n.props.h};const r=1/(e.bottomRight.x-e.topLeft.x)*n.props.w,i=1/(e.bottomRight.y-e.topLeft.y)*n.props.h,o=-t.x*r,s=-t.y*i;return{transform:`translate(${o}px, ${s}px)`,width:r,height:i}}function uv(n,e){const{start:t,end:r}=n;return e?`M${R(t.x)},${R(t.y)} L${R(r.x)},${R(r.y)} `:`${R(r.x)},${R(r.y)} `}function hv(n,e){const{a:t,b:r,c:i,d:o}=n;return k.Equals(t,o)?"":`${e?`M${R(t.x)},${R(t.y)}`:""}C${R(r.x)},${R(r.y)} ${R(i.x)},${R(i.y)} ${R(o.x)},${R(o.y)}`}function QM(n,e){let t=n.segments.reduce((r,i,o)=>r+hv(i,o===0),"");return e&&(t+="Z"),t}function kY(n,e){let t=n.segments.reduce((r,i,o)=>r+uv(i,o===0),"");return e&&(t+="Z"),t}function eA(n,e=!1){return n instanceof Vs?kY(n,e):QM(n,e)}function tA(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function nA(n,e,t){const r=e.vertices,i=tA(t);return Jr(r,i)}function CY(n,e,t){const r=tA(t);return Ad(kl(nA(n,e,t),r),r)}function rA(n,e,t){const r=CY(n,e,t);return ud(r)}function PY(n,e,t){if(n.props.dash==="draw"){const r=nA(n,e,t);return is(r)}return eA(e)}const EY=new Pw;class Vf extends Yr{constructor(){super(...arguments);y(this,"hideResizeHandles",()=>!0);y(this,"hideRotateHandle",()=>!0);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"hideSelectionBoundsBg",()=>!0);y(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=ln(t.props.handles);return Object.values(t.props.handles).forEach(({id:a,x:l,y:c})=>{s[a].x=l*i,s[a].y=c*o}),{props:{handles:s}}});y(this,"onHandleChange",(t,{handle:r})=>{const i=ln(t);switch(r.id){case"start":case"end":{i.props.handles[r.id]={...i.props.handles[r.id],x:r.x,y:r.y};break}default:{const o="handle:"+r.index,s=t.props.handles[o];s?i.props.handles[o]={...s,x:r.x,y:r.y}:i.props.handles[o]={id:o,type:"vertex",canBind:!1,index:r.index,x:r.x,y:r.y};break}}return i})}getDefaultProps(){return{dash:"draw",size:"m",color:"black",spline:"line",handles:{start:{id:"start",type:"vertex",canBind:!1,canSnap:!0,index:"a1",x:0,y:0},end:{id:"end",type:"vertex",canBind:!1,canSnap:!0,index:"a2",x:.1,y:.1}}}}getGeometry(t){return Bd(t)}getHandles(t){return EY.get(t.props,()=>{const r=t.props.handles,i=Bd(t),o=Object.values(r).sort(gn),s=o.slice();for(let a=0;a<i.segments.length;a++){const l=i.segments[a].midPoint(),c=wd(o[a].index,o[a+1].index);s.push({id:`mid-${a}`,type:"create",index:c,x:l.x,y:l.y})}return s.sort(gn)})}getOutlineSegments(t){return this.editor.getShapeGeometry(t).segments.map(r=>r.vertices)}component(t){const r=Vt(),i=Bd(t),o=mn[t.props.size],{dash:s,color:a}=t.props;if(t.props.spline==="line"){if(s==="solid"){const l=i.points,c="M"+l[0]+"L"+l.slice(1);return g.jsxs(ar,{id:t.id,children:[g.jsx(At,{d:c,fill:"none",color:a,theme:r}),g.jsx("path",{d:c,stroke:r[a].solid,strokeWidth:o,fill:"none"})]})}if(s==="dashed"||s==="dotted"){const l=i.points,c="M"+l[0]+"L"+l.slice(1);return g.jsxs(ar,{id:t.id,children:[g.jsx(At,{d:c,fill:"none",color:a,theme:r}),g.jsx("g",{stroke:r[a].solid,strokeWidth:o,children:i.segments.map((d,u)=>{const{strokeDasharray:h,strokeDashoffset:p}=yn(d.length,o,{style:s,start:u>0?"outset":"none",end:u<i.segments.length-1?"outset":"none"});return g.jsx("path",{strokeDasharray:h,strokeDashoffset:p,d:uv(d,!0),fill:"none"},u)})})]})}if(s==="draw"){const l=i.points,[c,d]=av(t.id,l,o);return g.jsxs(ar,{id:t.id,children:[g.jsx(At,{d:c,fill:"none",color:a,theme:r}),g.jsx("path",{d,stroke:r[a].solid,strokeWidth:o,fill:"none"})]})}}if(t.props.spline==="cubic"){const l=eA(i);if(s==="solid")return g.jsxs(ar,{id:t.id,children:[g.jsx(At,{d:l,fill:"none",color:a,theme:r}),g.jsx("path",{strokeWidth:o,stroke:r[a].solid,fill:"none",d:l})]});if(s==="dashed"||s==="dotted")return g.jsxs(ar,{id:t.id,children:[g.jsx(At,{d:l,fill:"none",color:a,theme:r}),g.jsx("g",{stroke:r[a].solid,strokeWidth:o,children:i.segments.map((c,d)=>{const{strokeDasharray:u,strokeDashoffset:h}=yn(c.length,o,{style:s,start:d>0?"outset":"none",end:d<i.segments.length-1?"outset":"none"});return g.jsx("path",{strokeDasharray:u,strokeDashoffset:h,d:hv(c,!0),fill:"none"},d)})})]});if(s==="draw")return g.jsxs(ar,{id:t.id,children:[g.jsx(At,{d:l,fill:"none",color:a,theme:r}),g.jsx("path",{d:rA(t,i,o),strokeWidth:1,stroke:r[a].solid,fill:r[a].solid})]})}}indicator(t){const r=mn[t.props.size],i=Bd(t),{dash:o}=t.props;let s;if(t.props.spline==="line"){const a=i.points;if(o==="solid"||o==="dotted"||o==="dashed")s="M"+a[0]+"L"+a.slice(1);else{const[l]=av(t.id,a,r);s=l}}else s=PY(t,i,r);return g.jsx("path",{d:s})}toSvg(t){const r=Vn({isDarkMode:this.editor.user.getIsDarkMode()})[t.props.color].solid,i=Bd(t),o=mn[t.props.size];switch(t.props.dash){case"draw":{let s;if(i instanceof Jp)s=rA(t,i,o);else{const[l,c]=av(t.id,i.points,o);s=c}const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("stroke-width",o+"px"),a.setAttribute("stroke",r),a.setAttribute("fill","none"),a.setAttribute("d",s),a}case"solid":{let s;if(i instanceof Jp)s=QM(i,!1);else{const l=i.points;s="M"+l[0]+"L"+l.slice(1)}const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("stroke-width",o+"px"),a.setAttribute("stroke",r),a.setAttribute("fill","none"),a.setAttribute("d",s),a}default:{const{segments:s}=i,a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("stroke",r),a.setAttribute("stroke-width",o.toString());const l=i instanceof Jp?hv:uv;return s.forEach((c,d)=>{const u=document.createElementNS("http://www.w3.org/2000/svg","path"),{strokeDasharray:h,strokeDashoffset:p}=yn(c.length,o,{style:t.props.dash,start:d>0?"outset":"none",end:d<s.length-1?"outset":"none"});u.setAttribute("stroke-dasharray",h.toString()),u.setAttribute("stroke-dashoffset",p.toString()),u.setAttribute("d",l(c,!0)),u.setAttribute("fill","none"),a.appendChild(u)}),a}}}}y(Vf,"type","line"),y(Vf,"props",FL),y(Vf,"migrations",$L);function Bd(n){const{spline:e,handles:t}=n.props,r=Object.values(t).sort(gn).map(k.From);switch(e){case"cubic":return new Jp({points:r});case"line":return new Vs({points:r})}}const lo=200;class Hf extends Yr{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"hideResizeHandles",()=>!0);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"onBeforeCreate",t=>iA(this.editor,t,t.props.growY));y(this,"onBeforeUpdate",(t,r)=>{if(!(t.props.text===r.props.text&&t.props.font===r.props.font&&t.props.size===r.props.size))return iA(this.editor,r,t.props.growY)});y(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t;o.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])})}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,url:""}}getHeight(t){return lo+t.props.growY}getGeometry(t){const r=this.getHeight(t);return new Go({width:lo,height:r,isFilled:!0})}component(t){const{id:r,type:i,props:{color:o,font:s,size:a,align:l,text:c,verticalAlign:d}}=t,u=Vt(),h=o==="black"?"yellow":o;return g.jsxs(g.Fragment,{children:[g.jsx("div",{style:{position:"absolute",width:lo,height:this.getHeight(t)},children:g.jsxs("div",{className:"tl-note__container",style:{color:u[h].solid,backgroundColor:u[h].solid},children:[g.jsx("div",{className:"tl-note__scrim"}),g.jsx(AM,{id:r,type:i,font:s,size:a,align:l,verticalAlign:d,text:c,labelColor:"black",wrap:!0})]})}),"url"in t.props&&t.props.url&&g.jsx(Ld,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(t){return g.jsx("rect",{rx:"7",width:R(lo),height:R(this.getHeight(t))})}toSvg(t,r){r.addExportDef(Mf(t.props.font));const i=Vn({isDarkMode:this.editor.user.getIsDarkMode()}),o=this.editor.getShapeGeometry(t).bounds,s=document.createElementNS("http://www.w3.org/2000/svg","g"),a=t.props.color==="black"?"yellow":t.props.color,l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("rx","10"),l.setAttribute("width",lo.toString()),l.setAttribute("height",o.height.toString()),l.setAttribute("fill",i[a].solid),l.setAttribute("stroke",i[a].solid),l.setAttribute("stroke-width","1"),s.appendChild(l);const c=document.createElementNS("http://www.w3.org/2000/svg","rect");c.setAttribute("rx","10"),c.setAttribute("width",lo.toString()),c.setAttribute("height",o.height.toString()),c.setAttribute("fill",i.background),c.setAttribute("opacity",".28"),s.appendChild(c);const d=TM({editor:this.editor,shape:t,font:qc[t.props.font],bounds:o});return d.setAttribute("fill",i.text),d.setAttribute("stroke","none"),s.appendChild(d),s}}y(Hf,"type","note"),y(Hf,"props",BL),y(Hf,"migrations",UL);function iA(n,e,t=0){const r=n.textMeasure.measureText(e.props.text,{...Zt,fontFamily:so[e.props.font],fontSize:Cl[e.props.size],maxWidth:lo-34}).h+34;let i=null;if(r>lo?i=r-lo:t&&(i=0),i!==null)return{...e,props:{...e.props,growY:i}}}function IY(n,{initialBounds:e,scaleX:t,scaleY:r,newPoint:i}){const o=Math.max(.01,Math.min(Math.abs(t),Math.abs(r))),s=new k(0,0);t<0&&(s.x=-(e.width*o)),r<0&&(s.y=-(e.height*o));const{x:a,y:l}=k.Add(i,s.rot(n.rotation));return{x:a,y:l,props:{scale:o*n.props.scale}}}const MY=new Pw;class Wf extends Yr{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"isAspectRatioLocked",()=>!0);y(this,"onResize",(t,r)=>{const{initialBounds:i,initialShape:o,scaleX:s,handle:a}=r;if(r.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:t.id,type:t.type,...IY(t,r)};{const l=i.width;let c=l*s;const d=new k(0,0);c=Math.max(1,Math.abs(c)),a==="left"?(d.x=l-c,s<0&&(d.x+=c)):s<0&&(d.x-=c);const{x:u,y:h}=d.rot(t.rotation).add(o);return{id:t.id,type:t.type,x:u,y:h,props:{w:c/o.props.scale,autoSize:!1}}}});y(this,"onBeforeCreate",t=>{if(!t.props.autoSize||t.props.text.trim())return;const r=this.getMinDimensions(t);return{...t,x:t.x-r.width/2,y:t.y-r.height/2}});y(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t,s=t.props.text.trimEnd();s.length===0?this.editor.deleteShapes([t.id]):s!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])});y(this,"onBeforeUpdate",(t,r)=>{if(!r.props.autoSize)return;const i=t.props.size!==r.props.size||t.props.align!==r.props.align||t.props.font!==r.props.font||t.props.scale!==1&&r.props.scale===1,o=t.props.text!==r.props.text;if(!i&&!o)return;const s=this.getMinDimensions(t),a=oA(this.editor,r.props),l=s.width*t.props.scale,c=s.height*t.props.scale,d=a.width*r.props.scale,u=a.height*r.props.scale;let h;switch(r.props.align){case"middle":{h=new k((d-l)/2,o?0:(u-c)/2);break}case"end":{h=new k(d-l,o?0:(u-c)/2);break}default:{if(o)break;h=new k(0,(u-c)/2);break}}if(h){h.rot(r.rotation);const{x:p,y:m}=r;return{...r,x:p-h.x,y:m-h.y,props:{...r.props,w:d}}}else return{...r,props:{...r.props,w:d}}});y(this,"onDoubleClickEdge",t=>{if(!t.props.autoSize)return{id:t.id,type:t.type,props:{autoSize:!0}};if(t.props.scale!==1)return{id:t.id,type:t.type,props:{scale:1}}})}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",align:"middle",autoSize:!0,scale:1}}getMinDimensions(t){return MY.get(t.props,r=>oA(this.editor,r))}getGeometry(t){const{scale:r}=t.props,{width:i,height:o}=this.getMinDimensions(t);return new Go({width:i*r,height:o*r,isFilled:!0})}component(t){const{id:r,type:i,props:{text:o,color:s}}=t,a=Vn({isDarkMode:this.editor.user.getIsDarkMode()}),{width:l,height:c}=this.getMinDimensions(t),{rInput:d,isEmpty:u,isEditing:h,handleFocus:p,handleChange:m,handleKeyDown:f,handleBlur:w,handleInputPointerDown:S,handleDoubleClick:b}=tv(r,i,o);return g.jsx(Gs,{id:t.id,children:g.jsxs("div",{className:"tl-text-shape__wrapper tl-text-shadow","data-font":t.props.font,"data-align":t.props.align,"data-hastext":!u,"data-isediting":h,"data-textwrap":!0,style:{fontSize:ts[t.props.size],lineHeight:ts[t.props.size]*Zt.lineHeight+"px",transform:`scale(${t.props.scale})`,transformOrigin:"top left",width:Math.max(1,l),height:Math.max(ts[t.props.size]*Zt.lineHeight,c),color:a[s].solid},children:[g.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",children:o}),h?g.jsx("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:h,placeholder:"",spellCheck:"true",wrap:"off",dir:"ltr",datatype:"wysiwyg",defaultValue:o,onFocus:p,onChange:m,onKeyDown:f,onBlur:w,onTouchEnd:Ft,onContextMenu:Ft,onPointerDown:S,onDoubleClick:b}):null]})})}indicator(t){const r=this.editor.getShapeGeometry(t).bounds,i=G();return t.props.autoSize&&i.getEditingShapeId()===t.id?null:g.jsx("rect",{width:R(r.width),height:R(r.height)})}toSvg(t,r){r.addExportDef(Mf(t.props.font));const i=Vn({isDarkMode:this.editor.user.getIsDarkMode()}),o=this.editor.getShapeGeometry(t).bounds,s=t.props.text,a=o.width/(t.props.scale??1),l=o.height/(t.props.scale??1),c={fontSize:ts[t.props.size],fontFamily:qc[t.props.font],textAlign:t.props.align,verticalTextAlign:"middle",width:a,height:l,padding:0,lineHeight:Zt.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},d=i[t.props.color].solid,u=document.createElementNS("http://www.w3.org/2000/svg","g"),h=If(this.editor,this.editor.textMeasure.measureTextSpans(s,c),{...c,stroke:i.background,strokeWidth:2,fill:i.background,padding:0}),p=h.cloneNode(!0);return p.setAttribute("fill",d),p.setAttribute("stroke","none"),u.append(h),u.append(p),u}}y(Wf,"type","text"),y(Wf,"props",VL),y(Wf,"migrations",HL);function oA(n,e){const{font:t,text:r,autoSize:i,size:o,w:s}=e,a=i?16:Math.max(16,s),l=ts[o],c=i?null:Math.floor(Math.max(a,s)),d=n.textMeasure.measureText(r,{...Zt,fontFamily:so[t],fontSize:l,maxWidth:c});return i&&(d.w+=1),{width:Math.max(a,d.w),height:Math.max(l,d.h)}}class Kf extends fl{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(t){return g.jsx(TY,{shape:t,videoUtil:this})}indicator(t){return g.jsx("rect",{width:R(t.props.w),height:R(t.props.h)})}toSvg(t){const r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","image");return i.setAttributeNS("http://www.w3.org/1999/xlink","href",AY(t.id)),i.setAttribute("width",t.props.w.toString()),i.setAttribute("height",t.props.h.toString()),r.appendChild(i),r}}y(Kf,"type","video"),y(Kf,"props",WL),y(Kf,"migrations",KL);function AY(n){const e=n.split(":")[1],t=document.querySelector(`.tl-video-shape-${e}`);if(t){const r=document.createElement("canvas");return r.width=t.videoWidth,r.height=t.videoHeight,r.getContext("2d").drawImage(t,0,0),r.toDataURL("image/png")}else throw new Error("Video with id "+e+" not found")}const TY=ze(function(n){const{shape:e,videoUtil:t}=n,r=t.editor.getShapeGeometry(e).bounds.w*t.editor.getZoomLevel()>=110,i=e.props.assetId?t.editor.getAsset(e.props.assetId):null,{time:o,playing:s}=e.props,a=qp(e.id),l=JM(),c=re.useRef(null),d=re.useCallback(w=>{const S=w.currentTarget;t.editor.updateShapes([{type:"video",id:e.id,props:{playing:!0,time:S.currentTime}}])},[e.id,t.editor]),u=re.useCallback(w=>{const S=w.currentTarget;t.editor.updateShapes([{type:"video",id:e.id,props:{playing:!1,time:S.currentTime}}])},[e.id,t.editor]),h=re.useCallback(w=>{const S=w.currentTarget;a&&t.editor.updateShapes([{type:"video",id:e.id,props:{time:S.currentTime}}])},[a,e.id,t.editor]),[p,m]=re.useState(!1),f=re.useCallback(w=>{const S=w.currentTarget;o!==S.currentTime&&(S.currentTime=o),s||S.pause(),m(!0)},[s,o]);return re.useEffect(()=>{const w=c.current;w&&(p&&!a&&o!==w.currentTime&&(w.currentTime=o),a&&document.activeElement!==w&&w.focus())},[a,p,o]),re.useEffect(()=>{if(l){const w=c.current;w.pause(),w.currentTime=0}},[c,l]),g.jsxs(g.Fragment,{children:[g.jsx(Gs,{id:e.id,children:g.jsx("div",{className:"tl-counter-scaled",children:i!=null&&i.props.src?g.jsx("video",{ref:c,style:a?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${e.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:a&&r,onPlay:d,onPause:u,onTimeUpdate:h,onLoadedData:f,hidden:!p,children:g.jsx("source",{src:i.props.src})}):null})}),"url"in e.props&&e.props.url&&g.jsx(Ld,{url:e.props.url,zoomLevel:t.editor.getZoomLevel()})]})}),jY=[Wf,Tf,Of,zf,Hf,Vf,Lf,Af,$f,Df,Uf,Kf];function RY(n){return[n.sideEffects.registerAfterChangeHandler("instance",(e,t)=>{e.isFocused!==t.isFocused&&(t.isFocused?(n.getContainer().focus(),n.updateViewportScreenBounds()):(n.complete(),n.getContainer().blur(),n.updateViewportScreenBounds()))}),n.sideEffects.registerAfterChangeHandler("instance_page_state",(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const r=n.isInAny("select.crop","select.pointing_crop_handle","select.cropping");!e.croppingShapeId&&t.croppingShapeId?r||n.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&r&&n.setCurrentTool("select.idle")}e.editingShapeId!==t.editingShapeId&&(!e.editingShapeId&&t.editingShapeId?n.isIn("select.editing_shape")||n.setCurrentTool("select.editing_shape"):e.editingShapeId&&!t.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle"))})]}class sA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"scribbleId","id");y(this,"markId","");y(this,"excludedShapeIds",new Set);y(this,"onEnter",t=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=t;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(o=>{if(this.editor.isShapeOrAncestorLocked(o))return!0;if(this.editor.isShapeOfType(o,"group")||this.editor.isShapeOfType(o,"frame")){const s=this.editor.getPointInShapeSpace(o,r);return this.editor.getShapeGeometry(o).bounds.containsPoint(s)}return!1}).map(o=>o.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()});y(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)});y(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});y(this,"onPointerMove",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()})}update(){const t=this.editor.getErasingShapeIds(),r=this.editor.getZoomLevel(),i=this.editor.getCurrentPageShapes(),{inputs:{currentPagePoint:o,previousPagePoint:s}}=this.editor,{excludedShapeIds:a}=this;this.pushPointToScribble();const l=new Set(t);for(const c of i){if(this.editor.isShapeOfType(c,"group"))continue;const d=this.editor.getShapeMask(c.id);if(d&&!bi(o,d))continue;const u=this.editor.getShapeGeometry(c),h=this.editor.getPointInShapeSpace(c,s),p=this.editor.getPointInShapeSpace(c,o);u.hitTestLineSegment(h,p,Gr/r)&&l.add(this.editor.getOutermostSelectableShape(c).id)}this.editor.setErasingShapes([...l].filter(c=>!a.has(c)))}complete(){this.editor.deleteShapes(this.editor.getCurrentPageState().erasingShapeIds),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}y(sA,"id","erasing");let OY=(TS=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(TS,"id","idle"),TS),DY=(jS=class extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,i=new Set,o=i.size;for(let s=t.length,a=s-1;a>=0;a--){const l=t[a];if(!(this.editor.isShapeOrAncestorLocked(l)||this.editor.isShapeOfType(l,"group"))&&this.editor.isPointInShape(l,r,{hitInside:!1,margin:Gr/e})){const c=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(c,"frame")&&i.size>o)break;i.add(c.id)}}this.editor.setErasingShapes([...i])});y(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.parent.transition("erasing",e)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},y(jS,"id","pointing"),jS);class Gf extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}y(Gf,"id","eraser"),y(Gf,"initial","idle"),y(Gf,"children",()=>[OY,DY,sA]);class aA extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.update()});y(this,"onPointerMove",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()})}update(){const{currentScreenPoint:t,previousScreenPoint:r}=this.editor.inputs,i=k.Sub(t,r);(Math.abs(i.x)>0||Math.abs(i.y)>0)&&this.editor.pan(i)}complete(){this.editor.slideCamera({speed:Math.min(2,this.editor.inputs.pointerVelocity.len()),direction:this.editor.inputs.pointerVelocity,friction:Pp}),this.parent.transition("idle")}}y(aA,"id","dragging");let LY=(RS=class extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.setCursor({type:"grab",rotation:0})});y(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(RS,"id","idle"),RS),zY=(OS=class extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.stopCameraAnimation(),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})});y(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.parent.transition("dragging",e)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.complete()})}complete(){this.parent.transition("idle")}},y(OS,"id","pointing"),OS);class Yf extends ae{constructor(){super(...arguments);y(this,"onDoubleClick",t=>{if(t.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomIn(r,{duration:220,easing:pn.easeOutQuint})}});y(this,"onTripleClick",t=>{if(t.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomOut(r,{duration:320,easing:pn.easeOutQuint})}});y(this,"onQuadrupleClick",t=>{if(t.phase==="settle"){const r=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:i}}=this.editor;r===1?this.editor.zoomToFit({duration:400,easing:pn.easeOutQuint}):this.editor.resetZoom(i,{duration:320,easing:pn.easeOutQuint})}})}}y(Yf,"id","hand"),y(Yf,"initial","idle"),y(Yf,"children",()=>[LY,zY,aA]);let NY=(DS=class extends ae{constructor(){super(...arguments);y(this,"onPointerDown",e=>{this.parent.transition("lasering",e)})}},y(DS,"id","idle"),DS);class lA extends ae{constructor(){super(...arguments);y(this,"scribbleId","id");y(this,"onEnter",()=>{const t=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=t.id,this.pushPointToScribble()});y(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});y(this,"onPointerMove",()=>{this.pushPointToScribble()});y(this,"onPointerUp",()=>{this.complete()});y(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()})}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}y(lA,"id","lasering");class Xf extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}y(Xf,"id","laser"),y(Xf,"initial","idle"),y(Xf,"children",()=>[NY,lA]);class cA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"brush",new de);y(this,"initialSelectedShapeIds",[]);y(this,"excludedShapeIds",new Set);y(this,"initialStartShape",null);y(this,"onEnter",t=>{const{altKey:r,currentPagePoint:i}=this.editor.inputs;if(r){this.parent.transition("scribble_brushing",t);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(o=>this.editor.isShapeOfType(o,"group")||this.editor.isShapeOrAncestorLocked(o)).map(o=>o.id)),this.info=t,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(i)[0],this.onPointerMove()});y(this,"onExit",()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})});y(this,"onTick",()=>{$w(this.editor)});y(this,"onPointerMove",()=>{this.hitTestShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",t=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds,{squashing:!0}),this.parent.transition("idle",t)});y(this,"onKeyDown",t=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",t):this.hitTestShapes()});y(this,"onKeyUp",()=>{this.hitTestShapes()});y(this,"onInterrupt",()=>{this.editor.updateInstanceState({brush:null})})}complete(){this.parent.transition("idle")}hitTestShapes(){const t=this.editor.getZoomLevel(),r=this.editor.getCurrentPageShapes(),i=this.editor.getCurrentPageId(),{inputs:{originPagePoint:o,currentPagePoint:s,shiftKey:a,ctrlKey:l}}=this.editor;this.brush.setTo(de.FromPoints([o,s]));const c=new Set(a?this.initialSelectedShapeIds:[]);let d,u,h,p,m,f;const{corners:w}=this.brush,{excludedShapeIds:S}=this;e:for(let b=0,_=r.length;b<_;b++){if(h=r[b],S.has(h.id)||c.has(h.id)||(p=this.editor.getShapePageBounds(h),!p))continue e;if(this.brush.contains(p)){this.handleHit(h,s,i,c,w);continue e}if(l||this.editor.isShapeOfType(h,"frame"))continue e;if(this.brush.collides(p)){const x=this.editor.getShapeGeometry(h);if(m=this.editor.getShapePageTransform(h),!m)continue e;f=m.clone().invert().applyToPoints(w);t:for(let P=0;P<f.length;P++)if(d=f[P],u=f[(P+1)%f.length],x.hitTestLineSegment(d,u,Gr/t)){this.handleHit(h,s,i,c,w);break t}}}this.editor.updateInstanceState({brush:{...this.brush.toJson()}}),this.editor.setSelectedShapes(Array.from(c),{squashing:!0})}handleHit(t,r,i,o,s){if(t.parentId===i){o.add(t.id);return}const a=this.editor.getOutermostSelectableShape(t),l=this.editor.getShapeMask(a.id);l&&!fF(l,s)&&!bi(r,l)||o.add(a.id)}}y(cA,"id","brushing");function pv(n){const e=n.getZoomLevel(),{inputs:{currentPagePoint:t}}=n;return n.getShapeAtPoint(t,{hitInside:!1,hitLabels:!1,margin:Gr/e,renderingOnly:!0})??n.getSelectedShapeAtPoint(t)}function dA(n,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const i=n.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;i==="x"?t.x=0:i==="y"&&(t.y=0),t.rot(-e.rotation);const o=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,s=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=r.bottomRight.y-r.topLeft.y,l=r.bottomRight.x-r.topLeft.x,c=ln(r);return c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-t.x/o)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-t.y/s)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a,{id:e.id,type:e.type,props:{crop:c}}}let FY=(LS=class extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0});const e=this.editor.getOnlySelectedShape();this.editor.on("change-history",this.cleanupCroppingState),e&&(this.editor.mark("crop"),this.editor.setCroppingShape(e.id))});y(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.off("change-history",this.cleanupCroppingState)});y(this,"onCancel",()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})});y(this,"onPointerDown",e=>{var t;if(!this.editor.getIsMenuOpen()){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=pv(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(t=this.editor.getShapeUtil(e.shape))!=null&&t.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop"});break}case"top":case"right":case"bottom":case"left":{this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break}default:this.cancel()}break}}}});y(this,"onDoubleClick",e=>{var o;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const t=this.editor.getCroppingShapeId();if(!t)return;const r=this.editor.getShape(t);if(!r)return;const i=this.editor.getShapeUtil(r);i&&e.target==="selection"&&((o=i.onDoubleClickEdge)==null||o.call(i,r))});y(this,"onKeyDown",()=>{this.nudgeCroppingImage(!1)});y(this,"onKeyRepeat",()=>{this.nudgeCroppingImage(!0)});y(this,"onKeyUp",e=>{switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}});y(this,"cleanupCroppingState",()=>{this.editor.getCroppingShapeId()||this.editor.setCurrentTool("select.idle",{})})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),i=new k(0,0);if(t.has("ArrowLeft")&&(i.x+=1),t.has("ArrowRight")&&(i.x-=1),t.has("ArrowUp")&&(i.y+=1),t.has("ArrowDown")&&(i.y-=1),i.equals(new k(0,0)))return;r&&i.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const s=dA(this.editor,o,i);s&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([s]))}},y(LS,"id","idle"),LS);class uA extends ae{constructor(){super(...arguments);y(this,"onCancel",()=>{this.editor.setCurrentTool("select.crop.idle",{})});y(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",t)});y(this,"onPointerUp",t=>{this.editor.setCurrentTool("select.crop.idle",t)})}}y(uA,"id","pointing_crop");class hA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"markId","translating crop");y(this,"snapshot",{});y(this,"onEnter",t=>{this.info=t,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()});y(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onKeyDown",t=>{switch(t.key){case"Alt":case"Shift":{this.updateShapes();return}}});y(this,"onKeyUp",t=>{switch(t.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}})}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const t=this.snapshot.shape;if(!t)return;const{originPagePoint:r,currentPagePoint:i}=this.editor.inputs,o=i.clone().sub(r),s=dA(this.editor,t,o);s&&this.editor.updateShapes([s],{squashing:!0})}}y(hA,"id","translating_crop");class qf extends ae{}y(qf,"id","crop"),y(qf,"initial","idle"),y(qf,"children",()=>[FY,hA,uA]);const Ar=8,Tl={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class pA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t,this.updateCursor()});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("resizing",this.info)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const t=this.editor.getSelectedShapes(),r=Tl[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:t.length===1?t[0].rotation:0}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}y(pA,"id","pointing_resize_handle");class fA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"markId","");y(this,"snapshot",{});y(this,"onEnter",t=>{this.info=t,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"getDefaultCrop",()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}))}updateCursor(){const t=this.editor.getSelectedShapes()[0];if(!t)return;const r=Tl[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:t.rotation}})}updateShapes(){const{shape:t,cursorHandleOffset:r}=this.snapshot;if(!t||!this.editor.getShapeUtil("image"))return;const i=t.props,o=this.editor.inputs.currentPagePoint.clone().sub(r),s=this.editor.inputs.originPagePoint.clone().sub(r),a=o.clone().sub(s).rot(-t.rotation),l=i.crop??this.getDefaultCrop(),c=ln(l),d=new k(t.x,t.y),u=new k(0,0),h=1/(l.bottomRight.x-l.topLeft.x)*i.w,p=1/(l.bottomRight.y-l.topLeft.y)*i.h;let m=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(p<Ar)break;m=!0,c.topLeft.y=c.topLeft.y+a.y/p,p*(c.bottomRight.y-c.topLeft.y)<Ar?(c.topLeft.y=c.bottomRight.y-Ar/p,u.y=(c.topLeft.y-l.topLeft.y)*p):c.topLeft.y<=0?(c.topLeft.y=0,u.y=(c.topLeft.y-l.topLeft.y)*p):u.y=a.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(p<Ar)break;m=!0,c.bottomRight.y=Math.min(1,c.bottomRight.y+a.y/p),p*(c.bottomRight.y-c.topLeft.y)<Ar&&(c.bottomRight.y=c.topLeft.y+Ar/p);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(h<Ar)break;m=!0,c.topLeft.x=c.topLeft.x+a.x/h,h*(c.bottomRight.x-c.topLeft.x)<Ar?(c.topLeft.x=c.bottomRight.x-Ar/h,u.x=(c.topLeft.x-l.topLeft.x)*h):c.topLeft.x<=0?(c.topLeft.x=0,u.x=(c.topLeft.x-l.topLeft.x)*h):u.x=a.x;break}case"right":case"top_right":case"bottom_right":{if(h<Ar)break;m=!0,c.bottomRight.x=Math.min(1,c.bottomRight.x+a.x/h),h*(c.bottomRight.x-c.topLeft.x)<Ar&&(c.bottomRight.x=c.topLeft.x+Ar/h);break}}if(!m)return;d.add(u.rot(t.rotation));const f={id:t.id,type:t.type,x:d.x,y:d.y,props:{crop:c,w:(c.bottomRight.x-c.topLeft.x)*h,h:(c.bottomRight.y-c.topLeft.y)*p}};this.editor.updateShapes([f],{squashing:!0}),this.updateCursor()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}createSnapshot(){const t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,i=this.editor.getOnlySelectedShape(),o=this.editor.getSelectionRotatedPageBounds(),s=k.RotWith(o.getHandlePoint(this.info.handle),o.point,t),a=k.Sub(r,s);return{shape:i,cursorHandleOffset:a}}}y(fA,"id","cropping");class gA extends ae{constructor(){super(...arguments);y(this,"shapeId","");y(this,"initialHandle",{});y(this,"initialAdjacentHandle",null);y(this,"initialPagePoint",{});y(this,"markId","");y(this,"initialPageTransform");y(this,"initialPageRotation");y(this,"info",{});y(this,"isPrecise",!1);y(this,"isPreciseId",null);y(this,"pointingId",null);y(this,"onEnter",t=>{const{shape:r,isCreating:i,handle:o}=t;this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.shapeId=r.id,this.markId=i?`creating:${r.id}`:"dragging handle",i||this.editor.mark(this.markId),this.initialHandle=ln(o),this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.updateInstanceState({cursor:{type:i?"cross":"grabbing",rotation:0}},{ephemeral:!0});const s=this.editor.getShapeHandles(r).sort(gn),a=s.findIndex(c=>c.id===t.handle.id);this.initialAdjacentHandle=null;for(let c=a+1;c<s.length;c++){const d=s[c];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==t.handle.id){this.initialAdjacentHandle=d;break}}if(!this.initialAdjacentHandle)for(let c=s.length-1;c>=0;c--){const d=s[c];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==t.handle.id){this.initialAdjacentHandle=d;break}}const l=r.props[t.handle.id];this.isPrecise=!1,(l==null?void 0:l.type)==="binding"?(this.editor.setHintingShapes([l.boundShapeId]),this.isPrecise=l.isPrecise,this.isPrecise?this.isPreciseId=l.boundShapeId:this.resetExactTimeout()):this.editor.setHintingShapes([]),this.update(),this.editor.select(this.shapeId)});y(this,"exactTimeout",-1);y(this,"onPointerMove",()=>{this.update()});y(this,"onKeyDown",()=>{this.update()});y(this,"onKeyUp",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})})}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clear();const{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clear();const{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var C;const{editor:t,shapeId:r,initialPagePoint:i}=this,{initialHandle:o,initialPageRotation:s,initialAdjacentHandle:a}=this,l=this.editor.getHintingShapeIds(),c=this.editor.user.getIsSnapMode(),{snaps:d,inputs:{currentPagePoint:u,shiftKey:h,ctrlKey:p,altKey:m,pointerVelocity:f}}=t,w=this.info.shape,S=t.getShape(r);if(!S)return;const b=t.getShapeUtil(S);let _=u.clone().sub(i).rot(-s).add(o);if(h&&a&&o.id!=="middle"){const E=k.Angle(a,_),I=Sp(E,24)-E;_=k.RotWith(_,a,I)}if(t.snaps.clear(),o.canSnap&&(c?!p:p)){const E=t.getShapePageTransform(S.id);if(!E)throw Error("Expected a page transform");const I=t.getShapeHandles(S).filter(({type:D})=>D==="vertex").sort(gn).findIndex(({index:D})=>o.index===D),A=b.getOutlineSegments(S).map(D=>oe.applyToPoints(E,D)).filter((D,F)=>F!==I-1&&F!==I),T=d.getSnappingHandleDelta({additionalSegments:A,handlePoint:oe.applyToPoint(E,_)});T&&(T.rot(-t.getShapeParentTransform(S).rotation()),_.add(T))}const x=(C=b.onHandleChange)==null?void 0:C.call(b,S,{handle:{...o,x:_.x,y:_.y},isPrecise:this.isPrecise||m,initial:w}),P={...S,...x};if(o.canBind){const E=P.props[o.id];(E==null?void 0:E.type)==="binding"?l[0]!==E.boundShapeId&&(t.setHintingShapes([E.boundShapeId]),this.pointingId=E.boundShapeId,this.isPrecise=f.len()<.5||m,this.isPreciseId=this.isPrecise?E.boundShapeId:null,this.resetExactTimeout()):l.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}x&&t.updateShapes([P],{squashing:!0})}}y(gA,"id","dragging_handle");class mA extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{const t=this.editor.getEditingShape();if(!t)throw Error("Entered editing state without an editing shape");Od(this.editor),this.editor.select(t)});y(this,"onExit",()=>{var i,o;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null);const r=this.editor.getShape(t);(o=(i=this.editor.getShapeUtil(r)).onEditEnd)==null||o.call(i,r),setTimeout(()=>{this.editor.updateViewportScreenBounds()},500)});y(this,"onPointerMove",t=>{switch(t.target){case"shape":case"canvas":{Od(this.editor);return}}});y(this,"onPointerDown",t=>{switch(t.target){case"canvas":{const r=pv(this.editor);if(r){this.onPointerDown({...t,shape:r,target:"shape"});return}break}case"shape":{const{shape:r}=t,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");if(r.type===i.type)if(this.editor.isShapeOfType(r,"geo")||this.editor.isShapeOfType(r,"arrow")){const o=this.editor.getShapeUtil(r).getGeometry(r).children[1];if(o){const s=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(o.bounds.containsPoint(s)){if(r.id===i.id)return;this.parent.transition("pointing_shape",t);return}}}else{if(r.id===i.id)this.editor.isShapeOfType(r,"frame")&&this.editor.setEditingShape(null);else{this.parent.transition("pointing_shape",t);return}return}break}}this.parent.transition("idle",t),this.editor.root.handleEvent(t)});y(this,"onComplete",t=>{this.parent.transition("idle",t)});y(this,"onCancel",t=>{this.parent.transition("idle",t)})}}y(mA,"id","editing_shape");function yA(n){const e=n.getOnlySelectedShape();return!!(e&&!n.isShapeOrAncestorLocked(e)&&n.getShapeUtil(e).canCrop(e))}function Jf(n){const e=n.getSelectedShapeIds(),{shiftKey:t,altKey:r,currentPagePoint:i}=n.inputs,o=n.getShapeAtPoint(i,{hitInside:!1,margin:Gr/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:s=>!s.isLocked});if(o){const s=n.getOutermostSelectableShape(o);if(t&&!r)n.cancelDoubleClick(),e.includes(s.id)?(n.mark("deselecting shape"),n.deselect(s)):(n.mark("shift selecting shape"),n.setSelectedShapes([...e,s.id]));else{let a;s===o||s.id===n.getFocusedGroupId()||e.includes(s.id)?a=o:a=s,a&&!e.includes(a.id)&&(n.mark("selecting shape"),n.select(a.id))}}else{if(t)return;{e.length>0&&(n.mark("selecting none"),n.selectNone());const s=n.getFocusedGroupId();if(kr(s)){const a=n.getShape(s);n.isPointInShape(a,i,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}let $Y=(zS=class extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{this.parent.setCurrentToolIdMask(void 0),Od(this.editor),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});y(this,"onPointerMove",()=>{Od(this.editor)});y(this,"onPointerDown",e=>{if(this.editor.getIsMenuOpen())return;const t=e.ctrlKey&&yA(this.editor);if(e.ctrlKey&&!t){if(e.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{const r=pv(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&wA(this.editor,s)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{if(this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":{t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}});y(this,"onDoubleClick",e=>{var t,r,i,o,s;if(!(this.editor.inputs.shiftKey||e.phase!=="up"))switch(e.target){case"canvas":{const a=this.editor.getHoveredShape(),l=a&&!this.editor.isShapeOfType(a,"group")?a:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:Gr/this.editor.getZoomLevel(),hitInside:!1}),c=this.editor.getFocusedGroupId();if(l){if(this.editor.isShapeOfType(l,"group")){Jf(this.editor);return}else{const d=this.editor.getShape(l.parentId);if(d&&this.editor.isShapeOfType(d,"group")&&!(c&&d.id===c)){Jf(this.editor);return}}this.onDoubleClick({...e,shape:l,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const a=this.editor.getOnlySelectedShape();if(a){const l=this.editor.getShapeUtil(a);if(!this.canInteractWithShapeInReadOnly(a))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const c=(t=l.onDoubleClickEdge)==null?void 0:t.call(l,a);if(c){this.editor.mark("double click edge"),this.editor.updateShapes([c]);return}}if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(a)&&this.startEditingShape(a,e)}break}case"shape":{const{shape:a}=e,l=this.editor.getShapeUtil(a);if(a.type!=="video"&&a.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(l.onDoubleClick){const c=(r=l.onDoubleClick)==null?void 0:r.call(l,a);if(c){this.editor.updateShapes([c]);return}else if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.editor.mark("select and crop"),this.editor.select((i=e.shape)==null?void 0:i.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(a)?this.startEditingShape(a,e):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:a,handle:l}=e,c=(s=(o=this.editor.getShapeUtil(a)).onDoubleClickHandle)==null?void 0:s.call(o,a,l);c?this.editor.updateShapes([c]):this.shouldStartEditingShape(a)&&this.startEditingShape(a,e)}}});y(this,"onRightClick",e=>{switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),r=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:Gr/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitFrameInside:!1,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&wA(this.editor,s)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:r}=e,i=this.editor.getOutermostSelectableShape(r,o=>!t.includes(o.id));t.includes(i.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}});y(this,"onCancel",()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())});y(this,"onKeyDown",e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);break}}});y(this,"onKeyRepeat",e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}});y(this,"onKeyUp",e=>{switch(e.code){case"Enter":{const t=this.editor.getSelectedShapes();if(t.every(i=>this.editor.isShapeOfType(i,"group"))){this.editor.setSelectedShapes(t.flatMap(i=>this.editor.getSortedChildIdsForParent(i.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r});return}yA(this.editor)&&this.parent.transition("crop",e);break}}});y(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.mark("editing shape"),this.editor.setEditingShape(e.id),this.parent.transition("editing_shape",t))}handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const t=tt(),{x:r,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:r,y:i,props:{text:"",autoSize:!0}}]);const o=this.editor.getShape(t);if(!o)return;const s=this.editor.getShapeUtil(o);this.editor.getInstanceState().isReadonly&&!s.canEditInReadOnly(o)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),i=new k(0,0);if(t.has("ArrowLeft")&&(i.x-=1),t.has("ArrowRight")&&(i.x+=1),t.has("ArrowUp")&&(i.y-=1),t.has("ArrowDown")&&(i.y+=1),i.equals(new k(0,0)))return;e||this.editor.mark("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),s=this.editor.getInstanceState().isGridMode?r?o*VY:o:r?BY:UY;this.editor.nudgeShapes(this.editor.getSelectedShapeIds(),i.mul(s))}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},y(zS,"id","idle"),zS);const BY=10,UY=1,VY=5;function wA(n,e){const t=n.getSelectionRotatedPageBounds();if(!t)return!1;const r=n.getSelectionRotation();return r?bi(e,t.corners.map(i=>k.RotWith(i,t.point,r))):t.containsPoint(e)}class bA extends ae{constructor(){super(...arguments);y(this,"onEnter",()=>{const{inputs:t}=this.editor;t.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())});y(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",t)});y(this,"onPointerUp",()=>{Jf(this.editor),this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.parent.transition("idle")})}complete(){this.parent.transition("idle")}}y(bA,"id","pointing_canvas");class vA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];r&&(this.updateCursor(r),this.editor.setCroppingShape(r.id))});y(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})});y(this,"onPointerUp",()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}updateCursor(t){const r=Tl[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:t.rotation}})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}}y(vA,"id","pointing_crop_handle");class SA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t;const r=t.shape.props[t.handle.id];(r==null?void 0:r.type)==="binding"&&this.editor.setHintingShapes([r.boundShapeId]),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})});y(this,"onExit",()=>{this.editor.setHintingShapes([]),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});y(this,"onPointerUp",()=>{this.parent.transition("idle",this.info)});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("dragging_handle",this.info)});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}y(SA,"id","pointing_handle");class xA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.updateCursor()});y(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});y(this,"onPointerMove",()=>{const{isDragging:t}=this.editor.inputs;t&&this.parent.transition("rotating",this.info)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const t=this.editor.getSelectionRotation();this.editor.updateInstanceState({cursor:{type:Tl[this.info.handle],rotation:t}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}y(xA,"id","pointing_rotate_handle");class _A extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t});y(this,"onPointerUp",t=>{Jf(this.editor),this.parent.transition("idle",t)});y(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly)return;this.parent.transition("translating",t)}});y(this,"onDoubleClick",t=>{var o,s;const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),(s=(o=this.parent).onDoubleClick)==null||s.call(o,{...t,target:"shape",shape:this.editor.getShape(i)});return}});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}y(_A,"id","pointing_selection");class kA extends ae{constructor(){super(...arguments);y(this,"hitShape",{});y(this,"hitShapeForPointerUp",{});y(this,"didSelectOnEnter",!1);y(this,"onEnter",t=>{const r=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),o=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:s,shiftKey:a,altKey:l}}=this.editor;this.hitShape=t.shape;const c=this.editor.getOutermostSelectableShape(t.shape);if(this.editor.getShapeUtil(t.shape).onClick||c.id===o||r.includes(c.id)||this.editor.isAncestorSelected(c.id)||r.length>1&&(i!=null&&i.containsPoint(s))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=c;return}this.didSelectOnEnter=!0,a&&!l?(this.editor.cancelDoubleClick(),r.includes(c.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...r,c.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([c.id]))});y(this,"onPointerUp",t=>{var d;const r=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),o=this.editor.getZoomLevel(),{inputs:{currentPagePoint:s,shiftKey:a}}=this.editor,l=this.editor.getShapeAtPoint(s,{margin:Gr/o,hitInside:!0,renderingOnly:!0})??this.hitShape,c=l?this.editor.getOutermostSelectableShape(l):this.hitShapeForPointerUp;if(c){const u=this.editor.getShapeUtil(c);if(u.onClick){const h=(d=u.onClick)==null?void 0:d.call(u,c);if(h){this.editor.mark("shape on click"),this.editor.updateShapes([h]),this.parent.transition("idle",t);return}}if(c.id===i){r.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",t);return}}if(!this.didSelectOnEnter){const u=this.editor.getOutermostSelectableShape(l,h=>!r.includes(h.id));if(r.includes(u.id))if(a)this.editor.mark("deselecting on pointer up"),this.editor.deselect(c);else if(r.includes(c.id)){if(r.length===1&&(this.editor.isShapeOfType(c,"geo")||this.editor.isShapeOfType(c,"arrow"))){const h=this.editor.getShapeGeometry(c).children[1];if(h){const p=this.editor.getPointInShapeSpace(c,s);if(h.bounds.containsPoint(p,0)&&h.hitTestPoint(p)){this.editor.batch(()=>{this.editor.mark("editing on pointer up"),this.editor.select(c.id);const m=this.editor.getShapeUtil(c);this.editor.getInstanceState().isReadonly&&!m.canEditInReadOnly(c)||(this.editor.setEditingShape(c.id),this.editor.setCurrentTool("select.editing_shape"))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(c.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(c);else if(a){const h=this.editor.getShapeAncestors(u);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(p=>!h.find(m=>m.id===p)),u.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([u.id])}this.parent.transition("idle",t)});y(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly)return;this.parent.transition("translating",t)}});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}y(kA,"id","pointing_shape");class CA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"markId","");y(this,"didHoldCommand",!1);y(this,"creationCursorOffset",{x:0,y:0});y(this,"snapshot",{});y(this,"onEnter",t=>{const{isCreating:r=!1,creationCursorOffset:i={x:0,y:0}}=t;this.info=t,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.creationCursorOffset=i,this.snapshot=this._createSnapshot(),r?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},{ephemeral:!0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()});y(this,"onTick",()=>{$w(this.editor)});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onKeyDown",()=>{this.updateShapes()});y(this,"onKeyUp",()=>{this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.snaps.clear()});y(this,"_createSnapshot",()=>{const t=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:i}}=this.editor,o=this.editor.getSelectionRotatedPageBounds(),s=k.RotWith(o.getHandlePoint(this.info.handle),o.point,r),a=k.Sub(i,s),l=new Map,c=[];t.forEach(u=>{const h=this.editor.getShape(u);if(h){if(h.type==="frame"&&c.push({id:u,children:me(this.editor.getSortedChildIdsForParent(h).map(p=>this.editor.getShape(p)))}),l.set(h.id,this._createShapeSnapshot(h)),this.editor.isShapeOfType(h,"frame")&&t.length===1)return;this.editor.visitDescendants(h.id,p=>{const m=this.editor.getShape(p);if(m&&(l.set(m.id,this._createShapeSnapshot(m)),this.editor.isShapeOfType(m,"frame")))return!1})}});const d=![...l.values()].some(u=>!b2(u.pageRotation,r)||u.isAspectRatioLocked);return{shapeSnapshots:l,selectionBounds:o,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:t,canShapesDeform:d,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:c}});y(this,"_createShapeSnapshot",t=>{const r=this.editor.getShapePageTransform(t),i=this.editor.getShapeUtil(t);return{shape:t,bounds:this.editor.getShapeGeometry(t).bounds,pageTransform:r,pageRotation:oe.Decompose(r).rotation,isAspectRatioLocked:i.isAspectRatioLocked(t)}})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var t,r;if(this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(t=this.info).onCreate)==null||r.call(t,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var s,a;const o=(a=(s=this.editor.getShapeUtil(i)).onResizeStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onResizeEnd)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:t,shiftKey:r}=this.editor.inputs,{frames:i,shapeSnapshots:o,selectionBounds:s,cursorHandleOffset:a,selectedShapeIds:l,selectionRotation:c,canShapesDeform:d}=this.snapshot,u=r||!d,{ctrlKey:h}=this.editor.inputs,p=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),m=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!h){const{gridSize:E}=this.editor.getDocumentSettings();p.snapToGrid(E)}const f=this.info.handle,w=PA(f,Math.PI);if(this.editor.snaps.clear(),(this.editor.user.getIsSnapMode()?!h:h)&&c%rt===0){const{nudge:E}=this.editor.snaps.snapResize({dragDelta:k.Sub(p,m),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:PA(f,c),isAspectRatioLocked:u,isResizingFromCenter:t});p.add(E)}const S=k.RotWith(t?s.center:s.getHandlePoint(w),s.point,c),b=k.Sub(p,S).rot(-c),_=k.Sub(m,S).rot(-c),x=k.DivV(b,_);Number.isFinite(x.x)||(x.x=1),Number.isFinite(x.y)||(x.y=1);const P=f==="top"||f==="bottom",C=f==="left"||f==="right";u?C?x.y=Math.abs(x.x):P?x.x=Math.abs(x.y):Math.abs(x.x)>Math.abs(x.y)?x.y=Math.abs(x.x)*(x.y<0?-1:1):x.x=Math.abs(x.y)*(x.x<0?-1:1):(P&&(x.x=1),C&&(x.y=1)),this.info.isCreating||this.updateCursor({dragHandle:f,isFlippedX:x.x<0,isFlippedY:x.y<0,rotation:c});for(const E of o.keys()){const I=o.get(E);this.editor.resizeShape(E,x,{initialShape:I.shape,initialBounds:I.bounds,initialPageTransform:I.pageTransform,dragHandle:f,mode:l.length===1&&E===l[0]?"resize_bounds":"scale_shape",scaleOrigin:S,scaleAxisRotation:c})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:E,children:I}of i){if(!I.length)continue;const A=o.get(E).shape,T=this.editor.getShape(E);if(!(A&&T))continue;const D=T.x-A.x,F=T.y-A.y,H=new k(D,F).rot(-A.rotation);if(H.x!==0||H.y!==0)for(const O of I)this.editor.updateShape({id:O.id,type:O.type,x:O.x-H.x,y:O.y-H.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:E}of i)if(E.length)for(const I of E)this.editor.updateShape({id:I.id,type:I.type,x:I.x,y:I.y})}}updateCursor({dragHandle:t,isFlippedX:r,isFlippedY:i,rotation:o}){const s={...this.editor.getInstanceState().cursor};switch(t){case"top_left":case"bottom_right":{s.type="nwse-resize",r!==i&&(s.type="nesw-resize");break}case"top_right":case"bottom_left":{s.type="nesw-resize",r!==i&&(s.type="nwse-resize");break}}s.rotation=o,this.editor.setCursor(s)}}y(CA,"id","resizing");const fv=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function PA(n,e){e=e%We;const t=Math.round(e/(Fe/4)),r=fv.indexOf(n);return fv[(r+t)%fv.length]}const EA=Math.PI/180;class IA extends ae{constructor(){super(...arguments);y(this,"snapshot",{});y(this,"info",{});y(this,"markId","");y(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const r=zP({editor:this.editor});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r,this.handleStart()});y(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}});y(this,"onPointerMove",()=>{this.update()});y(this,"onKeyDown",()=>{this.update()});y(this,"onKeyUp",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"update",()=>{const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Fp({editor:this.editor,delta:t,snapshot:this.snapshot,stage:"update"}),this.editor.updateInstanceState({cursor:{type:Tl[this.info.handle],rotation:t+this.snapshot.initialSelectionRotation}})});y(this,"cancel",()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)});y(this,"complete",()=>{Fp({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})}handleStart(){const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Fp({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.updateInstanceState({cursor:{type:Tl[this.info.handle],rotation:t+this.snapshot.initialSelectionRotation}})}_getRotationFromPointerPosition({snapToNearestDegree:t}){const r=this.editor.getSelectionRotation(),i=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:o,currentPagePoint:s}}=this.editor,{initialCursorAngle:a,initialSelectionRotation:l}=this.snapshot;if(!i)return l;const c=i.center.clone().rotWith(i.point,r).angle(s)-a;let d=l+c;if(o)d=Sp(d,24);else if(t&&(d=Math.round(d/EA)*EA,this.editor.getInstanceState().isCoarsePointer)){const u=Sp(d,4),h=ad(d,u);Math.abs(h)<gz(5)&&(d=u)}return d-l}}y(IA,"id","rotating");class MA extends ae{constructor(){super(...arguments);y(this,"hits",new Set);y(this,"size",0);y(this,"scribbleId","id");y(this,"initialSelectedShapeIds",new Set);y(this,"newlySelectedShapeIds",new Set);y(this,"onEnter",()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const t=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=t.id,this.updateScribbleSelection(!0),requestAnimationFrame(()=>{this.editor.updateInstanceState({brush:null})})});y(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});y(this,"onPointerMove",()=>{this.updateScribbleSelection(!0)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onKeyDown",()=>{this.updateScribbleSelection(!1)});y(this,"onKeyUp",()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)})}updateScribbleSelection(t){const r=this.editor.getZoomLevel(),i=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:o,originPagePoint:s,previousPagePoint:a,currentPagePoint:l}}=this.editor,{newlySelectedShapeIds:c,initialSelectedShapeIds:d}=this;t&&this.pushPointToScribble();const u=i;let h,p,m,f;for(let w=0,S=u.length;w<S;w++)if(h=u[w],p=this.editor.getShapeGeometry(h),!(this.editor.isShapeOfType(h,"group")||c.has(h.id)||this.editor.isShapeOrAncestorLocked(h))){if(this.editor.isShapeOfType(h,"frame")){const b=this.editor.getPointInShapeSpace(h,s);if(p.bounds.containsPoint(b))continue}if(m=this.editor.getPointInShapeSpace(h,a),f=this.editor.getPointInShapeSpace(h,l),p.hitTestLineSegment(m,f,Gr/r)){const b=this.editor.getOutermostSelectableShape(h),_=this.editor.getShapeMask(b.id);if(_&&xP(a,l,_)!==null&&!bi(l,_))continue;c.add(b.id)}}this.editor.setSelectedShapes([...new Set(o?[...c,...d]:[...c])],{squashing:!0})}complete(){this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds],{squashing:!0}),this.parent.transition("idle")}}y(MA,"id","scribble_brushing");const AA=100;class HY{constructor(e){y(this,"prevDroppingShapeId",null);y(this,"droppingNodeTimer",null);y(this,"first",!0);y(this,"dispose",()=>{this.clear()});this.editor=e,e.disposables.add(this.dispose)}updateDroppingNode(e,t){var r;this.first&&(this.prevDroppingShapeId=((r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:r.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,AA*10,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(e,AA,t))}setDragTimer(e,t,r){this.droppingNodeTimer=setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,r){var l,c,d,u,h;t=me(t.map(p=>this.editor.getShape(p.id)));const i=((l=this.editor.getDroppingOverShape(e,t))==null?void 0:l.id)??null;if(i===this.prevDroppingShapeId)return;const{prevDroppingShapeId:o}=this,s=o&&this.editor.getShape(o),a=i&&this.editor.getShape(i);if(s&&((d=(c=this.editor.getShapeUtil(s)).onDragShapesOut)==null||d.call(c,s,t)),a){const p=(h=(u=this.editor.getShapeUtil(a)).onDragShapesOver)==null?void 0:h.call(u,a,t);p&&p.shouldHint&&this.editor.setHintingShapes([a.id])}else this.editor.setHintingShapes([]);r==null||r(),this.prevDroppingShapeId=i}dropShapes(e){var r,i;const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){const o=this.editor.getShape(t);if(!o)return;(i=(r=this.editor.getShapeUtil(o)).onDropShapesOver)==null||i.call(r,o,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class TA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"selectionSnapshot",{});y(this,"snapshot",{});y(this,"markId","");y(this,"isCloning",!1);y(this,"isCreating",!1);y(this,"onCreate",()=>{});y(this,"dragAndDropManager",new HY(this.editor));y(this,"onEnter",t=>{const{isCreating:r=!1,onCreate:i=()=>{}}=t;if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.isCreating=r,this.onCreate=i,r?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=t,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=jA(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()});y(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.dragAndDropManager.clear()});y(this,"onTick",()=>{this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),$w(this.editor)});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onKeyDown",()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()});y(this,"onKeyUp",()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"updateParentTransforms",()=>{const{editor:t,snapshot:{shapeSnapshots:r}}=this;r.forEach(i=>{const o=t.getShape(i.shape.id);if(!o)return null;const s=Un(o.parentId)?null:oe.Inverse(t.getShapePageTransform(o.parentId));i.parentTransform=s})})}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=jA(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var t;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(t=this.onCreate)==null||t.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:t}=this.snapshot,r=[];t.forEach(i=>{var s,a;const o=(a=(s=this.editor.getShapeUtil(i)).onTranslateStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:t}=this.snapshot,r=[];t.forEach(i=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onTranslateEnd)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}handleChange(){const{movingShapes:t}=this.snapshot,r=[];t.forEach(i=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onTranslate)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{snapshot:t}=this;this.dragAndDropManager.updateDroppingNode(t.movingShapes,this.updateParentTransforms),WY({editor:this.editor,shapeSnapshots:t.shapeSnapshots,averagePagePoint:t.averagePagePoint,initialSelectionPageBounds:t.initialPageBounds,initialSelectionSnapPoints:t.initialSnapPoints}),this.handleChange()}}y(TA,"id","translating");function jA(n){const e=[],t=[],r=me(n.getSelectedShapeIds().map(o=>{const s=n.getShape(o);if(!s)return null;e.push(s);const a=n.getShapePageTransform(o).point();if(!a)return null;t.push(a);const l=Ji.isId(s.parentId)?null:oe.Inverse(n.getShapePageTransform(s.parentId));return{shape:s,pagePoint:a,parentTransform:l}}));let i=[];if(n.getSelectedShapeIds().length===1)i=n.snaps.getSnapPointsCache().get(n.getSelectedShapeIds()[0]);else{const o=n.getSelectionPageBounds();o&&(i=o.snapPoints.map((s,a)=>({id:"selection:"+a,x:s.x,y:s.y})))}return{averagePagePoint:k.Average(t),movingShapes:e,shapeSnapshots:r,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:i}}function WY({editor:n,shapeSnapshots:e,averagePagePoint:t,initialSelectionPageBounds:r,initialSelectionSnapPoints:i}){const{inputs:o}=n,s=n.getInstanceState().isGridMode,a=n.getDocumentSettings().gridSize,l=k.Sub(o.currentPagePoint,o.originPagePoint),c=n.inputs.shiftKey?Math.abs(l.x)<Math.abs(l.y)?"x":"y":null;if(c==="x"?l.x=0:c==="y"&&(l.y=0),n.snaps.clear(),(n.user.getIsSnapMode()?!o.ctrlKey:o.ctrlKey)&&n.inputs.pointerVelocity.len()<.5){const{nudge:h}=n.snaps.snapTranslate({dragDelta:l,initialSelectionPageBounds:r,lockedAxis:c,initialSelectionSnapPoints:i});l.add(h)}const d=k.Add(t,l);s&&!o.ctrlKey&&d.snapToGrid(a);const u=k.Sub(d,t);n.updateShapes(me(e.map(({shape:h,pagePoint:p,parentTransform:m})=>{const f=k.Add(p,u),w=m?oe.applyToPoint(m,f):f;return{id:h.id,type:h.type,x:w.x,y:w.y}})),{squashing:!0})}class Zf extends ae{constructor(){super(...arguments);y(this,"onExit",()=>{this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)})}}y(Zf,"id","select"),y(Zf,"initial","idle"),y(Zf,"children",()=>[qf,fA,$Y,bA,kA,TA,cA,MA,vA,_A,pA,mA,CA,IA,xA,SA,gA]);class RA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t});y(this,"onPointerDown",()=>{this.parent.transition("pointing",this.info)})}}y(RA,"id","idle");class OA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t});y(this,"onPointerUp",()=>{this.complete()});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)});y(this,"onCancel",()=>{this.cancel()})}complete(){const{currentScreenPoint:t}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(t,{duration:220}):this.editor.zoomIn(t,{duration:220}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}y(OA,"id","pointing");class DA extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"zoomBrush",new de);y(this,"onEnter",t=>{this.info=t,this.update()});y(this,"onExit",()=>{this.editor.updateInstanceState({zoomBrush:null})});y(this,"onPointerMove",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()})}update(){const{inputs:{originPagePoint:t,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(de.FromPoints([t,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:t}=this,r=8/this.editor.getZoomLevel();if(t.width<r&&t.height<r){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{duration:220}):this.editor.zoomIn(i,{duration:220})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(t,i,{duration:220})}this.parent.transition("idle",this.info)}}y(DA,"id","zoom_brushing");class Qf extends ae{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.updateCursor()});y(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)});y(this,"onKeyDown",()=>{this.updateCursor()});y(this,"onKeyUp",t=>{this.updateCursor(),t.code==="KeyZ"&&this.complete()});y(this,"onInterrupt",()=>{this.complete()})}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.updateInstanceState({cursor:{type:"zoom-out",rotation:0}},{ephemeral:!0}):this.editor.updateInstanceState({cursor:{type:"zoom-in",rotation:0}},{ephemeral:!0})}}y(Qf,"id","zoom"),y(Qf,"initial","idle"),y(Qf,"children",()=>[RA,DA,OA]);const KY=[Gf,Yf,Xf,Qf,Zf];function J(){return J=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},J.apply(this,arguments)}function ne(n,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(n==null||n(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function GY(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function eg(...n){return e=>n.forEach(t=>GY(t,e))}function Ge(...n){return v.useCallback(eg(...n),n)}function _i(n,e=[]){let t=[];function r(o,s){const a=v.createContext(s),l=t.length;t=[...t,s];function c(u){const{scope:h,children:p,...m}=u,f=(h==null?void 0:h[n][l])||a,w=v.useMemo(()=>m,Object.values(m));return v.createElement(f.Provider,{value:w},p)}function d(u,h){const p=(h==null?void 0:h[n][l])||a,m=v.useContext(p);if(m)return m;if(s!==void 0)return s;throw new Error(`\`${u}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,d]}const i=()=>{const o=t.map(s=>v.createContext(s));return function(s){const a=(s==null?void 0:s[n])||o;return v.useMemo(()=>({[`__scope${n}`]:{...s,[n]:a}}),[s,a])}};return i.scopeName=n,[r,YY(i,...e)]}function YY(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(i){const o=r.reduce((s,{useScope:a,scopeName:l})=>{const c=a(i)[`__scope${l}`];return{...s,...c}},{});return v.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}const Js=v.forwardRef((n,e)=>{const{children:t,...r}=n,i=v.Children.toArray(t),o=i.find(qY);if(o){const s=o.props.children,a=i.map(l=>l===o?v.Children.count(s)>1?v.Children.only(null):v.isValidElement(s)?s.props.children:null:l);return v.createElement(gv,J({},r,{ref:e}),v.isValidElement(s)?v.cloneElement(s,void 0,a):null)}return v.createElement(gv,J({},r,{ref:e}),t)});Js.displayName="Slot";const gv=v.forwardRef((n,e)=>{const{children:t,...r}=n;return v.isValidElement(t)?v.cloneElement(t,{...JY(r,t.props),ref:e?eg(e,t.ref):t.ref}):v.Children.count(t)>1?v.Children.only(null):null});gv.displayName="SlotClone";const XY=({children:n})=>v.createElement(v.Fragment,null,n);function qY(n){return v.isValidElement(n)&&n.type===XY}function JY(n,e){const t={...e};for(const r in e){const i=n[r],o=e[r];/^on[A-Z]/.test(r)?i&&o?t[r]=(...s)=>{o(...s),i(...s)}:i&&(t[r]=i):r==="style"?t[r]={...i,...o}:r==="className"&&(t[r]=[i,o].filter(Boolean).join(" "))}return{...n,...t}}function tg(n){const e=n+"CollectionProvider",[t,r]=_i(e),[i,o]=t(e,{collectionRef:{current:null},itemMap:new Map}),s=p=>{const{scope:m,children:f}=p,w=re.useRef(null),S=re.useRef(new Map).current;return re.createElement(i,{scope:m,itemMap:S,collectionRef:w},f)},a=n+"CollectionSlot",l=re.forwardRef((p,m)=>{const{scope:f,children:w}=p,S=o(a,f),b=Ge(m,S.collectionRef);return re.createElement(Js,{ref:b},w)}),c=n+"CollectionItemSlot",d="data-radix-collection-item",u=re.forwardRef((p,m)=>{const{scope:f,children:w,...S}=p,b=re.useRef(null),_=Ge(m,b),x=o(c,f);return re.useEffect(()=>(x.itemMap.set(b,{ref:b,...S}),()=>void x.itemMap.delete(b))),re.createElement(Js,{[d]:"",ref:_},w)});function h(p){const m=o(n+"CollectionConsumer",p);return re.useCallback(()=>{const f=m.collectionRef.current;if(!f)return[];const w=Array.from(f.querySelectorAll(`[${d}]`));return Array.from(m.itemMap.values()).sort((S,b)=>w.indexOf(S.ref.current)-w.indexOf(b.ref.current))},[m.collectionRef,m.itemMap])}return[{Provider:s,Slot:l,ItemSlot:u},h,r]}const ZY=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Ae=ZY.reduce((n,e)=>{const t=v.forwardRef((r,i)=>{const{asChild:o,...s}=r,a=o?Js:e;return v.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),v.createElement(a,J({},s,{ref:i}))});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function jl(n,e){n&&Ua.flushSync(()=>n.dispatchEvent(e))}function kt(n){const e=v.useRef(n);return v.useEffect(()=>{e.current=n}),v.useMemo(()=>(...t)=>{var r;return(r=e.current)===null||r===void 0?void 0:r.call(e,...t)},[])}function ng(n,e=globalThis==null?void 0:globalThis.document){const t=kt(n);v.useEffect(()=>{const r=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",r),()=>e.removeEventListener("keydown",r)},[t,e])}const mv="dismissableLayer.update",QY="dismissableLayer.pointerDownOutside",eX="dismissableLayer.focusOutside";let LA;const zA=v.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),tX=v.forwardRef((n,e)=>{var t;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...c}=n,d=v.useContext(zA),[u,h]=v.useState(null),p=(t=u==null?void 0:u.ownerDocument)!==null&&t!==void 0?t:globalThis==null?void 0:globalThis.document,[,m]=v.useState({}),f=Ge(e,I=>h(I)),w=Array.from(d.layers),[S]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),b=w.indexOf(S),_=u?w.indexOf(u):-1,x=d.layersWithOutsidePointerEventsDisabled.size>0,P=_>=b,C=rX(I=>{const A=I.target,T=[...d.branches].some(D=>D.contains(A));!P||T||(o==null||o(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p),E=iX(I=>{const A=I.target;[...d.branches].some(T=>T.contains(A))||(s==null||s(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p);return ng(I=>{_===d.layers.size-1&&(i==null||i(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},p),v.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(LA=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),NA(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=LA)}},[u,p,r,d]),v.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),NA())},[u,d]),v.useEffect(()=>{const I=()=>m({});return document.addEventListener(mv,I),()=>document.removeEventListener(mv,I)},[]),v.createElement(Ae.div,J({},c,{ref:f,style:{pointerEvents:x?P?"auto":"none":void 0,...n.style},onFocusCapture:ne(n.onFocusCapture,E.onFocusCapture),onBlurCapture:ne(n.onBlurCapture,E.onBlurCapture),onPointerDownCapture:ne(n.onPointerDownCapture,C.onPointerDownCapture)}))}),nX=v.forwardRef((n,e)=>{const t=v.useContext(zA),r=v.useRef(null),i=Ge(e,r);return v.useEffect(()=>{const o=r.current;if(o)return t.branches.add(o),()=>{t.branches.delete(o)}},[t.branches]),v.createElement(Ae.div,J({},n,{ref:i}))});function rX(n,e=globalThis==null?void 0:globalThis.document){const t=kt(n),r=v.useRef(!1),i=v.useRef(()=>{});return v.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){FA(QY,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function iX(n,e=globalThis==null?void 0:globalThis.document){const t=kt(n),r=v.useRef(!1);return v.useEffect(()=>{const i=o=>{o.target&&!r.current&&FA(eX,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function NA(){const n=new CustomEvent(mv);document.dispatchEvent(n)}function FA(n,e,t,{discrete:r}){const i=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?jl(i,o):i.dispatchEvent(o)}const oX=tX,sX=nX,aX=v.forwardRef((n,e)=>{var t;const{container:r=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...i}=n;return r?Gh.createPortal(v.createElement(Ae.div,J({},i,{ref:e})),r):null}),Zs=globalThis!=null&&globalThis.document?v.useLayoutEffect:()=>{};function lX(n,e){return v.useReducer((t,r)=>e[t][r]??t,n)}const Qr=n=>{const{present:e,children:t}=n,r=cX(e),i=typeof t=="function"?t({present:r.isPresent}):v.Children.only(t),o=Ge(r.ref,i.ref);return typeof t=="function"||r.isPresent?v.cloneElement(i,{ref:o}):null};Qr.displayName="Presence";function cX(n){const[e,t]=v.useState(),r=v.useRef({}),i=v.useRef(n),o=v.useRef("none"),s=n?"mounted":"unmounted",[a,l]=lX(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return v.useEffect(()=>{const c=rg(r.current);o.current=a==="mounted"?c:"none"},[a]),Zs(()=>{const c=r.current,d=i.current;if(d!==n){const u=o.current,h=rg(c);n?l("MOUNT"):h==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(d&&u!==h?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,l]),Zs(()=>{if(e){const c=u=>{const h=rg(r.current).includes(u.animationName);u.target===e&&h&&Ua.flushSync(()=>l("ANIMATION_END"))},d=u=>{u.target===e&&(o.current=rg(r.current))};return e.addEventListener("animationstart",d),e.addEventListener("animationcancel",c),e.addEventListener("animationend",c),()=>{e.removeEventListener("animationstart",d),e.removeEventListener("animationcancel",c),e.removeEventListener("animationend",c)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:v.useCallback(c=>{c&&(r.current=getComputedStyle(c)),t(c)},[])}}function rg(n){return(n==null?void 0:n.animationName)||"none"}function os({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,i]=dX({defaultProp:e,onChange:t}),o=n!==void 0,s=o?n:r,a=kt(t),l=v.useCallback(c=>{if(o){const d=typeof c=="function"?c(n):c;d!==n&&a(d)}else i(c)},[o,n,i,a]);return[s,l]}function dX({defaultProp:n,onChange:e}){const t=v.useState(n),[r]=t,i=v.useRef(r),o=kt(e);return v.useEffect(()=>{i.current!==r&&(o(r),i.current=r)},[r,i,o]),t}const $A=v.forwardRef((n,e)=>v.createElement(Ae.span,J({},n,{ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}))),BA="ToastProvider",[yv,uX,hX]=tg("Toast"),[UA,Rue]=_i("Toast",[hX]),[pX,ig]=UA(BA),VA=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:s}=n,[a,l]=v.useState(null),[c,d]=v.useState(0),u=v.useRef(!1),h=v.useRef(!1);return v.createElement(yv.Provider,{scope:e},v.createElement(pX,{scope:e,label:t,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:v.useCallback(()=>d(p=>p+1),[]),onToastRemove:v.useCallback(()=>d(p=>p-1),[]),isFocusedToastEscapeKeyDownRef:u,isClosePausedRef:h},s))};VA.propTypes={label(n){if(n.label&&typeof n.label=="string"&&!n.label.trim()){const e=`Invalid prop \`label\` supplied to \`${BA}\`. Expected non-empty \`string\`.`;return new Error(e)}return null}};const fX="ToastViewport",gX=["F8"],wv="toast.viewportPause",bv="toast.viewportResume",mX=v.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=gX,label:i="Notifications ({hotkey})",...o}=n,s=ig(fX,t),a=uX(t),l=v.useRef(null),c=v.useRef(null),d=v.useRef(null),u=v.useRef(null),h=Ge(e,u,s.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),m=s.toastCount>0;v.useEffect(()=>{const w=S=>{var b;r.every(_=>S[_]||S.code===_)&&((b=u.current)===null||b===void 0||b.focus())};return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[r]),v.useEffect(()=>{const w=l.current,S=u.current;if(m&&w&&S){const b=()=>{if(!s.isClosePausedRef.current){const C=new CustomEvent(wv);S.dispatchEvent(C),s.isClosePausedRef.current=!0}},_=()=>{if(s.isClosePausedRef.current){const C=new CustomEvent(bv);S.dispatchEvent(C),s.isClosePausedRef.current=!1}},x=C=>{!w.contains(C.relatedTarget)&&_()},P=()=>{w.contains(document.activeElement)||_()};return w.addEventListener("focusin",b),w.addEventListener("focusout",x),w.addEventListener("pointermove",b),w.addEventListener("pointerleave",P),window.addEventListener("blur",b),window.addEventListener("focus",_),()=>{w.removeEventListener("focusin",b),w.removeEventListener("focusout",x),w.removeEventListener("pointermove",b),w.removeEventListener("pointerleave",P),window.removeEventListener("blur",b),window.removeEventListener("focus",_)}}},[m,s.isClosePausedRef]);const f=v.useCallback(({tabbingDirection:w})=>{const S=a().map(b=>{const _=b.ref.current,x=[_,...jX(_)];return w==="forwards"?x:x.reverse()});return(w==="forwards"?S.reverse():S).flat()},[a]);return v.useEffect(()=>{const w=u.current;if(w){const S=b=>{const _=b.altKey||b.ctrlKey||b.metaKey;if(b.key==="Tab"&&!_){const E=document.activeElement,I=b.shiftKey;if(b.target===w&&I){var x;(x=c.current)===null||x===void 0||x.focus();return}const A=f({tabbingDirection:I?"backwards":"forwards"}),T=A.findIndex(D=>D===E);if(vv(A.slice(T+1)))b.preventDefault();else{var P,C;I?(P=c.current)===null||P===void 0||P.focus():(C=d.current)===null||C===void 0||C.focus()}}};return w.addEventListener("keydown",S),()=>w.removeEventListener("keydown",S)}},[a,f]),v.createElement(sX,{ref:l,role:"region","aria-label":i.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:m?void 0:"none"}},m&&v.createElement(HA,{ref:c,onFocusFromOutsideViewport:()=>{const w=f({tabbingDirection:"forwards"});vv(w)}}),v.createElement(yv.Slot,{scope:t},v.createElement(Ae.ol,J({tabIndex:-1},o,{ref:h}))),m&&v.createElement(HA,{ref:d,onFocusFromOutsideViewport:()=>{const w=f({tabbingDirection:"backwards"});vv(w)}}))}),yX="ToastFocusProxy",HA=v.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...i}=n,o=ig(yX,t);return v.createElement($A,J({"aria-hidden":!0,tabIndex:0},i,{ref:e,style:{position:"fixed"},onFocus:s=>{var a;const l=s.relatedTarget;!((a=o.viewport)!==null&&a!==void 0&&a.contains(l))&&r()}}))}),og="Toast",wX="toast.swipeStart",bX="toast.swipeMove",vX="toast.swipeCancel",SX="toast.swipeEnd",xX=v.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:i,onOpenChange:o,...s}=n,[a=!0,l]=os({prop:r,defaultProp:i,onChange:o});return v.createElement(Qr,{present:t||a},v.createElement(WA,J({open:a},s,{ref:e,onClose:()=>l(!1),onPause:kt(n.onPause),onResume:kt(n.onResume),onSwipeStart:ne(n.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ne(n.onSwipeMove,c=>{const{x:d,y:u}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${u}px`)}),onSwipeCancel:ne(n.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ne(n.onSwipeEnd,c=>{const{x:d,y:u}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${u}px`),l(!1)})})))}),[_X,kX]=UA(og,{onClose(){}}),WA=v.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:i,open:o,onClose:s,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:d,onSwipeMove:u,onSwipeCancel:h,onSwipeEnd:p,...m}=n,f=ig(og,t),[w,S]=v.useState(null),b=Ge(e,O=>S(O)),_=v.useRef(null),x=v.useRef(null),P=i||f.duration,C=v.useRef(0),E=v.useRef(P),I=v.useRef(0),{onToastAdd:A,onToastRemove:T}=f,D=kt(()=>{var O;w!=null&&w.contains(document.activeElement)&&((O=f.viewport)===null||O===void 0||O.focus()),s()}),F=v.useCallback(O=>{!O||O===1/0||(window.clearTimeout(I.current),C.current=new Date().getTime(),I.current=window.setTimeout(D,O))},[D]);v.useEffect(()=>{const O=f.viewport;if(O){const K=()=>{F(E.current),c==null||c()},B=()=>{const te=new Date().getTime()-C.current;E.current=E.current-te,window.clearTimeout(I.current),l==null||l()};return O.addEventListener(wv,B),O.addEventListener(bv,K),()=>{O.removeEventListener(wv,B),O.removeEventListener(bv,K)}}},[f.viewport,P,l,c,F]),v.useEffect(()=>{o&&!f.isClosePausedRef.current&&F(P)},[o,P,f.isClosePausedRef,F]),v.useEffect(()=>(A(),()=>T()),[A,T]);const H=v.useMemo(()=>w?XA(w):null,[w]);return f.viewport?v.createElement(v.Fragment,null,H&&v.createElement(CX,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0},H),v.createElement(_X,{scope:t,onClose:D},Ua.createPortal(v.createElement(yv.ItemSlot,{scope:t},v.createElement(oX,{asChild:!0,onEscapeKeyDown:ne(a,()=>{f.isFocusedToastEscapeKeyDownRef.current||D(),f.isFocusedToastEscapeKeyDownRef.current=!1})},v.createElement(Ae.li,J({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":f.swipeDirection},m,{ref:b,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:ne(n.onKeyDown,O=>{O.key==="Escape"&&(a==null||a(O.nativeEvent),O.nativeEvent.defaultPrevented||(f.isFocusedToastEscapeKeyDownRef.current=!0,D()))}),onPointerDown:ne(n.onPointerDown,O=>{O.button===0&&(_.current={x:O.clientX,y:O.clientY})}),onPointerMove:ne(n.onPointerMove,O=>{if(!_.current)return;const K=O.clientX-_.current.x,B=O.clientY-_.current.y,te=!!x.current,W=["left","right"].includes(f.swipeDirection),N=["left","up"].includes(f.swipeDirection)?Math.min:Math.max,Y=W?N(0,K):0,ee=W?0:N(0,B),pe=O.pointerType==="touch"?10:2,ve={x:Y,y:ee},be={originalEvent:O,delta:ve};te?(x.current=ve,sg(bX,u,be,{discrete:!1})):qA(ve,f.swipeDirection,pe)?(x.current=ve,sg(wX,d,be,{discrete:!1}),O.target.setPointerCapture(O.pointerId)):(Math.abs(K)>pe||Math.abs(B)>pe)&&(_.current=null)}),onPointerUp:ne(n.onPointerUp,O=>{const K=x.current,B=O.target;if(B.hasPointerCapture(O.pointerId)&&B.releasePointerCapture(O.pointerId),x.current=null,_.current=null,K){const te=O.currentTarget,W={originalEvent:O,delta:K};qA(K,f.swipeDirection,f.swipeThreshold)?sg(SX,p,W,{discrete:!0}):sg(vX,h,W,{discrete:!0}),te.addEventListener("click",N=>N.preventDefault(),{once:!0})}})})))),f.viewport))):null});WA.propTypes={type(n){if(n.type&&!["foreground","background"].includes(n.type)){const e=`Invalid prop \`type\` supplied to \`${og}\`. Expected \`foreground | background\`.`;return new Error(e)}return null}};const CX=n=>{const{__scopeToast:e,children:t,...r}=n,i=ig(og,e),[o,s]=v.useState(!1),[a,l]=v.useState(!1);return AX(()=>s(!0)),v.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:v.createElement(aX,{asChild:!0},v.createElement($A,r,o&&v.createElement(v.Fragment,null,i.label," ",t)))},PX=v.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return v.createElement(Ae.div,J({},r,{ref:e}))}),EX=v.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return v.createElement(Ae.div,J({},r,{ref:e}))}),IX="ToastAction",KA=v.forwardRef((n,e)=>{const{altText:t,...r}=n;return t?v.createElement(YA,{altText:t,asChild:!0},v.createElement(GA,J({},r,{ref:e}))):null});KA.propTypes={altText(n){return n.altText?null:new Error(`Missing prop \`altText\` expected on \`${IX}\``)}};const MX="ToastClose",GA=v.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,i=kX(MX,t);return v.createElement(YA,{asChild:!0},v.createElement(Ae.button,J({type:"button"},r,{ref:e,onClick:ne(n.onClick,i.onClose)})))}),YA=v.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...i}=n;return v.createElement(Ae.div,J({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0},i,{ref:e}))});function XA(n){const e=[];return Array.from(n.childNodes).forEach(t=>{if(t.nodeType===t.TEXT_NODE&&t.textContent&&e.push(t.textContent),TX(t)){const r=t.ariaHidden||t.hidden||t.style.display==="none",i=t.dataset.radixToastAnnounceExclude==="";if(!r)if(i){const o=t.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...XA(t))}}),e}function sg(n,e,t,{discrete:r}){const i=t.originalEvent.currentTarget,o=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?jl(i,o):i.dispatchEvent(o)}const qA=(n,e,t=0)=>{const r=Math.abs(n.x),i=Math.abs(n.y),o=r>i;return e==="left"||e==="right"?o&&r>t:!o&&i>t};function AX(n=()=>{}){const e=kt(n);Zs(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function TX(n){return n.nodeType===n.ELEMENT_NODE}function jX(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function vv(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}const RX=xX,OX=PX,DX=EX,LX=KA,JA=GA,Qs="2.0.0-beta.2";let Sv={fonts:{draw:`https://unpkg.com/@tldraw/assets@${Qs}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`https://unpkg.com/@tldraw/assets@${Qs}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`https://unpkg.com/@tldraw/assets@${Qs}/fonts/IBMPlexSans-Medium.woff2`,monospace:`https://unpkg.com/@tldraw/assets@${Qs}/fonts/IBMPlexMono-Medium.woff2`}};function zX(n){return v.useMemo(()=>n?{fonts:{...Sv.fonts,...n==null?void 0:n.fonts}}:Sv,[n])}let Ud={...Sv,icons:Object.fromEntries(["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"].map(n=>[n,`https://unpkg.com/@tldraw/assets@${Qs}/icons/icon/${n}.svg`])),translations:Object.fromEntries(Qc.map(n=>[n.locale,`https://unpkg.com/@tldraw/assets@${Qs}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(Za.map(n=>[n.type,`https://unpkg.com/@tldraw/assets@${Qs}/embed-icons/${n.type}.png`]))};function NX(n){return n?{fonts:Object.assign({...Ud.fonts},{...n==null?void 0:n.fonts}),icons:Object.assign({...Ud.icons},{...n==null?void 0:n.icons}),embedIcons:Object.assign({...Ud.embedIcons},{...n==null?void 0:n.embedIcons}),translations:Object.assign({...Ud.translations},{...n==null?void 0:n.translations})}:Ud}function FX(n,e){const t=me(e.map(i=>n.getShape(i)).filter(i=>i&&n.isShapeOfType(i,"frame")));if(!t.length)return;const r=[];n.batch(()=>{t.map(i=>{const o=n.getSortedChildIdsForParent(i.id);o.length&&(n.reparentShapes(o,i.parentId,i.index),r.push(...o))}),n.setSelectedShapes(r),n.deleteShapes(e)})}const $X=50;function BX(n,e,t={}){const r=n.getShape(e);if(!r)return;const i=n.getSortedChildIdsForParent(r.id),o=me(i.map(p=>n.getShape(p)));if(!o.length)return;const s=de.FromPoints(o.flatMap(p=>{const m=n.getShapeGeometry(p.id);return n.getShapeLocalTransform(p).applyToPoints(m.vertices)})),{padding:a=$X}=t,l=s.w+2*a,c=s.h+2*a,d=a-s.minX,u=a-s.minY;if(d===0&&u===0&&r.props.w===l&&r.props.h===c)return;const h=new k(d,u).rot(r.rotation);n.batch(()=>{const p=i.map(m=>{const f=n.getShape(m);return{id:f.id,type:f.type,x:f.x+d,y:f.y+u}});p.push({id:r.id,type:r.type,x:r.x-h.x,y:r.y-h.y,props:{w:l,h:c}}),n.updateShapes(p)})}const ZA=v.createContext(null);function UX({assetUrls:n,children:e}){return g.jsx(ZA.Provider,{value:n,children:e})}function xv(){const n=v.useContext(ZA);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const _v={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},Rl={locale:"en",label:"English",messages:_v};async function VX(n,e){if(!(await fetch(e.translations.en)).ok)return console.warn("No main translations found."),Rl;if(n==="en")return Rl;const t=Qc.find(o=>o.locale===n);if(!t)return console.warn(`No translation found for locale ${n}`),Rl;const r=await(await fetch(e.translations[t.locale])).json();if(!r)return console.warn(`No messages found for locale ${n}`),Rl;const i=[];for(const o in Rl.messages)r[o]||i.push(o);return i.length>0,{locale:n,label:t.label,messages:{...Rl.messages,...r}}}const QA=v.createContext({}),HX=()=>v.useContext(QA),WX=ze(function({overrides:n,children:e}){const t=G().user.getLocale(),r=xv(),[i,o]=v.useState(()=>n&&n.en?{locale:"en",label:"English",messages:{..._v,...n.en}}:{locale:"en",label:"English",messages:_v});return v.useEffect(()=>{let s=!1;async function a(){const l=await VX(t,r);l&&!s&&(n&&n[t]?o({...l,messages:{...l.messages,...n[t]}}):o(l))}return a(),()=>{s=!0}},[r,t,n]),g.jsx(QA.Provider,{value:i,children:e})});function Ie(){const n=HX();return v.useCallback(function(e){return n.messages[e]??e},[n])}function KX(n){return g.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:g.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[g.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),g.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:g.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const hr=v.memo(function({small:n,invertIcon:e,icon:t,color:r,className:i,...o}){const s=xv(),a=s.icons[t]??s.icons["question-mark-circle"],l=v.useRef(null);return v.useLayoutEffect(()=>{a||console.error(`Icon not found: ${t}. Add it to the assetUrls.icons object.`),l!=null&&l.current&&(l.current.style.webkitMask=`url(${a}) center 100% / 100% no-repeat`)},[l,a,t]),g.jsx("div",{...o,ref:l,className:ye("tlui-icon",{"tlui-icon__small":n},i),style:{color:r,mask:`url(${a}) center 100% / 100% no-repeat`,transform:e?"scale(-1, 1)":void 0}})}),eT=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,tT=eT?"\u2318":"Ctrl",nT=eT?"\u2325":"Alt";function GX(n){return n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,tT).replace(/\?/g,nT).replace(/!/g,"\u21E7");return t[0].toUpperCase()+t.slice(1)})}function ki(n){return"\u2014 "+n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,tT).replace(/\?/g,nT).replace(/!/g,"\u21E7");return t[0].toUpperCase()+t.slice(1)}).join("\u2009")}function ag({children:n}){return g.jsx("kbd",{className:"tlui-kbd",children:GX(n).map((e,t)=>g.jsx("span",{children:e},t))})}const le=v.forwardRef(function({label:n,icon:e,invertIcon:t,iconLeft:r,smallIcon:i,kbd:o,isChecked:s=!1,type:a,children:l,spinner:c,...d},u){const h=Ie(),p=n?h(n):"";return g.jsxs("button",{ref:u,draggable:!1,type:"button",...d,title:d.title??p,className:ye("tlui-button",`tlui-button__${a}`,d.className),children:[r&&g.jsx(hr,{icon:r,className:"tlui-button__icon-left",small:!0}),l,n&&g.jsxs("span",{className:"tlui-button__label",draggable:!1,children:[p,s&&g.jsx(hr,{icon:"check"})]}),o&&g.jsx(ag,{children:o}),e&&!c&&g.jsx(hr,{icon:e,small:!!n||i,invertIcon:t}),c&&g.jsx(KX,{})]})}),YX=j4["useId".toString()]||(()=>{});let XX=0;function co(n){const[e,t]=v.useState(YX());return Zs(()=>{n||t(r=>r??String(XX++))},[n]),n||(e?`radix-${e}`:"")}const kv="dismissableLayer.update",qX="dismissableLayer.pointerDownOutside",JX="dismissableLayer.focusOutside";let rT;const ZX=v.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),QX=v.forwardRef((n,e)=>{var t;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...c}=n,d=v.useContext(ZX),[u,h]=v.useState(null),p=(t=u==null?void 0:u.ownerDocument)!==null&&t!==void 0?t:globalThis==null?void 0:globalThis.document,[,m]=v.useState({}),f=Ge(e,I=>h(I)),w=Array.from(d.layers),[S]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),b=w.indexOf(S),_=u?w.indexOf(u):-1,x=d.layersWithOutsidePointerEventsDisabled.size>0,P=_>=b,C=eq(I=>{const A=I.target,T=[...d.branches].some(D=>D.contains(A));!P||T||(o==null||o(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p),E=tq(I=>{const A=I.target;[...d.branches].some(T=>T.contains(A))||(s==null||s(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p);return ng(I=>{_===d.layers.size-1&&(i==null||i(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},p),v.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(rT=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),iT(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=rT)}},[u,p,r,d]),v.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),iT())},[u,d]),v.useEffect(()=>{const I=()=>m({});return document.addEventListener(kv,I),()=>document.removeEventListener(kv,I)},[]),v.createElement(Ae.div,J({},c,{ref:f,style:{pointerEvents:x?P?"auto":"none":void 0,...n.style},onFocusCapture:ne(n.onFocusCapture,E.onFocusCapture),onBlurCapture:ne(n.onBlurCapture,E.onBlurCapture),onPointerDownCapture:ne(n.onPointerDownCapture,C.onPointerDownCapture)}))});function eq(n,e=globalThis==null?void 0:globalThis.document){const t=kt(n),r=v.useRef(!1),i=v.useRef(()=>{});return v.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){oT(qX,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function tq(n,e=globalThis==null?void 0:globalThis.document){const t=kt(n),r=v.useRef(!1);return v.useEffect(()=>{const i=o=>{o.target&&!r.current&&oT(JX,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function iT(){const n=new CustomEvent(kv);document.dispatchEvent(n)}function oT(n,e,t,{discrete:r}){const i=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?jl(i,o):i.dispatchEvent(o)}const Cv="focusScope.autoFocusOnMount",Pv="focusScope.autoFocusOnUnmount",sT={bubbles:!1,cancelable:!0},Ev=v.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=n,[a,l]=v.useState(null),c=kt(i),d=kt(o),u=v.useRef(null),h=Ge(e,f=>l(f)),p=v.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;v.useEffect(()=>{if(r){let f=function(_){if(p.paused||!a)return;const x=_.target;a.contains(x)?u.current=x:ss(u.current,{select:!0})},w=function(_){if(p.paused||!a)return;const x=_.relatedTarget;x!==null&&(a.contains(x)||ss(u.current,{select:!0}))},S=function(_){if(document.activeElement===document.body)for(const x of _)x.removedNodes.length>0&&ss(a)};document.addEventListener("focusin",f),document.addEventListener("focusout",w);const b=new MutationObserver(S);return a&&b.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",f),document.removeEventListener("focusout",w),b.disconnect()}}},[r,a,p.paused]),v.useEffect(()=>{if(a){cT.add(p);const f=document.activeElement;if(!a.contains(f)){const w=new CustomEvent(Cv,sT);a.addEventListener(Cv,c),a.dispatchEvent(w),w.defaultPrevented||(nq(aq(aT(a)),{select:!0}),document.activeElement===f&&ss(a))}return()=>{a.removeEventListener(Cv,c),setTimeout(()=>{const w=new CustomEvent(Pv,sT);a.addEventListener(Pv,d),a.dispatchEvent(w),w.defaultPrevented||ss(f??document.body,{select:!0}),a.removeEventListener(Pv,d),cT.remove(p)},0)}}},[a,c,d,p]);const m=v.useCallback(f=>{if(!t&&!r||p.paused)return;const w=f.key==="Tab"&&!f.altKey&&!f.ctrlKey&&!f.metaKey,S=document.activeElement;if(w&&S){const b=f.currentTarget,[_,x]=rq(b);_&&x?!f.shiftKey&&S===x?(f.preventDefault(),t&&ss(_,{select:!0})):f.shiftKey&&S===_&&(f.preventDefault(),t&&ss(x,{select:!0})):S===b&&f.preventDefault()}},[t,r,p.paused]);return v.createElement(Ae.div,J({tabIndex:-1},s,{ref:h,onKeyDown:m}))});function nq(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(ss(r,{select:e}),document.activeElement!==t)return}function rq(n){const e=aT(n),t=lT(e,n),r=lT(e.reverse(),n);return[t,r]}function aT(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function lT(n,e){for(const t of n)if(!iq(t,{upTo:e}))return t}function iq(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function oq(n){return n instanceof HTMLInputElement&&"select"in n}function ss(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&oq(n)&&e&&n.select()}}const cT=sq();function sq(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=dT(n,e),n.unshift(e)},remove(e){var t;n=dT(n,e),(t=n[0])===null||t===void 0||t.resume()}}}function dT(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function aq(n){return n.filter(e=>e.tagName!=="A")}const lq=v.forwardRef((n,e)=>{var t;const{container:r=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...i}=n;return r?Gh.createPortal(v.createElement(Ae.div,J({},i,{ref:e})),r):null});let Iv=0;function Mv(){v.useEffect(()=>{var n,e;const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(n=t[0])!==null&&n!==void 0?n:uT()),document.body.insertAdjacentElement("beforeend",(e=t[1])!==null&&e!==void 0?e:uT()),Iv++,()=>{Iv===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),Iv--}},[])}function uT(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",n}var Ci=function(){return Ci=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ci.apply(this,arguments)};function hT(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function cq(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}var lg="right-scroll-bar-position",cg="width-before-scroll-bar",dq="with-scroll-bars-hidden",uq="--removed-body-scroll-bar-size";function hq(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function pq(n,e){var t=v.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var i=t.value;i!==r&&(t.value=r,t.callback(r,i))}}}})[0];return t.callback=e,t.facade}function fq(n,e){return pq(e||null,function(t){return n.forEach(function(r){return hq(r,t)})})}function gq(n){return n}function mq(n,e){e===void 0&&(e=gq);var t=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(o){var s=e(o,r);return t.push(s),function(){t=t.filter(function(a){return a!==s})}},assignSyncMedium:function(o){for(r=!0;t.length;){var s=t;t=[],s.forEach(o)}t={push:function(a){return o(a)},filter:function(){return t}}},assignMedium:function(o){r=!0;var s=[];if(t.length){var a=t;t=[],a.forEach(o),s=t}var l=function(){var d=s;s=[],d.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(d){s.push(d),c()},filter:function(d){return s=s.filter(d),t}}}};return i}function yq(n){n===void 0&&(n={});var e=mq(null);return e.options=Ci({async:!0,ssr:!1},n),e}var pT=function(n){var e=n.sideCar,t=hT(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return v.createElement(r,Ci({},t))};pT.isSideCarExport=!0;function wq(n,e){return n.useMedium(e),pT}var fT=yq(),Av=function(){},dg=v.forwardRef(function(n,e){var t=v.useRef(null),r=v.useState({onScrollCapture:Av,onWheelCapture:Av,onTouchMoveCapture:Av}),i=r[0],o=r[1],s=n.forwardProps,a=n.children,l=n.className,c=n.removeScrollBar,d=n.enabled,u=n.shards,h=n.sideCar,p=n.noIsolation,m=n.inert,f=n.allowPinchZoom,w=n.as,S=w===void 0?"div":w,b=hT(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),_=h,x=fq([t,e]),P=Ci(Ci({},b),i);return v.createElement(v.Fragment,null,d&&v.createElement(_,{sideCar:fT,removeScrollBar:c,shards:u,noIsolation:p,inert:m,setCallbacks:o,allowPinchZoom:!!f,lockRef:t}),s?v.cloneElement(v.Children.only(a),Ci(Ci({},P),{ref:x})):v.createElement(S,Ci({},P,{className:l,ref:x}),a))});dg.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},dg.classNames={fullWidth:cg,zeroRight:lg};var gT,bq=function(){if(gT)return gT;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function vq(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=bq();return e&&n.setAttribute("nonce",e),n}function Sq(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function xq(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var _q=function(){var n=0,e=null;return{add:function(t){n==0&&(e=vq())&&(Sq(e,t),xq(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},kq=function(){var n=_q();return function(e,t){v.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},mT=function(){var n=kq(),e=function(t){var r=t.styles,i=t.dynamic;return n(r,i),null};return e},Cq={left:0,top:0,right:0,gap:0},Tv=function(n){return parseInt(n||"",10)||0},Pq=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],i=e[n==="padding"?"paddingRight":"marginRight"];return[Tv(t),Tv(r),Tv(i)]},Eq=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return Cq;var e=Pq(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},Iq=mT(),Mq=function(n,e,t,r){var i=n.left,o=n.top,s=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(dq,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(lg,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(cg,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(lg," .").concat(lg,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(cg," .").concat(cg,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body {
    `).concat(uq,": ").concat(a,`px;
  }
`)},Aq=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,i=r===void 0?"margin":r,o=v.useMemo(function(){return Eq(i)},[i]);return v.createElement(Iq,{styles:Mq(o,!e,i,t?"":"!important")})},jv=!1;if(typeof window<"u")try{var ug=Object.defineProperty({},"passive",{get:function(){return jv=!0,!0}});window.addEventListener("test",ug,ug),window.removeEventListener("test",ug,ug)}catch{jv=!1}var Ol=jv?{passive:!1}:!1,Tq=function(n){return n.tagName==="TEXTAREA"},yT=function(n,e){var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!Tq(n)&&t[e]==="visible")},jq=function(n){return yT(n,"overflowY")},Rq=function(n){return yT(n,"overflowX")},wT=function(n,e){var t=e;do{typeof ShadowRoot<"u"&&t instanceof ShadowRoot&&(t=t.host);var r=bT(n,t);if(r){var i=vT(n,t),o=i[1],s=i[2];if(o>s)return!0}t=t.parentNode}while(t&&t!==document.body);return!1},Oq=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},Dq=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},bT=function(n,e){return n==="v"?jq(e):Rq(e)},vT=function(n,e){return n==="v"?Oq(e):Dq(e)},Lq=function(n,e){return n==="h"&&e==="rtl"?-1:1},zq=function(n,e,t,r,i){var o=Lq(n,window.getComputedStyle(e).direction),s=o*r,a=t.target,l=e.contains(a),c=!1,d=s>0,u=0,h=0;do{var p=vT(n,a),m=p[0],f=p[1],w=p[2],S=f-w-o*m;(m||S)&&bT(n,a)&&(u+=S,h+=m),a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(d&&(i&&u===0||!i&&s>u)||!d&&(i&&h===0||!i&&-s>h))&&(c=!0),c},hg=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},ST=function(n){return[n.deltaX,n.deltaY]},xT=function(n){return n&&"current"in n?n.current:n},Nq=function(n,e){return n[0]===e[0]&&n[1]===e[1]},Fq=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},$q=0,Dl=[];function Bq(n){var e=v.useRef([]),t=v.useRef([0,0]),r=v.useRef(),i=v.useState($q++)[0],o=v.useState(function(){return mT()})[0],s=v.useRef(n);v.useEffect(function(){s.current=n},[n]),v.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var f=cq([n.lockRef.current],(n.shards||[]).map(xT),!0).filter(Boolean);return f.forEach(function(w){return w.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),f.forEach(function(w){return w.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var a=v.useCallback(function(f,w){if("touches"in f&&f.touches.length===2)return!s.current.allowPinchZoom;var S=hg(f),b=t.current,_="deltaX"in f?f.deltaX:b[0]-S[0],x="deltaY"in f?f.deltaY:b[1]-S[1],P,C=f.target,E=Math.abs(_)>Math.abs(x)?"h":"v";if("touches"in f&&E==="h"&&C.type==="range")return!1;var I=wT(E,C);if(!I)return!0;if(I?P=E:(P=E==="v"?"h":"v",I=wT(E,C)),!I)return!1;if(!r.current&&"changedTouches"in f&&(_||x)&&(r.current=P),!P)return!0;var A=r.current||P;return zq(A,w,f,A==="h"?_:x,!0)},[]),l=v.useCallback(function(f){var w=f;if(!(!Dl.length||Dl[Dl.length-1]!==o)){var S="deltaY"in w?ST(w):hg(w),b=e.current.filter(function(P){return P.name===w.type&&P.target===w.target&&Nq(P.delta,S)})[0];if(b&&b.should){w.cancelable&&w.preventDefault();return}if(!b){var _=(s.current.shards||[]).map(xT).filter(Boolean).filter(function(P){return P.contains(w.target)}),x=_.length>0?a(w,_[0]):!s.current.noIsolation;x&&w.cancelable&&w.preventDefault()}}},[]),c=v.useCallback(function(f,w,S,b){var _={name:f,delta:w,target:S,should:b};e.current.push(_),setTimeout(function(){e.current=e.current.filter(function(x){return x!==_})},1)},[]),d=v.useCallback(function(f){t.current=hg(f),r.current=void 0},[]),u=v.useCallback(function(f){c(f.type,ST(f),f.target,a(f,n.lockRef.current))},[]),h=v.useCallback(function(f){c(f.type,hg(f),f.target,a(f,n.lockRef.current))},[]);v.useEffect(function(){return Dl.push(o),n.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Ol),document.addEventListener("touchmove",l,Ol),document.addEventListener("touchstart",d,Ol),function(){Dl=Dl.filter(function(f){return f!==o}),document.removeEventListener("wheel",l,Ol),document.removeEventListener("touchmove",l,Ol),document.removeEventListener("touchstart",d,Ol)}},[]);var p=n.removeScrollBar,m=n.inert;return v.createElement(v.Fragment,null,m?v.createElement(o,{styles:Fq(i)}):null,p?v.createElement(Aq,{gapMode:"margin"}):null)}const Uq=wq(fT,Bq);var _T=v.forwardRef(function(n,e){return v.createElement(dg,Ci({},n,{ref:e,sideCar:Uq}))});_T.classNames=dg.classNames;const Rv=_T;var Vq=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Ll=new WeakMap,pg=new WeakMap,fg={},Ov=0,kT=function(n){return n&&(n.host||kT(n.parentNode))},Hq=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=kT(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},Wq=function(n,e,t,r){var i=Hq(e,Array.isArray(n)?n:[n]);fg[t]||(fg[t]=new WeakMap);var o=fg[t],s=[],a=new Set,l=new Set(i),c=function(u){!u||a.has(u)||(a.add(u),c(u.parentNode))};i.forEach(c);var d=function(u){!u||l.has(u)||Array.prototype.forEach.call(u.children,function(h){if(a.has(h))d(h);else{var p=h.getAttribute(r),m=p!==null&&p!=="false",f=(Ll.get(h)||0)+1,w=(o.get(h)||0)+1;Ll.set(h,f),o.set(h,w),s.push(h),f===1&&m&&pg.set(h,!0),w===1&&h.setAttribute(t,"true"),m||h.setAttribute(r,"true")}})};return d(e),a.clear(),Ov++,function(){s.forEach(function(u){var h=Ll.get(u)-1,p=o.get(u)-1;Ll.set(u,h),o.set(u,p),h||(pg.has(u)||u.removeAttribute(r),pg.delete(u)),p||u.removeAttribute(t)}),Ov--,Ov||(Ll=new WeakMap,Ll=new WeakMap,pg=new WeakMap,fg={})}},Dv=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),i=e||Vq(n);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),Wq(r,i,t,"aria-hidden")):function(){return null}};const CT="Dialog",[PT,Due]=_i(CT),[Kq,uo]=PT(CT),Gq=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:i,onOpenChange:o,modal:s=!0}=n,a=v.useRef(null),l=v.useRef(null),[c=!1,d]=os({prop:r,defaultProp:i,onChange:o});return v.createElement(Kq,{scope:e,triggerRef:a,contentRef:l,contentId:co(),titleId:co(),descriptionId:co(),open:c,onOpenChange:d,onOpenToggle:v.useCallback(()=>d(u=>!u),[d]),modal:s},t)},ET="DialogPortal",[Yq,IT]=PT(ET,{forceMount:void 0}),Xq=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:i}=n,o=uo(ET,e);return v.createElement(Yq,{scope:e,forceMount:t},v.Children.map(r,s=>v.createElement(Qr,{present:t||o.open},v.createElement(lq,{asChild:!0,container:i},s))))},Lv="DialogOverlay",qq=v.forwardRef((n,e)=>{const t=IT(Lv,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,o=uo(Lv,n.__scopeDialog);return o.modal?v.createElement(Qr,{present:r||o.open},v.createElement(Jq,J({},i,{ref:e}))):null}),Jq=v.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=uo(Lv,t);return v.createElement(Rv,{as:Js,allowPinchZoom:!0,shards:[i.contentRef]},v.createElement(Ae.div,J({"data-state":AT(i.open)},r,{ref:e,style:{pointerEvents:"auto",...r.style}})))}),Vd="DialogContent",Zq=v.forwardRef((n,e)=>{const t=IT(Vd,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,o=uo(Vd,n.__scopeDialog);return v.createElement(Qr,{present:r||o.open},o.modal?v.createElement(Qq,J({},i,{ref:e})):v.createElement(eJ,J({},i,{ref:e})))}),Qq=v.forwardRef((n,e)=>{const t=uo(Vd,n.__scopeDialog),r=v.useRef(null),i=Ge(e,t.contentRef,r);return v.useEffect(()=>{const o=r.current;if(o)return Dv(o)},[]),v.createElement(MT,J({},n,{ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ne(n.onCloseAutoFocus,o=>{var s;o.preventDefault(),(s=t.triggerRef.current)===null||s===void 0||s.focus()}),onPointerDownOutside:ne(n.onPointerDownOutside,o=>{const s=o.detail.originalEvent,a=s.button===0&&s.ctrlKey===!0;(s.button===2||a)&&o.preventDefault()}),onFocusOutside:ne(n.onFocusOutside,o=>o.preventDefault())}))}),eJ=v.forwardRef((n,e)=>{const t=uo(Vd,n.__scopeDialog),r=v.useRef(!1),i=v.useRef(!1);return v.createElement(MT,J({},n,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var s;if((s=n.onCloseAutoFocus)===null||s===void 0||s.call(n,o),!o.defaultPrevented){var a;r.current||(a=t.triggerRef.current)===null||a===void 0||a.focus(),o.preventDefault()}r.current=!1,i.current=!1},onInteractOutside:o=>{var s,a;(s=n.onInteractOutside)===null||s===void 0||s.call(n,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const l=o.target;!((a=t.triggerRef.current)===null||a===void 0)&&a.contains(l)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),MT=v.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...s}=n,a=uo(Vd,t),l=v.useRef(null),c=Ge(e,l);return Mv(),v.createElement(v.Fragment,null,v.createElement(Ev,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},v.createElement(QX,J({role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":AT(a.open)},s,{ref:c,onDismiss:()=>a.onOpenChange(!1)}))),!1)}),tJ="DialogTitle",nJ=v.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=uo(tJ,t);return v.createElement(Ae.h2,J({id:i.titleId},r,{ref:e}))}),rJ="DialogClose",iJ=v.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=uo(rJ,t);return v.createElement(Ae.button,J({type:"button"},r,{ref:e,onClick:ne(n.onClick,()=>i.onOpenChange(!1))}))});function AT(n){return n?"open":"closed"}const oJ=Gq,sJ=Xq,aJ=qq,lJ=Zq;function gg({className:n,children:e}){return g.jsx("div",{className:ye("tlui-dialog__header",n),children:e})}function mg({className:n,children:e}){return g.jsx(nJ,{dir:"ltr",className:ye("tlui-dialog__header__title",n),children:e})}function yg(){return g.jsx("div",{className:"tlui-dialog__header__close",children:g.jsx(iJ,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:g.jsx(le,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:g.jsx(hr,{small:!0,icon:"cross-2"})})})})}function Hd({className:n,children:e,style:t}){return g.jsx("div",{className:ye("tlui-dialog__body",n),style:t,children:e})}function zv({className:n,children:e}){return g.jsx("div",{className:ye("tlui-dialog__footer",n),children:e})}const Nv=v.forwardRef(function({className:n,label:e,icon:t,iconLeft:r,autoselect:i=!1,autofocus:o=!1,defaultValue:s,placeholder:a,onComplete:l,onValueChange:c,onCancel:d,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:h=!1,children:p,value:m},f){const w=G(),S=v.useRef(null);v.useImperativeHandle(f,()=>S.current);const b=Ie(),_=v.useRef(s??""),x=v.useRef(s??""),[P,C]=v.useState(!1),E=v.useCallback(D=>{C(!0);const F=D.currentTarget;x.current=F.value,requestAnimationFrame(()=>{i&&F.select()})},[i]),I=v.useCallback(D=>{const F=D.currentTarget.value;x.current=F,c==null||c(F)},[c]),A=v.useCallback(D=>{switch(D.key){case"Enter":{D.currentTarget.blur(),Ft(D),l==null||l(D.currentTarget.value);break}case"Escape":{D.currentTarget.value=_.current,D.currentTarget.blur(),Ft(D),d==null||d(D.currentTarget.value);break}}},[l,d]),T=v.useCallback(D=>{C(!1);const F=D.currentTarget.value;u==null||u(F)},[u]);return v.useEffect(()=>{if(!w.environment.isIos)return;const D=window.visualViewport;if(P&&h&&D){const F=()=>{var H;(H=S.current)==null||H.scrollIntoView({block:"center"})};return D.addEventListener("resize",F),D.addEventListener("scroll",F),requestAnimationFrame(()=>{var H;(H=S.current)==null||H.scrollIntoView({block:"center"})}),()=>{D.removeEventListener("resize",F),D.removeEventListener("scroll",F)}}},[w,P,h]),g.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[p,e&&g.jsx("label",{children:b(e)}),r&&g.jsx(hr,{icon:r,className:"tlui-icon-left",small:!0}),g.jsx("input",{ref:S,className:ye("tlui-input",n),type:"text",defaultValue:s,onKeyUp:A,onChange:I,onFocus:E,onBlur:T,autoFocus:o,placeholder:a,value:m}),t&&g.jsx(hr,{icon:t,small:!!e})]})});function TT(n){return or.isValid(n)?{isValid:!0,hasProtocol:!0}:or.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const cJ=ze(function({onClose:n}){const e=G().getOnlySelectedShape();return e&&"url"in e.props&&typeof e.props.url=="string"?g.jsx(dJ,{onClose:n,selectedShape:e}):null}),dJ=ze(function({onClose:n,selectedShape:e}){const t=G(),r=Ie(),i=v.useRef(null);v.useEffect(()=>{requestAnimationFrame(()=>{var p;return(p=i.current)==null?void 0:p.focus()})},[]);const o=v.useRef(e.props.url),[s,a]=v.useState(()=>{const p=TT(e.props.url),m=p.isValid===!0?p.hasProtocol?e.props.url:"https://"+e.props.url:"https://";return{actual:m,safe:m,valid:!0}}),l=v.useCallback(p=>{const m=p.replace(/https?:\/\/(https?:\/\/)/,(S,b)=>b),f=TT(m),w=f.isValid===!0?f.hasProtocol?m:"https://"+m:"https://";a({actual:m,safe:w,valid:f.isValid})},[]),c=v.useCallback(()=>{const p=t.getOnlySelectedShape();p&&(t.updateShapes([{id:p.id,type:p.type,props:{url:""}}]),n())},[t,n]),d=v.useCallback(()=>{const p=t.getOnlySelectedShape();p&&(p&&"url"in p.props&&p.props.url!==s.safe&&t.updateShapes([{id:p.id,type:p.type,props:{url:s.safe}}]),n())},[t,n,s]),u=v.useCallback(()=>{n()},[n]);if(!e)return n(),null;const h=o.current&&!s.valid;return g.jsxs(g.Fragment,{children:[g.jsxs(gg,{children:[g.jsx(mg,{children:r("edit-link-dialog.title")}),g.jsx(yg,{})]}),g.jsx(Hd,{children:g.jsxs("div",{className:"tlui-edit-link-dialog",children:[g.jsx(Nv,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:s.actual,onValueChange:l,onComplete:d,onCancel:u}),g.jsx("div",{children:s.valid?r("edit-link-dialog.detail"):r("edit-link-dialog.invalid-url")})]})}),g.jsxs(zv,{className:"tlui-dialog__footer__actions",children:[g.jsx(le,{type:"normal",onClick:u,onTouchEnd:u,children:r("edit-link-dialog.cancel")}),h?g.jsx(le,{type:"danger",onTouchEnd:c,onClick:c,children:r("edit-link-dialog.clear")}):g.jsx(le,{type:"primary",disabled:!s.valid,onTouchEnd:d,onClick:d,children:r("edit-link-dialog.save")})]})]})}),jT=ze(function({onClose:n}){const e=G(),t=Ie(),r=xv(),[i,o]=v.useState(null),[s,a]=v.useState(""),[l,c]=v.useState(null),[d,u]=v.useState(!1),h=v.useRef(-1);return g.jsxs(g.Fragment,{children:[g.jsxs(gg,{children:[g.jsx(mg,{children:i?`${t("embed-dialog.title")} \u2014 ${i.title}`:t("embed-dialog.title")}),g.jsx(yg,{})]}),i?g.jsxs(g.Fragment,{children:[g.jsxs(Hd,{className:"tlui-embed-dialog__enter",children:[g.jsx(Nv,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:p=>{a(p);const m=ao(p);c(m&&m.definition.type===i.type?m:null),u(!1),clearTimeout(h.current),h.current=setTimeout(()=>u(!m),320)}}),s===""?g.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[g.jsx("span",{children:t("embed-dialog.instruction")})," ",i.instructionLink&&g.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",g.jsx(hr,{icon:"external-link",small:!0})]})]}):g.jsx("div",{className:"tlui-embed-dialog__warning",children:d?t("embed-dialog.invalid-url"):"\xA0"})]}),g.jsxs(zv,{className:"tlui-dialog__footer__actions",children:[g.jsx(le,{type:"normal",onClick:()=>{o(null),c(null),a("")},label:"embed-dialog.back"}),g.jsx("div",{className:"tlui-embed__spacer"}),g.jsx(le,{type:"normal",label:"embed-dialog.cancel",onClick:n}),g.jsx(le,{type:"primary",disabled:!l,label:"embed-dialog.create",onClick:()=>{l&&(e.putExternalContent({type:"embed",url:s,point:e.getViewportPageCenter(),embed:l.definition}),n())}})]})]}):g.jsx(g.Fragment,{children:g.jsx(Hd,{className:"tlui-embed-dialog__list",children:Za.map(p=>g.jsx(le,{type:"menu",onClick:()=>o(p),label:p.title,children:g.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${r.embedIcons[p.type]})`}})},p.type))})})]})});var Fv={exports:{}};Fv.exports,function(n){var e=function(){var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function s(l,c){if(!o[l]){o[l]={};for(var d=0;d<l.length;d++)o[l][l.charAt(d)]=d}return o[l][c]}var a={compressToBase64:function(l){if(l==null)return"";var c=a._compress(l,6,function(d){return r.charAt(d)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(c){return s(r,l.charAt(c))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(c){return t(c+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(c){return l.charCodeAt(c)-32})},compressToUint8Array:function(l){for(var c=a.compress(l),d=new Uint8Array(c.length*2),u=0,h=c.length;u<h;u++){var p=c.charCodeAt(u);d[u*2]=p>>>8,d[u*2+1]=p%256}return d},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var c=new Array(l.length/2),d=0,u=c.length;d<u;d++)c[d]=l[d*2]*256+l[d*2+1];var h=[];return c.forEach(function(p){h.push(t(p))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(c){return s(i,l.charAt(c))}))},compress:function(l){return a._compress(l,16,function(c){return t(c)})},_compress:function(l,c,d){if(l==null)return"";var u,h,p={},m={},f="",w="",S="",b=2,_=3,x=2,P=[],C=0,E=0,I;for(I=0;I<l.length;I+=1)if(f=l.charAt(I),Object.prototype.hasOwnProperty.call(p,f)||(p[f]=_++,m[f]=!0),w=S+f,Object.prototype.hasOwnProperty.call(p,w))S=w;else{if(Object.prototype.hasOwnProperty.call(m,S)){if(S.charCodeAt(0)<256){for(u=0;u<x;u++)C=C<<1,E==c-1?(E=0,P.push(d(C)),C=0):E++;for(h=S.charCodeAt(0),u=0;u<8;u++)C=C<<1|h&1,E==c-1?(E=0,P.push(d(C)),C=0):E++,h=h>>1}else{for(h=1,u=0;u<x;u++)C=C<<1|h,E==c-1?(E=0,P.push(d(C)),C=0):E++,h=0;for(h=S.charCodeAt(0),u=0;u<16;u++)C=C<<1|h&1,E==c-1?(E=0,P.push(d(C)),C=0):E++,h=h>>1}b--,b==0&&(b=Math.pow(2,x),x++),delete m[S]}else for(h=p[S],u=0;u<x;u++)C=C<<1|h&1,E==c-1?(E=0,P.push(d(C)),C=0):E++,h=h>>1;b--,b==0&&(b=Math.pow(2,x),x++),p[w]=_++,S=String(f)}if(S!==""){if(Object.prototype.hasOwnProperty.call(m,S)){if(S.charCodeAt(0)<256){for(u=0;u<x;u++)C=C<<1,E==c-1?(E=0,P.push(d(C)),C=0):E++;for(h=S.charCodeAt(0),u=0;u<8;u++)C=C<<1|h&1,E==c-1?(E=0,P.push(d(C)),C=0):E++,h=h>>1}else{for(h=1,u=0;u<x;u++)C=C<<1|h,E==c-1?(E=0,P.push(d(C)),C=0):E++,h=0;for(h=S.charCodeAt(0),u=0;u<16;u++)C=C<<1|h&1,E==c-1?(E=0,P.push(d(C)),C=0):E++,h=h>>1}b--,b==0&&(b=Math.pow(2,x),x++),delete m[S]}else for(h=p[S],u=0;u<x;u++)C=C<<1|h&1,E==c-1?(E=0,P.push(d(C)),C=0):E++,h=h>>1;b--,b==0&&(b=Math.pow(2,x),x++)}for(h=2,u=0;u<x;u++)C=C<<1|h&1,E==c-1?(E=0,P.push(d(C)),C=0):E++,h=h>>1;for(;;)if(C=C<<1,E==c-1){P.push(d(C));break}else E++;return P.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(c){return l.charCodeAt(c)})},_decompress:function(l,c,d){var u=[],h=4,p=4,m=3,f="",w=[],S,b,_,x,P,C,E,I={val:d(0),position:c,index:1};for(S=0;S<3;S+=1)u[S]=S;for(_=0,P=Math.pow(2,2),C=1;C!=P;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*C,C<<=1;switch(_){case 0:for(_=0,P=Math.pow(2,8),C=1;C!=P;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*C,C<<=1;E=t(_);break;case 1:for(_=0,P=Math.pow(2,16),C=1;C!=P;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*C,C<<=1;E=t(_);break;case 2:return""}for(u[3]=E,b=E,w.push(E);;){if(I.index>l)return"";for(_=0,P=Math.pow(2,m),C=1;C!=P;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*C,C<<=1;switch(E=_){case 0:for(_=0,P=Math.pow(2,8),C=1;C!=P;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*C,C<<=1;u[p++]=t(_),E=p-1,h--;break;case 1:for(_=0,P=Math.pow(2,16),C=1;C!=P;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=d(I.index++)),_|=(x>0?1:0)*C,C<<=1;u[p++]=t(_),E=p-1,h--;break;case 2:return w.join("")}if(h==0&&(h=Math.pow(2,m),m++),u[E])f=u[E];else if(E===p)f=b+b.charAt(0);else return null;w.push(f),u[p++]=b+f.charAt(0),h--,b=f,h==0&&(h=Math.pow(2,m),m++)}}};return a}();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(Fv);var RT=Fv.exports;async function uJ(n,e,t){var S,b,_;const{elements:r,files:i}=e,o={shapes:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},s=new Map,a=new Map,l=n.getCurrentPageId(),c=new Map,d=[],u=new Set;r.forEach(x=>{if(c.set(x.id,tt()),x.boundElements!==null)for(const P of x.boundElements)P.type==="text"&&u.add(P.id)});let h="a1";for(const x of r){if(u.has(x.id))continue;const P=c.get(x.id),C={id:P,typeName:"shape",parentId:l,index:h,x:x.x,y:x.y,rotation:0,isLocked:x.locked,opacity:hJ(x.opacity),meta:{}};switch(x.angle!==0&&a.set(P,x.angle),x.groupIds&&x.groupIds.length>0?s.has(x.groupIds[0])?(S=s.get(x.groupIds[0]))==null||S.push(P):s.set(x.groupIds[0],[P]):d.push(P),x.type){case"rectangle":case"ellipse":case"diamond":{let E="",I="middle";if(x.boundElements!==null){for(const T of x.boundElements)if(T.type==="text"){const D=r.find(F=>F.id===T.id);D&&(E=D.text,I=OT[D.textAlign])}}const A=x.backgroundColor==="transparent"?x.strokeColor:x.backgroundColor;o.shapes.push({...C,type:"geo",props:{geo:x.type,url:x.link??"",w:x.width,h:x.height,size:wg[x.strokeWidth]??"draw",color:Wd[A]??"black",text:E,align:I,dash:bg(x),fill:bJ(x)}});break}case"freedraw":{o.shapes.push({...C,type:"draw",props:{dash:bg(x),size:wg[x.strokeWidth],color:Wd[x.strokeColor]??"black",segments:[{type:"free",points:x.points.map(([E,I,A=.5])=>({x:E,y:I,z:A}))}]}});break}case"line":{const E=x.points[0],I=x.points[x.points.length-1],A=LP(x.points.length);o.shapes.push({...C,type:"line",props:{dash:bg(x),size:wg[x.strokeWidth],color:Wd[x.strokeColor]??"black",spline:x.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:A[0],x:E[0],y:E[1]},end:{id:"end",type:"vertex",index:A[A.length-1],x:I[0],y:I[1]},...Object.fromEntries(x.points.slice(1,-1).map(([T,D],F)=>{const H=qe();return[H,{id:H,type:"vertex",index:A[F+1],x:T,y:D}]}))}}});break}case"arrow":{let E="";if(x.boundElements!==null){for(const F of x.boundElements)if(F.type==="text"){const H=r.find(O=>O.id===F.id);H&&(E=H.text)}}const I=x.points[0],A=x.points[x.points.length-1],T=c.get((b=x.startBinding)==null?void 0:b.elementId),D=c.get((_=x.endBinding)==null?void 0:_.elementId);o.shapes.push({...C,type:"arrow",props:{text:E,bend:wJ(x,I,A),dash:bg(x),size:wg[x.strokeWidth]??"m",color:Wd[x.strokeColor]??"black",start:T?{type:"binding",boundShapeId:T,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:I[0],y:I[1]},end:D?{type:"binding",boundShapeId:D,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:A[0],y:A[1]},arrowheadEnd:DT[x.endArrowhead]??"none",arrowheadStart:DT[x.startArrowhead]??"none"}});break}case"text":{const{size:E,scale:I}=fJ(x.fontSize);o.shapes.push({...C,type:"text",props:{size:E,scale:I,font:gJ[x.fontFamily]??"draw",color:Wd[x.strokeColor]??"black",text:x.text,align:OT[x.textAlign]}});break}case"image":{const E=i[x.fileId];if(!E)break;const I=Ns.createId();o.assets.push({id:I,typeName:"asset",type:"image",props:{w:x.width,h:x.height,name:x.id??"Untitled",isAnimated:!1,mimeType:E.mimeType,src:E.dataURL},meta:{}}),o.shapes.push({...C,type:"image",props:{w:x.width,h:x.height,assetId:I}})}}h=to(h)}const p=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.mark("paste"),n.putContentOntoCurrentPage(o,{point:p,select:!1,preserveIds:!0});for(const x of s.values())if(x.length>1){n.groupShapes(x);const P=n.getShape(x[0]);P!=null&&P.parentId&&kr(P.parentId)&&d.push(P.parentId)}for(const[x,P]of a)n.select(x),n.rotateShapesBy([x],P);const m=me(d.map(x=>n.getShape(x))),f=de.Common(m.map(x=>n.getShapePageBounds(x))),w=n.getViewportPageBounds().center;n.updateShapes(m.map(x=>{const P={x:(x.x??0)-(f.x+f.w/2),y:(x.y??0)-(f.y+f.h/2)};return{id:x.id,type:x.type,x:w.x+P.x,y:w.y+P.y}})),n.setSelectedShapes(d)}const hJ=n=>{const e=n/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},wg={1:"s",2:"m",3:"l",4:"xl"},pJ={16:"s",20:"m",28:"l",36:"xl"};function fJ(n){const e=pJ[n];return e?{size:e,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const gJ={1:"draw",2:"sans",3:"mono"},Wd={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},mJ={solid:"draw",dashed:"dashed",dotted:"dotted"},yJ={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},OT={left:"start",center:"middle",right:"end"},DT={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function wJ(n,e,t){let r=0;if(n.points.length>2){const i=new k(e[0],e[1]),o=new k(t[0],t[1]),s=new k(n.points[1][0],n.points[1][1]),a=k.Sub(o,i),l=k.Per(a),c=k.Med(o,i),d=k.Sub(c,l),u=k.Add(c,l),h=k.NearestPointOnLineSegment(d,u,s,!1);r=k.Dist(h,c),k.Clockwise(h,o,c)&&(r*=-1)}return r}const bg=n=>{let e=mJ[n.strokeStyle]??"draw";return e==="draw"&&n.roughness===0&&(e="solid"),e},bJ=n=>n.backgroundColor==="transparent"?"none":yJ[n.fillStyle]??"solid";async function LT(n,e,t,r){const i=(await Promise.all(e.map(async o=>await(await fetch(o)).blob()))).map(o=>new File([o],"tldrawFile",{type:o.type}));n.mark("paste"),await n.putExternalContent({type:"files",files:i,point:t,ignoreParent:!1,sources:r}),e.forEach(o=>URL.revokeObjectURL(o))}function vJ(n,e,t){const r=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.mark("paste"),n.putContentOntoCurrentPage(e,{point:r,select:!0})}async function $v(n,e,t,r){var i;try{if(new URL(e).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)&&((i=(await fetch(e,{method:"HEAD"})).headers.get("content-type"))!=null&&i.match(/^image\//))){n.mark("paste"),LT(n,[e]);return}}catch(o){o.message!=="Failed to fetch"&&console.error(o)}return n.mark("paste"),await n.putExternalContent({type:"url",point:t,url:e,sources:r})}const zT=()=>{},NT=v.createContext({});function SJ({onEvent:n,children:e}){return g.jsx(NT.Provider,{value:n??zT,children:e})}function zl(){return v.useContext(NT)??zT}function xJ(n){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n.trim(),e.body.textContent||e.body.innerText||""}const _J=n=>{try{const e=new URL(n);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},kJ=n=>{const e=n.split(/[\n\s]/);for(const t of e)try{const r=new URL(t);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return aP(e)},CJ=n=>/^<svg/.test(n),PJ=["input","select","textarea"];function vg(n){const{activeElement:e}=document;return n.getIsMenuOpen()||e&&(e.getAttribute("contenteditable")||PJ.indexOf(e.tagName.toLowerCase())>-1)}async function Bv(n){return new Promise((e,t)=>{const r=new FileReader;r.addEventListener("loadend",()=>{const i=r.result;e(i)}),r.addEventListener("error",()=>{t(r.error)}),r.readAsText(n)})}const EJ=n=>n.types.find(e=>e.match(/^image\//)),Uv=(n,e,t,r)=>{const i=kJ(e);if(i)for(const o of i)$v(n,o,t);else _J(e)?$v(n,e,t):CJ(e)?(n.mark("paste"),n.putExternalContent({type:"svg-text",text:e,point:t,sources:r})):(n.mark("paste"),n.putExternalContent({type:"text",text:e,point:t,sources:r}))},IJ=async(n,e,t)=>{if(n.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{r.push({type:"file",source:new Promise(o=>o(i.getAsFile()))});break}case"string":{i.type==="text/html"?r.push({type:"html",source:new Promise(o=>i.getAsString(o))}):i.type==="text/plain"?r.push({type:"text",source:new Promise(o=>i.getAsString(o))}):r.push({type:i.type,source:new Promise(o=>i.getAsString(o))});break}}$T(n,r,t)},FT=async(n,e,t)=>{const r=[];for(const i of e){if(EJ(i))for(const o of i.types)o.match(/^image\//)&&r.push({type:"blob",source:i.getType(o)});i.types.includes("text/html")&&r.push({type:"html",source:new Promise(o=>i.getType("text/html").then(s=>Bv(s).then(o)))}),i.types.includes("text/uri-list")&&r.push({type:"url",source:new Promise(o=>i.getType("text/uri-list").then(s=>Bv(s).then(o)))}),i.types.includes("text/plain")&&r.push({type:"text",source:new Promise(o=>i.getType("text/plain").then(s=>Bv(s).then(o)))})}return await $T(n,r,t)};async function $T(n,e,t){const r=e.filter(o=>(o.type==="file"||o.type==="blob")&&o.source!==null);if(r.length){const o=(await Promise.all(r.map(s=>s.source))).filter(Boolean).map(s=>URL.createObjectURL(s));return await LT(n,o,t)}const i=await Promise.all(e.filter(o=>o.type!=="file").map(o=>new Promise(s=>{const a=o;if(a.type==="file"){s({type:"error",data:null,reason:"unexpected file"});return}a.source.then(l=>{var d;const c=(d=l.match(/<tldraw[^>]*>(.*)<\/tldraw>/))==null?void 0:d[1];if(c)try{const u=RT.decompressFromBase64(c);if(u===null){s({type:"error",data:u,reason:"found tldraw data comment but could not parse base64"});return}else{const h=JSON.parse(u);if(h.type!=="application/tldraw"&&s({type:"error",data:h,reason:`found tldraw data comment but JSON was of a different type: ${h.type}`}),typeof h.data=="string"){s({type:"error",data:h,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}s({type:"tldraw",data:h.data});return}}catch{s({type:"error",data:c,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){s({type:"text",data:l,subtype:"html"});return}if(a.type==="url"){s({type:"text",data:l,subtype:"url"});return}try{const u=JSON.parse(l);if(u.type==="excalidraw/clipboard"){s({type:"excalidraw",data:u});return}else{s({type:"text",data:l,subtype:"json"});return}}catch{s({type:"text",data:l,subtype:"text"});return}}s({type:"error",data:l,reason:"unhandled case"})})})));for(const o of i)if(o.type==="tldraw"){vJ(n,o.data,t);return}for(const o of i)if(o.type==="excalidraw"){uJ(n,o.data,t);return}for(const o of i)if(o.type==="text"&&o.subtype==="html"){const s=new DOMParser().parseFromString(o.data,"text/html").querySelector("body");if(s&&Array.from(s.children).filter(a=>a.nodeType===1).length===1&&s.firstElementChild&&s.firstElementChild.tagName==="A"&&s.firstElementChild.hasAttribute("href")&&s.firstElementChild.getAttribute("href")!==""){const a=s.firstElementChild.getAttribute("href");Uv(n,a,t,i);return}if(!i.some(a=>a.type==="text"&&a.subtype!=="html")&&o.data.trim()){Uv(n,xJ(o.data),t,i);return}}for(const o of i)if(o.type==="text"&&o.subtype==="url"){$v(n,o.data,t,i);return}for(const o of i)if(o.type==="text"&&o.subtype==="text"&&o.data.trim()){Uv(n,o.data,t,i);return}}const Sg=n=>{var r;const e=n.getContentFromCurrentPage(n.getSelectedShapeIds());if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const t=RT.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const i=e.shapes.map(o=>n.isShapeOfType(o,"text")||n.isShapeOfType(o,"geo")||n.isShapeOfType(o,"arrow")?o.props.text:n.isShapeOfType(o,"bookmark")||n.isShapeOfType(o,"embed")?o.props.url:null).filter(fD);if((r=navigator.clipboard)!=null&&r.write){const o=new Blob([`<tldraw>${t}</tldraw>`],{type:"text/html"});let s=i.join(" ");s===""&&(s=" "),navigator.clipboard.write([new ClipboardItem({"text/html":o,"text/plain":new Blob([s],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${t}</tldraw>`)}};function MJ(){const n=G(),e=zl(),t=v.useCallback(function(o){n.getSelectedShapeIds().length!==0&&(Sg(n),e("copy",{source:o}))},[n,e]),r=v.useCallback(function(o){n.getSelectedShapeIds().length!==0&&(Sg(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:o}))},[n,e]),i=v.useCallback(async function(o,s,a){n.getEditingShapeId()!==null||vg(n)||(Array.isArray(o)&&o[0]instanceof ClipboardItem?(FT(n,o,a),e("paste",{source:"menu"})):navigator.clipboard.read().then(l=>{i(l,s,a)}))},[n,e]);return{copy:t,cut:r,paste:i}}function AJ(){const n=G(),e=zl(),t=q("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);v.useEffect(()=>{if(!t)return;const r=()=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||vg(n)||(Sg(n),e("copy",{source:"kbd"}))};function i(){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||vg(n)||(Sg(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let o=!1;const s=l=>{l.button===1&&(o=!0,requestAnimationFrame(()=>{o=!1}))},a=l=>{if(o){l.stopPropagation();return}n.getEditingShapeId()!==null||vg(n)||(l.clipboardData&&!n.inputs.shiftKey?IJ(n,l.clipboardData):navigator.clipboard.read().then(c=>{Array.isArray(c)&&c[0]instanceof ClipboardItem&&FT(n,c,n.inputs.currentPagePoint)}),e("paste",{source:"kbd"}))};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}},[n,e,t])}async function TJ(n,e,t){const{type:r,quality:i,scale:o}=t,s=+n.getAttribute("width"),a=+n.getAttribute("height");let l=s*o,c=a*o;const d=await BT(n),u=URL.createObjectURL(new Blob([d],{type:"image/svg+xml"})),h=await uM();if(s>h.maxWidth&&(l=h.maxWidth,c=l/s*a),a>h.maxHeight&&(c=h.maxHeight,l=c/a*s),l*c>h.maxArea){const S=Math.sqrt(h.maxArea/(l*c));l*=S,c*=S}l=Math.floor(l),c=Math.floor(c);const p=l/s,m=await new Promise(S=>{const b=new Image;b.crossOrigin="anonymous",b.onload=async()=>{e&&await new Promise(P=>setTimeout(P,250));const _=document.createElement("canvas"),x=_.getContext("2d");_.width=l,_.height=c,x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(b,0,0,l,c),URL.revokeObjectURL(u),S(_)},b.onerror=()=>{S(null)},b.src=u});if(!m)return null;const f=await new Promise(S=>m.toBlob(b=>{(!b||nt.throwToBlob.get())&&S(null),S(b)},"image/"+r,i));if(!f)return null;const w=new DataView(await f.arrayBuffer());return pi.setPhysChunk(w,p,{type:"image/"+r})}async function BT(n){const e=n.cloneNode(!0);n.setAttribute("width",+n.getAttribute("width")+""),n.setAttribute("height",+n.getAttribute("height")+"");const t=new FileReader,r=Array.from(e.querySelectorAll("image"));for(const i of r){const o=i.getAttribute("xlink:href");if(o&&!o.startsWith("data:")){const s=await(await fetch(o)).blob(),a=await new Promise((l,c)=>{t.onload=()=>l(t.result),t.onerror=()=>c(t.error),t.readAsDataURL(s)});i.setAttribute("xlink:href",a)}}return new XMLSerializer().serializeToString(e).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}async function UT(n,e,t){const r=await n.getSvg(e!=null&&e.length?e:[...n.getCurrentPageShapeIds()],{scale:1,background:n.getInstanceState().exportBackground,...t});if(!r)throw new Error("Could not construct SVG.");return r}async function Vv(n,e,t,r={}){switch(t){case"svg":return BT(await UT(n,e,r));case"json":{const i=n.getContentFromCurrentPage(e);return JSON.stringify(i)}default:Wa(t)}}async function VT(n,e,t,r={}){switch(t){case"svg":return new Blob([await Vv(n,e,"svg",r)],{type:"text/plain"});case"json":return new Blob([await Vv(n,e,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const i=await TJ(await UT(n,e,r),n.environment.isSafari,{type:t,quality:1,scale:2});if(!i)throw new Error("Could not construct image.");return i}default:Wa(t)}}const jJ={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function RJ(n,e,t,r={}){return{blobPromise:VT(n,e,t,r),mimeType:jJ[t]}}function OJ(n,e,t="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:i,mimeType:o}=RJ(n,e,t,r);return window.navigator.clipboard.write([new ClipboardItem({[o]:i})]).catch(s=>(console.error(s),i.then(a=>window.navigator.clipboard.write([new ClipboardItem({[o]:a})]))))}switch(t){case"json":case"svg":return DJ(async()=>Vv(n,e,t,r));case"jpeg":case"png":throw new Error("Copy not supported");default:Wa(t)}}async function DJ(n){var e,t;await((t=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:t.call(e,await n()))}const HT=v.createContext({});function LJ({children:n}){const[e,t]=v.useState([]),r=v.useCallback(s=>{const a=s.id??qe();return t(l=>[...l.filter(c=>c.id!==s.id),{...s,id:a}]),a},[]),i=v.useCallback(s=>(t(a=>a.filter(l=>l.id!==s)),s),[]),o=v.useCallback(()=>{t(()=>[])},[]);return g.jsx(HT.Provider,{value:{toasts:e,addToast:r,removeToast:i,clearToasts:o},children:n})}function Pi(){const n=v.useContext(HT);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}function zJ(){const n=G(),{addToast:e}=Pi(),t=Ie();return v.useCallback((r,i="svg")=>{OJ(n,r,i).catch(()=>{e({id:"copy-fail",icon:"warning-triangle",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[n,e,t])}const WT=v.createContext({});function NJ({children:n}){const e=G(),t=zl(),[r,i]=v.useState([]),o=v.useCallback(c=>{const d=c.id??qe();return i(u=>[...u.filter(h=>h.id!==c.id),{...c,id:d}]),t("open-menu",{source:"dialog",id:d}),e.addOpenMenu(d),d},[e,t]),s=v.useCallback((c,d)=>(i(u=>u.map(h=>h.id===c?{...h,...d}:h)),t("open-menu",{source:"dialog",id:c}),e.addOpenMenu(c),c),[e,t]),a=v.useCallback(c=>(i(d=>d.filter(u=>{var h;return u.id===c?((h=u.onClose)==null||h.call(u),!1):!0})),t("close-menu",{source:"dialog",id:c}),e.deleteOpenMenu(c),c),[e,t]),l=v.useCallback(()=>{i(c=>(c.forEach(d=>{var u;(u=d.onClose)==null||u.call(d),t("close-menu",{source:"dialog",id:d.id}),e.deleteOpenMenu(d.id)}),[]))},[e,t]);return g.jsx(WT.Provider,{value:{dialogs:r,addDialog:o,removeDialog:a,clearDialogs:l,updateDialog:s},children:n})}function ea(){const n=v.useContext(WT);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}async function FJ(n,e,t="png",r={}){let i=`shapes at ${KT()}`;if(e.length===1){const a=n.getShape(e[0]);n.isShapeOfType(a,"frame")?i=a.props.name??"frame":i=`${a.id.replace(/:/,"_")} at ${KT()}`}i+=`.${t}`;const o=await VT(n,e,t,r),s=new File([o],i,{type:o.type});$J(s)}function KT(){const n=new Date,e=String(n.getFullYear()).slice(2),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),i=String(n.getHours()).padStart(2,"0"),o=String(n.getMinutes()).padStart(2,"0"),s=String(n.getSeconds()).padStart(2,"0");return`${e}-${t}-${r} ${i}.${o}.${s}`}function $J(n){const e=document.createElement("a"),t=URL.createObjectURL(n);e.href=t,e.download=n.name,e.click(),URL.revokeObjectURL(t)}function BJ(){const n=G(),{addToast:e}=Pi(),t=Ie();return v.useCallback((r,i="png")=>{FJ(n,r,i,{scale:1,background:n.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc")})})},[n,e,t])}function GT(){const n=G(),e=v.useRef();return v.useEffect(()=>{const t=window.document.createElement("input");t.type="file",t.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",t.multiple=!0,e.current=t;async function r(i){const o=i.target.files;!o||o.length===0||(await n.putExternalContent({type:"files",files:Array.from(o),point:n.getViewportPageBounds().center,ignoreParent:!1}),t.value="")}return t.addEventListener("change",r),()=>{e.current=void 0,t.removeEventListener("change",r)}},[n]),v.useCallback(()=>{var t;(t=e.current)==null||t.click()},[e])}function UJ(){const n=G(),e=v.useRef(null),t=v.useRef(null);return v.useCallback(async function(){const r=document.createElement("div"),i=document.createElement("style"),o=(f,w)=>{f&&(f.innerHTML=""),w&&document.head.contains(w)&&document.head.removeChild(w),f&&document.body.contains(f)&&document.body.removeChild(f)};o(e.current,t.current),e.current=r,t.current=i;const s=`tl-print-surface-${qe()}`;r.className=s,i.innerHTML=`
			.${s} {
				display: none;
			}

			.${s} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${s} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${s}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${s}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${s}__item__header {
					display: none;
				}

				.${s}__item__footer {
					display: none;
					text-align: right;
				}

				.${s}__item__footer__hide {
					display: none;
				}

				
			}

		`;const a=()=>{document.head.appendChild(i),document.body.appendChild(r)},l=()=>{n.once("change-history",()=>{o(r,i)})};window.addEventListener("beforeprint",a),window.addEventListener("afterprint",l);function c(f,w,S){try{r.innerHTML+=`<div class="${s}__item">
        <div class="${s}__item__header">
          ${f.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${s}__item__main">
          ${S.outerHTML}
        </div>
        <div class="${s}__item__footer ${s}__item__footer__${w?"":"hide"}">
          ${w??""}
        </div>
      </div>`}catch(b){console.error(b)}}function d(){n.environment.isChromeForIos?(a(),window.print()):n.environment.isSafari?(a(),document.execCommand("print",!1)):window.print()}const u=n.getSelectedShapeIds(),h=n.getCurrentPageId(),p=n.getPages(),m={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const f=await n.getSvg(u,m);if(f){const w=p.find(S=>S.id===h);c(`tldraw \u2014 ${w==null?void 0:w.name}`,null,f),d()}}else{const f=n.getCurrentPage(),w=await n.getSvg(n.getSortedChildIdsForParent(f.id),m);w&&(c(`tldraw \u2014 ${f.name}`,null,w),d())}window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",l)},[n])}const YT=v.createContext({});function VJ(n){return Object.fromEntries(n.map(e=>[e.id,e]))}function HJ({overrides:n,children:e}){const t=G(),{addDialog:r,clearDialogs:i}=ea(),{clearToasts:o}=Pi(),s=GT(),a=UJ(),{cut:l,copy:c,paste:d}=MJ(),u=zJ(),h=BJ(),p=zl(),m=v.useMemo(()=>{function f(){return t.isIn("select")||(t.complete(),t.setCurrentTool("select")),!1}function w(){return t.getSelectedShapeIds().length>0}const S=VJ([{id:"edit-link",label:"action.edit-link",icon:"link",readonlyOk:!1,onSelect(b){w()&&(f()||(p("edit-link",{source:b}),t.mark("edit-link"),r({component:cJ})))}},{id:"insert-embed",label:"action.insert-embed",readonlyOk:!1,kbd:"$i",onSelect(b){p("insert-embed",{source:b}),r({component:jT})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",readonlyOk:!1,onSelect(b){p("insert-media",{source:b}),s()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",readonlyOk:!1,onSelect(b){p("undo",{source:b}),t.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",readonlyOk:!1,onSelect(b){p("redo",{source:b}),t.redo()}},{id:"export-as-svg",label:"action.export-as-svg",menuLabel:"action.export-as-svg.short",contextMenuLabel:"action.export-as-svg.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"svg",source:b}),h(t.getSelectedShapeIds(),"svg")}},{id:"export-as-png",label:"action.export-as-png",menuLabel:"action.export-as-png.short",contextMenuLabel:"action.export-as-png.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"png",source:b}),h(t.getSelectedShapeIds(),"png")}},{id:"export-as-json",label:"action.export-as-json",menuLabel:"action.export-as-json.short",contextMenuLabel:"action.export-as-json.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"json",source:b}),h(t.getSelectedShapeIds(),"json")}},{id:"copy-as-svg",label:"action.copy-as-svg",menuLabel:"action.copy-as-svg.short",contextMenuLabel:"action.copy-as-svg.short",kbd:"$!c",readonlyOk:!0,onSelect(b){p("copy-as",{format:"svg",source:b}),u(t.getSelectedShapeIds(),"svg")}},{id:"copy-as-png",label:"action.copy-as-png",menuLabel:"action.copy-as-png.short",contextMenuLabel:"action.copy-as-png.short",readonlyOk:!0,onSelect(b){p("copy-as",{format:"png",source:b}),u(t.getSelectedShapeIds(),"png")}},{id:"copy-as-json",label:"action.copy-as-json",menuLabel:"action.copy-as-json.short",contextMenuLabel:"action.copy-as-json.short",readonlyOk:!0,onSelect(b){p("copy-as",{format:"json",source:b}),u(t.getSelectedShapeIds(),"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",readonlyOk:!1,onSelect(b){w()&&(f()||(p("toggle-auto-size",{source:b}),t.mark("toggling auto size"),t.updateShapes(t.getSelectedShapes().filter(_=>t.isShapeOfType(_,"text")&&_.props.autoSize===!1).map(_=>({id:_.id,type:_.type,props:{..._.props,w:8,autoSize:!0}})))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(b){p("open-embed-link",{source:b});const _=t.getSelectedShapeIds(),x="No embed shapes selected";if(_.length!==1){console.error(x);return}const P=t.getShape(_[0]);if(!P||!t.isShapeOfType(P,"embed")){console.error(x);return}y7(P.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(b){var _,x;if(((_=t.root.getCurrent())==null?void 0:_.id)!=="zoom"&&(p("zoom-tool",{source:b}),!(t.inputs.shiftKey||t.inputs.ctrlKey))){const P=t.root.getCurrent();P&&((x=P.getCurrent())==null?void 0:x.id)==="idle"&&t.setCurrentTool("zoom",{onInteractionEnd:P.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",readonlyOk:!1,onSelect(b){w()&&(f()||t.batch(()=>{p("convert-to-bookmark",{source:b});const _=t.getSelectedShapes(),x=[],P=[];for(const C of _){if(!C||!t.isShapeOfType(C,"embed")||!C.props.url)continue;const E=new k(C.x,C.y);E.rot(-C.rotation),E.add(new k(C.props.w/2-300/2,C.props.h/2-320/2)),E.rot(C.rotation);const I={id:tt(),type:"bookmark",rotation:C.rotation,x:E.x,y:E.y,opacity:1,props:{url:C.props.url}};x.push(I),P.push(C.id)}t.mark("convert shapes to bookmark"),t.deleteShapes(P),t.createShapes(x)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",readonlyOk:!1,onSelect(b){w()&&(f()||(p("convert-to-embed",{source:b}),t.batch(()=>{const _=t.getSelectedShapeIds(),x=me(_.map(E=>t.getShape(E))),P=[],C=[];for(const E of x){if(!t.isShapeOfType(E,"bookmark"))continue;const{url:I}=E.props,A=ao(E.props.url);if(!A||!A.definition)continue;const{width:T,height:D}=A.definition,F=new k(E.x,E.y);F.rot(-E.rotation),F.add(new k(E.props.w/2-T/2,E.props.h/2-D/2)),F.rot(E.rotation);const H={id:tt(),type:"embed",x:F.x,y:F.y,rotation:E.rotation,props:{url:I,w:T,h:D}};P.push(H),C.push(E.id)}t.mark("convert shapes to embed"),t.deleteShapes(C),t.createShapes(P)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",readonlyOk:!1,onSelect(b){if(!w()||f())return;p("duplicate-shapes",{source:b});const _=t.getSelectedShapeIds(),x=de.Common(me(_.map(C=>t.getShapePageBounds(C)))),P=t.getInstanceState().canMoveCamera?{x:x.width+10,y:0}:{x:16/t.getZoomLevel(),y:16/t.getZoomLevel()};t.mark("duplicate shapes"),t.duplicateShapes(_,P)}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",readonlyOk:!1,onSelect(b){w()&&(f()||(p("ungroup-shapes",{source:b}),t.mark("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",readonlyOk:!1,onSelect(b){if(!w()||f())return;p("group-shapes",{source:b});const _=t.getOnlySelectedShape();_&&t.isShapeOfType(_,"group")?(t.mark("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())):(t.mark("group"),t.groupShapes(t.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",readonlyOk:!1,onSelect(b){if(!w())return;p("remove-frame",{source:b});const _=t.getSelectedShapes();_.length>0&&_.every(x=>t.isShapeOfType(x,"frame"))&&(t.mark("remove-frame"),FX(t,_.map(x=>x.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",readonlyOk:!1,onSelect(b){if(!w())return;p("fit-frame-to-content",{source:b});const _=t.getOnlySelectedShape();_&&t.isShapeOfType(_,"frame")&&(t.mark("fit-frame-to-content"),BX(t,_.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"left",source:b}),t.mark("align left"),t.alignShapes(t.getSelectedShapeIds(),"left")))}},{id:"align-center-horizontal",label:"action.align-center-horizontal",contextMenuLabel:"action.align-center-horizontal.short",kbd:"?H",icon:"align-center-horizontal",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"center-horizontal",source:b}),t.mark("align center horizontal"),t.alignShapes(t.getSelectedShapeIds(),"center-horizontal")))}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"right",source:b}),t.mark("align right"),t.alignShapes(t.getSelectedShapeIds(),"right")))}},{id:"align-center-vertical",label:"action.align-center-vertical",contextMenuLabel:"action.align-center-vertical.short",kbd:"?V",icon:"align-center-vertical",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"center-vertical",source:b}),t.mark("align center vertical"),t.alignShapes(t.getSelectedShapeIds(),"center-vertical")))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"top",source:b}),t.mark("align top"),t.alignShapes(t.getSelectedShapeIds(),"top")))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",readonlyOk:!1,onSelect(b){w()&&(f()||(p("align-shapes",{operation:"bottom",source:b}),t.mark("align bottom"),t.alignShapes(t.getSelectedShapeIds(),"bottom")))}},{id:"distribute-horizontal",label:"action.distribute-horizontal",contextMenuLabel:"action.distribute-horizontal.short",icon:"distribute-horizontal",kbd:"?!h",readonlyOk:!1,onSelect(b){w()&&(f()||(p("distribute-shapes",{operation:"horizontal",source:b}),t.mark("distribute horizontal"),t.distributeShapes(t.getSelectedShapeIds(),"horizontal")))}},{id:"distribute-vertical",label:"action.distribute-vertical",contextMenuLabel:"action.distribute-vertical.short",icon:"distribute-vertical",kbd:"?!V",readonlyOk:!1,onSelect(b){w()&&(f()||(p("distribute-shapes",{operation:"vertical",source:b}),t.mark("distribute vertical"),t.distributeShapes(t.getSelectedShapeIds(),"vertical")))}},{id:"stretch-horizontal",label:"action.stretch-horizontal",contextMenuLabel:"action.stretch-horizontal.short",icon:"stretch-horizontal",readonlyOk:!1,onSelect(b){w()&&(f()||(p("stretch-shapes",{operation:"horizontal",source:b}),t.mark("stretch horizontal"),t.stretchShapes(t.getSelectedShapeIds(),"horizontal")))}},{id:"stretch-vertical",label:"action.stretch-vertical",contextMenuLabel:"action.stretch-vertical.short",icon:"stretch-vertical",readonlyOk:!1,onSelect(b){w()&&(f()||(p("stretch-shapes",{operation:"vertical",source:b}),t.mark("stretch vertical"),t.stretchShapes(t.getSelectedShapeIds(),"vertical")))}},{id:"flip-horizontal",label:"action.flip-horizontal",contextMenuLabel:"action.flip-horizontal.short",kbd:"!h",readonlyOk:!1,onSelect(b){w()&&(f()||(p("flip-shapes",{operation:"horizontal",source:b}),t.mark("flip horizontal"),t.flipShapes(t.getSelectedShapeIds(),"horizontal")))}},{id:"flip-vertical",label:"action.flip-vertical",contextMenuLabel:"action.flip-vertical.short",kbd:"!v",readonlyOk:!1,onSelect(b){w()&&(f()||(p("flip-shapes",{operation:"vertical",source:b}),t.mark("flip vertical"),t.flipShapes(t.getSelectedShapeIds(),"vertical")))}},{id:"pack",label:"action.pack",icon:"pack",readonlyOk:!1,onSelect(b){w()&&(f()||(p("pack-shapes",{source:b}),t.mark("pack"),t.packShapes(t.getSelectedShapeIds(),16)))}},{id:"stack-vertical",label:"action.stack-vertical",contextMenuLabel:"action.stack-vertical.short",icon:"stack-vertical",readonlyOk:!1,onSelect(b){w()&&(f()||(p("stack-shapes",{operation:"vertical",source:b}),t.mark("stack-vertical"),t.stackShapes(t.getSelectedShapeIds(),"vertical",16)))}},{id:"stack-horizontal",label:"action.stack-horizontal",contextMenuLabel:"action.stack-horizontal.short",icon:"stack-horizontal",readonlyOk:!1,onSelect(b){w()&&(f()||(p("stack-shapes",{operation:"horizontal",source:b}),t.mark("stack-horizontal"),t.stackShapes(t.getSelectedShapeIds(),"horizontal",16)))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",readonlyOk:!1,onSelect(b){w()&&(f()||(p("reorder-shapes",{operation:"toFront",source:b}),t.mark("bring to front"),t.bringToFront(t.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",readonlyOk:!1,onSelect(b){w()&&(f()||(p("reorder-shapes",{operation:"forward",source:b}),t.mark("bring forward"),t.bringForward(t.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",readonlyOk:!1,onSelect(b){w()&&(f()||(p("reorder-shapes",{operation:"backward",source:b}),t.mark("send backward"),t.sendBackward(t.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",readonlyOk:!1,onSelect(b){w()&&(f()||(p("reorder-shapes",{operation:"toBack",source:b}),t.mark("send to back"),t.sendToBack(t.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",readonlyOk:!1,onSelect(b){w()&&(f()||(t.mark("cut"),l(b)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(b){w()&&(f()||c(b))}},{id:"paste",label:"action.paste",kbd:"$v",readonlyOk:!1,onSelect(b){var _;(_=navigator.clipboard)==null||_.read().then(x=>{d(x,b,b==="context-menu"?t.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(b){t.batch(()=>{f()||(p("select-all-shapes",{source:b}),t.mark("select all kbd"),t.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(b){w()&&(f()||(p("select-none-shapes",{source:b}),t.mark("select none"),t.selectNone()))}},{id:"delete",label:"action.delete",kbd:"\u232B,del,backspace",icon:"trash",readonlyOk:!1,onSelect(b){w()&&(f()||(p("delete-shapes",{source:b}),t.mark("delete"),t.deleteShapes(t.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",readonlyOk:!1,onSelect(b){if(!w()||f())return;p("rotate-cw",{source:b}),t.mark("rotate-cw");const _=t.getSelectionRotation()%(rt/2),x=od(_,0)||od(_,rt/2);t.rotateShapesBy(t.getSelectedShapeIds(),rt/2-(x?0:_))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",readonlyOk:!1,onSelect(b){if(!w()||f())return;p("rotate-ccw",{source:b}),t.mark("rotate-ccw");const _=t.getSelectionRotation()%(rt/2),x=od(_,0);t.rotateShapesBy(t.getSelectedShapeIds(),x?-(rt/2):-_)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(b){p("zoom-in",{source:b}),t.zoomIn(t.getViewportScreenCenter(),{duration:eo})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(b){p("zoom-out",{source:b}),t.zoomOut(t.getViewportScreenCenter(),{duration:eo})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(b){p("reset-zoom",{source:b}),t.resetZoom(t.getViewportScreenCenter(),{duration:eo})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(b){p("zoom-to-fit",{source:b}),t.zoomToFit({duration:eo})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(b){w()&&(f()||(p("zoom-to-selection",{source:b}),t.zoomToSelection({duration:eo})))}},{id:"toggle-snap-mode",label:"action.toggle-snap-mode",menuLabel:"action.toggle-snap-mode.menu",readonlyOk:!1,onSelect(b){p("toggle-snap-mode",{source:b}),t.user.updateUserPreferences({isSnapMode:!t.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:"action.toggle-dark-mode",menuLabel:"action.toggle-dark-mode.menu",kbd:"$/",readonlyOk:!0,onSelect(b){p("toggle-dark-mode",{source:b}),t.user.updateUserPreferences({isDarkMode:!t.user.getIsDarkMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:"action.toggle-reduce-motion",menuLabel:"action.toggle-reduce-motion.menu",readonlyOk:!0,onSelect(b){p("toggle-reduce-motion",{source:b}),t.user.updateUserPreferences({animationSpeed:t.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:"action.toggle-edge-scrolling",menuLabel:"action.toggle-edge-scrolling.menu",readonlyOk:!0,onSelect(b){p("toggle-edge-scrolling",{source:b}),t.user.updateUserPreferences({edgeScrollSpeed:t.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:"action.toggle-transparent",menuLabel:"action.toggle-transparent.menu",contextMenuLabel:"action.toggle-transparent.context-menu",readonlyOk:!0,onSelect(b){p("toggle-transparent",{source:b}),t.updateInstanceState({exportBackground:!t.getInstanceState().exportBackground},{ephemeral:!0})},checkbox:!0},{id:"toggle-tool-lock",label:"action.toggle-tool-lock",menuLabel:"action.toggle-tool-lock.menu",readonlyOk:!1,kbd:"q",onSelect(b){p("toggle-tool-lock",{source:b}),t.updateInstanceState({isToolLocked:!t.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",readonlyOk:!1,onSelect(b){p("unlock-all",{source:b});const _=[];for(const x of t.getCurrentPageShapes())x.isLocked&&_.push({id:x.id,type:x.type,isLocked:!1});_.length>0&&t.updateShapes(_)}},{id:"toggle-focus-mode",label:"action.toggle-focus-mode",menuLabel:"action.toggle-focus-mode.menu",readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(b){requestAnimationFrame(()=>{t.batch(()=>{p("toggle-focus-mode",{source:b}),i(),o(),t.updateInstanceState({isFocusMode:!t.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:"action.toggle-grid",menuLabel:"action.toggle-grid.menu",readonlyOk:!0,kbd:"$'",onSelect(b){p("toggle-grid-mode",{source:b}),t.updateInstanceState({isGridMode:!t.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:"action.toggle-debug-mode",menuLabel:"action.toggle-debug-mode.menu",readonlyOk:!0,onSelect(b){p("toggle-debug-mode",{source:b}),t.updateInstanceState({isDebugMode:!t.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(b){p("print",{source:b}),a()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(b){p("exit-pen-mode",{source:b}),t.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(b){p("stop-following",{source:b}),t.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(b){p("zoom-to-content",{source:b}),t.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",readonlyOk:!1,kbd:"!l",onSelect(b){t.mark("locking"),p("toggle-lock",{source:b}),t.toggleLock(t.getSelectedShapeIds())}}]);return n?n(t,S,void 0):S},[t,p,n,r,s,h,u,l,c,d,i,o,a]);return g.jsx(YT.Provider,{value:m,children:e})}function bn(){const n=v.useContext(YT);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function xg(n){return n.filter(e=>e!=null&&e!==!1)}function _e(n,...e){const t=xg(e);return t.length===0?null:{id:n,type:"group",checkbox:t.every(r=>r.type==="item"&&r.actionItem.checkbox),disabled:t.every(r=>r.disabled),readonlyOk:t.some(r=>r.readonlyOk),children:t}}function Ei(n,e,...t){const r=xg(t);return r.length===0?null:{id:n,type:"submenu",label:e,children:r,disabled:r.every(i=>i.disabled),readonlyOk:r.some(i=>i.readonlyOk)}}function Hv(n,e={}){const{readonlyOk:t=!0,disabled:r=!1}=e;return{id:n,type:"custom",disabled:r,readonlyOk:t}}function $(n,e={}){if(!n)throw Error("No action item provided to menuItem");if(!n.label)throw Error("Trying to create menu item for action item that doesn't have a label");const{checked:t=!1,disabled:r=!1}=e;return{id:n.id,type:"item",actionItem:n,disabled:r,checked:t,readonlyOk:n.readonlyOk}}function WJ(n){return n.getSelectedShapeIds().map(e=>n.getShape(e)).filter(e=>!(!e||n.isShapeOfType(e,"arrow")&&e.props.start.type==="binding"||n.isShapeOfType(e,"arrow")&&e.props.end.type==="binding"))}const XT=()=>{const n=G();return q("threeStackableItems",()=>WJ(n).length>2,[n])};function KJ(n){const e=n.getSelectedShapes(),t=[],r=new Map;e.forEach(o=>{o.type==="arrow"?t.push(o):r.set(o.id,o)});const i=t.filter(o=>!(o.props.start.type==="binding"&&!r.has(o.props.start.boundShapeId)||o.props.end.type==="binding"&&!r.has(o.props.end.boundShapeId)));return Array.from(r.values()).concat(i)}const Wv=()=>{const n=G();return q("allowGroup",()=>KJ(n).length>1,[n])},Kv=()=>{const n=G();return q("allowUngroup",()=>n.getSelectedShapeIds().some(e=>{var t;return((t=n.getShape(e))==null?void 0:t.type)==="group"}),[n])},qT=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read,Gv=[0,390,428,468,580,640,840,1023],JT=re.createContext(0);function GJ({forceMobile:n=!1,children:e}){const t=G(),r=q("breakpoint",()=>{const{width:i}=t.getViewportScreenBounds(),o=n?3:Gv.length-1;for(let s=0;s<o;s++)if(i>Gv[s]&&i<=Gv[s+1])return s;return o},[t]);return g.jsx(JT.Provider,{value:r,children:e})}function Tr(){return v.useContext(JT)}function Yv(){const n=G();return q("hasLinkShapeSelected",()=>{const e=n.getSelectedShapes();return e.length===1&&"url"in e[0].props&&e[0].type!=="embed"},[n])}const ZT=re.createContext({}),YJ=({overrides:n,children:e})=>{const t=G(),r=bn(),i=q("selected count",()=>t.getSelectedShapeIds().length,[t]),o=i>0,s=i>1,a=i>2,l=XT(),c=Wv(),d=Kv(),u=Yv(),h=Tr(),p=q("zoom is 1",()=>t.getZoomLevel()===1,[t]),m=v.useMemo(()=>{const f=[$(r["align-left"],{disabled:!s}),$(r["align-center-horizontal"],{disabled:!s}),$(r["align-right"],{disabled:!s}),$(r["stretch-horizontal"],{disabled:!s}),$(r["align-top"],{disabled:!s}),$(r["align-center-vertical"],{disabled:!s}),$(r["align-bottom"],{disabled:!s}),$(r["stretch-vertical"],{disabled:!s}),$(r["distribute-horizontal"],{disabled:!a}),$(r["distribute-vertical"],{disabled:!a}),$(r["stack-horizontal"],{disabled:!l}),$(r["stack-vertical"],{disabled:!l}),$(r["send-to-back"],{disabled:!o}),$(r["send-backward"],{disabled:!o}),$(r["bring-forward"],{disabled:!o}),$(r["bring-to-front"],{disabled:!o}),h<5?$(r["zoom-to-100"],{disabled:!!p}):$(r["rotate-ccw"],{disabled:!o}),$(r["rotate-cw"],{disabled:!o}),$(r["edit-link"],{disabled:!u}),c?$(r.group,{disabled:!s}):d?$(r.ungroup):$(r.group,{disabled:!s})];return n?n(t,f,{actions:r,oneSelected:o,twoSelected:s,threeSelected:a}):f},[t,p,c,n,r,o,s,a,l,d,u,h]);return g.jsx(ZT.Provider,{value:m,children:e})};function XJ(){const n=re.useContext(ZT);if(!n)throw new Error("useActionsMenuSchema must be used inside of a ActionsMenuSchemaProvider.");return n}function qJ(){const n=G();return q("onlyFlippableShape",()=>{const e=n.getSelectedShapes();return e.length===1&&e.every(t=>n.isShapeOfType(t,"group")||n.isShapeOfType(t,"arrow")||n.isShapeOfType(t,"line")||n.isShapeOfType(t,"draw"))},[n])}function QT(){const n=G();return q("showAutoSizeToggle",()=>{const e=n.getSelectedShapes();return e.length===1&&n.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[n])}const e3=re.createContext({}),JJ=ze(function({overrides:n,children:e}){var E;const t=G(),r=bn(),i=QT(),o=qJ(),s=t.getSelectedShapes(),a=s.length,l=a>0,c=a>1,d=a>2,u=XT(),h=q("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[]),p=q("isTransparentBg",()=>t.getInstanceState().exportBackground,[]),m=Wv(),f=Kv(),w=!!((E=window.navigator.clipboard)!=null&&E.write),S=Yv(),b=t.getOnlySelectedShape(),_=l&&s.every(I=>t.isShapeOfType(I,"frame")),x=b&&t.isShapeOfType(b,"frame")&&t.getSortedChildIdsForParent(b).length>0,P=b&&t.isShapeOrAncestorLocked(b),C=v.useMemo(()=>{let I=xg([_e("selection",i&&$(r["toggle-auto-size"]),S&&!P&&$(r["edit-link"]),l&&!P&&$(r.duplicate),m&&!P&&$(r.group),f&&!P&&$(r.ungroup),_&&!P&&$(r["remove-frame"]),x&&!P&&$(r["fit-frame-to-content"]),l&&$(r["toggle-lock"])),_e("modify",(c||o)&&Ei("arrange","context-menu.arrange",c&&_e("align",$(r["align-left"]),$(r["align-center-horizontal"]),$(r["align-right"]),$(r["align-top"]),$(r["align-center-vertical"]),$(r["align-bottom"])),d&&_e("distribute",$(r["distribute-horizontal"]),$(r["distribute-vertical"])),c&&_e("stretch",$(r["stretch-horizontal"]),$(r["stretch-vertical"])),o&&!P&&_e("flip",$(r["flip-horizontal"]),$(r["flip-vertical"])),c&&_e("order",$(r.pack,{disabled:!c}),u&&$(r["stack-vertical"]),u&&$(r["stack-horizontal"]))),l&&!P&&Ei("reorder","context-menu.reorder",_e("reorder",$(r["bring-to-front"]),$(r["bring-forward"]),$(r["send-backward"]),$(r["send-to-back"]))),l&&!P&&Hv("MOVE_TO_PAGE_MENU",{readonlyOk:!1})),_e("clipboard-group",l&&!P&&$(r.cut),l&&$(r.copy),qT&&$(r.paste)),h&&_e("conversions",Ei("copy-as","context-menu.copy-as",_e("copy-as-group",$(r["copy-as-svg"]),w&&$(r["copy-as-png"]),$(r["copy-as-json"])),_e("export-bg",$(r["toggle-transparent"],{checked:!p}))),Ei("export-as","context-menu.export-as",_e("export-as-group",$(r["export-as-svg"]),$(r["export-as-png"]),$(r["export-as-json"])),_e("export-bg,",$(r["toggle-transparent"],{checked:!p})))),h&&_e("set-selection-group",$(r["select-all"]),l&&$(r["select-none"])),l&&!P&&_e("delete-group",$(r.delete))]);return n&&(I=n(t,I,{actions:r,oneSelected:l,twoSelected:c,threeSelected:d,showAutoSizeToggle:i,showUngroup:f,onlyFlippableShapeSelected:o})),I},[t,n,r,l,c,d,i,o,h,u,m,f,_,x,w,S,p,P]);return g.jsx(e3.Provider,{value:C,children:e})});function t3(){const n=re.useContext(e3);if(!n)throw new Error("useContextMenuSchema must be used inside of a TLUiContextMenuSchemaProvider.");return n}const n3=v.createContext({});function ZJ({overrides:n,children:e}){const t=G(),r=zl(),{addDialog:i}=ea(),o=GT(),s=v.useMemo(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(c){t.setCurrentTool("select"),r("select-tool",{source:c,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(c){t.setCurrentTool("hand"),r("select-tool",{source:c,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",readonlyOk:!1,onSelect(c){t.setCurrentTool("eraser"),r("select-tool",{source:c,id:"eraser"})}},{id:"draw",label:"tool.draw",readonlyOk:!1,icon:"tool-pencil",kbd:"d,b,x",onSelect(c){t.setCurrentTool("draw"),r("select-tool",{source:c,id:"draw"})}},...[...yi.values].map(c=>({id:c,label:`tool.${c}`,readonlyOk:!1,meta:{geo:c},kbd:c==="rectangle"?"r":c==="ellipse"?"o":void 0,icon:"geo-"+c,onSelect(d){t.batch(()=>{t.updateInstanceState({stylesForNextShape:{...t.getInstanceState().stylesForNextShape,[yi.id]:c}},{ephemeral:!0}),t.setCurrentTool("geo"),r("select-tool",{source:d,id:`geo-${c}`})})}})),{id:"arrow",label:"tool.arrow",readonlyOk:!1,icon:"tool-arrow",kbd:"a",onSelect(c){t.setCurrentTool("arrow"),r("select-tool",{source:c,id:"arrow"})}},{id:"line",label:"tool.line",readonlyOk:!1,icon:"tool-line",kbd:"l",onSelect(c){t.setCurrentTool("line"),r("select-tool",{source:c,id:"line"})}},{id:"frame",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"f",onSelect(c){t.setCurrentTool("frame"),r("select-tool",{source:c,id:"frame"})}},{id:"text",label:"tool.text",readonlyOk:!1,icon:"tool-text",kbd:"t",onSelect(c){t.setCurrentTool("text"),r("select-tool",{source:c,id:"text"})}},{id:"asset",label:"tool.asset",readonlyOk:!1,icon:"tool-media",kbd:"$u",onSelect(c){o(),r("select-tool",{source:c,id:"media"})}},{id:"note",label:"tool.note",readonlyOk:!1,icon:"tool-note",kbd:"n",onSelect(c){t.setCurrentTool("note"),r("select-tool",{source:c,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(c){t.setCurrentTool("laser"),r("select-tool",{source:c,id:"laser"})}},{id:"embed",label:"tool.embed",readonlyOk:!1,icon:"tool-embed",onSelect(c){i({component:jT}),r("select-tool",{source:c,id:"embed"})}}];a.push({id:"highlight",label:"tool.highlight",readonlyOk:!0,icon:"tool-highlight",kbd:"!d",onSelect(c){t.setCurrentTool("highlight"),r("select-tool",{source:c,id:"highlight"})}});const l=Object.fromEntries(a.map(c=>[c.id,c]));return n?n(t,l,{insertMedia:o}):l},[n,t,r,o,i]);return g.jsx(n3.Provider,{value:s,children:e})}function Xv(){const n=v.useContext(n3);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}const r3=re.createContext({}),QJ=ze(function({overrides:n,children:e}){const t=G(),r=Xv(),i=bn(),o=v.useMemo(()=>{const s=me([_e("shortcuts-dialog.tools",$(i["toggle-tool-lock"]),$(r.select),$(r.draw),$(r.eraser),$(r.hand),$(r.rectangle),$(r.ellipse),$(r.arrow),$(r.line),$(r.text),$(r.frame),$(r.note),$(r.laser)),_e("shortcuts-dialog.file",$(i["insert-media"]),$(i.print)),_e("shortcuts-dialog.preferences",$(i["toggle-dark-mode"]),$(i["toggle-focus-mode"]),$(i["toggle-grid"])),_e("shortcuts-dialog.edit",$(i.undo),$(i.redo),$(i.cut),$(i.copy),$(i.paste),$(i["select-all"]),$(i.delete),$(i.duplicate),$(i["export-as-svg"]),$(i["export-as-png"])),_e("shortcuts-dialog.view",$(i["zoom-in"]),$(i["zoom-out"]),$(i["zoom-to-100"]),$(i["zoom-to-fit"]),$(i["zoom-to-selection"])),_e("shortcuts-dialog.transform",$(i["bring-to-front"]),$(i["bring-forward"]),$(i["send-backward"]),$(i["send-to-back"]),$(i.group),$(i.ungroup),$(i["flip-horizontal"]),$(i["flip-vertical"]),$(i["align-top"]),$(i["align-center-vertical"]),$(i["align-bottom"]),$(i["align-left"]),$(i["align-center-horizontal"]),$(i["align-right"]))]);return n?n(t,s,{tools:r,actions:i}):s},[t,n,i,r]);return g.jsx(r3.Provider,{value:o,children:e})});function eZ(){const n=re.useContext(r3);if(!n)throw new Error("Shortcuts must be used inside of a ShortcutsProvider.");return n}const tZ=()=>{const n=Ie(),e=Ir(),t=eZ();function r(i){if(!i||e&&!i.readonlyOk)return null;switch(i.type){case"group":return g.jsxs("div",{className:"tlui-shortcuts-dialog__group",children:[g.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:n(i.id)}),g.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:i.children.filter(o=>o&&o.type==="item"&&o.actionItem.kbd).map(r)})]},i.id);case"item":{const{id:o,label:s,shortcutsLabel:a,kbd:l}=i.actionItem;return g.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair",children:[g.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:n(a??s)}),g.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:g.jsx(ag,{children:l})})]},o)}}}return g.jsxs(g.Fragment,{children:[g.jsxs(gg,{className:"tlui-shortcuts-dialog__header",children:[g.jsx(mg,{children:n("shortcuts-dialog.title")}),g.jsx(yg,{})]}),g.jsx(Hd,{className:"tlui-shortcuts-dialog__body",children:t.map(r)}),g.jsx("div",{className:"tlui-dialog__scrim"})]})};function i3(){const n=G();return{languages:Qc,currentLanguage:n.user.getLocale()}}const o3=re.createContext({}),nZ=ze(function({overrides:n,children:e}){const t=G(),r=bn(),i=t.getSelectedShapeIds().length,o=i>0,s=i>1,a=i>2,{languages:l,currentLanguage:c}=i3(),{addDialog:d}=ea(),u=v.useMemo(()=>{const h=me([_e("top",Hv("LANGUAGE_MENU",{readonlyOk:!0}),$({id:"keyboard-shortcuts",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect(){d({component:tZ})}}))]);return n?n(t,h,{actions:r,currentLanguage:c,languages:l,oneSelected:o,twoSelected:s,threeSelected:a}):h},[t,n,l,r,o,s,a,c,d]);return g.jsx(o3.Provider,{value:u,children:e})});function rZ(){const n=re.useContext(o3);if(!n)throw new Error("useHelpMenuSchema must be used inside of a helpTLUiMenuSchemaProvider.");return n}function s3(){const n=G();return q("useCanRedo",()=>n.getCanRedo(),[n])}function a3(){const n=G();return q("useCanUndo",()=>n.getCanUndo(),[n])}const l3=re.createContext({});function iZ({overrides:n,children:e}){var K;const t=G(),r=bn(),i=Tr()<5,o=q("isDarkMode",()=>t.user.getIsDarkMode(),[t]),s=q("animationSpeed",()=>t.user.getAnimationSpeed(),[t]),a=q("edgeScrollSpeed",()=>t.user.getEdgeScrollSpeed(),[t]),l=q("isGridMode",()=>t.getInstanceState().isGridMode,[t]),c=q("isSnapMode",()=>t.user.getIsSnapMode(),[t]),d=q("isToolLock",()=>t.getInstanceState().isToolLocked,[t]),u=q("isFocusMode",()=>t.getInstanceState().isFocusMode,[t]),h=q("isDebugMode",()=>t.getInstanceState().isDebugMode,[t]),p=q("exportBackground",()=>t.getInstanceState().exportBackground,[t]),m=q("emptyPage",()=>t.getCurrentPageShapeIds().size===0,[t]),f=q("selectedCount",()=>t.getSelectedShapeIds().length,[t]),w=f===0,S=f>0,b=f>1,_=f>2,x=!!((K=window.navigator.clipboard)!=null&&K.write),P=Yv(),C=QT(),E=Wv(),I=Kv(),A=a3(),T=s3(),D=q("isZoomedTo100",()=>t.getZoomLevel()===1,[t]),F=q("oneEmbedSelected",()=>{const B=t.getOnlySelectedShape();return B?!!(t.isShapeOfType(B,"embed")&&B.props.url&&!t.isShapeOrAncestorLocked(B)):!1},[]),H=q("oneEmbeddableBookmarkSelected",()=>{const B=t.getOnlySelectedShape();return B?!!(t.isShapeOfType(B,"bookmark")&&B.props.url&&ao(B.props.url)&&!t.isShapeOrAncestorLocked(B)):!1},[]),O=v.useMemo(()=>{const B=xg([_e("menu",Ei("file","menu.file",_e("print",$(r.print,{disabled:m}))),Ei("edit","menu.edit",_e("undo-actions",$(r.undo,{disabled:!A}),$(r.redo,{disabled:!T})),_e("clipboard-actions",$(r.cut,{disabled:w}),$(r.copy,{disabled:w}),$(r.paste,{disabled:!qT})),_e("conversions",Ei("copy-as","menu.copy-as",_e("copy-as-group",$(r["copy-as-svg"],{disabled:m}),$(r["copy-as-png"],{disabled:m||!x}),$(r["copy-as-json"],{disabled:m})),_e("export-bg",$(r["toggle-transparent"],{checked:!p}))),Ei("export-as","menu.export-as",_e("export-as-group",$(r["export-as-svg"],{disabled:m}),$(r["export-as-png"],{disabled:m}),$(r["export-as-json"],{disabled:m})),_e("export-bg",$(r["toggle-transparent"],{checked:!p})))),_e("set-selection-group",$(r["select-all"],{disabled:m}),$(r["select-none"],{disabled:!S})),_e("selection",C&&$(r["toggle-auto-size"]),P&&$(r["edit-link"]),$(r.duplicate,{disabled:!S}),E&&$(r.group),I&&$(r.ungroup),$(r["unlock-all"],{disabled:m})),_e("delete-group",$(r.delete,{disabled:!S})),_e("embeds",F&&$(r["open-embed-link"]),F&&$(r["convert-to-bookmark"]),H&&$(r["convert-to-embed"]))),Ei("view","menu.view",_e("view-actions",$(r["zoom-in"]),$(r["zoom-out"]),$(r["zoom-to-100"],{disabled:D}),$(r["zoom-to-fit"],{disabled:m}),$(r["zoom-to-selection"],{disabled:m||!S})))),_e("extras",$(r["insert-embed"]),$(r["insert-media"])),_e("preferences",Ei("preferences","menu.preferences",_e("preferences-actions",$(r["toggle-snap-mode"],{checked:c}),$(r["toggle-tool-lock"],{checked:d}),$(r["toggle-grid"],{checked:l}),$(r["toggle-dark-mode"],{checked:o}),$(r["toggle-focus-mode"],{checked:u}),$(r["toggle-edge-scrolling"],{checked:a===1}),$(r["toggle-reduce-motion"],{checked:s===0}),$(r["toggle-debug-mode"],{checked:h}))),i&&Hv("LANGUAGE_MENU",{readonlyOk:!0}))]);return n?n(t,B,{actions:r,noneSelected:w,oneSelected:S,twoSelected:b,threeSelected:_}):B},[t,n,r,S,b,_,m,i,E,I,P,x,C,w,A,T,s,o,l,c,d,u,p,h,a,D,H,F]);return g.jsx(l3.Provider,{value:O,children:e})}function oZ(){const n=re.useContext(l3);if(!n)throw new Error("useMenuSchema must be used inside of a TLUiMenuSchemaProvider.");return n}function Je(n){return{id:n.id,type:"item",readonlyOk:n.readonlyOk,toolItem:n}}const c3=re.createContext([]);function sZ({overrides:n,children:e}){const t=G(),r=Xv(),i=re.useMemo(()=>{const o=me([Je(r.select),Je(r.hand),Je(r.draw),Je(r.eraser),Je(r.arrow),Je(r.text),Je(r.note),Je(r.asset),Je(r.rectangle),Je(r.ellipse),Je(r.diamond),Je(r.triangle),Je(r.trapezoid),Je(r.rhombus),Je(r.hexagon),Je(r.cloud),Je(r.star),Je(r.oval),Je(r["x-box"]),Je(r["check-box"]),Je(r["arrow-left"]),Je(r["arrow-up"]),Je(r["arrow-down"]),Je(r["arrow-right"]),Je(r.line),Je(r.highlight),Je(r.frame),Je(r.laser)]);return n?n(t,o,{tools:r}):o},[t,n,r]);return g.jsx(c3.Provider,{value:i,children:e})}function aZ(){const n=re.useContext(c3);if(!n)throw new Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return n}function lZ(){const{addToast:n,removeToast:e,clearToasts:t}=Pi(),{addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s}=ea(),a=Tr()<5,l=Ie();return v.useMemo(()=>({addToast:n,removeToast:e,clearToasts:t,addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s,msg:l,isMobile:a}),[r,n,i,t,l,o,e,s,a])}function cZ(n,e){const t={};for(const r of n)if(r.translations)for(const[i,o]of Yi(r.translations)){let s=t[i];s||(s=t[i]={}),Object.assign(s,o)}return{actionsMenu:(r,i,o)=>{for(const s of n)s.actionsMenu&&(i=s.actionsMenu(r,i,{...e,...o}));return i},actions:(r,i)=>{for(const o of n)o.actions&&(i=o.actions(r,i,e));return i},contextMenu:(r,i,o)=>{for(const s of n)s.contextMenu&&(i=s.contextMenu(r,i,{...e,...o}));return i},helpMenu:(r,i,o)=>{for(const s of n)s.helpMenu&&(i=s.helpMenu(r,i,{...e,...o}));return i},menu:(r,i,o)=>{for(const s of n)s.menu&&(i=s.menu(r,i,{...e,...o}));return i},toolbar:(r,i,o)=>{for(const s of n)s.toolbar&&(i=s.toolbar(r,i,{...e,...o}));return i},keyboardShortcutsMenu:(r,i,o)=>{for(const s of n)s.keyboardShortcutsMenu&&(i=s.keyboardShortcutsMenu(r,i,{...e,...o}));return i},tools:(r,i,o)=>{for(const s of n)s.tools&&(i=s.tools(r,i,{...e,...o}));return i},translations:t}}function d3(n){return v.useMemo(()=>n,n)}function dZ(n){const e=d3(n==null?[]:Array.isArray(n)?n:[n]);return v.useMemo(()=>{const t={};for(const r of e)if(r.translations)for(const[i,o]of Yi(r.translations)){let s=t[i];s||(s=t[i]={}),Object.assign(s,o)}return t},[e])}function uZ(n){const e=lZ(),t=d3(n==null?[]:Array.isArray(n)?n:[n]);return v.useMemo(()=>cZ(t,e),[t,e])}function hZ({overrides:n,assetUrls:e,onUiEvent:t,forceMobile:r,children:i}){return g.jsx(UX,{assetUrls:NX(e),children:g.jsx(WX,{overrides:dZ(n),children:g.jsx(SJ,{onEvent:t,children:g.jsx(LJ,{children:g.jsx(NJ,{children:g.jsx(GJ,{forceMobile:r,children:g.jsx(pZ,{overrides:n,children:i})})})})})})})}function pZ({overrides:n,children:e}){const t=uZ(n);return g.jsx(HJ,{overrides:t.actions,children:g.jsx(ZJ,{overrides:t.tools,children:g.jsx(sZ,{overrides:t.toolbar,children:g.jsx(YJ,{overrides:t.actionsMenu,children:g.jsx(QJ,{overrides:t.keyboardShortcutsMenu,children:g.jsx(JJ,{overrides:t.contextMenu,children:g.jsx(nZ,{overrides:t.helpMenu,children:g.jsx(iZ,{overrides:t.menu,children:e})})})})})})})})}function fZ(){const n=G(),e=bn()["back-to-content"],[t,r]=v.useState(!1);return v.useEffect(()=>{let i=!1;const o=setInterval(()=>{const s=n.getRenderingShapes(),a=n.getRenderingBounds(),l=s.filter(c=>c.maskedPageBounds&&a.includes(c.maskedPageBounds)).length===0&&n.getCurrentPageShapes().length>0;i!==l&&(r(l),i=l)},1e3);return()=>{clearInterval(o)}},[n]),t?g.jsx(le,{iconLeft:e.icon,label:e.label,type:"low",onClick:()=>{e.onSelect("helper-buttons"),r(!1)}}):null}const gZ=v.createContext(void 0);function qv(n){const e=v.useContext(gZ);return n||e||"ltr"}const Jv="dismissableLayer.update",mZ="dismissableLayer.pointerDownOutside",yZ="dismissableLayer.focusOutside";let u3;const wZ=v.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),bZ=v.forwardRef((n,e)=>{var t;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...c}=n,d=v.useContext(wZ),[u,h]=v.useState(null),p=(t=u==null?void 0:u.ownerDocument)!==null&&t!==void 0?t:globalThis==null?void 0:globalThis.document,[,m]=v.useState({}),f=Ge(e,I=>h(I)),w=Array.from(d.layers),[S]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),b=w.indexOf(S),_=u?w.indexOf(u):-1,x=d.layersWithOutsidePointerEventsDisabled.size>0,P=_>=b,C=vZ(I=>{const A=I.target,T=[...d.branches].some(D=>D.contains(A));!P||T||(o==null||o(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p),E=SZ(I=>{const A=I.target;[...d.branches].some(T=>T.contains(A))||(s==null||s(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p);return ng(I=>{_===d.layers.size-1&&(i==null||i(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},p),v.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(u3=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),h3(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=u3)}},[u,p,r,d]),v.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),h3())},[u,d]),v.useEffect(()=>{const I=()=>m({});return document.addEventListener(Jv,I),()=>document.removeEventListener(Jv,I)},[]),v.createElement(Ae.div,J({},c,{ref:f,style:{pointerEvents:x?P?"auto":"none":void 0,...n.style},onFocusCapture:ne(n.onFocusCapture,E.onFocusCapture),onBlurCapture:ne(n.onBlurCapture,E.onBlurCapture),onPointerDownCapture:ne(n.onPointerDownCapture,C.onPointerDownCapture)}))});function vZ(n,e=globalThis==null?void 0:globalThis.document){const t=kt(n),r=v.useRef(!1),i=v.useRef(()=>{});return v.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){p3(mZ,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function SZ(n,e=globalThis==null?void 0:globalThis.document){const t=kt(n),r=v.useRef(!1);return v.useEffect(()=>{const i=o=>{o.target&&!r.current&&p3(yZ,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function h3(){const n=new CustomEvent(Jv);document.dispatchEvent(n)}function p3(n,e,t,{discrete:r}){const i=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?jl(i,o):i.dispatchEvent(o)}const xZ=["top","right","bottom","left"],as=Math.min,pr=Math.max,_g=Math.round,kg=Math.floor,ls=n=>({x:n,y:n}),_Z={left:"right",right:"left",bottom:"top",top:"bottom"},kZ={start:"end",end:"start"};function Zv(n,e,t){return pr(n,as(e,t))}function ho(n,e){return typeof n=="function"?n(e):n}function po(n){return n.split("-")[0]}function Nl(n){return n.split("-")[1]}function Qv(n){return n==="x"?"y":"x"}function e1(n){return n==="y"?"height":"width"}function Fl(n){return["top","bottom"].includes(po(n))?"y":"x"}function t1(n){return Qv(Fl(n))}function CZ(n,e,t){t===void 0&&(t=!1);const r=Nl(n),i=t1(n),o=e1(i);let s=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(s=Cg(s)),[s,Cg(s)]}function PZ(n){const e=Cg(n);return[n1(n),e,n1(e)]}function n1(n){return n.replace(/start|end/g,e=>kZ[e])}function EZ(n,e,t){const r=["left","right"],i=["right","left"],o=["top","bottom"],s=["bottom","top"];switch(n){case"top":case"bottom":return t?e?i:r:e?r:i;case"left":case"right":return e?o:s;default:return[]}}function IZ(n,e,t,r){const i=Nl(n);let o=EZ(po(n),t==="start",r);return i&&(o=o.map(s=>s+"-"+i),e&&(o=o.concat(o.map(n1)))),o}function Cg(n){return n.replace(/left|right|bottom|top/g,e=>_Z[e])}function MZ(n){return{top:0,right:0,bottom:0,left:0,...n}}function f3(n){return typeof n!="number"?MZ(n):{top:n,right:n,bottom:n,left:n}}function Pg(n){return{...n,top:n.y,left:n.x,right:n.x+n.width,bottom:n.y+n.height}}function g3(n,e,t){let{reference:r,floating:i}=n;const o=Fl(e),s=t1(e),a=e1(s),l=po(e),c=o==="y",d=r.x+r.width/2-i.width/2,u=r.y+r.height/2-i.height/2,h=r[a]/2-i[a]/2;let p;switch(l){case"top":p={x:d,y:r.y-i.height};break;case"bottom":p={x:d,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:u};break;case"left":p={x:r.x-i.width,y:u};break;default:p={x:r.x,y:r.y}}switch(Nl(e)){case"start":p[s]-=h*(t&&c?-1:1);break;case"end":p[s]+=h*(t&&c?-1:1);break}return p}const AZ=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=t,a=o.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(e));let c=await s.getElementRects({reference:n,floating:e,strategy:i}),{x:d,y:u}=g3(c,r,l),h=r,p={},m=0;for(let f=0;f<a.length;f++){const{name:w,fn:S}=a[f],{x:b,y:_,data:x,reset:P}=await S({x:d,y:u,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:c,platform:s,elements:{reference:n,floating:e}});if(d=b??d,u=_??u,p={...p,[w]:{...p[w],...x}},P&&m<=50){m++,typeof P=="object"&&(P.placement&&(h=P.placement),P.rects&&(c=P.rects===!0?await s.getElementRects({reference:n,floating:e,strategy:i}):P.rects),{x:d,y:u}=g3(c,h,l)),f=-1;continue}}return{x:d,y:u,placement:h,strategy:i,middlewareData:p}};async function Kd(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=ho(e,n),m=f3(p),f=a[h?u==="floating"?"reference":"floating":u],w=Pg(await o.getClippingRect({element:(t=await(o.isElement==null?void 0:o.isElement(f)))==null||t?f:f.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),S=u==="floating"?{...s.floating,x:r,y:i}:s.reference,b=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),_=await(o.isElement==null?void 0:o.isElement(b))?await(o.getScale==null?void 0:o.getScale(b))||{x:1,y:1}:{x:1,y:1},x=Pg(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:S,offsetParent:b,strategy:l}):S);return{top:(w.top-x.top+m.top)/_.y,bottom:(x.bottom-w.bottom+m.bottom)/_.y,left:(w.left-x.left+m.left)/_.x,right:(x.right-w.right+m.right)/_.x}}const m3=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:i,rects:o,platform:s,elements:a}=e,{element:l,padding:c=0}=ho(n,e)||{};if(l==null)return{};const d=f3(c),u={x:t,y:r},h=t1(i),p=e1(h),m=await s.getDimensions(l),f=h==="y",w=f?"top":"left",S=f?"bottom":"right",b=f?"clientHeight":"clientWidth",_=o.reference[p]+o.reference[h]-u[h]-o.floating[p],x=u[h]-o.reference[h],P=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l));let C=P?P[b]:0;(!C||!await(s.isElement==null?void 0:s.isElement(P)))&&(C=a.floating[b]||o.floating[p]);const E=_/2-x/2,I=C/2-m[p]/2-1,A=as(d[w],I),T=as(d[S],I),D=A,F=C-m[p]-T,H=C/2-m[p]/2+E,O=Zv(D,H,F),K=Nl(i)!=null&&H!=O&&o.reference[p]/2-(H<D?A:T)-m[p]/2<0?H<D?D-H:F-H:0;return{[h]:u[h]-K,data:{[h]:O,centerOffset:H-O+K}}}}),TZ=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t;const{placement:r,middlewareData:i,rects:o,initialPlacement:s,platform:a,elements:l}=e,{mainAxis:c=!0,crossAxis:d=!0,fallbackPlacements:u,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:m=!0,...f}=ho(n,e),w=po(r),S=po(s)===s,b=await(a.isRTL==null?void 0:a.isRTL(l.floating)),_=u||(S||!m?[Cg(s)]:PZ(s));!u&&p!=="none"&&_.push(...IZ(s,m,p,b));const x=[s,..._],P=await Kd(e,f),C=[];let E=((t=i.flip)==null?void 0:t.overflows)||[];if(c&&C.push(P[w]),d){const D=CZ(r,o,b);C.push(P[D[0]],P[D[1]])}if(E=[...E,{placement:r,overflows:C}],!C.every(D=>D<=0)){var I,A;const D=(((I=i.flip)==null?void 0:I.index)||0)+1,F=x[D];if(F)return{data:{index:D,overflows:E},reset:{placement:F}};let H=(A=E.filter(O=>O.overflows[0]<=0).sort((O,K)=>O.overflows[1]-K.overflows[1])[0])==null?void 0:A.placement;if(!H)switch(h){case"bestFit":{var T;const O=(T=E.map(K=>[K.placement,K.overflows.filter(B=>B>0).reduce((B,te)=>B+te,0)]).sort((K,B)=>K[1]-B[1])[0])==null?void 0:T[0];O&&(H=O);break}case"initialPlacement":H=s;break}if(r!==H)return{reset:{placement:H}}}return{}}}};function y3(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function w3(n){return xZ.some(e=>n[e]>=0)}const jZ=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...i}=ho(n,e);switch(r){case"referenceHidden":{const o=await Kd(e,{...i,elementContext:"reference"}),s=y3(o,t.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:w3(s)}}}case"escaped":{const o=await Kd(e,{...i,altBoundary:!0}),s=y3(o,t.floating);return{data:{escapedOffsets:s,escaped:w3(s)}}}default:return{}}}}};async function RZ(n,e){const{placement:t,platform:r,elements:i}=n,o=await(r.isRTL==null?void 0:r.isRTL(i.floating)),s=po(t),a=Nl(t),l=Fl(t)==="y",c=["left","top"].includes(s)?-1:1,d=o&&l?-1:1,u=ho(e,n);let{mainAxis:h,crossAxis:p,alignmentAxis:m}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...u};return a&&typeof m=="number"&&(p=a==="end"?m*-1:m),l?{x:p*d,y:h*c}:{x:h*c,y:p*d}}const OZ=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){const{x:t,y:r}=e,i=await RZ(e,n);return{x:t+i.x,y:r+i.y,data:i}}}},DZ=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:w=>{let{x:S,y:b}=w;return{x:S,y:b}}},...l}=ho(n,e),c={x:t,y:r},d=await Kd(e,l),u=Fl(po(i)),h=Qv(u);let p=c[h],m=c[u];if(o){const w=h==="y"?"top":"left",S=h==="y"?"bottom":"right",b=p+d[w],_=p-d[S];p=Zv(b,p,_)}if(s){const w=u==="y"?"top":"left",S=u==="y"?"bottom":"right",b=m+d[w],_=m-d[S];m=Zv(b,m,_)}const f=a.fn({...e,[h]:p,[u]:m});return{...f,data:{x:f.x-t,y:f.y-r}}}}},LZ=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:i,rects:o,middlewareData:s}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=ho(n,e),d={x:t,y:r},u=Fl(i),h=Qv(u);let p=d[h],m=d[u];const f=ho(a,e),w=typeof f=="number"?{mainAxis:f,crossAxis:0}:{mainAxis:0,crossAxis:0,...f};if(l){const _=h==="y"?"height":"width",x=o.reference[h]-o.floating[_]+w.mainAxis,P=o.reference[h]+o.reference[_]-w.mainAxis;p<x?p=x:p>P&&(p=P)}if(c){var S,b;const _=h==="y"?"width":"height",x=["top","left"].includes(po(i)),P=o.reference[u]-o.floating[_]+(x&&((S=s.offset)==null?void 0:S[u])||0)+(x?0:w.crossAxis),C=o.reference[u]+o.reference[_]+(x?0:((b=s.offset)==null?void 0:b[u])||0)-(x?w.crossAxis:0);m<P?m=P:m>C&&(m=C)}return{[h]:p,[u]:m}}}},zZ=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){const{placement:t,rects:r,platform:i,elements:o}=e,{apply:s=()=>{},...a}=ho(n,e),l=await Kd(e,a),c=po(t),d=Nl(t),u=Fl(t)==="y",{width:h,height:p}=r.floating;let m,f;c==="top"||c==="bottom"?(m=c,f=d===(await(i.isRTL==null?void 0:i.isRTL(o.floating))?"start":"end")?"left":"right"):(f=c,m=d==="end"?"top":"bottom");const w=p-l[m],S=h-l[f],b=!e.middlewareData.shift;let _=w,x=S;if(u){const C=h-l.left-l.right;x=d||b?as(S,C):C}else{const C=p-l.top-l.bottom;_=d||b?as(w,C):C}if(b&&!d){const C=pr(l.left,0),E=pr(l.right,0),I=pr(l.top,0),A=pr(l.bottom,0);u?x=h-2*(C!==0||E!==0?C+E:pr(l.left,l.right)):_=p-2*(I!==0||A!==0?I+A:pr(l.top,l.bottom))}await s({...e,availableWidth:x,availableHeight:_});const P=await i.getDimensions(o.floating);return h!==P.width||p!==P.height?{reset:{rects:!0}}:{}}}};function cs(n){return b3(n)?(n.nodeName||"").toLowerCase():"#document"}function fr(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function fo(n){var e;return(e=(b3(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function b3(n){return n instanceof Node||n instanceof fr(n).Node}function go(n){return n instanceof Element||n instanceof fr(n).Element}function Ii(n){return n instanceof HTMLElement||n instanceof fr(n).HTMLElement}function v3(n){return typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof fr(n).ShadowRoot}function Gd(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=jr(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(i)}function NZ(n){return["table","td","th"].includes(cs(n))}function r1(n){const e=i1(),t=jr(n);return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function FZ(n){let e=$l(n);for(;Ii(e)&&!Eg(e);){if(r1(e))return e;e=$l(e)}return null}function i1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Eg(n){return["html","body","#document"].includes(cs(n))}function jr(n){return fr(n).getComputedStyle(n)}function Ig(n){return go(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.pageXOffset,scrollTop:n.pageYOffset}}function $l(n){if(cs(n)==="html")return n;const e=n.assignedSlot||n.parentNode||v3(n)&&n.host||fo(n);return v3(e)?e.host:e}function S3(n){const e=$l(n);return Eg(e)?n.ownerDocument?n.ownerDocument.body:n.body:Ii(e)&&Gd(e)?e:S3(e)}function Mg(n,e){var t;e===void 0&&(e=[]);const r=S3(n),i=r===((t=n.ownerDocument)==null?void 0:t.body),o=fr(r);return i?e.concat(o,o.visualViewport||[],Gd(r)?r:[]):e.concat(r,Mg(r))}function x3(n){const e=jr(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Ii(n),o=i?n.offsetWidth:t,s=i?n.offsetHeight:r,a=_g(t)!==o||_g(r)!==s;return a&&(t=o,r=s),{width:t,height:r,$:a}}function o1(n){return go(n)?n:n.contextElement}function Bl(n){const e=o1(n);if(!Ii(e))return ls(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:o}=x3(e);let s=(o?_g(t.width):t.width)/r,a=(o?_g(t.height):t.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const $Z=ls(0);function _3(n){const e=fr(n);return!i1()||!e.visualViewport?$Z:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function BZ(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==fr(n)?!1:e}function ta(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),o=o1(n);let s=ls(1);e&&(r?go(r)&&(s=Bl(r)):s=Bl(n));const a=BZ(o,t,r)?_3(o):ls(0);let l=(i.left+a.x)/s.x,c=(i.top+a.y)/s.y,d=i.width/s.x,u=i.height/s.y;if(o){const h=fr(o),p=r&&go(r)?fr(r):r;let m=h.frameElement;for(;m&&r&&p!==h;){const f=Bl(m),w=m.getBoundingClientRect(),S=jr(m),b=w.left+(m.clientLeft+parseFloat(S.paddingLeft))*f.x,_=w.top+(m.clientTop+parseFloat(S.paddingTop))*f.y;l*=f.x,c*=f.y,d*=f.x,u*=f.y,l+=b,c+=_,m=fr(m).frameElement}}return Pg({width:d,height:u,x:l,y:c})}function UZ(n){let{rect:e,offsetParent:t,strategy:r}=n;const i=Ii(t),o=fo(t);if(t===o)return e;let s={scrollLeft:0,scrollTop:0},a=ls(1);const l=ls(0);if((i||!i&&r!=="fixed")&&((cs(t)!=="body"||Gd(o))&&(s=Ig(t)),Ii(t))){const c=ta(t);a=Bl(t),l.x=c.x+t.clientLeft,l.y=c.y+t.clientTop}return{width:e.width*a.x,height:e.height*a.y,x:e.x*a.x-s.scrollLeft*a.x+l.x,y:e.y*a.y-s.scrollTop*a.y+l.y}}function VZ(n){return Array.from(n.getClientRects())}function k3(n){return ta(fo(n)).left+Ig(n).scrollLeft}function HZ(n){const e=fo(n),t=Ig(n),r=n.ownerDocument.body,i=pr(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),o=pr(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let s=-t.scrollLeft+k3(n);const a=-t.scrollTop;return jr(r).direction==="rtl"&&(s+=pr(e.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}function WZ(n,e){const t=fr(n),r=fo(n),i=t.visualViewport;let o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;const c=i1();(!c||c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}function KZ(n,e){const t=ta(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,o=Ii(n)?Bl(n):ls(1),s=n.clientWidth*o.x,a=n.clientHeight*o.y,l=i*o.x,c=r*o.y;return{width:s,height:a,x:l,y:c}}function C3(n,e,t){let r;if(e==="viewport")r=WZ(n,t);else if(e==="document")r=HZ(fo(n));else if(go(e))r=KZ(e,t);else{const i=_3(n);r={...e,x:e.x-i.x,y:e.y-i.y}}return Pg(r)}function P3(n,e){const t=$l(n);return t===e||!go(t)||Eg(t)?!1:jr(t).position==="fixed"||P3(t,e)}function GZ(n,e){const t=e.get(n);if(t)return t;let r=Mg(n).filter(a=>go(a)&&cs(a)!=="body"),i=null;const o=jr(n).position==="fixed";let s=o?$l(n):n;for(;go(s)&&!Eg(s);){const a=jr(s),l=r1(s);!l&&a.position==="fixed"&&(i=null),(o?!l&&!i:!l&&a.position==="static"&&i&&["absolute","fixed"].includes(i.position)||Gd(s)&&!l&&P3(n,s))?r=r.filter(c=>c!==s):i=a,s=$l(s)}return e.set(n,r),r}function YZ(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const o=[...t==="clippingAncestors"?GZ(e,this._c):[].concat(t),r],s=o[0],a=o.reduce((l,c)=>{const d=C3(e,c,i);return l.top=pr(d.top,l.top),l.right=as(d.right,l.right),l.bottom=as(d.bottom,l.bottom),l.left=pr(d.left,l.left),l},C3(e,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function XZ(n){return x3(n)}function qZ(n,e,t){const r=Ii(e),i=fo(e),o=t==="fixed",s=ta(n,!0,o,e);let a={scrollLeft:0,scrollTop:0};const l=ls(0);if(r||!r&&!o)if((cs(e)!=="body"||Gd(i))&&(a=Ig(e)),r){const c=ta(e,!0,o,e);l.x=c.x+e.clientLeft,l.y=c.y+e.clientTop}else i&&(l.x=k3(i));return{x:s.left+a.scrollLeft-l.x,y:s.top+a.scrollTop-l.y,width:s.width,height:s.height}}function E3(n,e){return!Ii(n)||jr(n).position==="fixed"?null:e?e(n):n.offsetParent}function I3(n,e){const t=fr(n);if(!Ii(n))return t;let r=E3(n,e);for(;r&&NZ(r)&&jr(r).position==="static";)r=E3(r,e);return r&&(cs(r)==="html"||cs(r)==="body"&&jr(r).position==="static"&&!r1(r))?t:r||FZ(n)||t}const JZ=async function(n){let{reference:e,floating:t,strategy:r}=n;const i=this.getOffsetParent||I3,o=this.getDimensions;return{reference:qZ(e,await i(t),r),floating:{x:0,y:0,...await o(t)}}};function ZZ(n){return jr(n).direction==="rtl"}const QZ={convertOffsetParentRelativeRectToViewportRelativeRect:UZ,getDocumentElement:fo,getClippingRect:YZ,getOffsetParent:I3,getElementRects:JZ,getClientRects:VZ,getDimensions:XZ,getScale:Bl,isElement:go,isRTL:ZZ};function eQ(n,e){let t=null,r;const i=fo(n);function o(){clearTimeout(r),t&&t.disconnect(),t=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();const{left:c,top:d,width:u,height:h}=n.getBoundingClientRect();if(a||e(),!u||!h)return;const p=kg(d),m=kg(i.clientWidth-(c+u)),f=kg(i.clientHeight-(d+h)),w=kg(c),S={rootMargin:-p+"px "+-m+"px "+-f+"px "+-w+"px",threshold:pr(0,as(1,l))||1};let b=!0;function _(x){const P=x[0].intersectionRatio;if(P!==l){if(!b)return s();P?s(!1,P):r=setTimeout(()=>{s(!1,1e-7)},100)}b=!1}try{t=new IntersectionObserver(_,{...S,root:i.ownerDocument})}catch{t=new IntersectionObserver(_,S)}t.observe(n)}return s(!0),o}function tQ(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=o1(n),d=i||o?[...c?Mg(c):[],...Mg(e)]:[];d.forEach(S=>{i&&S.addEventListener("scroll",t,{passive:!0}),o&&S.addEventListener("resize",t)});const u=c&&a?eQ(c,t):null;let h=-1,p=null;s&&(p=new ResizeObserver(S=>{let[b]=S;b&&b.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{p&&p.observe(e)})),t()}),c&&!l&&p.observe(c),p.observe(e));let m,f=l?ta(n):null;l&&w();function w(){const S=ta(n);f&&(S.x!==f.x||S.y!==f.y||S.width!==f.width||S.height!==f.height)&&t(),f=S,m=requestAnimationFrame(w)}return t(),()=>{d.forEach(S=>{i&&S.removeEventListener("scroll",t),o&&S.removeEventListener("resize",t)}),u&&u(),p&&p.disconnect(),p=null,l&&cancelAnimationFrame(m)}}const nQ=(n,e,t)=>{const r=new Map,i={platform:QZ,...t},o={...i.platform,_c:r};return AZ(n,e,{...i,platform:o})},rQ=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:i}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?m3({element:r.current,padding:i}).fn(t):{}:r?m3({element:r,padding:i}).fn(t):{}}}};var Ag=typeof document<"u"?v.useLayoutEffect:v.useEffect;function Tg(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!=e.length)return!1;for(r=t;r--!==0;)if(!Tg(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const o=i[r];if(!(o==="_owner"&&n.$$typeof)&&!Tg(n[o],e[o]))return!1}return!0}return n!==n&&e!==e}function M3(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function A3(n,e){const t=M3(n);return Math.round(e*t)/t}function T3(n){const e=v.useRef(n);return Ag(()=>{e.current=n}),e}function iQ(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:c}=n,[d,u]=v.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=v.useState(r);Tg(h,r)||p(r);const[m,f]=v.useState(null),[w,S]=v.useState(null),b=v.useCallback(B=>{B!=C.current&&(C.current=B,f(B))},[f]),_=v.useCallback(B=>{B!==E.current&&(E.current=B,S(B))},[S]),x=o||m,P=s||w,C=v.useRef(null),E=v.useRef(null),I=v.useRef(d),A=T3(l),T=T3(i),D=v.useCallback(()=>{if(!C.current||!E.current)return;const B={placement:e,strategy:t,middleware:h};T.current&&(B.platform=T.current),nQ(C.current,E.current,B).then(te=>{const W={...te,isPositioned:!0};F.current&&!Tg(I.current,W)&&(I.current=W,Ua.flushSync(()=>{u(W)}))})},[h,e,t,T]);Ag(()=>{c===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,u(B=>({...B,isPositioned:!1})))},[c]);const F=v.useRef(!1);Ag(()=>(F.current=!0,()=>{F.current=!1}),[]),Ag(()=>{if(x&&(C.current=x),P&&(E.current=P),x&&P){if(A.current)return A.current(x,P,D);D()}},[x,P,D,A]);const H=v.useMemo(()=>({reference:C,floating:E,setReference:b,setFloating:_}),[b,_]),O=v.useMemo(()=>({reference:x,floating:P}),[x,P]),K=v.useMemo(()=>{const B={position:t,left:0,top:0};if(!O.floating)return B;const te=A3(O.floating,d.x),W=A3(O.floating,d.y);return a?{...B,transform:"translate("+te+"px, "+W+"px)",...M3(O.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:te,top:W}},[t,a,O.floating,d.x,d.y]);return v.useMemo(()=>({...d,update:D,refs:H,elements:O,floatingStyles:K}),[d,D,H,O,K])}function j3(n){const[e,t]=v.useState(void 0);return Zs(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const o=i[0];let s,a;if("borderBoxSize"in o){const l=o.borderBoxSize,c=Array.isArray(l)?l[0]:l;s=c.inlineSize,a=c.blockSize}else s=n.offsetWidth,a=n.offsetHeight;t({width:s,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}const R3="Popper",[O3,jg]=_i(R3),[oQ,D3]=O3(R3),sQ=n=>{const{__scopePopper:e,children:t}=n,[r,i]=v.useState(null);return v.createElement(oQ,{scope:e,anchor:r,onAnchorChange:i},t)},aQ="PopperAnchor",lQ=v.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...i}=n,o=D3(aQ,t),s=v.useRef(null),a=Ge(e,s);return v.useEffect(()=>{o.onAnchorChange((r==null?void 0:r.current)||s.current)}),r?null:v.createElement(Ae.div,J({},i,{ref:a}))}),L3="PopperContent",[cQ,Lue]=O3(L3),dQ=v.forwardRef((n,e)=>{var t,r,i,o,s,a,l,c;const{__scopePopper:d,side:u="bottom",sideOffset:h=0,align:p="center",alignOffset:m=0,arrowPadding:f=0,avoidCollisions:w=!0,collisionBoundary:S=[],collisionPadding:b=0,sticky:_="partial",hideWhenDetached:x=!1,updatePositionStrategy:P="optimized",onPlaced:C,...E}=n,I=D3(L3,d),[A,T]=v.useState(null),D=Ge(e,Et=>T(Et)),[F,H]=v.useState(null),O=j3(F),K=(t=O==null?void 0:O.width)!==null&&t!==void 0?t:0,B=(r=O==null?void 0:O.height)!==null&&r!==void 0?r:0,te=u+(p!=="center"?"-"+p:""),W=typeof b=="number"?b:{top:0,right:0,bottom:0,left:0,...b},N=Array.isArray(S)?S:[S],Y=N.length>0,ee={padding:W,boundary:N.filter(uQ),altBoundary:Y},{refs:pe,floatingStyles:ve,placement:be,isPositioned:fe,middlewareData:Ce}=iQ({strategy:"fixed",placement:te,whileElementsMounted:(...Et)=>tQ(...Et,{animationFrame:P==="always"}),elements:{reference:I.anchor},middleware:[OZ({mainAxis:h+B,alignmentAxis:m}),w&&DZ({mainAxis:!0,crossAxis:!1,limiter:_==="partial"?LZ():void 0,...ee}),w&&TZ({...ee}),zZ({...ee,apply:({elements:Et,rects:bo,availableWidth:Eu,availableHeight:NS})=>{const{width:FS,height:$S}=bo.reference,Jl=Et.floating.style;Jl.setProperty("--radix-popper-available-width",`${Eu}px`),Jl.setProperty("--radix-popper-available-height",`${NS}px`),Jl.setProperty("--radix-popper-anchor-width",`${FS}px`),Jl.setProperty("--radix-popper-anchor-height",`${$S}px`)}}),F&&rQ({element:F,padding:f}),hQ({arrowWidth:K,arrowHeight:B}),x&&jZ({strategy:"referenceHidden",...ee})]}),[Rt,Ue]=z3(be),Le=kt(C);Zs(()=>{fe&&(Le==null||Le())},[fe,Le]);const Ve=(i=Ce.arrow)===null||i===void 0?void 0:i.x,si=(o=Ce.arrow)===null||o===void 0?void 0:o.y,Xn=((s=Ce.arrow)===null||s===void 0?void 0:s.centerOffset)!==0,[mr,Ot]=v.useState();return Zs(()=>{A&&Ot(window.getComputedStyle(A).zIndex)},[A]),v.createElement("div",{ref:pe.setFloating,"data-radix-popper-content-wrapper":"",style:{...ve,transform:fe?ve.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:mr,"--radix-popper-transform-origin":[(a=Ce.transformOrigin)===null||a===void 0?void 0:a.x,(l=Ce.transformOrigin)===null||l===void 0?void 0:l.y].join(" ")},dir:n.dir},v.createElement(cQ,{scope:d,placedSide:Rt,onArrowChange:H,arrowX:Ve,arrowY:si,shouldHideArrow:Xn},v.createElement(Ae.div,J({"data-side":Rt,"data-align":Ue},E,{ref:D,style:{...E.style,animation:fe?void 0:"none",opacity:(c=Ce.hide)!==null&&c!==void 0&&c.referenceHidden?0:void 0}}))))});function uQ(n){return n!==null}const hQ=n=>({name:"transformOrigin",options:n,fn(e){var t,r,i,o,s;const{placement:a,rects:l,middlewareData:c}=e,d=((t=c.arrow)===null||t===void 0?void 0:t.centerOffset)!==0,u=d?0:n.arrowWidth,h=d?0:n.arrowHeight,[p,m]=z3(a),f={start:"0%",center:"50%",end:"100%"}[m],w=((r=(i=c.arrow)===null||i===void 0?void 0:i.x)!==null&&r!==void 0?r:0)+u/2,S=((o=(s=c.arrow)===null||s===void 0?void 0:s.y)!==null&&o!==void 0?o:0)+h/2;let b="",_="";return p==="bottom"?(b=d?f:`${w}px`,_=`${-h}px`):p==="top"?(b=d?f:`${w}px`,_=`${l.floating.height+h}px`):p==="right"?(b=`${-h}px`,_=d?f:`${S}px`):p==="left"&&(b=`${l.floating.width+h}px`,_=d?f:`${S}px`),{data:{x:b,y:_}}}});function z3(n){const[e,t="center"]=n.split("-");return[e,t]}const s1=sQ,N3=lQ,F3=dQ,pQ=v.forwardRef((n,e)=>{var t;const{container:r=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...i}=n;return r?Gh.createPortal(v.createElement(Ae.div,J({},i,{ref:e})),r):null}),a1="rovingFocusGroup.onEntryFocus",fQ={bubbles:!1,cancelable:!0},l1="RovingFocusGroup",[c1,$3,gQ]=tg(l1),[mQ,B3]=_i(l1,[gQ]),[yQ,wQ]=mQ(l1),bQ=v.forwardRef((n,e)=>v.createElement(c1.Provider,{scope:n.__scopeRovingFocusGroup},v.createElement(c1.Slot,{scope:n.__scopeRovingFocusGroup},v.createElement(vQ,J({},n,{ref:e}))))),vQ=v.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,...d}=n,u=v.useRef(null),h=Ge(e,u),p=qv(o),[m=null,f]=os({prop:s,defaultProp:a,onChange:l}),[w,S]=v.useState(!1),b=kt(c),_=$3(t),x=v.useRef(!1),[P,C]=v.useState(0);return v.useEffect(()=>{const E=u.current;if(E)return E.addEventListener(a1,b),()=>E.removeEventListener(a1,b)},[b]),v.createElement(yQ,{scope:t,orientation:r,dir:p,loop:i,currentTabStopId:m,onItemFocus:v.useCallback(E=>f(E),[f]),onItemShiftTab:v.useCallback(()=>S(!0),[]),onFocusableItemAdd:v.useCallback(()=>C(E=>E+1),[]),onFocusableItemRemove:v.useCallback(()=>C(E=>E-1),[])},v.createElement(Ae.div,J({tabIndex:w||P===0?-1:0,"data-orientation":r},d,{ref:h,style:{outline:"none",...n.style},onMouseDown:ne(n.onMouseDown,()=>{x.current=!0}),onFocus:ne(n.onFocus,E=>{const I=!x.current;if(E.target===E.currentTarget&&I&&!w){const A=new CustomEvent(a1,fQ);if(E.currentTarget.dispatchEvent(A),!A.defaultPrevented){const T=_().filter(O=>O.focusable),D=T.find(O=>O.active),F=T.find(O=>O.id===m),H=[D,F,...T].filter(Boolean).map(O=>O.ref.current);U3(H)}}x.current=!1}),onBlur:ne(n.onBlur,()=>S(!1))})))}),SQ="RovingFocusGroupItem",xQ=v.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:i=!1,tabStopId:o,...s}=n,a=co(),l=o||a,c=wQ(SQ,t),d=c.currentTabStopId===l,u=$3(t),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return v.useEffect(()=>{if(r)return h(),()=>p()},[r,h,p]),v.createElement(c1.ItemSlot,{scope:t,id:l,focusable:r,active:i},v.createElement(Ae.span,J({tabIndex:d?0:-1,"data-orientation":c.orientation},s,{ref:e,onMouseDown:ne(n.onMouseDown,m=>{r?c.onItemFocus(l):m.preventDefault()}),onFocus:ne(n.onFocus,()=>c.onItemFocus(l)),onKeyDown:ne(n.onKeyDown,m=>{if(m.key==="Tab"&&m.shiftKey){c.onItemShiftTab();return}if(m.target!==m.currentTarget)return;const f=CQ(m,c.orientation,c.dir);if(f!==void 0){m.preventDefault();let w=u().filter(S=>S.focusable).map(S=>S.ref.current);if(f==="last")w.reverse();else if(f==="prev"||f==="next"){f==="prev"&&w.reverse();const S=w.indexOf(m.currentTarget);w=c.loop?PQ(w,S+1):w.slice(S+1)}setTimeout(()=>U3(w))}})})))}),_Q={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function kQ(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function CQ(n,e,t){const r=kQ(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return _Q[r]}function U3(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function PQ(n,e){return n.map((t,r)=>n[(e+r)%n.length])}const EQ=bQ,IQ=xQ,d1=["Enter"," "],MQ=["ArrowDown","PageUp","Home"],V3=["ArrowUp","PageDown","End"],AQ=[...MQ,...V3],TQ={ltr:[...d1,"ArrowRight"],rtl:[...d1,"ArrowLeft"]},jQ={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Rg="Menu",[Yd,RQ,OQ]=tg(Rg),[na,Og]=_i(Rg,[OQ,jg,B3]),Dg=jg(),H3=B3(),[W3,ds]=na(Rg),[DQ,Xd]=na(Rg),LQ=n=>{const{__scopeMenu:e,open:t=!1,children:r,dir:i,onOpenChange:o,modal:s=!0}=n,a=Dg(e),[l,c]=v.useState(null),d=v.useRef(!1),u=kt(o),h=qv(i);return v.useEffect(()=>{const p=()=>{d.current=!0,document.addEventListener("pointerdown",m,{capture:!0,once:!0}),document.addEventListener("pointermove",m,{capture:!0,once:!0})},m=()=>d.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",m,{capture:!0}),document.removeEventListener("pointermove",m,{capture:!0})}},[]),v.createElement(s1,a,v.createElement(W3,{scope:e,open:t,onOpenChange:u,content:l,onContentChange:c},v.createElement(DQ,{scope:e,onClose:v.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:h,modal:s},r)))},K3=v.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=Dg(t);return v.createElement(N3,J({},i,r,{ref:e}))}),G3="MenuPortal",[zQ,Y3]=na(G3,{forceMount:void 0}),NQ=n=>{const{__scopeMenu:e,forceMount:t,children:r,container:i}=n,o=ds(G3,e);return v.createElement(zQ,{scope:e,forceMount:t},v.createElement(Qr,{present:t||o.open},v.createElement(pQ,{asChild:!0,container:i},r)))},ei="MenuContent",[FQ,u1]=na(ei),$Q=v.forwardRef((n,e)=>{const t=Y3(ei,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,o=ds(ei,n.__scopeMenu),s=Xd(ei,n.__scopeMenu);return v.createElement(Yd.Provider,{scope:n.__scopeMenu},v.createElement(Qr,{present:r||o.open},v.createElement(Yd.Slot,{scope:n.__scopeMenu},s.modal?v.createElement(BQ,J({},i,{ref:e})):v.createElement(UQ,J({},i,{ref:e})))))}),BQ=v.forwardRef((n,e)=>{const t=ds(ei,n.__scopeMenu),r=v.useRef(null),i=Ge(e,r);return v.useEffect(()=>{const o=r.current;if(o)return Dv(o)},[]),v.createElement(h1,J({},n,{ref:i,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:ne(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)}))}),UQ=v.forwardRef((n,e)=>{const t=ds(ei,n.__scopeMenu);return v.createElement(h1,J({},n,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)}))}),h1=v.forwardRef((n,e)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,disableOutsideScroll:m,...f}=n,w=ds(ei,t),S=Xd(ei,t),b=Dg(t),_=H3(t),x=RQ(t),[P,C]=v.useState(null),E=v.useRef(null),I=Ge(e,E,w.onContentChange),A=v.useRef(0),T=v.useRef(""),D=v.useRef(0),F=v.useRef(null),H=v.useRef("right"),O=v.useRef(0),K=m?Rv:v.Fragment,B=m?{as:Js,allowPinchZoom:!0}:void 0,te=N=>{var Y,ee;const pe=T.current+N,ve=x().filter(Le=>!Le.disabled),be=document.activeElement,fe=(Y=ve.find(Le=>Le.ref.current===be))===null||Y===void 0?void 0:Y.textValue,Ce=ve.map(Le=>Le.textValue),Rt=tee(Ce,pe,fe),Ue=(ee=ve.find(Le=>Le.textValue===Rt))===null||ee===void 0?void 0:ee.ref.current;(function Le(Ve){T.current=Ve,window.clearTimeout(A.current),Ve!==""&&(A.current=window.setTimeout(()=>Le(""),1e3))})(pe),Ue&&setTimeout(()=>Ue.focus())};v.useEffect(()=>()=>window.clearTimeout(A.current),[]),Mv();const W=v.useCallback(N=>{var Y,ee;return H.current===((Y=F.current)===null||Y===void 0?void 0:Y.side)&&ree(N,(ee=F.current)===null||ee===void 0?void 0:ee.area)},[]);return v.createElement(FQ,{scope:t,searchRef:T,onItemEnter:v.useCallback(N=>{W(N)&&N.preventDefault()},[W]),onItemLeave:v.useCallback(N=>{var Y;W(N)||((Y=E.current)===null||Y===void 0||Y.focus(),C(null))},[W]),onTriggerLeave:v.useCallback(N=>{W(N)&&N.preventDefault()},[W]),pointerGraceTimerRef:D,onPointerGraceIntentChange:v.useCallback(N=>{F.current=N},[])},v.createElement(K,B,v.createElement(Ev,{asChild:!0,trapped:i,onMountAutoFocus:ne(o,N=>{var Y;N.preventDefault(),(Y=E.current)===null||Y===void 0||Y.focus()}),onUnmountAutoFocus:s},v.createElement(bZ,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p},v.createElement(EQ,J({asChild:!0},_,{dir:S.dir,orientation:"vertical",loop:r,currentTabStopId:P,onCurrentTabStopIdChange:C,onEntryFocus:ne(l,N=>{S.isUsingKeyboardRef.current||N.preventDefault()})}),v.createElement(F3,J({role:"menu","aria-orientation":"vertical","data-state":tj(w.open),"data-radix-menu-content":"",dir:S.dir},b,f,{ref:I,style:{outline:"none",...f.style},onKeyDown:ne(f.onKeyDown,N=>{const Y=N.target.closest("[data-radix-menu-content]")===N.currentTarget,ee=N.ctrlKey||N.altKey||N.metaKey,pe=N.key.length===1;Y&&(N.key==="Tab"&&N.preventDefault(),!ee&&pe&&te(N.key));const ve=E.current;if(N.target!==ve||!AQ.includes(N.key))return;N.preventDefault();const be=x().filter(fe=>!fe.disabled).map(fe=>fe.ref.current);V3.includes(N.key)&&be.reverse(),QQ(be)}),onBlur:ne(n.onBlur,N=>{N.currentTarget.contains(N.target)||(window.clearTimeout(A.current),T.current="")}),onPointerMove:ne(n.onPointerMove,qd(N=>{const Y=N.target,ee=O.current!==N.clientX;if(N.currentTarget.contains(Y)&&ee){const pe=N.clientX>O.current?"right":"left";H.current=pe,O.current=N.clientX}}))})))))))}),VQ=v.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return v.createElement(Ae.div,J({role:"group"},r,{ref:e}))}),p1="MenuItem",X3="menu.itemSelect",q3=v.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:r,...i}=n,o=v.useRef(null),s=Xd(p1,n.__scopeMenu),a=u1(p1,n.__scopeMenu),l=Ge(e,o),c=v.useRef(!1),d=()=>{const u=o.current;if(!t&&u){const h=new CustomEvent(X3,{bubbles:!0,cancelable:!0});u.addEventListener(X3,p=>r==null?void 0:r(p),{once:!0}),jl(u,h),h.defaultPrevented?c.current=!1:s.onClose()}};return v.createElement(J3,J({},i,{ref:l,disabled:t,onClick:ne(n.onClick,d),onPointerDown:u=>{var h;(h=n.onPointerDown)===null||h===void 0||h.call(n,u),c.current=!0},onPointerUp:ne(n.onPointerUp,u=>{var h;c.current||(h=u.currentTarget)===null||h===void 0||h.click()}),onKeyDown:ne(n.onKeyDown,u=>{const h=a.searchRef.current!=="";t||h&&u.key===" "||d1.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})}))}),J3=v.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:r=!1,textValue:i,...o}=n,s=u1(p1,t),a=H3(t),l=v.useRef(null),c=Ge(e,l),[d,u]=v.useState(!1),[h,p]=v.useState("");return v.useEffect(()=>{const m=l.current;if(m){var f;p(((f=m.textContent)!==null&&f!==void 0?f:"").trim())}},[o.children]),v.createElement(Yd.ItemSlot,{scope:t,disabled:r,textValue:i??h},v.createElement(IQ,J({asChild:!0},a,{focusable:!r}),v.createElement(Ae.div,J({role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0},o,{ref:c,onPointerMove:ne(n.onPointerMove,qd(m=>{r?s.onItemLeave(m):(s.onItemEnter(m),m.defaultPrevented||m.currentTarget.focus())})),onPointerLeave:ne(n.onPointerLeave,qd(m=>s.onItemLeave(m))),onFocus:ne(n.onFocus,()=>u(!0)),onBlur:ne(n.onBlur,()=>u(!1))}))))}),HQ=v.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:r,...i}=n;return v.createElement(WQ,{scope:n.__scopeMenu,checked:t},v.createElement(q3,J({role:"menuitemcheckbox","aria-checked":zg(t)?"mixed":t},i,{ref:e,"data-state":nj(t),onSelect:ne(i.onSelect,()=>r==null?void 0:r(zg(t)?!0:!t),{checkForDefaultPrevented:!1})})))});na("MenuRadioGroup",{value:void 0,onValueChange:()=>{}});const Z3="MenuItemIndicator",[WQ,KQ]=na(Z3,{checked:!1}),GQ=v.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:r,...i}=n,o=KQ(Z3,t);return v.createElement(Qr,{present:r||zg(o.checked)||o.checked===!0},v.createElement(Ae.span,J({},i,{ref:e,"data-state":nj(o.checked)})))}),Q3="MenuSub",[YQ,ej]=na(Q3),XQ=n=>{const{__scopeMenu:e,children:t,open:r=!1,onOpenChange:i}=n,o=ds(Q3,e),s=Dg(e),[a,l]=v.useState(null),[c,d]=v.useState(null),u=kt(i);return v.useEffect(()=>(o.open===!1&&u(!1),()=>u(!1)),[o.open,u]),v.createElement(s1,s,v.createElement(W3,{scope:e,open:r,onOpenChange:u,content:c,onContentChange:d},v.createElement(YQ,{scope:e,contentId:co(),triggerId:co(),trigger:a,onTriggerChange:l},t)))},Lg="MenuSubTrigger",qQ=v.forwardRef((n,e)=>{const t=ds(Lg,n.__scopeMenu),r=Xd(Lg,n.__scopeMenu),i=ej(Lg,n.__scopeMenu),o=u1(Lg,n.__scopeMenu),s=v.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,c={__scopeMenu:n.__scopeMenu},d=v.useCallback(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return v.useEffect(()=>d,[d]),v.useEffect(()=>{const u=a.current;return()=>{window.clearTimeout(u),l(null)}},[a,l]),v.createElement(K3,J({asChild:!0},c),v.createElement(J3,J({id:i.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":i.contentId,"data-state":tj(t.open)},n,{ref:eg(e,i.onTriggerChange),onClick:u=>{var h;(h=n.onClick)===null||h===void 0||h.call(n,u),!(n.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:ne(n.onPointerMove,qd(u=>{o.onItemEnter(u),!u.defaultPrevented&&!n.disabled&&!t.open&&!s.current&&(o.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{t.onOpenChange(!0),d()},100))})),onPointerLeave:ne(n.onPointerLeave,qd(u=>{var h;d();const p=(h=t.content)===null||h===void 0?void 0:h.getBoundingClientRect();if(p){var m;const f=(m=t.content)===null||m===void 0?void 0:m.dataset.side,w=f==="right",S=w?-5:5,b=p[w?"left":"right"],_=p[w?"right":"left"];o.onPointerGraceIntentChange({area:[{x:u.clientX+S,y:u.clientY},{x:b,y:p.top},{x:_,y:p.top},{x:_,y:p.bottom},{x:b,y:p.bottom}],side:f}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(u),u.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:ne(n.onKeyDown,u=>{const h=o.searchRef.current!=="";if(!(n.disabled||h&&u.key===" ")&&TQ[r.dir].includes(u.key)){var p;t.onOpenChange(!0),(p=t.content)===null||p===void 0||p.focus(),u.preventDefault()}})})))}),JQ="MenuSubContent",ZQ=v.forwardRef((n,e)=>{const t=Y3(ei,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,o=ds(ei,n.__scopeMenu),s=Xd(ei,n.__scopeMenu),a=ej(JQ,n.__scopeMenu),l=v.useRef(null),c=Ge(e,l);return v.createElement(Yd.Provider,{scope:n.__scopeMenu},v.createElement(Qr,{present:r||o.open},v.createElement(Yd.Slot,{scope:n.__scopeMenu},v.createElement(h1,J({id:a.contentId,"aria-labelledby":a.triggerId},i,{ref:c,align:"start",side:s.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var u;s.isUsingKeyboardRef.current&&((u=l.current)===null||u===void 0||u.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:ne(n.onFocusOutside,d=>{d.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:ne(n.onEscapeKeyDown,d=>{s.onClose(),d.preventDefault()}),onKeyDown:ne(n.onKeyDown,d=>{const u=d.currentTarget.contains(d.target),h=jQ[s.dir].includes(d.key);if(u&&h){var p;o.onOpenChange(!1),(p=a.trigger)===null||p===void 0||p.focus(),d.preventDefault()}})})))))});function tj(n){return n?"open":"closed"}function zg(n){return n==="indeterminate"}function nj(n){return zg(n)?"indeterminate":n?"checked":"unchecked"}function QQ(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function eee(n,e){return n.map((t,r)=>n[(e+r)%n.length])}function tee(n,e,t){const r=e.length>1&&Array.from(e).every(a=>a===e[0])?e[0]:e,i=t?n.indexOf(t):-1;let o=eee(n,Math.max(i,0));r.length===1&&(o=o.filter(a=>a!==t));const s=o.find(a=>a.toLowerCase().startsWith(r.toLowerCase()));return s!==t?s:void 0}function nee(n,e){const{x:t,y:r}=n;let i=!1;for(let o=0,s=e.length-1;o<e.length;s=o++){const a=e[o].x,l=e[o].y,c=e[s].x,d=e[s].y;l>r!=d>r&&t<(c-a)*(r-l)/(d-l)+a&&(i=!i)}return i}function ree(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return nee(t,e)}function qd(n){return e=>e.pointerType==="mouse"?n(e):void 0}const rj=LQ,ij=K3,oj=NQ,sj=$Q,aj=VQ,lj=q3,cj=HQ,iee=GQ,dj=XQ,uj=qQ,hj=ZQ,pj="DropdownMenu",[oee,Nue]=_i(pj,[Og]),ti=Og(),[see,fj]=oee(pj),aee=n=>{const{__scopeDropdownMenu:e,children:t,dir:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=n,l=ti(e),c=v.useRef(null),[d=!1,u]=os({prop:i,defaultProp:o,onChange:s});return v.createElement(see,{scope:e,triggerId:co(),triggerRef:c,contentId:co(),open:d,onOpenChange:u,onOpenToggle:v.useCallback(()=>u(h=>!h),[u]),modal:a},v.createElement(rj,J({},l,{open:d,onOpenChange:u,dir:r,modal:a}),t))},lee="DropdownMenuTrigger",cee=v.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...i}=n,o=fj(lee,t),s=ti(t);return v.createElement(ij,J({asChild:!0},s),v.createElement(Ae.button,J({type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r},i,{ref:eg(e,o.triggerRef),onPointerDown:ne(n.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(o.onOpenToggle(),o.open||a.preventDefault())}),onKeyDown:ne(n.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&o.onOpenToggle(),a.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})))}),dee=n=>{const{__scopeDropdownMenu:e,...t}=n,r=ti(e);return v.createElement(oj,J({},r,t))},uee="DropdownMenuContent",hee=v.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=fj(uee,t),o=ti(t),s=v.useRef(!1);return v.createElement(sj,J({id:i.contentId,"aria-labelledby":i.triggerId},o,r,{ref:e,onCloseAutoFocus:ne(n.onCloseAutoFocus,a=>{var l;s.current||(l=i.triggerRef.current)===null||l===void 0||l.focus(),s.current=!1,a.preventDefault()}),onInteractOutside:ne(n.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;(!i.modal||d)&&(s.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),pee=v.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ti(t);return v.createElement(aj,J({},i,r,{ref:e}))}),fee=v.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ti(t);return v.createElement(lj,J({},i,r,{ref:e}))}),gee=v.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ti(t);return v.createElement(cj,J({},i,r,{ref:e}))}),mee=v.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ti(t);return v.createElement(iee,J({},i,r,{ref:e}))}),yee=n=>{const{__scopeDropdownMenu:e,children:t,open:r,onOpenChange:i,defaultOpen:o}=n,s=ti(e),[a=!1,l]=os({prop:r,defaultProp:o,onChange:i});return v.createElement(dj,J({},s,{open:a,onOpenChange:l}),t)},wee=v.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ti(t);return v.createElement(uj,J({},i,r,{ref:e}))}),bee=v.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ti(t);return v.createElement(hj,J({},i,r,{ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),gj=aee,Jd=cee,f1=dee,mj=hee,vee=pee,Ul=fee,yj=gee,See=mee,xee=yee,_ee=wee,kee=bee;function ra(n,e){const t=G(),r=v.useRef(!1),i=zl(),o=v.useRef(0),s=v.useCallback(l=>{const c=Date.now();c-o.current<50||(o.current=c,r.current=l,t.batch(()=>{l?(t.complete(),t.addOpenMenu(n)):t.updateInstanceState({openMenus:t.getOpenMenus().filter(d=>!d.startsWith(n))}),e==null||e(l)}))},[t,n,e]),a=q("is menu open",()=>t.getOpenMenus().includes(n),[t,n]);return v.useEffect(()=>(r.current&&(i("open-menu",{source:"unknown",id:n}),t.addOpenMenu(n)),()=>{r.current&&(t.deleteOpenMenu(n),t.getOpenMenus().forEach(l=>{l.startsWith(n)&&(i("close-menu",{source:"unknown",id:n}),t.deleteOpenMenu(l))}),r.current=!1)}),[t,n,i]),[a,s]}function us({id:n,children:e,modal:t=!1,debugOpen:r=!1}){const[i,o]=ra(n);return g.jsx(gj,{open:r||i,dir:"ltr",modal:t,onOpenChange:o,children:e})}function Zd({children:n,"data-testid":e}){return g.jsx(Jd,{dir:"ltr","data-testid":e,asChild:!0,onTouchEnd:t=>Oe(t),children:n})}function hs({side:n="bottom",align:e="start",sideOffset:t=8,alignOffset:r=8,children:i}){const o=hn();return g.jsx(f1,{container:o,children:g.jsx(mj,{className:"tlui-menu",align:e,sideOffset:t,side:n,alignOffset:r,collisionPadding:4,children:i})})}function g1({id:n,children:e}){const[t,r]=ra(n);return g.jsx(xee,{open:t,onOpenChange:r,children:e})}function m1({label:n,"data-testid":e,"data-direction":t}){return g.jsx(_ee,{dir:"ltr","data-direction":t,"data-testid":e,asChild:!0,children:g.jsx(le,{type:"menu",className:"tlui-menu__submenu__trigger",label:n,icon:"chevron-right"})})}function y1({alignOffset:n=0,sideOffset:e=5,children:t}){const r=hn();return g.jsx(f1,{container:r,children:g.jsx(kee,{className:"tlui-menu tlui-menu__submenu__content",alignOffset:n,sideOffset:e,collisionPadding:4,children:t})})}function mo({children:n,size:e="medium"}){return g.jsx(vee,{dir:"ltr",className:"tlui-menu__group","data-size":e,children:n})}function gr({noClose:n,...e}){return g.jsx(Ul,{dir:"ltr",asChild:!0,onClick:n||e.isChecked!==void 0?Oe:void 0,children:g.jsx(le,{...e})})}function wj({children:n,onSelect:e,...t}){return g.jsxs(yj,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:r=>{e==null||e(r),Oe(r)},...t,children:[g.jsx(hr,{small:!0,icon:t.checked?"check":"checkbox-empty"}),n]})}function Cee({children:n,onSelect:e,...t}){return g.jsxs(yj,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:r=>{e==null||e(r),Oe(r)},...t,children:[g.jsx("div",{className:"tlui-button__checkbox__indicator",children:g.jsx(See,{dir:"ltr",children:g.jsx(hr,{icon:"check",small:!0})})}),n]})}let bj=0;function Pee(n,e){const t=Array(e),r=Math.floor(Math.sqrt(e));for(let i=0;i<e;i++)bj++,t[i]={id:tt("box"+bj),type:"geo",x:i%r*132,y:Math.floor(i/r)*132};n.batch(()=>{n.createShapes(t).setSelectedShapes(t.map(i=>i.id))})}const Eee=v.memo(function({renderDebugMenuItems:n}){const e=Ie();return g.jsxs("div",{className:"tlui-debug-panel",children:[g.jsx(Iee,{}),g.jsx(Mee,{}),g.jsxs(us,{id:"debug",children:[g.jsx(Zd,{children:g.jsx(le,{type:"icon",icon:"dots-horizontal",title:e("debug-panel.more")})}),g.jsx(hs,{side:"top",align:"end",alignOffset:0,children:g.jsx(Aee,{renderDebugMenuItems:n})})]})]})}),Iee=ze(function(){const n=G();return g.jsx("div",{className:"tlui-debug-panel__current-state",children:n.getPath()})}),Mee=function(){const n=G(),e=q("rendering shapes count",()=>n.getRenderingShapes().length,[n]);return g.jsxs("div",{children:[e," Shapes"]})},Aee=ze(function({renderDebugMenuItems:n}){const e=G(),{addToast:t}=Pi(),{addDialog:r}=ea(),[i,o]=v.useState(!1);return g.jsxs(g.Fragment,{children:[g.jsxs(mo,{children:[g.jsx(gr,{type:"menu",onClick:()=>{t({id:qe(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0}),t({id:qe(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:qe(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,icon:"twitter",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]})},label:"Show toast"}),g.jsx(gr,{type:"menu",onClick:()=>{r({component:({onClose:s})=>g.jsx(jee,{displayDontShowAgain:!0,onCancel:()=>{s()},onContinue:()=>{s()}}),onClose:()=>{}})},label:"Show dialog"}),g.jsx(gr,{type:"menu",onClick:()=>Pee(e,100),label:"Create 100 shapes"}),g.jsx(gr,{type:"menu",onClick:()=>{function s({children:u}){let h=0;if(!u.length)return 0;for(const p of[...u])h++,h+=s(p);return h}const a=e.getSelectedShapes(),l=a.length===0?e.getRenderingShapes():a,c=l.map(u=>document.getElementById(u.id).parentElement);let d=c.length;for(const u of c)d+=s(u);window.alert(`Shapes ${l.length}, DOM nodes:${d}`)},label:"Count shapes / nodes"}),(()=>{if(i)throw Error("oh no!")})(),g.jsx(gr,{type:"menu",onClick:()=>{o(!0)},label:"Throw error"}),g.jsx(gr,{type:"menu",onClick:()=>{k2()},label:"Hard reset"})]}),g.jsxs(mo,{children:[g.jsx(Qd,{flag:nt.debugSvg}),g.jsx(Qd,{flag:nt.forceSrgb}),g.jsx(Qd,{flag:nt.debugGeometry}),g.jsx(Qd,{flag:nt.hideShapes})]}),g.jsx(mo,{children:Object.values(JL).map(s=>g.jsx(Qd,{flag:s},s.name))}),n==null?void 0:n()]})});function Tee({label:n,value:e,onChange:t}){return g.jsx(wj,{title:n,checked:e,onSelect:()=>t(!e),children:g.jsx("span",{className:"tlui-button__label",draggable:!1,children:n})})}const Qd=ze(function({flag:n,onChange:e}){return g.jsx(Tee,{label:n.name.replace(/([a-z0-9])([A-Z])/g,t=>`${t[0]} ${t[1].toLowerCase()}`).replace(/^[a-z]/,t=>t.toUpperCase()),value:n.get(),onChange:t=>{n.set(t),e==null||e(t)}})});function jee({title:n="title",body:e="hello hello hello",cancel:t="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:o,onContinue:s}){const[a,l]=v.useState(!1);return g.jsxs(g.Fragment,{children:[g.jsxs(gg,{children:[g.jsx(mg,{children:n}),g.jsx(yg,{})]}),g.jsx(Hd,{style:{maxWidth:350},children:e}),g.jsxs(zv,{className:"tlui-dialog__footer__actions",children:[i&&g.jsx(le,{type:"normal",onClick:()=>l(!a),iconLeft:a?"check":"checkbox-empty",style:{marginRight:"auto"},children:"Don't show again"}),g.jsx(le,{type:"normal",onClick:o,children:t}),g.jsx(le,{type:"primary",onClick:async()=>s(),children:r})]})]})}const Ree=({id:n,component:e,onClose:t})=>{const{removeDialog:r}=ea(),i=hn(),o=v.useCallback(s=>{if(!s){if(t)try{t()}catch(a){console.warn(a)}r(n)}},[n,t,r]);return g.jsx(oJ,{onOpenChange:o,defaultOpen:!0,children:g.jsx(sJ,{container:i,children:g.jsx(aJ,{dir:"ltr",className:"tlui-dialog__overlay",children:g.jsx(lJ,{dir:"ltr",className:"tlui-dialog__content",children:g.jsx(e,{onClose:()=>o(!1)})})})})})};function Oee(){const{dialogs:n}=ea();return g.jsx(g.Fragment,{children:n.map(e=>g.jsx(Ree,{...e},e.id))})}const Dee=re.memo(Oee);function Lee(){const n=G(),e=q("follow",()=>n.getInstanceState().followingUserId,[n]);return e?g.jsx(zee,{userId:e}):null}function zee({userId:n}){const e=lP(n);return e?g.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}function vj(){const n=G(),{languages:e,currentLanguage:t}=i3(),r=v.useCallback(i=>n.user.updateUserPreferences({locale:i}),[n]);return g.jsxs(g1,{id:"help menu language",children:[g.jsx(m1,{label:"menu.language","data-direction":"left"}),g.jsx(y1,{sideOffset:-4,children:g.jsx(mo,{children:e.map(({locale:i,label:o})=>g.jsx(Cee,{title:i,checked:i===t,onSelect:()=>r(i),children:g.jsx("span",{className:"tlui-button__label",children:o})},i))})})]})}const Nee=v.memo(function(){const n=hn(),e=Ie(),[t,r]=ra("help menu");return g.jsx("div",{className:"tlui-help-menu",children:g.jsxs(gj,{dir:"ltr",open:t,onOpenChange:r,modal:!1,children:[g.jsx(Jd,{asChild:!0,dir:"ltr",children:g.jsx(le,{type:"help",className:"tlui-button",smallIcon:!0,title:e("help-menu.title"),icon:"question-mark"})}),g.jsx(f1,{container:n,children:g.jsx(mj,{className:"tlui-menu",side:"top",sideOffset:8,align:"end",alignOffset:0,collisionPadding:4,children:g.jsx(Fee,{})})})]})})});function Fee(){const n=rZ(),e=Ir();function t(r){if(!r||e&&!r.readonlyOk)return null;switch(r.type){case"custom":{if(r.id==="LANGUAGE_MENU")return g.jsx(vj,{},"item");break}case"group":return g.jsx(mo,{size:"small",children:r.children.map(t)},r.id);case"submenu":return g.jsxs(g1,{id:`help menu ${r.id}`,children:[g.jsx(m1,{label:r.label}),g.jsx(y1,{children:r.children.map(t)})]},r.id);case"item":{const{id:i,kbd:o,label:s,onSelect:a,icon:l}=r.actionItem;return g.jsx(gr,{type:"menu",kbd:o,label:s,onClick:()=>a("help-menu"),iconLeft:l},i)}}}return g.jsx(g.Fragment,{children:n.map(t)})}const w1="dismissableLayer.update",$ee="dismissableLayer.pointerDownOutside",Bee="dismissableLayer.focusOutside";let Sj;const Uee=v.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Vee=v.forwardRef((n,e)=>{var t;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...c}=n,d=v.useContext(Uee),[u,h]=v.useState(null),p=(t=u==null?void 0:u.ownerDocument)!==null&&t!==void 0?t:globalThis==null?void 0:globalThis.document,[,m]=v.useState({}),f=Ge(e,I=>h(I)),w=Array.from(d.layers),[S]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),b=w.indexOf(S),_=u?w.indexOf(u):-1,x=d.layersWithOutsidePointerEventsDisabled.size>0,P=_>=b,C=Hee(I=>{const A=I.target,T=[...d.branches].some(D=>D.contains(A));!P||T||(o==null||o(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p),E=Wee(I=>{const A=I.target;[...d.branches].some(T=>T.contains(A))||(s==null||s(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p);return ng(I=>{_===d.layers.size-1&&(i==null||i(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},p),v.useEffect(()=>{if(u)return r&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(Sj=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),xj(),()=>{r&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=Sj)}},[u,p,r,d]),v.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),xj())},[u,d]),v.useEffect(()=>{const I=()=>m({});return document.addEventListener(w1,I),()=>document.removeEventListener(w1,I)},[]),v.createElement(Ae.div,J({},c,{ref:f,style:{pointerEvents:x?P?"auto":"none":void 0,...n.style},onFocusCapture:ne(n.onFocusCapture,E.onFocusCapture),onBlurCapture:ne(n.onBlurCapture,E.onBlurCapture),onPointerDownCapture:ne(n.onPointerDownCapture,C.onPointerDownCapture)}))});function Hee(n,e=globalThis==null?void 0:globalThis.document){const t=kt(n),r=v.useRef(!1),i=v.useRef(()=>{});return v.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){_j($ee,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function Wee(n,e=globalThis==null?void 0:globalThis.document){const t=kt(n),r=v.useRef(!1);return v.useEffect(()=>{const i=o=>{o.target&&!r.current&&_j(Bee,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function xj(){const n=new CustomEvent(w1);document.dispatchEvent(n)}function _j(n,e,t,{discrete:r}){const i=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?jl(i,o):i.dispatchEvent(o)}const Kee=v.forwardRef((n,e)=>{var t;const{container:r=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...i}=n;return r?Gh.createPortal(v.createElement(Ae.div,J({},i,{ref:e})),r):null}),kj="Popover",[Cj,Fue]=_i(kj,[jg]),b1=jg(),[Gee,Vl]=Cj(kj),Yee=n=>{const{__scopePopover:e,children:t,open:r,defaultOpen:i,onOpenChange:o,modal:s=!1}=n,a=b1(e),l=v.useRef(null),[c,d]=v.useState(!1),[u=!1,h]=os({prop:r,defaultProp:i,onChange:o});return v.createElement(s1,a,v.createElement(Gee,{scope:e,contentId:co(),triggerRef:l,open:u,onOpenChange:h,onOpenToggle:v.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:c,onCustomAnchorAdd:v.useCallback(()=>d(!0),[]),onCustomAnchorRemove:v.useCallback(()=>d(!1),[]),modal:s},t))},Xee="PopoverTrigger",qee=v.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Vl(Xee,t),o=b1(t),s=Ge(e,i.triggerRef),a=v.createElement(Ae.button,J({type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":Ij(i.open)},r,{ref:s,onClick:ne(n.onClick,i.onOpenToggle)}));return i.hasCustomAnchor?a:v.createElement(N3,J({asChild:!0},o),a)}),Pj="PopoverPortal",[Jee,Zee]=Cj(Pj,{forceMount:void 0}),Qee=n=>{const{__scopePopover:e,forceMount:t,children:r,container:i}=n,o=Vl(Pj,e);return v.createElement(Jee,{scope:e,forceMount:t},v.createElement(Qr,{present:t||o.open},v.createElement(Kee,{asChild:!0,container:i},r)))},eu="PopoverContent",ete=v.forwardRef((n,e)=>{const t=Zee(eu,n.__scopePopover),{forceMount:r=t.forceMount,...i}=n,o=Vl(eu,n.__scopePopover);return v.createElement(Qr,{present:r||o.open},o.modal?v.createElement(tte,J({},i,{ref:e})):v.createElement(nte,J({},i,{ref:e})))}),tte=v.forwardRef((n,e)=>{const t=Vl(eu,n.__scopePopover),r=v.useRef(null),i=Ge(e,r),o=v.useRef(!1);return v.useEffect(()=>{const s=r.current;if(s)return Dv(s)},[]),v.createElement(Rv,{as:Js,allowPinchZoom:!0},v.createElement(Ej,J({},n,{ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ne(n.onCloseAutoFocus,s=>{var a;s.preventDefault(),o.current||(a=t.triggerRef.current)===null||a===void 0||a.focus()}),onPointerDownOutside:ne(n.onPointerDownOutside,s=>{const a=s.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;o.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:ne(n.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1})})))}),nte=v.forwardRef((n,e)=>{const t=Vl(eu,n.__scopePopover),r=v.useRef(!1),i=v.useRef(!1);return v.createElement(Ej,J({},n,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var s;if((s=n.onCloseAutoFocus)===null||s===void 0||s.call(n,o),!o.defaultPrevented){var a;r.current||(a=t.triggerRef.current)===null||a===void 0||a.focus(),o.preventDefault()}r.current=!1,i.current=!1},onInteractOutside:o=>{var s,a;(s=n.onInteractOutside)===null||s===void 0||s.call(n,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const l=o.target;!((a=t.triggerRef.current)===null||a===void 0)&&a.contains(l)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),Ej=v.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:d,...u}=n,h=Vl(eu,t),p=b1(t);return Mv(),v.createElement(Ev,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},v.createElement(Vee,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:d,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1)},v.createElement(F3,J({"data-state":Ij(h.open),role:"dialog",id:h.contentId},p,u,{ref:e,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))});function Ij(n){return n?"open":"closed"}const rte=Yee,ite=qee,Mj=Qee,Aj=ete,v1=({id:n,children:e,onOpenChange:t,open:r})=>{const[i,o]=ra(n,t);return g.jsx(rte,{onOpenChange:o,open:r||i,children:g.jsx("div",{className:"tlui-popover",children:e})})},S1=({children:n,disabled:e,"data-testid":t})=>g.jsx(ite,{"data-testid":t,disabled:e,asChild:!0,dir:"ltr",children:n}),Tj=({side:n,children:e,align:t="center",sideOffset:r=8,alignOffset:i=0})=>{const o=hn();return g.jsx(Mj,{container:o,children:g.jsx(Aj,{className:"tlui-popover__content",side:n,sideOffset:r,align:t,alignOffset:i,dir:"ltr",children:e})})},jj=v.memo(function(){const n=Ie(),e=hn(),t=XJ(),r=Ir();function i(o){if(!o||r&&!o.readonlyOk)return null;switch(o.type){case"item":{const{id:s,icon:a,label:l,kbd:c,onSelect:d}=o.actionItem;return g.jsx(le,{"data-testid":`menu-item.${o.id}`,icon:a,type:"icon",title:l?c?`${n(l)} ${ki(c)}`:`${n(l)}`:c?`${ki(c)}`:"",onClick:()=>d("actions-menu"),disabled:o.disabled},s)}}}return g.jsxs(v1,{id:"actions-menu",children:[g.jsx(S1,{children:g.jsx(le,{className:"tlui-menu__trigger","data-testid":"main.action-menu",icon:"dots-vertical",title:n("actions-menu.title"),type:"icon",smallIcon:!0})}),g.jsx(Mj,{container:e,children:g.jsx(Aj,{className:"tlui-popover__content",side:"bottom",dir:"ltr",sideOffset:6,children:g.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid",children:t.map(i)})})})]})}),Rj=ze(function(){const n=G(),e=bn(),t=Ie(),r=e.duplicate;return g.jsx(le,{icon:r.icon,type:"icon",onClick:()=>r.onSelect("quick-actions"),disabled:!(n.isIn("select")&&n.getSelectedShapeIds().length>0),title:`${t(r.label)} ${ki(r.kbd)}`,smallIcon:!0})}),ote=v.memo(function(){const n=Ie();return g.jsxs(us,{id:"main menu",children:[g.jsx(Zd,{children:g.jsx(le,{type:"icon",className:"tlui-menu__trigger","data-testid":"main.menu",title:n("menu.title"),icon:"menu",smallIcon:!0})}),g.jsx(hs,{alignOffset:0,sideOffset:6,children:g.jsx(ste,{})})]})});function ste(){const n=G(),e=Ie(),t=oZ(),r=Tr(),i=Ir();function o(s,a,l,c){if(!a)return null;switch(a.type){case"custom":return i&&!a.readonlyOk?null:a.id==="LANGUAGE_MENU"?g.jsx(vj,{},"item"):null;case"group":return i&&!a.readonlyOk?null:g.jsx(mo,{size:c<=1?"medium":r<3||(l==null?void 0:l.type)==="submenu"&&c>2?"tiny":"medium",children:a.children.map(d=>o(s,d,a,c+1))},a.id);case"submenu":return i&&!a.readonlyOk?null:g.jsxs(g1,{id:`main menu ${l?l.id+" ":""}${a.id}`,children:[g.jsx(m1,{label:a.label,"data-testid":`menu-item.${a.id}`}),g.jsx(y1,{sideOffset:-4,alignOffset:-1,children:a.children.map(d=>o(s,d,a,c+1))})]},a.id);case"item":{if(i&&!a.readonlyOk)return null;const{id:d,checkbox:u,menuLabel:h,label:p,onSelect:m,kbd:f}=a.actionItem,w=h??p,S=w?e(w):void 0;return u?g.jsxs(wj,{onSelect:()=>m("menu"),title:S||"",checked:a.checked,disabled:a.disabled,children:[S&&g.jsx("span",{className:"tlui-button__label",children:S}),f&&g.jsx(ag,{children:f})]},d):g.jsx(gr,{type:"menu","data-testid":`menu-item.${a.id}`,kbd:f,label:w,onClick:()=>m("menu"),disabled:a.disabled},d)}}}return g.jsx(g.Fragment,{children:t.map(s=>o(n,s,null,0))})}const ate=function({name:n,id:e,isCurrentPage:t}){const r=G(),i=v.useRef(null),o=v.useCallback(a=>{r.renamePage(e,a||"New Page",{ephemeral:!0})},[r,e]),s=v.useCallback(a=>{r.mark("rename page"),r.renamePage(e,a||"New Page",{ephemeral:!1})},[r,e]);return g.jsx(Nv,{className:"tlui-page-menu__item__input",ref:a=>i.current=a,defaultValue:n,onValueChange:o,onComplete:s,onCancel:s,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:t,autoselect:!0})},x1=(n,e,t,r)=>{let i;const o=n.getPages(),s=t>r?o[r-1]:o[r],a=t>r?o[r]:o[r+1];s&&!a?i=to(s.index):!s&&a?i=xF(o[0].index):i=wd(s.index,a.index),i!==o[t].index&&(n.mark("moving page"),n.updatePage({id:e,index:i}))},Oj=ze(function({index:n,listSize:e,item:t,onRename:r}){const i=G(),o=Ie(),s=i.getPages(),a=v.useCallback(()=>{i.mark("creating page");const u=Ji.createId();i.duplicatePage(t.id,u)},[i,t]),l=v.useCallback(()=>{x1(i,t.id,n,n-1)},[i,t,n]),c=v.useCallback(()=>{x1(i,t.id,n,n+1)},[i,t,n]),d=v.useCallback(()=>{i.mark("deleting page"),i.deletePage(t.id)},[i,t]);return g.jsxs(us,{id:`page item submenu ${n}`,children:[g.jsx(Zd,{children:g.jsx(le,{type:"icon",title:o("page-menu.submenu.title"),icon:"dots-vertical"})}),g.jsxs(hs,{alignOffset:0,children:[g.jsxs(mo,{children:[r&&g.jsx(Ul,{dir:"ltr",onSelect:r,asChild:!0,children:g.jsx(le,{type:"menu",label:"page-menu.submenu.rename"})}),g.jsx(Ul,{dir:"ltr",onSelect:a,disabled:s.length>=kp,asChild:!0,children:g.jsx(le,{type:"menu",label:"page-menu.submenu.duplicate-page"})}),n>0&&g.jsx(Ul,{dir:"ltr",onSelect:l,asChild:!0,children:g.jsx(le,{type:"menu",label:"page-menu.submenu.move-up"})}),n<e-1&&g.jsx(Ul,{dir:"ltr",onSelect:c,asChild:!0,children:g.jsx(le,{type:"menu",label:"page-menu.submenu.move-down"})})]}),e>1&&g.jsx(mo,{children:g.jsx(Ul,{dir:"ltr",onSelect:d,asChild:!0,children:g.jsx(le,{type:"menu",label:"page-menu.submenu.delete"})})})]})]})}),lte=function(){const n=G(),e=Ie(),t=Tr(),r=v.useCallback(()=>f(!1),[]),[i,o]=ra("page-menu",r),s=36,a=v.useRef(null),l=q("pages",()=>n.getPages(),[n]),c=q("currentPage",()=>n.getCurrentPage(),[n]),d=q("currentPageId",()=>n.getCurrentPageId(),[n]),u=Ir(),h=q("maxPageCountReached",()=>n.getPages().length>=kp,[n]),p=q("isCoarsePointer",()=>n.getInstanceState().isCoarsePointer,[n]),[m,f]=v.useState(!1),w=v.useCallback(()=>{u||f(A=>!A)},[u]),S=v.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[b,_]=v.useState(Object.fromEntries(l.map((A,T)=>[A.id,{y:T*s,offsetY:0,isSelected:!1}])));v.useLayoutEffect(()=>{_(Object.fromEntries(l.map((A,T)=>[A.id,{y:T*s,offsetY:0,isSelected:!1}])))},[s,l]),v.useEffect(()=>{i&&requestAnimationFrame(()=>{const A=document.querySelector(`[data-testid="page-menu-item-${d}"]`);if(A){const T=a.current;if(!T)return;const D=A.offsetTop,F=T.scrollTop;D<F&&T.scrollTo({top:D});const H=D+s,O=T.scrollTop+T.offsetHeight;H>O&&T.scrollTo({top:H-T.offsetHeight})}})},[s,d,i]);const x=v.useCallback(A=>{const{clientY:T,currentTarget:D}=A,{dataset:{id:F,index:H}}=D;if(!F||!H)return;const O=S.current;ed(A.currentTarget,A),O.status="pointing",O.pointing={id:F,index:+H};const K=b[F].y;O.startY=T,O.startIndex=Math.max(0,Math.min(Math.round(K/s),l.length-1))},[s,l.length,b]),P=v.useCallback(A=>{const T=S.current;if(T.status==="pointing"){const{clientY:D}=A,F=D-T.startY;Math.abs(F)>5&&(T.status="dragging")}if(T.status==="dragging"){const{clientY:D}=A,F=D-T.startY,H=b[T.pointing.id],{startIndex:O,pointing:K}=T,B=H.y+F,te=Math.max(0,Math.min(Math.round(B/s),l.length-1)),W={...b};if(W[K.id]={y:H.y,offsetY:F,isSelected:!0},te!==T.dragIndex){T.dragIndex=te;for(let N=0;N<l.length;N++){const Y=l[N];if(Y.id===T.pointing.id)continue;let{y:ee}=W[Y.id];te===O?ee=N*s:te<O?te<=N&&N<O?ee=(N+1)*s:ee=N*s:te>O&&(te>=N&&N>O?ee=(N-1)*s:ee=N*s),ee!==W[Y.id].y&&(W[Y.id]={y:ee,offsetY:0,isSelected:!0})}}_(W)}},[s,l,b]),C=v.useCallback(A=>{const T=S.current;if(T.status==="dragging"){const{id:D,index:F}=T.pointing;x1(n,D,F,T.dragIndex)}td(A.currentTarget,A),T.status="idle"},[n]),E=v.useCallback(A=>{const T=S.current;A.key==="Escape"&&(T.status==="dragging"&&_(Object.fromEntries(l.map((D,F)=>[D.id,{y:F*s,offsetY:0,isSelected:!1}]))),T.status="idle")},[s,l]),I=v.useCallback(()=>{u||n.batch(()=>{n.mark("creating page");const A=Ji.createId();n.createPage({name:e("page-menu.new-page-initial-name"),id:A}),n.setCurrentPage(A),f(!0)})},[n,e,u]);return g.jsxs(v1,{id:"pages",onOpenChange:o,open:i,children:[g.jsx(S1,{children:g.jsx(le,{className:"tlui-page-menu__trigger tlui-menu__trigger","data-testid":"main.page-menu",icon:"chevron-down",type:"menu",title:c.name,children:g.jsx("div",{className:"tlui-page-menu__name",children:c.name})})}),g.jsx(Tj,{side:"bottom",align:"start",sideOffset:6,children:g.jsxs("div",{className:"tlui-page-menu__wrapper",children:[g.jsxs("div",{className:"tlui-page-menu__header",children:[g.jsx("div",{className:"tlui-page-menu__header__title",children:e("page-menu.title")}),!u&&g.jsxs("div",{className:"tlui-buttons__horizontal",children:[g.jsx(le,{type:"icon","data-testid":"page-menu.edit",title:e(m?"page-menu.edit-done":"page-menu.edit-start"),icon:m?"check":"edit",onClick:w}),g.jsx(le,{type:"icon","data-testid":"page-menu.create",icon:"plus",title:e(h?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:h,onClick:I})]})]}),g.jsx("div",{className:"tlui-page-menu__list tlui-menu__group",style:{height:s*l.length+4},ref:a,children:l.map((A,T)=>{const D=b[A.id]??{position:T*40,offsetY:0};return m?g.jsxs("div",{"data-testid":`page-menu-item-${A.id}`,className:"tlui-page_menu__item__sortable",style:{zIndex:A.id===c.id?888:T,transform:`translate(0px, ${D.y+D.offsetY}px)`},children:[g.jsx(le,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",icon:"drag-handle-dots",onPointerDown:x,onPointerUp:C,onPointerMove:P,onKeyDown:E,"data-id":A.id,"data-index":T}),t<5&&p?g.jsx(le,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const F=window.prompt("Rename page",A.name);F&&F!==A.name&&n.renamePage(A.id,F)},onDoubleClick:w,isChecked:A.id===c.id,children:g.jsx("span",{children:A.name})}):g.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:s},children:g.jsx(ate,{id:A.id,name:A.name,isCurrentPage:A.id===c.id})}),!u&&g.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":m,children:g.jsx(Oj,{index:T,item:A,listSize:l.length})})]},A.id+"_editing"):g.jsxs("div",{"data-testid":`page-menu-item-${A.id}`,className:"tlui-page-menu__item",children:[g.jsxs(le,{type:"normal",className:"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox",onClick:()=>n.setCurrentPage(A.id),onDoubleClick:w,isChecked:A.id===c.id,title:e("page-menu.go-to-page"),children:[g.jsx("div",{className:"tlui-page-menu__item__button__check",children:A.id===c.id&&g.jsx(hr,{icon:"check"})}),g.jsx("span",{children:A.name})]}),!u&&g.jsx("div",{className:"tlui-page_menu__item__submenu",children:g.jsx(Oj,{index:T,item:A,listSize:l.length,onRename:()=>{if(n.environment.isIos){const F=window.prompt("Rename page",A.name);F&&F!==A.name&&n.renamePage(A.id,F)}else n.batch(()=>{f(!0),n.setCurrentPage(A.id)})}})})]},A.id)})})]})})]})},Dj=v.memo(function(){const n=Ie(),e=s3(),t=bn().redo;return g.jsx(le,{"data-testid":"main.redo",icon:t.icon,type:"icon",title:`${n(t.label)} ${ki(t.kbd)}`,disabled:!e,onClick:()=>t.onSelect("quick-actions"),smallIcon:!0})}),Lj=ze(function(){const n=G(),e=bn(),t=Ie(),r=e.delete;return Ir()?null:g.jsx(le,{icon:r.icon,type:"icon",onClick:()=>{r.onSelect("quick-actions"),n.getContainer().focus()},disabled:!(n.isIn("select")&&n.getSelectedShapeIds().length>0),title:`${t(r.label)} ${ki(r.kbd)}`,smallIcon:!0})}),zj=v.memo(function(){const n=Ie(),e=a3(),t=bn().undo;return g.jsx(le,{"data-testid":"main.undo",icon:t.icon,type:"icon",title:`${n(t.label)} ${ki(t.kbd)}`,disabled:!e,onClick:()=>t.onSelect("quick-actions"),smallIcon:!0})}),cte=ze(function(){const n=G(),e=Tr(),t=Ir();return g.jsx("div",{className:"tlui-menu-zone",children:g.jsxs("div",{className:"tlui-buttons__horizontal",children:[g.jsx(ote,{}),g.jsx(lte,{}),e>=6&&!t&&!n.isInAny("hand","zoom")&&g.jsxs(g.Fragment,{children:[g.jsx(zj,{}),g.jsx(Dj,{}),g.jsx(Lj,{}),g.jsx(Rj,{}),g.jsx(jj,{})]})]})})});function dte(n,e){const[t,r]=re.useState(e);re.useLayoutEffect(()=>{const o=localStorage.getItem(n);if(o)try{r(JSON.parse(o))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const i=re.useCallback(o=>{r(s=>{const a=typeof o=="function"?o(s):o;return localStorage.setItem(n,JSON.stringify(a)),a})},[n]);return[t,i]}class tu{constructor(e){y(this,"dpr",1);y(this,"colors",{shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"});y(this,"id",qe());y(this,"cvs",null);y(this,"pageBounds",[]);y(this,"collaborators",[]);y(this,"canvasScreenBounds",new de);y(this,"canvasPageBounds",new de);y(this,"contentPageBounds",new de);y(this,"contentScreenBounds",new de);y(this,"originPagePoint",new k);y(this,"originPageCenter",new k);y(this,"isInViewport",!1);y(this,"debug",!1);y(this,"updateContentScreenBounds",()=>{const{contentScreenBounds:e,contentPageBounds:t,canvasScreenBounds:r}=this;let{x:i,y:o,w:s,h:a}=e;if(t.w>t.h){const l=r.w/(t.w/t.h);l>r.h?(i=(r.w-r.w*(r.h/l))/2,o=0,s=r.w*(r.h/l),a=r.h):(i=0,o=(r.h-l)/2,s=r.w,a=l)}else if(t.w<t.h){const l=r.h/(t.h/t.w);i=(r.w-l)/2,o=0,s=l,a=r.h}else i=r.h/2,o=0,s=r.h,a=r.h;e.set(i,o,s,a)});y(this,"updateCanvasPageBounds",()=>{const{canvasPageBounds:e,canvasScreenBounds:t,contentPageBounds:r,contentScreenBounds:i}=this;e.set(0,0,r.width/(i.width/t.width),r.height/(i.height/t.height)),e.center=r.center});y(this,"getScreenPoint",(e,t)=>{const{canvasScreenBounds:r}=this,i=(e-r.minX)*this.dpr,o=(t-r.minY)*this.dpr;return{x:i,y:o}});y(this,"getPagePoint",(e,t)=>{const{contentPageBounds:r,contentScreenBounds:i,canvasPageBounds:o}=this,{x:s,y:a}=this.getScreenPoint(e,t);return new k(o.minX+s*r.width/i.width,o.minY+a*r.height/i.height,1)});y(this,"minimapScreenPointToPagePoint",(e,t,r=!1,i=!1)=>{const{editor:o}=this,s=o.getViewportPageBounds();let{x:a,y:l}=this.getPagePoint(e,t);if(i){const c=this.editor.getCurrentPageBounds(),d=s,u=((c==null?void 0:c.minX)??0)-d.width/2,h=((c==null?void 0:c.maxX)??0)+d.width/2,p=((c==null?void 0:c.minY)??0)-d.height/2,m=((c==null?void 0:c.maxY)??0)+d.height/2,f=Math.max(0,u+d.width-a),w=Math.max(0,-(h-d.width-a)),S=Math.max(0,p+d.height-l),b=Math.max(0,-(m-d.height-l)),_=Math.max(0,f-w),x=Math.max(0,w-f),P=Math.max(0,S-b),C=Math.max(0,b-S);_&&_>x?a+=_/2:x&&(a-=x/2),P&&P>C?l+=P/2:C&&(l-=C/2),a=wi(a,u,h),l=wi(l,p,m)}if(r){const{originPagePoint:c}=this,d=Math.abs(a-c.x),u=Math.abs(l-c.y);d>u?l=c.y:a=c.x}return new k(a,l)});y(this,"render",()=>{const{cvs:e,pageBounds:t}=this;this.updateCanvasPageBounds();const{editor:r,canvasScreenBounds:i,canvasPageBounds:o,contentPageBounds:s,contentScreenBounds:a}=this,{width:l,height:c}=i,d=r.getSelectedShapeIds(),u=r.getViewportPageBounds();if(!e||!t)return;const h=e.getContext("2d");if(!h)throw new Error("Minimap (shapes): Could not get context");h.resetTransform(),h.globalAlpha=1,h.clearRect(0,0,l,c);const p=a.width/s.width,m=a.height/s.height;h.translate((l-a.width)/2,(c-a.height)/2),h.scale(p,m),h.translate(-s.minX,-s.minY);const f=8/p,w=8/p,S=1/p,b=1/p,_=f/4,x=w/4,P=new Path2D,C=new Path2D,{shapeFill:E,selectFill:I,viewportFill:A}=this.colors;let T;for(let K=0,B=t.length;K<B;K++)T=t[K],tu.roundedRect(d.includes(T.id)?C:P,T.minX,T.minY,T.width,T.height,wi(f,S,T.width/_),wi(w,b,T.height/x));if(h.fillStyle=E,h.fill(P),h.fillStyle=I,h.fill(C),this.debug){const K=de.Common(t),{minX:B,minY:te,width:W,height:N}=K;h.strokeStyle="green",h.lineWidth=2/p,h.strokeRect(B+1/p,te+1/m,W-2/p,N-2/m)}{const{brush:K}=r.getInstanceState();if(K){const{x:B,y:te,w:W,h:N}=K;h.beginPath(),tu.sharpRect(h,B,te,W,N),h.closePath(),h.fillStyle=A,h.fill()}}{const{minX:K,minY:B,width:te,height:W}=u;h.beginPath();const N=12/p,Y=12/p;tu.roundedRect(h,K,B,te,W,Math.min(te/4,N),Math.min(W/4,Y)),h.closePath(),h.fillStyle=A,h.fill(),this.debug&&(h.strokeStyle="orange",h.strokeRect(K+1/p,B+1/m,te-2/p,W-2/m))}const D=2.5/p,F=2.5/m,H=r.getCurrentPageId();let O;for(let K=0;K<this.collaborators.length;K++)O=this.collaborators[K],O.currentPageId===H&&(h.beginPath(),h.ellipse(wi(O.cursor.x,o.minX+D,o.maxX-D),wi(O.cursor.y,o.minY+F,o.maxY-F),5/p,5/m,0,0,We),h.fillStyle=O.color,h.fill());if(this.debug){h.lineWidth=2/p;{const{minX:K,minY:B,width:te,height:W}=s;h.strokeStyle="red",h.strokeRect(K+1/p,B+1/m,te-2/p,W-2/m)}{const{minX:K,minY:B,width:te,height:W}=o;h.strokeStyle="blue",h.strokeRect(K+1/p,B+1/m,te-2/p,W-2/m)}}});this.editor=e}setDpr(e){this.dpr=+e.toFixed(2)}static roundedRect(e,t,r,i,o,s,a){if(s<1&&a<1){e.rect(t,r,i,o);return}e.moveTo(t+s,r),e.lineTo(t+i-s,r),e.quadraticCurveTo(t+i,r,t+i,r+a),e.lineTo(t+i,r+o-a),e.quadraticCurveTo(t+i,r+o,t+i-s,r+o),e.lineTo(t+s,r+o),e.quadraticCurveTo(t,r+o,t,r+o-a),e.lineTo(t,r+a),e.quadraticCurveTo(t,r,t+s,r)}static sharpRect(e,t,r,i,o,s,a){e.rect(t,r,i,o)}}function ute({shapeFill:n,selectFill:e,viewportFill:t}){const r=G(),i=v.useRef(null),o=v.useRef(!1),s=Hp(),a=AC("dpr",()=>r.getInstanceState().devicePixelRatio,[r]),l=v.useMemo(()=>r.store.query.records("instance_presence"),[r]),c=v.useMemo(()=>new tu(r),[r]);v.useEffect(()=>{const m=requestAnimationFrame(()=>{const f=getComputedStyle(r.getContainer());c.colors={shapeFill:f.getPropertyValue(n).trim(),selectFill:f.getPropertyValue(e).trim(),viewportFill:f.getPropertyValue(t).trim()},c.render()});return()=>{cancelAnimationFrame(m)}},[r,e,n,t,c,s]);const d=v.useCallback(m=>{if(!r.getCurrentPageShapeIds().size)return;const f=c.minimapScreenPointToPagePoint(m.clientX,m.clientY,!1,!1),w=c.minimapScreenPointToPagePoint(m.clientX,m.clientY,!1,!0);c.originPagePoint.setTo(w),c.originPageCenter.setTo(r.getViewportPageBounds().center),r.centerOnPoint(f,{duration:eo})},[r,c]),u=v.useCallback(m=>{const f=m.currentTarget;if(ed(f,m),!r.getCurrentPageShapeIds().size)return;o.current=!0,c.isInViewport=!1;const w=c.minimapScreenPointToPagePoint(m.clientX,m.clientY,!1,!1),S=c.minimapScreenPointToPagePoint(m.clientX,m.clientY,!1,!0),b=r.getViewportPageBounds();if(c.isInViewport=b.containsPoint(S),c.isInViewport)c.originPagePoint.setTo(S),c.originPageCenter.setTo(b.center);else{const x=k.Sub(b.center,b.point),P=k.Add(w,x);c.originPagePoint.setTo(P),c.originPageCenter.setTo(w),r.centerOnPoint(w,{duration:eo})}function _(x){f&&td(f,x),o.current=!1,document.body.removeEventListener("pointerup",_)}document.body.addEventListener("pointerup",_)},[r,c]),h=v.useCallback(m=>{const f=c.minimapScreenPointToPagePoint(m.clientX,m.clientY,m.shiftKey,!0);if(o.current){if(c.isInViewport){const _=c.originPagePoint.clone().sub(c.originPageCenter);r.centerOnPoint(k.Sub(f,_));return}r.centerOnPoint(f)}const w=c.getPagePoint(m.clientX,m.clientY),S=r.pageToScreen(w),b={type:"pointer",target:"canvas",name:"pointer_move",...Hn(m),point:S,isPen:r.getInstanceState().isPenMode};r.dispatch(b)},[r,c]),p=v.useCallback(m=>{const f=Z2(m);r.dispatch({type:"wheel",name:"wheel",delta:f,point:new k(m.clientX,m.clientY),shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey})},[r]);return Ds("update when dpr changes",()=>{const m=a.get();c.setDpr(m);const f=i.current,w=f.getBoundingClientRect(),S=w.width*m,b=w.height*m;f.width=S,f.height=b,c.canvasScreenBounds.set(w.x,w.y,S,b),c.cvs=i.current},[a,c]),Ds("minimap render when pagebounds or collaborators changes",()=>{const m=r.getCurrentPageShapeIds(),f=r.getCurrentPageBounds(),w=r.getViewportPageBounds();a.get(),c.contentPageBounds=f?de.Expand(f,w):w,c.updateContentScreenBounds();const S=[];m.forEach(b=>{let _=r.getShapePageBounds(b);if(!_)return;const x=r.getShapeMask(b);if(x){const P=_w(x,_.corners);if(!P)return;_=de.FromPoints(P)}_&&(_.id=b,S.push(_))}),c.pageBounds=S,c.collaborators=l.get(),c.render()},[r,c]),g.jsx("div",{className:"tlui-minimap",children:g.jsx("canvas",{ref:i,className:"tlui-minimap__canvas",onDoubleClick:d,onPointerMove:h,onPointerDown:u,onWheel:p})})}const _1=ze(function(){const n=G(),e=Ie(),t=Tr(),r=n.getZoomLevel(),i=n.getCurrentPageShapeIds().size>0,o=n.getSelectedShapeIds().length>0,s=n.getZoomLevel()===1,a=v.useCallback(()=>{n.resetZoom(n.getViewportScreenCenter(),{duration:eo})},[n]);return g.jsxs(us,{id:"zoom",children:[g.jsx(Zd,{children:g.jsx(le,{type:"icon",title:`${e("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu",className:t<5?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,icon:t<4?"zoom-in":void 0,children:t<4?null:g.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(r*100),"%"]})})}),g.jsx(hs,{side:"top",align:"start",alignOffset:0,children:g.jsxs(mo,{children:[g.jsx(nu,{action:"zoom-in","data-testid":"minimap.zoom-menu.zoom-in",noClose:!0}),g.jsx(nu,{action:"zoom-out","data-testid":"minimap.zoom-menu.zoom-out",noClose:!0}),g.jsx(nu,{action:"zoom-to-100","data-testid":"minimap.zoom-menu.zoom-to-100",noClose:!0,disabled:s}),g.jsx(nu,{action:"zoom-to-fit",disabled:!i,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0}),g.jsx(nu,{action:"zoom-to-selection",disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})]})})]})});function nu(n){const{action:e,disabled:t=!1,noClose:r=!1}=n,i=bn();return g.jsx(gr,{type:"menu",label:i[e].label,kbd:i[e].kbd,"data-testid":n["data-testid"],onClick:()=>i[e].onSelect("zoom-menu"),noClose:r,disabled:t})}const hte=v.memo(function(){const n=bn(),e=Ie(),t=Tr(),[r,i]=dte("minimap",!0),o=v.useCallback(()=>{i(s=>!s)},[i]);return t<4?null:g.jsxs("div",{className:"tlui-navigation-zone",children:[g.jsx("div",{className:"tlui-buttons__horizontal",children:t<6?g.jsx(_1,{}):r?g.jsxs(g.Fragment,{children:[g.jsx(_1,{}),g.jsx(le,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:e("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]}):g.jsxs(g.Fragment,{children:[g.jsx(le,{type:"icon",icon:"minus","data-testid":"minimap.zoom-out",title:`${e(n["zoom-out"].label)} ${ki(n["zoom-out"].kbd)}`,onClick:()=>n["zoom-out"].onSelect("navigation-zone")}),g.jsx(_1,{}),g.jsx(le,{type:"icon",icon:"plus","data-testid":"minimap.zoom-in",title:`${e(n["zoom-in"].label)} ${ki(n["zoom-in"].kbd)}`,onClick:()=>n["zoom-in"].onSelect("navigation-zone")}),g.jsx(le,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:e("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]})}),t>=6&&!r&&g.jsx(ute,{viewportFill:"--color-muted-1",selectFill:"--color-selected",shapeFill:"--color-text-3"})]})}),pte=ze(function(){const n=G().getInstanceState().isPenMode,e=bn();if(!n)return null;const t=e["exit-pen-mode"];return g.jsx(le,{type:"normal",label:t.label,iconLeft:t.icon,onClick:()=>t.onSelect("helper-buttons")})}),fte=ze(function(){const n=G(),e=bn();if(!n.getInstanceState().followingUserId)return null;const t=e["stop-following"];return g.jsx(le,{type:"normal",label:t.label,iconLeft:t.icon,onClick:()=>t.onSelect("people-menu")})}),gte=[Cr,$s,Ja,mi];function Nj(){const n=G();return q("getRelevantStyles",()=>{var r;const e=new Cw(n.getSharedStyles()),t=n.getSelectedShapeIds().length>0||!!((r=n.root.getCurrent())!=null&&r.shapeType);if(e.size===0&&n.isIn("select")&&n.getSelectedShapeIds().length===0)for(const i of gte)e.applyValue(i,n.getStyleForNextShape(i));return e.size===0&&!t?null:{styles:e,opacity:n.getSharedOpacity()}},[n])}function mte(n){const{uiType:e,items:t,title:r,style:i,value:o,onValueChange:s}=n,a=G(),l=Ie(),c=v.useRef(!1),{handleButtonClick:d,handleButtonPointerDown:u,handleButtonPointerEnter:h,handleButtonPointerUp:p}=v.useMemo(()=>{const f=()=>{c.current=!1,window.removeEventListener("pointerup",f)};return{handleButtonClick:w=>{const{id:S}=w.currentTarget.dataset;o.type==="shared"&&o.value===S||(a.mark("point picker item"),s(i,S,!1))},handleButtonPointerDown:w=>{const{id:S}=w.currentTarget.dataset;a.mark("point picker item"),s(i,S,!0),c.current=!0,window.addEventListener("pointerup",f)},handleButtonPointerEnter:w=>{if(!c.current)return;const{id:S}=w.currentTarget.dataset;s(i,S,!0)},handleButtonPointerUp:w=>{const{id:S}=w.currentTarget.dataset;s(i,S,!1)}}},[o,a,s,i]),m=q("theme",()=>Vn({isDarkMode:a.user.getIsDarkMode()}),[a]);return g.jsx("div",{className:ye("tlui-buttons__grid"),children:t.map(f=>g.jsx(le,{type:"icon","data-id":f.value,"data-testid":`style.${e}.${f.value}`,"aria-label":f.value,"data-state":o.type==="shared"&&o.value===f.value?"hinted":void 0,title:r+" \u2014 "+l(`${e}-style.${f.value}`),className:ye("tlui-button-grid__button"),style:i===Cr?{color:m[f.value].solid}:void 0,onPointerEnter:h,onPointerDown:u,onPointerUp:p,onClick:d,icon:f.icon},f.value))})}const Hl=v.memo(mte);function Fj(n,[e,t]){return Math.min(t,Math.max(e,n))}function yte(n){const e=v.useRef({value:n,previous:n});return v.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}const $j=["PageUp","PageDown"],Bj=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Uj={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ru="Slider",[k1,wte,bte]=tg(ru),[Vj,$ue]=_i(ru,[bte]),[vte,Ng]=Vj(ru),Ste=v.forwardRef((n,e)=>{const{name:t,min:r=0,max:i=100,step:o=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:d,onValueChange:u=()=>{},onValueCommit:h=()=>{},inverted:p=!1,...m}=n,[f,w]=v.useState(null),S=Ge(e,O=>w(O)),b=v.useRef(new Set),_=v.useRef(0),x=s==="horizontal",P=f?!!f.closest("form"):!0,C=x?xte:_te,[E=[],I]=os({prop:d,defaultProp:c,onChange:O=>{var K;(K=[...b.current][_.current])===null||K===void 0||K.focus(),u(O)}}),A=v.useRef(E);function T(O){const K=jte(E,O);H(O,K)}function D(O){H(O,_.current)}function F(){const O=A.current[_.current];E[_.current]!==O&&h(E)}function H(O,K,{commit:B}={commit:!1}){const te=Lte(o),W=zte(Math.round((O-r)/o)*o+r,te),N=Fj(W,[r,i]);I((Y=[])=>{const ee=Ate(Y,N,K);if(Dte(ee,l*o)){_.current=ee.indexOf(N);const pe=String(ee)!==String(Y);return pe&&B&&h(ee),pe?ee:Y}else return Y})}return v.createElement(vte,{scope:n.__scopeSlider,disabled:a,min:r,max:i,valueIndexToChangeRef:_,thumbs:b.current,values:E,orientation:s},v.createElement(k1.Provider,{scope:n.__scopeSlider},v.createElement(k1.Slot,{scope:n.__scopeSlider},v.createElement(C,J({"aria-disabled":a,"data-disabled":a?"":void 0},m,{ref:S,onPointerDown:ne(m.onPointerDown,()=>{a||(A.current=E)}),min:r,max:i,inverted:p,onSlideStart:a?void 0:T,onSlideMove:a?void 0:D,onSlideEnd:a?void 0:F,onHomeKeyDown:()=>!a&&H(r,0,{commit:!0}),onEndKeyDown:()=>!a&&H(i,E.length-1,{commit:!0}),onStepKeyDown:({event:O,direction:K})=>{if(!a){const B=$j.includes(O.key)||O.shiftKey&&Bj.includes(O.key)?10:1,te=_.current,W=E[te],N=o*B*K;H(W+N,te,{commit:!0})}}})))),P&&E.map((O,K)=>v.createElement(Mte,{key:K,name:t?t+(E.length>1?"[]":""):void 0,value:O})))}),[Hj,Wj]=Vj(ru,{startEdge:"left",endEdge:"right",size:"width",direction:1}),xte=v.forwardRef((n,e)=>{const{min:t,max:r,dir:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...d}=n,[u,h]=v.useState(null),p=Ge(e,_=>h(_)),m=v.useRef(),f=qv(i),w=f==="ltr",S=w&&!o||!w&&o;function b(_){const x=m.current||u.getBoundingClientRect(),P=[0,x.width],C=C1(P,S?[t,r]:[r,t]);return m.current=x,C(_-x.left)}return v.createElement(Hj,{scope:n.__scopeSlider,startEdge:S?"left":"right",endEdge:S?"right":"left",direction:S?1:-1,size:"width"},v.createElement(Kj,J({dir:f,"data-orientation":"horizontal"},d,{ref:p,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:_=>{const x=b(_.clientX);s==null||s(x)},onSlideMove:_=>{const x=b(_.clientX);a==null||a(x)},onSlideEnd:()=>{m.current=void 0,l==null||l()},onStepKeyDown:_=>{const x=Uj[S?"from-left":"from-right"].includes(_.key);c==null||c({event:_,direction:x?-1:1})}})))}),_te=v.forwardRef((n,e)=>{const{min:t,max:r,inverted:i,onSlideStart:o,onSlideMove:s,onSlideEnd:a,onStepKeyDown:l,...c}=n,d=v.useRef(null),u=Ge(e,d),h=v.useRef(),p=!i;function m(f){const w=h.current||d.current.getBoundingClientRect(),S=[0,w.height],b=C1(S,p?[r,t]:[t,r]);return h.current=w,b(f-w.top)}return v.createElement(Hj,{scope:n.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1},v.createElement(Kj,J({"data-orientation":"vertical"},c,{ref:u,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:f=>{const w=m(f.clientY);o==null||o(w)},onSlideMove:f=>{const w=m(f.clientY);s==null||s(w)},onSlideEnd:()=>{h.current=void 0,a==null||a()},onStepKeyDown:f=>{const w=Uj[p?"from-bottom":"from-top"].includes(f.key);l==null||l({event:f,direction:w?-1:1})}})))}),Kj=v.forwardRef((n,e)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:l,...c}=n,d=Ng(ru,t);return v.createElement(Ae.span,J({},c,{ref:e,onKeyDown:ne(n.onKeyDown,u=>{u.key==="Home"?(s(u),u.preventDefault()):u.key==="End"?(a(u),u.preventDefault()):$j.concat(Bj).includes(u.key)&&(l(u),u.preventDefault())}),onPointerDown:ne(n.onPointerDown,u=>{const h=u.target;h.setPointerCapture(u.pointerId),u.preventDefault(),d.thumbs.has(h)?h.focus():r(u)}),onPointerMove:ne(n.onPointerMove,u=>{u.target.hasPointerCapture(u.pointerId)&&i(u)}),onPointerUp:ne(n.onPointerUp,u=>{const h=u.target;h.hasPointerCapture(u.pointerId)&&(h.releasePointerCapture(u.pointerId),o(u))})}))}),kte="SliderTrack",Cte=v.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=Ng(kte,t);return v.createElement(Ae.span,J({"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation},r,{ref:e}))}),Gj="SliderRange",Pte=v.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=Ng(Gj,t),o=Wj(Gj,t),s=v.useRef(null),a=Ge(e,s),l=i.values.length,c=i.values.map(h=>Xj(h,i.min,i.max)),d=l>1?Math.min(...c):0,u=100-Math.max(...c);return v.createElement(Ae.span,J({"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0},r,{ref:a,style:{...n.style,[o.startEdge]:d+"%",[o.endEdge]:u+"%"}}))}),Yj="SliderThumb",Ete=v.forwardRef((n,e)=>{const t=wte(n.__scopeSlider),[r,i]=v.useState(null),o=Ge(e,a=>i(a)),s=v.useMemo(()=>r?t().findIndex(a=>a.ref.current===r):-1,[t,r]);return v.createElement(Ite,J({},n,{ref:o,index:s}))}),Ite=v.forwardRef((n,e)=>{const{__scopeSlider:t,index:r,...i}=n,o=Ng(Yj,t),s=Wj(Yj,t),[a,l]=v.useState(null),c=Ge(e,w=>l(w)),d=j3(a),u=o.values[r],h=u===void 0?0:Xj(u,o.min,o.max),p=Tte(r,o.values.length),m=d==null?void 0:d[s.size],f=m?Rte(m,h,s.direction):0;return v.useEffect(()=>{if(a)return o.thumbs.add(a),()=>{o.thumbs.delete(a)}},[a,o.thumbs]),v.createElement("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[s.startEdge]:`calc(${h}% + ${f}px)`}},v.createElement(k1.ItemSlot,{scope:n.__scopeSlider},v.createElement(Ae.span,J({role:"slider","aria-label":n["aria-label"]||p,"aria-valuemin":o.min,"aria-valuenow":u,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0},i,{ref:c,style:u===void 0?{display:"none"}:n.style,onFocus:ne(n.onFocus,()=>{o.valueIndexToChangeRef.current=r})}))))}),Mte=n=>{const{value:e,...t}=n,r=v.useRef(null),i=yte(e);return v.useEffect(()=>{const o=r.current,s=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(s,"value").set;if(i!==e&&a){const l=new Event("input",{bubbles:!0});a.call(o,e),o.dispatchEvent(l)}},[i,e]),v.createElement("input",J({style:{display:"none"}},t,{ref:r,defaultValue:e}))};function Ate(n=[],e,t){const r=[...n];return r[t]=e,r.sort((i,o)=>i-o)}function Xj(n,e,t){const r=100/(t-e)*(n-e);return Fj(r,[0,100])}function Tte(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function jte(n,e){if(n.length===1)return 0;const t=n.map(i=>Math.abs(i-e)),r=Math.min(...t);return t.indexOf(r)}function Rte(n,e,t){const r=n/2,i=C1([0,50],[0,r]);return(r-i(e)*t)*t}function Ote(n){return n.slice(0,-1).map((e,t)=>n[t+1]-e)}function Dte(n,e){if(e>0){const t=Ote(n);return Math.min(...t)>=e}return!0}function C1(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(n[1]-n[0]);return e[0]+r*(t-n[0])}}function Lte(n){return(String(n).split(".")[1]||"").length}function zte(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}const Nte=Ste,Fte=Cte,$te=Pte,Bte=Ete,Ute=v.memo(function(n){const{title:e,steps:t,value:r,label:i,onValueChange:o}=n,s=G(),a=Ie(),l=v.useCallback(u=>{o(u[0],!0)},[o]),c=v.useCallback(()=>{s.mark("click slider")},[s]),d=v.useCallback(()=>{r&&o(r,!1)},[r,o]);return g.jsx("div",{className:"tlui-slider__container",children:g.jsxs(Nte,{"data-testid":n["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:t,step:1,value:r?[r]:void 0,onPointerDown:c,onValueChange:l,onPointerUp:d,title:e+" \u2014 "+a(i),children:[g.jsx(Fte,{className:"tlui-slider__track",dir:"ltr",children:r!==null&&g.jsx($te,{className:"tlui-slider__range",dir:"ltr"})}),r!==null&&g.jsx(Bte,{className:"tlui-slider__thumb",dir:"ltr"})]})})}),Vte=v.memo(function({label:n,uiTypeA:e,uiTypeB:t,labelA:r,labelB:i,itemsA:o,itemsB:s,styleA:a,styleB:l,valueA:c,valueB:d,onValueChange:u}){const h=Ie(),p=v.useMemo(()=>{var f;return((f=o.find(w=>c.type==="shared"&&c.value===w.value))==null?void 0:f.icon)??"mixed"},[o,c]),m=v.useMemo(()=>{var f;return((f=s.find(w=>d.type==="shared"&&d.value===w.value))==null?void 0:f.icon)??"mixed"},[s,d]);return c===void 0&&d===void 0?null:g.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[g.jsx("div",{title:h(n),className:"tlui-style-panel__double-select-picker-label",children:h(n)}),g.jsxs("div",{className:"tlui-buttons__horizontal",children:[g.jsxs(us,{id:`style panel ${e} A`,children:[g.jsx(Jd,{asChild:!0,onTouchEnd:f=>Oe(f),children:g.jsx(le,{type:"icon","data-testid":`style.${e}`,title:h(r)+" \u2014 "+(c===null||c.type==="mixed"?h("style-panel.mixed"):h(`${e}-style.${c.value}`)),icon:p,invertIcon:!0,smallIcon:!0})}),g.jsx(hs,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:g.jsx("div",{className:"tlui-buttons__grid",children:o.map(f=>g.jsx(gr,{type:"icon",title:h(r)+" \u2014 "+h(`${e}-style.${f.value}`),"data-testid":`style.${e}.${f.value}`,icon:f.icon,onClick:()=>u(a,f.value,!1),invertIcon:!0},f.value))})})]}),g.jsxs(us,{id:`style panel ${t}`,children:[g.jsx(Jd,{asChild:!0,onTouchEnd:f=>Oe(f),children:g.jsx(le,{type:"icon","data-testid":`style.${t}`,title:h(i)+" \u2014 "+(d===null||d.type==="mixed"?h("style-panel.mixed"):h(`${t}-style.${d.value}`)),icon:m,smallIcon:!0})}),g.jsx(hs,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:g.jsx("div",{className:"tlui-buttons__grid",children:s.map(f=>g.jsx(gr,{type:"icon",title:h(i)+" \u2014 "+h(`${t}-style.${f.value}`),"data-testid":`style.${t}.${f.value}`,icon:f.icon,onClick:()=>u(l,f.value,!1)},f.value))})})]})]})]})}),P1=v.memo(function({id:n,label:e,uiType:t,style:r,items:i,type:o,value:s,onValueChange:a}){const l=Ie(),c=v.useMemo(()=>{var d;return(d=i.find(u=>s.type==="shared"&&u.value===s.value))==null?void 0:d.icon},[i,s]);return g.jsxs(us,{id:`style panel ${n}`,children:[g.jsx(Jd,{asChild:!0,onTouchEnd:d=>Oe(d),children:g.jsx(le,{type:o,"data-testid":`style.${t}`,title:s.type==="mixed"?l("style-panel.mixed"):l(`${t}-style.${s.value}`),label:e,icon:c??"mixed"})}),g.jsx(hs,{side:"left",align:"center",alignOffset:0,children:g.jsx("div",{className:"tlui-buttons__grid",children:i.map(d=>g.jsx(gr,{type:"icon","data-testid":`style.${t}.${d.value}`,title:l(`${t}-style.${d.value}`),icon:d.icon,onClick:()=>a(r,d.value,!1)},d.value))})})]})}),ni={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},qj=function({isMobile:n}){const e=G(),t=Nj(),r=v.useCallback(()=>{n||e.updateInstanceState({isChangingStyle:!1})},[e,n]);if(!t)return null;const{styles:i,opacity:o}=t,s=i.get(yi),a=i.get(fp),l=i.get(pp),c=i.get(yp),d=i.get(gi),u=s===void 0,h=a===void 0&&l===void 0,p=c===void 0,m=d===void 0;return g.jsxs("div",{className:"tlui-style-panel","data-ismobile":n,onPointerLeave:r,children:[g.jsx(Hte,{styles:i,opacity:o}),!m&&g.jsx(Wte,{styles:i}),!(u&&h&&p)&&g.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[g.jsx(Kte,{styles:i}),g.jsx(Yte,{styles:i}),g.jsx(Gte,{styles:i})]})]})};function iu(){const n=G();return re.useMemo(()=>function(e,t,r){n.batch(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(e,t,{squashing:r}),n.setStyleForNextShapes(e,t,{squashing:r}),n.updateInstanceState({isChangingStyle:!0})})},[n])}const ou=[.1,.25,.5,.75,1];function Hte({styles:n,opacity:e}){const t=G(),r=Ie(),i=iu(),o=re.useCallback((h,p)=>{const m=ou[h];t.batch(()=>{t.isIn("select")&&t.setOpacityForSelectedShapes(m,{ephemeral:p}),t.setOpacityForNextShapes(m,{ephemeral:p}),t.updateInstanceState({isChangingStyle:!0})})},[t]),s=n.get(Cr),a=n.get(Ja),l=n.get($s),c=n.get(mi),d=a!==void 0||l!==void 0||c!==void 0,u=e.type==="mixed"?-1:ou.indexOf(iD(ou,h=>Math.abs(h-e.value)));return g.jsxs(g.Fragment,{children:[g.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles",children:[s===void 0?null:g.jsx(Hl,{title:r("style-panel.color"),uiType:"color",style:Cr,items:ni.color,value:s,onValueChange:i}),e===void 0?null:g.jsx(Ute,{"data-testid":"style.opacity",value:u>=0?u:ou.length-1,label:e.type==="mixed"?"style-panel.mixed":`opacity-style.${e.value}`,onValueChange:o,steps:ou.length-1,title:r("style-panel.opacity")})]}),d&&g.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:g.jsx(Hl,{title:r("style-panel.fill"),uiType:"fill",style:Ja,items:ni.fill,value:a,onValueChange:i}),l===void 0?null:g.jsx(Hl,{title:r("style-panel.dash"),uiType:"dash",style:$s,items:ni.dash,value:l,onValueChange:i}),c===void 0?null:g.jsx(Hl,{title:r("style-panel.size"),uiType:"size",style:mi,items:ni.size,value:c,onValueChange:i})]})]})}function Wte({styles:n}){const e=Ie(),t=iu(),r=n.get(gi),i=n.get(Zc),o=n.get(gp);return r===void 0&&i===void 0?null:g.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[r===void 0?null:g.jsx(Hl,{title:e("style-panel.font"),uiType:"font",style:gi,items:ni.font,value:r,onValueChange:t}),i===void 0?null:g.jsxs("div",{className:"tlui-style-panel__row",children:[g.jsx(Hl,{title:e("style-panel.align"),uiType:"align",style:Zc,items:ni.horizontalAlign,value:i,onValueChange:t}),g.jsx("div",{className:"tlui-style-panel__row__extra-button",children:o===void 0?g.jsx(le,{type:"icon",title:e("style-panel.vertical-align"),"data-testid":"vertical-align",icon:"vertical-align-center",disabled:!0}):g.jsx(P1,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:gp,items:ni.verticalAlign,value:o,onValueChange:t})})]})]})}function Kte({styles:n}){const e=iu(),t=n.get(yi);return t===void 0?null:g.jsx(P1,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:yi,items:ni.geo,value:t,onValueChange:e})}function Gte({styles:n}){const e=iu(),t=n.get(yp);return t===void 0?null:g.jsx(P1,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:yp,items:ni.spline,value:t,onValueChange:e})}function Yte({styles:n}){const e=iu(),t=n.get(fp),r=n.get(pp);return!t||!r?null:g.jsx(Vte,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:pp,itemsA:ni.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:fp,itemsB:ni.arrowheadEnd,valueB:t,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}function Xte({toast:n}){const{removeToast:e}=Pi(),t=Ie(),r=o=>{o||e(n.id)},i=n.actions&&n.actions.length>0;return g.jsxs(RX,{onOpenChange:r,className:"tlui-toast__container",duration:n.keepOpen?1/0:5e3,children:[n.icon&&g.jsx("div",{className:"tlui-toast__icon",children:g.jsx(hr,{icon:n.icon})}),g.jsxs("div",{className:"tlui-toast__main",children:[g.jsxs("div",{className:"tlui-toast__content",children:[n.title&&g.jsx(OX,{className:"tlui-toast__title",children:n.title}),n.description&&g.jsx(DX,{className:"tlui-toast__description",children:n.description})]}),n.actions&&g.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((o,s)=>g.jsx(LX,{altText:o.label,asChild:!0,onClick:o.onClick,children:g.jsx(le,{type:o.type,children:o.label})},s)),g.jsx(JA,{asChild:!0,children:g.jsx(le,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:n.closeLabel??t("toast.close")})})]})]}),!i&&g.jsx(JA,{asChild:!0,children:g.jsx(le,{type:"normal",className:"tlui-toast__close",children:n.closeLabel??t("toast.close")})})]})}function qte(){const{toasts:n}=Pi();return g.jsx(g.Fragment,{children:n.map(e=>g.jsx(Xte,{toast:e},e.id))})}const Jte=v.memo(qte);function Zte(){const{toasts:n}=Pi(),[e,t]=v.useState(!1);return v.useEffect(()=>{let r=!1;return n.length?t(!0):setTimeout(()=>{r||t(!1)},1e3),()=>{r=!0}},[n.length,t]),e?g.jsx(mX,{className:"tlui-toast__viewport"}):null}function Qte(){var a;const n=G(),e=Ie(),t=(a=Nj())==null?void 0:a.styles.get(Cr),r=Vn({isDarkMode:n.user.getIsDarkMode()}),i=((t==null?void 0:t.type)==="shared"?r[t.value]:r.black).solid,o=q("isHandOrEraserToolActive",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),s=v.useCallback(l=>{l||n.updateInstanceState({isChangingStyle:!1})},[n]);return g.jsxs(v1,{id:"style menu",onOpenChange:s,children:[g.jsx(S1,{disabled:o,children:g.jsx(le,{type:"tool","data-testid":"mobile.styles",style:{color:o?"var(--color-muted-1)":i},title:e("style-panel.title"),children:g.jsx(hr,{icon:o?"blob":(t==null?void 0:t.type)==="mixed"?"mixed":"blob"})})}),g.jsx(Tj,{side:"top",align:"end",children:g.jsx(qj,{isMobile:!0})})]})}const ene=["select","hand","draw","eraser","text","zoom","laser","highlight"];function tne({activeToolId:n}){const e=G(),t=Tr(),r=Ie(),i=q("is tool locked",()=>e.getInstanceState().isToolLocked,[e]);return!n||ene.includes(n)?null:g.jsx(le,{type:"normal",title:r("action.toggle-tool-lock"),className:ye("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":t<5}),icon:i?"lock":"unlock",onClick:()=>e.updateInstanceState({isToolLocked:!i}),smallIcon:!0})}const nne=v.memo(function(){const n=G(),e=Ie(),t=Tr(),r=re.useRef(void 0),i=Ir(),o=aZ(),s=o.find(f=>f.toolItem.id==="laser"),a=q("current tool id",()=>n.getCurrentToolId(),[n]),l=q("geo",()=>n.getSharedStyles().getAsKnownValue(yi),[n]),c=!i,d=f=>f.label?`${e(f.label)} ${f.kbd?ki(f.kbd):""}`:"",u=o.find(f=>Wl(f.toolItem,a,l)),{itemsInPanel:h,itemsInDropdown:p,dropdownFirstItem:m}=re.useMemo(()=>{const f=[],w=[];let S;const b=Math.min(8,5+t);for(let _=4;_<o.length;_++){const x=o[_];_<b?f.push(x):(x===u&&(S=x),w.push(x))}return S||(r.current||(r.current=w[0]),S=r.current,w.includes(S)||(S=w[0])),r.current=S,w.length<=2&&(f.push(...w),w.length=0),{itemsInPanel:f,itemsInDropdown:w,dropdownFirstItem:S}},[o,u,t]);return g.jsx("div",{className:"tlui-toolbar",children:g.jsxs("div",{className:"tlui-toolbar__inner",children:[g.jsxs("div",{className:"tlui-toolbar__left",children:[!i&&g.jsxs("div",{className:"tlui-toolbar__extras",children:[t<6&&!(a==="hand"||a==="zoom")&&g.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[g.jsx(zj,{}),g.jsx(Dj,{}),g.jsx(Lj,{}),g.jsx(Rj,{}),g.jsx(jj,{})]}),g.jsx(tne,{activeToolId:a})]}),g.jsxs("div",{className:ye("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":t<5}),children:[o.slice(0,2).map(({toolItem:f})=>g.jsx(su,{item:f,title:d(f),isSelected:Wl(f,a,l)},f.id)),i&&s&&g.jsx(su,{item:s.toolItem,title:d(s.toolItem),isSelected:Wl(s.toolItem,a,l)},s.toolItem.id),c&&g.jsxs(g.Fragment,{children:[o.slice(2,4).map(({toolItem:f})=>g.jsx(su,{item:f,title:d(f),isSelected:Wl(f,a,l)},f.id)),h.map(({toolItem:f})=>g.jsx(su,{item:f,title:d(f),isSelected:Wl(f,a,l)},f.id)),p.length?g.jsxs(g.Fragment,{children:[g.jsx(su,{item:m.toolItem,title:d(m.toolItem),isSelected:Wl(m.toolItem,a,l)},m.toolItem.id),g.jsxs(us,{id:"toolbar overflow",modal:!1,children:[g.jsx(Zd,{children:g.jsx(le,{className:"tlui-toolbar__overflow",icon:"chevron-up",type:"tool","data-testid":"tools.more",title:e("tool-panel.more")})}),g.jsx(hs,{side:"top",align:"center",children:g.jsx(rne,{toolbarItems:p})})]})]}):null]})]})]}),t<5&&!i&&g.jsx("div",{className:"tlui-toolbar__tools",children:g.jsx(Qte,{})})]})})}),rne=ze(function({toolbarItems:n}){const e=Ie();return g.jsx("div",{className:"tlui-buttons__grid",children:n.map(({toolItem:{id:t,meta:r,kbd:i,label:o,onSelect:s,icon:a}})=>g.jsx(gr,{type:"icon",className:"tlui-button-grid__button","data-testid":`tools.more.${t}`,"data-tool":t,"data-geo":(r==null?void 0:r.geo)??"","aria-label":o,onClick:()=>s("toolbar"),title:o?`${e(o)} ${i?ki(i):""}`:"",icon:a},t))})});function su({item:n,title:e,isSelected:t}){var r;return g.jsx(le,{type:"tool","data-testid":`tools.${n.id}`,"data-tool":n.id,"data-geo":((r=n.meta)==null?void 0:r.geo)??"","aria-label":n.label,title:e,icon:n.icon,"data-state":t?"selected":void 0,onClick:()=>n.onSelect("toolbar"),onTouchStart:i=>{Oe(i),n.onSelect("toolbar")}})}const Wl=(n,e,t)=>{var r,i;return(r=n.meta)!=null&&r.geo?e==="geo"&&t===((i=n.meta)==null?void 0:i.geo):e===n.id};function ine(){const n=G(),{addToast:e}=Pi();v.useEffect(()=>{function t({name:r,count:i}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${i}). Please delete some shapes or move to a different page to continue.`})}return n.addListener("max-shapes",t),()=>{n.removeListener("max-shapes",t)}},[n,e])}var E1=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function I1(n,e,t,r){n.addEventListener?n.addEventListener(e,t,r):n.attachEvent&&n.attachEvent("on".concat(e),function(){t(window.event)})}function Jj(n,e){for(var t=e.slice(0,e.length-1),r=0;r<t.length;r++)t[r]=n[t[r].toLowerCase()];return t}function Zj(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");for(var e=n.split(","),t=e.lastIndexOf("");t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function one(n,e){for(var t=n.length>=e.length?n:e,r=n.length>=e.length?e:n,i=!0,o=0;o<t.length;o++)r.indexOf(t[o])===-1&&(i=!1);return i}for(var au={backspace:8,"\u232B":8,tab:9,clear:12,enter:13,"\u21A9":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"\u21EA":20,",":188,".":190,"/":191,"`":192,"-":E1?173:189,"=":E1?61:187,";":E1?59:186,"'":222,"[":219,"]":221,"\\":220},Mi={"\u21E7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,cmd:91,command:91},M1={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Qt={16:!1,18:!1,17:!1,91:!1},Ct={},Fg=1;Fg<20;Fg++)au["f".concat(Fg)]=111+Fg;var it=[],Qj=!1,eR="all",tR=[],lu=function(n){return au[n.toLowerCase()]||Mi[n.toLowerCase()]||n.toUpperCase().charCodeAt(0)},sne=function(n){return Object.keys(au).find(function(e){return au[e]===n})},ane=function(n){return Object.keys(Mi).find(function(e){return Mi[e]===n})};function nR(n){eR=n||"all"}function cu(){return eR||"all"}function lne(){return it.slice(0)}function cne(){return it.map(function(n){return sne(n)||ane(n)||String.fromCharCode(n)})}function dne(){var n=[];return Object.keys(Ct).forEach(function(e){Ct[e].forEach(function(t){var r=t.key,i=t.scope,o=t.mods,s=t.shortcut;n.push({scope:i,shortcut:s,mods:o,keys:r.split("+").map(function(a){return lu(a)})})})}),n}function une(n){var e=n.target||n.srcElement,t=e.tagName,r=!0;return(e.isContentEditable||(t==="INPUT"||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(r=!1),r}function hne(n){return typeof n=="string"&&(n=lu(n)),it.indexOf(n)!==-1}function pne(n,e){var t,r;n||(n=cu());for(var i in Ct)if(Object.prototype.hasOwnProperty.call(Ct,i))for(t=Ct[i],r=0;r<t.length;)t[r].scope===n?t.splice(r,1):r++;cu()===n&&nR(e||"all")}function fne(n){var e=n.keyCode||n.which||n.charCode,t=it.indexOf(e);if(t>=0&&it.splice(t,1),n.key&&n.key.toLowerCase()==="meta"&&it.splice(0,it.length),(e===93||e===224)&&(e=91),e in Qt){Qt[e]=!1;for(var r in Mi)Mi[r]===e&&(ri[r]=!1)}}function gne(n){if(typeof n>"u")Object.keys(Ct).forEach(function(s){return delete Ct[s]});else if(Array.isArray(n))n.forEach(function(s){s.key&&A1(s)});else if(typeof n=="object")n.key&&A1(n);else if(typeof n=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];var i=t[0],o=t[1];typeof i=="function"&&(o=i,i=""),A1({key:n,scope:i,method:o,splitKey:"+"})}}var A1=function(n){var e=n.key,t=n.scope,r=n.method,i=n.splitKey,o=i===void 0?"+":i,s=Zj(e);s.forEach(function(a){var l=a.split(o),c=l.length,d=l[c-1],u=d==="*"?"*":lu(d);if(Ct[u]){t||(t=cu());var h=c>1?Jj(Mi,l):[];Ct[u]=Ct[u].filter(function(p){var m=r?p.method===r:!0;return!(m&&p.scope===t&&one(p.mods,h))})}})};function rR(n,e,t,r){if(e.element===r){var i;if(e.scope===t||e.scope==="all"){i=e.mods.length>0;for(var o in Qt)Object.prototype.hasOwnProperty.call(Qt,o)&&(!Qt[o]&&e.mods.indexOf(+o)>-1||Qt[o]&&e.mods.indexOf(+o)===-1)&&(i=!1);(e.mods.length===0&&!Qt[16]&&!Qt[18]&&!Qt[17]&&!Qt[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(it),e.method(n,e)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}}function iR(n,e){var t=Ct["*"],r=n.keyCode||n.which||n.charCode;if(ri.filter.call(this,n)){if((r===93||r===224)&&(r=91),it.indexOf(r)===-1&&r!==229&&it.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(m){var f=M1[m];n[m]&&it.indexOf(f)===-1?it.push(f):!n[m]&&it.indexOf(f)>-1?it.splice(it.indexOf(f),1):m==="metaKey"&&n[m]&&it.length===3&&(n.ctrlKey||n.shiftKey||n.altKey||(it=it.slice(it.indexOf(f))))}),r in Qt){Qt[r]=!0;for(var i in Mi)Mi[i]===r&&(ri[i]=!0);if(!t)return}for(var o in Qt)Object.prototype.hasOwnProperty.call(Qt,o)&&(Qt[o]=n[M1[o]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(it.indexOf(17)===-1&&it.push(17),it.indexOf(18)===-1&&it.push(18),Qt[17]=!0,Qt[18]=!0);var s=cu();if(t)for(var a=0;a<t.length;a++)t[a].scope===s&&(n.type==="keydown"&&t[a].keydown||n.type==="keyup"&&t[a].keyup)&&rR(n,t[a],s,e);if(r in Ct){for(var l=0;l<Ct[r].length;l++)if((n.type==="keydown"&&Ct[r][l].keydown||n.type==="keyup"&&Ct[r][l].keyup)&&Ct[r][l].key){for(var c=Ct[r][l],d=c.splitKey,u=c.key.split(d),h=[],p=0;p<u.length;p++)h.push(lu(u[p]));h.sort().join("")===it.sort().join("")&&rR(n,c,s,e)}}}}function mne(n){return tR.indexOf(n)>-1}function ri(n,e,t){it=[];var r=Zj(n),i=[],o="all",s=document,a=0,l=!1,c=!0,d="+",u=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(o=e.scope),e.element&&(s=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(u=e.capture),typeof e.splitKey=="string"&&(d=e.splitKey)),typeof e=="string"&&(o=e);a<r.length;a++)n=r[a].split(d),i=[],n.length>1&&(i=Jj(Mi,n)),n=n[n.length-1],n=n==="*"?"*":lu(n),n in Ct||(Ct[n]=[]),Ct[n].push({keyup:l,keydown:c,scope:o,mods:i,shortcut:r[a],method:t,key:r[a],splitKey:d,element:s});typeof s<"u"&&!mne(s)&&window&&(tR.push(s),I1(s,"keydown",function(h){iR(h,s)},u),Qj||(Qj=!0,I1(window,"focus",function(){it=[]},u)),I1(s,"keyup",function(h){iR(h,s),fne(h)},u))}function yne(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Ct).forEach(function(t){var r=Ct[t].filter(function(i){return i.scope===e&&i.shortcut===n});r.forEach(function(i){i&&i.method&&i.method()})})}var T1={getPressedKeyString:cne,setScope:nR,getScope:cu,deleteScope:pne,getPressedKeyCodes:lne,getAllKeyCodes:dne,isPressed:hne,filter:une,trigger:yne,unbind:gne,keyMap:au,modifier:Mi,modifierMap:M1};for(var j1 in T1)Object.prototype.hasOwnProperty.call(T1,j1)&&(ri[j1]=T1[j1]);if(typeof window<"u"){var wne=window.hotkeys;ri.noConflict=function(n){return n&&window.hotkeys===ri&&(window.hotkeys=wne),ri},window.hotkeys=ri}const oR=["copy","cut","paste","asset"];function bne(){const n=G(),e=Ir(),t=bn(),r=Xv(),i=q("is focused",()=>n.getInstanceState().isFocused,[n]);v.useEffect(()=>{if(!i)return;const o=n.getContainer();ri.setScope(n.store.id);const s=(l,c)=>{ri(l,{element:o,scope:n.store.id},c)},a=()=>n.getIsMenuOpen()||n.getEditingShapeId()!==null||n.getCrashingError();for(const l of Object.values(t))l.kbd&&(e&&!l.readonlyOk||oR.includes(l.id)||s(sR(l.kbd),c=>{a()||(Oe(c),l.onSelect("kbd"))}));for(const l of Object.values(r))!l.kbd||!l.readonlyOk&&n.getInstanceState().isReadonly||oR.includes(l.id)||s(sR(l.kbd),c=>{a()||(Oe(c),l.onSelect("kbd"))});return()=>{ri.deleteScope(n.store.id)}},[t,r,e,n,i])}function sR(n){return vne(n).map(e=>{let t="";const r=e.split("");return r.length===1?t=r[0]:r[0]==="!"?t=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?t=`alt+shift+${r[2]}`:t=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?t=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?t=`cmd+\u2325+${r[2]},ctrl+alt+${r[2]}`:t=`cmd+${r[1]},ctrl+${r[1]}`:t=e,t}).join(",")}function vne(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}const Sne=re.memo(function({shareZone:n,topZone:e,renderDebugMenuItems:t,children:r,hideUi:i,...o}){return g.jsx(hZ,{...o,children:g.jsx(xne,{hideUi:i,shareZone:n,topZone:e,renderDebugMenuItems:t,children:r})})}),xne=re.memo(function({children:n,hideUi:e,...t}){return g.jsxs(g.Fragment,{children:[n,e?null:g.jsx(_ne,{...t})]})}),_ne=re.memo(function({shareZone:n,topZone:e,renderDebugMenuItems:t}){const r=G(),i=Ie(),o=Tr(),s=q("isReadonlyMode",()=>r.getInstanceState().isReadonly,[r]),a=q("focus",()=>r.getInstanceState().isFocusMode,[r]),l=q("debug",()=>r.getInstanceState().isDebugMode,[r]);bne(),AJ(),ine();const{"toggle-focus-mode":c}=bn();return g.jsx(VA,{children:g.jsxs("div",{className:ye("tlui-layout",{"tlui-layout__mobile":o<5}),"data-breakpoint":o,children:[a?g.jsx("div",{className:"tlui-layout__top",children:g.jsx(le,{type:"icon",className:"tlui-focus-button",title:`${i("focus-mode.toggle-focus-mode")}`,icon:"dot",onClick:()=>c.onSelect("menu")})}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"tlui-layout__top",children:[g.jsxs("div",{className:"tlui-layout__top__left",children:[g.jsx(cte,{}),g.jsxs("div",{className:"tlui-helper-buttons",children:[g.jsx(pte,{}),g.jsx(fZ,{}),g.jsx(fte,{})]})]}),g.jsx("div",{className:"tlui-layout__top__center",children:e}),g.jsxs("div",{className:"tlui-layout__top__right",children:[n,o>=5&&!s&&g.jsx("div",{className:"tlui-style-panel__wrapper",children:g.jsx(qj,{})})]})]}),g.jsxs("div",{className:"tlui-layout__bottom",children:[g.jsxs("div",{className:"tlui-layout__bottom__main",children:[g.jsx(hte,{}),g.jsx(nne,{}),o>=4&&g.jsx(Nee,{})]}),l&&g.jsx(Eee,{renderDebugMenuItems:t??null})]})]}),g.jsx(Jte,{}),g.jsx(Dee,{}),g.jsx(Zte,{}),g.jsx(Lee,{})]})})}),aR="ContextMenu",[kne,Bue]=_i(aR,[Og]),Ai=Og(),[Cne,lR]=kne(aR),Pne=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,dir:i,modal:o=!0}=n,[s,a]=v.useState(!1),l=Ai(e),c=kt(r),d=v.useCallback(u=>{a(u),c(u)},[c]);return v.createElement(Cne,{scope:e,open:s,onOpenChange:d,modal:o},v.createElement(rj,J({},l,{dir:i,open:s,onOpenChange:d,modal:o}),t))},Ene="ContextMenuTrigger",Ine=v.forwardRef((n,e)=>{const{__scopeContextMenu:t,disabled:r=!1,...i}=n,o=lR(Ene,t),s=Ai(t),a=v.useRef({x:0,y:0}),l=v.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=v.useRef(0),d=v.useCallback(()=>window.clearTimeout(c.current),[]),u=h=>{a.current={x:h.clientX,y:h.clientY},o.onOpenChange(!0)};return v.useEffect(()=>d,[d]),v.useEffect(()=>void(r&&d()),[r,d]),v.createElement(v.Fragment,null,v.createElement(ij,J({},s,{virtualRef:l})),v.createElement(Ae.span,J({"data-state":o.open?"open":"closed","data-disabled":r?"":void 0},i,{ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:r?n.onContextMenu:ne(n.onContextMenu,h=>{d(),u(h),h.preventDefault()}),onPointerDown:r?n.onPointerDown:ne(n.onPointerDown,$g(h=>{d(),c.current=window.setTimeout(()=>u(h),700)})),onPointerMove:r?n.onPointerMove:ne(n.onPointerMove,$g(d)),onPointerCancel:r?n.onPointerCancel:ne(n.onPointerCancel,$g(d)),onPointerUp:r?n.onPointerUp:ne(n.onPointerUp,$g(d))})))}),Mne=n=>{const{__scopeContextMenu:e,...t}=n,r=Ai(e);return v.createElement(oj,J({},r,t))},Ane="ContextMenuContent",Tne=v.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=lR(Ane,t),o=Ai(t),s=v.useRef(!1);return v.createElement(sj,J({},o,r,{ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var l;(l=n.onCloseAutoFocus)===null||l===void 0||l.call(n,a),!a.defaultPrevented&&s.current&&a.preventDefault(),s.current=!1},onInteractOutside:a=>{var l;(l=n.onInteractOutside)===null||l===void 0||l.call(n,a),!a.defaultPrevented&&!i.modal&&(s.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),jne=v.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ai(t);return v.createElement(aj,J({},i,r,{ref:e}))}),Rne=v.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ai(t);return v.createElement(lj,J({},i,r,{ref:e}))}),One=v.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ai(t);return v.createElement(cj,J({},i,r,{ref:e}))}),Dne=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,open:i,defaultOpen:o}=n,s=Ai(e),[a,l]=os({prop:i,defaultProp:o,onChange:r});return v.createElement(dj,J({},s,{open:a,onOpenChange:l}),t)},Lne=v.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ai(t);return v.createElement(uj,J({},i,r,{ref:e}))}),zne=v.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ai(t);return v.createElement(hj,J({},i,r,{ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))});function $g(n){return e=>e.pointerType!=="mouse"?n(e):void 0}const Nne=Pne,Fne=Ine,R1=Mne,$ne=Tne,O1=jne,D1=Rne,Bne=One,cR=Dne,dR=Lne,uR=zne,Une=ze(function(){const n=G(),e=hn(),t=n.getPages(),r=n.getCurrentPageId(),i=Ie(),{addToast:o}=Pi();return g.jsxs(cR,{children:[g.jsx(dR,{dir:"ltr",asChild:!0,children:g.jsx(le,{type:"menu",label:"context-menu.move-to-page","data-testid":"menu-item.move-to-page",icon:"chevron-right"})}),g.jsx(R1,{container:e,children:g.jsxs(uR,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:[g.jsx(O1,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.pages",children:t.map(s=>g.jsx(D1,{disabled:r===s.id,onSelect:()=>{n.mark("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),s.id);const a=n.getPage(s.id);a&&o({title:"Changed Page",description:`Moved to ${a.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.mark("change-page"),n.setCurrentPage(r)}}]})},asChild:!0,children:g.jsx(le,{type:"menu",title:s.name,className:"tlui-context-menu__move-to-page__name",children:g.jsx("span",{className:"tlui-button__label",children:s.name})})},s.id))},"pages"),g.jsx(O1,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.new-page",children:g.jsx(D1,{onSelect:()=>{const s=Ji.createId(),a=n.getSelectedShapeIds();n.batch(()=>{n.mark("move_shapes_to_page"),n.createPage({name:i("page-menu.new-page-initial-name"),id:s}),n.moveShapesToPage(a,s)})},asChild:!0,children:g.jsx(le,{type:"menu",title:i("context.pages.new-page"),className:"tlui-context-menu__move-to-page__name",children:g.jsx("span",{className:"tlui-button__label",children:i("context.pages.new-page")})})},"new-page")},"new-page")]})})]})}),Vne=function({children:n}){const e=G(),t=t3(),r=v.useCallback(c=>{if(c){if(e.getInstanceState().isCoarsePointer){const d=e.getSelectedShapes(),{inputs:{currentPagePoint:u}}=e,h=e.getShapesAtPoint(u);if(!e.getSelectedShapes().length||!h.some(p=>d.includes(p))){const p=h.filter(m=>e.isShapeOrAncestorLocked(m));p.length&&e.select(...p.map(m=>m.id))}}}else{const d=e.getOnlySelectedShape();d&&e.isShapeOrAncestorLocked(d)&&e.setSelectedShapes([])}},[e]),[i,o]=ra("context menu",r),s=Ir(),a=t.length===0||s&&t.every(c=>!c.readonlyOk),l=!q("isSelectToolActive",()=>e.getCurrentToolId()==="select",[e])||a;return g.jsxs(Nne,{dir:"ltr",onOpenChange:o,modal:!1,children:[g.jsx(Fne,{onContextMenu:l?Oe:void 0,dir:"ltr",disabled:l,children:n}),i&&g.jsx(Hne,{})]})},Hne=v.forwardRef(function(){const n=G(),e=Ie(),t=t3(),[r,i]=ra("context menu sub"),o=Ir(),s=Tr(),a=hn(),[l,c]=v.useState(!1);function d(u,h,p,m){if(!h||o&&!h.readonlyOk)return null;switch(h.type){case"custom":{switch(h.id){case"MOVE_TO_PAGE_MENU":return g.jsx(Une,{},h.id)}break}case"group":return g.jsx(O1,{dir:"ltr",className:ye("tlui-menu__group",{"tlui-menu__group__small":(p==null?void 0:p.type)==="submenu"}),"data-testid":`menu-item.${h.id}`,children:h.children.map(f=>d(u,f,h,m+1))},h.id);case"submenu":return g.jsxs(cR,{onOpenChange:i,children:[g.jsx(dR,{dir:"ltr",disabled:h.disabled,asChild:!0,children:g.jsx(le,{type:"menu",label:h.label,"data-testid":`menu-item.${h.id}`,icon:"chevron-right"})}),g.jsx(R1,{container:a,children:g.jsx(uR,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:h.children.map(f=>d(u,f,h,m+1))})})]},h.id);case"item":{if(o&&!h.readonlyOk)return null;const{id:f,checkbox:w,contextMenuLabel:S,label:b,onSelect:_,kbd:x,icon:P}=h.actionItem,C=S??b,E=C?e(C):void 0;return w?g.jsxs(Bne,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",disabled:h.disabled,onSelect:I=>{_("context-menu"),Oe(I)},title:E||void 0,checked:h.checked,children:[g.jsx(hr,{small:!0,icon:h.checked?"check":"checkbox-empty"}),E&&g.jsx("span",{className:"tlui-button__label",draggable:!1,children:E}),x&&g.jsx(ag,{children:x})]},f):g.jsx(D1,{dir:"ltr",asChild:!0,children:g.jsx(le,{type:"menu","data-testid":`menu-item.${f}`,kbd:x,label:C,disabled:h.disabled,iconLeft:s<3&&m>2?P:void 0,onClick:()=>{l?c(!1):_("context-menu")}})},f)}}}return g.jsx(R1,{container:a,children:g.jsx($ne,{className:"tlui-menu scrollable",alignOffset:-4,collisionPadding:4,onContextMenu:Oe,children:t.map(u=>d(n,u,null,0))})})}),Bg=(n,e)=>{const[t,r]=v.useState(2);return v.useEffect(()=>{const{url:i,style:o="normal",weight:s="500",display:a,featureSettings:l,stretch:c,unicodeRange:d,variant:u}=e;let h=!1;r(2);const p={style:o,weight:s,display:a,featureSettings:l,stretch:c,unicodeRange:d,variant:u},m=new FontFace(n,`url(${i})`,p);return m.load().then(()=>{h||(document.fonts.add(m),r(0))}).catch(f=>{h||(console.error(f),r(1))}),m.$$_url=i,m.$$_fontface=`
@font-face {
	font-family: ${m.family};
	font-stretch: ${m.stretch};
	font-weight: ${m.weight};
	font-style: ${m.style};
	src: url("${i}") format("woff2")
}`,()=>{document.fonts.delete(m),h=!0}},[n,e]),t};function Wne(n){return{draw:{url:n.fonts.draw},serif:{url:n.fonts.serif},sansSerif:{url:n.fonts.sansSerif},monospace:{url:n.fonts.monospace}}}function Kne(n){const e=v.useMemo(()=>Wne(n),[n]),t=[Bg("tldraw_draw",e.draw),Bg("tldraw_serif",e.serif),Bg("tldraw_sans",e.sansSerif),Bg("tldraw_mono",e.monospace)];return{error:t.some(r=>r===1),done:!t.some(r=>r===2)}}function Gne(n){const{children:e,maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s,...a}=n,l=l7(a.components??{}),c=aE(a.shapeUtils??[]),d=aE(a.tools??[]),u={initialState:"select",...a,components:v.useMemo(()=>({Scribble:sM,CollaboratorScribble:sM,SelectionForeground:bK,SelectionBackground:yK,Handles:uK,HoveredShapeIndicator:hK,...l}),[l]),shapeUtils:v.useMemo(()=>[...jY,...c],[c]),tools:v.useMemo(()=>[...KY,...uG,...d],[d])},h=zX(a.assetUrls),{done:p,error:m}=Kne(h);return m?g.jsx(i7,{children:"Could not load assets. Please refresh the page."}):p?g.jsx(e7,{...u,children:g.jsxs(Sne,{...u,children:[g.jsx(Vne,{children:g.jsx(vw,{})}),g.jsx(Yne,{maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s}),e]})}):g.jsx(iE,{children:"Loading assets..."})}function Yne({maxImageDimension:n=1e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:t=["image/jpeg","image/png","image/gif","image/svg+xml"],acceptedVideoMimeTypes:r=["video/mp4","video/quicktime"],onMount:i}){const o=G(),s=Xne(a=>{const l=[];return l.push(...RY(a)),ZK(a,{maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:r}),l.push(i==null?void 0:i(a)),()=>{l.forEach(c=>c==null?void 0:c())}});return v.useLayoutEffect(()=>{if(o)return s==null?void 0:s(o)},[o,s]),null}function Xne(n){const e=v.useRef();return v.useLayoutEffect(()=>{e.current=n}),v.useDebugValue(n),v.useCallback((...t)=>{const r=e.current;return Ls(r,"fn does not exist"),r(...t)},[])}Me({tldrawFileFormatVersion:ID,schema:Me({schemaVersion:sp,storeVersion:sp,recordVersions:K0(Se,Me({version:sp,subTypeVersions:K0(Se,sp).optional(),subTypeKey:Se.optional()}))}),records:En(Me({id:Se,typeName:Se}).allowUnknownProperties())});class qne{constructor(e){this.shapes=new Map,this.listeners=new Set,this.editor=e}onAdd(e){}onRemove(e){}onMembershipChange(){}onShapeChange(e,t){}add(e){e.forEach(t=>{this.shapes.set(t.id,t)}),this.onAdd(e),this.onMembershipChange(),this.notifyListeners()}remove(e){e.forEach(t=>{this.shapes.delete(t.id)}),this.onRemove(e),this.onMembershipChange(),this.notifyListeners()}clear(){this.remove([...this.shapes.values()])}getShapes(){return this.shapes}get size(){return this.shapes.size}_onShapeChange(e,t){this.shapes.set(t.id,t),this.onShapeChange(e,t),this.notifyListeners()}notifyListeners(){for(const e of this.listeners)e()}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}}const hR=v.createContext(void 0),Jne=({editor:n,collections:e,children:t})=>{const[r,i]=v.useState(null),o=(l,c)=>{if(r)for(const d of r.values())d.getShapes().has(c.id)&&d._onShapeChange(l,c)},s=l=>{if(r)for(const c of r.values())c.remove([l])};v.useEffect(()=>{if(n){const l=new Map;for(const c of e){const d=new c(n);l.set(d.id,d)}i(l)}},[n,e]),v.useEffect(()=>{n&&r&&(n.store.onAfterChange=(l,c)=>{c.typeName==="shape"&&o(l,c)})},[n,r]),v.useEffect(()=>{n&&r&&(n.store.onAfterDelete=(l,c)=>{l.typeName==="shape"&&s(l)})},[n,r]);const a=v.useMemo(()=>({get:l=>r==null?void 0:r.get(l)}),[r]);return g.jsx(hR.Provider,{value:a,children:r?t:null})},Zne=n=>{const e=v.useContext(hR);if(!e)throw new Error("CollectionContext not found.");const t=e.get(n);if(!t)throw new Error(`Collection with id '${n}' not found`);const[r,i]=v.useState(t.size);return v.useEffect(()=>{const o=t.subscribe(()=>{i(t.size)});return i(t.size),o},[t]),{collection:t,size:r}},Qne=ze(()=>{const n=G(),{collection:e,size:t}=Zne("physics"),r=()=>{e&&(e.add(n.getSelectedShapes()),n.selectNone())},i=()=>{e&&(e.remove(n.getSelectedShapes()),n.selectNone())},o=()=>{e&&(t===0?e.add(n.getCurrentPageShapes()):e.clear())},s=()=>{alert(`Use the 'Add' and 'Remove' buttons to add/remove selected shapes, or hit 'P' to add/remove all shapes. 

Use the highlight button (\u{1F526}) to visualize shapes in the simulation. 

Shapes' physical properties vary by color (Orange is bouncy, Blue is slippery, Violet is a keyboard-controlled character, etc). 

You can group shapes for compound rigidbodies. 

For more details, check the project's README.`)},a=()=>{e&&n.setHintingShapes([...e.getShapes().values()])};return v.useEffect(()=>(window.addEventListener("togglePhysicsEvent",o),()=>{window.removeEventListener("togglePhysicsEvent",o)}),[o]),g.jsx("div",{className:"custom-layout",children:g.jsxs("div",{className:"custom-toolbar",children:[g.jsxs("div",{children:[g.jsx("button",{type:"button",title:"Add Selected",className:"custom-button",onClick:r,children:"Add"}),g.jsx("button",{type:"button",title:"Remove Selected",className:"custom-button",onClick:i,children:"Remove"}),g.jsx("button",{type:"button",title:"Highlight Collection",className:"custom-button",onClick:a,children:"\u{1F526}"}),g.jsx("button",{type:"button",title:"Show Help",className:"custom-button",onClick:s,children:"\u2049\uFE0F"})]}),g.jsxs("span",{children:[t," shapes"]})]})})}),ere={actions(n,e){return e["toggle-physics"]={id:"toggle-physics",label:"Toggle Physics",readonlyOk:!0,kbd:"p",onSelect(t){const r=new CustomEvent("togglePhysicsEvent");window.dispatchEvent(r)}},e},keyboardShortcutsMenu(n,e,{actions:t}){return e.find(r=>r.id==="shortcuts-dialog.tools").children.push($(t["toggle-physics"])),e}},tre=""+new URL("rapier_wasm2d_bg-b5dc53dc.wasm",import.meta.url).href,nre=async(n={},e)=>{let t;if(e.startsWith("data:")){const r=e.replace(/^data:.*?base64,/,"");let i;if(typeof Buffer=="function"&&typeof Buffer.from=="function")i=Buffer.from(r,"base64");else if(typeof atob=="function"){const o=atob(r);i=new Uint8Array(o.length);for(let s=0;s<o.length;s++)i[s]=o.charCodeAt(s)}else throw new Error("Cannot decode base64-encoded data URL");t=await WebAssembly.instantiate(i,n)}else{const r=await fetch(e),i=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&i.startsWith("application/wasm"))t=await WebAssembly.instantiateStreaming(r,n);else{const o=await r.arrayBuffer();t=await WebAssembly.instantiate(o,n)}}return t.instance.exports},je=new Array(32).fill(void 0);je.push(void 0,null,!0,!1);function $e(n){return je[n]}let du=je.length;function rre(n){n<36||(je[n]=du,du=n)}function Ug(n){const e=$e(n);return rre(n),e}function jt(n){du===je.length&&je.push(je.length+1);const e=du;return du=je[e],je[e]=n,e}function ce(n){return n==null}let L1=new Float64Array;function Vg(){return L1.byteLength===0&&(L1=new Float64Array(Gl.buffer)),L1}let z1=new Int32Array;function ht(){return z1.byteLength===0&&(z1=new Int32Array(Gl.buffer)),z1}const ire=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let pR=new ire("utf-8",{ignoreBOM:!0,fatal:!0});pR.decode();let N1=new Uint8Array;function ore(){return N1.byteLength===0&&(N1=new Uint8Array(Gl.buffer)),N1}function fR(n,e){return pR.decode(ore().subarray(n,n+e))}function sre(){try{const t=De(-16);Are(t);var n=ht()[t/4+0],e=ht()[t/4+1];return fR(n,e)}finally{De(16),rm(n,e)}}function L(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`);return n.ptr}let F1=new Float32Array;function ps(){return F1.byteLength===0&&(F1=new Float32Array(Gl.buffer)),F1}let ot=32;function bt(n){if(ot==1)throw new Error("out of js stack");return je[--ot]=n,ot}function gR(n,e){return ps().subarray(n/4,n/4+e)}let $1=new Uint32Array;function mR(){return $1.byteLength===0&&($1=new Uint32Array(Gl.buffer)),$1}function are(n,e){return mR().subarray(n/4,n/4+e)}let ii=0;function ia(n,e){const t=e(n.length*4);return ps().set(n,t/4),ii=n.length,t}function yR(n,e){const t=e(n.length*4);return mR().set(n,t/4),ii=n.length,t}function B1(n,e){try{return n.apply(this,e)}catch(t){pde(jt(t))}}const Hg=Object.freeze({X:0,0:"X",Y:1,1:"Y",AngX:2,2:"AngX"});class fs{static __wrap(e){const t=Object.create(fs.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Lse(e)}constructor(){const e=zse();return fs.__wrap(e)}}class Kl{static __wrap(e){const t=Object.create(Kl.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();cie(e)}constructor(){const e=die();return Kl.__wrap(e)}}class uu{static __wrap(e){const t=Object.create(uu.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();tie(e)}constructor(){const e=nie();return uu.__wrap(e)}handle(){return rie(this.ptr)}translationApplied(){const e=mu(this.ptr);return V.__wrap(e)}translationRemaining(){const e=wR(this.ptr);return V.__wrap(e)}toi(){return iie(this.ptr)}worldWitness1(){const e=oie(this.ptr);return V.__wrap(e)}worldWitness2(){const e=sie(this.ptr);return V.__wrap(e)}worldNormal1(){const e=aie(this.ptr);return V.__wrap(e)}worldNormal2(){const e=lie(this.ptr);return V.__wrap(e)}}class vt{static __wrap(e){const t=Object.create(vt.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Kae(e)}coTranslation(e){const t=Nse(this.ptr,e);return V.__wrap(t)}coRotation(e){const t=Fse(this.ptr,e);return Re.__wrap(t)}coSetTranslation(e,t,r){$se(this.ptr,e,t,r)}coSetTranslationWrtParent(e,t,r){Bse(this.ptr,e,t,r)}coSetRotation(e,t){Use(this.ptr,e,t)}coSetRotationWrtParent(e,t){Vse(this.ptr,e,t)}coIsSensor(e){return Hse(this.ptr,e)!==0}coShapeType(e){return Wse(this.ptr,e)>>>0}coHalfspaceNormal(e){const t=Kse(this.ptr,e);return t===0?void 0:V.__wrap(t)}coHalfExtents(e){const t=Gse(this.ptr,e);return t===0?void 0:V.__wrap(t)}coSetHalfExtents(e,t){L(t,V),Yse(this.ptr,e,t.ptr)}coRadius(e){try{const i=De(-16);Xse(i,this.ptr,e);var t=ht()[i/4+0],r=ps()[i/4+1];return t===0?void 0:r}finally{De(16)}}coSetRadius(e,t){qse(this.ptr,e,t)}coHalfHeight(e){try{const i=De(-16);Jse(i,this.ptr,e);var t=ht()[i/4+0],r=ps()[i/4+1];return t===0?void 0:r}finally{De(16)}}coSetHalfHeight(e,t){Zse(this.ptr,e,t)}coRoundRadius(e){try{const i=De(-16);Qse(i,this.ptr,e);var t=ht()[i/4+0],r=ps()[i/4+1];return t===0?void 0:r}finally{De(16)}}coSetRoundRadius(e,t){eae(this.ptr,e,t)}coVertices(e){try{const i=De(-16);tae(i,this.ptr,e);var t=ht()[i/4+0],r=ht()[i/4+1];let o;return t!==0&&(o=gR(t,r).slice(),rm(t,r*4)),o}finally{De(16)}}coIndices(e){try{const i=De(-16);nae(i,this.ptr,e);var t=ht()[i/4+0],r=ht()[i/4+1];let o;return t!==0&&(o=are(t,r).slice(),rm(t,r*4)),o}finally{De(16)}}coHeightfieldHeights(e){try{const i=De(-16);rae(i,this.ptr,e);var t=ht()[i/4+0],r=ht()[i/4+1];let o;return t!==0&&(o=gR(t,r).slice(),rm(t,r*4)),o}finally{De(16)}}coHeightfieldScale(e){const t=iae(this.ptr,e);return t===0?void 0:V.__wrap(t)}coParent(e){try{const i=De(-16);oae(i,this.ptr,e);var t=ht()[i/4+0],r=Vg()[i/8+1];return t===0?void 0:r}finally{De(16)}}coSetEnabled(e,t){sae(this.ptr,e,t)}coIsEnabled(e){return aae(this.ptr,e)!==0}coFriction(e){return lae(this.ptr,e)}coRestitution(e){return cae(this.ptr,e)}coDensity(e){return dae(this.ptr,e)}coMass(e){return uae(this.ptr,e)}coVolume(e){return hae(this.ptr,e)}coCollisionGroups(e){return pae(this.ptr,e)>>>0}coSolverGroups(e){return fae(this.ptr,e)>>>0}coActiveHooks(e){return gae(this.ptr,e)>>>0}coActiveCollisionTypes(e){return mae(this.ptr,e)}coActiveEvents(e){return yae(this.ptr,e)>>>0}coContactForceEventThreshold(e){return wae(this.ptr,e)}coContainsPoint(e,t){return L(t,V),bae(this.ptr,e,t.ptr)!==0}coCastShape(e,t,r,i,o,s,a,l){L(t,V),L(r,xe),L(i,V),L(o,Re),L(s,V);const c=vae(this.ptr,e,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a,l);return c===0?void 0:em.__wrap(c)}coCastCollider(e,t,r,i,o,s){L(t,V),L(i,V);const a=Sae(this.ptr,e,t.ptr,r,i.ptr,o,s);return a===0?void 0:Qg.__wrap(a)}coIntersectsShape(e,t,r,i){return L(t,xe),L(r,V),L(i,Re),xae(this.ptr,e,t.ptr,r.ptr,i.ptr)!==0}coContactShape(e,t,r,i,o){L(t,xe),L(r,V),L(i,Re);const s=_ae(this.ptr,e,t.ptr,r.ptr,i.ptr,o);return s===0?void 0:fu.__wrap(s)}coContactCollider(e,t,r){const i=kae(this.ptr,e,t,r);return i===0?void 0:fu.__wrap(i)}coProjectPoint(e,t,r){L(t,V);const i=Cae(this.ptr,e,t.ptr,r);return Xg.__wrap(i)}coIntersectsRay(e,t,r,i){return L(t,V),L(r,V),Pae(this.ptr,e,t.ptr,r.ptr,i)!==0}coCastRay(e,t,r,i,o){return L(t,V),L(r,V),Eae(this.ptr,e,t.ptr,r.ptr,i,o)}coCastRayAndGetNormal(e,t,r,i,o){L(t,V),L(r,V);const s=Iae(this.ptr,e,t.ptr,r.ptr,i,o);return s===0?void 0:Jg.__wrap(s)}coSetSensor(e,t){Mae(this.ptr,e,t)}coSetRestitution(e,t){Aae(this.ptr,e,t)}coSetFriction(e,t){Tae(this.ptr,e,t)}coFrictionCombineRule(e){return jae(this.ptr,e)>>>0}coSetFrictionCombineRule(e,t){Rae(this.ptr,e,t)}coRestitutionCombineRule(e){return Oae(this.ptr,e)>>>0}coSetRestitutionCombineRule(e,t){Dae(this.ptr,e,t)}coSetCollisionGroups(e,t){Lae(this.ptr,e,t)}coSetSolverGroups(e,t){zae(this.ptr,e,t)}coSetActiveHooks(e,t){Nae(this.ptr,e,t)}coSetActiveEvents(e,t){Fae(this.ptr,e,t)}coSetActiveCollisionTypes(e,t){$ae(this.ptr,e,t)}coSetShape(e,t){L(t,xe),Bae(this.ptr,e,t.ptr)}coSetContactForceEventThreshold(e,t){Uae(this.ptr,e,t)}coSetDensity(e,t){Vae(this.ptr,e,t)}coSetMass(e,t){Hae(this.ptr,e,t)}coSetMassProperties(e,t,r,i){L(r,V),Wae(this.ptr,e,t,r.ptr,i)}constructor(){const e=Gae();return vt.__wrap(e)}len(){return Yae(this.ptr)>>>0}contains(e){return xR(this.ptr,e)!==0}createCollider(e,t,r,i,o,s,a,l,c,d,u,h,p,m,f,w,S,b,_,x,P,C,E){try{const T=De(-16);L(t,xe),L(r,V),L(i,Re),L(a,V),L(E,Pt),Xae(T,this.ptr,e,t.ptr,r.ptr,i.ptr,o,s,a.ptr,l,c,d,u,h,p,m,f,w,S,b,_,x,P,C,E.ptr);var I=ht()[T/4+0],A=Vg()[T/8+1];return I===0?void 0:A}finally{De(16)}}remove(e,t,r,i){L(t,Ri),L(r,Pt),qae(this.ptr,e,t.ptr,r.ptr,i)}isHandleValid(e){return xR(this.ptr,e)!==0}forEachColliderHandle(e){try{Jae(this.ptr,bt(e))}finally{je[ot++]=void 0}}}class U1{static __wrap(e){const t=Object.create(U1.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();kce(e)}collider1(){return yu(this.ptr)}collider2(){return Cce(this.ptr)}total_force(){const e=wu(this.ptr);return V.__wrap(e)}total_force_magnitude(){return nm(this.ptr)}max_force_direction(){const e=mu(this.ptr);return V.__wrap(e)}max_force_magnitude(){return Pce(this.ptr)}}class V1{static __wrap(e){const t=Object.create(V1.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();ole(e)}normal(){const e=dle(this.ptr);return V.__wrap(e)}local_n1(){const e=ule(this.ptr);return V.__wrap(e)}local_n2(){const e=hle(this.ptr);return V.__wrap(e)}subshape1(){return ple(this.ptr)>>>0}subshape2(){return fle(this.ptr)>>>0}num_contacts(){return gle(this.ptr)>>>0}contact_local_p1(e){const t=mle(this.ptr,e);return t===0?void 0:V.__wrap(t)}contact_local_p2(e){const t=yle(this.ptr,e);return t===0?void 0:V.__wrap(t)}contact_dist(e){return wle(this.ptr,e)}contact_fid1(e){return ble(this.ptr,e)>>>0}contact_fid2(e){return vle(this.ptr,e)>>>0}contact_impulse(e){return Sle(this.ptr,e)}contact_tangent_impulse(e){return xle(this.ptr,e)}num_solver_contacts(){return _le(this.ptr)>>>0}solver_contact_point(e){const t=kle(this.ptr,e);return t===0?void 0:V.__wrap(t)}solver_contact_dist(e){return Cle(this.ptr,e)}solver_contact_friction(e){return Ple(this.ptr,e)}solver_contact_restitution(e){return Ele(this.ptr,e)}solver_contact_tangent_velocity(e){const t=Ile(this.ptr,e);return V.__wrap(t)}}class H1{static __wrap(e){const t=Object.create(H1.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();sde(e)}collider1(){return sle(this.ptr)}collider2(){return ale(this.ptr)}numContactManifolds(){return lle(this.ptr)>>>0}contactManifold(e){const t=cle(this.ptr,e);return t===0?void 0:V1.__wrap(t)}}class Wg{static __wrap(e){const t=Object.create(Wg.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();wce(e)}constructor(){const e=bce();return Wg.__wrap(e)}vertices(){const e=vce(this.ptr);return Ug(e)}colors(){const e=Sce(this.ptr);return Ug(e)}render(e,t,r,i,o){L(e,Pt),L(t,vt),L(r,ji),L(i,Oi),L(o,yo),xce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr)}}class W1{static __wrap(e){const t=Object.create(W1.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Yce(e)}takeGravity(){const e=Xce(this.ptr);return e===0?void 0:V.__wrap(e)}takeIntegrationParameters(){const e=qce(this.ptr);return e===0?void 0:gs.__wrap(e)}takeIslandManager(){const e=Jce(this.ptr);return e===0?void 0:Ri.__wrap(e)}takeBroadPhase(){const e=Zce(this.ptr);return e===0?void 0:fs.__wrap(e)}takeNarrowPhase(){const e=Qce(this.ptr);return e===0?void 0:yo.__wrap(e)}takeBodies(){const e=ede(this.ptr);return e===0?void 0:Pt.__wrap(e)}takeColliders(){const e=tde(this.ptr);return e===0?void 0:vt.__wrap(e)}takeImpulseJoints(){const e=nde(this.ptr);return e===0?void 0:ji.__wrap(e)}takeMultibodyJoints(){const e=rde(this.ptr);return e===0?void 0:Oi.__wrap(e)}}class hu{static __wrap(e){const t=Object.create(hu.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();_ce(e)}constructor(e){const t=Ece(e);return hu.__wrap(t)}drainCollisionEvents(e){try{Ice(this.ptr,bt(e))}finally{je[ot++]=void 0}}drainContactForceEvents(e){try{Mce(this.ptr,bt(e))}finally{je[ot++]=void 0}}clear(){Ace(this.ptr)}}class Ti{static __wrap(e){const t=Object.create(Ti.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();toe(e)}static prismatic(e,t,r,i,o,s){L(e,V),L(t,V),L(r,V);const a=noe(e.ptr,t.ptr,r.ptr,i,o,s);return a===0?void 0:Ti.__wrap(a)}static fixed(e,t,r,i){L(e,V),L(t,Re),L(r,V),L(i,Re);const o=roe(e.ptr,t.ptr,r.ptr,i.ptr);return Ti.__wrap(o)}static revolute(e,t){L(e,V),L(t,V);const r=ioe(e.ptr,t.ptr);return r===0?void 0:Ti.__wrap(r)}}class ji{static __wrap(e){const t=Object.create(ji.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Aie(e)}jointType(e){return uie(this.ptr,e)>>>0}jointBodyHandle1(e){return hie(this.ptr,e)}jointBodyHandle2(e){return pie(this.ptr,e)}jointFrameX1(e){const t=fie(this.ptr,e);return Re.__wrap(t)}jointFrameX2(e){const t=gie(this.ptr,e);return Re.__wrap(t)}jointAnchor1(e){const t=mie(this.ptr,e);return V.__wrap(t)}jointAnchor2(e){const t=yie(this.ptr,e);return V.__wrap(t)}jointSetAnchor1(e,t){L(t,V),wie(this.ptr,e,t.ptr)}jointSetAnchor2(e,t){L(t,V),bie(this.ptr,e,t.ptr)}jointContactsEnabled(e){return vie(this.ptr,e)!==0}jointSetContactsEnabled(e,t){Sie(this.ptr,e,t)}jointLimitsEnabled(e,t){return xie(this.ptr,e,t)!==0}jointLimitsMin(e,t){return _ie(this.ptr,e,t)}jointLimitsMax(e,t){return kie(this.ptr,e,t)}jointSetLimits(e,t,r,i){Cie(this.ptr,e,t,r,i)}jointConfigureMotorModel(e,t,r){Pie(this.ptr,e,t,r)}jointConfigureMotorVelocity(e,t,r,i){Eie(this.ptr,e,t,r,i)}jointConfigureMotorPosition(e,t,r,i,o){Iie(this.ptr,e,t,r,i,o)}jointConfigureMotor(e,t,r,i,o,s){Mie(this.ptr,e,t,r,i,o,s)}constructor(){const e=Tie();return ji.__wrap(e)}createJoint(e,t,r,i){return L(e,Ti),jie(this.ptr,e.ptr,t,r,i)}remove(e,t){Rie(this.ptr,e,t)}len(){return Oie(this.ptr)>>>0}contains(e){return Die(this.ptr,e)!==0}forEachJointHandle(e){try{Lie(this.ptr,bt(e))}finally{je[ot++]=void 0}}forEachJointAttachedToRigidBody(e,t){try{zie(this.ptr,e,bt(t))}finally{je[ot++]=void 0}}}class gs{static __wrap(e){const t=Object.create(gs.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Nie(e)}constructor(){const e=Fie();return gs.__wrap(e)}get dt(){return G1(this.ptr)}get erp(){return bR(this.ptr)}get allowedLinearError(){return Y1(this.ptr)}get predictionDistance(){return nm(this.ptr)}get maxVelocityIterations(){return $ie(this.ptr)>>>0}get maxVelocityFrictionIterations(){return Bie(this.ptr)>>>0}get maxStabilizationIterations(){return Uie(this.ptr)>>>0}get minIslandSize(){return Vie(this.ptr)>>>0}get maxCcdSubsteps(){return Hie(this.ptr)>>>0}set dt(e){vR(this.ptr,e)}set erp(e){Wie(this.ptr,e)}set allowedLinearError(e){SR(this.ptr,e)}set predictionDistance(e){Kie(this.ptr,e)}set maxVelocityIterations(e){Gie(this.ptr,e)}set maxVelocityFrictionIterations(e){Yie(this.ptr,e)}set maxStabilizationIterations(e){Xie(this.ptr,e)}set minIslandSize(e){qie(this.ptr,e)}set maxCcdSubsteps(e){Jie(this.ptr,e)}}class Ri{static __wrap(e){const t=Object.create(Ri.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Zie(e)}constructor(){const e=Qie();return Ri.__wrap(e)}forEachActiveRigidBodyHandle(e){try{eoe(this.ptr,bt(e))}finally{je[ot++]=void 0}}}class Kg{static __wrap(e){const t=Object.create(Kg.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Tre(e)}constructor(e){const t=jre(e);return Kg.__wrap(t)}up(){const e=gu(this.ptr);return V.__wrap(e)}setUp(e){L(e,V),Rre(this.ptr,e.ptr)}offset(){return Ore(this.ptr)}setOffset(e){Dre(this.ptr,e)}slideEnabled(){return Lre(this.ptr)!==0}setSlideEnabled(e){zre(this.ptr,e)}autostepMaxHeight(){try{const r=De(-16);Nre(r,this.ptr);var e=ht()[r/4+0],t=ps()[r/4+1];return e===0?void 0:t}finally{De(16)}}autostepMinWidth(){try{const r=De(-16);Fre(r,this.ptr);var e=ht()[r/4+0],t=ps()[r/4+1];return e===0?void 0:t}finally{De(16)}}autostepIncludesDynamicBodies(){const e=$re(this.ptr);return e===16777215?void 0:e!==0}autostepEnabled(){return Bre(this.ptr)!==0}enableAutostep(e,t,r){Ure(this.ptr,e,t,r)}disableAutostep(){Vre(this.ptr)}maxSlopeClimbAngle(){return Y1(this.ptr)}setMaxSlopeClimbAngle(e){SR(this.ptr,e)}minSlopeSlideAngle(){return Hre(this.ptr)}setMinSlopeSlideAngle(e){Wre(this.ptr,e)}snapToGroundDistance(){try{const r=De(-16);Kre(r,this.ptr);var e=ht()[r/4+0],t=ps()[r/4+1];return e===0?void 0:t}finally{De(16)}}enableSnapToGround(e){Gre(this.ptr,e)}disableSnapToGround(){Yre(this.ptr)}snapToGroundEnabled(){return Xre(this.ptr)!==0}computeColliderMovement(e,t,r,i,o,s,a,l,c,d,u){try{L(t,Pt),L(r,vt),L(i,pu),L(s,V),qre(this.ptr,e,t.ptr,r.ptr,i.ptr,o,s.ptr,a,!ce(l),ce(l)?0:l,c,!ce(d),ce(d)?0:d,bt(u))}finally{je[ot++]=void 0}}computedMovement(){const e=Jre(this.ptr);return V.__wrap(e)}computedGrounded(){return Zre(this.ptr)!==0}numComputedCollisions(){return Qre(this.ptr)>>>0}computedCollision(e,t){return L(t,uu),eie(this.ptr,e,t.ptr)!==0}}class Oi{static __wrap(e){const t=Object.create(Oi.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();goe(e)}jointType(e){return ooe(this.ptr,e)>>>0}jointFrameX1(e){const t=soe(this.ptr,e);return Re.__wrap(t)}jointFrameX2(e){const t=aoe(this.ptr,e);return Re.__wrap(t)}jointAnchor1(e){const t=loe(this.ptr,e);return V.__wrap(t)}jointAnchor2(e){const t=coe(this.ptr,e);return V.__wrap(t)}jointContactsEnabled(e){return doe(this.ptr,e)!==0}jointSetContactsEnabled(e,t){uoe(this.ptr,e,t)}jointLimitsEnabled(e,t){return hoe(this.ptr,e,t)!==0}jointLimitsMin(e,t){return poe(this.ptr,e,t)}jointLimitsMax(e,t){return foe(this.ptr,e,t)}constructor(){const e=moe();return Oi.__wrap(e)}createJoint(e,t,r,i){return L(e,Ti),yoe(this.ptr,e.ptr,t,r,i)}remove(e,t){woe(this.ptr,e,t)}contains(e){return boe(this.ptr,e)!==0}forEachJointHandle(e){try{voe(this.ptr,bt(e))}finally{je[ot++]=void 0}}forEachJointAttachedToRigidBody(e,t){try{Soe(this.ptr,e,bt(t))}finally{je[ot++]=void 0}}}class yo{static __wrap(e){const t=Object.create(yo.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Qae(e)}constructor(){const e=ele();return yo.__wrap(e)}contacts_with(e,t){tle(this.ptr,e,jt(t))}contact_pair(e,t){const r=nle(this.ptr,e,t);return r===0?void 0:H1.__wrap(r)}intersections_with(e,t){rle(this.ptr,e,jt(t))}intersection_pair(e,t){return ile(this.ptr,e,t)!==0}}class Gg{static __wrap(e){const t=Object.create(Gg.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Tce(e)}constructor(){const e=jce();return Gg.__wrap(e)}step(e,t,r,i,o,s,a,l,c,d){L(e,V),L(t,gs),L(r,Ri),L(i,fs),L(o,yo),L(s,Pt),L(a,vt),L(l,ji),L(c,Oi),L(d,Kl),Rce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l.ptr,c.ptr,d.ptr)}stepWithEvents(e,t,r,i,o,s,a,l,c,d,u,h,p,m){L(e,V),L(t,gs),L(r,Ri),L(i,fs),L(o,yo),L(s,Pt),L(a,vt),L(l,ji),L(c,Oi),L(d,Kl),L(u,hu),Oce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l.ptr,c.ptr,d.ptr,u.ptr,jt(h),jt(p),jt(m))}}class Yg{static __wrap(e){const t=Object.create(Yg.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Tle(e)}colliderHandle(){return yu(this.ptr)}point(){const e=wu(this.ptr);return V.__wrap(e)}isInside(){return jle(this.ptr)!==0}featureType(){return _R(this.ptr)>>>0}featureId(){try{const r=De(-16);kR(r,this.ptr);var e=ht()[r/4+0],t=ht()[r/4+1];return e===0?void 0:t>>>0}finally{De(16)}}}class Xg{static __wrap(e){const t=Object.create(Xg.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Mle(e)}point(){const e=gu(this.ptr);return V.__wrap(e)}isInside(){return Ale(this.ptr)!==0}}class pu{static __wrap(e){const t=Object.create(pu.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Dce(e)}constructor(){const e=Lce();return pu.__wrap(e)}update(e,t){L(e,Pt),L(t,vt),zce(this.ptr,e.ptr,t.ptr)}castRay(e,t,r,i,o,s,a,l,c,d,u){try{L(e,Pt),L(t,vt),L(r,V),L(i,V);const h=Nce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s,a,!ce(l),ce(l)?0:l,!ce(c),ce(c)?0:c,!ce(d),ce(d)?0:d,bt(u));return h===0?void 0:K1.__wrap(h)}finally{je[ot++]=void 0}}castRayAndGetNormal(e,t,r,i,o,s,a,l,c,d,u){try{L(e,Pt),L(t,vt),L(r,V),L(i,V);const h=Fce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s,a,!ce(l),ce(l)?0:l,!ce(c),ce(c)?0:c,!ce(d),ce(d)?0:d,bt(u));return h===0?void 0:qg.__wrap(h)}finally{je[ot++]=void 0}}intersectionsWithRay(e,t,r,i,o,s,a,l,c,d,u,h){try{L(e,Pt),L(t,vt),L(r,V),L(i,V),$ce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s,bt(a),l,!ce(c),ce(c)?0:c,!ce(d),ce(d)?0:d,!ce(u),ce(u)?0:u,bt(h))}finally{je[ot++]=void 0,je[ot++]=void 0}}intersectionWithShape(e,t,r,i,o,s,a,l,c,d){try{const p=De(-16);L(e,Pt),L(t,vt),L(r,V),L(i,Re),L(o,xe),Bce(p,this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s,!ce(a),ce(a)?0:a,!ce(l),ce(l)?0:l,!ce(c),ce(c)?0:c,bt(d));var u=ht()[p/4+0],h=Vg()[p/8+1];return u===0?void 0:h}finally{De(16),je[ot++]=void 0}}projectPoint(e,t,r,i,o,s,a,l,c){try{L(e,Pt),L(t,vt),L(r,V);const d=Uce(this.ptr,e.ptr,t.ptr,r.ptr,i,o,!ce(s),ce(s)?0:s,!ce(a),ce(a)?0:a,!ce(l),ce(l)?0:l,bt(c));return d===0?void 0:Yg.__wrap(d)}finally{je[ot++]=void 0}}projectPointAndGetFeature(e,t,r,i,o,s,a,l){try{L(e,Pt),L(t,vt),L(r,V);const c=Vce(this.ptr,e.ptr,t.ptr,r.ptr,i,!ce(o),ce(o)?0:o,!ce(s),ce(s)?0:s,!ce(a),ce(a)?0:a,bt(l));return c===0?void 0:Yg.__wrap(c)}finally{je[ot++]=void 0}}intersectionsWithPoint(e,t,r,i,o,s,a,l,c){try{L(e,Pt),L(t,vt),L(r,V),Hce(this.ptr,e.ptr,t.ptr,r.ptr,bt(i),o,!ce(s),ce(s)?0:s,!ce(a),ce(a)?0:a,!ce(l),ce(l)?0:l,bt(c))}finally{je[ot++]=void 0,je[ot++]=void 0}}castShape(e,t,r,i,o,s,a,l,c,d,u,h,p){try{L(e,Pt),L(t,vt),L(r,V),L(i,Re),L(o,V),L(s,xe);const m=Wce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a,l,c,!ce(d),ce(d)?0:d,!ce(u),ce(u)?0:u,!ce(h),ce(h)?0:h,bt(p));return m===0?void 0:Qg.__wrap(m)}finally{je[ot++]=void 0}}intersectionsWithShape(e,t,r,i,o,s,a,l,c,d,u){try{L(e,Pt),L(t,vt),L(r,V),L(i,Re),L(o,xe),Kce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,bt(s),a,!ce(l),ce(l)?0:l,!ce(c),ce(c)?0:c,!ce(d),ce(d)?0:d,bt(u))}finally{je[ot++]=void 0,je[ot++]=void 0}}collidersWithAabbIntersectingAabb(e,t,r){try{L(e,V),L(t,V),Gce(this.ptr,e.ptr,t.ptr,bt(r))}finally{je[ot++]=void 0}}}class qg{static __wrap(e){const t=Object.create(qg.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();ade(e)}colliderHandle(){return yu(this.ptr)}normal(){const e=tm(this.ptr);return V.__wrap(e)}toi(){return Y1(this.ptr)}featureType(){return Dle(this.ptr)>>>0}featureId(){try{const r=De(-16);Lle(r,this.ptr);var e=ht()[r/4+0],t=ht()[r/4+1];return e===0?void 0:t>>>0}finally{De(16)}}}class K1{static __wrap(e){const t=Object.create(K1.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();lde(e)}colliderHandle(){return yu(this.ptr)}toi(){return bR(this.ptr)}}class Jg{static __wrap(e){const t=Object.create(Jg.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Rle(e)}normal(){const e=gu(this.ptr);return V.__wrap(e)}toi(){return Ole(this.ptr)}featureType(){return _R(this.ptr)>>>0}featureId(){try{const r=De(-16);kR(r,this.ptr);var e=ht()[r/4+0],t=ht()[r/4+1];return e===0?void 0:t>>>0}finally{De(16)}}}class Pt{static __wrap(e){const t=Object.create(Pt.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Ise(e)}rbTranslation(e){const t=xoe(this.ptr,e);return V.__wrap(t)}rbRotation(e){const t=_oe(this.ptr,e);return Re.__wrap(t)}rbSleep(e){koe(this.ptr,e)}rbIsSleeping(e){return Coe(this.ptr,e)!==0}rbIsMoving(e){return Poe(this.ptr,e)!==0}rbNextTranslation(e){const t=Eoe(this.ptr,e);return V.__wrap(t)}rbNextRotation(e){const t=Ioe(this.ptr,e);return Re.__wrap(t)}rbSetTranslation(e,t,r,i){Moe(this.ptr,e,t,r,i)}rbSetRotation(e,t,r){Aoe(this.ptr,e,t,r)}rbSetLinvel(e,t,r){L(t,V),Toe(this.ptr,e,t.ptr,r)}rbSetAngvel(e,t,r){joe(this.ptr,e,t,r)}rbSetNextKinematicTranslation(e,t,r){Roe(this.ptr,e,t,r)}rbSetNextKinematicRotation(e,t){Ooe(this.ptr,e,t)}rbRecomputeMassPropertiesFromColliders(e,t){L(t,vt),Doe(this.ptr,e,t.ptr)}rbSetAdditionalMass(e,t,r){Loe(this.ptr,e,t,r)}rbSetAdditionalMassProperties(e,t,r,i,o){L(r,V),zoe(this.ptr,e,t,r.ptr,i,o)}rbLinvel(e){const t=Noe(this.ptr,e);return V.__wrap(t)}rbAngvel(e){return Foe(this.ptr,e)}rbLockTranslations(e,t,r){$oe(this.ptr,e,t,r)}rbSetEnabledTranslations(e,t,r,i){Boe(this.ptr,e,t,r,i)}rbLockRotations(e,t,r){Uoe(this.ptr,e,t,r)}rbDominanceGroup(e){return Voe(this.ptr,e)}rbSetDominanceGroup(e,t){Hoe(this.ptr,e,t)}rbEnableCcd(e,t){Woe(this.ptr,e,t)}rbMass(e){return Koe(this.ptr,e)}rbInvMass(e){return Goe(this.ptr,e)}rbEffectiveInvMass(e){const t=Yoe(this.ptr,e);return V.__wrap(t)}rbLocalCom(e){const t=Xoe(this.ptr,e);return V.__wrap(t)}rbWorldCom(e){const t=qoe(this.ptr,e);return V.__wrap(t)}rbInvPrincipalInertiaSqrt(e){return Joe(this.ptr,e)}rbPrincipalInertia(e){return Zoe(this.ptr,e)}rbEffectiveWorldInvInertiaSqrt(e){return Qoe(this.ptr,e)}rbEffectiveAngularInertia(e){return ese(this.ptr,e)}rbWakeUp(e){tse(this.ptr,e)}rbIsCcdEnabled(e){return nse(this.ptr,e)!==0}rbNumColliders(e){return rse(this.ptr,e)>>>0}rbCollider(e,t){return ise(this.ptr,e,t)}rbBodyType(e){return ose(this.ptr,e)>>>0}rbSetBodyType(e,t,r){sse(this.ptr,e,t,r)}rbIsFixed(e){return ase(this.ptr,e)!==0}rbIsKinematic(e){return lse(this.ptr,e)!==0}rbIsDynamic(e){return cse(this.ptr,e)!==0}rbLinearDamping(e){return dse(this.ptr,e)}rbAngularDamping(e){return use(this.ptr,e)}rbSetLinearDamping(e,t){hse(this.ptr,e,t)}rbSetAngularDamping(e,t){pse(this.ptr,e,t)}rbSetEnabled(e,t){fse(this.ptr,e,t)}rbIsEnabled(e){return gse(this.ptr,e)!==0}rbGravityScale(e){return mse(this.ptr,e)}rbSetGravityScale(e,t,r){yse(this.ptr,e,t,r)}rbResetForces(e,t){wse(this.ptr,e,t)}rbResetTorques(e,t){bse(this.ptr,e,t)}rbAddForce(e,t,r){L(t,V),vse(this.ptr,e,t.ptr,r)}rbApplyImpulse(e,t,r){L(t,V),Sse(this.ptr,e,t.ptr,r)}rbAddTorque(e,t,r){xse(this.ptr,e,t,r)}rbApplyTorqueImpulse(e,t,r){_se(this.ptr,e,t,r)}rbAddForceAtPoint(e,t,r,i){L(t,V),L(r,V),kse(this.ptr,e,t.ptr,r.ptr,i)}rbApplyImpulseAtPoint(e,t,r,i){L(t,V),L(r,V),Cse(this.ptr,e,t.ptr,r.ptr,i)}rbUserData(e){return Pse(this.ptr,e)>>>0}rbSetUserData(e,t){Ese(this.ptr,e,t)}constructor(){const e=Mse();return Pt.__wrap(e)}createRigidBody(e,t,r,i,o,s,a,l,c,d,u,h,p,m,f,w,S,b,_,x){return L(t,V),L(r,Re),L(a,V),L(l,V),Ase(this.ptr,e,t.ptr,r.ptr,i,o,s,a.ptr,l.ptr,c,d,u,h,p,m,f,w,S,b,_,x)}remove(e,t,r,i,o){L(t,Ri),L(r,vt),L(i,ji),L(o,Oi),Tse(this.ptr,e,t.ptr,r.ptr,i.ptr,o.ptr)}len(){return jse(this.ptr)>>>0}contains(e){return Rse(this.ptr,e)!==0}forEachRigidBodyHandle(e){try{Ose(this.ptr,bt(e))}finally{je[ot++]=void 0}}propagateModifiedBodyPositionsToColliders(e){L(e,vt),Dse(this.ptr,e.ptr)}}class Re{static __wrap(e){const t=Object.create(Re.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();cce(e)}static identity(){const e=dce();return Re.__wrap(e)}static fromAngle(e){const t=uce(e);return Re.__wrap(t)}get im(){return CR(this.ptr)}get re(){return G1(this.ptr)}get angle(){return hce(this.ptr)}}class Zg{static __wrap(e){const t=Object.create(Zg.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();hde(e)}constructor(){const e=ude();return Zg.__wrap(e)}serializeAll(e,t,r,i,o,s,a,l,c){L(e,V),L(t,gs),L(r,Ri),L(i,fs),L(o,yo),L(s,Pt),L(a,vt),L(l,ji),L(c,Oi);const d=ide(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l.ptr,c.ptr);return Ug(d)}deserializeAll(e){const t=ode(this.ptr,jt(e));return t===0?void 0:W1.__wrap(t)}}class xe{static __wrap(e){const t=Object.create(xe.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();zle(e)}static cuboid(e,t){const r=Nle(e,t);return xe.__wrap(r)}static roundCuboid(e,t,r){const i=Fle(e,t,r);return xe.__wrap(i)}static ball(e){const t=$le(e);return xe.__wrap(t)}static halfspace(e){L(e,V);const t=Ble(e.ptr);return xe.__wrap(t)}static capsule(e,t){const r=Ule(e,t);return xe.__wrap(r)}static polyline(e,t){const r=ia(e,wo),i=ii,o=yR(t,wo),s=Vle(r,i,o,ii);return xe.__wrap(s)}static trimesh(e,t){const r=ia(e,wo),i=ii,o=yR(t,wo),s=Hle(r,i,o,ii);return xe.__wrap(s)}static heightfield(e,t){const r=ia(e,wo),i=ii;L(t,V);const o=Wle(r,i,t.ptr);return xe.__wrap(o)}static segment(e,t){L(e,V),L(t,V);const r=Kle(e.ptr,t.ptr);return xe.__wrap(r)}static triangle(e,t,r){L(e,V),L(t,V),L(r,V);const i=Gle(e.ptr,t.ptr,r.ptr);return xe.__wrap(i)}static roundTriangle(e,t,r,i){L(e,V),L(t,V),L(r,V);const o=Yle(e.ptr,t.ptr,r.ptr,i);return xe.__wrap(o)}static convexHull(e){const t=ia(e,wo),r=Xle(t,ii);return r===0?void 0:xe.__wrap(r)}static roundConvexHull(e,t){const r=ia(e,wo),i=qle(r,ii,t);return i===0?void 0:xe.__wrap(i)}static convexPolyline(e){const t=ia(e,wo),r=Jle(t,ii);return r===0?void 0:xe.__wrap(r)}static roundConvexPolyline(e,t){const r=ia(e,wo),i=Zle(r,ii,t);return i===0?void 0:xe.__wrap(i)}castShape(e,t,r,i,o,s,a,l,c){L(e,V),L(t,Re),L(r,V),L(i,xe),L(o,V),L(s,Re),L(a,V);const d=Qle(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l,c);return d===0?void 0:em.__wrap(d)}intersectsShape(e,t,r,i,o){return L(e,V),L(t,Re),L(r,xe),L(i,V),L(o,Re),ece(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr)!==0}contactShape(e,t,r,i,o,s){L(e,V),L(t,Re),L(r,xe),L(i,V),L(o,Re);const a=tce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s);return a===0?void 0:fu.__wrap(a)}containsPoint(e,t,r){return L(e,V),L(t,Re),L(r,V),nce(this.ptr,e.ptr,t.ptr,r.ptr)!==0}projectPoint(e,t,r,i){L(e,V),L(t,Re),L(r,V);const o=rce(this.ptr,e.ptr,t.ptr,r.ptr,i);return Xg.__wrap(o)}intersectsRay(e,t,r,i,o){return L(e,V),L(t,Re),L(r,V),L(i,V),ice(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o)!==0}castRay(e,t,r,i,o,s){return L(e,V),L(t,Re),L(r,V),L(i,V),oce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s)}castRayAndGetNormal(e,t,r,i,o,s){L(e,V),L(t,Re),L(r,V),L(i,V);const a=sce(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s);return a===0?void 0:Jg.__wrap(a)}}class Qg{static __wrap(e){const t=Object.create(Qg.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();ace(e)}colliderHandle(){return yu(this.ptr)}toi(){return lce(this.ptr)}witness1(){const e=tm(this.ptr);return V.__wrap(e)}witness2(){const e=wu(this.ptr);return V.__wrap(e)}normal1(){const e=mu(this.ptr);return V.__wrap(e)}normal2(){const e=wR(this.ptr);return V.__wrap(e)}}class fu{static __wrap(e){const t=Object.create(fu.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Zae(e)}distance(){return nm(this.ptr)}point1(){const e=gu(this.ptr);return V.__wrap(e)}point2(){const e=tm(this.ptr);return V.__wrap(e)}normal1(){const e=wu(this.ptr);return V.__wrap(e)}normal2(){const e=mu(this.ptr);return V.__wrap(e)}}class em{static __wrap(e){const t=Object.create(em.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();dde(e)}toi(){return nm(this.ptr)}witness1(){const e=gu(this.ptr);return V.__wrap(e)}witness2(){const e=tm(this.ptr);return V.__wrap(e)}normal1(){const e=wu(this.ptr);return V.__wrap(e)}normal2(){const e=mu(this.ptr);return V.__wrap(e)}}class V{static __wrap(e){const t=Object.create(V.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();cde(e)}static zero(){const e=pce();return V.__wrap(e)}constructor(e,t){const r=fce(e,t);return V.__wrap(r)}get x(){return G1(this.ptr)}set x(e){vR(this.ptr,e)}get y(){return CR(this.ptr)}set y(e){gce(this.ptr,e)}xy(){const e=mce(this.ptr);return V.__wrap(e)}yx(){const e=yce(this.ptr);return V.__wrap(e)}}function lre(n){Ug(n)}function cre(n){return jt(n)}function dre(n,e){const t=$e(e),r=typeof t=="number"?t:void 0;Vg()[n/8+1]=ce(r)?0:r,ht()[n/4+0]=!ce(r)}function ure(n){const e=$e(n);return typeof e=="boolean"?e?1:0:2}function hre(n){return typeof $e(n)=="function"}function pre(n){const e=qg.__wrap(n);return jt(e)}function fre(n){const e=U1.__wrap(n);return jt(e)}function gre(){return B1(function(n,e,t){const r=$e(n).call($e(e),$e(t));return jt(r)},arguments)}function mre(){return B1(function(n,e,t,r){const i=$e(n).call($e(e),$e(t),$e(r));return jt(i)},arguments)}function yre(){return B1(function(n,e,t,r,i){const o=$e(n).call($e(e),$e(t),$e(r),$e(i));return jt(o)},arguments)}function wre(n,e,t,r){const i=$e(n).bind($e(e),$e(t),$e(r));return jt(i)}function bre(n){const e=$e(n).buffer;return jt(e)}function vre(n,e,t){const r=new Uint8Array($e(n),e>>>0,t>>>0);return jt(r)}function Sre(n){const e=new Uint8Array($e(n));return jt(e)}function xre(n,e,t){$e(n).set($e(e),t>>>0)}function _re(n){return $e(n).length}function kre(n,e,t){const r=new Float32Array($e(n),e>>>0,t>>>0);return jt(r)}function Cre(n,e,t){$e(n).set($e(e),t>>>0)}function Pre(n){return $e(n).length}function Ere(n){const e=new Float32Array(n>>>0);return jt(e)}function Ire(n,e){throw new Error(fR(n,e))}function Mre(){return jt(Gl)}URL=globalThis.URL;const M=await nre({"./rapier_wasm2d_bg.js":{__wbindgen_object_drop_ref:lre,__wbindgen_number_new:cre,__wbindgen_number_get:dre,__wbindgen_boolean_get:ure,__wbindgen_is_function:hre,__wbg_rawraycolliderintersection_new:pre,__wbg_rawcontactforceevent_new:fre,__wbg_call_168da88779e35f61:gre,__wbg_call_3999bee59e9f7719:mre,__wbg_call_e1f72c051cdab859:yre,__wbg_bind_10dfe70e95d2a480:wre,__wbg_buffer_3f3d764d4747d564:bre,__wbg_newwithbyteoffsetandlength_d9aa266703cb98be:vre,__wbg_new_8c3f0052272a457a:Sre,__wbg_set_83db9690f9353e79:xre,__wbg_length_9e1ae1900cb0fbd5:_re,__wbg_newwithbyteoffsetandlength_be22e5fcf4f69ab4:kre,__wbg_set_0e0314cf6675c1b9:Cre,__wbg_length_9a2deed95d22668d:Pre,__wbg_newwithlength_a7168e4a1e8f5e12:Ere,__wbindgen_throw:Ire,__wbindgen_memory:Mre}},tre),Gl=M.memory,Are=M.version,Tre=M.__wbg_rawkinematiccharactercontroller_free,jre=M.rawkinematiccharactercontroller_new,gu=M.rawkinematiccharactercontroller_up,Rre=M.rawkinematiccharactercontroller_setUp,Ore=M.rawkinematiccharactercontroller_offset,Dre=M.rawkinematiccharactercontroller_setOffset,Lre=M.rawkinematiccharactercontroller_slideEnabled,zre=M.rawkinematiccharactercontroller_setSlideEnabled,Nre=M.rawkinematiccharactercontroller_autostepMaxHeight,Fre=M.rawkinematiccharactercontroller_autostepMinWidth,$re=M.rawkinematiccharactercontroller_autostepIncludesDynamicBodies,Bre=M.rawkinematiccharactercontroller_autostepEnabled,Ure=M.rawkinematiccharactercontroller_enableAutostep,Vre=M.rawkinematiccharactercontroller_disableAutostep,Hre=M.rawkinematiccharactercontroller_minSlopeSlideAngle,Wre=M.rawkinematiccharactercontroller_setMinSlopeSlideAngle,Kre=M.rawkinematiccharactercontroller_snapToGroundDistance,Gre=M.rawkinematiccharactercontroller_enableSnapToGround,Yre=M.rawkinematiccharactercontroller_disableSnapToGround,Xre=M.rawkinematiccharactercontroller_snapToGroundEnabled,qre=M.rawkinematiccharactercontroller_computeColliderMovement,Jre=M.rawkinematiccharactercontroller_computedMovement,Zre=M.rawkinematiccharactercontroller_computedGrounded,Qre=M.rawkinematiccharactercontroller_numComputedCollisions,eie=M.rawkinematiccharactercontroller_computedCollision,tie=M.__wbg_rawcharactercollision_free,nie=M.rawcharactercollision_new,rie=M.rawcharactercollision_handle,mu=M.rawcharactercollision_translationApplied,wR=M.rawcharactercollision_translationRemaining,iie=M.rawcharactercollision_toi,oie=M.rawcharactercollision_worldWitness1,sie=M.rawcharactercollision_worldWitness2,aie=M.rawcharactercollision_worldNormal1,lie=M.rawcharactercollision_worldNormal2,cie=M.__wbg_rawccdsolver_free,die=M.rawccdsolver_new,uie=M.rawimpulsejointset_jointType,hie=M.rawimpulsejointset_jointBodyHandle1,pie=M.rawimpulsejointset_jointBodyHandle2,fie=M.rawimpulsejointset_jointFrameX1,gie=M.rawimpulsejointset_jointFrameX2,mie=M.rawimpulsejointset_jointAnchor1,yie=M.rawimpulsejointset_jointAnchor2,wie=M.rawimpulsejointset_jointSetAnchor1,bie=M.rawimpulsejointset_jointSetAnchor2,vie=M.rawimpulsejointset_jointContactsEnabled,Sie=M.rawimpulsejointset_jointSetContactsEnabled,xie=M.rawimpulsejointset_jointLimitsEnabled,_ie=M.rawimpulsejointset_jointLimitsMin,kie=M.rawimpulsejointset_jointLimitsMax,Cie=M.rawimpulsejointset_jointSetLimits,Pie=M.rawimpulsejointset_jointConfigureMotorModel,Eie=M.rawimpulsejointset_jointConfigureMotorVelocity,Iie=M.rawimpulsejointset_jointConfigureMotorPosition,Mie=M.rawimpulsejointset_jointConfigureMotor,Aie=M.__wbg_rawimpulsejointset_free,Tie=M.rawimpulsejointset_new,jie=M.rawimpulsejointset_createJoint,Rie=M.rawimpulsejointset_remove,Oie=M.rawimpulsejointset_len,Die=M.rawimpulsejointset_contains,Lie=M.rawimpulsejointset_forEachJointHandle,zie=M.rawimpulsejointset_forEachJointAttachedToRigidBody,Nie=M.__wbg_rawintegrationparameters_free,Fie=M.rawintegrationparameters_new,G1=M.rawintegrationparameters_dt,bR=M.rawintegrationparameters_erp,Y1=M.rawintegrationparameters_allowedLinearError,$ie=M.rawintegrationparameters_maxVelocityIterations,Bie=M.rawintegrationparameters_maxVelocityFrictionIterations,Uie=M.rawintegrationparameters_maxStabilizationIterations,Vie=M.rawintegrationparameters_minIslandSize,Hie=M.rawintegrationparameters_maxCcdSubsteps,vR=M.rawintegrationparameters_set_dt,Wie=M.rawintegrationparameters_set_erp,SR=M.rawintegrationparameters_set_allowedLinearError,Kie=M.rawintegrationparameters_set_predictionDistance,Gie=M.rawintegrationparameters_set_maxVelocityIterations,Yie=M.rawintegrationparameters_set_maxVelocityFrictionIterations,Xie=M.rawintegrationparameters_set_maxStabilizationIterations,qie=M.rawintegrationparameters_set_minIslandSize,Jie=M.rawintegrationparameters_set_maxCcdSubsteps,Zie=M.__wbg_rawislandmanager_free,Qie=M.rawislandmanager_new,eoe=M.rawislandmanager_forEachActiveRigidBodyHandle,toe=M.__wbg_rawgenericjoint_free,noe=M.rawgenericjoint_prismatic,roe=M.rawgenericjoint_fixed,ioe=M.rawgenericjoint_revolute,ooe=M.rawmultibodyjointset_jointType,soe=M.rawmultibodyjointset_jointFrameX1,aoe=M.rawmultibodyjointset_jointFrameX2,loe=M.rawmultibodyjointset_jointAnchor1,coe=M.rawmultibodyjointset_jointAnchor2,doe=M.rawmultibodyjointset_jointContactsEnabled,uoe=M.rawmultibodyjointset_jointSetContactsEnabled,hoe=M.rawmultibodyjointset_jointLimitsEnabled,poe=M.rawmultibodyjointset_jointLimitsMin,foe=M.rawmultibodyjointset_jointLimitsMax,goe=M.__wbg_rawmultibodyjointset_free,moe=M.rawmultibodyjointset_new,yoe=M.rawmultibodyjointset_createJoint,woe=M.rawmultibodyjointset_remove,boe=M.rawmultibodyjointset_contains,voe=M.rawmultibodyjointset_forEachJointHandle,Soe=M.rawmultibodyjointset_forEachJointAttachedToRigidBody,xoe=M.rawrigidbodyset_rbTranslation,_oe=M.rawrigidbodyset_rbRotation,koe=M.rawrigidbodyset_rbSleep,Coe=M.rawrigidbodyset_rbIsSleeping,Poe=M.rawrigidbodyset_rbIsMoving,Eoe=M.rawrigidbodyset_rbNextTranslation,Ioe=M.rawrigidbodyset_rbNextRotation,Moe=M.rawrigidbodyset_rbSetTranslation,Aoe=M.rawrigidbodyset_rbSetRotation,Toe=M.rawrigidbodyset_rbSetLinvel,joe=M.rawrigidbodyset_rbSetAngvel,Roe=M.rawrigidbodyset_rbSetNextKinematicTranslation,Ooe=M.rawrigidbodyset_rbSetNextKinematicRotation,Doe=M.rawrigidbodyset_rbRecomputeMassPropertiesFromColliders,Loe=M.rawrigidbodyset_rbSetAdditionalMass,zoe=M.rawrigidbodyset_rbSetAdditionalMassProperties,Noe=M.rawrigidbodyset_rbLinvel,Foe=M.rawrigidbodyset_rbAngvel,$oe=M.rawrigidbodyset_rbLockTranslations,Boe=M.rawrigidbodyset_rbSetEnabledTranslations,Uoe=M.rawrigidbodyset_rbLockRotations,Voe=M.rawrigidbodyset_rbDominanceGroup,Hoe=M.rawrigidbodyset_rbSetDominanceGroup,Woe=M.rawrigidbodyset_rbEnableCcd,Koe=M.rawrigidbodyset_rbMass,Goe=M.rawrigidbodyset_rbInvMass,Yoe=M.rawrigidbodyset_rbEffectiveInvMass,Xoe=M.rawrigidbodyset_rbLocalCom,qoe=M.rawrigidbodyset_rbWorldCom,Joe=M.rawrigidbodyset_rbInvPrincipalInertiaSqrt,Zoe=M.rawrigidbodyset_rbPrincipalInertia,Qoe=M.rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt,ese=M.rawrigidbodyset_rbEffectiveAngularInertia,tse=M.rawrigidbodyset_rbWakeUp,nse=M.rawrigidbodyset_rbIsCcdEnabled,rse=M.rawrigidbodyset_rbNumColliders,ise=M.rawrigidbodyset_rbCollider,ose=M.rawrigidbodyset_rbBodyType,sse=M.rawrigidbodyset_rbSetBodyType,ase=M.rawrigidbodyset_rbIsFixed,lse=M.rawrigidbodyset_rbIsKinematic,cse=M.rawrigidbodyset_rbIsDynamic,dse=M.rawrigidbodyset_rbLinearDamping,use=M.rawrigidbodyset_rbAngularDamping,hse=M.rawrigidbodyset_rbSetLinearDamping,pse=M.rawrigidbodyset_rbSetAngularDamping,fse=M.rawrigidbodyset_rbSetEnabled,gse=M.rawrigidbodyset_rbIsEnabled,mse=M.rawrigidbodyset_rbGravityScale,yse=M.rawrigidbodyset_rbSetGravityScale,wse=M.rawrigidbodyset_rbResetForces,bse=M.rawrigidbodyset_rbResetTorques,vse=M.rawrigidbodyset_rbAddForce,Sse=M.rawrigidbodyset_rbApplyImpulse,xse=M.rawrigidbodyset_rbAddTorque,_se=M.rawrigidbodyset_rbApplyTorqueImpulse,kse=M.rawrigidbodyset_rbAddForceAtPoint,Cse=M.rawrigidbodyset_rbApplyImpulseAtPoint,Pse=M.rawrigidbodyset_rbUserData,Ese=M.rawrigidbodyset_rbSetUserData,Ise=M.__wbg_rawrigidbodyset_free,Mse=M.rawrigidbodyset_new,Ase=M.rawrigidbodyset_createRigidBody,Tse=M.rawrigidbodyset_remove,jse=M.rawrigidbodyset_len,Rse=M.rawrigidbodyset_contains,Ose=M.rawrigidbodyset_forEachRigidBodyHandle,Dse=M.rawrigidbodyset_propagateModifiedBodyPositionsToColliders,Lse=M.__wbg_rawbroadphase_free,zse=M.rawbroadphase_new,Nse=M.rawcolliderset_coTranslation,Fse=M.rawcolliderset_coRotation,$se=M.rawcolliderset_coSetTranslation,Bse=M.rawcolliderset_coSetTranslationWrtParent,Use=M.rawcolliderset_coSetRotation,Vse=M.rawcolliderset_coSetRotationWrtParent,Hse=M.rawcolliderset_coIsSensor,Wse=M.rawcolliderset_coShapeType,Kse=M.rawcolliderset_coHalfspaceNormal,Gse=M.rawcolliderset_coHalfExtents,Yse=M.rawcolliderset_coSetHalfExtents,Xse=M.rawcolliderset_coRadius,qse=M.rawcolliderset_coSetRadius,Jse=M.rawcolliderset_coHalfHeight,Zse=M.rawcolliderset_coSetHalfHeight,Qse=M.rawcolliderset_coRoundRadius,eae=M.rawcolliderset_coSetRoundRadius,tae=M.rawcolliderset_coVertices,nae=M.rawcolliderset_coIndices,rae=M.rawcolliderset_coHeightfieldHeights,iae=M.rawcolliderset_coHeightfieldScale,oae=M.rawcolliderset_coParent,sae=M.rawcolliderset_coSetEnabled,aae=M.rawcolliderset_coIsEnabled,lae=M.rawcolliderset_coFriction,cae=M.rawcolliderset_coRestitution,dae=M.rawcolliderset_coDensity,uae=M.rawcolliderset_coMass,hae=M.rawcolliderset_coVolume,pae=M.rawcolliderset_coCollisionGroups,fae=M.rawcolliderset_coSolverGroups,gae=M.rawcolliderset_coActiveHooks,mae=M.rawcolliderset_coActiveCollisionTypes,yae=M.rawcolliderset_coActiveEvents,wae=M.rawcolliderset_coContactForceEventThreshold,bae=M.rawcolliderset_coContainsPoint,vae=M.rawcolliderset_coCastShape,Sae=M.rawcolliderset_coCastCollider,xae=M.rawcolliderset_coIntersectsShape,_ae=M.rawcolliderset_coContactShape,kae=M.rawcolliderset_coContactCollider,Cae=M.rawcolliderset_coProjectPoint,Pae=M.rawcolliderset_coIntersectsRay,Eae=M.rawcolliderset_coCastRay,Iae=M.rawcolliderset_coCastRayAndGetNormal,Mae=M.rawcolliderset_coSetSensor,Aae=M.rawcolliderset_coSetRestitution,Tae=M.rawcolliderset_coSetFriction,jae=M.rawcolliderset_coFrictionCombineRule,Rae=M.rawcolliderset_coSetFrictionCombineRule,Oae=M.rawcolliderset_coRestitutionCombineRule,Dae=M.rawcolliderset_coSetRestitutionCombineRule,Lae=M.rawcolliderset_coSetCollisionGroups,zae=M.rawcolliderset_coSetSolverGroups,Nae=M.rawcolliderset_coSetActiveHooks,Fae=M.rawcolliderset_coSetActiveEvents,$ae=M.rawcolliderset_coSetActiveCollisionTypes,Bae=M.rawcolliderset_coSetShape,Uae=M.rawcolliderset_coSetContactForceEventThreshold,Vae=M.rawcolliderset_coSetDensity,Hae=M.rawcolliderset_coSetMass,Wae=M.rawcolliderset_coSetMassProperties,Kae=M.__wbg_rawcolliderset_free,Gae=M.rawcolliderset_new,Yae=M.rawcolliderset_len,xR=M.rawcolliderset_contains,Xae=M.rawcolliderset_createCollider,qae=M.rawcolliderset_remove,Jae=M.rawcolliderset_forEachColliderHandle,Zae=M.__wbg_rawshapecontact_free,Qae=M.__wbg_rawnarrowphase_free,ele=M.rawnarrowphase_new,tle=M.rawnarrowphase_contacts_with,nle=M.rawnarrowphase_contact_pair,rle=M.rawnarrowphase_intersections_with,ile=M.rawnarrowphase_intersection_pair,ole=M.__wbg_rawcontactmanifold_free,sle=M.rawcontactpair_collider1,ale=M.rawcontactpair_collider2,lle=M.rawcontactpair_numContactManifolds,cle=M.rawcontactpair_contactManifold,dle=M.rawcontactmanifold_normal,ule=M.rawcontactmanifold_local_n1,hle=M.rawcontactmanifold_local_n2,ple=M.rawcontactmanifold_subshape1,fle=M.rawcontactmanifold_subshape2,gle=M.rawcontactmanifold_num_contacts,mle=M.rawcontactmanifold_contact_local_p1,yle=M.rawcontactmanifold_contact_local_p2,wle=M.rawcontactmanifold_contact_dist,ble=M.rawcontactmanifold_contact_fid1,vle=M.rawcontactmanifold_contact_fid2,Sle=M.rawcontactmanifold_contact_impulse,xle=M.rawcontactmanifold_contact_tangent_impulse,_le=M.rawcontactmanifold_num_solver_contacts,kle=M.rawcontactmanifold_solver_contact_point,Cle=M.rawcontactmanifold_solver_contact_dist,Ple=M.rawcontactmanifold_solver_contact_friction,Ele=M.rawcontactmanifold_solver_contact_restitution,Ile=M.rawcontactmanifold_solver_contact_tangent_velocity,Mle=M.__wbg_rawpointprojection_free,Ale=M.rawpointprojection_isInside,Tle=M.__wbg_rawpointcolliderprojection_free,jle=M.rawpointcolliderprojection_isInside,_R=M.rawpointcolliderprojection_featureType,kR=M.rawpointcolliderprojection_featureId,Rle=M.__wbg_rawrayintersection_free,Ole=M.rawrayintersection_toi,tm=M.rawraycolliderintersection_normal,Dle=M.rawraycolliderintersection_featureType,Lle=M.rawraycolliderintersection_featureId,zle=M.__wbg_rawshape_free,Nle=M.rawshape_cuboid,Fle=M.rawshape_roundCuboid,$le=M.rawshape_ball,Ble=M.rawshape_halfspace,Ule=M.rawshape_capsule,Vle=M.rawshape_polyline,Hle=M.rawshape_trimesh,Wle=M.rawshape_heightfield,Kle=M.rawshape_segment,Gle=M.rawshape_triangle,Yle=M.rawshape_roundTriangle,Xle=M.rawshape_convexHull,qle=M.rawshape_roundConvexHull,Jle=M.rawshape_convexPolyline,Zle=M.rawshape_roundConvexPolyline,Qle=M.rawshape_castShape,ece=M.rawshape_intersectsShape,tce=M.rawshape_contactShape,nce=M.rawshape_containsPoint,rce=M.rawshape_projectPoint,ice=M.rawshape_intersectsRay,oce=M.rawshape_castRay,sce=M.rawshape_castRayAndGetNormal,ace=M.__wbg_rawshapecollidertoi_free,lce=M.rawshapecollidertoi_toi,cce=M.__wbg_rawrotation_free,dce=M.rawrotation_identity,uce=M.rawrotation_fromAngle,CR=M.rawrotation_im,hce=M.rawrotation_angle,pce=M.rawvector_zero,fce=M.rawvector_new,gce=M.rawvector_set_y,mce=M.rawvector_xy,yce=M.rawvector_yx,wce=M.__wbg_rawdebugrenderpipeline_free,bce=M.rawdebugrenderpipeline_new,vce=M.rawdebugrenderpipeline_vertices,Sce=M.rawdebugrenderpipeline_colors,xce=M.rawdebugrenderpipeline_render,_ce=M.__wbg_raweventqueue_free,kce=M.__wbg_rawcontactforceevent_free,yu=M.rawcontactforceevent_collider1,Cce=M.rawcontactforceevent_collider2,wu=M.rawcontactforceevent_total_force,nm=M.rawcontactforceevent_total_force_magnitude,Pce=M.rawcontactforceevent_max_force_magnitude,Ece=M.raweventqueue_new,Ice=M.raweventqueue_drainCollisionEvents,Mce=M.raweventqueue_drainContactForceEvents,Ace=M.raweventqueue_clear,Tce=M.__wbg_rawphysicspipeline_free,jce=M.rawphysicspipeline_new,Rce=M.rawphysicspipeline_step,Oce=M.rawphysicspipeline_stepWithEvents,Dce=M.__wbg_rawquerypipeline_free,Lce=M.rawquerypipeline_new,zce=M.rawquerypipeline_update,Nce=M.rawquerypipeline_castRay,Fce=M.rawquerypipeline_castRayAndGetNormal,$ce=M.rawquerypipeline_intersectionsWithRay,Bce=M.rawquerypipeline_intersectionWithShape,Uce=M.rawquerypipeline_projectPoint,Vce=M.rawquerypipeline_projectPointAndGetFeature,Hce=M.rawquerypipeline_intersectionsWithPoint,Wce=M.rawquerypipeline_castShape,Kce=M.rawquerypipeline_intersectionsWithShape,Gce=M.rawquerypipeline_collidersWithAabbIntersectingAabb,Yce=M.__wbg_rawdeserializedworld_free,Xce=M.rawdeserializedworld_takeGravity,qce=M.rawdeserializedworld_takeIntegrationParameters,Jce=M.rawdeserializedworld_takeIslandManager,Zce=M.rawdeserializedworld_takeBroadPhase,Qce=M.rawdeserializedworld_takeNarrowPhase,ede=M.rawdeserializedworld_takeBodies,tde=M.rawdeserializedworld_takeColliders,nde=M.rawdeserializedworld_takeImpulseJoints,rde=M.rawdeserializedworld_takeMultibodyJoints,ide=M.rawserializationpipeline_serializeAll,ode=M.rawserializationpipeline_deserializeAll,sde=M.__wbg_rawcontactpair_free,ade=M.__wbg_rawraycolliderintersection_free,lde=M.__wbg_rawraycollidertoi_free,cde=M.__wbg_rawvector_free,dde=M.__wbg_rawshapetoi_free;M.rawkinematiccharactercontroller_setMaxSlopeClimbAngle,M.rawvector_set_x,M.rawcolliderset_isHandleValid,M.rawrayintersection_featureType,M.rawrayintersection_featureId,M.rawshapecontact_point1,M.rawshapecontact_normal2,M.rawpointprojection_point,M.rawshapecontact_normal1,M.rawrayintersection_normal,M.rawshapecontact_point2,M.rawshapetoi_witness1,M.rawshapetoi_witness2,M.rawshapetoi_normal1,M.rawshapetoi_normal2,M.rawshapecollidertoi_witness1,M.rawshapecollidertoi_witness2,M.rawshapecollidertoi_normal1,M.rawshapecollidertoi_normal2,M.rawpointcolliderprojection_point,M.rawcontactforceevent_max_force_direction;const ude=M.rawserializationpipeline_new;M.rawkinematiccharactercontroller_maxSlopeClimbAngle,M.rawshapecontact_distance,M.rawraycolliderintersection_toi,M.rawraycollidertoi_toi,M.rawshapetoi_toi,M.rawrotation_re,M.rawvector_x,M.rawvector_y,M.rawintegrationparameters_predictionDistance,M.rawraycolliderintersection_colliderHandle,M.rawraycollidertoi_colliderHandle,M.rawshapecollidertoi_colliderHandle,M.rawpointcolliderprojection_colliderHandle;const hde=M.__wbg_rawserializationpipeline_free,De=M.__wbindgen_add_to_stack_pointer,rm=M.__wbindgen_free,wo=M.__wbindgen_malloc,pde=M.__wbindgen_exn_store;class PR{constructor(e,t){this.x=e,this.y=t}}class U{static new(e,t){return new PR(e,t)}static zeros(){return U.new(0,0)}static fromRaw(e){if(!e)return null;let t=U.new(e.x,e.y);return e.free(),t}static intoRaw(e){return new V(e.x,e.y)}static copy(e,t){e.x=t.x,e.y=t.y}}class Qe{static identity(){return 0}static fromRaw(e){if(!e)return null;let t=e.angle;return e.free(),t}static intoRaw(e){return Re.fromAngle(e)}}var oi;(function(n){n[n.Dynamic=0]="Dynamic",n[n.Fixed=1]="Fixed",n[n.KinematicPositionBased=2]="KinematicPositionBased",n[n.KinematicVelocityBased=3]="KinematicVelocityBased"})(oi||(oi={}));class X1{constructor(e,t,r){this.rawSet=e,this.colliderSet=t,this.handle=r}finalizeDeserialization(e){this.colliderSet=e}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(e,t){return this.rawSet.rbLockTranslations(this.handle,e,t)}lockRotations(e,t){return this.rawSet.rbLockRotations(this.handle,e,t)}setEnabledTranslations(e,t,r){return this.rawSet.rbSetEnabledTranslations(this.handle,e,t,r)}restrictTranslations(e,t,r){this.setEnabledTranslations(e,e,r)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(e){this.rawSet.rbSetDominanceGroup(this.handle,e)}enableCcd(e){this.rawSet.rbEnableCcd(this.handle,e)}translation(){let e=this.rawSet.rbTranslation(this.handle);return U.fromRaw(e)}rotation(){let e=this.rawSet.rbRotation(this.handle);return Qe.fromRaw(e)}nextTranslation(){let e=this.rawSet.rbNextTranslation(this.handle);return U.fromRaw(e)}nextRotation(){let e=this.rawSet.rbNextRotation(this.handle);return Qe.fromRaw(e)}setTranslation(e,t){this.rawSet.rbSetTranslation(this.handle,e.x,e.y,t)}setLinvel(e,t){let r=U.intoRaw(e);this.rawSet.rbSetLinvel(this.handle,r,t),r.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(e,t){this.rawSet.rbSetGravityScale(this.handle,e,t)}setRotation(e,t){this.rawSet.rbSetRotation(this.handle,e,t)}setAngvel(e,t){this.rawSet.rbSetAngvel(this.handle,e,t)}setNextKinematicTranslation(e){this.rawSet.rbSetNextKinematicTranslation(this.handle,e.x,e.y)}setNextKinematicRotation(e){this.rawSet.rbSetNextKinematicRotation(this.handle,e)}linvel(){return U.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return this.rawSet.rbAngvel(this.handle)}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return U.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return U.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return U.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return this.rawSet.rbInvPrincipalInertiaSqrt(this.handle)}principalInertia(){return this.rawSet.rbPrincipalInertia(this.handle)}effectiveWorldInvInertiaSqrt(){return this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle)}effectiveAngularInertia(){return this.rawSet.rbEffectiveAngularInertia(this.handle)}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(e){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,e))}setEnabled(e){this.rawSet.rbSetEnabled(this.handle,e)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(e,t){return this.rawSet.rbSetBodyType(this.handle,e,t)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(e){this.rawSet.rbSetLinearDamping(this.handle,e)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(e,t){this.rawSet.rbSetAdditionalMass(this.handle,e,t)}setAdditionalMassProperties(e,t,r,i){let o=U.intoRaw(t);this.rawSet.rbSetAdditionalMassProperties(this.handle,e,o,r,i),o.free()}setAngularDamping(e){this.rawSet.rbSetAngularDamping(this.handle,e)}resetForces(e){this.rawSet.rbResetForces(this.handle,e)}resetTorques(e){this.rawSet.rbResetTorques(this.handle,e)}addForce(e,t){const r=U.intoRaw(e);this.rawSet.rbAddForce(this.handle,r,t),r.free()}applyImpulse(e,t){const r=U.intoRaw(e);this.rawSet.rbApplyImpulse(this.handle,r,t),r.free()}addTorque(e,t){this.rawSet.rbAddTorque(this.handle,e,t)}applyTorqueImpulse(e,t){this.rawSet.rbApplyTorqueImpulse(this.handle,e,t)}addForceAtPoint(e,t,r){const i=U.intoRaw(e),o=U.intoRaw(t);this.rawSet.rbAddForceAtPoint(this.handle,i,o,r),i.free(),o.free()}applyImpulseAtPoint(e,t,r){const i=U.intoRaw(e),o=U.intoRaw(t);this.rawSet.rbApplyImpulseAtPoint(this.handle,i,o,r),i.free(),o.free()}}class Di{constructor(e){this.enabled=!0,this.status=e,this.translation=U.zeros(),this.rotation=Qe.identity(),this.gravityScale=1,this.linvel=U.zeros(),this.mass=0,this.massOnly=!1,this.centerOfMass=U.zeros(),this.translationsEnabledX=!0,this.translationsEnabledY=!0,this.angvel=0,this.principalAngularInertia=0,this.rotationsEnabled=!0,this.linearDamping=0,this.angularDamping=0,this.canSleep=!0,this.sleeping=!1,this.ccdEnabled=!1,this.dominanceGroup=0}static dynamic(){return new Di(oi.Dynamic)}static kinematicPositionBased(){return new Di(oi.KinematicPositionBased)}static kinematicVelocityBased(){return new Di(oi.KinematicVelocityBased)}static fixed(){return new Di(oi.Fixed)}static newDynamic(){return new Di(oi.Dynamic)}static newKinematicPositionBased(){return new Di(oi.KinematicPositionBased)}static newKinematicVelocityBased(){return new Di(oi.KinematicVelocityBased)}static newStatic(){return new Di(oi.Fixed)}setDominanceGroup(e){return this.dominanceGroup=e,this}setEnabled(e){return this.enabled=e,this}setTranslation(e,t){if(typeof e!="number"||typeof t!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:t},this}setRotation(e){return this.rotation=e,this}setGravityScale(e){return this.gravityScale=e,this}setAdditionalMass(e){return this.mass=e,this.massOnly=!0,this}setLinvel(e,t){if(typeof e!="number"||typeof t!="number")throw TypeError("The linvel components must be numbers.");return this.linvel={x:e,y:t},this}setAngvel(e){return this.angvel=e,this}setAdditionalMassProperties(e,t,r){return this.mass=e,U.copy(this.centerOfMass,t),this.principalAngularInertia=r,this.massOnly=!1,this}enabledTranslations(e,t){return this.translationsEnabledX=e,this.translationsEnabledY=t,this}restrictTranslations(e,t){return this.enabledTranslations(e,t)}lockTranslations(){return this.restrictTranslations(!1,!1)}lockRotations(){return this.rotationsEnabled=!1,this}setLinearDamping(e){return this.linearDamping=e,this}setAngularDamping(e){return this.angularDamping=e,this}setCanSleep(e){return this.canSleep=e,this}setSleeping(e){return this.sleeping=e,this}setCcdEnabled(e){return this.ccdEnabled=e,this}setUserData(e){return this.userData=e,this}}class im{constructor(){this.fconv=new Float64Array(1),this.uconv=new Uint32Array(this.fconv.buffer),this.data=new Array,this.size=0}set(e,t){let r=this.index(e);for(;this.data.length<=r;)this.data.push(null);this.data[r]==null&&(this.size+=1),this.data[r]=t}len(){return this.size}delete(e){let t=this.index(e);t<this.data.length&&(this.data[t]!=null&&(this.size-=1),this.data[t]=null)}clear(){this.data=new Array}get(e){let t=this.index(e);return t<this.data.length?this.data[t]:null}forEach(e){for(const t of this.data)t!=null&&e(t)}getAll(){return this.data.filter(e=>e!=null)}index(e){return this.fconv[0]=e,this.uconv[0]}}class ER{constructor(e){this.raw=e||new Pt,this.map=new im,e&&e.forEachRigidBodyHandle(t=>{this.map.set(t,new X1(e,null,t))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}finalizeDeserialization(e){this.map.forEach(t=>t.finalizeDeserialization(e))}createRigidBody(e,t){let r=U.intoRaw(t.translation),i=Qe.intoRaw(t.rotation),o=U.intoRaw(t.linvel),s=U.intoRaw(t.centerOfMass),a=this.raw.createRigidBody(t.enabled,r,i,t.gravityScale,t.mass,t.massOnly,s,o,t.angvel,t.principalAngularInertia,t.translationsEnabledX,t.translationsEnabledY,t.rotationsEnabled,t.linearDamping,t.angularDamping,t.status,t.canSleep,t.sleeping,t.ccdEnabled,t.dominanceGroup);r.free(),i.free(),o.free(),s.free();const l=new X1(this.raw,e,a);return l.userData=t.userData,this.map.set(a,l),l}remove(e,t,r,i,o){for(let s=0;s<this.raw.rbNumColliders(e);s+=1)r.unmap(this.raw.rbCollider(e,s));i.forEachJointHandleAttachedToRigidBody(e,s=>i.unmap(s)),o.forEachJointHandleAttachedToRigidBody(e,s=>o.unmap(s)),this.raw.remove(e,t.raw,r.raw,i.raw,o.raw),this.map.delete(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}get(e){return this.map.get(e)}forEach(e){this.map.forEach(e)}forEachActiveRigidBody(e,t){e.forEachActiveRigidBodyHandle(r=>{t(this.get(r))})}getAll(){return this.map.getAll()}}class IR{constructor(e){this.raw=e||new gs}free(){this.raw&&this.raw.free(),this.raw=void 0}get dt(){return this.raw.dt}get erp(){return this.raw.erp}get allowedLinearError(){return this.raw.allowedLinearError}get predictionDistance(){return this.raw.predictionDistance}get maxVelocityIterations(){return this.raw.maxVelocityIterations}get maxVelocityFrictionIterations(){return this.raw.maxVelocityFrictionIterations}get maxStabilizationIterations(){return this.raw.maxStabilizationIterations}get minIslandSize(){return this.raw.minIslandSize}get maxCcdSubsteps(){return this.raw.maxCcdSubsteps}set dt(e){this.raw.dt=e}set erp(e){this.raw.erp=e}set allowedLinearError(e){this.raw.allowedLinearError=e}set predictionDistance(e){this.raw.predictionDistance=e}set maxVelocityIterations(e){this.raw.maxVelocityIterations=e}set maxVelocityFrictionIterations(e){this.raw.maxVelocityFrictionIterations=e}set maxStabilizationIterations(e){this.raw.maxStabilizationIterations=e}set minIslandSize(e){this.raw.minIslandSize=e}set maxCcdSubsteps(e){this.raw.maxCcdSubsteps=e}}var Tn;(function(n){n[n.Revolute=0]="Revolute",n[n.Fixed=1]="Fixed",n[n.Prismatic=2]="Prismatic"})(Tn||(Tn={}));var q1;(function(n){n[n.AccelerationBased=0]="AccelerationBased",n[n.ForceBased=1]="ForceBased"})(q1||(q1={}));class oa{constructor(e,t,r){this.rawSet=e,this.bodySet=t,this.handle=r}static newTyped(e,t,r){switch(e.jointType(r)){case Tn.Revolute:return new TR(e,t,r);case Tn.Prismatic:return new AR(e,t,r);case Tn.Fixed:return new MR(e,t,r);default:return new oa(e,t,r)}}finalizeDeserialization(e){this.bodySet=e}isValid(){return this.rawSet.contains(this.handle)}body1(){return this.bodySet.get(this.rawSet.jointBodyHandle1(this.handle))}body2(){return this.bodySet.get(this.rawSet.jointBodyHandle2(this.handle))}type(){return this.rawSet.jointType(this.handle)}anchor1(){return U.fromRaw(this.rawSet.jointAnchor1(this.handle))}anchor2(){return U.fromRaw(this.rawSet.jointAnchor2(this.handle))}setAnchor1(e){const t=U.intoRaw(e);this.rawSet.jointSetAnchor1(this.handle,t),t.free()}setAnchor2(e){const t=U.intoRaw(e);this.rawSet.jointSetAnchor2(this.handle,t),t.free()}setContactsEnabled(e){this.rawSet.jointSetContactsEnabled(this.handle,e)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class J1 extends oa{limitsEnabled(){return this.rawSet.jointLimitsEnabled(this.handle,this.rawAxis())}limitsMin(){return this.rawSet.jointLimitsMin(this.handle,this.rawAxis())}limitsMax(){return this.rawSet.jointLimitsMax(this.handle,this.rawAxis())}setLimits(e,t){this.rawSet.jointSetLimits(this.handle,this.rawAxis(),e,t)}configureMotorModel(e){this.rawSet.jointConfigureMotorModel(this.handle,this.rawAxis(),e)}configureMotorVelocity(e,t){this.rawSet.jointConfigureMotorVelocity(this.handle,this.rawAxis(),e,t)}configureMotorPosition(e,t,r){this.rawSet.jointConfigureMotorPosition(this.handle,this.rawAxis(),e,t,r)}configureMotor(e,t,r,i){this.rawSet.jointConfigureMotor(this.handle,this.rawAxis(),e,t,r,i)}}class MR extends oa{}class AR extends J1{rawAxis(){return Hg.X}}class TR extends J1{rawAxis(){return Hg.AngX}}class bu{constructor(){}static fixed(e,t,r,i){let o=new bu;return o.anchor1=e,o.anchor2=r,o.frame1=t,o.frame2=i,o.jointType=Tn.Fixed,o}static revolute(e,t){let r=new bu;return r.anchor1=e,r.anchor2=t,r.jointType=Tn.Revolute,r}static prismatic(e,t,r){let i=new bu;return i.anchor1=e,i.anchor2=t,i.axis=r,i.jointType=Tn.Prismatic,i}intoRaw(){let e=U.intoRaw(this.anchor1),t=U.intoRaw(this.anchor2),r,i,o=!1,s=0,a=0;switch(this.jointType){case Tn.Fixed:let l=Qe.intoRaw(this.frame1),c=Qe.intoRaw(this.frame2);i=Ti.fixed(e,l,t,c),l.free(),c.free();break;case Tn.Prismatic:r=U.intoRaw(this.axis),this.limitsEnabled&&(o=!0,s=this.limits[0],a=this.limits[1]),i=Ti.prismatic(e,t,r,o,s,a),r.free();break;case Tn.Revolute:i=Ti.revolute(e,t);break}return e.free(),t.free(),i}}class jR{constructor(e){this.raw=e||new ji,this.map=new im,e&&e.forEachJointHandle(t=>{this.map.set(t,oa.newTyped(e,null,t))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}finalizeDeserialization(e){this.map.forEach(t=>t.finalizeDeserialization(e))}createJoint(e,t,r,i,o){const s=t.intoRaw(),a=this.raw.createJoint(s,r,i,o);s.free();let l=oa.newTyped(this.raw,e,a);return this.map.set(a,l),l}remove(e,t){this.raw.remove(e,t),this.unmap(e)}forEachJointHandleAttachedToRigidBody(e,t){this.raw.forEachJointAttachedToRigidBody(e,t)}unmap(e){this.map.delete(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}get(e){return this.map.get(e)}forEach(e){this.map.forEach(e)}getAll(){return this.map.getAll()}}class sa{constructor(e,t){this.rawSet=e,this.handle=t}static newTyped(e,t){switch(e.jointType(t)){case Tn.Revolute:return new DR(e,t);case Tn.Prismatic:return new OR(e,t);case Tn.Fixed:return new RR(e,t);default:return new sa(e,t)}}isValid(){return this.rawSet.contains(this.handle)}setContactsEnabled(e){this.rawSet.jointSetContactsEnabled(this.handle,e)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class Z1 extends sa{}class RR extends sa{}class OR extends Z1{rawAxis(){return Hg.X}}class DR extends Z1{rawAxis(){return Hg.AngX}}class LR{constructor(e){this.raw=e||new Oi,this.map=new im,e&&e.forEachJointHandle(t=>{this.map.set(t,sa.newTyped(this.raw,t))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}createJoint(e,t,r,i){const o=e.intoRaw(),s=this.raw.createJoint(o,t,r,i);o.free();let a=sa.newTyped(this.raw,s);return this.map.set(s,a),a}remove(e,t){this.raw.remove(e,t),this.map.delete(e)}unmap(e){this.map.delete(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}get(e){return this.map.get(e)}forEach(e){this.map.forEach(e)}forEachJointHandleAttachedToRigidBody(e,t){this.raw.forEachJointAttachedToRigidBody(e,t)}getAll(){return this.map.getAll()}}var vu;(function(n){n[n.Average=0]="Average",n[n.Min=1]="Min",n[n.Multiply=2]="Multiply",n[n.Max=3]="Max"})(vu||(vu={}));class zR{constructor(e){this.raw=e||new Kl}free(){this.raw&&this.raw.free(),this.raw=void 0}}class NR{constructor(e){this.raw=e||new Ri}free(){this.raw&&this.raw.free(),this.raw=void 0}forEachActiveRigidBodyHandle(e){this.raw.forEachActiveRigidBodyHandle(e)}}class FR{constructor(e){this.raw=e||new fs}free(){this.raw&&this.raw.free(),this.raw=void 0}}class $R{constructor(e){this.raw=e||new yo,this.tempManifold=new BR(null)}free(){this.raw&&this.raw.free(),this.raw=void 0}contactsWith(e,t){this.raw.contacts_with(e,t)}intersectionsWith(e,t){this.raw.intersections_with(e,t)}contactPair(e,t,r){const i=this.raw.contact_pair(e,t);if(i){const o=i.collider1()!=e;let s;for(s=0;s<i.numContactManifolds();++s)this.tempManifold.raw=i.contactManifold(s),this.tempManifold.raw&&r(this.tempManifold,o),this.tempManifold.free();i.free()}}intersectionPair(e,t){return this.raw.intersection_pair(e,t)}}class BR{constructor(e){this.raw=e}free(){this.raw&&this.raw.free(),this.raw=void 0}normal(){return U.fromRaw(this.raw.normal())}localNormal1(){return U.fromRaw(this.raw.local_n1())}localNormal2(){return U.fromRaw(this.raw.local_n2())}subshape1(){return this.raw.subshape1()}subshape2(){return this.raw.subshape2()}numContacts(){return this.raw.num_contacts()}localContactPoint1(e){return U.fromRaw(this.raw.contact_local_p1(e))}localContactPoint2(e){return U.fromRaw(this.raw.contact_local_p2(e))}contactDist(e){return this.raw.contact_dist(e)}contactFid1(e){return this.raw.contact_fid1(e)}contactFid2(e){return this.raw.contact_fid2(e)}contactImpulse(e){return this.raw.contact_impulse(e)}contactTangentImpulse(e){return this.raw.contact_tangent_impulse(e)}numSolverContacts(){return this.raw.num_solver_contacts()}solverContactPoint(e){return U.fromRaw(this.raw.solver_contact_point(e))}solverContactDist(e){return this.raw.solver_contact_dist(e)}solverContactFriction(e){return this.raw.solver_contact_friction(e)}solverContactRestitution(e){return this.raw.solver_contact_restitution(e)}solverContactTangentVelocity(e){return U.fromRaw(this.raw.solver_contact_tangent_velocity(e))}}class Yl{constructor(e,t,r,i,o){this.distance=e,this.point1=t,this.point2=r,this.normal1=i,this.normal2=o}static fromRaw(e){if(!e)return null;const t=new Yl(e.distance(),U.fromRaw(e.point1()),U.fromRaw(e.point2()),U.fromRaw(e.normal1()),U.fromRaw(e.normal2()));return e.free(),t}}var Xl;(function(n){n[n.Vertex=0]="Vertex",n[n.Face=1]="Face",n[n.Unknown=2]="Unknown"})(Xl||(Xl={}));class Su{constructor(e,t){this.point=e,this.isInside=t}static fromRaw(e){if(!e)return null;const t=new Su(U.fromRaw(e.point()),e.isInside());return e.free(),t}}class xu{constructor(e,t,r,i,o){this.featureType=Xl.Unknown,this.featureId=void 0,this.collider=e,this.point=t,this.isInside=r,o!==void 0&&(this.featureId=o),i!==void 0&&(this.featureType=i)}static fromRaw(e,t){if(!t)return null;const r=new xu(e.get(t.colliderHandle()),U.fromRaw(t.point()),t.isInside(),t.featureType(),t.featureId());return t.free(),r}}class fde{constructor(e,t){this.origin=e,this.dir=t}pointAt(e){return{x:this.origin.x+this.dir.x*e,y:this.origin.y+this.dir.y*e}}}class _u{constructor(e,t,r,i){this.featureType=Xl.Unknown,this.featureId=void 0,this.toi=e,this.normal=t,i!==void 0&&(this.featureId=i),r!==void 0&&(this.featureType=r)}static fromRaw(e){if(!e)return null;const t=new _u(e.toi(),U.fromRaw(e.normal()),e.featureType(),e.featureId());return e.free(),t}}class ku{constructor(e,t,r,i,o){this.featureType=Xl.Unknown,this.featureId=void 0,this.collider=e,this.toi=t,this.normal=r,o!==void 0&&(this.featureId=o),i!==void 0&&(this.featureType=i)}static fromRaw(e,t){if(!t)return null;const r=new ku(e.get(t.colliderHandle()),t.toi(),U.fromRaw(t.normal()),t.featureType(),t.featureId());return t.free(),r}}class om{constructor(e,t){this.collider=e,this.toi=t}static fromRaw(e,t){if(!t)return null;const r=new om(e.get(t.colliderHandle()),t.toi());return t.free(),r}}class ql{constructor(e,t,r,i,o){this.toi=e,this.witness1=t,this.witness2=r,this.normal1=i,this.normal2=o}static fromRaw(e,t){if(!t)return null;const r=new ql(t.toi(),U.fromRaw(t.witness1()),U.fromRaw(t.witness2()),U.fromRaw(t.normal1()),U.fromRaw(t.normal2()));return t.free(),r}}class Cu extends ql{constructor(e,t,r,i,o,s){super(t,r,i,o,s),this.collider=e}static fromRaw(e,t){if(!t)return null;const r=new Cu(e.get(t.colliderHandle()),t.toi(),U.fromRaw(t.witness1()),U.fromRaw(t.witness2()),U.fromRaw(t.normal1()),U.fromRaw(t.normal2()));return t.free(),r}}class jn{static fromRaw(e,t){const r=e.coShapeType(t);let i,o,s,a,l,c,d;switch(r){case Ye.Ball:return new Q1(e.coRadius(t));case Ye.Cuboid:return i=e.coHalfExtents(t),new tS(i.x,i.y);case Ye.RoundCuboid:return i=e.coHalfExtents(t),o=e.coRoundRadius(t),new nS(i.x,i.y,o);case Ye.Capsule:return l=e.coHalfHeight(t),c=e.coRadius(t),new rS(l,c);case Ye.Segment:return s=e.coVertices(t),new iS(U.new(s[0],s[1]),U.new(s[2],s[3]));case Ye.Polyline:return s=e.coVertices(t),a=e.coIndices(t),new aS(s,a);case Ye.Triangle:return s=e.coVertices(t),new oS(U.new(s[0],s[1]),U.new(s[2],s[3]),U.new(s[4],s[5]));case Ye.RoundTriangle:return s=e.coVertices(t),o=e.coRoundRadius(t),new sS(U.new(s[0],s[1]),U.new(s[2],s[3]),U.new(s[4],s[5]),o);case Ye.HalfSpace:return d=U.fromRaw(e.coHalfspaceNormal(t)),new eS(d);case Ye.TriMesh:return s=e.coVertices(t),a=e.coIndices(t),new lS(s,a);case Ye.HeightField:const u=e.coHeightfieldScale(t),h=e.coHeightfieldHeights(t);return new cS(h,u);case Ye.ConvexPolygon:return s=e.coVertices(t),new sm(s,!1);case Ye.RoundConvexPolygon:return s=e.coVertices(t),o=e.coRoundRadius(t),new am(s,o,!1);default:throw new Error("unknown shape type: "+r)}}castShape(e,t,r,i,o,s,a,l,c){let d=U.intoRaw(e),u=Qe.intoRaw(t),h=U.intoRaw(r),p=U.intoRaw(o),m=Qe.intoRaw(s),f=U.intoRaw(a),w=this.intoRaw(),S=i.intoRaw(),b=ql.fromRaw(null,w.castShape(d,u,h,S,p,m,f,l,c));return d.free(),u.free(),h.free(),p.free(),m.free(),f.free(),w.free(),S.free(),b}intersectsShape(e,t,r,i,o){let s=U.intoRaw(e),a=Qe.intoRaw(t),l=U.intoRaw(i),c=Qe.intoRaw(o),d=this.intoRaw(),u=r.intoRaw(),h=d.intersectsShape(s,a,u,l,c);return s.free(),a.free(),l.free(),c.free(),d.free(),u.free(),h}contactShape(e,t,r,i,o,s){let a=U.intoRaw(e),l=Qe.intoRaw(t),c=U.intoRaw(i),d=Qe.intoRaw(o),u=this.intoRaw(),h=r.intoRaw(),p=Yl.fromRaw(u.contactShape(a,l,h,c,d,s));return a.free(),l.free(),c.free(),d.free(),u.free(),h.free(),p}containsPoint(e,t,r){let i=U.intoRaw(e),o=Qe.intoRaw(t),s=U.intoRaw(r),a=this.intoRaw(),l=a.containsPoint(i,o,s);return i.free(),o.free(),s.free(),a.free(),l}projectPoint(e,t,r,i){let o=U.intoRaw(e),s=Qe.intoRaw(t),a=U.intoRaw(r),l=this.intoRaw(),c=Su.fromRaw(l.projectPoint(o,s,a,i));return o.free(),s.free(),a.free(),l.free(),c}intersectsRay(e,t,r,i){let o=U.intoRaw(t),s=Qe.intoRaw(r),a=U.intoRaw(e.origin),l=U.intoRaw(e.dir),c=this.intoRaw(),d=c.intersectsRay(o,s,a,l,i);return o.free(),s.free(),a.free(),l.free(),c.free(),d}castRay(e,t,r,i,o){let s=U.intoRaw(t),a=Qe.intoRaw(r),l=U.intoRaw(e.origin),c=U.intoRaw(e.dir),d=this.intoRaw(),u=d.castRay(s,a,l,c,i,o);return s.free(),a.free(),l.free(),c.free(),d.free(),u}castRayAndGetNormal(e,t,r,i,o){let s=U.intoRaw(t),a=Qe.intoRaw(r),l=U.intoRaw(e.origin),c=U.intoRaw(e.dir),d=this.intoRaw(),u=_u.fromRaw(d.castRayAndGetNormal(s,a,l,c,i,o));return s.free(),a.free(),l.free(),c.free(),d.free(),u}}var Ye;(function(n){n[n.Ball=0]="Ball",n[n.Cuboid=1]="Cuboid",n[n.Capsule=2]="Capsule",n[n.Segment=3]="Segment",n[n.Polyline=4]="Polyline",n[n.Triangle=5]="Triangle",n[n.TriMesh=6]="TriMesh",n[n.HeightField=7]="HeightField",n[n.ConvexPolygon=9]="ConvexPolygon",n[n.RoundCuboid=10]="RoundCuboid",n[n.RoundTriangle=11]="RoundTriangle",n[n.RoundConvexPolygon=12]="RoundConvexPolygon",n[n.HalfSpace=13]="HalfSpace"})(Ye||(Ye={}));class Q1 extends jn{constructor(e){super(),this.type=Ye.Ball,this.radius=e}intoRaw(){return xe.ball(this.radius)}}class eS extends jn{constructor(e){super(),this.type=Ye.HalfSpace,this.normal=e}intoRaw(){let e=U.intoRaw(this.normal),t=xe.halfspace(e);return e.free(),t}}class tS extends jn{constructor(e,t){super(),this.type=Ye.Cuboid,this.halfExtents=U.new(e,t)}intoRaw(){return xe.cuboid(this.halfExtents.x,this.halfExtents.y)}}class nS extends jn{constructor(e,t,r){super(),this.type=Ye.RoundCuboid,this.halfExtents=U.new(e,t),this.borderRadius=r}intoRaw(){return xe.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.borderRadius)}}class rS extends jn{constructor(e,t){super(),this.type=Ye.Capsule,this.halfHeight=e,this.radius=t}intoRaw(){return xe.capsule(this.halfHeight,this.radius)}}class iS extends jn{constructor(e,t){super(),this.type=Ye.Segment,this.a=e,this.b=t}intoRaw(){let e=U.intoRaw(this.a),t=U.intoRaw(this.b),r=xe.segment(e,t);return e.free(),t.free(),r}}class oS extends jn{constructor(e,t,r){super(),this.type=Ye.Triangle,this.a=e,this.b=t,this.c=r}intoRaw(){let e=U.intoRaw(this.a),t=U.intoRaw(this.b),r=U.intoRaw(this.c),i=xe.triangle(e,t,r);return e.free(),t.free(),r.free(),i}}class sS extends jn{constructor(e,t,r,i){super(),this.type=Ye.RoundTriangle,this.a=e,this.b=t,this.c=r,this.borderRadius=i}intoRaw(){let e=U.intoRaw(this.a),t=U.intoRaw(this.b),r=U.intoRaw(this.c),i=xe.roundTriangle(e,t,r,this.borderRadius);return e.free(),t.free(),r.free(),i}}class aS extends jn{constructor(e,t){super(),this.type=Ye.Polyline,this.vertices=e,this.indices=t??new Uint32Array(0)}intoRaw(){return xe.polyline(this.vertices,this.indices)}}class lS extends jn{constructor(e,t){super(),this.type=Ye.TriMesh,this.vertices=e,this.indices=t}intoRaw(){return xe.trimesh(this.vertices,this.indices)}}class sm extends jn{constructor(e,t){super(),this.type=Ye.ConvexPolygon,this.vertices=e,this.skipConvexHullComputation=!!t}intoRaw(){return this.skipConvexHullComputation?xe.convexPolyline(this.vertices):xe.convexHull(this.vertices)}}class am extends jn{constructor(e,t,r){super(),this.type=Ye.RoundConvexPolygon,this.vertices=e,this.borderRadius=t,this.skipConvexHullComputation=!!r}intoRaw(){return this.skipConvexHullComputation?xe.roundConvexPolyline(this.vertices,this.borderRadius):xe.roundConvexHull(this.vertices,this.borderRadius)}}class cS extends jn{constructor(e,t){super(),this.type=Ye.HeightField,this.heights=e,this.scale=t}intoRaw(){let e=U.intoRaw(this.scale),t=xe.heightfield(this.heights,e);return e.free(),t}}var lm;(function(n){n[n.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",n[n.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",n[n.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",n[n.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",n[n.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",n[n.FIXED_FIXED=32]="FIXED_FIXED",n[n.DEFAULT=15]="DEFAULT",n[n.ALL=60943]="ALL"})(lm||(lm={}));class dS{constructor(e,t,r,i){this.colliderSet=e,this.handle=t,this._parent=r,this._shape=i}finalizeDeserialization(e){this.handle!=null&&(this._parent=e.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=jn.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return U.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return Qe.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(e){this.colliderSet.raw.coSetSensor(this.handle,e)}setShape(e){let t=e.intoRaw();this.colliderSet.raw.coSetShape(this.handle,t),t.free(),this._shape=e}setEnabled(e){this.colliderSet.raw.coSetEnabled(this.handle,e)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(e){this.colliderSet.raw.coSetRestitution(this.handle,e)}setFriction(e){this.colliderSet.raw.coSetFriction(this.handle,e)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(e){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,e)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(e){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,e)}setCollisionGroups(e){this.colliderSet.raw.coSetCollisionGroups(this.handle,e)}setSolverGroups(e){this.colliderSet.raw.coSetSolverGroups(this.handle,e)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(e){this.colliderSet.raw.coSetActiveHooks(this.handle,e)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(e){this.colliderSet.raw.coSetActiveEvents(this.handle,e)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(e){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,e)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(e){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,e)}setDensity(e){this.colliderSet.raw.coSetDensity(this.handle,e)}setMass(e){this.colliderSet.raw.coSetMass(this.handle,e)}setMassProperties(e,t,r){let i=U.intoRaw(t);this.colliderSet.raw.coSetMassProperties(this.handle,e,i,r),i.free()}setTranslation(e){this.colliderSet.raw.coSetTranslation(this.handle,e.x,e.y)}setTranslationWrtParent(e){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,e.x,e.y)}setRotation(e){this.colliderSet.raw.coSetRotation(this.handle,e)}setRotationWrtParent(e){this.colliderSet.raw.coSetRotationWrtParent(this.handle,e)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return U.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(e){const t=U.intoRaw(e);this.colliderSet.raw.coSetHalfExtents(this.handle,t)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(e){this.colliderSet.raw.coSetRadius(this.handle,e)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(e){this.colliderSet.raw.coSetRoundRadius(this.handle,e)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(e){this.colliderSet.raw.coSetHalfHeight(this.handle,e)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let e=this.colliderSet.raw.coHeightfieldScale(this.handle);return U.fromRaw(e)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(e){let t=U.intoRaw(e),r=this.colliderSet.raw.coContainsPoint(this.handle,t);return t.free(),r}projectPoint(e,t){let r=U.intoRaw(e),i=Su.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,r,t));return r.free(),i}intersectsRay(e,t){let r=U.intoRaw(e.origin),i=U.intoRaw(e.dir),o=this.colliderSet.raw.coIntersectsRay(this.handle,r,i,t);return r.free(),i.free(),o}castShape(e,t,r,i,o,s,a){let l=U.intoRaw(e),c=U.intoRaw(r),d=Qe.intoRaw(i),u=U.intoRaw(o),h=t.intoRaw(),p=ql.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,l,h,c,d,u,s,a));return l.free(),c.free(),d.free(),u.free(),h.free(),p}castCollider(e,t,r,i,o){let s=U.intoRaw(e),a=U.intoRaw(r),l=Cu.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,s,t.handle,a,i,o));return s.free(),a.free(),l}intersectsShape(e,t,r){let i=U.intoRaw(t),o=Qe.intoRaw(r),s=e.intoRaw(),a=this.colliderSet.raw.coIntersectsShape(this.handle,s,i,o);return i.free(),o.free(),s.free(),a}contactShape(e,t,r,i){let o=U.intoRaw(t),s=Qe.intoRaw(r),a=e.intoRaw(),l=Yl.fromRaw(this.colliderSet.raw.coContactShape(this.handle,a,o,s,i));return o.free(),s.free(),a.free(),l}contactCollider(e,t){return Yl.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,e.handle,t))}castRay(e,t,r){let i=U.intoRaw(e.origin),o=U.intoRaw(e.dir),s=this.colliderSet.raw.coCastRay(this.handle,i,o,t,r);return i.free(),o.free(),s}castRayAndGetNormal(e,t,r){let i=U.intoRaw(e.origin),o=U.intoRaw(e.dir),s=_u.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,i,o,t,r));return i.free(),o.free(),s}}var aa;(function(n){n[n.Density=0]="Density",n[n.Mass=1]="Mass",n[n.MassProps=2]="MassProps"})(aa||(aa={}));class en{constructor(e){this.enabled=!0,this.shape=e,this.massPropsMode=aa.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=Qe.identity(),this.translation=U.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=vu.Average,this.restitutionCombineRule=vu.Average,this.activeCollisionTypes=lm.DEFAULT,this.activeEvents=0,this.activeHooks=0,this.mass=0,this.centerOfMass=U.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=0,this.rotationsEnabled=!0}static ball(e){const t=new Q1(e);return new en(t)}static capsule(e,t){const r=new rS(e,t);return new en(r)}static segment(e,t){const r=new iS(e,t);return new en(r)}static triangle(e,t,r){const i=new oS(e,t,r);return new en(i)}static roundTriangle(e,t,r,i){const o=new sS(e,t,r,i);return new en(o)}static polyline(e,t){const r=new aS(e,t);return new en(r)}static trimesh(e,t){const r=new lS(e,t);return new en(r)}static cuboid(e,t){const r=new tS(e,t);return new en(r)}static roundCuboid(e,t,r){const i=new nS(e,t,r);return new en(i)}static halfspace(e){const t=new eS(e);return new en(t)}static heightfield(e,t){const r=new cS(e,t);return new en(r)}static convexHull(e){const t=new sm(e,!1);return new en(t)}static convexPolyline(e){const t=new sm(e,!0);return new en(t)}static roundConvexHull(e,t){const r=new am(e,t,!1);return new en(r)}static roundConvexPolyline(e,t){const r=new am(e,t,!0);return new en(r)}setTranslation(e,t){if(typeof e!="number"||typeof t!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:t},this}setRotation(e){return this.rotation=e,this}setSensor(e){return this.isSensor=e,this}setEnabled(e){return this.enabled=e,this}setDensity(e){return this.massPropsMode=aa.Density,this.density=e,this}setMass(e){return this.massPropsMode=aa.Mass,this.mass=e,this}setMassProperties(e,t,r){return this.massPropsMode=aa.MassProps,this.mass=e,U.copy(this.centerOfMass,t),this.principalAngularInertia=r,this}setRestitution(e){return this.restitution=e,this}setFriction(e){return this.friction=e,this}setFrictionCombineRule(e){return this.frictionCombineRule=e,this}setRestitutionCombineRule(e){return this.restitutionCombineRule=e,this}setCollisionGroups(e){return this.collisionGroups=e,this}setSolverGroups(e){return this.solverGroups=e,this}setActiveHooks(e){return this.activeHooks=e,this}setActiveEvents(e){return this.activeEvents=e,this}setActiveCollisionTypes(e){return this.activeCollisionTypes=e,this}setContactForceEventThreshold(e){return this.contactForceEventThreshold=e,this}}class UR{constructor(e){this.raw=e||new vt,this.map=new im,e&&e.forEachColliderHandle(t=>{this.map.set(t,new dS(this,t,null))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}castClosure(e){return t=>{if(e)return e(this.get(t))}}finalizeDeserialization(e){this.map.forEach(t=>t.finalizeDeserialization(e))}createCollider(e,t,r){let i=r!=null&&r!=null;if(i&&isNaN(r))throw Error("Cannot create a collider with a parent rigid-body handle that is not a number.");let o=t.shape.intoRaw(),s=U.intoRaw(t.translation),a=Qe.intoRaw(t.rotation),l=U.intoRaw(t.centerOfMass),c=this.raw.createCollider(t.enabled,o,s,a,t.massPropsMode,t.mass,l,t.principalAngularInertia,t.density,t.friction,t.restitution,t.frictionCombineRule,t.restitutionCombineRule,t.isSensor,t.collisionGroups,t.solverGroups,t.activeCollisionTypes,t.activeHooks,t.activeEvents,t.contactForceEventThreshold,i,i?r:0,e.raw);o.free(),s.free(),a.free(),l.free();let d=i?e.get(r):null,u=new dS(this,c,d,t.shape);return this.map.set(c,u),u}remove(e,t,r,i){this.raw.remove(e,t.raw,r.raw,i),this.unmap(e)}unmap(e){this.map.delete(e)}get(e){return this.map.get(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}forEach(e){this.map.forEach(e)}getAll(){return this.map.getAll()}}class VR{constructor(e){this.raw=e||new Gg}free(){this.raw&&this.raw.free(),this.raw=void 0}step(e,t,r,i,o,s,a,l,c,d,u,h){let p=U.intoRaw(e);u?this.raw.stepWithEvents(p,t.raw,r.raw,i.raw,o.raw,s.raw,a.raw,l.raw,c.raw,d.raw,u.raw,h,h?h.filterContactPair:null,h?h.filterIntersectionPair:null):this.raw.step(p,t.raw,r.raw,i.raw,o.raw,s.raw,a.raw,l.raw,c.raw,d.raw),p.free()}}var uS;(function(n){n[n.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",n[n.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",n[n.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",n[n.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",n[n.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",n[n.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",n[n.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",n[n.ONLY_FIXED=6]="ONLY_FIXED"})(uS||(uS={}));class HR{constructor(e){this.raw=e||new pu}free(){this.raw&&this.raw.free(),this.raw=void 0}update(e,t){this.raw.update(e.raw,t.raw)}castRay(e,t,r,i,o,s,a,l,c,d){let u=U.intoRaw(r.origin),h=U.intoRaw(r.dir),p=om.fromRaw(t,this.raw.castRay(e.raw,t.raw,u,h,i,o,s,a,l,c,d));return u.free(),h.free(),p}castRayAndGetNormal(e,t,r,i,o,s,a,l,c,d){let u=U.intoRaw(r.origin),h=U.intoRaw(r.dir),p=ku.fromRaw(t,this.raw.castRayAndGetNormal(e.raw,t.raw,u,h,i,o,s,a,l,c,d));return u.free(),h.free(),p}intersectionsWithRay(e,t,r,i,o,s,a,l,c,d,u){let h=U.intoRaw(r.origin),p=U.intoRaw(r.dir),m=f=>s(ku.fromRaw(t,f));this.raw.intersectionsWithRay(e.raw,t.raw,h,p,i,o,m,a,l,c,d,u),h.free(),p.free()}intersectionWithShape(e,t,r,i,o,s,a,l,c,d){let u=U.intoRaw(r),h=Qe.intoRaw(i),p=o.intoRaw(),m=this.raw.intersectionWithShape(e.raw,t.raw,u,h,p,s,a,l,c,d);return u.free(),h.free(),p.free(),m}projectPoint(e,t,r,i,o,s,a,l,c){let d=U.intoRaw(r),u=xu.fromRaw(t,this.raw.projectPoint(e.raw,t.raw,d,i,o,s,a,l,c));return d.free(),u}projectPointAndGetFeature(e,t,r,i,o,s,a,l){let c=U.intoRaw(r),d=xu.fromRaw(t,this.raw.projectPointAndGetFeature(e.raw,t.raw,c,i,o,s,a,l));return c.free(),d}intersectionsWithPoint(e,t,r,i,o,s,a,l,c){let d=U.intoRaw(r);this.raw.intersectionsWithPoint(e.raw,t.raw,d,i,o,s,a,l,c),d.free()}castShape(e,t,r,i,o,s,a,l,c,d,u,h,p){let m=U.intoRaw(r),f=Qe.intoRaw(i),w=U.intoRaw(o),S=s.intoRaw(),b=Cu.fromRaw(t,this.raw.castShape(e.raw,t.raw,m,f,w,S,a,l,c,d,u,h,p));return m.free(),f.free(),w.free(),S.free(),b}intersectionsWithShape(e,t,r,i,o,s,a,l,c,d,u){let h=U.intoRaw(r),p=Qe.intoRaw(i),m=o.intoRaw();this.raw.intersectionsWithShape(e.raw,t.raw,h,p,m,s,a,l,c,d,u),h.free(),p.free(),m.free()}collidersWithAabbIntersectingAabb(e,t,r){let i=U.intoRaw(e),o=U.intoRaw(t);this.raw.collidersWithAabbIntersectingAabb(i,o,r),i.free(),o.free()}}class hS{constructor(e){this.raw=e||new Zg}free(){this.raw&&this.raw.free(),this.raw=void 0}serializeAll(e,t,r,i,o,s,a,l,c){let d=U.intoRaw(e);const u=this.raw.serializeAll(d,t.raw,r.raw,i.raw,o.raw,s.raw,a.raw,l.raw,c.raw);return d.free(),u}deserializeAll(e){return cm.fromRaw(this.raw.deserializeAll(e))}}class WR{constructor(e,t){this.vertices=e,this.colors=t}}class KR{constructor(e){this.raw=e||new Wg}free(){this.raw&&this.raw.free(),this.raw=void 0,this.vertices=void 0,this.colors=void 0}render(e,t,r,i,o){this.raw.render(e.raw,t.raw,r.raw,i.raw,o.raw),this.vertices=this.raw.vertices(),this.colors=this.raw.colors()}}class GR{}class YR{constructor(e,t,r,i,o){this.params=t,this.bodies=r,this.colliders=i,this.queries=o,this.raw=new Kg(e),this.rawCharacterCollision=new uu,this._applyImpulsesToDynamicBodies=!1,this._characterMass=null}free(){this.raw&&(this.raw.free(),this.rawCharacterCollision.free()),this.raw=void 0,this.rawCharacterCollision=void 0}up(){return this.raw.up()}setUp(e){let t=U.intoRaw(e);return this.raw.setUp(t)}applyImpulsesToDynamicBodies(){return this._applyImpulsesToDynamicBodies}setApplyImpulsesToDynamicBodies(e){this._applyImpulsesToDynamicBodies=e}characterMass(){return this._characterMass}setCharacterMass(e){this._characterMass=e}offset(){return this.raw.offset()}setOffset(e){this.raw.setOffset(e)}slideEnabled(){return this.raw.slideEnabled()}setSlideEnabled(e){this.raw.setSlideEnabled(e)}autostepMaxHeight(){return this.raw.autostepMaxHeight()}autostepMinWidth(){return this.raw.autostepMinWidth()}autostepIncludesDynamicBodies(){return this.raw.autostepIncludesDynamicBodies()}autostepEnabled(){return this.raw.autostepEnabled()}enableAutostep(e,t,r){this.raw.enableAutostep(e,t,r)}disableAutostep(){return this.raw.disableAutostep()}maxSlopeClimbAngle(){return this.raw.maxSlopeClimbAngle()}setMaxSlopeClimbAngle(e){this.raw.setMaxSlopeClimbAngle(e)}minSlopeSlideAngle(){return this.raw.minSlopeSlideAngle()}setMinSlopeSlideAngle(e){this.raw.setMinSlopeSlideAngle(e)}snapToGroundDistance(){return this.raw.snapToGroundDistance()}enableSnapToGround(e){this.raw.enableSnapToGround(e)}disableSnapToGround(){this.raw.disableSnapToGround()}snapToGroundEnabled(){return this.raw.snapToGroundEnabled()}computeColliderMovement(e,t,r,i,o){let s=U.intoRaw(t);this.raw.computeColliderMovement(this.params.dt,this.bodies.raw,this.colliders.raw,this.queries.raw,e.handle,s,this._applyImpulsesToDynamicBodies,this._characterMass,r,i,this.colliders.castClosure(o)),s.free()}computedMovement(){return U.fromRaw(this.raw.computedMovement())}computedGrounded(){return this.raw.computedGrounded()}numComputedCollisions(){return this.raw.numComputedCollisions()}computedCollision(e,t){if(this.raw.computedCollision(e,this.rawCharacterCollision)){let r=this.rawCharacterCollision;return t=t??new GR,t.translationApplied=U.fromRaw(r.translationApplied()),t.translationRemaining=U.fromRaw(r.translationRemaining()),t.toi=r.toi(),t.witness1=U.fromRaw(r.worldWitness1()),t.witness2=U.fromRaw(r.worldWitness2()),t.normal1=U.fromRaw(r.worldNormal1()),t.normal2=U.fromRaw(r.worldNormal2()),t.collider=this.colliders.get(r.handle()),t}else return null}}class cm{constructor(e,t,r,i,o,s,a,l,c,d,u,h,p,m){this.gravity=e,this.integrationParameters=new IR(t),this.islands=new NR(r),this.broadPhase=new FR(i),this.narrowPhase=new $R(o),this.bodies=new ER(s),this.colliders=new UR(a),this.impulseJoints=new jR(l),this.multibodyJoints=new LR(c),this.ccdSolver=new zR(d),this.queryPipeline=new HR(u),this.physicsPipeline=new VR(h),this.serializationPipeline=new hS(p),this.debugRenderPipeline=new KR(m),this.characterControllers=new Set,this.impulseJoints.finalizeDeserialization(this.bodies),this.bodies.finalizeDeserialization(this.colliders),this.colliders.finalizeDeserialization(this.bodies)}free(){this.integrationParameters.free(),this.islands.free(),this.broadPhase.free(),this.narrowPhase.free(),this.bodies.free(),this.colliders.free(),this.impulseJoints.free(),this.multibodyJoints.free(),this.ccdSolver.free(),this.queryPipeline.free(),this.physicsPipeline.free(),this.serializationPipeline.free(),this.debugRenderPipeline.free(),this.characterControllers.forEach(e=>e.free()),this.integrationParameters=void 0,this.islands=void 0,this.broadPhase=void 0,this.narrowPhase=void 0,this.bodies=void 0,this.colliders=void 0,this.ccdSolver=void 0,this.impulseJoints=void 0,this.multibodyJoints=void 0,this.queryPipeline=void 0,this.physicsPipeline=void 0,this.serializationPipeline=void 0,this.debugRenderPipeline=void 0,this.characterControllers=void 0}static fromRaw(e){return e?new cm(U.fromRaw(e.takeGravity()),e.takeIntegrationParameters(),e.takeIslandManager(),e.takeBroadPhase(),e.takeNarrowPhase(),e.takeBodies(),e.takeColliders(),e.takeImpulseJoints(),e.takeMultibodyJoints()):null}takeSnapshot(){return this.serializationPipeline.serializeAll(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints)}static restoreSnapshot(e){return new hS().deserializeAll(e)}debugRender(){return this.debugRenderPipeline.render(this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.narrowPhase),new WR(this.debugRenderPipeline.vertices,this.debugRenderPipeline.colors)}step(e,t){this.physicsPipeline.step(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.ccdSolver,e,t),this.queryPipeline.update(this.bodies,this.colliders)}propagateModifiedBodyPositionsToColliders(){this.bodies.raw.propagateModifiedBodyPositionsToColliders(this.colliders.raw)}updateSceneQueries(){this.propagateModifiedBodyPositionsToColliders(),this.queryPipeline.update(this.bodies,this.colliders)}get timestep(){return this.integrationParameters.dt}set timestep(e){this.integrationParameters.dt=e}get maxVelocityIterations(){return this.integrationParameters.maxVelocityIterations}set maxVelocityIterations(e){this.integrationParameters.maxVelocityIterations=e}get maxVelocityFrictionIterations(){return this.integrationParameters.maxVelocityFrictionIterations}set maxVelocityFrictionIterations(e){this.integrationParameters.maxVelocityFrictionIterations=e}get maxStabilizationIterations(){return this.integrationParameters.maxStabilizationIterations}set maxStabilizationIterations(e){this.integrationParameters.maxStabilizationIterations=e}createRigidBody(e){return this.bodies.createRigidBody(this.colliders,e)}createCharacterController(e){let t=new YR(e,this.integrationParameters,this.bodies,this.colliders,this.queryPipeline);return this.characterControllers.add(t),t}removeCharacterController(e){this.characterControllers.delete(e),e.free()}createCollider(e,t){let r=t?t.handle:void 0;return this.colliders.createCollider(this.bodies,e,r)}createImpulseJoint(e,t,r,i){return this.impulseJoints.createJoint(this.bodies,e,t.handle,r.handle,i)}createMultibodyJoint(e,t,r,i){return this.multibodyJoints.createJoint(e,t.handle,r.handle,i)}getRigidBody(e){return this.bodies.get(e)}getCollider(e){return this.colliders.get(e)}getImpulseJoint(e){return this.impulseJoints.get(e)}getMultibodyJoint(e){return this.multibodyJoints.get(e)}removeRigidBody(e){this.bodies&&this.bodies.remove(e.handle,this.islands,this.colliders,this.impulseJoints,this.multibodyJoints)}removeCollider(e,t){this.colliders&&this.colliders.remove(e.handle,this.islands,this.bodies,t)}removeImpulseJoint(e,t){this.impulseJoints&&this.impulseJoints.remove(e.handle,t)}removeMultibodyJoint(e,t){this.impulseJoints&&this.multibodyJoints.remove(e.handle,t)}forEachCollider(e){this.colliders.forEach(e)}forEachRigidBody(e){this.bodies.forEach(e)}forEachActiveRigidBody(e){this.bodies.forEachActiveRigidBody(this.islands,e)}castRay(e,t,r,i,o,s,a,l){return this.queryPipeline.castRay(this.bodies,this.colliders,e,t,r,i,o,s?s.handle:null,a?a.handle:null,this.colliders.castClosure(l))}castRayAndGetNormal(e,t,r,i,o,s,a,l){return this.queryPipeline.castRayAndGetNormal(this.bodies,this.colliders,e,t,r,i,o,s?s.handle:null,a?a.handle:null,this.colliders.castClosure(l))}intersectionsWithRay(e,t,r,i,o,s,a,l,c){this.queryPipeline.intersectionsWithRay(this.bodies,this.colliders,e,t,r,i,o,s,a?a.handle:null,l?l.handle:null,this.colliders.castClosure(c))}intersectionWithShape(e,t,r,i,o,s,a,l){let c=this.queryPipeline.intersectionWithShape(this.bodies,this.colliders,e,t,r,i,o,s?s.handle:null,a?a.handle:null,this.colliders.castClosure(l));return c!=null?this.colliders.get(c):null}projectPoint(e,t,r,i,o,s,a){return this.queryPipeline.projectPoint(this.bodies,this.colliders,e,t,r,i,o?o.handle:null,s?s.handle:null,this.colliders.castClosure(a))}projectPointAndGetFeature(e,t,r,i,o,s){return this.queryPipeline.projectPointAndGetFeature(this.bodies,this.colliders,e,t,r,i?i.handle:null,o?o.handle:null,this.colliders.castClosure(s))}intersectionsWithPoint(e,t,r,i,o,s,a){this.queryPipeline.intersectionsWithPoint(this.bodies,this.colliders,e,this.colliders.castClosure(t),r,i,o?o.handle:null,s?s.handle:null,this.colliders.castClosure(a))}castShape(e,t,r,i,o,s,a,l,c,d,u){return this.queryPipeline.castShape(this.bodies,this.colliders,e,t,r,i,o,s,a,l,c?c.handle:null,d?d.handle:null,this.colliders.castClosure(u))}intersectionsWithShape(e,t,r,i,o,s,a,l,c){this.queryPipeline.intersectionsWithShape(this.bodies,this.colliders,e,t,r,this.colliders.castClosure(i),o,s,a?a.handle:null,l?l.handle:null,this.colliders.castClosure(c))}collidersWithAabbIntersectingAabb(e,t,r){this.queryPipeline.collidersWithAabbIntersectingAabb(e,t,this.colliders.castClosure(r))}contactsWith(e,t){this.narrowPhase.contactsWith(e.handle,this.colliders.castClosure(t))}intersectionsWith(e,t){this.narrowPhase.intersectionsWith(e.handle,this.colliders.castClosure(t))}contactPair(e,t,r){this.narrowPhase.contactPair(e.handle,t.handle,r)}intersectionPair(e,t){return this.narrowPhase.intersectionPair(e.handle,t.handle)}}var pS;(function(n){n[n.COLLISION_EVENTS=1]="COLLISION_EVENTS",n[n.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(pS||(pS={}));class XR{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return U.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return U.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class gde{constructor(e,t){this.raw=t||new hu(e)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(e){this.raw.drainCollisionEvents(e)}drainContactForceEvents(e){let t=new XR;this.raw.drainContactForceEvents(r=>{t.raw=r,e(t),t.free()})}clear(){this.raw.clear()}}var fS;(function(n){n[n.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",n[n.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(fS||(fS={}));var gS;(function(n){n[n.EMPTY=0]="EMPTY",n[n.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"})(gS||(gS={}));function mde(){return sre()}const Gn=Object.freeze(Object.defineProperty({__proto__:null,get ActiveCollisionTypes(){return lm},get ActiveEvents(){return pS},get ActiveHooks(){return fS},Ball:Q1,BroadPhase:FR,CCDSolver:zR,Capsule:rS,CharacterCollision:GR,get CoefficientCombineRule(){return vu},Collider:dS,ColliderDesc:en,ColliderSet:UR,ConvexPolygon:sm,Cuboid:tS,DebugRenderBuffers:WR,DebugRenderPipeline:KR,EventQueue:gde,get FeatureType(){return Xl},FixedImpulseJoint:MR,FixedMultibodyJoint:RR,HalfSpace:eS,Heightfield:cS,ImpulseJoint:oa,ImpulseJointSet:jR,IntegrationParameters:IR,IslandManager:NR,JointData:bu,get JointType(){return Tn},KinematicCharacterController:YR,get MassPropsMode(){return aa},get MotorModel(){return q1},MultibodyJoint:sa,MultibodyJointSet:LR,NarrowPhase:$R,PhysicsPipeline:VR,PointColliderProjection:xu,PointProjection:Su,Polyline:aS,PrismaticImpulseJoint:AR,PrismaticMultibodyJoint:OR,get QueryFilterFlags(){return uS},QueryPipeline:HR,Ray:fde,RayColliderIntersection:ku,RayColliderToi:om,RayIntersection:_u,RevoluteImpulseJoint:TR,RevoluteMultibodyJoint:DR,RigidBody:X1,RigidBodyDesc:Di,RigidBodySet:ER,get RigidBodyType(){return oi},RotationOps:Qe,RoundConvexPolygon:am,RoundCuboid:nS,RoundTriangle:sS,Segment:iS,SerializationPipeline:hS,Shape:jn,ShapeColliderTOI:Cu,ShapeContact:Yl,ShapeTOI:ql,get ShapeType(){return Ye},get SolverFlags(){return gS},TempContactForceEvent:XR,TempContactManifold:BR,TriMesh:lS,Triangle:oS,UnitImpulseJoint:J1,UnitMultibodyJoint:Z1,Vector2:PR,VectorOps:U,World:cm,version:mde},Symbol.toStringTag,{value:"Module"})),qR={x:0,y:98};function mS(n){return!(!n||n==="black")}function yde(n){return n==="grey"?0:1}function wde(n){return n==="orange"?.9:0}function bde(n){return n==="blue"?.1:.8}const JR={defaultRestitution:0,defaultFriction:.1},Yn={up:{x:0,y:-1},additionalMass:20,maxSlopeClimbAngle:1,slideEnabled:!0,minSlopeSlideAngle:.9,applyImpulsesToDynamicBodies:!0,autostepHeight:5,autostepMaxClimbAngle:1,snapToGroundDistance:3,maxMoveSpeedX:100,moveAcceleration:600,moveDeceleration:500,jumpVelocity:300,gravityMultiplier:10},yS=(n,e,t,r,i)=>{const o=Math.cos(i),s=Math.sin(i);return{x:o*(t-n)-s*(r-e)+n,y:s*(t-n)+o*(r-e)+e}},Pu=({x:n,y:e,width:t,height:r,rotation:i,parentGroupShape:o})=>{const s=n+t/2,a=e+r/2;return o?yS(o.x,o.y,s,a,i):yS(n,e,s,a,i)},vde=({x:n,y:e,width:t,height:r,rotation:i})=>{const o=n-t/2,s=e-r/2;return yS(n,e,o,s,i)},Sde=(n,e,t,r,i)=>{let o=e.x===0&&n.x!==0?Math.max(Math.abs(n.x)-i*t,0)*Math.sign(n.x):n.x+e.x*t;o=Math.min(Math.abs(o),r)*Math.sign(o);const s=(n.x+o)/2*t,a=n.y*t+.5*e.y*t**2;return{x:s,y:a}},ZR=(n,e,t)=>{const r=new Float32Array(n.length*2),i=e/2,o=t/2;for(let s=0;s<n.length;s++)r[s*2]=n[s].x-i,r[s*2+1]=n[s].y-o;return r},xde=n=>!(n.type==="geo"&&n.props.geo==="rectangle");class _de extends qne{constructor(t){super(t);y(this,"id","physics");y(this,"world");y(this,"rigidbodyLookup");y(this,"colliderLookup");y(this,"characterLookup");y(this,"animFrame",-1);y(this,"getShapeDimensionsOrBounds",t=>{let r,i;if(t.type==="geo"){const o=t;r=o.props.w,i=o.props.h}else{const o=this.editor.getShapeGeometry(t);r=o.bounds.x,i=o.bounds.y}return{w:r,h:i}});this.world=new Gn.World(qR),this.rigidbodyLookup=new Map,this.colliderLookup=new Map,this.characterLookup=new Map,this.simStart()}onAdd(t){const r=new Set;for(const i of t){if(i.parentId!=="page:page"){r.add(i.parentId);continue}if(i.type==="group"){r.add(i.id);continue}if(!(this.colliderLookup.has(i.id)||this.rigidbodyLookup.has(i.id)))if("color"in i.props&&i.props.color==="violet")this.createCharacterObject(i);else switch(i.type){case"draw":this.createCompoundLineObject(i);break;case"group":this.createGroupObject(i);break;default:this.createShape(i);break}}for(const i of r){const o=this.editor.getShape(i);!o||o.type!=="group"||this.createGroupObject(o)}}onRemove(t){for(const r of t){if(this.rigidbodyLookup.has(r.id)){const i=this.rigidbodyLookup.get(r.id);if(!i)continue;this.world.removeRigidBody(i),this.rigidbodyLookup.delete(r.id)}if(this.colliderLookup.has(r.id)){const i=this.colliderLookup.get(r.id);if(!i)continue;this.world.removeCollider(i,!0),this.colliderLookup.delete(r.id)}if(this.characterLookup.has(r.id)){const i=this.characterLookup.get(r.id);if(!i)continue;this.world.removeCharacterController(i.controller),this.characterLookup.delete(r.id)}}}onShapeChange(t,r){t.props.color,r.props.color}simStart(){const t=()=>{this.world.step(),this.updateCharacterControllers(),this.updateRigidbodies(),this.updateSelected(),this.animFrame=requestAnimationFrame(t)};return t(),()=>cancelAnimationFrame(this.animFrame)}simStop(){this.animFrame!==-1&&(cancelAnimationFrame(this.animFrame),this.animFrame=-1)}addCollider(t,r,i){const o=this.world.createCollider(r,i);return o&&this.colliderLookup.set(t,o),o}addRigidbody(t,r){const i=this.world.createRigidBody(r);return i&&this.rigidbodyLookup.set(t,i),i}addCharacter(t){const r=this.world.createCharacterController(.1);return r.setUp(Yn.up),r.setMaxSlopeClimbAngle(Yn.maxSlopeClimbAngle),r.setSlideEnabled(Yn.slideEnabled),r.setMinSlopeSlideAngle(Yn.minSlopeSlideAngle),r.setApplyImpulsesToDynamicBodies(Yn.applyImpulsesToDynamicBodies),r.enableAutostep(Yn.autostepHeight,Yn.autostepMaxClimbAngle,!0),r.enableSnapToGround(Yn.snapToGroundDistance),this.characterLookup.set(t,{controller:r,id:t}),r}createShape(t){if(!("dash"in t.props&&t.props.dash==="dashed"))if("color"in t.props&&mS(t.props.color)){const r=yde(t.props.color),i=this.createRigidbodyObject(t,r);this.createColliderObject(t,i)}else this.createColliderObject(t)}createCharacterObject(t){const r=Pu({x:t.x,y:t.y,width:t.props.w,height:t.props.h,rotation:t.rotation}),i=this.editor.getShapeGeometry(t).vertices,o=ZR(i,t.props.w,t.props.h),s=Gn.ColliderDesc.convexHull(o);if(!s){console.error("Failed to create collider description.");return}const a=Gn.RigidBodyDesc.kinematicPositionBased().setTranslation(r.x,r.y).setAdditionalMass(Yn.additionalMass);a.userData={id:t.id,type:t.type,w:t.props.w,h:t.props.h,rbType:Gn.RigidBodyType.KinematicPositionBased};const l=this.addRigidbody(t.id,a);this.addCollider(t.id,s,l),this.addCharacter(t.id)}createGroupObject(t){const r=this.createRigidbodyObject(t);this.editor.getSortedChildIdsForParent(t.id).forEach(i=>{const o=this.editor.getShape(i);o&&("color"in o.props&&mS(o.props.color)?this.createColliderObject(o,r,t):this.createColliderObject(o))})}createCompoundLineObject(t){const r=this.createRigidbodyObject(t),i=this.editor.getShapeGeometry(t).vertices,o="color"in t.props&&mS(t.props.color);i.forEach(s=>{o?this.createColliderRelativeToParentObject(s,t,r):this.createColliderRelativeToParentObject(s,t)})}createRigidbodyObject(t,r=1){const{w:i,h:o}=this.getShapeDimensionsOrBounds(t),s=Pu({x:t.x,y:t.y,width:i,height:o,rotation:t.rotation}),a=Gn.RigidBodyDesc.dynamic().setTranslation(s.x,s.y).setRotation(t.rotation).setGravityScale(r);return a.userData={id:t.id,type:t.type,w:i,h:o,rbType:Gn.RigidBodyType.Dynamic},this.addRigidbody(t.id,a)}createColliderRelativeToParentObject(t,r,i=null){const o=Pu({x:t.x,y:t.y,width:3,height:3,rotation:0,parentGroupShape:r});let s=null;if(s=Gn.ColliderDesc.ball(3),!s){console.error("Failed to create collider description.");return}i?(s.setTranslation(o.x,o.y),this.addCollider(r.id,s,i)):(s.setTranslation(r.x+o.x,r.y+o.y),this.addCollider(r.id,s))}createColliderObject(t,r=null,i=void 0){const{w:o,h:s}=this.getShapeDimensionsOrBounds(t),a=i?this.editor.getShape(i.id):void 0,l=Pu({x:t.x,y:t.y,width:o,height:s,rotation:t.rotation,parentGroupShape:a}),c="color"in t.props?wde(t.props.color):JR.defaultRestitution,d="color"in t.props?bde(t.props.color):JR.defaultFriction;let u=null;if(xde(t)){const h=this.editor.getShapeGeometry(t).vertices,p=ZR(h,o,s);u=Gn.ColliderDesc.convexHull(p)}else u=Gn.ColliderDesc.cuboid(o/2,s/2);if(!u){console.error("Failed to create collider description.");return}u.setRestitution(c).setRestitutionCombineRule(Gn.CoefficientCombineRule.Max).setFriction(d).setFrictionCombineRule(Gn.CoefficientCombineRule.Min),r?(i&&(u.setTranslation(l.x,l.y),u.setRotation(t.rotation)),this.addCollider(t.id,u,r)):(u.setTranslation(l.x,l.y).setRotation(t.rotation),this.addCollider(t.id,u))}updateRigidbodies(){this.world.bodies.forEach(t=>{if(!t.userData)return;const r=t.userData;if(this.editor.getSelectedShapeIds().includes(r.id))return;t.setBodyType(r.rbType,!0);const i=t.translation(),o=t.rotation(),s=vde({x:i.x,y:i.y,width:r.w,height:r.h,rotation:o});this.editor.updateShape({id:r.id,type:r.type,rotation:o,x:s.x,y:s.y})})}updateSelected(){for(const t of this.editor.getSelectedShapeIds()){const r=this.editor.getShape(t);if(!r)continue;const i=this.colliderLookup.get(t),o=this.rigidbodyLookup.get(t),{w:s,h:a}=this.getShapeDimensionsOrBounds(r),l=Pu({x:r.x,y:r.y,width:s,height:a,rotation:r.rotation});if(i&&o){const c=o.userData;o.isKinematic()||o.setBodyType(Gn.RigidBodyType.KinematicPositionBased,!0),o.setNextKinematicTranslation({x:l.x,y:l.y}),o.setNextKinematicRotation(r.rotation),i.setHalfExtents({x:s/2,y:a/2}),c.w=s,c.h=a;continue}if(o){o.isKinematic()||o.setBodyType(Gn.RigidBodyType.KinematicPositionBased,!0),o.setNextKinematicTranslation({x:l.x,y:l.y}),o.setNextKinematicRotation(r.rotation);continue}i&&(i.setTranslation({x:l.x,y:l.y}),i.setRotation(r.rotation),i.setHalfExtents({x:s/2,y:a/2}))}}updateCharacterControllers(){const t=this.editor.inputs.keys.has("ArrowRight")?1:0,r=this.editor.inputs.keys.has("ArrowLeft")?-1:0,i={x:(t+r)*Yn.moveAcceleration,y:Yn.gravityMultiplier*qR.y};for(const o of this.characterLookup.values()){const s=this.rigidbodyLookup.get(o.id);if(!s)continue;const a=s.userData,l=this.colliderLookup.get(o.id),c=o.controller.computedGrounded(),d=this.editor.inputs.keys.has("ArrowUp")&&c,u={x:s.linvel().x,y:d?-Yn.jumpVelocity:s.linvel().y},h=Sde(u,i,1/60,Yn.maxMoveSpeedX,Yn.moveDeceleration);o.controller.computeColliderMovement(l,new Gn.Vector2(h.x,h.y));const p=o.controller.computedMovement(),m=s.translation(),f=m.x+p.x,w=m.y+p.y;s==null||s.setNextKinematicTranslation({x:f,y:w});const S=a.w,b=a.h;this.editor.updateShape({id:a.id,type:a.type,x:f-S/2,y:w-b/2})}}}const kde=[_de];function Cde(){const[n,e]=v.useState(null);return g.jsx("div",{className:"tldraw__editor",children:g.jsx(Gne,{autoFocus:!0,shareZone:g.jsx(Pde,{}),overrides:ere,onMount:e,persistenceKey:"tldraw-physics",children:n&&g.jsx(Jne,{editor:n,collections:kde,children:g.jsx(Qne,{})})})})}const Pde=ze(()=>{const n=G(),{color:e,name:t}=n.user.getUserPreferences();return g.jsxs("div",{style:{pointerEvents:"all",display:"flex",width:"148px",margin:"4px 8px",border:"none"},children:[g.jsx("input",{style:{borderRadius:"9px 0px 0px 9px",border:"none",backgroundColor:"white",boxShadow:"0px 0px 4px rgba(0, 0, 0, 0.25)"},type:"color",value:e,onChange:r=>{n.user.updateUserPreferences({color:r.currentTarget.value})}}),g.jsx("input",{style:{width:"100%",borderRadius:"0px 9px 9px 0px",border:"none",backgroundColor:"white",boxShadow:"0px 0px 4px rgba(0, 0, 0, 0.25)"},value:t,onChange:r=>{n.user.updateUserPreferences({name:r.currentTarget.value})}})]})});_m.createRoot(document.getElementById("root")).render(g.jsx(re.StrictMode,{children:g.jsx(Cde,{})}))})();
